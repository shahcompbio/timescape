<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>TimeScape vignette</title>

<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gZXZhbCgiKCIgKyB0YXNrICsgIikiKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFNpemluZyhlbCkgewogICAgdmFyIHNpemluZyA9IHNpemluZ1BvbGljeShlbCk7CiAgICBpZiAoIXNpemluZykKICAgICAgcmV0dXJuOwoKICAgIHZhciBjZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHRtbHdpZGdldF9jb250YWluZXIiKTsKICAgIGlmICghY2VsKQogICAgICByZXR1cm47CgogICAgaWYgKHR5cGVvZihzaXppbmcucGFkZGluZykgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nVG9Dc3ModW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZykpOwogICAgfQoKICAgIGlmIChzaXppbmcuZmlsbCkgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGlmIChjZWwpIHsKICAgICAgICBjZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIHZhciBwYWQgPSB1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKTsKICAgICAgICBjZWwuc3R5bGUudG9wID0gcGFkLnRvcCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLnJpZ2h0ID0gcGFkLnJpZ2h0ICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUuYm90dG9tID0gcGFkLmJvdHRvbSArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmxlZnQgPSBwYWQubGVmdCArICJweCI7CiAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwoKICAgIH0gZWxzZSB7CiAgICAgIGVsLnN0eWxlLndpZHRoID0gcHgoc2l6aW5nLndpZHRoKTsKICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gcHgoc2l6aW5nLmhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKICAgIH0KICB9CgogIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb25zIGZvciBtZXRob2RzCiAgdmFyIGRlZmF1bHRzID0gewogICAgZmluZDogZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIHF1ZXJ5U2VsZWN0b3JBbGwoc2NvcGUsICIuIiArIHRoaXMubmFtZSk7CiAgICB9LAogICAgcmVuZGVyRXJyb3I6IGZ1bmN0aW9uKGVsLCBlcnIpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwoKICAgICAgdGhpcy5jbGVhckVycm9yKGVsKTsKCiAgICAgIC8vIEFkZCBhbGwgdGhlc2UgZXJyb3IgY2xhc3NlcywgYXMgU2hpbnkgZG9lcwogICAgICB2YXIgZXJyQ2xhc3MgPSAic2hpbnktb3V0cHV0LWVycm9yIjsKICAgICAgaWYgKGVyci50eXBlICE9PSBudWxsKSB7CiAgICAgICAgLy8gdXNlIHRoZSBjbGFzc2VzIG9mIHRoZSBlcnJvciBjb25kaXRpb24gYXMgQ1NTIGNsYXNzIG5hbWVzCiAgICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgIiArICQubWFwKGFzQXJyYXkoZXJyLnR5cGUpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZXJyQ2xhc3MgKyAiLSIgKyB0eXBlOwogICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgfQogICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiBodG1sd2lkZ2V0cy1lcnJvciI7CgogICAgICAvLyBJcyBlbCBpbmxpbmUgb3IgYmxvY2s/IElmIGlubGluZSBvciBpbmxpbmUtYmxvY2ssIGp1c3QgZGlzcGxheTpub25lIGl0CiAgICAgIC8vIGFuZCBhZGQgYW4gaW5saW5lIGVycm9yLgogICAgICB2YXIgZGlzcGxheSA9ICRlbC5jc3MoImRpc3BsYXkiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgZGlzcGxheSk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICAkZWwuaGlkZSgpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvclNwYW4gPSAkKCI8c3Bhbj4iKS5hZGRDbGFzcyhlcnJDbGFzcyk7CiAgICAgICAgICBlcnJvclNwYW4udGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JTcGFuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIikgewogICAgICAgIC8vIElmIGJsb2NrLCBhZGQgYW4gZXJyb3IganVzdCBhZnRlciB0aGUgZWwsIHNldCB2aXNpYmlsaXR5Om5vbmUgb24gdGhlCiAgICAgICAgLy8gZWwsIGFuZCBwb3NpdGlvbiB0aGUgZXJyb3IgdG8gYmUgb24gdG9wIG9mIHRoZSBlbC4KICAgICAgICAvLyBNYXJrIGl0IHdpdGggYSB1bmlxdWUgSUQgYW5kIENTUyBjbGFzcyBzbyB3ZSBjYW4gcmVtb3ZlIGl0IGxhdGVyLgogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yRGl2ID0gJCgiPGRpdj4iKS5hZGRDbGFzcyhlcnJDbGFzcykuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgIC8vIHNldHRpbmcgd2lkdGggY2FuIHB1c2ggb3V0IHRoZSBwYWdlIHNpemUsIGZvcmNpbmcgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHNjcm9sbGJhcnMgdG8gYXBwZWFyIGFuZCBtYWtpbmcgaXQgaW1wb3NzaWJsZSBmb3IKICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgdG8gc2hyaW5rOyBzbyB1c2UgbWF4LXdpZHRoIGluc3RlYWQKICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIGVycm9yRGl2LnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yRGl2KTsKCiAgICAgICAgICAvLyBSZWFsbHkgZHVtYiB3YXkgdG8ga2VlcCB0aGUgc2l6ZS9wb3NpdGlvbiBvZiB0aGUgZXJyb3IgaW4gc3luYyB3aXRoCiAgICAgICAgICAvLyB0aGUgcGFyZW50IGVsZW1lbnQgYXMgdGhlIHdpbmRvdyBpcyByZXNpemVkIG9yIHdoYXRldmVyLgogICAgICAgICAgdmFyIGludElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghZXJyb3JEaXZbMF0ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50SWQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvckRpdgogICAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyRXJyb3I6IGZ1bmN0aW9uKGVsKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgbnVsbCk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICBpZiAoZGlzcGxheSkKICAgICAgICAgICRlbC5jc3MoImRpc3BsYXkiLCBkaXNwbGF5KTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpewogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaW5oZXJpdCIpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBzaXppbmc6IHt9CiAgfTsKCiAgLy8gQ2FsbGVkIGJ5IHdpZGdldCBiaW5kaW5ncyB0byByZWdpc3RlciBhIG5ldyB0eXBlIG9mIHdpZGdldC4gVGhlIGRlZmluaXRpb24KICAvLyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogIC8vIC0gbmFtZSAocmVxdWlyZWQpIC0gQSBzdHJpbmcgaW5kaWNhdGluZyB0aGUgYmluZGluZyBuYW1lLCB3aGljaCB3aWxsIGJlCiAgLy8gICB1c2VkIGJ5IGRlZmF1bHQgYXMgdGhlIENTUyBjbGFzc25hbWUgdG8gbG9vayBmb3IuCiAgLy8gLSBpbml0aWFsaXplIChvcHRpb25hbCkgLSBBIGZ1bmN0aW9uKGVsKSB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICB3aWRnZXQgZWxlbWVudDsgaWYgYSB2YWx1ZSBpcyByZXR1cm5lZCwgaXQgd2lsbCBiZSBwYXNzZWQgYXMgdGhlIHRoaXJkCiAgLy8gICB2YWx1ZSB0byByZW5kZXJWYWx1ZS4KICAvLyAtIHJlbmRlclZhbHVlIChyZXF1aXJlZCkgLSBBIGZ1bmN0aW9uKGVsLCBkYXRhLCBpbml0VmFsdWUpIHRoYXQgd2lsbCBiZQogIC8vICAgY2FsbGVkIHdpdGggZGF0YS4gU3RhdGljIGNvbnRleHRzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIGVsZW1lbnQ7IFNoaW55IGFwcHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBwZXIKICAvLyAgIGVsZW1lbnQsIGFzIHRoZSBkYXRhIGNoYW5nZXMuCiAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldCA9IGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIG5hbWUiKTsKICAgIH0KICAgIGlmICghZGVmaW5pdGlvbi50eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHR5cGUiKTsKICAgIH0KICAgIC8vIEN1cnJlbnRseSB3ZSBvbmx5IHN1cHBvcnQgb3V0cHV0IHdpZGdldHMKICAgIGlmIChkZWZpbml0aW9uLnR5cGUgIT09ICJvdXRwdXQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHdpZGdldCB0eXBlICciICsgZGVmaW5pdGlvbi50eXBlICsgIiciKTsKICAgIH0KICAgIC8vIFRPRE86IFZlcmlmeSB0aGF0IC5uYW1lIGlzIGEgdmFsaWQgQ1NTIGNsYXNzbmFtZQoKICAgIC8vIFN1cHBvcnQgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb25zLiBPbGQtc3R5bGUgY2xhc3MtYm91bmQKICAgIC8vIGRlZmluaXRpb25zIGhhdmUgb25lIHdpZGdldCAib2JqZWN0IiBwZXIgd2lkZ2V0IHBlciB0eXBlL2NsYXNzIG9mCiAgICAvLyB3aWRnZXQ7IHRoZSByZW5kZXJWYWx1ZSBhbmQgcmVzaXplIG1ldGhvZHMgb24gc3VjaCB3aWRnZXQgb2JqZWN0cwogICAgLy8gdGFrZSBlbCBhbmQgaW5zdGFuY2UgYXJndW1lbnRzLCBiZWNhdXNlIHRoZSB3aWRnZXQgb2JqZWN0IGNhbid0CiAgICAvLyBzdG9yZSB0aGVtLiBOZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0CiAgICAvLyBvYmplY3QgcGVyIHdpZGdldCBpbnN0YW5jZTsgdGhlIGRlZmluaXRpb24gdGhhdCdzIHBhc3NlZCBpbiBkb2Vzbid0CiAgICAvLyBwcm92aWRlIHJlbmRlclZhbHVlIG9yIHJlc2l6ZSBtZXRob2RzIGF0IGFsbCwganVzdCB0aGUgc2luZ2xlIG1ldGhvZAogICAgLy8gICBmYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KQogICAgLy8gd2hpY2ggcmV0dXJucyBhbiBvYmplY3QgdGhhdCBoYXMgcmVuZGVyVmFsdWUoeCkgYW5kIHJlc2l6ZSh3LCBoKS4KICAgIC8vIFRoaXMgZW5hYmxlcyBhIGZhciBtb3JlIG5hdHVyYWwgcHJvZ3JhbW1pbmcgc3R5bGUgZm9yIHRoZSB3aWRnZXQKICAgIC8vIGF1dGhvciwgd2hvIGNhbiBzdG9yZSBwZXItaW5zdGFuY2Ugc3RhdGUgdXNpbmcgZWl0aGVyIE9PLXN0eWxlCiAgICAvLyBpbnN0YW5jZSBmaWVsZHMgb3IgZnVuY3Rpb25hbC1zdHlsZSBjbG9zdXJlIHZhcmlhYmxlcyAoSSBndWVzcyB0aGlzCiAgICAvLyBpcyBpbiBjb250cmFzdCB0byB3aGF0IGNhbiBvbmx5IGJlIGNhbGxlZCBDLXN0eWxlIHBzZXVkby1PTyB3aGljaCBpcwogICAgLy8gd2hhdCB3ZSByZXF1aXJlZCBiZWZvcmUpLgogICAgaWYgKGRlZmluaXRpb24uZmFjdG9yeSkgewogICAgICBkZWZpbml0aW9uID0gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmaW5pdGlvbik7CiAgICB9CgogICAgaWYgKCFkZWZpbml0aW9uLnJlbmRlclZhbHVlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHJlbmRlclZhbHVlIGZ1bmN0aW9uIik7CiAgICB9CgogICAgLy8gRm9yIHN0YXRpYyByZW5kZXJpbmcgKG5vbi1TaGlueSksIHVzZSBhIHNpbXBsZSB3aWRnZXQgcmVnaXN0cmF0aW9uCiAgICAvLyBzY2hlbWUuIFdlIGFsc28gdXNlIHRoaXMgc2NoZW1lIGZvciBTaGlueSBhcHBzL2RvY3VtZW50cyB0aGF0IGFsc28KICAgIC8vIGNvbnRhaW4gc3RhdGljIHdpZGdldHMuCiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgLy8gTWVyZ2UgZGVmYXVsdHMgaW50byB0aGUgZGVmaW5pdGlvbjsgZG9uJ3QgbXV0YXRlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uLgogICAgdmFyIHN0YXRpY0JpbmRpbmcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKICAgIG92ZXJyaWRlTWV0aG9kKHN0YXRpY0JpbmRpbmcsICJmaW5kIiwgZnVuY3Rpb24oc3VwZXJmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gc3VwZXJmdW5jKHNjb3BlKTsKICAgICAgICAvLyBGaWx0ZXIgb3V0IFNoaW55IG91dHB1dHMsIHdlIG9ubHkgd2FudCB0aGUgc3RhdGljIGtpbmQKICAgICAgICByZXR1cm4gZmlsdGVyQnlDbGFzcyhyZXN1bHRzLCAiaHRtbC13aWRnZXQtb3V0cHV0IiwgZmFsc2UpOwogICAgICB9OwogICAgfSk7CiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cy5wdXNoKHN0YXRpY0JpbmRpbmcpOwoKICAgIGlmIChzaGlueU1vZGUpIHsKICAgICAgLy8gU2hpbnkgaXMgcnVubmluZy4gUmVnaXN0ZXIgdGhlIGRlZmluaXRpb24gd2l0aCBhbiBvdXRwdXQgYmluZGluZy4KICAgICAgLy8gVGhlIGRlZmluaXRpb24gaXRzZWxmIHdpbGwgbm90IGJlIHRoZSBvdXRwdXQgYmluZGluZywgaW5zdGVhZAogICAgICAvLyB3ZSB3aWxsIG1ha2UgYW4gb3V0cHV0IGJpbmRpbmcgb2JqZWN0IHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICAvLyBkZWZpbml0aW9uLiBUaGlzIGlzIGJlY2F1c2Ugd2UgZm9vbGlzaGx5IHVzZWQgdGhlIHNhbWUgbWV0aG9kCiAgICAgIC8vIG5hbWUgKHJlbmRlclZhbHVlKSBmb3IgaHRtbHdpZGdldHMgZGVmaW5pdGlvbiBhbmQgU2hpbnkgYmluZGluZ3MKICAgICAgLy8gYnV0IHRoZXkgYWN0dWFsbHkgaGF2ZSBxdWl0ZSBkaWZmZXJlbnQgc2VtYW50aWNzICh0aGUgU2hpbnkKICAgICAgLy8gYmluZGluZ3MgcmVjZWl2ZSBkYXRhIHRoYXQgaW5jbHVkZXMgbG90cyBvZiBtZXRhZGF0YSB0aGF0IGl0CiAgICAgIC8vIHN0cmlwcyBvZmYgYmVmb3JlIGNhbGxpbmcgaHRtbHdpZGdldHMgcmVuZGVyVmFsdWUpLiBXZSBjYW4ndAogICAgICAvLyBqdXN0IGlnbm9yZSB0aGUgZGlmZmVyZW5jZSBiZWNhdXNlIGluIHNvbWUgd2lkZ2V0cyBpdCdzIGhlbHBmdWwKICAgICAgLy8gdG8gY2FsbCB0aGlzLnJlbmRlclZhbHVlKCkgZnJvbSBpbnNpZGUgb2YgcmVzaXplKCksIGFuZCBpZgogICAgICAvLyB3ZSdyZSBub3QgZGVsZWdhdGluZywgdGhlbiB0aGF0IGNhbGwgd2lsbCBnbyB0byB0aGUgU2hpbnkKICAgICAgLy8gdmVyc2lvbiBpbnN0ZWFkIG9mIHRoZSBodG1sd2lkZ2V0cyB2ZXJzaW9uLgoKICAgICAgLy8gTWVyZ2UgZGVmYXVsdHMgd2l0aCBkZWZpbml0aW9uLCB3aXRob3V0IG11dGF0aW5nIGVpdGhlci4KICAgICAgdmFyIGJpbmRpbmdEZWYgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKCiAgICAgIC8vIFRoaXMgb2JqZWN0IHdpbGwgYmUgb3VyIGFjdHVhbCBTaGlueSBiaW5kaW5nLgogICAgICB2YXIgc2hpbnlCaW5kaW5nID0gbmV3IFNoaW55Lk91dHB1dEJpbmRpbmcoKTsKCiAgICAgIC8vIFdpdGggYSBmZXcgZXhjZXB0aW9ucywgd2UnbGwgd2FudCB0byBzaW1wbHkgdXNlIHRoZSBiaW5kaW5nRGVmJ3MKICAgICAgLy8gdmVyc2lvbiBvZiBtZXRob2RzIGlmIHRoZXkgYXJlIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0bwogICAgICAvLyBTaGlueSdzIGRlZmF1bHRzLiBOT1RFOiBJZiBTaGlueSdzIG91dHB1dCBiaW5kaW5ncyBnYWluIGFkZGl0aW9uYWwKICAgICAgLy8gbWV0aG9kcyBpbiB0aGUgZnV0dXJlLCBhbmQgd2Ugd2FudCB0aGVtIHRvIGJlIG92ZXJyaWRlYWJsZSBieQogICAgICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcgZGVmaW5pdGlvbnMsIHRoZW4gd2UnbGwgbmVlZCB0byBhZGQgdGhlbSB0byB0aGlzCiAgICAgIC8vIGxpc3QuCiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImdldElkIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgIm9uVmFsdWVDaGFuZ2UiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgInJlbmRlckVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImNsZWFyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAic2hvd1Byb2dyZXNzIik7CgogICAgICAvLyBUaGUgZmluZCwgcmVuZGVyVmFsdWUsIGFuZCByZXNpemUgYXJlIGhhbmRsZWQgZGlmZmVyZW50bHksIGJlY2F1c2Ugd2UKICAgICAgLy8gd2FudCB0byBhY3R1YWxseSBkZWNvcmF0ZSB0aGUgYmVoYXZpb3Igb2YgdGhlIGJpbmRpbmdEZWYgbWV0aG9kcy4KCiAgICAgIHNoaW55QmluZGluZy5maW5kID0gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IGJpbmRpbmdEZWYuZmluZChzY29wZSk7CgogICAgICAgIC8vIE9ubHkgcmV0dXJuIGVsZW1lbnRzIHRoYXQgYXJlIFNoaW55IG91dHB1dHMsIG5vdCBzdGF0aWMgb25lcwogICAgICAgIHZhciBkeW5hbWljUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKCIuaHRtbC13aWRnZXQtb3V0cHV0Iik7CgogICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aGF0ZXZlciBjYXVzZWQgU2hpbnkgdG8gdGhpbmsgdGhlcmUgbWlnaHQgYmUKICAgICAgICAvLyBuZXcgZHluYW1pYyBvdXRwdXRzLCBhbHNvIGNhdXNlZCB0aGVyZSB0byBiZSBuZXcgc3RhdGljIG91dHB1dHMuCiAgICAgICAgLy8gU2luY2UgdGhlcmUgbWlnaHQgYmUgbG90cyBvZiBkaWZmZXJlbnQgaHRtbHdpZGdldHMgYmluZGluZ3MsIHdlCiAgICAgICAgLy8gc2NoZWR1bGUgZXhlY3V0aW9uIGZvciBsYXRlci0tbm8gbmVlZCB0byBzdGF0aWNSZW5kZXIgbXVsdGlwbGUKICAgICAgICAvLyB0aW1lcy4KICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggIT09IGR5bmFtaWNSZXN1bHRzLmxlbmd0aCkKICAgICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyKCk7CgogICAgICAgIHJldHVybiBkeW5hbWljUmVzdWx0czsKICAgICAgfTsKCiAgICAgIC8vIFdyYXAgcmVuZGVyVmFsdWUgdG8gaGFuZGxlIGluaXRpYWxpemF0aW9uLCB3aGljaCB1bmZvcnR1bmF0ZWx5IGlzbid0CiAgICAgIC8vIHN1cHBvcnRlZCBuYXRpdmVseSBieSBTaGlueSBhdCB0aGUgdGltZSBvZiB0aGlzIHdyaXRpbmcuCgogICAgICBzaGlueUJpbmRpbmcucmVuZGVyVmFsdWUgPSBmdW5jdGlvbihlbCwgZGF0YSkgewogICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgZGF0YS5ldmFscyAmJiBpIDwgZGF0YS5ldmFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1tpXSk7CiAgICAgICAgfQogICAgICAgIGlmICghYmluZGluZ0RlZi5yZW5kZXJPbk51bGxWYWx1ZSkgewogICAgICAgICAgaWYgKGRhdGEueCA9PT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaW5oZXJpdCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICBpbml0U2l6aW5nKGVsKTsKCiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIiwgdHJ1ZSk7CiAgICAgICAgICBpZiAoYmluZGluZ0RlZi5pbml0aWFsaXplKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBiaW5kaW5nRGVmLmluaXRpYWxpemUoZWwsIGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiLCByZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBTaGlueS5yZW5kZXJEZXBlbmRlbmNpZXMoZGF0YS5kZXBzKTsKICAgICAgICBiaW5kaW5nRGVmLnJlbmRlclZhbHVlKGVsLCBkYXRhLngsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSk7CiAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiksIFtlbCwgZGF0YS54XSk7CiAgICAgIH07CgogICAgICAvLyBPbmx5IG92ZXJyaWRlIHJlc2l6ZSBpZiBiaW5kaW5nRGVmIGltcGxlbWVudHMgaXQKICAgICAgaWYgKGJpbmRpbmdEZWYucmVzaXplKSB7CiAgICAgICAgc2hpbnlCaW5kaW5nLnJlc2l6ZSA9IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAvLyBTaGlueSBjYW4gY2FsbCByZXNpemUgYmVmb3JlIGluaXRpYWxpemUvcmVuZGVyVmFsdWUgaGF2ZSBiZWVuCiAgICAgICAgICAvLyBjYWxsZWQsIHdoaWNoIGRvZXNuJ3QgbWFrZSBzZW5zZSBmb3Igd2lkZ2V0cy4KICAgICAgICAgIGlmIChlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIikpIHsKICAgICAgICAgICAgYmluZGluZ0RlZi5yZXNpemUoZWwsIHdpZHRoLCBoZWlnaHQsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgU2hpbnkub3V0cHV0QmluZGluZ3MucmVnaXN0ZXIoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLm5hbWUpOwogICAgfQogIH07CgogIHZhciBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogIGZ1bmN0aW9uIHNjaGVkdWxlU3RhdGljUmVuZGVyKCkgewogICAgaWYgKCFzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQpIHsKICAgICAgc2NoZWR1bGVTdGF0aWNSZW5kZXJUaW1lcklkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgICAgfSwgMSk7CiAgICB9CiAgfQoKICAvLyBSZW5kZXIgc3RhdGljIHdpZGdldHMgYWZ0ZXIgdGhlIGRvY3VtZW50IGZpbmlzaGVzIGxvYWRpbmcKICAvLyBTdGF0aWNhbGx5IHJlbmRlciBhbGwgZWxlbWVudHMgdGhhdCBhcmUgb2YgdGhpcyB3aWRnZXQncyBjbGFzcwogIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIgPSBmdW5jdGlvbigpIHsKICAgIHZhciBiaW5kaW5ncyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgZm9yRWFjaChiaW5kaW5ncywgZnVuY3Rpb24oYmluZGluZykgewogICAgICB2YXIgbWF0Y2hlcyA9IGJpbmRpbmcuZmluZChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgICBmb3JFYWNoKG1hdGNoZXMsIGZ1bmN0aW9uKGVsKSB7CiAgICAgICAgdmFyIHNpemVPYmogPSBpbml0U2l6aW5nKGVsLCBiaW5kaW5nKTsKCiAgICAgICAgaWYgKGhhc0NsYXNzKGVsLCAiaHRtbC13aWRnZXQtc3RhdGljLWJvdW5kIikpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lICsgIiBodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiOwoKICAgICAgICB2YXIgaW5pdFJlc3VsdDsKICAgICAgICBpZiAoYmluZGluZy5pbml0aWFsaXplKSB7CiAgICAgICAgICBpbml0UmVzdWx0ID0gYmluZGluZy5pbml0aWFsaXplKGVsLAogICAgICAgICAgICBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldEhlaWdodCgpIDogZWwub2Zmc2V0SGVpZ2h0CiAgICAgICAgICApOwogICAgICAgICAgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIsIGluaXRSZXN1bHQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJpbmRpbmcucmVzaXplKSB7CiAgICAgICAgICB2YXIgbGFzdFNpemUgPSB7fTsKICAgICAgICAgIHZhciByZXNpemVIYW5kbGVyID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgc2l6ZSA9IHsKICAgICAgICAgICAgICB3OiBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgICAgaDogc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHNpemUudyA9PT0gMCAmJiBzaXplLmggPT09IDApCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSBsYXN0U2l6ZS53ICYmIHNpemUuaCA9PT0gbGFzdFNpemUuaCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGxhc3RTaXplID0gc2l6ZTsKICAgICAgICAgICAgYmluZGluZy5yZXNpemUoZWwsIHNpemUudywgc2l6ZS5oLCBpbml0UmVzdWx0KTsKICAgICAgICAgIH07CgogICAgICAgICAgb24od2luZG93LCAicmVzaXplIiwgcmVzaXplSGFuZGxlcik7CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIGNhc2VzIHdoZXJlIHdlJ3JlIHJ1bm5pbmcgaW4gYSBTaGlueQogICAgICAgICAgLy8gYXBwLCBidXQgdGhlIHdpZGdldCBpdHNlbGYgaXMgbm90IGEgU2hpbnkgb3V0cHV0LCBidXQKICAgICAgICAgIC8vIHJhdGhlciBhIHNpbXBsZSBzdGF0aWMgd2lkZ2V0LiBPbmUgZXhhbXBsZSBvZiB0aGlzIGlzCiAgICAgICAgICAvLyBhbiBybWFya2Rvd24gZG9jdW1lbnQgdGhhdCBoYXMgcnVudGltZTpzaGlueSBhbmQgd2lkZ2V0CiAgICAgICAgICAvLyB0aGF0IGlzbid0IGluIGEgcmVuZGVyIGZ1bmN0aW9uLiBTaGlueSBvbmx5IGtub3dzIHRvCiAgICAgICAgICAvLyBjYWxsIHJlc2l6ZSBoYW5kbGVycyBmb3IgU2hpbnkgb3V0cHV0cywgbm90IGZvciBzdGF0aWMKICAgICAgICAgIC8vIHdpZGdldHMsIHNvIHdlIGRvIGl0IG91cnNlbHZlcy4KICAgICAgICAgIGlmICh3aW5kb3cualF1ZXJ5KSB7CiAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkoZG9jdW1lbnQpLm9uKAogICAgICAgICAgICAgICJzaG93bi5odG1sd2lkZ2V0cyBzaG93bi5icy50YWIuaHRtbHdpZGdldHMgc2hvd24uYnMuY29sbGFwc2UuaHRtbHdpZGdldHMiLAogICAgICAgICAgICAgIHJlc2l6ZUhhbmRsZXIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkub24oCiAgICAgICAgICAgICAgImhpZGRlbi5odG1sd2lkZ2V0cyBoaWRkZW4uYnMudGFiLmh0bWx3aWRnZXRzIGhpZGRlbi5icy5jb2xsYXBzZS5odG1sd2lkZ2V0cyIsCiAgICAgICAgICAgICAgcmVzaXplSGFuZGxlcgogICAgICAgICAgICApOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFRoaXMgaXMgbmVlZGVkIGZvciB0aGUgc3BlY2lmaWMgY2FzZSBvZiBpb3NsaWRlcywgd2hpY2gKICAgICAgICAgIC8vIGZsaXBzIHNsaWRlcyBiZXR3ZWVuIGRpc3BsYXk6bm9uZSBhbmQgZGlzcGxheTpibG9jay4KICAgICAgICAgIC8vIElkZWFsbHkgd2Ugd291bGQgbm90IGhhdmUgdG8gaGF2ZSBpb3NsaWRlLXNwZWNpZmljIGNvZGUKICAgICAgICAgIC8vIGhlcmUsIGJ1dCByYXRoZXIgaGF2ZSBpb3NsaWRlcyByYWlzZSBhIGdlbmVyaWMgZXZlbnQsCiAgICAgICAgICAvLyBidXQgdGhlIHJtYXJrZG93biBwYWNrYWdlIGp1c3Qgd2VudCB0byBDUkFOIHNvIHRoZQogICAgICAgICAgLy8gd2luZG93IHRvIGdldHRpbmcgdGhhdCBmaXhlZCBtYXkgYmUgbG9uZy4KICAgICAgICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgICAvLyBJdCdzIE9LIHRvIGxpbWl0IHRoaXMgdG8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIKICAgICAgICAgICAgLy8gYnJvd3NlcnMgYmVjYXVzZSBpb3NsaWRlcyBpdHNlbGYgb25seSBzdXBwb3J0cwogICAgICAgICAgICAvLyBzdWNoIGJyb3dzZXJzLgogICAgICAgICAgICBvbihkb2N1bWVudCwgInNsaWRlZW50ZXIiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgICAgb24oZG9jdW1lbnQsICJzbGlkZWxlYXZlIiwgcmVzaXplSGFuZGxlcik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgc2NyaXB0RGF0YSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInNjcmlwdFtkYXRhLWZvcj0nIiArIGVsLmlkICsgIiddW3R5cGU9J2FwcGxpY2F0aW9uL2pzb24nXSIpOwogICAgICAgIGlmIChzY3JpcHREYXRhKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2Uoc2NyaXB0RGF0YS50ZXh0Q29udGVudCB8fCBzY3JpcHREYXRhLnRleHQpOwogICAgICAgICAgLy8gUmVzb2x2ZSBzdHJpbmdzIG1hcmtlZCBhcyBqYXZhc2NyaXB0IGxpdGVyYWxzIHRvIG9iamVjdHMKICAgICAgICAgIGlmICghKGRhdGEuZXZhbHMgaW5zdGFuY2VvZiBBcnJheSkpIGRhdGEuZXZhbHMgPSBbZGF0YS5ldmFsc107CiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgZGF0YS5ldmFscyAmJiBrIDwgZGF0YS5ldmFscy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIoZGF0YS54LCBkYXRhLmV2YWxzW2tdKTsKICAgICAgICAgIH0KICAgICAgICAgIGJpbmRpbmcucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgaW5pdFJlc3VsdCk7CiAgICAgICAgICBldmFsQW5kUnVuKGRhdGEuanNIb29rcy5yZW5kZXIsIGluaXRSZXN1bHQsIFtlbCwgZGF0YS54XSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpOwogIH0KCiAgLy8gV2FpdCB1bnRpbCBhZnRlciB0aGUgZG9jdW1lbnQgaGFzIGxvYWRlZCB0byByZW5kZXIgdGhlIHdpZGdldHMuCiAgaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBmdW5jdGlvbigpIHsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGFyZ3VtZW50cy5jYWxsZWUsIGZhbHNlKTsKICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgfSwgZmFsc2UpOwogIH0gZWxzZSBpZiAoZG9jdW1lbnQuYXR0YWNoRXZlbnQpIHsKICAgIGRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBmdW5jdGlvbigpIHsKICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIpIHsKICAgICAgICBkb2N1bWVudC5kZXRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgYXJndW1lbnRzLmNhbGxlZSk7CiAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgICB9CiAgICB9KTsKICB9CgoKICB3aW5kb3cuSFRNTFdpZGdldHMuZ2V0QXR0YWNobWVudFVybCA9IGZ1bmN0aW9uKGRlcG5hbWUsIGtleSkgewogICAgLy8gSWYgbm8ga2V5LCBkZWZhdWx0IHRvIHRoZSBmaXJzdCBpdGVtCiAgICBpZiAodHlwZW9mKGtleSkgPT09ICJ1bmRlZmluZWQiKQogICAgICBrZXkgPSAxOwoKICAgIHZhciBsaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGVwbmFtZSArICItIiArIGtleSArICItYXR0YWNobWVudCIpOwogICAgaWYgKCFsaW5rKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQXR0YWNobWVudCAiICsgZGVwbmFtZSArICIvIiArIGtleSArICIgbm90IGZvdW5kIGluIGRvY3VtZW50Iik7CiAgICB9CiAgICByZXR1cm4gbGluay5nZXRBdHRyaWJ1dGUoImhyZWYiKTsKICB9OwoKICB3aW5kb3cuSFRNTFdpZGdldHMuZGF0YWZyYW1lVG9EMyA9IGZ1bmN0aW9uKGRmKSB7CiAgICB2YXIgbmFtZXMgPSBbXTsKICAgIHZhciBsZW5ndGg7CiAgICBmb3IgKHZhciBuYW1lIGluIGRmKSB7CiAgICAgICAgaWYgKGRmLmhhc093blByb3BlcnR5KG5hbWUpKQogICAgICAgICAgICBuYW1lcy5wdXNoKG5hbWUpOwogICAgICAgIGlmICh0eXBlb2YoZGZbbmFtZV0pICE9PSAib2JqZWN0IiB8fCB0eXBlb2YoZGZbbmFtZV0ubGVuZ3RoKSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgZmllbGRzIG11c3QgYmUgYXJyYXlzIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YobGVuZ3RoKSAhPT0gInVuZGVmaW5lZCIgJiYgbGVuZ3RoICE9PSBkZltuYW1lXS5sZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgZmllbGRzIG11c3QgYmUgYXJyYXlzIG9mIHRoZSBzYW1lIGxlbmd0aCIpOwogICAgICAgIH0KICAgICAgICBsZW5ndGggPSBkZltuYW1lXS5sZW5ndGg7CiAgICB9CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIGl0ZW07CiAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBsZW5ndGg7IHJvdysrKSB7CiAgICAgICAgaXRlbSA9IHt9OwogICAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IG5hbWVzLmxlbmd0aDsgY29sKyspIHsKICAgICAgICAgICAgaXRlbVtuYW1lc1tjb2xdXSA9IGRmW25hbWVzW2NvbF1dW3Jvd107CiAgICAgICAgfQogICAgICAgIHJlc3VsdHMucHVzaChpdGVtKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIHdpbmRvdy5IVE1MV2lkZ2V0cy50cmFuc3Bvc2VBcnJheTJEID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIGFycmF5OwogICAgICB2YXIgbmV3QXJyYXkgPSBhcnJheVswXS5tYXAoZnVuY3Rpb24oY29sLCBpKSB7CiAgICAgICAgICByZXR1cm4gYXJyYXkubWFwKGZ1bmN0aW9uKHJvdykgewogICAgICAgICAgICAgIHJldHVybiByb3dbaV0KICAgICAgICAgIH0pCiAgICAgIH0pOwogICAgICByZXR1cm4gbmV3QXJyYXk7CiAgfTsKICAvLyBTcGxpdCB2YWx1ZSBhdCBzcGxpdENoYXIsIGJ1dCBhbGxvdyBzcGxpdENoYXIgdG8gYmUgZXNjYXBlZAogIC8vIHVzaW5nIGVzY2FwZUNoYXIuIEFueSBvdGhlciBjaGFyYWN0ZXJzIGVzY2FwZWQgYnkgZXNjYXBlQ2hhcgogIC8vIHdpbGwgYmUgaW5jbHVkZWQgYXMgdXN1YWwgKGluY2x1ZGluZyBlc2NhcGVDaGFyIGl0c2VsZikuCiAgZnVuY3Rpb24gc3BsaXRXaXRoRXNjYXBlKHZhbHVlLCBzcGxpdENoYXIsIGVzY2FwZUNoYXIpIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICB2YXIgZXNjYXBlTW9kZSA9IGZhbHNlOwogICAgdmFyIGN1cnJlbnRSZXN1bHQgPSAiIjsKICAgIGZvciAodmFyIHBvcyA9IDA7IHBvcyA8IHZhbHVlLmxlbmd0aDsgcG9zKyspIHsKICAgICAgaWYgKCFlc2NhcGVNb2RlKSB7CiAgICAgICAgaWYgKHZhbHVlW3Bvc10gPT09IHNwbGl0Q2hhcikgewogICAgICAgICAgcmVzdWx0cy5wdXNoKGN1cnJlbnRSZXN1bHQpOwogICAgICAgICAgY3VycmVudFJlc3VsdCA9ICIiOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWVbcG9zXSA9PT0gZXNjYXBlQ2hhcikgewogICAgICAgICAgZXNjYXBlTW9kZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRSZXN1bHQgKz0gdmFsdWVbcG9zXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3VycmVudFJlc3VsdCArPSB2YWx1ZVtwb3NdOwogICAgICAgIGVzY2FwZU1vZGUgPSBmYWxzZTsKICAgICAgfQogICAgfQogICAgaWYgKGN1cnJlbnRSZXN1bHQgIT09ICIiKSB7CiAgICAgIHJlc3VsdHMucHVzaChjdXJyZW50UmVzdWx0KTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH0KICAvLyBGdW5jdGlvbiBhdXRob3JlZCBieSBZaWh1aS9KSiBBbGxhaXJlCiAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyID0gZnVuY3Rpb24obywgbWVtYmVyKSB7CiAgICB2YXIgcGFydHMgPSBzcGxpdFdpdGhFc2NhcGUobWVtYmVyLCAnLicsICdcXCcpOwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwYXJ0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmFyIHBhcnQgPSBwYXJ0c1tpXTsKICAgICAgLy8gcGFydCBtYXkgYmUgYSBjaGFyYWN0ZXIgb3IgJ251bWVyaWMnIG1lbWJlciBuYW1lCiAgICAgIGlmIChvICE9PSBudWxsICYmIHR5cGVvZiBvID09PSAib2JqZWN0IiAmJiBwYXJ0IGluIG8pIHsKICAgICAgICBpZiAoaSA9PSAobCAtIDEpKSB7IC8vIGlmIHdlIGFyZSBhdCB0aGUgZW5kIG9mIHRoZSBsaW5lIHRoZW4gZXZhbHVsYXRlCiAgICAgICAgICBpZiAodHlwZW9mIG9bcGFydF0gPT09ICJzdHJpbmciKQogICAgICAgICAgICBvW3BhcnRdID0gZXZhbCgiKCIgKyBvW3BhcnRdICsgIikiKTsKICAgICAgICB9IGVsc2UgeyAvLyBvdGhlcndpc2UgY29udGludWUgdG8gbmV4dCBlbWJlZGRlZCBvYmplY3QKICAgICAgICAgIG8gPSBvW3BhcnRdOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8vIFJldHJpZXZlIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlIChpLmUuIHRoZSByZXR1cm4gdmFsdWUgb2YgYW4KICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCBhbiBlbGVtZW50LCBvciBudWxsIGlmIG5vbmUuCiAgd2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlID0gZnVuY3Rpb24oZWwpIHsKICAgIHJldHVybiBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0Iik7CiAgfTsKCiAgLy8gRmluZHMgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIHNjb3BlIHRoYXQgbWF0Y2hlcyB0aGUgc2VsZWN0b3IsCiAgLy8gYW5kIHJldHVybnMgdGhlIEhUTUxXaWRnZXQgaW5zdGFuY2UgKGkuZS4gdGhlIHJldHVybiB2YWx1ZSBvZgogIC8vIGFuIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIHRoYXQgZWxlbWVudCwgaWYgYW55LiBJZiBubyBlbGVtZW50IG1hdGNoZXMgdGhlCiAgLy8gc2VsZWN0b3IsIG9yIHRoZSBmaXJzdCBtYXRjaGluZyBlbGVtZW50IGhhcyBubyBIVE1MV2lkZ2V0CiAgLy8gaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIGl0LCB0aGVuIG51bGwgaXMgcmV0dXJuZWQuCiAgLy8KICAvLyBUaGUgc2NvcGUgYXJndW1lbnQgaXMgb3B0aW9uYWwsIGFuZCBkZWZhdWx0cyB0byB3aW5kb3cuZG9jdW1lbnQuCiAgd2luZG93LkhUTUxXaWRnZXRzLmZpbmQgPSBmdW5jdGlvbihzY29wZSwgc2VsZWN0b3IpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgc2VsZWN0b3IgPSBzY29wZTsKICAgICAgc2NvcGUgPSBkb2N1bWVudDsKICAgIH0KCiAgICB2YXIgZWwgPSBzY29wZS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgIGlmIChlbCA9PT0gbnVsbCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB3aW5kb3cuSFRNTFdpZGdldHMuZ2V0SW5zdGFuY2UoZWwpOwogICAgfQogIH07CgogIC8vIEZpbmRzIGFsbCBlbGVtZW50cyBpbiB0aGUgc2NvcGUgdGhhdCBtYXRjaCB0aGUgc2VsZWN0b3IsIGFuZAogIC8vIHJldHVybnMgdGhlIEhUTUxXaWRnZXQgaW5zdGFuY2VzIChpLmUuIHRoZSByZXR1cm4gdmFsdWVzIG9mCiAgLy8gYW4gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggdGhlIGVsZW1lbnRzLCBpbiBhbiBhcnJheS4gSWYgZWxlbWVudHMgdGhhdAogIC8vIG1hdGNoIHRoZSBzZWxlY3RvciBkb24ndCBoYXZlIGFuIGFzc29jaWF0ZWQgSFRNTFdpZGdldAogIC8vIGluc3RhbmNlLCB0aGUgcmV0dXJuZWQgYXJyYXkgd2lsbCBjb250YWluIG51bGxzLgogIC8vCiAgLy8gVGhlIHNjb3BlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBhbmQgZGVmYXVsdHMgdG8gd2luZG93LmRvY3VtZW50LgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5maW5kQWxsID0gZnVuY3Rpb24oc2NvcGUsIHNlbGVjdG9yKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgIHNlbGVjdG9yID0gc2NvcGU7CiAgICAgIHNjb3BlID0gZG9jdW1lbnQ7CiAgICB9CgogICAgdmFyIG5vZGVzID0gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykgewogICAgICByZXN1bHRzLnB1c2god2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlKG5vZGVzW2ldKSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgcG9zdFJlbmRlckhhbmRsZXJzID0gW107CiAgZnVuY3Rpb24gaW52b2tlUG9zdFJlbmRlckhhbmRsZXJzKCkgewogICAgd2hpbGUgKHBvc3RSZW5kZXJIYW5kbGVycy5sZW5ndGgpIHsKICAgICAgdmFyIGhhbmRsZXIgPSBwb3N0UmVuZGVySGFuZGxlcnMuc2hpZnQoKTsKICAgICAgaWYgKGhhbmRsZXIpIHsKICAgICAgICBoYW5kbGVyKCk7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIFJlZ2lzdGVyIHRoZSBnaXZlbiBjYWxsYmFjayBmdW5jdGlvbiB0byBiZSBpbnZva2VkIGFmdGVyIHRoZQogIC8vIG5leHQgdGltZSBzdGF0aWMgd2lkZ2V0cyBhcmUgcmVuZGVyZWQuCiAgd2luZG93LkhUTUxXaWRnZXRzLmFkZFBvc3RSZW5kZXJIYW5kbGVyID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHBvc3RSZW5kZXJIYW5kbGVycy5wdXNoKGNhbGxiYWNrKTsKICB9OwoKICAvLyBUYWtlcyBhIG5ldy1zdHlsZSBpbnN0YW5jZS1ib3VuZCBkZWZpbml0aW9uLCBhbmQgcmV0dXJucyBhbgogIC8vIG9sZC1zdHlsZSBjbGFzcy1ib3VuZCBkZWZpbml0aW9uLiBUaGlzIHNhdmVzIHVzIGZyb20gaGF2aW5nCiAgLy8gdG8gcmV3cml0ZSBhbGwgdGhlIGxvZ2ljIGluIHRoaXMgZmlsZSB0byBhY2NvbW9kYXRlIGJvdGgKICAvLyB0eXBlcyBvZiBkZWZpbml0aW9ucy4KICBmdW5jdGlvbiBjcmVhdGVMZWdhY3lEZWZpbml0aW9uQWRhcHRlcihkZWZuKSB7CiAgICB2YXIgcmVzdWx0ID0gewogICAgICBuYW1lOiBkZWZuLm5hbWUsCiAgICAgIHR5cGU6IGRlZm4udHlwZSwKICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICByZXR1cm4gZGVmbi5mYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgfSwKICAgICAgcmVuZGVyVmFsdWU6IGZ1bmN0aW9uKGVsLCB4LCBpbnN0YW5jZSkgewogICAgICAgIHJldHVybiBpbnN0YW5jZS5yZW5kZXJWYWx1ZSh4KTsKICAgICAgfSwKICAgICAgcmVzaXplOiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCwgaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVzaXplKHdpZHRoLCBoZWlnaHQpOwogICAgICB9CiAgICB9OwoKICAgIGlmIChkZWZuLmZpbmQpCiAgICAgIHJlc3VsdC5maW5kID0gZGVmbi5maW5kOwogICAgaWYgKGRlZm4ucmVuZGVyRXJyb3IpCiAgICAgIHJlc3VsdC5yZW5kZXJFcnJvciA9IGRlZm4ucmVuZGVyRXJyb3I7CiAgICBpZiAoZGVmbi5jbGVhckVycm9yKQogICAgICByZXN1bHQuY2xlYXJFcnJvciA9IGRlZm4uY2xlYXJFcnJvcjsKCiAgICByZXR1cm4gcmVzdWx0OwogIH0KfSkoKTsKCg=="></script>
<script src="data:application/x-javascript;base64,IWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtyZXR1cm4gbiYmKG4ub3duZXJEb2N1bWVudHx8bi5kb2N1bWVudHx8bikuZG9jdW1lbnRFbGVtZW50fWZ1bmN0aW9uIHQobil7cmV0dXJuIG4mJihuLm93bmVyRG9jdW1lbnQmJm4ub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlld3x8bi5kb2N1bWVudCYmbnx8bi5kZWZhdWx0Vmlldyl9ZnVuY3Rpb24gZShuLHQpe3JldHVybiB0Pm4/LTE6bj50PzE6bj49dD8wOk5hTn1mdW5jdGlvbiByKG4pe3JldHVybiBudWxsPT09bj9OYU46K259ZnVuY3Rpb24gdShuKXtyZXR1cm4haXNOYU4obil9ZnVuY3Rpb24gaShuKXtyZXR1cm57bGVmdDpmdW5jdGlvbih0LGUscix1KXtmb3IoYXJndW1lbnRzLmxlbmd0aDwzJiYocj0wKSxhcmd1bWVudHMubGVuZ3RoPDQmJih1PXQubGVuZ3RoKTt1PnI7KXt2YXIgaT1yK3U+Pj4xO24odFtpXSxlKTwwP3I9aSsxOnU9aX1yZXR1cm4gcn0scmlnaHQ6ZnVuY3Rpb24odCxlLHIsdSl7Zm9yKGFyZ3VtZW50cy5sZW5ndGg8MyYmKHI9MCksYXJndW1lbnRzLmxlbmd0aDw0JiYodT10Lmxlbmd0aCk7dT5yOyl7dmFyIGk9cit1Pj4+MTtuKHRbaV0sZSk+MD91PWk6cj1pKzF9cmV0dXJuIHJ9fX1mdW5jdGlvbiBhKG4pe3JldHVybiBuLmxlbmd0aH1mdW5jdGlvbiBvKG4pe2Zvcih2YXIgdD0xO24qdCUxOyl0Kj0xMDtyZXR1cm4gdH1mdW5jdGlvbiBsKG4sdCl7Zm9yKHZhciBlIGluIHQpT2JqZWN0LmRlZmluZVByb3BlcnR5KG4ucHJvdG90eXBlLGUse3ZhbHVlOnRbZV0sZW51bWVyYWJsZTohMX0pfWZ1bmN0aW9uIGMoKXt0aGlzLl89T2JqZWN0LmNyZWF0ZShudWxsKX1mdW5jdGlvbiBzKG4pe3JldHVybihuKz0iIik9PT14YXx8blswXT09PWJhP2JhK246bn1mdW5jdGlvbiBmKG4pe3JldHVybihuKz0iIilbMF09PT1iYT9uLnNsaWNlKDEpOm59ZnVuY3Rpb24gaChuKXtyZXR1cm4gcyhuKWluIHRoaXMuX31mdW5jdGlvbiBnKG4pe3JldHVybihuPXMobikpaW4gdGhpcy5fJiZkZWxldGUgdGhpcy5fW25dfWZ1bmN0aW9uIHAoKXt2YXIgbj1bXTtmb3IodmFyIHQgaW4gdGhpcy5fKW4ucHVzaChmKHQpKTtyZXR1cm4gbn1mdW5jdGlvbiB2KCl7dmFyIG49MDtmb3IodmFyIHQgaW4gdGhpcy5fKSsrbjtyZXR1cm4gbn1mdW5jdGlvbiBkKCl7Zm9yKHZhciBuIGluIHRoaXMuXylyZXR1cm4hMTtyZXR1cm4hMH1mdW5jdGlvbiBtKCl7dGhpcy5fPU9iamVjdC5jcmVhdGUobnVsbCl9ZnVuY3Rpb24geShuKXtyZXR1cm4gbn1mdW5jdGlvbiBNKG4sdCxlKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgcj1lLmFwcGx5KHQsYXJndW1lbnRzKTtyZXR1cm4gcj09PXQ/bjpyfX1mdW5jdGlvbiB4KG4sdCl7aWYodCBpbiBuKXJldHVybiB0O3Q9dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0LnNsaWNlKDEpO2Zvcih2YXIgZT0wLHI9X2EubGVuZ3RoO3I+ZTsrK2Upe3ZhciB1PV9hW2VdK3Q7aWYodSBpbiBuKXJldHVybiB1fX1mdW5jdGlvbiBiKCl7fWZ1bmN0aW9uIF8oKXt9ZnVuY3Rpb24gdyhuKXtmdW5jdGlvbiB0KCl7Zm9yKHZhciB0LHI9ZSx1PS0xLGk9ci5sZW5ndGg7Kyt1PGk7KSh0PXJbdV0ub24pJiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbn12YXIgZT1bXSxyPW5ldyBjO3JldHVybiB0Lm9uPWZ1bmN0aW9uKHQsdSl7dmFyIGksYT1yLmdldCh0KTtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyP2EmJmEub246KGEmJihhLm9uPW51bGwsZT1lLnNsaWNlKDAsaT1lLmluZGV4T2YoYSkpLmNvbmNhdChlLnNsaWNlKGkrMSkpLHIucmVtb3ZlKHQpKSx1JiZlLnB1c2goci5zZXQodCx7b246dX0pKSxuKX0sdH1mdW5jdGlvbiBTKCl7b2EuZXZlbnQucHJldmVudERlZmF1bHQoKX1mdW5jdGlvbiBrKCl7Zm9yKHZhciBuLHQ9b2EuZXZlbnQ7bj10LnNvdXJjZUV2ZW50Oyl0PW47cmV0dXJuIHR9ZnVuY3Rpb24gTihuKXtmb3IodmFyIHQ9bmV3IF8sZT0wLHI9YXJndW1lbnRzLmxlbmd0aDsrK2U8cjspdFthcmd1bWVudHNbZV1dPXcodCk7cmV0dXJuIHQub2Y9ZnVuY3Rpb24oZSxyKXtyZXR1cm4gZnVuY3Rpb24odSl7dHJ5e3ZhciBpPXUuc291cmNlRXZlbnQ9b2EuZXZlbnQ7dS50YXJnZXQ9bixvYS5ldmVudD11LHRbdS50eXBlXS5hcHBseShlLHIpfWZpbmFsbHl7b2EuZXZlbnQ9aX19fSx0fWZ1bmN0aW9uIEUobil7cmV0dXJuIFNhKG4sQWEpLG59ZnVuY3Rpb24gQShuKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOmZ1bmN0aW9uKCl7cmV0dXJuIGthKG4sdGhpcyl9fWZ1bmN0aW9uIEMobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBOYShuLHRoaXMpfX1mdW5jdGlvbiB6KG4sdCl7ZnVuY3Rpb24gZSgpe3RoaXMucmVtb3ZlQXR0cmlidXRlKG4pfWZ1bmN0aW9uIHIoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCl9ZnVuY3Rpb24gdSgpe3RoaXMuc2V0QXR0cmlidXRlKG4sdCl9ZnVuY3Rpb24gaSgpe3RoaXMuc2V0QXR0cmlidXRlTlMobi5zcGFjZSxuLmxvY2FsLHQpfWZ1bmN0aW9uIGEoKXt2YXIgZT10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtudWxsPT1lP3RoaXMucmVtb3ZlQXR0cmlidXRlKG4pOnRoaXMuc2V0QXR0cmlidXRlKG4sZSl9ZnVuY3Rpb24gbygpe3ZhciBlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PWU/dGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpOnRoaXMuc2V0QXR0cmlidXRlTlMobi5zcGFjZSxuLmxvY2FsLGUpfXJldHVybiBuPW9hLm5zLnF1YWxpZnkobiksbnVsbD09dD9uLmxvY2FsP3I6ZToiZnVuY3Rpb24iPT10eXBlb2YgdD9uLmxvY2FsP286YTpuLmxvY2FsP2k6dX1mdW5jdGlvbiBMKG4pe3JldHVybiBuLnRyaW0oKS5yZXBsYWNlKC9ccysvZywiICIpfWZ1bmN0aW9uIHEobil7cmV0dXJuIG5ldyBSZWdFeHAoIig/Ol58XFxzKykiK29hLnJlcXVvdGUobikrIig/Olxccyt8JCkiLCJnIil9ZnVuY3Rpb24gVChuKXtyZXR1cm4obisiIikudHJpbSgpLnNwbGl0KC9efFxzKy8pfWZ1bmN0aW9uIFIobix0KXtmdW5jdGlvbiBlKCl7Zm9yKHZhciBlPS0xOysrZTx1OyluW2VdKHRoaXMsdCl9ZnVuY3Rpb24gcigpe2Zvcih2YXIgZT0tMSxyPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpOysrZTx1OyluW2VdKHRoaXMscil9bj1UKG4pLm1hcChEKTt2YXIgdT1uLmxlbmd0aDtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdD9yOmV9ZnVuY3Rpb24gRChuKXt2YXIgdD1xKG4pO3JldHVybiBmdW5jdGlvbihlLHIpe2lmKHU9ZS5jbGFzc0xpc3QpcmV0dXJuIHI/dS5hZGQobik6dS5yZW1vdmUobik7dmFyIHU9ZS5nZXRBdHRyaWJ1dGUoImNsYXNzIil8fCIiO3I/KHQubGFzdEluZGV4PTAsdC50ZXN0KHUpfHxlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLEwodSsiICIrbikpKTplLnNldEF0dHJpYnV0ZSgiY2xhc3MiLEwodS5yZXBsYWNlKHQsIiAiKSkpfX1mdW5jdGlvbiBQKG4sdCxlKXtmdW5jdGlvbiByKCl7dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKX1mdW5jdGlvbiB1KCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLHQsZSl9ZnVuY3Rpb24gaSgpe3ZhciByPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PXI/dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKTp0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4scixlKX1yZXR1cm4gbnVsbD09dD9yOiJmdW5jdGlvbiI9PXR5cGVvZiB0P2k6dX1mdW5jdGlvbiBVKG4sdCl7ZnVuY3Rpb24gZSgpe2RlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIHIoKXt0aGlzW25dPXR9ZnVuY3Rpb24gdSgpe3ZhciBlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PWU/ZGVsZXRlIHRoaXNbbl06dGhpc1tuXT1lfXJldHVybiBudWxsPT10P2U6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dTpyfWZ1bmN0aW9uIGoobil7ZnVuY3Rpb24gdCgpe3ZhciB0PXRoaXMub3duZXJEb2N1bWVudCxlPXRoaXMubmFtZXNwYWNlVVJJO3JldHVybiBlJiZlIT09dC5kb2N1bWVudEVsZW1lbnQubmFtZXNwYWNlVVJJP3QuY3JlYXRlRWxlbWVudE5TKGUsbik6dC5jcmVhdGVFbGVtZW50KG4pfWZ1bmN0aW9uIGUoKXtyZXR1cm4gdGhpcy5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuLnNwYWNlLG4ubG9jYWwpfXJldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBuP246KG49b2EubnMucXVhbGlmeShuKSkubG9jYWw/ZTp0fWZ1bmN0aW9uIEYoKXt2YXIgbj10aGlzLnBhcmVudE5vZGU7biYmbi5yZW1vdmVDaGlsZCh0aGlzKX1mdW5jdGlvbiBIKG4pe3JldHVybntfX2RhdGFfXzpufX1mdW5jdGlvbiBPKG4pe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBFYSh0aGlzLG4pfX1mdW5jdGlvbiBJKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RofHwobj1lKSxmdW5jdGlvbih0LGUpe3JldHVybiB0JiZlP24odC5fX2RhdGFfXyxlLl9fZGF0YV9fKTohdC0hZX19ZnVuY3Rpb24gWShuLHQpe2Zvcih2YXIgZT0wLHI9bi5sZW5ndGg7cj5lO2UrKylmb3IodmFyIHUsaT1uW2VdLGE9MCxvPWkubGVuZ3RoO28+YTthKyspKHU9aVthXSkmJnQodSxhLGUpO3JldHVybiBufWZ1bmN0aW9uIFoobil7cmV0dXJuIFNhKG4semEpLG59ZnVuY3Rpb24gVihuKXt2YXIgdCxlO3JldHVybiBmdW5jdGlvbihyLHUsaSl7dmFyIGEsbz1uW2ldLnVwZGF0ZSxsPW8ubGVuZ3RoO2ZvcihpIT1lJiYoZT1pLHQ9MCksdT49dCYmKHQ9dSsxKTshKGE9b1t0XSkmJisrdDxsOyk7cmV0dXJuIGF9fWZ1bmN0aW9uIFgobix0LGUpe2Z1bmN0aW9uIHIoKXt2YXIgdD10aGlzW2FdO3QmJih0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIobix0LHQuJCksZGVsZXRlIHRoaXNbYV0pfWZ1bmN0aW9uIHUoKXt2YXIgdT1sKHQsY2EoYXJndW1lbnRzKSk7ci5jYWxsKHRoaXMpLHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihuLHRoaXNbYV09dSx1LiQ9ZSksdS5fPXR9ZnVuY3Rpb24gaSgpe3ZhciB0LGU9bmV3IFJlZ0V4cCgiXl9fb24oW14uXSspIitvYS5yZXF1b3RlKG4pKyIkIik7Zm9yKHZhciByIGluIHRoaXMpaWYodD1yLm1hdGNoKGUpKXt2YXIgdT10aGlzW3JdO3RoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcih0WzFdLHUsdS4kKSxkZWxldGUgdGhpc1tyXX19dmFyIGE9Il9fb24iK24sbz1uLmluZGV4T2YoIi4iKSxsPSQ7bz4wJiYobj1uLnNsaWNlKDAsbykpO3ZhciBjPUxhLmdldChuKTtyZXR1cm4gYyYmKG49YyxsPUIpLG8/dD91OnI6dD9iOml9ZnVuY3Rpb24gJChuLHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgcj1vYS5ldmVudDtvYS5ldmVudD1lLHRbMF09dGhpcy5fX2RhdGFfXzt0cnl7bi5hcHBseSh0aGlzLHQpfWZpbmFsbHl7b2EuZXZlbnQ9cn19fWZ1bmN0aW9uIEIobix0KXt2YXIgZT0kKG4sdCk7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciB0PXRoaXMscj1uLnJlbGF0ZWRUYXJnZXQ7ciYmKHI9PT10fHw4JnIuY29tcGFyZURvY3VtZW50UG9zaXRpb24odCkpfHxlLmNhbGwodCxuKX19ZnVuY3Rpb24gVyhlKXt2YXIgcj0iLmRyYWdzdXBwcmVzcy0iKyArK1RhLHU9ImNsaWNrIityLGk9b2Euc2VsZWN0KHQoZSkpLm9uKCJ0b3VjaG1vdmUiK3IsUykub24oImRyYWdzdGFydCIrcixTKS5vbigic2VsZWN0c3RhcnQiK3IsUyk7aWYobnVsbD09cWEmJihxYT0ib25zZWxlY3RzdGFydCJpbiBlPyExOngoZS5zdHlsZSwidXNlclNlbGVjdCIpKSxxYSl7dmFyIGE9bihlKS5zdHlsZSxvPWFbcWFdO2FbcWFdPSJub25lIn1yZXR1cm4gZnVuY3Rpb24obil7aWYoaS5vbihyLG51bGwpLHFhJiYoYVtxYV09byksbil7dmFyIHQ9ZnVuY3Rpb24oKXtpLm9uKHUsbnVsbCl9O2kub24odSxmdW5jdGlvbigpe1MoKSx0KCl9LCEwKSxzZXRUaW1lb3V0KHQsMCl9fX1mdW5jdGlvbiBKKG4sZSl7ZS5jaGFuZ2VkVG91Y2hlcyYmKGU9ZS5jaGFuZ2VkVG91Y2hlc1swXSk7dmFyIHI9bi5vd25lclNWR0VsZW1lbnR8fG47aWYoci5jcmVhdGVTVkdQb2ludCl7dmFyIHU9ci5jcmVhdGVTVkdQb2ludCgpO2lmKDA+UmEpe3ZhciBpPXQobik7aWYoaS5zY3JvbGxYfHxpLnNjcm9sbFkpe3I9b2Euc2VsZWN0KCJib2R5IikuYXBwZW5kKCJzdmciKS5zdHlsZSh7cG9zaXRpb246ImFic29sdXRlIix0b3A6MCxsZWZ0OjAsbWFyZ2luOjAscGFkZGluZzowLGJvcmRlcjoibm9uZSJ9LCJpbXBvcnRhbnQiKTt2YXIgYT1yWzBdWzBdLmdldFNjcmVlbkNUTSgpO1JhPSEoYS5mfHxhLmUpLHIucmVtb3ZlKCl9fXJldHVybiBSYT8odS54PWUucGFnZVgsdS55PWUucGFnZVkpOih1Lng9ZS5jbGllbnRYLHUueT1lLmNsaWVudFkpLHU9dS5tYXRyaXhUcmFuc2Zvcm0obi5nZXRTY3JlZW5DVE0oKS5pbnZlcnNlKCkpLFt1LngsdS55XX12YXIgbz1uLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO3JldHVybltlLmNsaWVudFgtby5sZWZ0LW4uY2xpZW50TGVmdCxlLmNsaWVudFktby50b3Atbi5jbGllbnRUb3BdfWZ1bmN0aW9uIEcoKXtyZXR1cm4gb2EuZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllcn1mdW5jdGlvbiBLKG4pe3JldHVybiBuPjA/MTowPm4/LTE6MH1mdW5jdGlvbiBRKG4sdCxlKXtyZXR1cm4odFswXS1uWzBdKSooZVsxXS1uWzFdKS0odFsxXS1uWzFdKSooZVswXS1uWzBdKX1mdW5jdGlvbiBubihuKXtyZXR1cm4gbj4xPzA6LTE+bj9VYTpNYXRoLmFjb3Mobil9ZnVuY3Rpb24gdG4obil7cmV0dXJuIG4+MT9IYTotMT5uPy1IYTpNYXRoLmFzaW4obil9ZnVuY3Rpb24gZW4obil7cmV0dXJuKChuPU1hdGguZXhwKG4pKS0xL24pLzJ9ZnVuY3Rpb24gcm4obil7cmV0dXJuKChuPU1hdGguZXhwKG4pKSsxL24pLzJ9ZnVuY3Rpb24gdW4obil7cmV0dXJuKChuPU1hdGguZXhwKDIqbikpLTEpLyhuKzEpfWZ1bmN0aW9uIGFuKG4pe3JldHVybihuPU1hdGguc2luKG4vMikpKm59ZnVuY3Rpb24gb24oKXt9ZnVuY3Rpb24gbG4obix0LGUpe3JldHVybiB0aGlzIGluc3RhbmNlb2YgbG4/KHRoaXMuaD0rbix0aGlzLnM9K3Qsdm9pZCh0aGlzLmw9K2UpKTphcmd1bWVudHMubGVuZ3RoPDI/biBpbnN0YW5jZW9mIGxuP25ldyBsbihuLmgsbi5zLG4ubCk6X24oIiIrbix3bixsbik6bmV3IGxuKG4sdCxlKX1mdW5jdGlvbiBjbihuLHQsZSl7ZnVuY3Rpb24gcihuKXtyZXR1cm4gbj4zNjA/bi09MzYwOjA+biYmKG4rPTM2MCksNjA+bj9pKyhhLWkpKm4vNjA6MTgwPm4/YToyNDA+bj9pKyhhLWkpKigyNDAtbikvNjA6aX1mdW5jdGlvbiB1KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSpyKG4pKX12YXIgaSxhO3JldHVybiBuPWlzTmFOKG4pPzA6KG4lPTM2MCk8MD9uKzM2MDpuLHQ9aXNOYU4odCk/MDowPnQ/MDp0PjE/MTp0LGU9MD5lPzA6ZT4xPzE6ZSxhPS41Pj1lP2UqKDErdCk6ZSt0LWUqdCxpPTIqZS1hLG5ldyB5bih1KG4rMTIwKSx1KG4pLHUobi0xMjApKX1mdW5jdGlvbiBzbihuLHQsZSl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBzbj8odGhpcy5oPStuLHRoaXMuYz0rdCx2b2lkKHRoaXMubD0rZSkpOmFyZ3VtZW50cy5sZW5ndGg8Mj9uIGluc3RhbmNlb2Ygc24/bmV3IHNuKG4uaCxuLmMsbi5sKTpuIGluc3RhbmNlb2YgaG4/cG4obi5sLG4uYSxuLmIpOnBuKChuPVNuKChuPW9hLnJnYihuKSkucixuLmcsbi5iKSkubCxuLmEsbi5iKTpuZXcgc24obix0LGUpfWZ1bmN0aW9uIGZuKG4sdCxlKXtyZXR1cm4gaXNOYU4obikmJihuPTApLGlzTmFOKHQpJiYodD0wKSxuZXcgaG4oZSxNYXRoLmNvcyhuKj1PYSkqdCxNYXRoLnNpbihuKSp0KX1mdW5jdGlvbiBobihuLHQsZSl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBobj8odGhpcy5sPStuLHRoaXMuYT0rdCx2b2lkKHRoaXMuYj0rZSkpOmFyZ3VtZW50cy5sZW5ndGg8Mj9uIGluc3RhbmNlb2YgaG4/bmV3IGhuKG4ubCxuLmEsbi5iKTpuIGluc3RhbmNlb2Ygc24/Zm4obi5oLG4uYyxuLmwpOlNuKChuPXluKG4pKS5yLG4uZyxuLmIpOm5ldyBobihuLHQsZSl9ZnVuY3Rpb24gZ24obix0LGUpe3ZhciByPShuKzE2KS8xMTYsdT1yK3QvNTAwLGk9ci1lLzIwMDtyZXR1cm4gdT12bih1KSpLYSxyPXZuKHIpKlFhLGk9dm4oaSkqbm8sbmV3IHluKG1uKDMuMjQwNDU0Mip1LTEuNTM3MTM4NSpyLS40OTg1MzE0KmkpLG1uKC0uOTY5MjY2KnUrMS44NzYwMTA4KnIrLjA0MTU1NippKSxtbiguMDU1NjQzNCp1LS4yMDQwMjU5KnIrMS4wNTcyMjUyKmkpKX1mdW5jdGlvbiBwbihuLHQsZSl7cmV0dXJuIG4+MD9uZXcgc24oTWF0aC5hdGFuMihlLHQpKklhLE1hdGguc3FydCh0KnQrZSplKSxuKTpuZXcgc24oTmFOLE5hTixuKX1mdW5jdGlvbiB2bihuKXtyZXR1cm4gbj4uMjA2ODkzMDM0P24qbipuOihuLTQvMjkpLzcuNzg3MDM3fWZ1bmN0aW9uIGRuKG4pe3JldHVybiBuPi4wMDg4NTY/TWF0aC5wb3cobiwxLzMpOjcuNzg3MDM3Km4rNC8yOX1mdW5jdGlvbiBtbihuKXtyZXR1cm4gTWF0aC5yb3VuZCgyNTUqKC4wMDMwND49bj8xMi45MipuOjEuMDU1Kk1hdGgucG93KG4sMS8yLjQpLS4wNTUpKX1mdW5jdGlvbiB5bihuLHQsZSl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiB5bj8odGhpcy5yPX5+bix0aGlzLmc9fn50LHZvaWQodGhpcy5iPX5+ZSkpOmFyZ3VtZW50cy5sZW5ndGg8Mj9uIGluc3RhbmNlb2YgeW4/bmV3IHluKG4ucixuLmcsbi5iKTpfbigiIituLHluLGNuKTpuZXcgeW4obix0LGUpfWZ1bmN0aW9uIE1uKG4pe3JldHVybiBuZXcgeW4obj4+MTYsbj4+OCYyNTUsMjU1Jm4pfWZ1bmN0aW9uIHhuKG4pe3JldHVybiBNbihuKSsiIn1mdW5jdGlvbiBibihuKXtyZXR1cm4gMTY+bj8iMCIrTWF0aC5tYXgoMCxuKS50b1N0cmluZygxNik6TWF0aC5taW4oMjU1LG4pLnRvU3RyaW5nKDE2KX1mdW5jdGlvbiBfbihuLHQsZSl7dmFyIHIsdSxpLGE9MCxvPTAsbD0wO2lmKHI9LyhbYS16XSspXCgoLiopXCkvLmV4ZWMobj1uLnRvTG93ZXJDYXNlKCkpKXN3aXRjaCh1PXJbMl0uc3BsaXQoIiwiKSxyWzFdKXtjYXNlImhzbCI6cmV0dXJuIGUocGFyc2VGbG9hdCh1WzBdKSxwYXJzZUZsb2F0KHVbMV0pLzEwMCxwYXJzZUZsb2F0KHVbMl0pLzEwMCk7Y2FzZSJyZ2IiOnJldHVybiB0KE5uKHVbMF0pLE5uKHVbMV0pLE5uKHVbMl0pKX1yZXR1cm4oaT1yby5nZXQobikpP3QoaS5yLGkuZyxpLmIpOihudWxsPT1ufHwiIyIhPT1uLmNoYXJBdCgwKXx8aXNOYU4oaT1wYXJzZUludChuLnNsaWNlKDEpLDE2KSl8fCg0PT09bi5sZW5ndGg/KGE9KDM4NDAmaSk+PjQsYT1hPj40fGEsbz0yNDAmaSxvPW8+PjR8byxsPTE1JmksbD1sPDw0fGwpOjc9PT1uLmxlbmd0aCYmKGE9KDE2NzExNjgwJmkpPj4xNixvPSg2NTI4MCZpKT4+OCxsPTI1NSZpKSksdChhLG8sbCkpfWZ1bmN0aW9uIHduKG4sdCxlKXt2YXIgcix1LGk9TWF0aC5taW4obi89MjU1LHQvPTI1NSxlLz0yNTUpLGE9TWF0aC5tYXgobix0LGUpLG89YS1pLGw9KGEraSkvMjtyZXR1cm4gbz8odT0uNT5sP28vKGEraSk6by8oMi1hLWkpLHI9bj09YT8odC1lKS9vKyhlPnQ/NjowKTp0PT1hPyhlLW4pL28rMjoobi10KS9vKzQscio9NjApOihyPU5hTix1PWw+MCYmMT5sPzA6ciksbmV3IGxuKHIsdSxsKX1mdW5jdGlvbiBTbihuLHQsZSl7bj1rbihuKSx0PWtuKHQpLGU9a24oZSk7dmFyIHI9ZG4oKC40MTI0NTY0Km4rLjM1NzU3NjEqdCsuMTgwNDM3NSplKS9LYSksdT1kbigoLjIxMjY3MjkqbisuNzE1MTUyMip0Ky4wNzIxNzUqZSkvUWEpLGk9ZG4oKC4wMTkzMzM5Km4rLjExOTE5Mip0Ky45NTAzMDQxKmUpL25vKTtyZXR1cm4gaG4oMTE2KnUtMTYsNTAwKihyLXUpLDIwMCoodS1pKSl9ZnVuY3Rpb24ga24obil7cmV0dXJuKG4vPTI1NSk8PS4wNDA0NT9uLzEyLjkyOk1hdGgucG93KChuKy4wNTUpLzEuMDU1LDIuNCl9ZnVuY3Rpb24gTm4obil7dmFyIHQ9cGFyc2VGbG9hdChuKTtyZXR1cm4iJSI9PT1uLmNoYXJBdChuLmxlbmd0aC0xKT9NYXRoLnJvdW5kKDIuNTUqdCk6dH1mdW5jdGlvbiBFbihuKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOmZ1bmN0aW9uKCl7cmV0dXJuIG59fWZ1bmN0aW9uIEFuKG4pe3JldHVybiBmdW5jdGlvbih0LGUscil7cmV0dXJuIDI9PT1hcmd1bWVudHMubGVuZ3RoJiYiZnVuY3Rpb24iPT10eXBlb2YgZSYmKHI9ZSxlPW51bGwpLENuKHQsZSxuLHIpfX1mdW5jdGlvbiBDbihuLHQsZSxyKXtmdW5jdGlvbiB1KCl7dmFyIG4sdD1sLnN0YXR1cztpZighdCYmTG4obCl8fHQ+PTIwMCYmMzAwPnR8fDMwND09PXQpe3RyeXtuPWUuY2FsbChpLGwpfWNhdGNoKHIpe3JldHVybiB2b2lkIGEuZXJyb3IuY2FsbChpLHIpfWEubG9hZC5jYWxsKGksbil9ZWxzZSBhLmVycm9yLmNhbGwoaSxsKX12YXIgaT17fSxhPW9hLmRpc3BhdGNoKCJiZWZvcmVzZW5kIiwicHJvZ3Jlc3MiLCJsb2FkIiwiZXJyb3IiKSxvPXt9LGw9bmV3IFhNTEh0dHBSZXF1ZXN0LGM9bnVsbDtyZXR1cm4hdGhpcy5YRG9tYWluUmVxdWVzdHx8IndpdGhDcmVkZW50aWFscyJpbiBsfHwhL14oaHR0cChzKT86KT9cL1wvLy50ZXN0KG4pfHwobD1uZXcgWERvbWFpblJlcXVlc3QpLCJvbmxvYWQiaW4gbD9sLm9ubG9hZD1sLm9uZXJyb3I9dTpsLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2wucmVhZHlTdGF0ZT4zJiZ1KCl9LGwub25wcm9ncmVzcz1mdW5jdGlvbihuKXt2YXIgdD1vYS5ldmVudDtvYS5ldmVudD1uO3RyeXthLnByb2dyZXNzLmNhbGwoaSxsKX1maW5hbGx5e29hLmV2ZW50PXR9fSxpLmhlYWRlcj1mdW5jdGlvbihuLHQpe3JldHVybiBuPShuKyIiKS50b0xvd2VyQ2FzZSgpLGFyZ3VtZW50cy5sZW5ndGg8Mj9vW25dOihudWxsPT10P2RlbGV0ZSBvW25dOm9bbl09dCsiIixpKX0saS5taW1lVHlwZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1udWxsPT1uP251bGw6bisiIixpKTp0fSxpLnJlc3BvbnNlVHlwZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz1uLGkpOmN9LGkucmVzcG9uc2U9ZnVuY3Rpb24obil7cmV0dXJuIGU9bixpfSxbImdldCIsInBvc3QiXS5mb3JFYWNoKGZ1bmN0aW9uKG4pe2lbbl09ZnVuY3Rpb24oKXtyZXR1cm4gaS5zZW5kLmFwcGx5KGksW25dLmNvbmNhdChjYShhcmd1bWVudHMpKSl9fSksaS5zZW5kPWZ1bmN0aW9uKGUscix1KXtpZigyPT09YXJndW1lbnRzLmxlbmd0aCYmImZ1bmN0aW9uIj09dHlwZW9mIHImJih1PXIscj1udWxsKSxsLm9wZW4oZSxuLCEwKSxudWxsPT10fHwiYWNjZXB0ImluIG98fChvLmFjY2VwdD10KyIsKi8qIiksbC5zZXRSZXF1ZXN0SGVhZGVyKWZvcih2YXIgcyBpbiBvKWwuc2V0UmVxdWVzdEhlYWRlcihzLG9bc10pO3JldHVybiBudWxsIT10JiZsLm92ZXJyaWRlTWltZVR5cGUmJmwub3ZlcnJpZGVNaW1lVHlwZSh0KSxudWxsIT1jJiYobC5yZXNwb25zZVR5cGU9YyksbnVsbCE9dSYmaS5vbigiZXJyb3IiLHUpLm9uKCJsb2FkIixmdW5jdGlvbihuKXt1KG51bGwsbil9KSxhLmJlZm9yZXNlbmQuY2FsbChpLGwpLGwuc2VuZChudWxsPT1yP251bGw6ciksaX0saS5hYm9ydD1mdW5jdGlvbigpe3JldHVybiBsLmFib3J0KCksaX0sb2EucmViaW5kKGksYSwib24iKSxudWxsPT1yP2k6aS5nZXQoem4ocikpfWZ1bmN0aW9uIHpuKG4pe3JldHVybiAxPT09bi5sZW5ndGg/ZnVuY3Rpb24odCxlKXtuKG51bGw9PXQ/ZTpudWxsKX06bn1mdW5jdGlvbiBMbihuKXt2YXIgdD1uLnJlc3BvbnNlVHlwZTtyZXR1cm4gdCYmInRleHQiIT09dD9uLnJlc3BvbnNlOm4ucmVzcG9uc2VUZXh0fWZ1bmN0aW9uIHFuKG4sdCxlKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoOzI+ciYmKHQ9MCksMz5yJiYoZT1EYXRlLm5vdygpKTt2YXIgdT1lK3QsaT17YzpuLHQ6dSxuOm51bGx9O3JldHVybiBpbz9pby5uPWk6dW89aSxpbz1pLGFvfHwob289Y2xlYXJUaW1lb3V0KG9vKSxhbz0xLGxvKFRuKSksaX1mdW5jdGlvbiBUbigpe3ZhciBuPVJuKCksdD1EbigpLW47dD4yND8oaXNGaW5pdGUodCkmJihjbGVhclRpbWVvdXQob28pLG9vPXNldFRpbWVvdXQoVG4sdCkpLGFvPTApOihhbz0xLGxvKFRuKSl9ZnVuY3Rpb24gUm4oKXtmb3IodmFyIG49RGF0ZS5ub3coKSx0PXVvO3Q7KW4+PXQudCYmdC5jKG4tdC50KSYmKHQuYz1udWxsKSx0PXQubjtyZXR1cm4gbn1mdW5jdGlvbiBEbigpe2Zvcih2YXIgbix0PXVvLGU9MS8wO3Q7KXQuYz8odC50PGUmJihlPXQudCksdD0obj10KS5uKTp0PW4/bi5uPXQubjp1bz10Lm47cmV0dXJuIGlvPW4sZX1mdW5jdGlvbiBQbihuLHQpe3JldHVybiB0LShuP01hdGguY2VpbChNYXRoLmxvZyhuKS9NYXRoLkxOMTApOjEpfWZ1bmN0aW9uIFVuKG4sdCl7dmFyIGU9TWF0aC5wb3coMTAsMypNYSg4LXQpKTtyZXR1cm57c2NhbGU6dD44P2Z1bmN0aW9uKG4pe3JldHVybiBuL2V9OmZ1bmN0aW9uKG4pe3JldHVybiBuKmV9LHN5bWJvbDpufX1mdW5jdGlvbiBqbihuKXt2YXIgdD1uLmRlY2ltYWwsZT1uLnRob3VzYW5kcyxyPW4uZ3JvdXBpbmcsdT1uLmN1cnJlbmN5LGk9ciYmZT9mdW5jdGlvbihuLHQpe2Zvcih2YXIgdT1uLmxlbmd0aCxpPVtdLGE9MCxvPXJbMF0sbD0wO3U+MCYmbz4wJiYobCtvKzE+dCYmKG89TWF0aC5tYXgoMSx0LWwpKSxpLnB1c2gobi5zdWJzdHJpbmcodS09byx1K28pKSwhKChsKz1vKzEpPnQpKTspbz1yW2E9KGErMSklci5sZW5ndGhdO3JldHVybiBpLnJldmVyc2UoKS5qb2luKGUpfTp5O3JldHVybiBmdW5jdGlvbihuKXt2YXIgZT1zby5leGVjKG4pLHI9ZVsxXXx8IiAiLGE9ZVsyXXx8Ij4iLG89ZVszXXx8Ii0iLGw9ZVs0XXx8IiIsYz1lWzVdLHM9K2VbNl0sZj1lWzddLGg9ZVs4XSxnPWVbOV0scD0xLHY9IiIsZD0iIixtPSExLHk9ITA7c3dpdGNoKGgmJihoPStoLnN1YnN0cmluZygxKSksKGN8fCIwIj09PXImJiI9Ij09PWEpJiYoYz1yPSIwIixhPSI9IiksZyl7Y2FzZSJuIjpmPSEwLGc9ImciO2JyZWFrO2Nhc2UiJSI6cD0xMDAsZD0iJSIsZz0iZiI7YnJlYWs7Y2FzZSJwIjpwPTEwMCxkPSIlIixnPSJyIjticmVhaztjYXNlImIiOmNhc2UibyI6Y2FzZSJ4IjpjYXNlIlgiOiIjIj09PWwmJih2PSIwIitnLnRvTG93ZXJDYXNlKCkpO2Nhc2UiYyI6eT0hMTtjYXNlImQiOm09ITAsaD0wO2JyZWFrO2Nhc2UicyI6cD0tMSxnPSJyIn0iJCI9PT1sJiYodj11WzBdLGQ9dVsxXSksInIiIT1nfHxofHwoZz0iZyIpLG51bGwhPWgmJigiZyI9PWc/aD1NYXRoLm1heCgxLE1hdGgubWluKDIxLGgpKTooImUiPT1nfHwiZiI9PWcpJiYoaD1NYXRoLm1heCgwLE1hdGgubWluKDIwLGgpKSkpLGc9Zm8uZ2V0KGcpfHxGbjt2YXIgTT1jJiZmO3JldHVybiBmdW5jdGlvbihuKXt2YXIgZT1kO2lmKG0mJm4lMSlyZXR1cm4iIjt2YXIgdT0wPm58fDA9PT1uJiYwPjEvbj8obj0tbiwiLSIpOiItIj09PW8/IiI6bztpZigwPnApe3ZhciBsPW9hLmZvcm1hdFByZWZpeChuLGgpO249bC5zY2FsZShuKSxlPWwuc3ltYm9sK2R9ZWxzZSBuKj1wO249ZyhuLGgpO3ZhciB4LGIsXz1uLmxhc3RJbmRleE9mKCIuIik7aWYoMD5fKXt2YXIgdz15P24ubGFzdEluZGV4T2YoImUiKTotMTswPnc/KHg9bixiPSIiKTooeD1uLnN1YnN0cmluZygwLHcpLGI9bi5zdWJzdHJpbmcodykpfWVsc2UgeD1uLnN1YnN0cmluZygwLF8pLGI9dCtuLnN1YnN0cmluZyhfKzEpOyFjJiZmJiYoeD1pKHgsMS8wKSk7dmFyIFM9di5sZW5ndGgreC5sZW5ndGgrYi5sZW5ndGgrKE0/MDp1Lmxlbmd0aCksaz1zPlM/bmV3IEFycmF5KFM9cy1TKzEpLmpvaW4ocik6IiI7cmV0dXJuIE0mJih4PWkoayt4LGsubGVuZ3RoP3MtYi5sZW5ndGg6MS8wKSksdSs9dixuPXgrYiwoIjwiPT09YT91K24razoiPiI9PT1hP2srdStuOiJeIj09PWE/ay5zdWJzdHJpbmcoMCxTPj49MSkrdStuK2suc3Vic3RyaW5nKFMpOnUrKE0/bjprK24pKStlfX19ZnVuY3Rpb24gRm4obil7cmV0dXJuIG4rIiJ9ZnVuY3Rpb24gSG4oKXt0aGlzLl89bmV3IERhdGUoYXJndW1lbnRzLmxlbmd0aD4xP0RhdGUuVVRDLmFwcGx5KHRoaXMsYXJndW1lbnRzKTphcmd1bWVudHNbMF0pfWZ1bmN0aW9uIE9uKG4sdCxlKXtmdW5jdGlvbiByKHQpe3ZhciBlPW4odCkscj1pKGUsMSk7cmV0dXJuIHItdD50LWU/ZTpyfWZ1bmN0aW9uIHUoZSl7cmV0dXJuIHQoZT1uKG5ldyBnbyhlLTEpKSwxKSxlfWZ1bmN0aW9uIGkobixlKXtyZXR1cm4gdChuPW5ldyBnbygrbiksZSksbn1mdW5jdGlvbiBhKG4scixpKXt2YXIgYT11KG4pLG89W107aWYoaT4xKWZvcig7cj5hOyllKGEpJWl8fG8ucHVzaChuZXcgRGF0ZSgrYSkpLHQoYSwxKTtlbHNlIGZvcig7cj5hOylvLnB1c2gobmV3IERhdGUoK2EpKSx0KGEsMSk7cmV0dXJuIG99ZnVuY3Rpb24gbyhuLHQsZSl7dHJ5e2dvPUhuO3ZhciByPW5ldyBIbjtyZXR1cm4gci5fPW4sYShyLHQsZSl9ZmluYWxseXtnbz1EYXRlfX1uLmZsb29yPW4sbi5yb3VuZD1yLG4uY2VpbD11LG4ub2Zmc2V0PWksbi5yYW5nZT1hO3ZhciBsPW4udXRjPUluKG4pO3JldHVybiBsLmZsb29yPWwsbC5yb3VuZD1JbihyKSxsLmNlaWw9SW4odSksbC5vZmZzZXQ9SW4oaSksbC5yYW5nZT1vLG59ZnVuY3Rpb24gSW4obil7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7dHJ5e2dvPUhuO3ZhciByPW5ldyBIbjtyZXR1cm4gci5fPXQsbihyLGUpLl99ZmluYWxseXtnbz1EYXRlfX19ZnVuY3Rpb24gWW4obil7ZnVuY3Rpb24gdChuKXtmdW5jdGlvbiB0KHQpe2Zvcih2YXIgZSx1LGksYT1bXSxvPS0xLGw9MDsrK288cjspMzc9PT1uLmNoYXJDb2RlQXQobykmJihhLnB1c2gobi5zbGljZShsLG8pKSxudWxsIT0odT12b1tlPW4uY2hhckF0KCsrbyldKSYmKGU9bi5jaGFyQXQoKytvKSksKGk9QVtlXSkmJihlPWkodCxudWxsPT11PyJlIj09PWU/IiAiOiIwIjp1KSksYS5wdXNoKGUpLGw9bysxKTtyZXR1cm4gYS5wdXNoKG4uc2xpY2UobCxvKSksYS5qb2luKCIiKX12YXIgcj1uLmxlbmd0aDtyZXR1cm4gdC5wYXJzZT1mdW5jdGlvbih0KXt2YXIgcj17eToxOTAwLG06MCxkOjEsSDowLE06MCxTOjAsTDowLFo6bnVsbH0sdT1lKHIsbix0LDApO2lmKHUhPXQubGVuZ3RoKXJldHVybiBudWxsOyJwImluIHImJihyLkg9ci5IJTEyKzEyKnIucCk7dmFyIGk9bnVsbCE9ci5aJiZnbyE9PUhuLGE9bmV3KGk/SG46Z28pO3JldHVybiJqImluIHI/YS5zZXRGdWxsWWVhcihyLnksMCxyLmopOiJXImluIHJ8fCJVImluIHI/KCJ3ImluIHJ8fChyLnc9IlciaW4gcj8xOjApLGEuc2V0RnVsbFllYXIoci55LDAsMSksYS5zZXRGdWxsWWVhcihyLnksMCwiVyJpbiByPyhyLncrNiklNys3KnIuVy0oYS5nZXREYXkoKSs1KSU3OnIudys3KnIuVS0oYS5nZXREYXkoKSs2KSU3KSk6YS5zZXRGdWxsWWVhcihyLnksci5tLHIuZCksYS5zZXRIb3VycyhyLkgrKHIuWi8xMDB8MCksci5NK3IuWiUxMDAsci5TLHIuTCksaT9hLl86YX0sdC50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiBufSx0fWZ1bmN0aW9uIGUobix0LGUscil7Zm9yKHZhciB1LGksYSxvPTAsbD10Lmxlbmd0aCxjPWUubGVuZ3RoO2w+bzspe2lmKHI+PWMpcmV0dXJuLTE7aWYodT10LmNoYXJDb2RlQXQobysrKSwzNz09PXUpe2lmKGE9dC5jaGFyQXQobysrKSxpPUNbYSBpbiB2bz90LmNoYXJBdChvKyspOmFdLCFpfHwocj1pKG4sZSxyKSk8MClyZXR1cm4tMX1lbHNlIGlmKHUhPWUuY2hhckNvZGVBdChyKyspKXJldHVybi0xfXJldHVybiByfWZ1bmN0aW9uIHIobix0LGUpe18ubGFzdEluZGV4PTA7dmFyIHI9Xy5leGVjKHQuc2xpY2UoZSkpO3JldHVybiByPyhuLnc9dy5nZXQoclswXS50b0xvd2VyQ2FzZSgpKSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB1KG4sdCxlKXt4Lmxhc3RJbmRleD0wO3ZhciByPXguZXhlYyh0LnNsaWNlKGUpKTtyZXR1cm4gcj8obi53PWIuZ2V0KHJbMF0udG9Mb3dlckNhc2UoKSksZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gaShuLHQsZSl7Ti5sYXN0SW5kZXg9MDt2YXIgcj1OLmV4ZWModC5zbGljZShlKSk7cmV0dXJuIHI/KG4ubT1FLmdldChyWzBdLnRvTG93ZXJDYXNlKCkpLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGEobix0LGUpe1MubGFzdEluZGV4PTA7dmFyIHI9Uy5leGVjKHQuc2xpY2UoZSkpO3JldHVybiByPyhuLm09ay5nZXQoclswXS50b0xvd2VyQ2FzZSgpKSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBvKG4sdCxyKXtyZXR1cm4gZShuLEEuYy50b1N0cmluZygpLHQscil9ZnVuY3Rpb24gbChuLHQscil7cmV0dXJuIGUobixBLngudG9TdHJpbmcoKSx0LHIpfWZ1bmN0aW9uIGMobix0LHIpe3JldHVybiBlKG4sQS5YLnRvU3RyaW5nKCksdCxyKX1mdW5jdGlvbiBzKG4sdCxlKXt2YXIgcj1NLmdldCh0LnNsaWNlKGUsZSs9MikudG9Mb3dlckNhc2UoKSk7cmV0dXJuIG51bGw9PXI/LTE6KG4ucD1yLGUpfXZhciBmPW4uZGF0ZVRpbWUsaD1uLmRhdGUsZz1uLnRpbWUscD1uLnBlcmlvZHMsdj1uLmRheXMsZD1uLnNob3J0RGF5cyxtPW4ubW9udGhzLHk9bi5zaG9ydE1vbnRoczt0LnV0Yz1mdW5jdGlvbihuKXtmdW5jdGlvbiBlKG4pe3RyeXtnbz1Ibjt2YXIgdD1uZXcgZ287cmV0dXJuIHQuXz1uLHIodCl9ZmluYWxseXtnbz1EYXRlfX12YXIgcj10KG4pO3JldHVybiBlLnBhcnNlPWZ1bmN0aW9uKG4pe3RyeXtnbz1Ibjt2YXIgdD1yLnBhcnNlKG4pO3JldHVybiB0JiZ0Ll99ZmluYWxseXtnbz1EYXRlfX0sZS50b1N0cmluZz1yLnRvU3RyaW5nLGV9LHQubXVsdGk9dC51dGMubXVsdGk9Y3Q7dmFyIE09b2EubWFwKCkseD1Wbih2KSxiPVhuKHYpLF89Vm4oZCksdz1YbihkKSxTPVZuKG0pLGs9WG4obSksTj1Wbih5KSxFPVhuKHkpO3AuZm9yRWFjaChmdW5jdGlvbihuLHQpe00uc2V0KG4udG9Mb3dlckNhc2UoKSx0KX0pO3ZhciBBPXthOmZ1bmN0aW9uKG4pe3JldHVybiBkW24uZ2V0RGF5KCldfSxBOmZ1bmN0aW9uKG4pe3JldHVybiB2W24uZ2V0RGF5KCldfSxiOmZ1bmN0aW9uKG4pe3JldHVybiB5W24uZ2V0TW9udGgoKV19LEI6ZnVuY3Rpb24obil7cmV0dXJuIG1bbi5nZXRNb250aCgpXX0sYzp0KGYpLGQ6ZnVuY3Rpb24obix0KXtyZXR1cm4gWm4obi5nZXREYXRlKCksdCwyKX0sZTpmdW5jdGlvbihuLHQpe3JldHVybiBabihuLmdldERhdGUoKSx0LDIpfSxIOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0SG91cnMoKSx0LDIpfSxJOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0SG91cnMoKSUxMnx8MTIsdCwyKX0sajpmdW5jdGlvbihuLHQpe3JldHVybiBabigxK2hvLmRheU9mWWVhcihuKSx0LDMpfSxMOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0TWlsbGlzZWNvbmRzKCksdCwzKX0sbTpmdW5jdGlvbihuLHQpe3JldHVybiBabihuLmdldE1vbnRoKCkrMSx0LDIpfSxNOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0TWludXRlcygpLHQsMil9LHA6ZnVuY3Rpb24obil7cmV0dXJuIHBbKyhuLmdldEhvdXJzKCk+PTEyKV19LFM6ZnVuY3Rpb24obix0KXtyZXR1cm4gWm4obi5nZXRTZWNvbmRzKCksdCwyKX0sVTpmdW5jdGlvbihuLHQpe3JldHVybiBabihoby5zdW5kYXlPZlllYXIobiksdCwyKX0sdzpmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXREYXkoKX0sVzpmdW5jdGlvbihuLHQpe3JldHVybiBabihoby5tb25kYXlPZlllYXIobiksdCwyKX0seDp0KGgpLFg6dChnKSx5OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0RnVsbFllYXIoKSUxMDAsdCwyKX0sWTpmdW5jdGlvbihuLHQpe3JldHVybiBabihuLmdldEZ1bGxZZWFyKCklMWU0LHQsNCl9LFo6b3QsIiUiOmZ1bmN0aW9uKCl7cmV0dXJuIiUifX0sQz17YTpyLEE6dSxiOmksQjphLGM6byxkOnR0LGU6dHQsSDpydCxJOnJ0LGo6ZXQsTDphdCxtOm50LE06dXQscDpzLFM6aXQsVTpCbix3OiRuLFc6V24seDpsLFg6Yyx5OkduLFk6Sm4sWjpLbiwiJSI6bHR9O3JldHVybiB0fWZ1bmN0aW9uIFpuKG4sdCxlKXt2YXIgcj0wPm4/Ii0iOiIiLHU9KHI/LW46bikrIiIsaT11Lmxlbmd0aDtyZXR1cm4gcisoZT5pP25ldyBBcnJheShlLWkrMSkuam9pbih0KSt1OnUpfWZ1bmN0aW9uIFZuKG4pe3JldHVybiBuZXcgUmVnRXhwKCJeKD86IituLm1hcChvYS5yZXF1b3RlKS5qb2luKCJ8IikrIikiLCJpIil9ZnVuY3Rpb24gWG4obil7Zm9yKHZhciB0PW5ldyBjLGU9LTEscj1uLmxlbmd0aDsrK2U8cjspdC5zZXQobltlXS50b0xvd2VyQ2FzZSgpLGUpO3JldHVybiB0fWZ1bmN0aW9uICRuKG4sdCxlKXttby5sYXN0SW5kZXg9MDt2YXIgcj1tby5leGVjKHQuc2xpY2UoZSxlKzEpKTtyZXR1cm4gcj8obi53PStyWzBdLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIEJuKG4sdCxlKXttby5sYXN0SW5kZXg9MDt2YXIgcj1tby5leGVjKHQuc2xpY2UoZSkpO3JldHVybiByPyhuLlU9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gV24obix0LGUpe21vLmxhc3RJbmRleD0wO3ZhciByPW1vLmV4ZWModC5zbGljZShlKSk7cmV0dXJuIHI/KG4uVz0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBKbihuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSs0KSk7cmV0dXJuIHI/KG4ueT0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBHbihuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4ueT1RbigrclswXSksZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gS24obix0LGUpe3JldHVybi9eWystXVxkezR9JC8udGVzdCh0PXQuc2xpY2UoZSxlKzUpKT8obi5aPS10LGUrNSk6LTF9ZnVuY3Rpb24gUW4obil7cmV0dXJuIG4rKG4+Njg/MTkwMDoyZTMpfWZ1bmN0aW9uIG50KG4sdCxlKXttby5sYXN0SW5kZXg9MDt2YXIgcj1tby5leGVjKHQuc2xpY2UoZSxlKzIpKTtyZXR1cm4gcj8obi5tPXJbMF0tMSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB0dChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4uZD0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBldChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSszKSk7cmV0dXJuIHI/KG4uaj0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBydChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4uSD0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB1dChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4uTT0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBpdChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4uUz0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBhdChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSszKSk7cmV0dXJuIHI/KG4uTD0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBvdChuKXt2YXIgdD1uLmdldFRpbWV6b25lT2Zmc2V0KCksZT10PjA/Ii0iOiIrIixyPU1hKHQpLzYwfDAsdT1NYSh0KSU2MDtyZXR1cm4gZStabihyLCIwIiwyKStabih1LCIwIiwyKX1mdW5jdGlvbiBsdChuLHQsZSl7eW8ubGFzdEluZGV4PTA7dmFyIHI9eW8uZXhlYyh0LnNsaWNlKGUsZSsxKSk7cmV0dXJuIHI/ZStyWzBdLmxlbmd0aDotMX1mdW5jdGlvbiBjdChuKXtmb3IodmFyIHQ9bi5sZW5ndGgsZT0tMTsrK2U8dDspbltlXVswXT10aGlzKG5bZV1bMF0pO3JldHVybiBmdW5jdGlvbih0KXtmb3IodmFyIGU9MCxyPW5bZV07IXJbMV0odCk7KXI9blsrK2VdO3JldHVybiByWzBdKHQpfX1mdW5jdGlvbiBzdCgpe31mdW5jdGlvbiBmdChuLHQsZSl7dmFyIHI9ZS5zPW4rdCx1PXItbixpPXItdTtlLnQ9bi1pKyh0LXUpfWZ1bmN0aW9uIGh0KG4sdCl7biYmX28uaGFzT3duUHJvcGVydHkobi50eXBlKSYmX29bbi50eXBlXShuLHQpfWZ1bmN0aW9uIGd0KG4sdCxlKXt2YXIgcix1PS0xLGk9bi5sZW5ndGgtZTtmb3IodC5saW5lU3RhcnQoKTsrK3U8aTspcj1uW3VdLHQucG9pbnQoclswXSxyWzFdLHJbMl0pO3QubGluZUVuZCgpfWZ1bmN0aW9uIHB0KG4sdCl7dmFyIGU9LTEscj1uLmxlbmd0aDtmb3IodC5wb2x5Z29uU3RhcnQoKTsrK2U8cjspZ3QobltlXSx0LDEpO3QucG9seWdvbkVuZCgpfWZ1bmN0aW9uIHZ0KCl7ZnVuY3Rpb24gbihuLHQpe24qPU9hLHQ9dCpPYS8yK1VhLzQ7dmFyIGU9bi1yLGE9ZT49MD8xOi0xLG89YSplLGw9TWF0aC5jb3ModCksYz1NYXRoLnNpbih0KSxzPWkqYyxmPXUqbCtzKk1hdGguY29zKG8pLGg9cyphKk1hdGguc2luKG8pO1NvLmFkZChNYXRoLmF0YW4yKGgsZikpLHI9bix1PWwsaT1jfXZhciB0LGUscix1LGk7a28ucG9pbnQ9ZnVuY3Rpb24oYSxvKXtrby5wb2ludD1uLHI9KHQ9YSkqT2EsdT1NYXRoLmNvcyhvPShlPW8pKk9hLzIrVWEvNCksaT1NYXRoLnNpbihvKX0sa28ubGluZUVuZD1mdW5jdGlvbigpe24odCxlKX19ZnVuY3Rpb24gZHQobil7dmFyIHQ9blswXSxlPW5bMV0scj1NYXRoLmNvcyhlKTtyZXR1cm5bcipNYXRoLmNvcyh0KSxyKk1hdGguc2luKHQpLE1hdGguc2luKGUpXX1mdW5jdGlvbiBtdChuLHQpe3JldHVybiBuWzBdKnRbMF0rblsxXSp0WzFdK25bMl0qdFsyXX1mdW5jdGlvbiB5dChuLHQpe3JldHVybltuWzFdKnRbMl0tblsyXSp0WzFdLG5bMl0qdFswXS1uWzBdKnRbMl0sblswXSp0WzFdLW5bMV0qdFswXV19ZnVuY3Rpb24gTXQobix0KXtuWzBdKz10WzBdLG5bMV0rPXRbMV0sblsyXSs9dFsyXX1mdW5jdGlvbiB4dChuLHQpe3JldHVybltuWzBdKnQsblsxXSp0LG5bMl0qdF19ZnVuY3Rpb24gYnQobil7dmFyIHQ9TWF0aC5zcXJ0KG5bMF0qblswXStuWzFdKm5bMV0rblsyXSpuWzJdKTtuWzBdLz10LG5bMV0vPXQsblsyXS89dH1mdW5jdGlvbiBfdChuKXtyZXR1cm5bTWF0aC5hdGFuMihuWzFdLG5bMF0pLHRuKG5bMl0pXX1mdW5jdGlvbiB3dChuLHQpe3JldHVybiBNYShuWzBdLXRbMF0pPERhJiZNYShuWzFdLXRbMV0pPERhfWZ1bmN0aW9uIFN0KG4sdCl7bio9T2E7dmFyIGU9TWF0aC5jb3ModCo9T2EpO2t0KGUqTWF0aC5jb3MobiksZSpNYXRoLnNpbihuKSxNYXRoLnNpbih0KSl9ZnVuY3Rpb24ga3Qobix0LGUpeysrTm8sQW8rPShuLUFvKS9ObyxDbys9KHQtQ28pL05vLHpvKz0oZS16bykvTm99ZnVuY3Rpb24gTnQoKXtmdW5jdGlvbiBuKG4sdSl7bio9T2E7dmFyIGk9TWF0aC5jb3ModSo9T2EpLGE9aSpNYXRoLmNvcyhuKSxvPWkqTWF0aC5zaW4obiksbD1NYXRoLnNpbih1KSxjPU1hdGguYXRhbjIoTWF0aC5zcXJ0KChjPWUqbC1yKm8pKmMrKGM9ciphLXQqbCkqYysoYz10Km8tZSphKSpjKSx0KmErZSpvK3IqbCk7RW8rPWMsTG8rPWMqKHQrKHQ9YSkpLHFvKz1jKihlKyhlPW8pKSxUbys9Yyoocisocj1sKSksa3QodCxlLHIpfXZhciB0LGUscjtVby5wb2ludD1mdW5jdGlvbih1LGkpe3UqPU9hO3ZhciBhPU1hdGguY29zKGkqPU9hKTt0PWEqTWF0aC5jb3ModSksZT1hKk1hdGguc2luKHUpLHI9TWF0aC5zaW4oaSksVW8ucG9pbnQ9bixrdCh0LGUscil9fWZ1bmN0aW9uIEV0KCl7VW8ucG9pbnQ9U3R9ZnVuY3Rpb24gQXQoKXtmdW5jdGlvbiBuKG4sdCl7bio9T2E7dmFyIGU9TWF0aC5jb3ModCo9T2EpLGE9ZSpNYXRoLmNvcyhuKSxvPWUqTWF0aC5zaW4obiksbD1NYXRoLnNpbih0KSxjPXUqbC1pKm8scz1pKmEtcipsLGY9cipvLXUqYSxoPU1hdGguc3FydChjKmMrcypzK2YqZiksZz1yKmErdSpvK2kqbCxwPWgmJi1ubihnKS9oLHY9TWF0aC5hdGFuMihoLGcpO1JvKz1wKmMsRG8rPXAqcyxQbys9cCpmLEVvKz12LExvKz12KihyKyhyPWEpKSxxbys9dioodSsodT1vKSksVG8rPXYqKGkrKGk9bCkpLGt0KHIsdSxpKX12YXIgdCxlLHIsdSxpO1VvLnBvaW50PWZ1bmN0aW9uKGEsbyl7dD1hLGU9byxVby5wb2ludD1uLGEqPU9hO3ZhciBsPU1hdGguY29zKG8qPU9hKTtyPWwqTWF0aC5jb3MoYSksdT1sKk1hdGguc2luKGEpLGk9TWF0aC5zaW4obyksa3Qocix1LGkpfSxVby5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpLFVvLmxpbmVFbmQ9RXQsVW8ucG9pbnQ9U3R9fWZ1bmN0aW9uIEN0KG4sdCl7ZnVuY3Rpb24gZShlLHIpe3JldHVybiBlPW4oZSxyKSx0KGVbMF0sZVsxXSl9cmV0dXJuIG4uaW52ZXJ0JiZ0LmludmVydCYmKGUuaW52ZXJ0PWZ1bmN0aW9uKGUscil7cmV0dXJuIGU9dC5pbnZlcnQoZSxyKSxlJiZuLmludmVydChlWzBdLGVbMV0pfSksZX1mdW5jdGlvbiB6dCgpe3JldHVybiEwfWZ1bmN0aW9uIEx0KG4sdCxlLHIsdSl7dmFyIGk9W10sYT1bXTtpZihuLmZvckVhY2goZnVuY3Rpb24obil7aWYoISgodD1uLmxlbmd0aC0xKTw9MCkpe3ZhciB0LGU9blswXSxyPW5bdF07aWYod3QoZSxyKSl7dS5saW5lU3RhcnQoKTtmb3IodmFyIG89MDt0Pm87KytvKXUucG9pbnQoKGU9bltvXSlbMF0sZVsxXSk7cmV0dXJuIHZvaWQgdS5saW5lRW5kKCl9dmFyIGw9bmV3IFR0KGUsbixudWxsLCEwKSxjPW5ldyBUdChlLG51bGwsbCwhMSk7bC5vPWMsaS5wdXNoKGwpLGEucHVzaChjKSxsPW5ldyBUdChyLG4sbnVsbCwhMSksYz1uZXcgVHQocixudWxsLGwsITApLGwubz1jLGkucHVzaChsKSxhLnB1c2goYyl9fSksYS5zb3J0KHQpLHF0KGkpLHF0KGEpLGkubGVuZ3RoKXtmb3IodmFyIG89MCxsPWUsYz1hLmxlbmd0aDtjPm87KytvKWFbb10uZT1sPSFsO2Zvcih2YXIgcyxmLGg9aVswXTs7KXtmb3IodmFyIGc9aCxwPSEwO2cudjspaWYoKGc9Zy5uKT09PWgpcmV0dXJuO3M9Zy56LHUubGluZVN0YXJ0KCk7ZG97aWYoZy52PWcuby52PSEwLGcuZSl7aWYocClmb3IodmFyIG89MCxjPXMubGVuZ3RoO2M+bzsrK28pdS5wb2ludCgoZj1zW29dKVswXSxmWzFdKTtlbHNlIHIoZy54LGcubi54LDEsdSk7Zz1nLm59ZWxzZXtpZihwKXtzPWcucC56O2Zvcih2YXIgbz1zLmxlbmd0aC0xO28+PTA7LS1vKXUucG9pbnQoKGY9c1tvXSlbMF0sZlsxXSl9ZWxzZSByKGcueCxnLnAueCwtMSx1KTtnPWcucH1nPWcubyxzPWcueixwPSFwfXdoaWxlKCFnLnYpO3UubGluZUVuZCgpfX19ZnVuY3Rpb24gcXQobil7aWYodD1uLmxlbmd0aCl7Zm9yKHZhciB0LGUscj0wLHU9blswXTsrK3I8dDspdS5uPWU9bltyXSxlLnA9dSx1PWU7dS5uPWU9blswXSxlLnA9dX19ZnVuY3Rpb24gVHQobix0LGUscil7dGhpcy54PW4sdGhpcy56PXQsdGhpcy5vPWUsdGhpcy5lPXIsdGhpcy52PSExLHRoaXMubj10aGlzLnA9bnVsbH1mdW5jdGlvbiBSdChuLHQsZSxyKXtyZXR1cm4gZnVuY3Rpb24odSxpKXtmdW5jdGlvbiBhKHQsZSl7dmFyIHI9dSh0LGUpO24odD1yWzBdLGU9clsxXSkmJmkucG9pbnQodCxlKX1mdW5jdGlvbiBvKG4sdCl7dmFyIGU9dShuLHQpO2QucG9pbnQoZVswXSxlWzFdKX1mdW5jdGlvbiBsKCl7eS5wb2ludD1vLGQubGluZVN0YXJ0KCl9ZnVuY3Rpb24gYygpe3kucG9pbnQ9YSxkLmxpbmVFbmQoKX1mdW5jdGlvbiBzKG4sdCl7di5wdXNoKFtuLHRdKTt2YXIgZT11KG4sdCk7eC5wb2ludChlWzBdLGVbMV0pfWZ1bmN0aW9uIGYoKXt4LmxpbmVTdGFydCgpLHY9W119ZnVuY3Rpb24gaCgpe3ModlswXVswXSx2WzBdWzFdKSx4LmxpbmVFbmQoKTt2YXIgbix0PXguY2xlYW4oKSxlPU0uYnVmZmVyKCkscj1lLmxlbmd0aDtpZih2LnBvcCgpLHAucHVzaCh2KSx2PW51bGwscilpZigxJnQpe249ZVswXTt2YXIgdSxyPW4ubGVuZ3RoLTEsYT0tMTtpZihyPjApe2ZvcihifHwoaS5wb2x5Z29uU3RhcnQoKSxiPSEwKSxpLmxpbmVTdGFydCgpOysrYTxyOylpLnBvaW50KCh1PW5bYV0pWzBdLHVbMV0pO2kubGluZUVuZCgpfX1lbHNlIHI+MSYmMiZ0JiZlLnB1c2goZS5wb3AoKS5jb25jYXQoZS5zaGlmdCgpKSksZy5wdXNoKGUuZmlsdGVyKER0KSl9dmFyIGcscCx2LGQ9dChpKSxtPXUuaW52ZXJ0KHJbMF0sclsxXSkseT17cG9pbnQ6YSxsaW5lU3RhcnQ6bCxsaW5lRW5kOmMscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7eS5wb2ludD1zLHkubGluZVN0YXJ0PWYseS5saW5lRW5kPWgsZz1bXSxwPVtdfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7eS5wb2ludD1hLHkubGluZVN0YXJ0PWwseS5saW5lRW5kPWMsZz1vYS5tZXJnZShnKTt2YXIgbj1PdChtLHApO2cubGVuZ3RoPyhifHwoaS5wb2x5Z29uU3RhcnQoKSxiPSEwKSxMdChnLFV0LG4sZSxpKSk6biYmKGJ8fChpLnBvbHlnb25TdGFydCgpLGI9ITApLGkubGluZVN0YXJ0KCksZShudWxsLG51bGwsMSxpKSxpLmxpbmVFbmQoKSksYiYmKGkucG9seWdvbkVuZCgpLGI9ITEpLGc9cD1udWxsfSxzcGhlcmU6ZnVuY3Rpb24oKXtpLnBvbHlnb25TdGFydCgpLGkubGluZVN0YXJ0KCksZShudWxsLG51bGwsMSxpKSxpLmxpbmVFbmQoKSxpLnBvbHlnb25FbmQoKX19LE09UHQoKSx4PXQoTSksYj0hMTtyZXR1cm4geX19ZnVuY3Rpb24gRHQobil7cmV0dXJuIG4ubGVuZ3RoPjF9ZnVuY3Rpb24gUHQoKXt2YXIgbix0PVtdO3JldHVybntsaW5lU3RhcnQ6ZnVuY3Rpb24oKXt0LnB1c2gobj1bXSl9LHBvaW50OmZ1bmN0aW9uKHQsZSl7bi5wdXNoKFt0LGVdKX0sbGluZUVuZDpiLGJ1ZmZlcjpmdW5jdGlvbigpe3ZhciBlPXQ7cmV0dXJuIHQ9W10sbj1udWxsLGV9LHJlam9pbjpmdW5jdGlvbigpe3QubGVuZ3RoPjEmJnQucHVzaCh0LnBvcCgpLmNvbmNhdCh0LnNoaWZ0KCkpKX19fWZ1bmN0aW9uIFV0KG4sdCl7cmV0dXJuKChuPW4ueClbMF08MD9uWzFdLUhhLURhOkhhLW5bMV0pLSgodD10LngpWzBdPDA/dFsxXS1IYS1EYTpIYS10WzFdKX1mdW5jdGlvbiBqdChuKXt2YXIgdCxlPU5hTixyPU5hTix1PU5hTjtyZXR1cm57bGluZVN0YXJ0OmZ1bmN0aW9uKCl7bi5saW5lU3RhcnQoKSx0PTF9LHBvaW50OmZ1bmN0aW9uKGksYSl7dmFyIG89aT4wP1VhOi1VYSxsPU1hKGktZSk7TWEobC1VYSk8RGE/KG4ucG9pbnQoZSxyPShyK2EpLzI+MD9IYTotSGEpLG4ucG9pbnQodSxyKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQobyxyKSxuLnBvaW50KGksciksdD0wKTp1IT09byYmbD49VWEmJihNYShlLXUpPERhJiYoZS09dSpEYSksTWEoaS1vKTxEYSYmKGktPW8qRGEpLHI9RnQoZSxyLGksYSksbi5wb2ludCh1LHIpLG4ubGluZUVuZCgpLG4ubGluZVN0YXJ0KCksbi5wb2ludChvLHIpLHQ9MCksbi5wb2ludChlPWkscj1hKSx1PW99LGxpbmVFbmQ6ZnVuY3Rpb24oKXtuLmxpbmVFbmQoKSxlPXI9TmFOfSxjbGVhbjpmdW5jdGlvbigpe3JldHVybiAyLXR9fX1mdW5jdGlvbiBGdChuLHQsZSxyKXt2YXIgdSxpLGE9TWF0aC5zaW4obi1lKTtyZXR1cm4gTWEoYSk+RGE/TWF0aC5hdGFuKChNYXRoLnNpbih0KSooaT1NYXRoLmNvcyhyKSkqTWF0aC5zaW4oZSktTWF0aC5zaW4ocikqKHU9TWF0aC5jb3ModCkpKk1hdGguc2luKG4pKS8odSppKmEpKToodCtyKS8yfWZ1bmN0aW9uIEh0KG4sdCxlLHIpe3ZhciB1O2lmKG51bGw9PW4pdT1lKkhhLHIucG9pbnQoLVVhLHUpLHIucG9pbnQoMCx1KSxyLnBvaW50KFVhLHUpLHIucG9pbnQoVWEsMCksci5wb2ludChVYSwtdSksci5wb2ludCgwLC11KSxyLnBvaW50KC1VYSwtdSksci5wb2ludCgtVWEsMCksci5wb2ludCgtVWEsdSk7ZWxzZSBpZihNYShuWzBdLXRbMF0pPkRhKXt2YXIgaT1uWzBdPHRbMF0/VWE6LVVhO3U9ZSppLzIsci5wb2ludCgtaSx1KSxyLnBvaW50KDAsdSksci5wb2ludChpLHUpfWVsc2Ugci5wb2ludCh0WzBdLHRbMV0pfWZ1bmN0aW9uIE90KG4sdCl7dmFyIGU9blswXSxyPW5bMV0sdT1bTWF0aC5zaW4oZSksLU1hdGguY29zKGUpLDBdLGk9MCxhPTA7U28ucmVzZXQoKTtmb3IodmFyIG89MCxsPXQubGVuZ3RoO2w+bzsrK28pe3ZhciBjPXRbb10scz1jLmxlbmd0aDtpZihzKWZvcih2YXIgZj1jWzBdLGg9ZlswXSxnPWZbMV0vMitVYS80LHA9TWF0aC5zaW4oZyksdj1NYXRoLmNvcyhnKSxkPTE7Oyl7ZD09PXMmJihkPTApLG49Y1tkXTt2YXIgbT1uWzBdLHk9blsxXS8yK1VhLzQsTT1NYXRoLnNpbih5KSx4PU1hdGguY29zKHkpLGI9bS1oLF89Yj49MD8xOi0xLHc9XypiLFM9dz5VYSxrPXAqTTtpZihTby5hZGQoTWF0aC5hdGFuMihrKl8qTWF0aC5zaW4odyksdip4K2sqTWF0aC5jb3ModykpKSxpKz1TP2IrXypqYTpiLFNeaD49ZV5tPj1lKXt2YXIgTj15dChkdChmKSxkdChuKSk7YnQoTik7dmFyIEU9eXQodSxOKTtidChFKTt2YXIgQT0oU15iPj0wPy0xOjEpKnRuKEVbMl0pOyhyPkF8fHI9PT1BJiYoTlswXXx8TlsxXSkpJiYoYSs9U15iPj0wPzE6LTEpfWlmKCFkKyspYnJlYWs7aD1tLHA9TSx2PXgsZj1ufX1yZXR1cm4oLURhPml8fERhPmkmJjA+U28pXjEmYX1mdW5jdGlvbiBJdChuKXtmdW5jdGlvbiB0KG4sdCl7cmV0dXJuIE1hdGguY29zKG4pKk1hdGguY29zKHQpPml9ZnVuY3Rpb24gZShuKXt2YXIgZSxpLGwsYyxzO3JldHVybntsaW5lU3RhcnQ6ZnVuY3Rpb24oKXtjPWw9ITEscz0xfSxwb2ludDpmdW5jdGlvbihmLGgpe3ZhciBnLHA9W2YsaF0sdj10KGYsaCksZD1hP3Y/MDp1KGYsaCk6dj91KGYrKDA+Zj9VYTotVWEpLGgpOjA7aWYoIWUmJihjPWw9dikmJm4ubGluZVN0YXJ0KCksdiE9PWwmJihnPXIoZSxwKSwod3QoZSxnKXx8d3QocCxnKSkmJihwWzBdKz1EYSxwWzFdKz1EYSx2PXQocFswXSxwWzFdKSkpLHYhPT1sKXM9MCx2PyhuLmxpbmVTdGFydCgpLGc9cihwLGUpLG4ucG9pbnQoZ1swXSxnWzFdKSk6KGc9cihlLHApLG4ucG9pbnQoZ1swXSxnWzFdKSxuLmxpbmVFbmQoKSksZT1nO2Vsc2UgaWYobyYmZSYmYV52KXt2YXIgbTtkJml8fCEobT1yKHAsZSwhMCkpfHwocz0wLGE/KG4ubGluZVN0YXJ0KCksbi5wb2ludChtWzBdWzBdLG1bMF1bMV0pLG4ucG9pbnQobVsxXVswXSxtWzFdWzFdKSxuLmxpbmVFbmQoKSk6KG4ucG9pbnQobVsxXVswXSxtWzFdWzFdKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQobVswXVswXSxtWzBdWzFdKSkpfSF2fHxlJiZ3dChlLHApfHxuLnBvaW50KHBbMF0scFsxXSksZT1wLGw9dixpPWR9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtsJiZuLmxpbmVFbmQoKSxlPW51bGx9LGNsZWFuOmZ1bmN0aW9uKCl7cmV0dXJuIHN8KGMmJmwpPDwxfX19ZnVuY3Rpb24gcihuLHQsZSl7dmFyIHI9ZHQobiksdT1kdCh0KSxhPVsxLDAsMF0sbz15dChyLHUpLGw9bXQobyxvKSxjPW9bMF0scz1sLWMqYztpZighcylyZXR1cm4hZSYmbjt2YXIgZj1pKmwvcyxoPS1pKmMvcyxnPXl0KGEsbykscD14dChhLGYpLHY9eHQobyxoKTtNdChwLHYpO3ZhciBkPWcsbT1tdChwLGQpLHk9bXQoZCxkKSxNPW0qbS15KihtdChwLHApLTEpO2lmKCEoMD5NKSl7dmFyIHg9TWF0aC5zcXJ0KE0pLGI9eHQoZCwoLW0teCkveSk7aWYoTXQoYixwKSxiPV90KGIpLCFlKXJldHVybiBiO3ZhciBfLHc9blswXSxTPXRbMF0saz1uWzFdLE49dFsxXTt3PlMmJihfPXcsdz1TLFM9Xyk7dmFyIEU9Uy13LEE9TWEoRS1VYSk8RGEsQz1BfHxEYT5FO2lmKCFBJiZrPk4mJihfPWssaz1OLE49XyksQz9BP2srTj4wXmJbMV08KE1hKGJbMF0tdyk8RGE/azpOKTprPD1iWzFdJiZiWzFdPD1OOkU+VWFeKHc8PWJbMF0mJmJbMF08PVMpKXt2YXIgej14dChkLCgtbSt4KS95KTtyZXR1cm4gTXQoeixwKSxbYixfdCh6KV19fX1mdW5jdGlvbiB1KHQsZSl7dmFyIHI9YT9uOlVhLW4sdT0wO3JldHVybi1yPnQ/dXw9MTp0PnImJih1fD0yKSwtcj5lP3V8PTQ6ZT5yJiYodXw9OCksdX12YXIgaT1NYXRoLmNvcyhuKSxhPWk+MCxvPU1hKGkpPkRhLGw9dmUobiw2Kk9hKTtyZXR1cm4gUnQodCxlLGwsYT9bMCwtbl06Wy1VYSxuLVVhXSl9ZnVuY3Rpb24gWXQobix0LGUscil7cmV0dXJuIGZ1bmN0aW9uKHUpe3ZhciBpLGE9dS5hLG89dS5iLGw9YS54LGM9YS55LHM9by54LGY9by55LGg9MCxnPTEscD1zLWwsdj1mLWM7aWYoaT1uLWwscHx8IShpPjApKXtpZihpLz1wLDA+cCl7aWYoaD5pKXJldHVybjtnPmkmJihnPWkpfWVsc2UgaWYocD4wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9aWYoaT1lLWwscHx8ISgwPmkpKXtpZihpLz1wLDA+cCl7aWYoaT5nKXJldHVybjtpPmgmJihoPWkpfWVsc2UgaWYocD4wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9aWYoaT10LWMsdnx8IShpPjApKXtpZihpLz12LDA+dil7aWYoaD5pKXJldHVybjtnPmkmJihnPWkpfWVsc2UgaWYodj4wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9aWYoaT1yLWMsdnx8ISgwPmkpKXtpZihpLz12LDA+dil7aWYoaT5nKXJldHVybjtpPmgmJihoPWkpfWVsc2UgaWYodj4wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9cmV0dXJuIGg+MCYmKHUuYT17eDpsK2gqcCx5OmMraCp2fSksMT5nJiYodS5iPXt4OmwrZypwLHk6YytnKnZ9KSx1fX19fX19ZnVuY3Rpb24gWnQobix0LGUscil7ZnVuY3Rpb24gdShyLHUpe3JldHVybiBNYShyWzBdLW4pPERhP3U+MD8wOjM6TWEoclswXS1lKTxEYT91PjA/MjoxOk1hKHJbMV0tdCk8RGE/dT4wPzE6MDp1PjA/MzoyfWZ1bmN0aW9uIGkobix0KXtyZXR1cm4gYShuLngsdC54KX1mdW5jdGlvbiBhKG4sdCl7dmFyIGU9dShuLDEpLHI9dSh0LDEpO3JldHVybiBlIT09cj9lLXI6MD09PWU/dFsxXS1uWzFdOjE9PT1lP25bMF0tdFswXToyPT09ZT9uWzFdLXRbMV06dFswXS1uWzBdfXJldHVybiBmdW5jdGlvbihvKXtmdW5jdGlvbiBsKG4pe2Zvcih2YXIgdD0wLGU9ZC5sZW5ndGgscj1uWzFdLHU9MDtlPnU7Kyt1KWZvcih2YXIgaSxhPTEsbz1kW3VdLGw9by5sZW5ndGgsYz1vWzBdO2w+YTsrK2EpaT1vW2FdLGNbMV08PXI/aVsxXT5yJiZRKGMsaSxuKT4wJiYrK3Q6aVsxXTw9ciYmUShjLGksbik8MCYmLS10LGM9aTtyZXR1cm4gMCE9PXR9ZnVuY3Rpb24gYyhpLG8sbCxjKXt2YXIgcz0wLGY9MDtpZihudWxsPT1pfHwocz11KGksbCkpIT09KGY9dShvLGwpKXx8YShpLG8pPDBebD4wKXtkbyBjLnBvaW50KDA9PT1zfHwzPT09cz9uOmUscz4xP3I6dCk7d2hpbGUoKHM9KHMrbCs0KSU0KSE9PWYpfWVsc2UgYy5wb2ludChvWzBdLG9bMV0pfWZ1bmN0aW9uIHModSxpKXtyZXR1cm4gdT49biYmZT49dSYmaT49dCYmcj49aX1mdW5jdGlvbiBmKG4sdCl7cyhuLHQpJiZvLnBvaW50KG4sdCl9ZnVuY3Rpb24gaCgpe0MucG9pbnQ9cCxkJiZkLnB1c2gobT1bXSksUz0hMCx3PSExLGI9Xz1OYU59ZnVuY3Rpb24gZygpe3YmJihwKHksTSkseCYmdyYmRS5yZWpvaW4oKSx2LnB1c2goRS5idWZmZXIoKSkpLEMucG9pbnQ9Zix3JiZvLmxpbmVFbmQoKX1mdW5jdGlvbiBwKG4sdCl7bj1NYXRoLm1heCgtRm8sTWF0aC5taW4oRm8sbikpLHQ9TWF0aC5tYXgoLUZvLE1hdGgubWluKEZvLHQpKTt2YXIgZT1zKG4sdCk7aWYoZCYmbS5wdXNoKFtuLHRdKSxTKXk9bixNPXQseD1lLFM9ITEsZSYmKG8ubGluZVN0YXJ0KCksby5wb2ludChuLHQpKTtlbHNlIGlmKGUmJncpby5wb2ludChuLHQpO2Vsc2V7dmFyIHI9e2E6e3g6Yix5Ol99LGI6e3g6bix5OnR9fTtBKHIpPyh3fHwoby5saW5lU3RhcnQoKSxvLnBvaW50KHIuYS54LHIuYS55KSksby5wb2ludChyLmIueCxyLmIueSksZXx8by5saW5lRW5kKCksaz0hMSk6ZSYmKG8ubGluZVN0YXJ0KCksby5wb2ludChuLHQpLGs9ITEpfWI9bixfPXQsdz1lfXZhciB2LGQsbSx5LE0seCxiLF8sdyxTLGssTj1vLEU9UHQoKSxBPVl0KG4sdCxlLHIpLEM9e3BvaW50OmYsbGluZVN0YXJ0OmgsbGluZUVuZDpnLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe289RSx2PVtdLGQ9W10saz0hMH0scG9seWdvbkVuZDpmdW5jdGlvbigpe289Tix2PW9hLm1lcmdlKHYpO3ZhciB0PWwoW24scl0pLGU9ayYmdCx1PXYubGVuZ3RoOyhlfHx1KSYmKG8ucG9seWdvblN0YXJ0KCksZSYmKG8ubGluZVN0YXJ0KCksYyhudWxsLG51bGwsMSxvKSxvLmxpbmVFbmQoKSksdSYmTHQodixpLHQsYyxvKSxvLnBvbHlnb25FbmQoKSksdj1kPW09bnVsbH19O3JldHVybiBDfX1mdW5jdGlvbiBWdChuKXt2YXIgdD0wLGU9VWEvMyxyPW9lKG4pLHU9cih0LGUpO3JldHVybiB1LnBhcmFsbGVscz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD9yKHQ9blswXSpVYS8xODAsZT1uWzFdKlVhLzE4MCk6W3QvVWEqMTgwLGUvVWEqMTgwXX0sdX1mdW5jdGlvbiBYdChuLHQpe2Z1bmN0aW9uIGUobix0KXt2YXIgZT1NYXRoLnNxcnQoaS0yKnUqTWF0aC5zaW4odCkpL3U7cmV0dXJuW2UqTWF0aC5zaW4obio9dSksYS1lKk1hdGguY29zKG4pXX12YXIgcj1NYXRoLnNpbihuKSx1PShyK01hdGguc2luKHQpKS8yLGk9MStyKigyKnUtciksYT1NYXRoLnNxcnQoaSkvdTtyZXR1cm4gZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgZT1hLXQ7cmV0dXJuW01hdGguYXRhbjIobixlKS91LHRuKChpLShuKm4rZSplKSp1KnUpLygyKnUpKV19LGV9ZnVuY3Rpb24gJHQoKXtmdW5jdGlvbiBuKG4sdCl7T28rPXUqbi1yKnQscj1uLHU9dH12YXIgdCxlLHIsdTtYby5wb2ludD1mdW5jdGlvbihpLGEpe1hvLnBvaW50PW4sdD1yPWksZT11PWF9LFhvLmxpbmVFbmQ9ZnVuY3Rpb24oKXtuKHQsZSl9fWZ1bmN0aW9uIEJ0KG4sdCl7SW8+biYmKElvPW4pLG4+Wm8mJihabz1uKSxZbz50JiYoWW89dCksdD5WbyYmKFZvPXQpfWZ1bmN0aW9uIFd0KCl7ZnVuY3Rpb24gbihuLHQpe2EucHVzaCgiTSIsbiwiLCIsdCxpKX1mdW5jdGlvbiB0KG4sdCl7YS5wdXNoKCJNIixuLCIsIix0KSxvLnBvaW50PWV9ZnVuY3Rpb24gZShuLHQpe2EucHVzaCgiTCIsbiwiLCIsdCl9ZnVuY3Rpb24gcigpe28ucG9pbnQ9bn1mdW5jdGlvbiB1KCl7YS5wdXNoKCJaIil9dmFyIGk9SnQoNC41KSxhPVtdLG89e3BvaW50Om4sbGluZVN0YXJ0OmZ1bmN0aW9uKCl7by5wb2ludD10fSxsaW5lRW5kOnIscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7by5saW5lRW5kPXV9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXtvLmxpbmVFbmQ9cixvLnBvaW50PW59LHBvaW50UmFkaXVzOmZ1bmN0aW9uKG4pe3JldHVybiBpPUp0KG4pLG99LHJlc3VsdDpmdW5jdGlvbigpe2lmKGEubGVuZ3RoKXt2YXIgbj1hLmpvaW4oIiIpO3JldHVybiBhPVtdLG59fX07cmV0dXJuIG99ZnVuY3Rpb24gSnQobil7cmV0dXJuIm0wLCIrbisiYSIrbisiLCIrbisiIDAgMSwxIDAsIistMipuKyJhIituKyIsIituKyIgMCAxLDEgMCwiKzIqbisieiJ9ZnVuY3Rpb24gR3Qobix0KXtBbys9bixDbys9dCwrK3pvfWZ1bmN0aW9uIEt0KCl7ZnVuY3Rpb24gbihuLHIpe3ZhciB1PW4tdCxpPXItZSxhPU1hdGguc3FydCh1KnUraSppKTtMbys9YSoodCtuKS8yLHFvKz1hKihlK3IpLzIsVG8rPWEsR3QodD1uLGU9cil9dmFyIHQsZTtCby5wb2ludD1mdW5jdGlvbihyLHUpe0JvLnBvaW50PW4sR3QodD1yLGU9dSl9fWZ1bmN0aW9uIFF0KCl7Qm8ucG9pbnQ9R3R9ZnVuY3Rpb24gbmUoKXtmdW5jdGlvbiBuKG4sdCl7dmFyIGU9bi1yLGk9dC11LGE9TWF0aC5zcXJ0KGUqZStpKmkpO0xvKz1hKihyK24pLzIscW8rPWEqKHUrdCkvMixUbys9YSxhPXUqbi1yKnQsUm8rPWEqKHIrbiksRG8rPWEqKHUrdCksUG8rPTMqYSxHdChyPW4sdT10KX12YXIgdCxlLHIsdTtCby5wb2ludD1mdW5jdGlvbihpLGEpe0JvLnBvaW50PW4sR3QodD1yPWksZT11PWEpfSxCby5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpfX1mdW5jdGlvbiB0ZShuKXtmdW5jdGlvbiB0KHQsZSl7bi5tb3ZlVG8odCthLGUpLG4uYXJjKHQsZSxhLDAsamEpfWZ1bmN0aW9uIGUodCxlKXtuLm1vdmVUbyh0LGUpLG8ucG9pbnQ9cn1mdW5jdGlvbiByKHQsZSl7bi5saW5lVG8odCxlKX1mdW5jdGlvbiB1KCl7by5wb2ludD10fWZ1bmN0aW9uIGkoKXtuLmNsb3NlUGF0aCgpfXZhciBhPTQuNSxvPXtwb2ludDp0LGxpbmVTdGFydDpmdW5jdGlvbigpe28ucG9pbnQ9ZX0sbGluZUVuZDp1LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe28ubGluZUVuZD1pfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7by5saW5lRW5kPXUsby5wb2ludD10fSxwb2ludFJhZGl1czpmdW5jdGlvbihuKXtyZXR1cm4gYT1uLG99LHJlc3VsdDpifTtyZXR1cm4gb31mdW5jdGlvbiBlZShuKXtmdW5jdGlvbiB0KG4pe3JldHVybihvP3I6ZSkobil9ZnVuY3Rpb24gZSh0KXtyZXR1cm4gaWUodCxmdW5jdGlvbihlLHIpe2U9bihlLHIpLHQucG9pbnQoZVswXSxlWzFdKX0pfWZ1bmN0aW9uIHIodCl7ZnVuY3Rpb24gZShlLHIpe2U9bihlLHIpLHQucG9pbnQoZVswXSxlWzFdKX1mdW5jdGlvbiByKCl7TT1OYU4sUy5wb2ludD1pLHQubGluZVN0YXJ0KCl9ZnVuY3Rpb24gaShlLHIpe3ZhciBpPWR0KFtlLHJdKSxhPW4oZSxyKTt1KE0seCx5LGIsXyx3LE09YVswXSx4PWFbMV0seT1lLGI9aVswXSxfPWlbMV0sdz1pWzJdLG8sdCksdC5wb2ludChNLHgpfWZ1bmN0aW9uIGEoKXtTLnBvaW50PWUsdC5saW5lRW5kKCl9ZnVuY3Rpb24gbCgpewpyKCksUy5wb2ludD1jLFMubGluZUVuZD1zfWZ1bmN0aW9uIGMobix0KXtpKGY9bixoPXQpLGc9TSxwPXgsdj1iLGQ9XyxtPXcsUy5wb2ludD1pfWZ1bmN0aW9uIHMoKXt1KE0seCx5LGIsXyx3LGcscCxmLHYsZCxtLG8sdCksUy5saW5lRW5kPWEsYSgpfXZhciBmLGgsZyxwLHYsZCxtLHksTSx4LGIsXyx3LFM9e3BvaW50OmUsbGluZVN0YXJ0OnIsbGluZUVuZDphLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3QucG9seWdvblN0YXJ0KCksUy5saW5lU3RhcnQ9bH0scG9seWdvbkVuZDpmdW5jdGlvbigpe3QucG9seWdvbkVuZCgpLFMubGluZVN0YXJ0PXJ9fTtyZXR1cm4gU31mdW5jdGlvbiB1KHQsZSxyLG8sbCxjLHMsZixoLGcscCx2LGQsbSl7dmFyIHk9cy10LE09Zi1lLHg9eSp5K00qTTtpZih4PjQqaSYmZC0tKXt2YXIgYj1vK2csXz1sK3Asdz1jK3YsUz1NYXRoLnNxcnQoYipiK18qXyt3KncpLGs9TWF0aC5hc2luKHcvPVMpLE49TWEoTWEodyktMSk8RGF8fE1hKHItaCk8RGE/KHIraCkvMjpNYXRoLmF0YW4yKF8sYiksRT1uKE4sayksQT1FWzBdLEM9RVsxXSx6PUEtdCxMPUMtZSxxPU0qei15Kkw7KHEqcS94Pml8fE1hKCh5KnorTSpMKS94LS41KT4uM3x8YT5vKmcrbCpwK2MqdikmJih1KHQsZSxyLG8sbCxjLEEsQyxOLGIvPVMsXy89Uyx3LGQsbSksbS5wb2ludChBLEMpLHUoQSxDLE4sYixfLHcscyxmLGgsZyxwLHYsZCxtKSl9fXZhciBpPS41LGE9TWF0aC5jb3MoMzAqT2EpLG89MTY7cmV0dXJuIHQucHJlY2lzaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPShpPW4qbik+MCYmMTYsdCk6TWF0aC5zcXJ0KGkpfSx0fWZ1bmN0aW9uIHJlKG4pe3ZhciB0PWVlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIG4oW3QqSWEsZSpJYV0pfSk7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBsZSh0KG4pKX19ZnVuY3Rpb24gdWUobil7dGhpcy5zdHJlYW09bn1mdW5jdGlvbiBpZShuLHQpe3JldHVybntwb2ludDp0LHNwaGVyZTpmdW5jdGlvbigpe24uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe24ubGluZVN0YXJ0KCl9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtuLmxpbmVFbmQoKX0scG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7bi5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe24ucG9seWdvbkVuZCgpfX19ZnVuY3Rpb24gYWUobil7cmV0dXJuIG9lKGZ1bmN0aW9uKCl7cmV0dXJuIG59KSgpfWZ1bmN0aW9uIG9lKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuIG49byhuWzBdKk9hLG5bMV0qT2EpLFtuWzBdKmgrbCxjLW5bMV0qaF19ZnVuY3Rpb24gZShuKXtyZXR1cm4gbj1vLmludmVydCgoblswXS1sKS9oLChjLW5bMV0pL2gpLG4mJltuWzBdKklhLG5bMV0qSWFdfWZ1bmN0aW9uIHIoKXtvPUN0KGE9ZmUobSxNLHgpLGkpO3ZhciBuPWkodixkKTtyZXR1cm4gbD1nLW5bMF0qaCxjPXArblsxXSpoLHUoKX1mdW5jdGlvbiB1KCl7cmV0dXJuIHMmJihzLnZhbGlkPSExLHM9bnVsbCksdH12YXIgaSxhLG8sbCxjLHMsZj1lZShmdW5jdGlvbihuLHQpe3JldHVybiBuPWkobix0KSxbblswXSpoK2wsYy1uWzFdKmhdfSksaD0xNTAsZz00ODAscD0yNTAsdj0wLGQ9MCxtPTAsTT0wLHg9MCxiPWpvLF89eSx3PW51bGwsUz1udWxsO3JldHVybiB0LnN0cmVhbT1mdW5jdGlvbihuKXtyZXR1cm4gcyYmKHMudmFsaWQ9ITEpLHM9bGUoYihhLGYoXyhuKSkpKSxzLnZhbGlkPSEwLHN9LHQuY2xpcEFuZ2xlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhiPW51bGw9PW4/KHc9bixqbyk6SXQoKHc9K24pKk9hKSx1KCkpOnd9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oUz1uLF89bj9adChuWzBdWzBdLG5bMF1bMV0sblsxXVswXSxuWzFdWzFdKTp5LHUoKSk6U30sdC5zY2FsZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaD0rbixyKCkpOmh9LHQudHJhbnNsYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPStuWzBdLHA9K25bMV0scigpKTpbZyxwXX0sdC5jZW50ZXI9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHY9blswXSUzNjAqT2EsZD1uWzFdJTM2MCpPYSxyKCkpOlt2KklhLGQqSWFdfSx0LnJvdGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obT1uWzBdJTM2MCpPYSxNPW5bMV0lMzYwKk9hLHg9bi5sZW5ndGg+Mj9uWzJdJTM2MCpPYTowLHIoKSk6W20qSWEsTSpJYSx4KklhXX0sb2EucmViaW5kKHQsZiwicHJlY2lzaW9uIiksZnVuY3Rpb24oKXtyZXR1cm4gaT1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0LmludmVydD1pLmludmVydCYmZSxyKCl9fWZ1bmN0aW9uIGxlKG4pe3JldHVybiBpZShuLGZ1bmN0aW9uKHQsZSl7bi5wb2ludCh0Kk9hLGUqT2EpfSl9ZnVuY3Rpb24gY2Uobix0KXtyZXR1cm5bbix0XX1mdW5jdGlvbiBzZShuLHQpe3JldHVybltuPlVhP24tamE6LVVhPm4/bitqYTpuLHRdfWZ1bmN0aW9uIGZlKG4sdCxlKXtyZXR1cm4gbj90fHxlP0N0KGdlKG4pLHBlKHQsZSkpOmdlKG4pOnR8fGU/cGUodCxlKTpzZX1mdW5jdGlvbiBoZShuKXtyZXR1cm4gZnVuY3Rpb24odCxlKXtyZXR1cm4gdCs9bixbdD5VYT90LWphOi1VYT50P3QramE6dCxlXX19ZnVuY3Rpb24gZ2Uobil7dmFyIHQ9aGUobik7cmV0dXJuIHQuaW52ZXJ0PWhlKC1uKSx0fWZ1bmN0aW9uIHBlKG4sdCl7ZnVuY3Rpb24gZShuLHQpe3ZhciBlPU1hdGguY29zKHQpLG89TWF0aC5jb3MobikqZSxsPU1hdGguc2luKG4pKmUsYz1NYXRoLnNpbih0KSxzPWMqcitvKnU7cmV0dXJuW01hdGguYXRhbjIobCppLXMqYSxvKnItYyp1KSx0bihzKmkrbCphKV19dmFyIHI9TWF0aC5jb3MobiksdT1NYXRoLnNpbihuKSxpPU1hdGguY29zKHQpLGE9TWF0aC5zaW4odCk7cmV0dXJuIGUuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7dmFyIGU9TWF0aC5jb3ModCksbz1NYXRoLmNvcyhuKSplLGw9TWF0aC5zaW4obikqZSxjPU1hdGguc2luKHQpLHM9YyppLWwqYTtyZXR1cm5bTWF0aC5hdGFuMihsKmkrYyphLG8qcitzKnUpLHRuKHMqci1vKnUpXX0sZX1mdW5jdGlvbiB2ZShuLHQpe3ZhciBlPU1hdGguY29zKG4pLHI9TWF0aC5zaW4obik7cmV0dXJuIGZ1bmN0aW9uKHUsaSxhLG8pe3ZhciBsPWEqdDtudWxsIT11Pyh1PWRlKGUsdSksaT1kZShlLGkpLChhPjA/aT51OnU+aSkmJih1Kz1hKmphKSk6KHU9bithKmphLGk9bi0uNSpsKTtmb3IodmFyIGMscz11O2E+MD9zPmk6aT5zO3MtPWwpby5wb2ludCgoYz1fdChbZSwtcipNYXRoLmNvcyhzKSwtcipNYXRoLnNpbihzKV0pKVswXSxjWzFdKX19ZnVuY3Rpb24gZGUobix0KXt2YXIgZT1kdCh0KTtlWzBdLT1uLGJ0KGUpO3ZhciByPW5uKC1lWzFdKTtyZXR1cm4oKC1lWzJdPDA/LXI6cikrMipNYXRoLlBJLURhKSUoMipNYXRoLlBJKX1mdW5jdGlvbiBtZShuLHQsZSl7dmFyIHI9b2EucmFuZ2Uobix0LURhLGUpLmNvbmNhdCh0KTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIHIubWFwKGZ1bmN0aW9uKHQpe3JldHVybltuLHRdfSl9fWZ1bmN0aW9uIHllKG4sdCxlKXt2YXIgcj1vYS5yYW5nZShuLHQtRGEsZSkuY29uY2F0KHQpO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gci5tYXAoZnVuY3Rpb24odCl7cmV0dXJuW3Qsbl19KX19ZnVuY3Rpb24gTWUobil7cmV0dXJuIG4uc291cmNlfWZ1bmN0aW9uIHhlKG4pe3JldHVybiBuLnRhcmdldH1mdW5jdGlvbiBiZShuLHQsZSxyKXt2YXIgdT1NYXRoLmNvcyh0KSxpPU1hdGguc2luKHQpLGE9TWF0aC5jb3Mociksbz1NYXRoLnNpbihyKSxsPXUqTWF0aC5jb3MobiksYz11Kk1hdGguc2luKG4pLHM9YSpNYXRoLmNvcyhlKSxmPWEqTWF0aC5zaW4oZSksaD0yKk1hdGguYXNpbihNYXRoLnNxcnQoYW4oci10KSt1KmEqYW4oZS1uKSkpLGc9MS9NYXRoLnNpbihoKSxwPWg/ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zaW4obio9aCkqZyxlPU1hdGguc2luKGgtbikqZyxyPWUqbCt0KnMsdT1lKmMrdCpmLGE9ZSppK3QqbztyZXR1cm5bTWF0aC5hdGFuMih1LHIpKklhLE1hdGguYXRhbjIoYSxNYXRoLnNxcnQocipyK3UqdSkpKklhXX06ZnVuY3Rpb24oKXtyZXR1cm5bbipJYSx0KklhXX07cmV0dXJuIHAuZGlzdGFuY2U9aCxwfWZ1bmN0aW9uIF9lKCl7ZnVuY3Rpb24gbihuLHUpe3ZhciBpPU1hdGguc2luKHUqPU9hKSxhPU1hdGguY29zKHUpLG89TWEoKG4qPU9hKS10KSxsPU1hdGguY29zKG8pO1dvKz1NYXRoLmF0YW4yKE1hdGguc3FydCgobz1hKk1hdGguc2luKG8pKSpvKyhvPXIqaS1lKmEqbCkqbyksZSppK3IqYSpsKSx0PW4sZT1pLHI9YX12YXIgdCxlLHI7Sm8ucG9pbnQ9ZnVuY3Rpb24odSxpKXt0PXUqT2EsZT1NYXRoLnNpbihpKj1PYSkscj1NYXRoLmNvcyhpKSxKby5wb2ludD1ufSxKby5saW5lRW5kPWZ1bmN0aW9uKCl7Sm8ucG9pbnQ9Sm8ubGluZUVuZD1ifX1mdW5jdGlvbiB3ZShuLHQpe2Z1bmN0aW9uIGUodCxlKXt2YXIgcj1NYXRoLmNvcyh0KSx1PU1hdGguY29zKGUpLGk9bihyKnUpO3JldHVybltpKnUqTWF0aC5zaW4odCksaSpNYXRoLnNpbihlKV19cmV0dXJuIGUuaW52ZXJ0PWZ1bmN0aW9uKG4sZSl7dmFyIHI9TWF0aC5zcXJ0KG4qbitlKmUpLHU9dChyKSxpPU1hdGguc2luKHUpLGE9TWF0aC5jb3ModSk7cmV0dXJuW01hdGguYXRhbjIobippLHIqYSksTWF0aC5hc2luKHImJmUqaS9yKV19LGV9ZnVuY3Rpb24gU2Uobix0KXtmdW5jdGlvbiBlKG4sdCl7YT4wPy1IYStEYT50JiYodD0tSGErRGEpOnQ+SGEtRGEmJih0PUhhLURhKTt2YXIgZT1hL01hdGgucG93KHUodCksaSk7cmV0dXJuW2UqTWF0aC5zaW4oaSpuKSxhLWUqTWF0aC5jb3MoaSpuKV19dmFyIHI9TWF0aC5jb3MobiksdT1mdW5jdGlvbihuKXtyZXR1cm4gTWF0aC50YW4oVWEvNCtuLzIpfSxpPW49PT10P01hdGguc2luKG4pOk1hdGgubG9nKHIvTWF0aC5jb3ModCkpL01hdGgubG9nKHUodCkvdShuKSksYT1yKk1hdGgucG93KHUobiksaSkvaTtyZXR1cm4gaT8oZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgZT1hLXQscj1LKGkpKk1hdGguc3FydChuKm4rZSplKTtyZXR1cm5bTWF0aC5hdGFuMihuLGUpL2ksMipNYXRoLmF0YW4oTWF0aC5wb3coYS9yLDEvaSkpLUhhXX0sZSk6TmV9ZnVuY3Rpb24ga2Uobix0KXtmdW5jdGlvbiBlKG4sdCl7dmFyIGU9aS10O3JldHVybltlKk1hdGguc2luKHUqbiksaS1lKk1hdGguY29zKHUqbildfXZhciByPU1hdGguY29zKG4pLHU9bj09PXQ/TWF0aC5zaW4obik6KHItTWF0aC5jb3ModCkpLyh0LW4pLGk9ci91K247cmV0dXJuIE1hKHUpPERhP2NlOihlLmludmVydD1mdW5jdGlvbihuLHQpe3ZhciBlPWktdDtyZXR1cm5bTWF0aC5hdGFuMihuLGUpL3UsaS1LKHUpKk1hdGguc3FydChuKm4rZSplKV19LGUpfWZ1bmN0aW9uIE5lKG4sdCl7cmV0dXJuW24sTWF0aC5sb2coTWF0aC50YW4oVWEvNCt0LzIpKV19ZnVuY3Rpb24gRWUobil7dmFyIHQsZT1hZShuKSxyPWUuc2NhbGUsdT1lLnRyYW5zbGF0ZSxpPWUuY2xpcEV4dGVudDtyZXR1cm4gZS5zY2FsZT1mdW5jdGlvbigpe3ZhciBuPXIuYXBwbHkoZSxhcmd1bWVudHMpO3JldHVybiBuPT09ZT90P2UuY2xpcEV4dGVudChudWxsKTplOm59LGUudHJhbnNsYXRlPWZ1bmN0aW9uKCl7dmFyIG49dS5hcHBseShlLGFyZ3VtZW50cyk7cmV0dXJuIG49PT1lP3Q/ZS5jbGlwRXh0ZW50KG51bGwpOmU6bn0sZS5jbGlwRXh0ZW50PWZ1bmN0aW9uKG4pe3ZhciBhPWkuYXBwbHkoZSxhcmd1bWVudHMpO2lmKGE9PT1lKXtpZih0PW51bGw9PW4pe3ZhciBvPVVhKnIoKSxsPXUoKTtpKFtbbFswXS1vLGxbMV0tb10sW2xbMF0rbyxsWzFdK29dXSl9fWVsc2UgdCYmKGE9bnVsbCk7cmV0dXJuIGF9LGUuY2xpcEV4dGVudChudWxsKX1mdW5jdGlvbiBBZShuLHQpe3JldHVybltNYXRoLmxvZyhNYXRoLnRhbihVYS80K3QvMikpLC1uXX1mdW5jdGlvbiBDZShuKXtyZXR1cm4gblswXX1mdW5jdGlvbiB6ZShuKXtyZXR1cm4gblsxXX1mdW5jdGlvbiBMZShuKXtmb3IodmFyIHQ9bi5sZW5ndGgsZT1bMCwxXSxyPTIsdT0yO3Q+dTt1Kyspe2Zvcig7cj4xJiZRKG5bZVtyLTJdXSxuW2Vbci0xXV0sblt1XSk8PTA7KS0tcjtlW3IrK109dX1yZXR1cm4gZS5zbGljZSgwLHIpfWZ1bmN0aW9uIHFlKG4sdCl7cmV0dXJuIG5bMF0tdFswXXx8blsxXS10WzFdfWZ1bmN0aW9uIFRlKG4sdCxlKXtyZXR1cm4oZVswXS10WzBdKSooblsxXS10WzFdKTwoZVsxXS10WzFdKSooblswXS10WzBdKX1mdW5jdGlvbiBSZShuLHQsZSxyKXt2YXIgdT1uWzBdLGk9ZVswXSxhPXRbMF0tdSxvPXJbMF0taSxsPW5bMV0sYz1lWzFdLHM9dFsxXS1sLGY9clsxXS1jLGg9KG8qKGwtYyktZioodS1pKSkvKGYqYS1vKnMpO3JldHVyblt1K2gqYSxsK2gqc119ZnVuY3Rpb24gRGUobil7dmFyIHQ9blswXSxlPW5bbi5sZW5ndGgtMV07cmV0dXJuISh0WzBdLWVbMF18fHRbMV0tZVsxXSl9ZnVuY3Rpb24gUGUoKXtycih0aGlzKSx0aGlzLmVkZ2U9dGhpcy5zaXRlPXRoaXMuY2lyY2xlPW51bGx9ZnVuY3Rpb24gVWUobil7dmFyIHQ9bGwucG9wKCl8fG5ldyBQZTtyZXR1cm4gdC5zaXRlPW4sdH1mdW5jdGlvbiBqZShuKXtCZShuKSxpbC5yZW1vdmUobiksbGwucHVzaChuKSxycihuKX1mdW5jdGlvbiBGZShuKXt2YXIgdD1uLmNpcmNsZSxlPXQueCxyPXQuY3ksdT17eDplLHk6cn0saT1uLlAsYT1uLk4sbz1bbl07amUobik7Zm9yKHZhciBsPWk7bC5jaXJjbGUmJk1hKGUtbC5jaXJjbGUueCk8RGEmJk1hKHItbC5jaXJjbGUuY3kpPERhOylpPWwuUCxvLnVuc2hpZnQobCksamUobCksbD1pO28udW5zaGlmdChsKSxCZShsKTtmb3IodmFyIGM9YTtjLmNpcmNsZSYmTWEoZS1jLmNpcmNsZS54KTxEYSYmTWEoci1jLmNpcmNsZS5jeSk8RGE7KWE9Yy5OLG8ucHVzaChjKSxqZShjKSxjPWE7by5wdXNoKGMpLEJlKGMpO3ZhciBzLGY9by5sZW5ndGg7Zm9yKHM9MTtmPnM7KytzKWM9b1tzXSxsPW9bcy0xXSxucihjLmVkZ2UsbC5zaXRlLGMuc2l0ZSx1KTtsPW9bMF0sYz1vW2YtMV0sYy5lZGdlPUtlKGwuc2l0ZSxjLnNpdGUsbnVsbCx1KSwkZShsKSwkZShjKX1mdW5jdGlvbiBIZShuKXtmb3IodmFyIHQsZSxyLHUsaT1uLngsYT1uLnksbz1pbC5fO287KWlmKHI9T2UobyxhKS1pLHI+RGEpbz1vLkw7ZWxzZXtpZih1PWktSWUobyxhKSwhKHU+RGEpKXtyPi1EYT8odD1vLlAsZT1vKTp1Pi1EYT8odD1vLGU9by5OKTp0PWU9bzticmVha31pZighby5SKXt0PW87YnJlYWt9bz1vLlJ9dmFyIGw9VWUobik7aWYoaWwuaW5zZXJ0KHQsbCksdHx8ZSl7aWYodD09PWUpcmV0dXJuIEJlKHQpLGU9VWUodC5zaXRlKSxpbC5pbnNlcnQobCxlKSxsLmVkZ2U9ZS5lZGdlPUtlKHQuc2l0ZSxsLnNpdGUpLCRlKHQpLHZvaWQgJGUoZSk7aWYoIWUpcmV0dXJuIHZvaWQobC5lZGdlPUtlKHQuc2l0ZSxsLnNpdGUpKTtCZSh0KSxCZShlKTt2YXIgYz10LnNpdGUscz1jLngsZj1jLnksaD1uLngtcyxnPW4ueS1mLHA9ZS5zaXRlLHY9cC54LXMsZD1wLnktZixtPTIqKGgqZC1nKnYpLHk9aCpoK2cqZyxNPXYqditkKmQseD17eDooZCp5LWcqTSkvbStzLHk6KGgqTS12KnkpL20rZn07bnIoZS5lZGdlLGMscCx4KSxsLmVkZ2U9S2UoYyxuLG51bGwseCksZS5lZGdlPUtlKG4scCxudWxsLHgpLCRlKHQpLCRlKGUpfX1mdW5jdGlvbiBPZShuLHQpe3ZhciBlPW4uc2l0ZSxyPWUueCx1PWUueSxpPXUtdDtpZighaSlyZXR1cm4gcjt2YXIgYT1uLlA7aWYoIWEpcmV0dXJuLSgxLzApO2U9YS5zaXRlO3ZhciBvPWUueCxsPWUueSxjPWwtdDtpZighYylyZXR1cm4gbzt2YXIgcz1vLXIsZj0xL2ktMS9jLGg9cy9jO3JldHVybiBmPygtaCtNYXRoLnNxcnQoaCpoLTIqZioocypzLygtMipjKS1sK2MvMit1LWkvMikpKS9mK3I6KHIrbykvMn1mdW5jdGlvbiBJZShuLHQpe3ZhciBlPW4uTjtpZihlKXJldHVybiBPZShlLHQpO3ZhciByPW4uc2l0ZTtyZXR1cm4gci55PT09dD9yLng6MS8wfWZ1bmN0aW9uIFllKG4pe3RoaXMuc2l0ZT1uLHRoaXMuZWRnZXM9W119ZnVuY3Rpb24gWmUobil7Zm9yKHZhciB0LGUscix1LGksYSxvLGwsYyxzLGY9blswXVswXSxoPW5bMV1bMF0sZz1uWzBdWzFdLHA9blsxXVsxXSx2PXVsLGQ9di5sZW5ndGg7ZC0tOylpZihpPXZbZF0saSYmaS5wcmVwYXJlKCkpZm9yKG89aS5lZGdlcyxsPW8ubGVuZ3RoLGE9MDtsPmE7KXM9b1thXS5lbmQoKSxyPXMueCx1PXMueSxjPW9bKythJWxdLnN0YXJ0KCksdD1jLngsZT1jLnksKE1hKHItdCk+RGF8fE1hKHUtZSk+RGEpJiYoby5zcGxpY2UoYSwwLG5ldyB0cihRZShpLnNpdGUscyxNYShyLWYpPERhJiZwLXU+RGE/e3g6Zix5Ok1hKHQtZik8RGE/ZTpwfTpNYSh1LXApPERhJiZoLXI+RGE/e3g6TWEoZS1wKTxEYT90OmgseTpwfTpNYShyLWgpPERhJiZ1LWc+RGE/e3g6aCx5Ok1hKHQtaCk8RGE/ZTpnfTpNYSh1LWcpPERhJiZyLWY+RGE/e3g6TWEoZS1nKTxEYT90OmYseTpnfTpudWxsKSxpLnNpdGUsbnVsbCkpLCsrbCl9ZnVuY3Rpb24gVmUobix0KXtyZXR1cm4gdC5hbmdsZS1uLmFuZ2xlfWZ1bmN0aW9uIFhlKCl7cnIodGhpcyksdGhpcy54PXRoaXMueT10aGlzLmFyYz10aGlzLnNpdGU9dGhpcy5jeT1udWxsfWZ1bmN0aW9uICRlKG4pe3ZhciB0PW4uUCxlPW4uTjtpZih0JiZlKXt2YXIgcj10LnNpdGUsdT1uLnNpdGUsaT1lLnNpdGU7aWYociE9PWkpe3ZhciBhPXUueCxvPXUueSxsPXIueC1hLGM9ci55LW8scz1pLngtYSxmPWkueS1vLGg9MioobCpmLWMqcyk7aWYoIShoPj0tUGEpKXt2YXIgZz1sKmwrYypjLHA9cypzK2YqZix2PShmKmctYypwKS9oLGQ9KGwqcC1zKmcpL2gsZj1kK28sbT1jbC5wb3AoKXx8bmV3IFhlO20uYXJjPW4sbS5zaXRlPXUsbS54PXYrYSxtLnk9ZitNYXRoLnNxcnQodip2K2QqZCksbS5jeT1mLG4uY2lyY2xlPW07Zm9yKHZhciB5PW51bGwsTT1vbC5fO007KWlmKG0ueTxNLnl8fG0ueT09PU0ueSYmbS54PD1NLngpe2lmKCFNLkwpe3k9TS5QO2JyZWFrfU09TS5MfWVsc2V7aWYoIU0uUil7eT1NO2JyZWFrfU09TS5SfW9sLmluc2VydCh5LG0pLHl8fChhbD1tKX19fX1mdW5jdGlvbiBCZShuKXt2YXIgdD1uLmNpcmNsZTt0JiYodC5QfHwoYWw9dC5OKSxvbC5yZW1vdmUodCksY2wucHVzaCh0KSxycih0KSxuLmNpcmNsZT1udWxsKX1mdW5jdGlvbiBXZShuKXtmb3IodmFyIHQsZT1ybCxyPVl0KG5bMF1bMF0sblswXVsxXSxuWzFdWzBdLG5bMV1bMV0pLHU9ZS5sZW5ndGg7dS0tOyl0PWVbdV0sKCFKZSh0LG4pfHwhcih0KXx8TWEodC5hLngtdC5iLngpPERhJiZNYSh0LmEueS10LmIueSk8RGEpJiYodC5hPXQuYj1udWxsLGUuc3BsaWNlKHUsMSkpfWZ1bmN0aW9uIEplKG4sdCl7dmFyIGU9bi5iO2lmKGUpcmV0dXJuITA7dmFyIHIsdSxpPW4uYSxhPXRbMF1bMF0sbz10WzFdWzBdLGw9dFswXVsxXSxjPXRbMV1bMV0scz1uLmwsZj1uLnIsaD1zLngsZz1zLnkscD1mLngsdj1mLnksZD0oaCtwKS8yLG09KGcrdikvMjtpZih2PT09Zyl7aWYoYT5kfHxkPj1vKXJldHVybjtpZihoPnApe2lmKGkpe2lmKGkueT49YylyZXR1cm59ZWxzZSBpPXt4OmQseTpsfTtlPXt4OmQseTpjfX1lbHNle2lmKGkpe2lmKGkueTxsKXJldHVybn1lbHNlIGk9e3g6ZCx5OmN9O2U9e3g6ZCx5Omx9fX1lbHNlIGlmKHI9KGgtcCkvKHYtZyksdT1tLXIqZCwtMT5yfHxyPjEpaWYoaD5wKXtpZihpKXtpZihpLnk+PWMpcmV0dXJufWVsc2UgaT17eDoobC11KS9yLHk6bH07ZT17eDooYy11KS9yLHk6Y319ZWxzZXtpZihpKXtpZihpLnk8bClyZXR1cm59ZWxzZSBpPXt4OihjLXUpL3IseTpjfTtlPXt4OihsLXUpL3IseTpsfX1lbHNlIGlmKHY+Zyl7aWYoaSl7aWYoaS54Pj1vKXJldHVybn1lbHNlIGk9e3g6YSx5OnIqYSt1fTtlPXt4Om8seTpyKm8rdX19ZWxzZXtpZihpKXtpZihpLng8YSlyZXR1cm59ZWxzZSBpPXt4Om8seTpyKm8rdX07ZT17eDphLHk6ciphK3V9fXJldHVybiBuLmE9aSxuLmI9ZSwhMH1mdW5jdGlvbiBHZShuLHQpe3RoaXMubD1uLHRoaXMucj10LHRoaXMuYT10aGlzLmI9bnVsbH1mdW5jdGlvbiBLZShuLHQsZSxyKXt2YXIgdT1uZXcgR2Uobix0KTtyZXR1cm4gcmwucHVzaCh1KSxlJiZucih1LG4sdCxlKSxyJiZucih1LHQsbixyKSx1bFtuLmldLmVkZ2VzLnB1c2gobmV3IHRyKHUsbix0KSksdWxbdC5pXS5lZGdlcy5wdXNoKG5ldyB0cih1LHQsbikpLHV9ZnVuY3Rpb24gUWUobix0LGUpe3ZhciByPW5ldyBHZShuLG51bGwpO3JldHVybiByLmE9dCxyLmI9ZSxybC5wdXNoKHIpLHJ9ZnVuY3Rpb24gbnIobix0LGUscil7bi5hfHxuLmI/bi5sPT09ZT9uLmI9cjpuLmE9cjoobi5hPXIsbi5sPXQsbi5yPWUpfWZ1bmN0aW9uIHRyKG4sdCxlKXt2YXIgcj1uLmEsdT1uLmI7dGhpcy5lZGdlPW4sdGhpcy5zaXRlPXQsdGhpcy5hbmdsZT1lP01hdGguYXRhbjIoZS55LXQueSxlLngtdC54KTpuLmw9PT10P01hdGguYXRhbjIodS54LXIueCxyLnktdS55KTpNYXRoLmF0YW4yKHIueC11LngsdS55LXIueSl9ZnVuY3Rpb24gZXIoKXt0aGlzLl89bnVsbH1mdW5jdGlvbiBycihuKXtuLlU9bi5DPW4uTD1uLlI9bi5QPW4uTj1udWxsfWZ1bmN0aW9uIHVyKG4sdCl7dmFyIGU9dCxyPXQuUix1PWUuVTt1P3UuTD09PWU/dS5MPXI6dS5SPXI6bi5fPXIsci5VPXUsZS5VPXIsZS5SPXIuTCxlLlImJihlLlIuVT1lKSxyLkw9ZX1mdW5jdGlvbiBpcihuLHQpe3ZhciBlPXQscj10LkwsdT1lLlU7dT91Lkw9PT1lP3UuTD1yOnUuUj1yOm4uXz1yLHIuVT11LGUuVT1yLGUuTD1yLlIsZS5MJiYoZS5MLlU9ZSksci5SPWV9ZnVuY3Rpb24gYXIobil7Zm9yKDtuLkw7KW49bi5MO3JldHVybiBufWZ1bmN0aW9uIG9yKG4sdCl7dmFyIGUscix1LGk9bi5zb3J0KGxyKS5wb3AoKTtmb3Iocmw9W10sdWw9bmV3IEFycmF5KG4ubGVuZ3RoKSxpbD1uZXcgZXIsb2w9bmV3IGVyOzspaWYodT1hbCxpJiYoIXV8fGkueTx1Lnl8fGkueT09PXUueSYmaS54PHUueCkpKGkueCE9PWV8fGkueSE9PXIpJiYodWxbaS5pXT1uZXcgWWUoaSksSGUoaSksZT1pLngscj1pLnkpLGk9bi5wb3AoKTtlbHNle2lmKCF1KWJyZWFrO0ZlKHUuYXJjKX10JiYoV2UodCksWmUodCkpO3ZhciBhPXtjZWxsczp1bCxlZGdlczpybH07cmV0dXJuIGlsPW9sPXJsPXVsPW51bGwsYX1mdW5jdGlvbiBscihuLHQpe3JldHVybiB0Lnktbi55fHx0Lngtbi54fWZ1bmN0aW9uIGNyKG4sdCxlKXtyZXR1cm4obi54LWUueCkqKHQueS1uLnkpLShuLngtdC54KSooZS55LW4ueSl9ZnVuY3Rpb24gc3Iobil7cmV0dXJuIG4ueH1mdW5jdGlvbiBmcihuKXtyZXR1cm4gbi55fWZ1bmN0aW9uIGhyKCl7cmV0dXJue2xlYWY6ITAsbm9kZXM6W10scG9pbnQ6bnVsbCx4Om51bGwseTpudWxsfX1mdW5jdGlvbiBncihuLHQsZSxyLHUsaSl7aWYoIW4odCxlLHIsdSxpKSl7dmFyIGE9LjUqKGUrdSksbz0uNSoocitpKSxsPXQubm9kZXM7bFswXSYmZ3IobixsWzBdLGUscixhLG8pLGxbMV0mJmdyKG4sbFsxXSxhLHIsdSxvKSxsWzJdJiZncihuLGxbMl0sZSxvLGEsaSksbFszXSYmZ3IobixsWzNdLGEsbyx1LGkpfX1mdW5jdGlvbiBwcihuLHQsZSxyLHUsaSxhKXt2YXIgbyxsPTEvMDtyZXR1cm4gZnVuY3Rpb24gYyhuLHMsZixoLGcpe2lmKCEocz5pfHxmPmF8fHI+aHx8dT5nKSl7aWYocD1uLnBvaW50KXt2YXIgcCx2PXQtbi54LGQ9ZS1uLnksbT12KnYrZCpkO2lmKGw+bSl7dmFyIHk9TWF0aC5zcXJ0KGw9bSk7cj10LXksdT1lLXksaT10K3ksYT1lK3ksbz1wfX1mb3IodmFyIE09bi5ub2Rlcyx4PS41KihzK2gpLGI9LjUqKGYrZyksXz10Pj14LHc9ZT49YixTPXc8PDF8XyxrPVMrNDtrPlM7KytTKWlmKG49TVszJlNdKXN3aXRjaCgzJlMpe2Nhc2UgMDpjKG4scyxmLHgsYik7YnJlYWs7Y2FzZSAxOmMobix4LGYsaCxiKTticmVhaztjYXNlIDI6YyhuLHMsYix4LGcpO2JyZWFrO2Nhc2UgMzpjKG4seCxiLGgsZyl9fX0obixyLHUsaSxhKSxvfWZ1bmN0aW9uIHZyKG4sdCl7bj1vYS5yZ2IobiksdD1vYS5yZ2IodCk7dmFyIGU9bi5yLHI9bi5nLHU9bi5iLGk9dC5yLWUsYT10LmctcixvPXQuYi11O3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4iIyIrYm4oTWF0aC5yb3VuZChlK2kqbikpK2JuKE1hdGgucm91bmQocithKm4pKStibihNYXRoLnJvdW5kKHUrbypuKSl9fWZ1bmN0aW9uIGRyKG4sdCl7dmFyIGUscj17fSx1PXt9O2ZvcihlIGluIG4pZSBpbiB0P3JbZV09TXIobltlXSx0W2VdKTp1W2VdPW5bZV07Zm9yKGUgaW4gdCllIGluIG58fCh1W2VdPXRbZV0pO3JldHVybiBmdW5jdGlvbihuKXtmb3IoZSBpbiByKXVbZV09cltlXShuKTtyZXR1cm4gdX19ZnVuY3Rpb24gbXIobix0KXtyZXR1cm4gbj0rbix0PSt0LGZ1bmN0aW9uKGUpe3JldHVybiBuKigxLWUpK3QqZX19ZnVuY3Rpb24geXIobix0KXt2YXIgZSxyLHUsaT1mbC5sYXN0SW5kZXg9aGwubGFzdEluZGV4PTAsYT0tMSxvPVtdLGw9W107Zm9yKG4rPSIiLHQrPSIiOyhlPWZsLmV4ZWMobikpJiYocj1obC5leGVjKHQpKTspKHU9ci5pbmRleCk+aSYmKHU9dC5zbGljZShpLHUpLG9bYV0/b1thXSs9dTpvWysrYV09dSksKGU9ZVswXSk9PT0ocj1yWzBdKT9vW2FdP29bYV0rPXI6b1srK2FdPXI6KG9bKythXT1udWxsLGwucHVzaCh7aTphLHg6bXIoZSxyKX0pKSxpPWhsLmxhc3RJbmRleDtyZXR1cm4gaTx0Lmxlbmd0aCYmKHU9dC5zbGljZShpKSxvW2FdP29bYV0rPXU6b1srK2FdPXUpLG8ubGVuZ3RoPDI/bFswXT8odD1sWzBdLngsZnVuY3Rpb24obil7cmV0dXJuIHQobikrIiJ9KTpmdW5jdGlvbigpe3JldHVybiB0fToodD1sLmxlbmd0aCxmdW5jdGlvbihuKXtmb3IodmFyIGUscj0wO3Q+cjsrK3Ipb1soZT1sW3JdKS5pXT1lLngobik7cmV0dXJuIG8uam9pbigiIil9KX1mdW5jdGlvbiBNcihuLHQpe2Zvcih2YXIgZSxyPW9hLmludGVycG9sYXRvcnMubGVuZ3RoOy0tcj49MCYmIShlPW9hLmludGVycG9sYXRvcnNbcl0obix0KSk7KTtyZXR1cm4gZX1mdW5jdGlvbiB4cihuLHQpe3ZhciBlLHI9W10sdT1bXSxpPW4ubGVuZ3RoLGE9dC5sZW5ndGgsbz1NYXRoLm1pbihuLmxlbmd0aCx0Lmxlbmd0aCk7Zm9yKGU9MDtvPmU7KytlKXIucHVzaChNcihuW2VdLHRbZV0pKTtmb3IoO2k+ZTsrK2UpdVtlXT1uW2VdO2Zvcig7YT5lOysrZSl1W2VdPXRbZV07cmV0dXJuIGZ1bmN0aW9uKG4pe2ZvcihlPTA7bz5lOysrZSl1W2VdPXJbZV0obik7cmV0dXJuIHV9fWZ1bmN0aW9uIGJyKG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gMD49dD8wOnQ+PTE/MTpuKHQpfX1mdW5jdGlvbiBfcihuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDEtbigxLXQpfX1mdW5jdGlvbiB3cihuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuLjUqKC41PnQ/bigyKnQpOjItbigyLTIqdCkpfX1mdW5jdGlvbiBTcihuKXtyZXR1cm4gbipufWZ1bmN0aW9uIGtyKG4pe3JldHVybiBuKm4qbn1mdW5jdGlvbiBOcihuKXtpZigwPj1uKXJldHVybiAwO2lmKG4+PTEpcmV0dXJuIDE7dmFyIHQ9bipuLGU9dCpuO3JldHVybiA0KiguNT5uP2U6Myoobi10KStlLS43NSl9ZnVuY3Rpb24gRXIobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdyh0LG4pfX1mdW5jdGlvbiBBcihuKXtyZXR1cm4gMS1NYXRoLmNvcyhuKkhhKX1mdW5jdGlvbiBDcihuKXtyZXR1cm4gTWF0aC5wb3coMiwxMCoobi0xKSl9ZnVuY3Rpb24genIobil7cmV0dXJuIDEtTWF0aC5zcXJ0KDEtbipuKX1mdW5jdGlvbiBMcihuLHQpe3ZhciBlO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDImJih0PS40NSksYXJndW1lbnRzLmxlbmd0aD9lPXQvamEqTWF0aC5hc2luKDEvbik6KG49MSxlPXQvNCksZnVuY3Rpb24ocil7cmV0dXJuIDErbipNYXRoLnBvdygyLC0xMCpyKSpNYXRoLnNpbigoci1lKSpqYS90KX19ZnVuY3Rpb24gcXIobil7cmV0dXJuIG58fChuPTEuNzAxNTgpLGZ1bmN0aW9uKHQpe3JldHVybiB0KnQqKChuKzEpKnQtbil9fWZ1bmN0aW9uIFRyKG4pe3JldHVybiAxLzIuNzU+bj83LjU2MjUqbipuOjIvMi43NT5uPzcuNTYyNSoobi09MS41LzIuNzUpKm4rLjc1OjIuNS8yLjc1Pm4/Ny41NjI1KihuLT0yLjI1LzIuNzUpKm4rLjkzNzU6Ny41NjI1KihuLT0yLjYyNS8yLjc1KSpuKy45ODQzNzV9ZnVuY3Rpb24gUnIobix0KXtuPW9hLmhjbChuKSx0PW9hLmhjbCh0KTt2YXIgZT1uLmgscj1uLmMsdT1uLmwsaT10LmgtZSxhPXQuYy1yLG89dC5sLXU7cmV0dXJuIGlzTmFOKGEpJiYoYT0wLHI9aXNOYU4ocik/dC5jOnIpLGlzTmFOKGkpPyhpPTAsZT1pc05hTihlKT90Lmg6ZSk6aT4xODA/aS09MzYwOi0xODA+aSYmKGkrPTM2MCksZnVuY3Rpb24obil7cmV0dXJuIGZuKGUraSpuLHIrYSpuLHUrbypuKSsiIn19ZnVuY3Rpb24gRHIobix0KXtuPW9hLmhzbChuKSx0PW9hLmhzbCh0KTt2YXIgZT1uLmgscj1uLnMsdT1uLmwsaT10LmgtZSxhPXQucy1yLG89dC5sLXU7cmV0dXJuIGlzTmFOKGEpJiYoYT0wLHI9aXNOYU4ocik/dC5zOnIpLGlzTmFOKGkpPyhpPTAsZT1pc05hTihlKT90Lmg6ZSk6aT4xODA/aS09MzYwOi0xODA+aSYmKGkrPTM2MCksZnVuY3Rpb24obil7cmV0dXJuIGNuKGUraSpuLHIrYSpuLHUrbypuKSsiIn19ZnVuY3Rpb24gUHIobix0KXtuPW9hLmxhYihuKSx0PW9hLmxhYih0KTt2YXIgZT1uLmwscj1uLmEsdT1uLmIsaT10LmwtZSxhPXQuYS1yLG89dC5iLXU7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBnbihlK2kqbixyK2Eqbix1K28qbikrIiJ9fWZ1bmN0aW9uIFVyKG4sdCl7cmV0dXJuIHQtPW4sZnVuY3Rpb24oZSl7cmV0dXJuIE1hdGgucm91bmQobit0KmUpfX1mdW5jdGlvbiBqcihuKXt2YXIgdD1bbi5hLG4uYl0sZT1bbi5jLG4uZF0scj1Icih0KSx1PUZyKHQsZSksaT1IcihPcihlLHQsLXUpKXx8MDt0WzBdKmVbMV08ZVswXSp0WzFdJiYodFswXSo9LTEsdFsxXSo9LTEscio9LTEsdSo9LTEpLHRoaXMucm90YXRlPShyP01hdGguYXRhbjIodFsxXSx0WzBdKTpNYXRoLmF0YW4yKC1lWzBdLGVbMV0pKSpJYSx0aGlzLnRyYW5zbGF0ZT1bbi5lLG4uZl0sdGhpcy5zY2FsZT1bcixpXSx0aGlzLnNrZXc9aT9NYXRoLmF0YW4yKHUsaSkqSWE6MH1mdW5jdGlvbiBGcihuLHQpe3JldHVybiBuWzBdKnRbMF0rblsxXSp0WzFdfWZ1bmN0aW9uIEhyKG4pe3ZhciB0PU1hdGguc3FydChGcihuLG4pKTtyZXR1cm4gdCYmKG5bMF0vPXQsblsxXS89dCksdH1mdW5jdGlvbiBPcihuLHQsZSl7cmV0dXJuIG5bMF0rPWUqdFswXSxuWzFdKz1lKnRbMV0sbn1mdW5jdGlvbiBJcihuKXtyZXR1cm4gbi5sZW5ndGg/bi5wb3AoKSsiLCI6IiJ9ZnVuY3Rpb24gWXIobix0LGUscil7aWYoblswXSE9PXRbMF18fG5bMV0hPT10WzFdKXt2YXIgdT1lLnB1c2goInRyYW5zbGF0ZSgiLG51bGwsIiwiLG51bGwsIikiKTtyLnB1c2goe2k6dS00LHg6bXIoblswXSx0WzBdKX0se2k6dS0yLHg6bXIoblsxXSx0WzFdKX0pfWVsc2UodFswXXx8dFsxXSkmJmUucHVzaCgidHJhbnNsYXRlKCIrdCsiKSIpfWZ1bmN0aW9uIFpyKG4sdCxlLHIpe24hPT10PyhuLXQ+MTgwP3QrPTM2MDp0LW4+MTgwJiYobis9MzYwKSxyLnB1c2goe2k6ZS5wdXNoKElyKGUpKyJyb3RhdGUoIixudWxsLCIpIiktMix4Om1yKG4sdCl9KSk6dCYmZS5wdXNoKElyKGUpKyJyb3RhdGUoIit0KyIpIil9ZnVuY3Rpb24gVnIobix0LGUscil7biE9PXQ/ci5wdXNoKHtpOmUucHVzaChJcihlKSsic2tld1goIixudWxsLCIpIiktMix4Om1yKG4sdCl9KTp0JiZlLnB1c2goSXIoZSkrInNrZXdYKCIrdCsiKSIpfWZ1bmN0aW9uIFhyKG4sdCxlLHIpe2lmKG5bMF0hPT10WzBdfHxuWzFdIT09dFsxXSl7dmFyIHU9ZS5wdXNoKElyKGUpKyJzY2FsZSgiLG51bGwsIiwiLG51bGwsIikiKTtyLnB1c2goe2k6dS00LHg6bXIoblswXSx0WzBdKX0se2k6dS0yLHg6bXIoblsxXSx0WzFdKX0pfWVsc2UoMSE9PXRbMF18fDEhPT10WzFdKSYmZS5wdXNoKElyKGUpKyJzY2FsZSgiK3QrIikiKX1mdW5jdGlvbiAkcihuLHQpe3ZhciBlPVtdLHI9W107cmV0dXJuIG49b2EudHJhbnNmb3JtKG4pLHQ9b2EudHJhbnNmb3JtKHQpLFlyKG4udHJhbnNsYXRlLHQudHJhbnNsYXRlLGUsciksWnIobi5yb3RhdGUsdC5yb3RhdGUsZSxyKSxWcihuLnNrZXcsdC5za2V3LGUsciksWHIobi5zY2FsZSx0LnNjYWxlLGUsciksbj10PW51bGwsZnVuY3Rpb24obil7Zm9yKHZhciB0LHU9LTEsaT1yLmxlbmd0aDsrK3U8aTspZVsodD1yW3VdKS5pXT10Lngobik7cmV0dXJuIGUuam9pbigiIil9fWZ1bmN0aW9uIEJyKG4sdCl7cmV0dXJuIHQ9KHQtPW49K24pfHwxL3QsZnVuY3Rpb24oZSl7cmV0dXJuKGUtbikvdH19ZnVuY3Rpb24gV3Iobix0KXtyZXR1cm4gdD0odC09bj0rbil8fDEvdCxmdW5jdGlvbihlKXtyZXR1cm4gTWF0aC5tYXgoMCxNYXRoLm1pbigxLChlLW4pL3QpKX19ZnVuY3Rpb24gSnIobil7Zm9yKHZhciB0PW4uc291cmNlLGU9bi50YXJnZXQscj1Lcih0LGUpLHU9W3RdO3QhPT1yOyl0PXQucGFyZW50LHUucHVzaCh0KTtmb3IodmFyIGk9dS5sZW5ndGg7ZSE9PXI7KXUuc3BsaWNlKGksMCxlKSxlPWUucGFyZW50O3JldHVybiB1fWZ1bmN0aW9uIEdyKG4pe2Zvcih2YXIgdD1bXSxlPW4ucGFyZW50O251bGwhPWU7KXQucHVzaChuKSxuPWUsZT1lLnBhcmVudDtyZXR1cm4gdC5wdXNoKG4pLHR9ZnVuY3Rpb24gS3Iobix0KXtpZihuPT09dClyZXR1cm4gbjtmb3IodmFyIGU9R3Iobikscj1Hcih0KSx1PWUucG9wKCksaT1yLnBvcCgpLGE9bnVsbDt1PT09aTspYT11LHU9ZS5wb3AoKSxpPXIucG9wKCk7cmV0dXJuIGF9ZnVuY3Rpb24gUXIobil7bi5maXhlZHw9Mn1mdW5jdGlvbiBudShuKXtuLmZpeGVkJj0tN31mdW5jdGlvbiB0dShuKXtuLmZpeGVkfD00LG4ucHg9bi54LG4ucHk9bi55fWZ1bmN0aW9uIGV1KG4pe24uZml4ZWQmPS01fWZ1bmN0aW9uIHJ1KG4sdCxlKXt2YXIgcj0wLHU9MDtpZihuLmNoYXJnZT0wLCFuLmxlYWYpZm9yKHZhciBpLGE9bi5ub2RlcyxvPWEubGVuZ3RoLGw9LTE7KytsPG87KWk9YVtsXSxudWxsIT1pJiYocnUoaSx0LGUpLG4uY2hhcmdlKz1pLmNoYXJnZSxyKz1pLmNoYXJnZSppLmN4LHUrPWkuY2hhcmdlKmkuY3kpO2lmKG4ucG9pbnQpe24ubGVhZnx8KG4ucG9pbnQueCs9TWF0aC5yYW5kb20oKS0uNSxuLnBvaW50LnkrPU1hdGgucmFuZG9tKCktLjUpO3ZhciBjPXQqZVtuLnBvaW50LmluZGV4XTtuLmNoYXJnZSs9bi5wb2ludENoYXJnZT1jLHIrPWMqbi5wb2ludC54LHUrPWMqbi5wb2ludC55fW4uY3g9ci9uLmNoYXJnZSxuLmN5PXUvbi5jaGFyZ2V9ZnVuY3Rpb24gdXUobix0KXtyZXR1cm4gb2EucmViaW5kKG4sdCwic29ydCIsImNoaWxkcmVuIiwidmFsdWUiKSxuLm5vZGVzPW4sbi5saW5rcz1zdSxufWZ1bmN0aW9uIGl1KG4sdCl7Zm9yKHZhciBlPVtuXTtudWxsIT0obj1lLnBvcCgpKTspaWYodChuKSwodT1uLmNoaWxkcmVuKSYmKHI9dS5sZW5ndGgpKWZvcih2YXIgcix1Oy0tcj49MDspZS5wdXNoKHVbcl0pfWZ1bmN0aW9uIGF1KG4sdCl7Zm9yKHZhciBlPVtuXSxyPVtdO251bGwhPShuPWUucG9wKCkpOylpZihyLnB1c2gobiksKGk9bi5jaGlsZHJlbikmJih1PWkubGVuZ3RoKSlmb3IodmFyIHUsaSxhPS0xOysrYTx1OyllLnB1c2goaVthXSk7Zm9yKDtudWxsIT0obj1yLnBvcCgpKTspdChuKX1mdW5jdGlvbiBvdShuKXtyZXR1cm4gbi5jaGlsZHJlbn1mdW5jdGlvbiBsdShuKXtyZXR1cm4gbi52YWx1ZX1mdW5jdGlvbiBjdShuLHQpe3JldHVybiB0LnZhbHVlLW4udmFsdWV9ZnVuY3Rpb24gc3Uobil7cmV0dXJuIG9hLm1lcmdlKG4ubWFwKGZ1bmN0aW9uKG4pe3JldHVybihuLmNoaWxkcmVufHxbXSkubWFwKGZ1bmN0aW9uKHQpe3JldHVybntzb3VyY2U6bix0YXJnZXQ6dH19KX0pKX1mdW5jdGlvbiBmdShuKXtyZXR1cm4gbi54fWZ1bmN0aW9uIGh1KG4pe3JldHVybiBuLnl9ZnVuY3Rpb24gZ3Uobix0LGUpe24ueTA9dCxuLnk9ZX1mdW5jdGlvbiBwdShuKXtyZXR1cm4gb2EucmFuZ2Uobi5sZW5ndGgpfWZ1bmN0aW9uIHZ1KG4pe2Zvcih2YXIgdD0tMSxlPW5bMF0ubGVuZ3RoLHI9W107Kyt0PGU7KXJbdF09MDtyZXR1cm4gcn1mdW5jdGlvbiBkdShuKXtmb3IodmFyIHQsZT0xLHI9MCx1PW5bMF1bMV0saT1uLmxlbmd0aDtpPmU7KytlKSh0PW5bZV1bMV0pPnUmJihyPWUsdT10KTtyZXR1cm4gcn1mdW5jdGlvbiBtdShuKXtyZXR1cm4gbi5yZWR1Y2UoeXUsMCl9ZnVuY3Rpb24geXUobix0KXtyZXR1cm4gbit0WzFdfWZ1bmN0aW9uIE11KG4sdCl7cmV0dXJuIHh1KG4sTWF0aC5jZWlsKE1hdGgubG9nKHQubGVuZ3RoKS9NYXRoLkxOMisxKSl9ZnVuY3Rpb24geHUobix0KXtmb3IodmFyIGU9LTEscj0rblswXSx1PShuWzFdLXIpL3QsaT1bXTsrK2U8PXQ7KWlbZV09dSplK3I7cmV0dXJuIGl9ZnVuY3Rpb24gYnUobil7cmV0dXJuW29hLm1pbihuKSxvYS5tYXgobildfWZ1bmN0aW9uIF91KG4sdCl7cmV0dXJuIG4udmFsdWUtdC52YWx1ZX1mdW5jdGlvbiB3dShuLHQpe3ZhciBlPW4uX3BhY2tfbmV4dDtuLl9wYWNrX25leHQ9dCx0Ll9wYWNrX3ByZXY9bix0Ll9wYWNrX25leHQ9ZSxlLl9wYWNrX3ByZXY9dH1mdW5jdGlvbiBTdShuLHQpe24uX3BhY2tfbmV4dD10LHQuX3BhY2tfcHJldj1ufWZ1bmN0aW9uIGt1KG4sdCl7dmFyIGU9dC54LW4ueCxyPXQueS1uLnksdT1uLnIrdC5yO3JldHVybi45OTkqdSp1PmUqZStyKnJ9ZnVuY3Rpb24gTnUobil7ZnVuY3Rpb24gdChuKXtzPU1hdGgubWluKG4ueC1uLnIscyksZj1NYXRoLm1heChuLngrbi5yLGYpLGg9TWF0aC5taW4obi55LW4ucixoKSxnPU1hdGgubWF4KG4ueStuLnIsZyl9aWYoKGU9bi5jaGlsZHJlbikmJihjPWUubGVuZ3RoKSl7dmFyIGUscix1LGksYSxvLGwsYyxzPTEvMCxmPS0oMS8wKSxoPTEvMCxnPS0oMS8wKTtpZihlLmZvckVhY2goRXUpLHI9ZVswXSxyLng9LXIucixyLnk9MCx0KHIpLGM+MSYmKHU9ZVsxXSx1Lng9dS5yLHUueT0wLHQodSksYz4yKSlmb3IoaT1lWzJdLHp1KHIsdSxpKSx0KGkpLHd1KHIsaSksci5fcGFja19wcmV2PWksd3UoaSx1KSx1PXIuX3BhY2tfbmV4dCxhPTM7Yz5hO2ErKyl7enUocix1LGk9ZVthXSk7dmFyIHA9MCx2PTEsZD0xO2ZvcihvPXUuX3BhY2tfbmV4dDtvIT09dTtvPW8uX3BhY2tfbmV4dCx2KyspaWYoa3UobyxpKSl7cD0xO2JyZWFrfWlmKDE9PXApZm9yKGw9ci5fcGFja19wcmV2O2whPT1vLl9wYWNrX3ByZXYmJiFrdShsLGkpO2w9bC5fcGFja19wcmV2LGQrKyk7cD8oZD52fHx2PT1kJiZ1LnI8ci5yP1N1KHIsdT1vKTpTdShyPWwsdSksYS0tKTood3UocixpKSx1PWksdChpKSl9dmFyIG09KHMrZikvMix5PShoK2cpLzIsTT0wO2ZvcihhPTA7Yz5hO2ErKylpPWVbYV0saS54LT1tLGkueS09eSxNPU1hdGgubWF4KE0saS5yK01hdGguc3FydChpLngqaS54K2kueSppLnkpKTtuLnI9TSxlLmZvckVhY2goQXUpfX1mdW5jdGlvbiBFdShuKXtuLl9wYWNrX25leHQ9bi5fcGFja19wcmV2PW59ZnVuY3Rpb24gQXUobil7ZGVsZXRlIG4uX3BhY2tfbmV4dCxkZWxldGUgbi5fcGFja19wcmV2fWZ1bmN0aW9uIEN1KG4sdCxlLHIpe3ZhciB1PW4uY2hpbGRyZW47aWYobi54PXQrPXIqbi54LG4ueT1lKz1yKm4ueSxuLnIqPXIsdSlmb3IodmFyIGk9LTEsYT11Lmxlbmd0aDsrK2k8YTspQ3UodVtpXSx0LGUscil9ZnVuY3Rpb24genUobix0LGUpe3ZhciByPW4ucitlLnIsdT10Lngtbi54LGk9dC55LW4ueTtpZihyJiYodXx8aSkpe3ZhciBhPXQucitlLnIsbz11KnUraSppO2EqPWEscio9cjt2YXIgbD0uNSsoci1hKS8oMipvKSxjPU1hdGguc3FydChNYXRoLm1heCgwLDIqYSoocitvKS0oci09bykqci1hKmEpKS8oMipvKTtlLng9bi54K2wqdStjKmksZS55PW4ueStsKmktYyp1fWVsc2UgZS54PW4ueCtyLGUueT1uLnl9ZnVuY3Rpb24gTHUobix0KXtyZXR1cm4gbi5wYXJlbnQ9PXQucGFyZW50PzE6Mn1mdW5jdGlvbiBxdShuKXt2YXIgdD1uLmNoaWxkcmVuO3JldHVybiB0Lmxlbmd0aD90WzBdOm4udH1mdW5jdGlvbiBUdShuKXt2YXIgdCxlPW4uY2hpbGRyZW47cmV0dXJuKHQ9ZS5sZW5ndGgpP2VbdC0xXTpuLnR9ZnVuY3Rpb24gUnUobix0LGUpe3ZhciByPWUvKHQuaS1uLmkpO3QuYy09cix0LnMrPWUsbi5jKz1yLHQueis9ZSx0Lm0rPWV9ZnVuY3Rpb24gRHUobil7Zm9yKHZhciB0LGU9MCxyPTAsdT1uLmNoaWxkcmVuLGk9dS5sZW5ndGg7LS1pPj0wOyl0PXVbaV0sdC56Kz1lLHQubSs9ZSxlKz10LnMrKHIrPXQuYyl9ZnVuY3Rpb24gUHUobix0LGUpe3JldHVybiBuLmEucGFyZW50PT09dC5wYXJlbnQ/bi5hOmV9ZnVuY3Rpb24gVXUobil7cmV0dXJuIDErb2EubWF4KG4sZnVuY3Rpb24obil7cmV0dXJuIG4ueX0pfWZ1bmN0aW9uIGp1KG4pe3JldHVybiBuLnJlZHVjZShmdW5jdGlvbihuLHQpe3JldHVybiBuK3QueH0sMCkvbi5sZW5ndGh9ZnVuY3Rpb24gRnUobil7dmFyIHQ9bi5jaGlsZHJlbjtyZXR1cm4gdCYmdC5sZW5ndGg/RnUodFswXSk6bn1mdW5jdGlvbiBIdShuKXt2YXIgdCxlPW4uY2hpbGRyZW47cmV0dXJuIGUmJih0PWUubGVuZ3RoKT9IdShlW3QtMV0pOm59ZnVuY3Rpb24gT3Uobil7cmV0dXJue3g6bi54LHk6bi55LGR4Om4uZHgsZHk6bi5keX19ZnVuY3Rpb24gSXUobix0KXt2YXIgZT1uLngrdFszXSxyPW4ueSt0WzBdLHU9bi5keC10WzFdLXRbM10saT1uLmR5LXRbMF0tdFsyXTtyZXR1cm4gMD51JiYoZSs9dS8yLHU9MCksMD5pJiYocis9aS8yLGk9MCkse3g6ZSx5OnIsZHg6dSxkeTppfX1mdW5jdGlvbiBZdShuKXt2YXIgdD1uWzBdLGU9bltuLmxlbmd0aC0xXTtyZXR1cm4gZT50P1t0LGVdOltlLHRdfWZ1bmN0aW9uIFp1KG4pe3JldHVybiBuLnJhbmdlRXh0ZW50P24ucmFuZ2VFeHRlbnQoKTpZdShuLnJhbmdlKCkpfWZ1bmN0aW9uIFZ1KG4sdCxlLHIpe3ZhciB1PWUoblswXSxuWzFdKSxpPXIodFswXSx0WzFdKTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIGkodShuKSl9fWZ1bmN0aW9uIFh1KG4sdCl7dmFyIGUscj0wLHU9bi5sZW5ndGgtMSxpPW5bcl0sYT1uW3VdO3JldHVybiBpPmEmJihlPXIscj11LHU9ZSxlPWksaT1hLGE9ZSksbltyXT10LmZsb29yKGkpLG5bdV09dC5jZWlsKGEpLG59ZnVuY3Rpb24gJHUobil7cmV0dXJuIG4/e2Zsb29yOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLmZsb29yKHQvbikqbn0sY2VpbDpmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5jZWlsKHQvbikqbn19OndsfWZ1bmN0aW9uIEJ1KG4sdCxlLHIpe3ZhciB1PVtdLGk9W10sYT0wLG89TWF0aC5taW4obi5sZW5ndGgsdC5sZW5ndGgpLTE7Zm9yKG5bb108blswXSYmKG49bi5zbGljZSgpLnJldmVyc2UoKSx0PXQuc2xpY2UoKS5yZXZlcnNlKCkpOysrYTw9bzspdS5wdXNoKGUoblthLTFdLG5bYV0pKSxpLnB1c2gocih0W2EtMV0sdFthXSkpO3JldHVybiBmdW5jdGlvbih0KXt2YXIgZT1vYS5iaXNlY3Qobix0LDEsbyktMTtyZXR1cm4gaVtlXSh1W2VdKHQpKX19ZnVuY3Rpb24gV3Uobix0LGUscil7ZnVuY3Rpb24gdSgpe3ZhciB1PU1hdGgubWluKG4ubGVuZ3RoLHQubGVuZ3RoKT4yP0J1OlZ1LGw9cj9XcjpCcjtyZXR1cm4gYT11KG4sdCxsLGUpLG89dSh0LG4sbCxNciksaX1mdW5jdGlvbiBpKG4pe3JldHVybiBhKG4pfXZhciBhLG87cmV0dXJuIGkuaW52ZXJ0PWZ1bmN0aW9uKG4pe3JldHVybiBvKG4pfSxpLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj10Lm1hcChOdW1iZXIpLHUoKSk6bn0saS5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1uLHUoKSk6dH0saS5yYW5nZVJvdW5kPWZ1bmN0aW9uKG4pe3JldHVybiBpLnJhbmdlKG4pLmludGVycG9sYXRlKFVyKX0saS5jbGFtcD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1uLHUoKSk6cn0saS5pbnRlcnBvbGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHUoKSk6ZX0saS50aWNrcz1mdW5jdGlvbih0KXtyZXR1cm4gUXUobix0KX0saS50aWNrRm9ybWF0PWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5pKG4sdCxlKX0saS5uaWNlPWZ1bmN0aW9uKHQpe3JldHVybiBHdShuLHQpLHUoKX0saS5jb3B5PWZ1bmN0aW9uKCl7cmV0dXJuIFd1KG4sdCxlLHIpfSx1KCl9ZnVuY3Rpb24gSnUobix0KXtyZXR1cm4gb2EucmViaW5kKG4sdCwicmFuZ2UiLCJyYW5nZVJvdW5kIiwiaW50ZXJwb2xhdGUiLCJjbGFtcCIpfWZ1bmN0aW9uIEd1KG4sdCl7cmV0dXJuIFh1KG4sJHUoS3Uobix0KVsyXSkpLFh1KG4sJHUoS3Uobix0KVsyXSkpLG59ZnVuY3Rpb24gS3Uobix0KXtudWxsPT10JiYodD0xMCk7dmFyIGU9WXUobikscj1lWzFdLWVbMF0sdT1NYXRoLnBvdygxMCxNYXRoLmZsb29yKE1hdGgubG9nKHIvdCkvTWF0aC5MTjEwKSksaT10L3IqdTtyZXR1cm4uMTU+PWk/dSo9MTA6LjM1Pj1pP3UqPTU6Ljc1Pj1pJiYodSo9MiksZVswXT1NYXRoLmNlaWwoZVswXS91KSp1LGVbMV09TWF0aC5mbG9vcihlWzFdL3UpKnUrLjUqdSxlWzJdPXUsZX1mdW5jdGlvbiBRdShuLHQpe3JldHVybiBvYS5yYW5nZS5hcHBseShvYSxLdShuLHQpKX1mdW5jdGlvbiBuaShuLHQsZSl7dmFyIHI9S3Uobix0KTtpZihlKXt2YXIgdT1zby5leGVjKGUpO2lmKHUuc2hpZnQoKSwicyI9PT11WzhdKXt2YXIgaT1vYS5mb3JtYXRQcmVmaXgoTWF0aC5tYXgoTWEoclswXSksTWEoclsxXSkpKTtyZXR1cm4gdVs3XXx8KHVbN109Ii4iK3RpKGkuc2NhbGUoclsyXSkpKSx1WzhdPSJmIixlPW9hLmZvcm1hdCh1LmpvaW4oIiIpKSxmdW5jdGlvbihuKXtyZXR1cm4gZShpLnNjYWxlKG4pKStpLnN5bWJvbH19dVs3XXx8KHVbN109Ii4iK2VpKHVbOF0scikpLGU9dS5qb2luKCIiKX1lbHNlIGU9IiwuIit0aShyWzJdKSsiZiI7cmV0dXJuIG9hLmZvcm1hdChlKX1mdW5jdGlvbiB0aShuKXtyZXR1cm4tTWF0aC5mbG9vcihNYXRoLmxvZyhuKS9NYXRoLkxOMTArLjAxKX1mdW5jdGlvbiBlaShuLHQpe3ZhciBlPXRpKHRbMl0pO3JldHVybiBuIGluIFNsP01hdGguYWJzKGUtdGkoTWF0aC5tYXgoTWEodFswXSksTWEodFsxXSkpKSkrICsoImUiIT09bik6ZS0yKigiJSI9PT1uKX1mdW5jdGlvbiByaShuLHQsZSxyKXtmdW5jdGlvbiB1KG4pe3JldHVybihlP01hdGgubG9nKDA+bj8wOm4pOi1NYXRoLmxvZyhuPjA/MDotbikpL01hdGgubG9nKHQpfWZ1bmN0aW9uIGkobil7cmV0dXJuIGU/TWF0aC5wb3codCxuKTotTWF0aC5wb3codCwtbil9ZnVuY3Rpb24gYSh0KXtyZXR1cm4gbih1KHQpKX1yZXR1cm4gYS5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGkobi5pbnZlcnQodCkpfSxhLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT10WzBdPj0wLG4uZG9tYWluKChyPXQubWFwKE51bWJlcikpLm1hcCh1KSksYSk6cn0sYS5iYXNlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PStlLG4uZG9tYWluKHIubWFwKHUpKSxhKTp0fSxhLm5pY2U9ZnVuY3Rpb24oKXt2YXIgdD1YdShyLm1hcCh1KSxlP01hdGg6TmwpO3JldHVybiBuLmRvbWFpbih0KSxyPXQubWFwKGkpLGF9LGEudGlja3M9ZnVuY3Rpb24oKXt2YXIgbj1ZdShyKSxhPVtdLG89blswXSxsPW5bMV0sYz1NYXRoLmZsb29yKHUobykpLHM9TWF0aC5jZWlsKHUobCkpLGY9dCUxPzI6dDtpZihpc0Zpbml0ZShzLWMpKXtpZihlKXtmb3IoO3M+YztjKyspZm9yKHZhciBoPTE7Zj5oO2grKylhLnB1c2goaShjKSpoKTthLnB1c2goaShjKSl9ZWxzZSBmb3IoYS5wdXNoKGkoYykpO2MrKzxzOylmb3IodmFyIGg9Zi0xO2g+MDtoLS0pYS5wdXNoKGkoYykqaCk7Zm9yKGM9MDthW2NdPG87YysrKTtmb3Iocz1hLmxlbmd0aDthW3MtMV0+bDtzLS0pO2E9YS5zbGljZShjLHMpfXJldHVybiBhfSxhLnRpY2tGb3JtYXQ9ZnVuY3Rpb24obixlKXtpZighYXJndW1lbnRzLmxlbmd0aClyZXR1cm4ga2w7YXJndW1lbnRzLmxlbmd0aDwyP2U9a2w6ImZ1bmN0aW9uIiE9dHlwZW9mIGUmJihlPW9hLmZvcm1hdChlKSk7dmFyIHI9TWF0aC5tYXgoMSx0Km4vYS50aWNrcygpLmxlbmd0aCk7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciBhPW4vaShNYXRoLnJvdW5kKHUobikpKTtyZXR1cm4gdC0uNT5hKnQmJihhKj10KSxyPj1hP2Uobik6IiJ9fSxhLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gcmkobi5jb3B5KCksdCxlLHIpfSxKdShhLG4pfWZ1bmN0aW9uIHVpKG4sdCxlKXtmdW5jdGlvbiByKHQpe3JldHVybiBuKHUodCkpfXZhciB1PWlpKHQpLGk9aWkoMS90KTtyZXR1cm4gci5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGkobi5pbnZlcnQodCkpfSxyLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obi5kb21haW4oKGU9dC5tYXAoTnVtYmVyKSkubWFwKHUpKSxyKTplfSxyLnRpY2tzPWZ1bmN0aW9uKG4pe3JldHVybiBRdShlLG4pfSxyLnRpY2tGb3JtYXQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gbmkoZSxuLHQpfSxyLm5pY2U9ZnVuY3Rpb24obil7cmV0dXJuIHIuZG9tYWluKEd1KGUsbikpfSxyLmV4cG9uZW50PWZ1bmN0aW9uKGEpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PWlpKHQ9YSksaT1paSgxL3QpLG4uZG9tYWluKGUubWFwKHUpKSxyKTp0fSxyLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gdWkobi5jb3B5KCksdCxlKX0sSnUocixuKX1mdW5jdGlvbiBpaShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDA+dD8tTWF0aC5wb3coLXQsbik6TWF0aC5wb3codCxuKX19ZnVuY3Rpb24gYWkobix0KXtmdW5jdGlvbiBlKGUpe3JldHVybiBpWygodS5nZXQoZSl8fCgicmFuZ2UiPT09dC50P3Uuc2V0KGUsbi5wdXNoKGUpKTpOYU4pKS0xKSVpLmxlbmd0aF19ZnVuY3Rpb24gcih0LGUpe3JldHVybiBvYS5yYW5nZShuLmxlbmd0aCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybiB0K2Uqbn0pfXZhciB1LGksYTtyZXR1cm4gZS5kb21haW49ZnVuY3Rpb24ocil7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIG47bj1bXSx1PW5ldyBjO2Zvcih2YXIgaSxhPS0xLG89ci5sZW5ndGg7KythPG87KXUuaGFzKGk9clthXSl8fHUuc2V0KGksbi5wdXNoKGkpKTtyZXR1cm4gZVt0LnRdLmFwcGx5KGUsdC5hKX0sZS5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLGE9MCx0PXt0OiJyYW5nZSIsYTphcmd1bWVudHN9LGUpOml9LGUucmFuZ2VQb2ludHM9ZnVuY3Rpb24odSxvKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApO3ZhciBsPXVbMF0sYz11WzFdLHM9bi5sZW5ndGg8Mj8obD0obCtjKS8yLDApOihjLWwpLyhuLmxlbmd0aC0xK28pO3JldHVybiBpPXIobCtzKm8vMixzKSxhPTAsdD17dDoicmFuZ2VQb2ludHMiLGE6YXJndW1lbnRzfSxlfSxlLnJhbmdlUm91bmRQb2ludHM9ZnVuY3Rpb24odSxvKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApO3ZhciBsPXVbMF0sYz11WzFdLHM9bi5sZW5ndGg8Mj8obD1jPU1hdGgucm91bmQoKGwrYykvMiksMCk6KGMtbCkvKG4ubGVuZ3RoLTErbyl8MDtyZXR1cm4gaT1yKGwrTWF0aC5yb3VuZChzKm8vMisoYy1sLShuLmxlbmd0aC0xK28pKnMpLzIpLHMpLGE9MCx0PXt0OiJyYW5nZVJvdW5kUG9pbnRzIixhOmFyZ3VtZW50c30sZX0sZS5yYW5nZUJhbmRzPWZ1bmN0aW9uKHUsbyxsKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApLGFyZ3VtZW50cy5sZW5ndGg8MyYmKGw9byk7dmFyIGM9dVsxXTx1WzBdLHM9dVtjLTBdLGY9dVsxLWNdLGg9KGYtcykvKG4ubGVuZ3RoLW8rMipsKTtyZXR1cm4gaT1yKHMraCpsLGgpLGMmJmkucmV2ZXJzZSgpLGE9aCooMS1vKSx0PXt0OiJyYW5nZUJhbmRzIixhOmFyZ3VtZW50c30sZX0sZS5yYW5nZVJvdW5kQmFuZHM9ZnVuY3Rpb24odSxvLGwpe2FyZ3VtZW50cy5sZW5ndGg8MiYmKG89MCksYXJndW1lbnRzLmxlbmd0aDwzJiYobD1vKTt2YXIgYz11WzFdPHVbMF0scz11W2MtMF0sZj11WzEtY10saD1NYXRoLmZsb29yKChmLXMpLyhuLmxlbmd0aC1vKzIqbCkpO3JldHVybiBpPXIocytNYXRoLnJvdW5kKChmLXMtKG4ubGVuZ3RoLW8pKmgpLzIpLGgpLGMmJmkucmV2ZXJzZSgpLGE9TWF0aC5yb3VuZChoKigxLW8pKSx0PXt0OiJyYW5nZVJvdW5kQmFuZHMiLGE6YXJndW1lbnRzfSxlfSxlLnJhbmdlQmFuZD1mdW5jdGlvbigpe3JldHVybiBhfSxlLnJhbmdlRXh0ZW50PWZ1bmN0aW9uKCl7cmV0dXJuIFl1KHQuYVswXSl9LGUuY29weT1mdW5jdGlvbigpe3JldHVybiBhaShuLHQpfSxlLmRvbWFpbihuKX1mdW5jdGlvbiBvaShuLHQpe2Z1bmN0aW9uIGkoKXt2YXIgZT0wLHI9dC5sZW5ndGg7Zm9yKG89W107KytlPHI7KW9bZS0xXT1vYS5xdWFudGlsZShuLGUvcik7cmV0dXJuIGF9ZnVuY3Rpb24gYShuKXtyZXR1cm4gaXNOYU4obj0rbik/dm9pZCAwOnRbb2EuYmlzZWN0KG8sbildfXZhciBvO3JldHVybiBhLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj10Lm1hcChyKS5maWx0ZXIodSkuc29ydChlKSxpKCkpOm59LGEucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bixpKCkpOnR9LGEucXVhbnRpbGVzPWZ1bmN0aW9uKCl7cmV0dXJuIG99LGEuaW52ZXJ0RXh0ZW50PWZ1bmN0aW9uKGUpe3JldHVybiBlPXQuaW5kZXhPZihlKSwwPmU/W05hTixOYU5dOltlPjA/b1tlLTFdOm5bMF0sZTxvLmxlbmd0aD9vW2VdOm5bbi5sZW5ndGgtMV1dfSxhLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gb2kobix0KX0saSgpfWZ1bmN0aW9uIGxpKG4sdCxlKXtmdW5jdGlvbiByKHQpe3JldHVybiBlW01hdGgubWF4KDAsTWF0aC5taW4oYSxNYXRoLmZsb29yKGkqKHQtbikpKSldfWZ1bmN0aW9uIHUoKXtyZXR1cm4gaT1lLmxlbmd0aC8odC1uKSxhPWUubGVuZ3RoLTEscn12YXIgaSxhO3JldHVybiByLmRvbWFpbj1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj0rZVswXSx0PStlW2UubGVuZ3RoLTFdLHUoKSk6W24sdF19LHIucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix1KCkpOmV9LHIuaW52ZXJ0RXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiB0PWUuaW5kZXhPZih0KSx0PTA+dD9OYU46dC9pK24sW3QsdCsxL2ldfSxyLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gbGkobix0LGUpfSx1KCl9ZnVuY3Rpb24gY2kobix0KXtmdW5jdGlvbiBlKGUpe3JldHVybiBlPj1lP3Rbb2EuYmlzZWN0KG4sZSldOnZvaWQgMH1yZXR1cm4gZS5kb21haW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG49dCxlKTpufSxlLnJhbmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW4sZSk6dH0sZS5pbnZlcnRFeHRlbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGU9dC5pbmRleE9mKGUpLFtuW2UtMV0sbltlXV19LGUuY29weT1mdW5jdGlvbigpe3JldHVybiBjaShuLHQpfSxlfWZ1bmN0aW9uIHNpKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuK259cmV0dXJuIHQuaW52ZXJ0PXQsdC5kb21haW49dC5yYW5nZT1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj1lLm1hcCh0KSx0KTpufSx0LnRpY2tzPWZ1bmN0aW9uKHQpe3JldHVybiBRdShuLHQpfSx0LnRpY2tGb3JtYXQ9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmkobix0LGUpfSx0LmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gc2kobil9LHR9ZnVuY3Rpb24gZmkoKXtyZXR1cm4gMH1mdW5jdGlvbiBoaShuKXtyZXR1cm4gbi5pbm5lclJhZGl1c31mdW5jdGlvbiBnaShuKXtyZXR1cm4gbi5vdXRlclJhZGl1c31mdW5jdGlvbiBwaShuKXtyZXR1cm4gbi5zdGFydEFuZ2xlfWZ1bmN0aW9uIHZpKG4pe3JldHVybiBuLmVuZEFuZ2xlfWZ1bmN0aW9uIGRpKG4pe3JldHVybiBuJiZuLnBhZEFuZ2xlfWZ1bmN0aW9uIG1pKG4sdCxlLHIpe3JldHVybihuLWUpKnQtKHQtcikqbj4wPzA6MX1mdW5jdGlvbiB5aShuLHQsZSxyLHUpe3ZhciBpPW5bMF0tdFswXSxhPW5bMV0tdFsxXSxvPSh1P3I6LXIpL01hdGguc3FydChpKmkrYSphKSxsPW8qYSxjPS1vKmkscz1uWzBdK2wsZj1uWzFdK2MsaD10WzBdK2wsZz10WzFdK2MscD0ocytoKS8yLHY9KGYrZykvMixkPWgtcyxtPWctZix5PWQqZCttKm0sTT1lLXIseD1zKmctaCpmLGI9KDA+bT8tMToxKSpNYXRoLnNxcnQoTWF0aC5tYXgoMCxNKk0qeS14KngpKSxfPSh4Km0tZCpiKS95LHc9KC14KmQtbSpiKS95LFM9KHgqbStkKmIpL3ksaz0oLXgqZCttKmIpL3ksTj1fLXAsRT13LXYsQT1TLXAsQz1rLXY7cmV0dXJuIE4qTitFKkU+QSpBK0MqQyYmKF89Uyx3PWspLFtbXy1sLHctY10sW18qZS9NLHcqZS9NXV19ZnVuY3Rpb24gTWkobil7ZnVuY3Rpb24gdCh0KXtmdW5jdGlvbiBhKCl7Yy5wdXNoKCJNIixpKG4ocyksbykpfWZvcih2YXIgbCxjPVtdLHM9W10sZj0tMSxoPXQubGVuZ3RoLGc9RW4oZSkscD1FbihyKTsrK2Y8aDspdS5jYWxsKHRoaXMsbD10W2ZdLGYpP3MucHVzaChbK2cuY2FsbCh0aGlzLGwsZiksK3AuY2FsbCh0aGlzLGwsZildKTpzLmxlbmd0aCYmKGEoKSxzPVtdKTtyZXR1cm4gcy5sZW5ndGgmJmEoKSxjLmxlbmd0aD9jLmpvaW4oIiIpOm51bGx9dmFyIGU9Q2Uscj16ZSx1PXp0LGk9eGksYT1pLmtleSxvPS43O3JldHVybiB0Lng9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix0KTplfSx0Lnk9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9bix0KTpyfSx0LmRlZmluZWQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bix0KTp1fSx0LmludGVycG9sYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPSJmdW5jdGlvbiI9PXR5cGVvZiBuP2k9bjooaT1xbC5nZXQobil8fHhpKS5rZXksdCk6YX0sdC50ZW5zaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPW4sdCk6b30sdH1mdW5jdGlvbiB4aShuKXtyZXR1cm4gbi5sZW5ndGg+MT9uLmpvaW4oIkwiKTpuKyJaIn1mdW5jdGlvbiBiaShuKXtyZXR1cm4gbi5qb2luKCJMIikrIloifWZ1bmN0aW9uIF9pKG4pe2Zvcih2YXIgdD0wLGU9bi5sZW5ndGgscj1uWzBdLHU9W3JbMF0sIiwiLHJbMV1dOysrdDxlOyl1LnB1c2goIkgiLChyWzBdKyhyPW5bdF0pWzBdKS8yLCJWIixyWzFdKTtyZXR1cm4gZT4xJiZ1LnB1c2goIkgiLHJbMF0pLHUuam9pbigiIil9ZnVuY3Rpb24gd2kobil7Zm9yKHZhciB0PTAsZT1uLmxlbmd0aCxyPW5bMF0sdT1bclswXSwiLCIsclsxXV07Kyt0PGU7KXUucHVzaCgiViIsKHI9blt0XSlbMV0sIkgiLHJbMF0pO3JldHVybiB1LmpvaW4oIiIpfWZ1bmN0aW9uIFNpKG4pe2Zvcih2YXIgdD0wLGU9bi5sZW5ndGgscj1uWzBdLHU9W3JbMF0sIiwiLHJbMV1dOysrdDxlOyl1LnB1c2goIkgiLChyPW5bdF0pWzBdLCJWIixyWzFdKTtyZXR1cm4gdS5qb2luKCIiKX1mdW5jdGlvbiBraShuLHQpe3JldHVybiBuLmxlbmd0aDw0P3hpKG4pOm5bMV0rQWkobi5zbGljZSgxLC0xKSxDaShuLHQpKX1mdW5jdGlvbiBOaShuLHQpe3JldHVybiBuLmxlbmd0aDwzP2JpKG4pOm5bMF0rQWkoKG4ucHVzaChuWzBdKSxuKSxDaShbbltuLmxlbmd0aC0yXV0uY29uY2F0KG4sW25bMV1dKSx0KSl9ZnVuY3Rpb24gRWkobix0KXtyZXR1cm4gbi5sZW5ndGg8Mz94aShuKTpuWzBdK0FpKG4sQ2kobix0KSl9ZnVuY3Rpb24gQWkobix0KXtpZih0Lmxlbmd0aDwxfHxuLmxlbmd0aCE9dC5sZW5ndGgmJm4ubGVuZ3RoIT10Lmxlbmd0aCsyKXJldHVybiB4aShuKTt2YXIgZT1uLmxlbmd0aCE9dC5sZW5ndGgscj0iIix1PW5bMF0saT1uWzFdLGE9dFswXSxvPWEsbD0xO2lmKGUmJihyKz0iUSIrKGlbMF0tMiphWzBdLzMpKyIsIisoaVsxXS0yKmFbMV0vMykrIiwiK2lbMF0rIiwiK2lbMV0sdT1uWzFdLGw9MiksdC5sZW5ndGg+MSl7bz10WzFdLGk9bltsXSxsKysscis9IkMiKyh1WzBdK2FbMF0pKyIsIisodVsxXSthWzFdKSsiLCIrKGlbMF0tb1swXSkrIiwiKyhpWzFdLW9bMV0pKyIsIitpWzBdKyIsIitpWzFdO2Zvcih2YXIgYz0yO2M8dC5sZW5ndGg7YysrLGwrKylpPW5bbF0sbz10W2NdLHIrPSJTIisoaVswXS1vWzBdKSsiLCIrKGlbMV0tb1sxXSkrIiwiK2lbMF0rIiwiK2lbMV19aWYoZSl7dmFyIHM9bltsXTtyKz0iUSIrKGlbMF0rMipvWzBdLzMpKyIsIisoaVsxXSsyKm9bMV0vMykrIiwiK3NbMF0rIiwiK3NbMV19cmV0dXJuIHJ9ZnVuY3Rpb24gQ2kobix0KXtmb3IodmFyIGUscj1bXSx1PSgxLXQpLzIsaT1uWzBdLGE9blsxXSxvPTEsbD1uLmxlbmd0aDsrK288bDspZT1pLGk9YSxhPW5bb10sci5wdXNoKFt1KihhWzBdLWVbMF0pLHUqKGFbMV0tZVsxXSldKTtyZXR1cm4gcn1mdW5jdGlvbiB6aShuKXtpZihuLmxlbmd0aDwzKXJldHVybiB4aShuKTt2YXIgdD0xLGU9bi5sZW5ndGgscj1uWzBdLHU9clswXSxpPXJbMV0sYT1bdSx1LHUsKHI9blsxXSlbMF1dLG89W2ksaSxpLHJbMV1dLGw9W3UsIiwiLGksIkwiLFJpKERsLGEpLCIsIixSaShEbCxvKV07Zm9yKG4ucHVzaChuW2UtMV0pOysrdDw9ZTspcj1uW3RdLGEuc2hpZnQoKSxhLnB1c2goclswXSksby5zaGlmdCgpLG8ucHVzaChyWzFdKSxEaShsLGEsbyk7cmV0dXJuIG4ucG9wKCksbC5wdXNoKCJMIixyKSxsLmpvaW4oIiIpfWZ1bmN0aW9uIExpKG4pe2lmKG4ubGVuZ3RoPDQpcmV0dXJuIHhpKG4pO2Zvcih2YXIgdCxlPVtdLHI9LTEsdT1uLmxlbmd0aCxpPVswXSxhPVswXTsrK3I8MzspdD1uW3JdLGkucHVzaCh0WzBdKSxhLnB1c2godFsxXSk7Zm9yKGUucHVzaChSaShEbCxpKSsiLCIrUmkoRGwsYSkpLC0tcjsrK3I8dTspdD1uW3JdLGkuc2hpZnQoKSxpLnB1c2godFswXSksYS5zaGlmdCgpLGEucHVzaCh0WzFdKSxEaShlLGksYSk7cmV0dXJuIGUuam9pbigiIil9ZnVuY3Rpb24gcWkobil7Zm9yKHZhciB0LGUscj0tMSx1PW4ubGVuZ3RoLGk9dSs0LGE9W10sbz1bXTsrK3I8NDspZT1uW3IldV0sYS5wdXNoKGVbMF0pLG8ucHVzaChlWzFdKTtmb3IodD1bUmkoRGwsYSksIiwiLFJpKERsLG8pXSwtLXI7KytyPGk7KWU9bltyJXVdLGEuc2hpZnQoKSxhLnB1c2goZVswXSksby5zaGlmdCgpLG8ucHVzaChlWzFdKSxEaSh0LGEsbyk7cmV0dXJuIHQuam9pbigiIil9ZnVuY3Rpb24gVGkobix0KXt2YXIgZT1uLmxlbmd0aC0xO2lmKGUpZm9yKHZhciByLHUsaT1uWzBdWzBdLGE9blswXVsxXSxvPW5bZV1bMF0taSxsPW5bZV1bMV0tYSxjPS0xOysrYzw9ZTspcj1uW2NdLHU9Yy9lLHJbMF09dCpyWzBdKygxLXQpKihpK3UqbyksclsxXT10KnJbMV0rKDEtdCkqKGErdSpsKTtyZXR1cm4gemkobil9ZnVuY3Rpb24gUmkobix0KXtyZXR1cm4gblswXSp0WzBdK25bMV0qdFsxXStuWzJdKnRbMl0rblszXSp0WzNdfWZ1bmN0aW9uIERpKG4sdCxlKXtuLnB1c2goIkMiLFJpKFRsLHQpLCIsIixSaShUbCxlKSwiLCIsUmkoUmwsdCksIiwiLFJpKFJsLGUpLCIsIixSaShEbCx0KSwiLCIsUmkoRGwsZSkpfWZ1bmN0aW9uIFBpKG4sdCl7cmV0dXJuKHRbMV0tblsxXSkvKHRbMF0tblswXSl9ZnVuY3Rpb24gVWkobil7Zm9yKHZhciB0PTAsZT1uLmxlbmd0aC0xLHI9W10sdT1uWzBdLGk9blsxXSxhPXJbMF09UGkodSxpKTsrK3Q8ZTspclt0XT0oYSsoYT1QaSh1PWksaT1uW3QrMV0pKSkvMjtyZXR1cm4gclt0XT1hLHJ9ZnVuY3Rpb24gamkobil7Zm9yKHZhciB0LGUscix1LGk9W10sYT1VaShuKSxvPS0xLGw9bi5sZW5ndGgtMTsrK288bDspdD1QaShuW29dLG5bbysxXSksTWEodCk8RGE/YVtvXT1hW28rMV09MDooZT1hW29dL3Qscj1hW28rMV0vdCx1PWUqZStyKnIsdT45JiYodT0zKnQvTWF0aC5zcXJ0KHUpLGFbb109dSplLGFbbysxXT11KnIpKTtmb3Iobz0tMTsrK288PWw7KXU9KG5bTWF0aC5taW4obCxvKzEpXVswXS1uW01hdGgubWF4KDAsby0xKV1bMF0pLyg2KigxK2Fbb10qYVtvXSkpLGkucHVzaChbdXx8MCxhW29dKnV8fDBdKTtyZXR1cm4gaX1mdW5jdGlvbiBGaShuKXtyZXR1cm4gbi5sZW5ndGg8Mz94aShuKTpuWzBdK0FpKG4samkobikpfWZ1bmN0aW9uIEhpKG4pe2Zvcih2YXIgdCxlLHIsdT0tMSxpPW4ubGVuZ3RoOysrdTxpOyl0PW5bdV0sZT10WzBdLHI9dFsxXS1IYSx0WzBdPWUqTWF0aC5jb3MociksdFsxXT1lKk1hdGguc2luKHIpO3JldHVybiBufWZ1bmN0aW9uIE9pKG4pe2Z1bmN0aW9uIHQodCl7ZnVuY3Rpb24gbCgpe3YucHVzaCgiTSIsbyhuKG0pLGYpLHMsYyhuKGQucmV2ZXJzZSgpKSxmKSwiWiIpfWZvcih2YXIgaCxnLHAsdj1bXSxkPVtdLG09W10seT0tMSxNPXQubGVuZ3RoLHg9RW4oZSksYj1Fbih1KSxfPWU9PT1yP2Z1bmN0aW9uKCl7CnJldHVybiBnfTpFbihyKSx3PXU9PT1pP2Z1bmN0aW9uKCl7cmV0dXJuIHB9OkVuKGkpOysreTxNOylhLmNhbGwodGhpcyxoPXRbeV0seSk/KGQucHVzaChbZz0reC5jYWxsKHRoaXMsaCx5KSxwPStiLmNhbGwodGhpcyxoLHkpXSksbS5wdXNoKFsrXy5jYWxsKHRoaXMsaCx5KSwrdy5jYWxsKHRoaXMsaCx5KV0pKTpkLmxlbmd0aCYmKGwoKSxkPVtdLG09W10pO3JldHVybiBkLmxlbmd0aCYmbCgpLHYubGVuZ3RoP3Yuam9pbigiIik6bnVsbH12YXIgZT1DZSxyPUNlLHU9MCxpPXplLGE9enQsbz14aSxsPW8ua2V5LGM9byxzPSJMIixmPS43O3JldHVybiB0Lng9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9cj1uLHQpOnJ9LHQueDA9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix0KTplfSx0LngxPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PWk9bix0KTppfSx0LnkwPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sdCk6dX0sdC55MT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLHQpOml9LHQuZGVmaW5lZD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1uLHQpOmF9LHQuaW50ZXJwb2xhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGw9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bz1uOihvPXFsLmdldChuKXx8eGkpLmtleSxjPW8ucmV2ZXJzZXx8byxzPW8uY2xvc2VkPyJNIjoiTCIsdCk6bH0sdC50ZW5zaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhmPW4sdCk6Zn0sdH1mdW5jdGlvbiBJaShuKXtyZXR1cm4gbi5yYWRpdXN9ZnVuY3Rpb24gWWkobil7cmV0dXJuW24ueCxuLnldfWZ1bmN0aW9uIFppKG4pe3JldHVybiBmdW5jdGlvbigpe3ZhciB0PW4uYXBwbHkodGhpcyxhcmd1bWVudHMpLGU9dFswXSxyPXRbMV0tSGE7cmV0dXJuW2UqTWF0aC5jb3MociksZSpNYXRoLnNpbihyKV19fWZ1bmN0aW9uIFZpKCl7cmV0dXJuIDY0fWZ1bmN0aW9uIFhpKCl7cmV0dXJuImNpcmNsZSJ9ZnVuY3Rpb24gJGkobil7dmFyIHQ9TWF0aC5zcXJ0KG4vVWEpO3JldHVybiJNMCwiK3QrIkEiK3QrIiwiK3QrIiAwIDEsMSAwLCIrLXQrIkEiK3QrIiwiK3QrIiAwIDEsMSAwLCIrdCsiWiJ9ZnVuY3Rpb24gQmkobil7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIHQsZSxyOyh0PXRoaXNbbl0pJiYocj10W2U9dC5hY3RpdmVdKSYmKHIudGltZXIuYz1udWxsLHIudGltZXIudD1OYU4sLS10LmNvdW50P2RlbGV0ZSB0W2VdOmRlbGV0ZSB0aGlzW25dLHQuYWN0aXZlKz0uNSxyLmV2ZW50JiZyLmV2ZW50LmludGVycnVwdC5jYWxsKHRoaXMsdGhpcy5fX2RhdGFfXyxyLmluZGV4KSl9fWZ1bmN0aW9uIFdpKG4sdCxlKXtyZXR1cm4gU2EobixJbCksbi5uYW1lc3BhY2U9dCxuLmlkPWUsbn1mdW5jdGlvbiBKaShuLHQsZSxyKXt2YXIgdT1uLmlkLGk9bi5uYW1lc3BhY2U7cmV0dXJuIFkobiwiZnVuY3Rpb24iPT10eXBlb2YgZT9mdW5jdGlvbihuLGEsbyl7bltpXVt1XS50d2Vlbi5zZXQodCxyKGUuY2FsbChuLG4uX19kYXRhX18sYSxvKSkpfTooZT1yKGUpLGZ1bmN0aW9uKG4pe25baV1bdV0udHdlZW4uc2V0KHQsZSl9KSl9ZnVuY3Rpb24gR2kobil7cmV0dXJuIG51bGw9PW4mJihuPSIiKSxmdW5jdGlvbigpe3RoaXMudGV4dENvbnRlbnQ9bn19ZnVuY3Rpb24gS2kobil7cmV0dXJuIG51bGw9PW4/Il9fdHJhbnNpdGlvbl9fIjoiX190cmFuc2l0aW9uXyIrbisiX18ifWZ1bmN0aW9uIFFpKG4sdCxlLHIsdSl7ZnVuY3Rpb24gaShuKXt2YXIgdD12LmRlbGF5O3JldHVybiBzLnQ9dCtsLG4+PXQ/YShuLXQpOnZvaWQocy5jPWEpfWZ1bmN0aW9uIGEoZSl7dmFyIHU9cC5hY3RpdmUsaT1wW3VdO2kmJihpLnRpbWVyLmM9bnVsbCxpLnRpbWVyLnQ9TmFOLC0tcC5jb3VudCxkZWxldGUgcFt1XSxpLmV2ZW50JiZpLmV2ZW50LmludGVycnVwdC5jYWxsKG4sbi5fX2RhdGFfXyxpLmluZGV4KSk7Zm9yKHZhciBhIGluIHApaWYocj4rYSl7dmFyIGM9cFthXTtjLnRpbWVyLmM9bnVsbCxjLnRpbWVyLnQ9TmFOLC0tcC5jb3VudCxkZWxldGUgcFthXX1zLmM9byxxbihmdW5jdGlvbigpe3JldHVybiBzLmMmJm8oZXx8MSkmJihzLmM9bnVsbCxzLnQ9TmFOKSwxfSwwLGwpLHAuYWN0aXZlPXIsdi5ldmVudCYmdi5ldmVudC5zdGFydC5jYWxsKG4sbi5fX2RhdGFfXyx0KSxnPVtdLHYudHdlZW4uZm9yRWFjaChmdW5jdGlvbihlLHIpeyhyPXIuY2FsbChuLG4uX19kYXRhX18sdCkpJiZnLnB1c2gocil9KSxoPXYuZWFzZSxmPXYuZHVyYXRpb259ZnVuY3Rpb24gbyh1KXtmb3IodmFyIGk9dS9mLGE9aChpKSxvPWcubGVuZ3RoO28+MDspZ1stLW9dLmNhbGwobixhKTtyZXR1cm4gaT49MT8odi5ldmVudCYmdi5ldmVudC5lbmQuY2FsbChuLG4uX19kYXRhX18sdCksLS1wLmNvdW50P2RlbGV0ZSBwW3JdOmRlbGV0ZSBuW2VdLDEpOnZvaWQgMH12YXIgbCxzLGYsaCxnLHA9bltlXXx8KG5bZV09e2FjdGl2ZTowLGNvdW50OjB9KSx2PXBbcl07dnx8KGw9dS50aW1lLHM9cW4oaSwwLGwpLHY9cFtyXT17dHdlZW46bmV3IGMsdGltZTpsLHRpbWVyOnMsZGVsYXk6dS5kZWxheSxkdXJhdGlvbjp1LmR1cmF0aW9uLGVhc2U6dS5lYXNlLGluZGV4OnR9LHU9bnVsbCwrK3AuY291bnQpfWZ1bmN0aW9uIG5hKG4sdCxlKXtuLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24obil7dmFyIHI9dChuKTtyZXR1cm4idHJhbnNsYXRlKCIrKGlzRmluaXRlKHIpP3I6ZShuKSkrIiwwKSJ9KX1mdW5jdGlvbiB0YShuLHQsZSl7bi5hdHRyKCJ0cmFuc2Zvcm0iLGZ1bmN0aW9uKG4pe3ZhciByPXQobik7cmV0dXJuInRyYW5zbGF0ZSgwLCIrKGlzRmluaXRlKHIpP3I6ZShuKSkrIikifSl9ZnVuY3Rpb24gZWEobil7cmV0dXJuIG4udG9JU09TdHJpbmcoKX1mdW5jdGlvbiByYShuLHQsZSl7ZnVuY3Rpb24gcih0KXtyZXR1cm4gbih0KX1mdW5jdGlvbiB1KG4sZSl7dmFyIHI9blsxXS1uWzBdLHU9ci9lLGk9b2EuYmlzZWN0KEdsLHUpO3JldHVybiBpPT1HbC5sZW5ndGg/W3QueWVhcixLdShuLm1hcChmdW5jdGlvbihuKXtyZXR1cm4gbi8zMTUzNmU2fSksZSlbMl1dOmk/dFt1L0dsW2ktMV08R2xbaV0vdT9pLTE6aV06W25jLEt1KG4sZSlbMl1dfXJldHVybiByLmludmVydD1mdW5jdGlvbih0KXtyZXR1cm4gdWEobi5pbnZlcnQodCkpfSxyLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obi5kb21haW4odCkscik6bi5kb21haW4oKS5tYXAodWEpfSxyLm5pY2U9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKGUpe3JldHVybiFpc05hTihlKSYmIW4ucmFuZ2UoZSx1YSgrZSsxKSx0KS5sZW5ndGh9dmFyIGk9ci5kb21haW4oKSxhPVl1KGkpLG89bnVsbD09bj91KGEsMTApOiJudW1iZXIiPT10eXBlb2YgbiYmdShhLG4pO3JldHVybiBvJiYobj1vWzBdLHQ9b1sxXSksci5kb21haW4oWHUoaSx0PjE/e2Zsb29yOmZ1bmN0aW9uKHQpe2Zvcig7ZSh0PW4uZmxvb3IodCkpOyl0PXVhKHQtMSk7cmV0dXJuIHR9LGNlaWw6ZnVuY3Rpb24odCl7Zm9yKDtlKHQ9bi5jZWlsKHQpKTspdD11YSgrdCsxKTtyZXR1cm4gdH19Om4pKX0sci50aWNrcz1mdW5jdGlvbihuLHQpe3ZhciBlPVl1KHIuZG9tYWluKCkpLGk9bnVsbD09bj91KGUsMTApOiJudW1iZXIiPT10eXBlb2Ygbj91KGUsbik6IW4ucmFuZ2UmJlt7cmFuZ2U6bn0sdF07cmV0dXJuIGkmJihuPWlbMF0sdD1pWzFdKSxuLnJhbmdlKGVbMF0sdWEoK2VbMV0rMSksMT50PzE6dCl9LHIudGlja0Zvcm1hdD1mdW5jdGlvbigpe3JldHVybiBlfSxyLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gcmEobi5jb3B5KCksdCxlKX0sSnUocixuKX1mdW5jdGlvbiB1YShuKXtyZXR1cm4gbmV3IERhdGUobil9ZnVuY3Rpb24gaWEobil7cmV0dXJuIEpTT04ucGFyc2Uobi5yZXNwb25zZVRleHQpfWZ1bmN0aW9uIGFhKG4pe3ZhciB0PXNhLmNyZWF0ZVJhbmdlKCk7cmV0dXJuIHQuc2VsZWN0Tm9kZShzYS5ib2R5KSx0LmNyZWF0ZUNvbnRleHR1YWxGcmFnbWVudChuLnJlc3BvbnNlVGV4dCl9dmFyIG9hPXt2ZXJzaW9uOiIzLjUuMTQifSxsYT1bXS5zbGljZSxjYT1mdW5jdGlvbihuKXtyZXR1cm4gbGEuY2FsbChuKX0sc2E9dGhpcy5kb2N1bWVudDtpZihzYSl0cnl7Y2Eoc2EuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMpWzBdLm5vZGVUeXBlfWNhdGNoKGZhKXtjYT1mdW5jdGlvbihuKXtmb3IodmFyIHQ9bi5sZW5ndGgsZT1uZXcgQXJyYXkodCk7dC0tOyllW3RdPW5bdF07cmV0dXJuIGV9fWlmKERhdGUubm93fHwoRGF0ZS5ub3c9ZnVuY3Rpb24oKXtyZXR1cm4rbmV3IERhdGV9KSxzYSl0cnl7c2EuY3JlYXRlRWxlbWVudCgiRElWIikuc3R5bGUuc2V0UHJvcGVydHkoIm9wYWNpdHkiLDAsIiIpfWNhdGNoKGhhKXt2YXIgZ2E9dGhpcy5FbGVtZW50LnByb3RvdHlwZSxwYT1nYS5zZXRBdHRyaWJ1dGUsdmE9Z2Euc2V0QXR0cmlidXRlTlMsZGE9dGhpcy5DU1NTdHlsZURlY2xhcmF0aW9uLnByb3RvdHlwZSxtYT1kYS5zZXRQcm9wZXJ0eTtnYS5zZXRBdHRyaWJ1dGU9ZnVuY3Rpb24obix0KXtwYS5jYWxsKHRoaXMsbix0KyIiKX0sZ2Euc2V0QXR0cmlidXRlTlM9ZnVuY3Rpb24obix0LGUpe3ZhLmNhbGwodGhpcyxuLHQsZSsiIil9LGRhLnNldFByb3BlcnR5PWZ1bmN0aW9uKG4sdCxlKXttYS5jYWxsKHRoaXMsbix0KyIiLGUpfX1vYS5hc2NlbmRpbmc9ZSxvYS5kZXNjZW5kaW5nPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4+dD8tMTp0Pm4/MTp0Pj1uPzA6TmFOfSxvYS5taW49ZnVuY3Rpb24obix0KXt2YXIgZSxyLHU9LTEsaT1uLmxlbmd0aDtpZigxPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKDsrK3U8aTspaWYobnVsbCE9KHI9blt1XSkmJnI+PXIpe2U9cjticmVha31mb3IoOysrdTxpOyludWxsIT0ocj1uW3VdKSYmZT5yJiYoZT1yKX1lbHNle2Zvcig7Kyt1PGk7KWlmKG51bGwhPShyPXQuY2FsbChuLG5bdV0sdSkpJiZyPj1yKXtlPXI7YnJlYWt9Zm9yKDsrK3U8aTspbnVsbCE9KHI9dC5jYWxsKG4sblt1XSx1KSkmJmU+ciYmKGU9cil9cmV0dXJuIGV9LG9hLm1heD1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdT0tMSxpPW4ubGVuZ3RoO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKXtmb3IoOysrdTxpOylpZihudWxsIT0ocj1uW3VdKSYmcj49cil7ZT1yO2JyZWFrfWZvcig7Kyt1PGk7KW51bGwhPShyPW5bdV0pJiZyPmUmJihlPXIpfWVsc2V7Zm9yKDsrK3U8aTspaWYobnVsbCE9KHI9dC5jYWxsKG4sblt1XSx1KSkmJnI+PXIpe2U9cjticmVha31mb3IoOysrdTxpOyludWxsIT0ocj10LmNhbGwobixuW3VdLHUpKSYmcj5lJiYoZT1yKX1yZXR1cm4gZX0sb2EuZXh0ZW50PWZ1bmN0aW9uKG4sdCl7dmFyIGUscix1LGk9LTEsYT1uLmxlbmd0aDtpZigxPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKDsrK2k8YTspaWYobnVsbCE9KHI9bltpXSkmJnI+PXIpe2U9dT1yO2JyZWFrfWZvcig7KytpPGE7KW51bGwhPShyPW5baV0pJiYoZT5yJiYoZT1yKSxyPnUmJih1PXIpKX1lbHNle2Zvcig7KytpPGE7KWlmKG51bGwhPShyPXQuY2FsbChuLG5baV0saSkpJiZyPj1yKXtlPXU9cjticmVha31mb3IoOysraTxhOyludWxsIT0ocj10LmNhbGwobixuW2ldLGkpKSYmKGU+ciYmKGU9cikscj51JiYodT1yKSl9cmV0dXJuW2UsdV19LG9hLnN1bT1mdW5jdGlvbihuLHQpe3ZhciBlLHI9MCxpPW4ubGVuZ3RoLGE9LTE7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpZm9yKDsrK2E8aTspdShlPStuW2FdKSYmKHIrPWUpO2Vsc2UgZm9yKDsrK2E8aTspdShlPSt0LmNhbGwobixuW2FdLGEpKSYmKHIrPWUpO3JldHVybiByfSxvYS5tZWFuPWZ1bmN0aW9uKG4sdCl7dmFyIGUsaT0wLGE9bi5sZW5ndGgsbz0tMSxsPWE7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpZm9yKDsrK288YTspdShlPXIobltvXSkpP2krPWU6LS1sO2Vsc2UgZm9yKDsrK288YTspdShlPXIodC5jYWxsKG4sbltvXSxvKSkpP2krPWU6LS1sO3JldHVybiBsP2kvbDp2b2lkIDB9LG9hLnF1YW50aWxlPWZ1bmN0aW9uKG4sdCl7dmFyIGU9KG4ubGVuZ3RoLTEpKnQrMSxyPU1hdGguZmxvb3IoZSksdT0rbltyLTFdLGk9ZS1yO3JldHVybiBpP3UraSoobltyXS11KTp1fSxvYS5tZWRpYW49ZnVuY3Rpb24obix0KXt2YXIgaSxhPVtdLG89bi5sZW5ndGgsbD0tMTtpZigxPT09YXJndW1lbnRzLmxlbmd0aClmb3IoOysrbDxvOyl1KGk9cihuW2xdKSkmJmEucHVzaChpKTtlbHNlIGZvcig7KytsPG87KXUoaT1yKHQuY2FsbChuLG5bbF0sbCkpKSYmYS5wdXNoKGkpO3JldHVybiBhLmxlbmd0aD9vYS5xdWFudGlsZShhLnNvcnQoZSksLjUpOnZvaWQgMH0sb2EudmFyaWFuY2U9ZnVuY3Rpb24obix0KXt2YXIgZSxpLGE9bi5sZW5ndGgsbz0wLGw9MCxjPS0xLHM9MDtpZigxPT09YXJndW1lbnRzLmxlbmd0aClmb3IoOysrYzxhOyl1KGU9cihuW2NdKSkmJihpPWUtbyxvKz1pLysrcyxsKz1pKihlLW8pKTtlbHNlIGZvcig7KytjPGE7KXUoZT1yKHQuY2FsbChuLG5bY10sYykpKSYmKGk9ZS1vLG8rPWkvKytzLGwrPWkqKGUtbykpO3JldHVybiBzPjE/bC8ocy0xKTp2b2lkIDB9LG9hLmRldmlhdGlvbj1mdW5jdGlvbigpe3ZhciBuPW9hLnZhcmlhbmNlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbj9NYXRoLnNxcnQobik6bn07dmFyIHlhPWkoZSk7b2EuYmlzZWN0TGVmdD15YS5sZWZ0LG9hLmJpc2VjdD1vYS5iaXNlY3RSaWdodD15YS5yaWdodCxvYS5iaXNlY3Rvcj1mdW5jdGlvbihuKXtyZXR1cm4gaSgxPT09bi5sZW5ndGg/ZnVuY3Rpb24odCxyKXtyZXR1cm4gZShuKHQpLHIpfTpuKX0sb2Euc2h1ZmZsZT1mdW5jdGlvbihuLHQsZSl7KGk9YXJndW1lbnRzLmxlbmd0aCk8MyYmKGU9bi5sZW5ndGgsMj5pJiYodD0wKSk7Zm9yKHZhciByLHUsaT1lLXQ7aTspdT1NYXRoLnJhbmRvbSgpKmktLXwwLHI9bltpK3RdLG5baSt0XT1uW3UrdF0sblt1K3RdPXI7cmV0dXJuIG59LG9hLnBlcm11dGU9ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1uZXcgQXJyYXkoZSk7ZS0tOylyW2VdPW5bdFtlXV07cmV0dXJuIHJ9LG9hLnBhaXJzPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxlPTAscj1uLmxlbmd0aC0xLHU9blswXSxpPW5ldyBBcnJheSgwPnI/MDpyKTtyPmU7KWlbZV09W3Q9dSx1PW5bKytlXV07cmV0dXJuIGl9LG9hLnppcD1mdW5jdGlvbigpe2lmKCEocj1hcmd1bWVudHMubGVuZ3RoKSlyZXR1cm5bXTtmb3IodmFyIG49LTEsdD1vYS5taW4oYXJndW1lbnRzLGEpLGU9bmV3IEFycmF5KHQpOysrbjx0Oylmb3IodmFyIHIsdT0tMSxpPWVbbl09bmV3IEFycmF5KHIpOysrdTxyOylpW3VdPWFyZ3VtZW50c1t1XVtuXTtyZXR1cm4gZX0sb2EudHJhbnNwb3NlPWZ1bmN0aW9uKG4pe3JldHVybiBvYS56aXAuYXBwbHkob2Esbil9LG9hLmtleXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciBlIGluIG4pdC5wdXNoKGUpO3JldHVybiB0fSxvYS52YWx1ZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciBlIGluIG4pdC5wdXNoKG5bZV0pO3JldHVybiB0fSxvYS5lbnRyaWVzPWZ1bmN0aW9uKG4pe3ZhciB0PVtdO2Zvcih2YXIgZSBpbiBuKXQucHVzaCh7a2V5OmUsdmFsdWU6bltlXX0pO3JldHVybiB0fSxvYS5tZXJnZT1mdW5jdGlvbihuKXtmb3IodmFyIHQsZSxyLHU9bi5sZW5ndGgsaT0tMSxhPTA7KytpPHU7KWErPW5baV0ubGVuZ3RoO2ZvcihlPW5ldyBBcnJheShhKTstLXU+PTA7KWZvcihyPW5bdV0sdD1yLmxlbmd0aDstLXQ+PTA7KWVbLS1hXT1yW3RdO3JldHVybiBlfTt2YXIgTWE9TWF0aC5hYnM7b2EucmFuZ2U9ZnVuY3Rpb24obix0LGUpe2lmKGFyZ3VtZW50cy5sZW5ndGg8MyYmKGU9MSxhcmd1bWVudHMubGVuZ3RoPDImJih0PW4sbj0wKSksKHQtbikvZT09PTEvMCl0aHJvdyBuZXcgRXJyb3IoImluZmluaXRlIHJhbmdlIik7dmFyIHIsdT1bXSxpPW8oTWEoZSkpLGE9LTE7aWYobio9aSx0Kj1pLGUqPWksMD5lKWZvcig7KHI9bitlKisrYSk+dDspdS5wdXNoKHIvaSk7ZWxzZSBmb3IoOyhyPW4rZSorK2EpPHQ7KXUucHVzaChyL2kpO3JldHVybiB1fSxvYS5tYXA9ZnVuY3Rpb24obix0KXt2YXIgZT1uZXcgYztpZihuIGluc3RhbmNlb2YgYyluLmZvckVhY2goZnVuY3Rpb24obix0KXtlLnNldChuLHQpfSk7ZWxzZSBpZihBcnJheS5pc0FycmF5KG4pKXt2YXIgcix1PS0xLGk9bi5sZW5ndGg7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpZm9yKDsrK3U8aTspZS5zZXQodSxuW3VdKTtlbHNlIGZvcig7Kyt1PGk7KWUuc2V0KHQuY2FsbChuLHI9blt1XSx1KSxyKX1lbHNlIGZvcih2YXIgYSBpbiBuKWUuc2V0KGEsblthXSk7cmV0dXJuIGV9O3ZhciB4YT0iX19wcm90b19fIixiYT0iXHgwMCI7bChjLHtoYXM6aCxnZXQ6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXMuX1tzKG4pXX0sc2V0OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIHRoaXMuX1tzKG4pXT10fSxyZW1vdmU6ZyxrZXlzOnAsdmFsdWVzOmZ1bmN0aW9uKCl7dmFyIG49W107Zm9yKHZhciB0IGluIHRoaXMuXyluLnB1c2godGhpcy5fW3RdKTtyZXR1cm4gbn0sZW50cmllczpmdW5jdGlvbigpe3ZhciBuPVtdO2Zvcih2YXIgdCBpbiB0aGlzLl8pbi5wdXNoKHtrZXk6Zih0KSx2YWx1ZTp0aGlzLl9bdF19KTtyZXR1cm4gbn0sc2l6ZTp2LGVtcHR5OmQsZm9yRWFjaDpmdW5jdGlvbihuKXtmb3IodmFyIHQgaW4gdGhpcy5fKW4uY2FsbCh0aGlzLGYodCksdGhpcy5fW3RdKX19KSxvYS5uZXN0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LGEsbyl7aWYobz49aS5sZW5ndGgpcmV0dXJuIHI/ci5jYWxsKHUsYSk6ZT9hLnNvcnQoZSk6YTtmb3IodmFyIGwscyxmLGgsZz0tMSxwPWEubGVuZ3RoLHY9aVtvKytdLGQ9bmV3IGM7KytnPHA7KShoPWQuZ2V0KGw9dihzPWFbZ10pKSk/aC5wdXNoKHMpOmQuc2V0KGwsW3NdKTtyZXR1cm4gdD8ocz10KCksZj1mdW5jdGlvbihlLHIpe3Muc2V0KGUsbih0LHIsbykpfSk6KHM9e30sZj1mdW5jdGlvbihlLHIpe3NbZV09bih0LHIsbyl9KSxkLmZvckVhY2goZiksc31mdW5jdGlvbiB0KG4sZSl7aWYoZT49aS5sZW5ndGgpcmV0dXJuIG47dmFyIHI9W10sdT1hW2UrK107cmV0dXJuIG4uZm9yRWFjaChmdW5jdGlvbihuLHUpe3IucHVzaCh7a2V5Om4sdmFsdWVzOnQodSxlKX0pfSksdT9yLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gdShuLmtleSx0LmtleSl9KTpyfXZhciBlLHIsdT17fSxpPVtdLGE9W107cmV0dXJuIHUubWFwPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG4oZSx0LDApfSx1LmVudHJpZXM9ZnVuY3Rpb24oZSl7cmV0dXJuIHQobihvYS5tYXAsZSwwKSwwKX0sdS5rZXk9ZnVuY3Rpb24obil7cmV0dXJuIGkucHVzaChuKSx1fSx1LnNvcnRLZXlzPWZ1bmN0aW9uKG4pe3JldHVybiBhW2kubGVuZ3RoLTFdPW4sdX0sdS5zb3J0VmFsdWVzPWZ1bmN0aW9uKG4pe3JldHVybiBlPW4sdX0sdS5yb2xsdXA9ZnVuY3Rpb24obil7cmV0dXJuIHI9bix1fSx1fSxvYS5zZXQ9ZnVuY3Rpb24obil7dmFyIHQ9bmV3IG07aWYobilmb3IodmFyIGU9MCxyPW4ubGVuZ3RoO3I+ZTsrK2UpdC5hZGQobltlXSk7cmV0dXJuIHR9LGwobSx7aGFzOmgsYWRkOmZ1bmN0aW9uKG4pe3JldHVybiB0aGlzLl9bcyhuKz0iIildPSEwLG59LHJlbW92ZTpnLHZhbHVlczpwLHNpemU6dixlbXB0eTpkLGZvckVhY2g6ZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIHRoaXMuXyluLmNhbGwodGhpcyxmKHQpKX19KSxvYS5iZWhhdmlvcj17fSxvYS5yZWJpbmQ9ZnVuY3Rpb24obix0KXtmb3IodmFyIGUscj0xLHU9YXJndW1lbnRzLmxlbmd0aDsrK3I8dTspbltlPWFyZ3VtZW50c1tyXV09TShuLHQsdFtlXSk7cmV0dXJuIG59O3ZhciBfYT1bIndlYmtpdCIsIm1zIiwibW96IiwiTW96IiwibyIsIk8iXTtvYS5kaXNwYXRjaD1mdW5jdGlvbigpe2Zvcih2YXIgbj1uZXcgXyx0PS0xLGU9YXJndW1lbnRzLmxlbmd0aDsrK3Q8ZTspblthcmd1bWVudHNbdF1dPXcobik7cmV0dXJuIG59LF8ucHJvdG90eXBlLm9uPWZ1bmN0aW9uKG4sdCl7dmFyIGU9bi5pbmRleE9mKCIuIikscj0iIjtpZihlPj0wJiYocj1uLnNsaWNlKGUrMSksbj1uLnNsaWNlKDAsZSkpLG4pcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj90aGlzW25dLm9uKHIpOnRoaXNbbl0ub24ocix0KTtpZigyPT09YXJndW1lbnRzLmxlbmd0aCl7aWYobnVsbD09dClmb3IobiBpbiB0aGlzKXRoaXMuaGFzT3duUHJvcGVydHkobikmJnRoaXNbbl0ub24ocixudWxsKTtyZXR1cm4gdGhpc319LG9hLmV2ZW50PW51bGwsb2EucmVxdW90ZT1mdW5jdGlvbihuKXtyZXR1cm4gbi5yZXBsYWNlKHdhLCJcXCQmIil9O3ZhciB3YT0vW1xcXF5cJFwqXCtcP1x8XFtcXVwoXClcLlx7XH1dL2csU2E9e30uX19wcm90b19fP2Z1bmN0aW9uKG4sdCl7bi5fX3Byb3RvX189dH06ZnVuY3Rpb24obix0KXtmb3IodmFyIGUgaW4gdCluW2VdPXRbZV19LGthPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHQucXVlcnlTZWxlY3RvcihuKX0sTmE9ZnVuY3Rpb24obix0KXtyZXR1cm4gdC5xdWVyeVNlbGVjdG9yQWxsKG4pfSxFYT1mdW5jdGlvbihuLHQpe3ZhciBlPW4ubWF0Y2hlc3x8blt4KG4sIm1hdGNoZXNTZWxlY3RvciIpXTtyZXR1cm4oRWE9ZnVuY3Rpb24obix0KXtyZXR1cm4gZS5jYWxsKG4sdCl9KShuLHQpfTsiZnVuY3Rpb24iPT10eXBlb2YgU2l6emxlJiYoa2E9ZnVuY3Rpb24obix0KXtyZXR1cm4gU2l6emxlKG4sdClbMF18fG51bGx9LE5hPVNpenpsZSxFYT1TaXp6bGUubWF0Y2hlc1NlbGVjdG9yKSxvYS5zZWxlY3Rpb249ZnVuY3Rpb24oKXtyZXR1cm4gb2Euc2VsZWN0KHNhLmRvY3VtZW50RWxlbWVudCl9O3ZhciBBYT1vYS5zZWxlY3Rpb24ucHJvdG90eXBlPVtdO0FhLnNlbGVjdD1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpPVtdO249QShuKTtmb3IodmFyIGE9LTEsbz10aGlzLmxlbmd0aDsrK2E8bzspe2kucHVzaCh0PVtdKSx0LnBhcmVudE5vZGU9KHI9dGhpc1thXSkucGFyZW50Tm9kZTtmb3IodmFyIGw9LTEsYz1yLmxlbmd0aDsrK2w8YzspKHU9cltsXSk/KHQucHVzaChlPW4uY2FsbCh1LHUuX19kYXRhX18sbCxhKSksZSYmIl9fZGF0YV9fImluIHUmJihlLl9fZGF0YV9fPXUuX19kYXRhX18pKTp0LnB1c2gobnVsbCl9cmV0dXJuIEUoaSl9LEFhLnNlbGVjdEFsbD1mdW5jdGlvbihuKXt2YXIgdCxlLHI9W107bj1DKG4pO2Zvcih2YXIgdT0tMSxpPXRoaXMubGVuZ3RoOysrdTxpOylmb3IodmFyIGE9dGhpc1t1XSxvPS0xLGw9YS5sZW5ndGg7KytvPGw7KShlPWFbb10pJiYoci5wdXNoKHQ9Y2Eobi5jYWxsKGUsZS5fX2RhdGFfXyxvLHUpKSksdC5wYXJlbnROb2RlPWUpO3JldHVybiBFKHIpfTt2YXIgQ2E9e3N2ZzoiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLHhodG1sOiJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIix4bGluazoiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIseG1sOiJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiLHhtbG5zOiJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zLyJ9O29hLm5zPXtwcmVmaXg6Q2EscXVhbGlmeTpmdW5jdGlvbihuKXt2YXIgdD1uLmluZGV4T2YoIjoiKSxlPW47cmV0dXJuIHQ+PTAmJiJ4bWxucyIhPT0oZT1uLnNsaWNlKDAsdCkpJiYobj1uLnNsaWNlKHQrMSkpLENhLmhhc093blByb3BlcnR5KGUpP3tzcGFjZTpDYVtlXSxsb2NhbDpufTpufX0sQWEuYXR0cj1mdW5jdGlvbihuLHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg8Mil7aWYoInN0cmluZyI9PXR5cGVvZiBuKXt2YXIgZT10aGlzLm5vZGUoKTtyZXR1cm4gbj1vYS5ucy5xdWFsaWZ5KG4pLG4ubG9jYWw/ZS5nZXRBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpOmUuZ2V0QXR0cmlidXRlKG4pfWZvcih0IGluIG4pdGhpcy5lYWNoKHoodCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaCh6KG4sdCkpfSxBYS5jbGFzc2VkPWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pe3ZhciBlPXRoaXMubm9kZSgpLHI9KG49VChuKSkubGVuZ3RoLHU9LTE7aWYodD1lLmNsYXNzTGlzdCl7Zm9yKDsrK3U8cjspaWYoIXQuY29udGFpbnMoblt1XSkpcmV0dXJuITF9ZWxzZSBmb3IodD1lLmdldEF0dHJpYnV0ZSgiY2xhc3MiKTsrK3U8cjspaWYoIXEoblt1XSkudGVzdCh0KSlyZXR1cm4hMTtyZXR1cm4hMH1mb3IodCBpbiBuKXRoaXMuZWFjaChSKHQsblt0XSkpO3JldHVybiB0aGlzfXJldHVybiB0aGlzLmVhY2goUihuLHQpKX0sQWEuc3R5bGU9ZnVuY3Rpb24obixlLHIpe3ZhciB1PWFyZ3VtZW50cy5sZW5ndGg7aWYoMz51KXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+dSYmKGU9IiIpO2ZvcihyIGluIG4pdGhpcy5lYWNoKFAocixuW3JdLGUpKTtyZXR1cm4gdGhpc31pZigyPnUpe3ZhciBpPXRoaXMubm9kZSgpO3JldHVybiB0KGkpLmdldENvbXB1dGVkU3R5bGUoaSxudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKG4pfXI9IiJ9cmV0dXJuIHRoaXMuZWFjaChQKG4sZSxyKSl9LEFhLnByb3BlcnR5PWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pcmV0dXJuIHRoaXMubm9kZSgpW25dO2Zvcih0IGluIG4pdGhpcy5lYWNoKFUodCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaChVKG4sdCkpfSxBYS50ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3RoaXMuZWFjaCgiZnVuY3Rpb24iPT10eXBlb2Ygbj9mdW5jdGlvbigpe3ZhciB0PW4uYXBwbHkodGhpcyxhcmd1bWVudHMpO3RoaXMudGV4dENvbnRlbnQ9bnVsbD09dD8iIjp0fTpudWxsPT1uP2Z1bmN0aW9uKCl7dGhpcy50ZXh0Q29udGVudD0iIn06ZnVuY3Rpb24oKXt0aGlzLnRleHRDb250ZW50PW59KTp0aGlzLm5vZGUoKS50ZXh0Q29udGVudH0sQWEuaHRtbD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90aGlzLmVhY2goImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24oKXt2YXIgdD1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt0aGlzLmlubmVySFRNTD1udWxsPT10PyIiOnR9Om51bGw9PW4/ZnVuY3Rpb24oKXt0aGlzLmlubmVySFRNTD0iIn06ZnVuY3Rpb24oKXt0aGlzLmlubmVySFRNTD1ufSk6dGhpcy5ub2RlKCkuaW5uZXJIVE1MfSxBYS5hcHBlbmQ9ZnVuY3Rpb24obil7cmV0dXJuIG49aihuKSx0aGlzLnNlbGVjdChmdW5jdGlvbigpe3JldHVybiB0aGlzLmFwcGVuZENoaWxkKG4uYXBwbHkodGhpcyxhcmd1bWVudHMpKX0pfSxBYS5pbnNlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj1qKG4pLHQ9QSh0KSx0aGlzLnNlbGVjdChmdW5jdGlvbigpe3JldHVybiB0aGlzLmluc2VydEJlZm9yZShuLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8bnVsbCl9KX0sQWEucmVtb3ZlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChGKX0sQWEuZGF0YT1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIGUobixlKXt2YXIgcix1LGksYT1uLmxlbmd0aCxmPWUubGVuZ3RoLGg9TWF0aC5taW4oYSxmKSxnPW5ldyBBcnJheShmKSxwPW5ldyBBcnJheShmKSx2PW5ldyBBcnJheShhKTtpZih0KXt2YXIgZCxtPW5ldyBjLHk9bmV3IEFycmF5KGEpO2ZvcihyPS0xOysrcjxhOykodT1uW3JdKSYmKG0uaGFzKGQ9dC5jYWxsKHUsdS5fX2RhdGFfXyxyKSk/dltyXT11Om0uc2V0KGQsdSkseVtyXT1kKTtmb3Iocj0tMTsrK3I8ZjspKHU9bS5nZXQoZD10LmNhbGwoZSxpPWVbcl0scikpKT91IT09ITAmJihnW3JdPXUsdS5fX2RhdGFfXz1pKTpwW3JdPUgoaSksbS5zZXQoZCwhMCk7Zm9yKHI9LTE7KytyPGE7KXIgaW4geSYmbS5nZXQoeVtyXSkhPT0hMCYmKHZbcl09bltyXSl9ZWxzZXtmb3Iocj0tMTsrK3I8aDspdT1uW3JdLGk9ZVtyXSx1Pyh1Ll9fZGF0YV9fPWksZ1tyXT11KTpwW3JdPUgoaSk7Zm9yKDtmPnI7KytyKXBbcl09SChlW3JdKTtmb3IoO2E+cjsrK3IpdltyXT1uW3JdfXAudXBkYXRlPWcscC5wYXJlbnROb2RlPWcucGFyZW50Tm9kZT12LnBhcmVudE5vZGU9bi5wYXJlbnROb2RlLG8ucHVzaChwKSxsLnB1c2goZykscy5wdXNoKHYpfXZhciByLHUsaT0tMSxhPXRoaXMubGVuZ3RoO2lmKCFhcmd1bWVudHMubGVuZ3RoKXtmb3Iobj1uZXcgQXJyYXkoYT0ocj10aGlzWzBdKS5sZW5ndGgpOysraTxhOykodT1yW2ldKSYmKG5baV09dS5fX2RhdGFfXyk7cmV0dXJuIG59dmFyIG89WihbXSksbD1FKFtdKSxzPUUoW10pO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBuKWZvcig7KytpPGE7KWUocj10aGlzW2ldLG4uY2FsbChyLHIucGFyZW50Tm9kZS5fX2RhdGFfXyxpKSk7ZWxzZSBmb3IoOysraTxhOyllKHI9dGhpc1tpXSxuKTtyZXR1cm4gbC5lbnRlcj1mdW5jdGlvbigpe3JldHVybiBvfSxsLmV4aXQ9ZnVuY3Rpb24oKXtyZXR1cm4gc30sbH0sQWEuZGF0dW09ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dGhpcy5wcm9wZXJ0eSgiX19kYXRhX18iLG4pOnRoaXMucHJvcGVydHkoIl9fZGF0YV9fIil9LEFhLmZpbHRlcj1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdT1bXTsiZnVuY3Rpb24iIT10eXBlb2YgbiYmKG49TyhuKSk7Zm9yKHZhciBpPTAsYT10aGlzLmxlbmd0aDthPmk7aSsrKXt1LnB1c2godD1bXSksdC5wYXJlbnROb2RlPShlPXRoaXNbaV0pLnBhcmVudE5vZGU7Zm9yKHZhciBvPTAsbD1lLmxlbmd0aDtsPm87bysrKShyPWVbb10pJiZuLmNhbGwocixyLl9fZGF0YV9fLG8saSkmJnQucHVzaChyKX1yZXR1cm4gRSh1KX0sQWEub3JkZXI9ZnVuY3Rpb24oKXtmb3IodmFyIG49LTEsdD10aGlzLmxlbmd0aDsrK248dDspZm9yKHZhciBlLHI9dGhpc1tuXSx1PXIubGVuZ3RoLTEsaT1yW3VdOy0tdT49MDspKGU9clt1XSkmJihpJiZpIT09ZS5uZXh0U2libGluZyYmaS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLGkpLGk9ZSk7cmV0dXJuIHRoaXN9LEFhLnNvcnQ9ZnVuY3Rpb24obil7bj1JLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtmb3IodmFyIHQ9LTEsZT10aGlzLmxlbmd0aDsrK3Q8ZTspdGhpc1t0XS5zb3J0KG4pO3JldHVybiB0aGlzLm9yZGVyKCl9LEFhLmVhY2g9ZnVuY3Rpb24obil7cmV0dXJuIFkodGhpcyxmdW5jdGlvbih0LGUscil7bi5jYWxsKHQsdC5fX2RhdGFfXyxlLHIpfSl9LEFhLmNhbGw9ZnVuY3Rpb24obil7dmFyIHQ9Y2EoYXJndW1lbnRzKTtyZXR1cm4gbi5hcHBseSh0WzBdPXRoaXMsdCksdGhpc30sQWEuZW1wdHk9ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5ub2RlKCl9LEFhLm5vZGU9ZnVuY3Rpb24oKXtmb3IodmFyIG49MCx0PXRoaXMubGVuZ3RoO3Q+bjtuKyspZm9yKHZhciBlPXRoaXNbbl0scj0wLHU9ZS5sZW5ndGg7dT5yO3IrKyl7dmFyIGk9ZVtyXTtpZihpKXJldHVybiBpfXJldHVybiBudWxsfSxBYS5zaXplPWZ1bmN0aW9uKCl7dmFyIG49MDtyZXR1cm4gWSh0aGlzLGZ1bmN0aW9uKCl7KytufSksbn07dmFyIHphPVtdO29hLnNlbGVjdGlvbi5lbnRlcj1aLG9hLnNlbGVjdGlvbi5lbnRlci5wcm90b3R5cGU9emEsemEuYXBwZW5kPUFhLmFwcGVuZCx6YS5lbXB0eT1BYS5lbXB0eSx6YS5ub2RlPUFhLm5vZGUsemEuY2FsbD1BYS5jYWxsLHphLnNpemU9QWEuc2l6ZSx6YS5zZWxlY3Q9ZnVuY3Rpb24obil7Zm9yKHZhciB0LGUscix1LGksYT1bXSxvPS0xLGw9dGhpcy5sZW5ndGg7KytvPGw7KXtyPSh1PXRoaXNbb10pLnVwZGF0ZSxhLnB1c2godD1bXSksdC5wYXJlbnROb2RlPXUucGFyZW50Tm9kZTtmb3IodmFyIGM9LTEscz11Lmxlbmd0aDsrK2M8czspKGk9dVtjXSk/KHQucHVzaChyW2NdPWU9bi5jYWxsKHUucGFyZW50Tm9kZSxpLl9fZGF0YV9fLGMsbykpLGUuX19kYXRhX189aS5fX2RhdGFfXyk6dC5wdXNoKG51bGwpfXJldHVybiBFKGEpfSx6YS5pbnNlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyJiYodD1WKHRoaXMpKSxBYS5pbnNlcnQuY2FsbCh0aGlzLG4sdCl9LG9hLnNlbGVjdD1mdW5jdGlvbih0KXt2YXIgZTtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHQ/KGU9W2thKHQsc2EpXSxlLnBhcmVudE5vZGU9c2EuZG9jdW1lbnRFbGVtZW50KTooZT1bdF0sZS5wYXJlbnROb2RlPW4odCkpLEUoW2VdKX0sb2Euc2VsZWN0QWxsPWZ1bmN0aW9uKG4pe3ZhciB0O3JldHVybiJzdHJpbmciPT10eXBlb2Ygbj8odD1jYShOYShuLHNhKSksdC5wYXJlbnROb2RlPXNhLmRvY3VtZW50RWxlbWVudCk6KHQ9Y2EobiksdC5wYXJlbnROb2RlPW51bGwpLEUoW3RdKX0sQWEub249ZnVuY3Rpb24obix0LGUpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg7aWYoMz5yKXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+ciYmKHQ9ITEpO2ZvcihlIGluIG4pdGhpcy5lYWNoKFgoZSxuW2VdLHQpKTtyZXR1cm4gdGhpc31pZigyPnIpcmV0dXJuKHI9dGhpcy5ub2RlKClbIl9fb24iK25dKSYmci5fO2U9ITF9cmV0dXJuIHRoaXMuZWFjaChYKG4sdCxlKSl9O3ZhciBMYT1vYS5tYXAoe21vdXNlZW50ZXI6Im1vdXNlb3ZlciIsbW91c2VsZWF2ZToibW91c2VvdXQifSk7c2EmJkxhLmZvckVhY2goZnVuY3Rpb24obil7Im9uIituIGluIHNhJiZMYS5yZW1vdmUobil9KTt2YXIgcWEsVGE9MDtvYS5tb3VzZT1mdW5jdGlvbihuKXtyZXR1cm4gSihuLGsoKSl9O3ZhciBSYT10aGlzLm5hdmlnYXRvciYmL1dlYktpdC8udGVzdCh0aGlzLm5hdmlnYXRvci51c2VyQWdlbnQpPy0xOjA7b2EudG91Y2g9ZnVuY3Rpb24obix0LGUpe2lmKGFyZ3VtZW50cy5sZW5ndGg8MyYmKGU9dCx0PWsoKS5jaGFuZ2VkVG91Y2hlcyksdClmb3IodmFyIHIsdT0wLGk9dC5sZW5ndGg7aT51OysrdSlpZigocj10W3VdKS5pZGVudGlmaWVyPT09ZSlyZXR1cm4gSihuLHIpfSxvYS5iZWhhdmlvci5kcmFnPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbigpe3RoaXMub24oIm1vdXNlZG93bi5kcmFnIixpKS5vbigidG91Y2hzdGFydC5kcmFnIixhKX1mdW5jdGlvbiBlKG4sdCxlLGksYSl7cmV0dXJuIGZ1bmN0aW9uKCl7ZnVuY3Rpb24gbygpe3ZhciBuLGUscj10KGgsdik7ciYmKG49clswXS1NWzBdLGU9clsxXS1NWzFdLHB8PW58ZSxNPXIsZyh7dHlwZToiZHJhZyIseDpyWzBdK2NbMF0seTpyWzFdK2NbMV0sZHg6bixkeTplfSkpfWZ1bmN0aW9uIGwoKXt0KGgsdikmJihtLm9uKGkrZCxudWxsKS5vbihhK2QsbnVsbCkseShwKSxnKHt0eXBlOiJkcmFnZW5kIn0pKX12YXIgYyxzPXRoaXMsZj1vYS5ldmVudC50YXJnZXQsaD1zLnBhcmVudE5vZGUsZz1yLm9mKHMsYXJndW1lbnRzKSxwPTAsdj1uKCksZD0iLmRyYWciKyhudWxsPT12PyIiOiItIit2KSxtPW9hLnNlbGVjdChlKGYpKS5vbihpK2Qsbykub24oYStkLGwpLHk9VyhmKSxNPXQoaCx2KTt1PyhjPXUuYXBwbHkocyxhcmd1bWVudHMpLGM9W2MueC1NWzBdLGMueS1NWzFdXSk6Yz1bMCwwXSxnKHt0eXBlOiJkcmFnc3RhcnQifSl9fXZhciByPU4obiwiZHJhZyIsImRyYWdzdGFydCIsImRyYWdlbmQiKSx1PW51bGwsaT1lKGIsb2EubW91c2UsdCwibW91c2Vtb3ZlIiwibW91c2V1cCIpLGE9ZShHLG9hLnRvdWNoLHksInRvdWNobW92ZSIsInRvdWNoZW5kIik7cmV0dXJuIG4ub3JpZ2luPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PXQsbik6dX0sb2EucmViaW5kKG4sciwib24iKX0sb2EudG91Y2hlcz1mdW5jdGlvbihuLHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDImJih0PWsoKS50b3VjaGVzKSx0P2NhKHQpLm1hcChmdW5jdGlvbih0KXt2YXIgZT1KKG4sdCk7cmV0dXJuIGUuaWRlbnRpZmllcj10LmlkZW50aWZpZXIsZX0pOltdfTt2YXIgRGE9MWUtNixQYT1EYSpEYSxVYT1NYXRoLlBJLGphPTIqVWEsRmE9amEtRGEsSGE9VWEvMixPYT1VYS8xODAsSWE9MTgwL1VhLFlhPU1hdGguU1FSVDIsWmE9MixWYT00O29hLmludGVycG9sYXRlWm9vbT1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdT1uWzBdLGk9blsxXSxhPW5bMl0sbz10WzBdLGw9dFsxXSxjPXRbMl0scz1vLXUsZj1sLWksaD1zKnMrZipmO2lmKFBhPmgpcj1NYXRoLmxvZyhjL2EpL1lhLGU9ZnVuY3Rpb24obil7cmV0dXJuW3UrbipzLGkrbipmLGEqTWF0aC5leHAoWWEqbipyKV19O2Vsc2V7dmFyIGc9TWF0aC5zcXJ0KGgpLHA9KGMqYy1hKmErVmEqaCkvKDIqYSpaYSpnKSx2PShjKmMtYSphLVZhKmgpLygyKmMqWmEqZyksZD1NYXRoLmxvZyhNYXRoLnNxcnQocCpwKzEpLXApLG09TWF0aC5sb2coTWF0aC5zcXJ0KHYqdisxKS12KTtyPShtLWQpL1lhLGU9ZnVuY3Rpb24obil7dmFyIHQ9bipyLGU9cm4oZCksbz1hLyhaYSpnKSooZSp1bihZYSp0K2QpLWVuKGQpKTtyZXR1cm5bdStvKnMsaStvKmYsYSplL3JuKFlhKnQrZCldfX1yZXR1cm4gZS5kdXJhdGlvbj0xZTMqcixlfSxvYS5iZWhhdmlvci56b29tPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtuLm9uKEwsZikub24oJGErIi56b29tIixnKS5vbigiZGJsY2xpY2suem9vbSIscCkub24oUixoKX1mdW5jdGlvbiBlKG4pe3JldHVyblsoblswXS1rLngpL2suaywoblsxXS1rLnkpL2sua119ZnVuY3Rpb24gcihuKXtyZXR1cm5bblswXSprLmsray54LG5bMV0qay5rK2sueV19ZnVuY3Rpb24gdShuKXtrLms9TWF0aC5tYXgoQVswXSxNYXRoLm1pbihBWzFdLG4pKX1mdW5jdGlvbiBpKG4sdCl7dD1yKHQpLGsueCs9blswXS10WzBdLGsueSs9blsxXS10WzFdfWZ1bmN0aW9uIGEodCxlLHIsYSl7dC5fX2NoYXJ0X189e3g6ay54LHk6ay55LGs6ay5rfSx1KE1hdGgucG93KDIsYSkpLGkoZD1lLHIpLHQ9b2Euc2VsZWN0KHQpLEM+MCYmKHQ9dC50cmFuc2l0aW9uKCkuZHVyYXRpb24oQykpLHQuY2FsbChuLmV2ZW50KX1mdW5jdGlvbiBvKCl7YiYmYi5kb21haW4oeC5yYW5nZSgpLm1hcChmdW5jdGlvbihuKXtyZXR1cm4obi1rLngpL2sua30pLm1hcCh4LmludmVydCkpLHcmJncuZG9tYWluKF8ucmFuZ2UoKS5tYXAoZnVuY3Rpb24obil7cmV0dXJuKG4tay55KS9rLmt9KS5tYXAoXy5pbnZlcnQpKX1mdW5jdGlvbiBsKG4pe3orK3x8bih7dHlwZToiem9vbXN0YXJ0In0pfWZ1bmN0aW9uIGMobil7bygpLG4oe3R5cGU6Inpvb20iLHNjYWxlOmsuayx0cmFuc2xhdGU6W2sueCxrLnldfSl9ZnVuY3Rpb24gcyhuKXstLXp8fChuKHt0eXBlOiJ6b29tZW5kIn0pLGQ9bnVsbCl9ZnVuY3Rpb24gZigpe2Z1bmN0aW9uIG4oKXtvPTEsaShvYS5tb3VzZSh1KSxoKSxjKGEpfWZ1bmN0aW9uIHIoKXtmLm9uKHEsbnVsbCkub24oVCxudWxsKSxnKG8pLHMoYSl9dmFyIHU9dGhpcyxhPUQub2YodSxhcmd1bWVudHMpLG89MCxmPW9hLnNlbGVjdCh0KHUpKS5vbihxLG4pLm9uKFQsciksaD1lKG9hLm1vdXNlKHUpKSxnPVcodSk7T2wuY2FsbCh1KSxsKGEpfWZ1bmN0aW9uIGgoKXtmdW5jdGlvbiBuKCl7dmFyIG49b2EudG91Y2hlcyhwKTtyZXR1cm4gZz1rLmssbi5mb3JFYWNoKGZ1bmN0aW9uKG4pe24uaWRlbnRpZmllciBpbiBkJiYoZFtuLmlkZW50aWZpZXJdPWUobikpfSksbn1mdW5jdGlvbiB0KCl7dmFyIHQ9b2EuZXZlbnQudGFyZ2V0O29hLnNlbGVjdCh0KS5vbih4LHIpLm9uKGIsbyksXy5wdXNoKHQpO2Zvcih2YXIgZT1vYS5ldmVudC5jaGFuZ2VkVG91Y2hlcyx1PTAsaT1lLmxlbmd0aDtpPnU7Kyt1KWRbZVt1XS5pZGVudGlmaWVyXT1udWxsO3ZhciBsPW4oKSxjPURhdGUubm93KCk7aWYoMT09PWwubGVuZ3RoKXtpZig1MDA+Yy1NKXt2YXIgcz1sWzBdO2EocCxzLGRbcy5pZGVudGlmaWVyXSxNYXRoLmZsb29yKE1hdGgubG9nKGsuaykvTWF0aC5MTjIpKzEpLFMoKX1NPWN9ZWxzZSBpZihsLmxlbmd0aD4xKXt2YXIgcz1sWzBdLGY9bFsxXSxoPXNbMF0tZlswXSxnPXNbMV0tZlsxXTttPWgqaCtnKmd9fWZ1bmN0aW9uIHIoKXt2YXIgbix0LGUscixhPW9hLnRvdWNoZXMocCk7T2wuY2FsbChwKTtmb3IodmFyIG89MCxsPWEubGVuZ3RoO2w+bzsrK28scj1udWxsKWlmKGU9YVtvXSxyPWRbZS5pZGVudGlmaWVyXSl7aWYodClicmVhaztuPWUsdD1yfWlmKHIpe3ZhciBzPShzPWVbMF0tblswXSkqcysocz1lWzFdLW5bMV0pKnMsZj1tJiZNYXRoLnNxcnQocy9tKTtuPVsoblswXStlWzBdKS8yLChuWzFdK2VbMV0pLzJdLHQ9Wyh0WzBdK3JbMF0pLzIsKHRbMV0rclsxXSkvMl0sdShmKmcpfU09bnVsbCxpKG4sdCksYyh2KX1mdW5jdGlvbiBvKCl7aWYob2EuZXZlbnQudG91Y2hlcy5sZW5ndGgpe2Zvcih2YXIgdD1vYS5ldmVudC5jaGFuZ2VkVG91Y2hlcyxlPTAscj10Lmxlbmd0aDtyPmU7KytlKWRlbGV0ZSBkW3RbZV0uaWRlbnRpZmllcl07Zm9yKHZhciB1IGluIGQpcmV0dXJuIHZvaWQgbigpfW9hLnNlbGVjdEFsbChfKS5vbih5LG51bGwpLHcub24oTCxmKS5vbihSLGgpLE4oKSxzKHYpfXZhciBnLHA9dGhpcyx2PUQub2YocCxhcmd1bWVudHMpLGQ9e30sbT0wLHk9Ii56b29tLSIrb2EuZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllcix4PSJ0b3VjaG1vdmUiK3ksYj0idG91Y2hlbmQiK3ksXz1bXSx3PW9hLnNlbGVjdChwKSxOPVcocCk7dCgpLGwodiksdy5vbihMLG51bGwpLm9uKFIsdCl9ZnVuY3Rpb24gZygpe3ZhciBuPUQub2YodGhpcyxhcmd1bWVudHMpO3k/Y2xlYXJUaW1lb3V0KHkpOihPbC5jYWxsKHRoaXMpLHY9ZShkPW18fG9hLm1vdXNlKHRoaXMpKSxsKG4pKSx5PXNldFRpbWVvdXQoZnVuY3Rpb24oKXt5PW51bGwscyhuKX0sNTApLFMoKSx1KE1hdGgucG93KDIsLjAwMipYYSgpKSprLmspLGkoZCx2KSxjKG4pfWZ1bmN0aW9uIHAoKXt2YXIgbj1vYS5tb3VzZSh0aGlzKSx0PU1hdGgubG9nKGsuaykvTWF0aC5MTjI7YSh0aGlzLG4sZShuKSxvYS5ldmVudC5zaGlmdEtleT9NYXRoLmNlaWwodCktMTpNYXRoLmZsb29yKHQpKzEpfXZhciB2LGQsbSx5LE0seCxiLF8sdyxrPXt4OjAseTowLGs6MX0sRT1bOTYwLDUwMF0sQT1CYSxDPTI1MCx6PTAsTD0ibW91c2Vkb3duLnpvb20iLHE9Im1vdXNlbW92ZS56b29tIixUPSJtb3VzZXVwLnpvb20iLFI9InRvdWNoc3RhcnQuem9vbSIsRD1OKG4sInpvb21zdGFydCIsInpvb20iLCJ6b29tZW5kIik7cmV0dXJuICRhfHwoJGE9Im9ud2hlZWwiaW4gc2E/KFhhPWZ1bmN0aW9uKCl7cmV0dXJuLW9hLmV2ZW50LmRlbHRhWSoob2EuZXZlbnQuZGVsdGFNb2RlPzEyMDoxKX0sIndoZWVsIik6Im9ubW91c2V3aGVlbCJpbiBzYT8oWGE9ZnVuY3Rpb24oKXtyZXR1cm4gb2EuZXZlbnQud2hlZWxEZWx0YX0sIm1vdXNld2hlZWwiKTooWGE9ZnVuY3Rpb24oKXtyZXR1cm4tb2EuZXZlbnQuZGV0YWlsfSwiTW96TW91c2VQaXhlbFNjcm9sbCIpKSxuLmV2ZW50PWZ1bmN0aW9uKG4pe24uZWFjaChmdW5jdGlvbigpe3ZhciBuPUQub2YodGhpcyxhcmd1bWVudHMpLHQ9aztGbD9vYS5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpLmVhY2goInN0YXJ0Lnpvb20iLGZ1bmN0aW9uKCl7az10aGlzLl9fY2hhcnRfX3x8e3g6MCx5OjAsazoxfSxsKG4pfSkudHdlZW4oInpvb206em9vbSIsZnVuY3Rpb24oKXt2YXIgZT1FWzBdLHI9RVsxXSx1PWQ/ZFswXTplLzIsaT1kP2RbMV06ci8yLGE9b2EuaW50ZXJwb2xhdGVab29tKFsodS1rLngpL2suaywoaS1rLnkpL2suayxlL2sua10sWyh1LXQueCkvdC5rLChpLXQueSkvdC5rLGUvdC5rXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciByPWEodCksbz1lL3JbMl07dGhpcy5fX2NoYXJ0X189az17eDp1LXJbMF0qbyx5OmktclsxXSpvLGs6b30sYyhuKX19KS5lYWNoKCJpbnRlcnJ1cHQuem9vbSIsZnVuY3Rpb24oKXtzKG4pfSkuZWFjaCgiZW5kLnpvb20iLGZ1bmN0aW9uKCl7cyhuKX0pOih0aGlzLl9fY2hhcnRfXz1rLGwobiksYyhuKSxzKG4pKX0pfSxuLnRyYW5zbGF0ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaz17eDordFswXSx5Oit0WzFdLGs6ay5rfSxvKCksbik6W2sueCxrLnldfSxuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhrPXt4OmsueCx5OmsueSxrOm51bGx9LHUoK3QpLG8oKSxuKTprLmt9LG4uc2NhbGVFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KEE9bnVsbD09dD9CYTpbK3RbMF0sK3RbMV1dLG4pOkF9LG4uY2VudGVyPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhtPXQmJlsrdFswXSwrdFsxXV0sbik6bX0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhFPXQmJlsrdFswXSwrdFsxXV0sbik6RX0sbi5kdXJhdGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oQz0rdCxuKTpDfSxuLng9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGI9dCx4PXQuY29weSgpLGs9e3g6MCx5OjAsazoxfSxuKTpifSxuLnk9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHc9dCxfPXQuY29weSgpLGs9e3g6MCx5OjAsazoxfSxuKTp3fSxvYS5yZWJpbmQobixELCJvbiIpfTt2YXIgWGEsJGEsQmE9WzAsMS8wXTtvYS5jb2xvcj1vbixvbi5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5yZ2IoKSsiIn0sb2EuaHNsPWxuO3ZhciBXYT1sbi5wcm90b3R5cGU9bmV3IG9uO1dhLmJyaWdodGVyPWZ1bmN0aW9uKG4pe3JldHVybiBuPU1hdGgucG93KC43LGFyZ3VtZW50cy5sZW5ndGg/bjoxKSxuZXcgbG4odGhpcy5oLHRoaXMucyx0aGlzLmwvbil9LFdhLmRhcmtlcj1mdW5jdGlvbihuKXtyZXR1cm4gbj1NYXRoLnBvdyguNyxhcmd1bWVudHMubGVuZ3RoP246MSksbmV3IGxuKHRoaXMuaCx0aGlzLnMsbip0aGlzLmwpfSxXYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gY24odGhpcy5oLHRoaXMucyx0aGlzLmwpfSxvYS5oY2w9c247dmFyIEphPXNuLnByb3RvdHlwZT1uZXcgb247SmEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG5ldyBzbih0aGlzLmgsdGhpcy5jLE1hdGgubWluKDEwMCx0aGlzLmwrR2EqKGFyZ3VtZW50cy5sZW5ndGg/bjoxKSkpfSxKYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG5ldyBzbih0aGlzLmgsdGhpcy5jLE1hdGgubWF4KDAsdGhpcy5sLUdhKihhcmd1bWVudHMubGVuZ3RoP246MSkpKX0sSmEucmdiPWZ1bmN0aW9uKCl7cmV0dXJuIGZuKHRoaXMuaCx0aGlzLmMsdGhpcy5sKS5yZ2IoKX0sb2EubGFiPWhuO3ZhciBHYT0xOCxLYT0uOTUwNDcsUWE9MSxubz0xLjA4ODgzLHRvPWhuLnByb3RvdHlwZT1uZXcgb247dG8uYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG5ldyBobihNYXRoLm1pbigxMDAsdGhpcy5sK0dhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSx0by5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG5ldyBobihNYXRoLm1heCgwLHRoaXMubC1HYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSx0aGlzLmEsdGhpcy5iKX0sdG8ucmdiPWZ1bmN0aW9uKCl7cmV0dXJuIGduKHRoaXMubCx0aGlzLmEsdGhpcy5iKX0sb2EucmdiPXluO3ZhciBlbz15bi5wcm90b3R5cGU9bmV3IG9uO2VvLmJyaWdodGVyPWZ1bmN0aW9uKG4pe249TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpO3ZhciB0PXRoaXMucixlPXRoaXMuZyxyPXRoaXMuYix1PTMwO3JldHVybiB0fHxlfHxyPyh0JiZ1PnQmJih0PXUpLGUmJnU+ZSYmKGU9dSksciYmdT5yJiYocj11KSxuZXcgeW4oTWF0aC5taW4oMjU1LHQvbiksTWF0aC5taW4oMjU1LGUvbiksTWF0aC5taW4oMjU1LHIvbikpKTpuZXcgeW4odSx1LHUpfSxlby5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLG5ldyB5bihuKnRoaXMucixuKnRoaXMuZyxuKnRoaXMuYil9LGVvLmhzbD1mdW5jdGlvbigpe3JldHVybiB3bih0aGlzLnIsdGhpcy5nLHRoaXMuYil9LGVvLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIiMiK2JuKHRoaXMucikrYm4odGhpcy5nKStibih0aGlzLmIpfTt2YXIgcm89b2EubWFwKHthbGljZWJsdWU6MTU3OTIzODMsYW50aXF1ZXdoaXRlOjE2NDQ0Mzc1LGFxdWE6NjU1MzUsYXF1YW1hcmluZTo4Mzg4NTY0LGF6dXJlOjE1Nzk0MTc1LGJlaWdlOjE2MTE5MjYwLGJpc3F1ZToxNjc3MDI0NCxibGFjazowLGJsYW5jaGVkYWxtb25kOjE2NzcyMDQ1LGJsdWU6MjU1LGJsdWV2aW9sZXQ6OTA1NTIwMixicm93bjoxMDgyNDIzNCxidXJseXdvb2Q6MTQ1OTYyMzEsY2FkZXRibHVlOjYyNjY1MjgsY2hhcnRyZXVzZTo4Mzg4MzUyLGNob2NvbGF0ZToxMzc4OTQ3MCxjb3JhbDoxNjc0NDI3Mixjb3JuZmxvd2VyYmx1ZTo2NTkxOTgxLGNvcm5zaWxrOjE2Nzc1Mzg4LGNyaW1zb246MTQ0MjMxMDAsY3lhbjo2NTUzNSxkYXJrYmx1ZToxMzksZGFya2N5YW46MzU3MjMsZGFya2dvbGRlbnJvZDoxMjA5MjkzOSxkYXJrZ3JheToxMTExOTAxNyxkYXJrZ3JlZW46MjU2MDAsZGFya2dyZXk6MTExMTkwMTcsZGFya2toYWtpOjEyNDMzMjU5LGRhcmttYWdlbnRhOjkxMDk2NDMsZGFya29saXZlZ3JlZW46NTU5Nzk5OSxkYXJrb3JhbmdlOjE2NzQ3NTIwLGRhcmtvcmNoaWQ6MTAwNDAwMTIsZGFya3JlZDo5MTA5NTA0LGRhcmtzYWxtb246MTUzMDg0MTAsZGFya3NlYWdyZWVuOjk0MTk5MTksZGFya3NsYXRlYmx1ZTo0NzM0MzQ3LGRhcmtzbGF0ZWdyYXk6MzEwMDQ5NSxkYXJrc2xhdGVncmV5OjMxMDA0OTUsZGFya3R1cnF1b2lzZTo1Mjk0NSxkYXJrdmlvbGV0Ojk2OTk1MzksZGVlcHBpbms6MTY3MTY5NDcsZGVlcHNreWJsdWU6NDkxNTEsZGltZ3JheTo2OTA4MjY1LGRpbWdyZXk6NjkwODI2NSxkb2RnZXJibHVlOjIwMDMxOTksZmlyZWJyaWNrOjExNjc0MTQ2LGZsb3JhbHdoaXRlOjE2Nzc1OTIwLGZvcmVzdGdyZWVuOjIyNjM4NDIsZnVjaHNpYToxNjcxMTkzNSxnYWluc2Jvcm86MTQ0NzQ0NjAsZ2hvc3R3aGl0ZToxNjMxNjY3MSxnb2xkOjE2NzY2NzIwLGdvbGRlbnJvZDoxNDMyOTEyMCxncmF5Ojg0MjE1MDQsZ3JlZW46MzI3NjgsZ3JlZW55ZWxsb3c6MTE0MDMwNTUsZ3JleTo4NDIxNTA0LGhvbmV5ZGV3OjE1Nzk0MTYwLGhvdHBpbms6MTY3Mzg3NDAsaW5kaWFucmVkOjEzNDU4NTI0LGluZGlnbzo0OTE1MzMwLGl2b3J5OjE2Nzc3MjAwLGtoYWtpOjE1Nzg3NjYwLGxhdmVuZGVyOjE1MTMyNDEwLGxhdmVuZGVyYmx1c2g6MTY3NzMzNjUsbGF3bmdyZWVuOjgxOTA5NzYsbGVtb25jaGlmZm9uOjE2Nzc1ODg1LGxpZ2h0Ymx1ZToxMTM5MzI1NCxsaWdodGNvcmFsOjE1NzYxNTM2LGxpZ2h0Y3lhbjoxNDc0NTU5OSxsaWdodGdvbGRlbnJvZHllbGxvdzoxNjQ0ODIxMCxsaWdodGdyYXk6MTM4ODIzMjMsbGlnaHRncmVlbjo5NDk4MjU2LGxpZ2h0Z3JleToxMzg4MjMyMyxsaWdodHBpbms6MTY3NTg0NjUsbGlnaHRzYWxtb246MTY3NTI3NjIsbGlnaHRzZWFncmVlbjoyMTQyODkwLGxpZ2h0c2t5Ymx1ZTo4OTAwMzQ2LGxpZ2h0c2xhdGVncmF5Ojc4MzM3NTMsbGlnaHRzbGF0ZWdyZXk6NzgzMzc1MyxsaWdodHN0ZWVsYmx1ZToxMTU4NDczNCxsaWdodHllbGxvdzoxNjc3NzE4NCxsaW1lOjY1MjgwLGxpbWVncmVlbjozMzI5MzMwLGxpbmVuOjE2NDQ1NjcwLG1hZ2VudGE6MTY3MTE5MzUsbWFyb29uOjgzODg2MDgsbWVkaXVtYXF1YW1hcmluZTo2NzM3MzIyLG1lZGl1bWJsdWU6MjA1LG1lZGl1bW9yY2hpZDoxMjIxMTY2NyxtZWRpdW1wdXJwbGU6OTY2MjY4MyxtZWRpdW1zZWFncmVlbjozOTc4MDk3LG1lZGl1bXNsYXRlYmx1ZTo4MDg3NzkwLG1lZGl1bXNwcmluZ2dyZWVuOjY0MTU0LG1lZGl1bXR1cnF1b2lzZTo0NzcyMzAwLG1lZGl1bXZpb2xldHJlZDoxMzA0NzE3MyxtaWRuaWdodGJsdWU6MTY0NDkxMixtaW50Y3JlYW06MTYxMjE4NTAsbWlzdHlyb3NlOjE2NzcwMjczLG1vY2Nhc2luOjE2NzcwMjI5LG5hdmFqb3doaXRlOjE2NzY4Njg1LG5hdnk6MTI4LG9sZGxhY2U6MTY2NDM1NTgsb2xpdmU6ODQyMTM3NixvbGl2ZWRyYWI6NzA0ODczOSxvcmFuZ2U6MTY3NTM5MjAsb3JhbmdlcmVkOjE2NzI5MzQ0LG9yY2hpZDoxNDMxNTczNCxwYWxlZ29sZGVucm9kOjE1NjU3MTMwLHBhbGVncmVlbjoxMDAyNTg4MCxwYWxldHVycXVvaXNlOjExNTI5OTY2LHBhbGV2aW9sZXRyZWQ6MTQzODEyMDMscGFwYXlhd2hpcDoxNjc3MzA3NyxwZWFjaHB1ZmY6MTY3Njc2NzMscGVydToxMzQ2ODk5MSxwaW5rOjE2NzYxMDM1LHBsdW06MTQ1MjQ2MzcscG93ZGVyYmx1ZToxMTU5MTkxMCxwdXJwbGU6ODM4ODczNixyZWJlY2NhcHVycGxlOjY2OTc4ODEscmVkOjE2NzExNjgwLHJvc3licm93bjoxMjM1NzUxOSxyb3lhbGJsdWU6NDI4Njk0NSxzYWRkbGVicm93bjo5MTI3MTg3LHNhbG1vbjoxNjQxNjg4MixzYW5keWJyb3duOjE2MDMyODY0LHNlYWdyZWVuOjMwNTAzMjcsc2Vhc2hlbGw6MTY3NzQ2Mzgsc2llbm5hOjEwNTA2Nzk3LHNpbHZlcjoxMjYzMjI1Nixza3libHVlOjg5MDAzMzEsc2xhdGVibHVlOjY5NzAwNjEsc2xhdGVncmF5OjczNzI5NDQsc2xhdGVncmV5OjczNzI5NDQsc25vdzoxNjc3NTkzMCxzcHJpbmdncmVlbjo2NTQwNyxzdGVlbGJsdWU6NDYyMDk4MCx0YW46MTM4MDg3ODAsdGVhbDozMjg5Nix0aGlzdGxlOjE0MjA0ODg4LHRvbWF0bzoxNjczNzA5NSx0dXJxdW9pc2U6NDI1MTg1Nix2aW9sZXQ6MTU2MzEwODYsd2hlYXQ6MTYxMTMzMzEsd2hpdGU6MTY3NzcyMTUsd2hpdGVzbW9rZToxNjExOTI4NSx5ZWxsb3c6MTY3NzY5NjAseWVsbG93Z3JlZW46MTAxNDUwNzR9KTtyby5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7cm8uc2V0KG4sTW4odCkpfSksb2EuZnVuY3Rvcj1FbixvYS54aHI9QW4oeSksb2EuZHN2PWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZShuLGUsaSl7YXJndW1lbnRzLmxlbmd0aDwzJiYoaT1lLGU9bnVsbCk7dmFyIGE9Q24obix0LG51bGw9PWU/cjp1KGUpLGkpO3JldHVybiBhLnJvdz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD9hLnJlc3BvbnNlKG51bGw9PShlPW4pP3I6dShuKSk6ZX0sYX1mdW5jdGlvbiByKG4pe3JldHVybiBlLnBhcnNlKG4ucmVzcG9uc2VUZXh0KX1mdW5jdGlvbiB1KG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gZS5wYXJzZSh0LnJlc3BvbnNlVGV4dCxuKX19ZnVuY3Rpb24gaSh0KXtyZXR1cm4gdC5tYXAoYSkuam9pbihuKX1mdW5jdGlvbiBhKG4pe3JldHVybiBvLnRlc3Qobik/JyInK24ucmVwbGFjZSgvXCIvZywnIiInKSsnIic6bn12YXIgbz1uZXcgUmVnRXhwKCdbIicrbisiXG5dIiksbD1uLmNoYXJDb2RlQXQoMCk7cmV0dXJuIGUucGFyc2U9ZnVuY3Rpb24obix0KXt2YXIgcjtyZXR1cm4gZS5wYXJzZVJvd3MobixmdW5jdGlvbihuLGUpe2lmKHIpcmV0dXJuIHIobixlLTEpO3ZhciB1PW5ldyBGdW5jdGlvbigiZCIsInJldHVybiB7IituLm1hcChmdW5jdGlvbihuLHQpe3JldHVybiBKU09OLnN0cmluZ2lmeShuKSsiOiBkWyIrdCsiXSJ9KS5qb2luKCIsIikrIn0iKTtyPXQ/ZnVuY3Rpb24obixlKXtyZXR1cm4gdCh1KG4pLGUpfTp1fSl9LGUucGFyc2VSb3dzPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZSgpe2lmKHM+PWMpcmV0dXJuIGE7aWYodSlyZXR1cm4gdT0hMSxpO3ZhciB0PXM7aWYoMzQ9PT1uLmNoYXJDb2RlQXQodCkpe2Zvcih2YXIgZT10O2UrKzxjOylpZigzND09PW4uY2hhckNvZGVBdChlKSl7aWYoMzQhPT1uLmNoYXJDb2RlQXQoZSsxKSlicmVhazsrK2V9cz1lKzI7dmFyIHI9bi5jaGFyQ29kZUF0KGUrMSk7cmV0dXJuIDEzPT09cj8odT0hMCwxMD09PW4uY2hhckNvZGVBdChlKzIpJiYrK3MpOjEwPT09ciYmKHU9ITApLG4uc2xpY2UodCsxLGUpLnJlcGxhY2UoLyIiL2csJyInKX1mb3IoO2M+czspe3ZhciByPW4uY2hhckNvZGVBdChzKyspLG89MTtpZigxMD09PXIpdT0hMDtlbHNlIGlmKDEzPT09cil1PSEwLDEwPT09bi5jaGFyQ29kZUF0KHMpJiYoKytzLCsrbyk7ZWxzZSBpZihyIT09bCljb250aW51ZTtyZXR1cm4gbi5zbGljZSh0LHMtbyl9cmV0dXJuIG4uc2xpY2UodCl9Zm9yKHZhciByLHUsaT17fSxhPXt9LG89W10sYz1uLmxlbmd0aCxzPTAsZj0wOyhyPWUoKSkhPT1hOyl7Zm9yKHZhciBoPVtdO3IhPT1pJiZyIT09YTspaC5wdXNoKHIpLHI9ZSgpO3QmJm51bGw9PShoPXQoaCxmKyspKXx8by5wdXNoKGgpfXJldHVybiBvfSxlLmZvcm1hdD1mdW5jdGlvbih0KXtpZihBcnJheS5pc0FycmF5KHRbMF0pKXJldHVybiBlLmZvcm1hdFJvd3ModCk7dmFyIHI9bmV3IG0sdT1bXTtyZXR1cm4gdC5mb3JFYWNoKGZ1bmN0aW9uKG4pe2Zvcih2YXIgdCBpbiBuKXIuaGFzKHQpfHx1LnB1c2goci5hZGQodCkpfSksW3UubWFwKGEpLmpvaW4obildLmNvbmNhdCh0Lm1hcChmdW5jdGlvbih0KXtyZXR1cm4gdS5tYXAoZnVuY3Rpb24obil7cmV0dXJuIGEodFtuXSl9KS5qb2luKG4pfSkpLmpvaW4oIlxuIil9LGUuZm9ybWF0Um93cz1mdW5jdGlvbihuKXtyZXR1cm4gbi5tYXAoaSkuam9pbigiXG4iKX0sZX0sb2EuY3N2PW9hLmRzdigiLCIsInRleHQvY3N2Iiksb2EudHN2PW9hLmRzdigiCSIsInRleHQvdGFiLXNlcGFyYXRlZC12YWx1ZXMiKTt2YXIgdW8saW8sYW8sb28sbG89dGhpc1t4KHRoaXMsInJlcXVlc3RBbmltYXRpb25GcmFtZSIpXXx8ZnVuY3Rpb24obil7c2V0VGltZW91dChuLDE3KX07b2EudGltZXI9ZnVuY3Rpb24oKXtxbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LG9hLnRpbWVyLmZsdXNoPWZ1bmN0aW9uKCl7Um4oKSxEbigpfSxvYS5yb3VuZD1mdW5jdGlvbihuLHQpe3JldHVybiB0P01hdGgucm91bmQobioodD1NYXRoLnBvdygxMCx0KSkpL3Q6TWF0aC5yb3VuZChuKX07dmFyIGNvPVsieSIsInoiLCJhIiwiZiIsInAiLCJuIiwiXHhiNSIsIm0iLCIiLCJrIiwiTSIsIkciLCJUIiwiUCIsIkUiLCJaIiwiWSJdLm1hcChVbik7b2EuZm9ybWF0UHJlZml4PWZ1bmN0aW9uKG4sdCl7dmFyIGU9MDtyZXR1cm4obj0rbikmJigwPm4mJihuKj0tMSksdCYmKG49b2Eucm91bmQobixQbihuLHQpKSksZT0xK01hdGguZmxvb3IoMWUtMTIrTWF0aC5sb2cobikvTWF0aC5MTjEwKSxlPU1hdGgubWF4KC0yNCxNYXRoLm1pbigyNCwzKk1hdGguZmxvb3IoKGUtMSkvMykpKSksY29bOCtlLzNdfTt2YXIgc289Lyg/OihbXntdKT8oWzw+PV5dKSk/KFsrXC0gXSk/KFskI10pPygwKT8oXGQrKT8oLCk/KFwuLT9cZCspPyhbYS16JV0pPy9pLGZvPW9hLm1hcCh7YjpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZygyKX0sYzpmdW5jdGlvbihuKXtyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShuKX0sbzpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZyg4KX0seDpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZygxNil9LFg6ZnVuY3Rpb24obil7cmV0dXJuIG4udG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCl9LGc6ZnVuY3Rpb24obix0KXtyZXR1cm4gbi50b1ByZWNpc2lvbih0KX0sZTpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvRXhwb25lbnRpYWwodCl9LGY6ZnVuY3Rpb24obix0KXtyZXR1cm4gbi50b0ZpeGVkKHQpfSxyOmZ1bmN0aW9uKG4sdCl7cmV0dXJuKG49b2Eucm91bmQobixQbihuLHQpKSkudG9GaXhlZChNYXRoLm1heCgwLE1hdGgubWluKDIwLFBuKG4qKDErMWUtMTUpLHQpKSkpfX0pLGhvPW9hLnRpbWU9e30sZ289RGF0ZTtIbi5wcm90b3R5cGU9e2dldERhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0RhdGUoKX0sZ2V0RGF5OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENEYXkoKX0sZ2V0RnVsbFllYXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0Z1bGxZZWFyKCl9LGdldEhvdXJzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENIb3VycygpfSxnZXRNaWxsaXNlY29uZHM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01pbGxpc2Vjb25kcygpfSxnZXRNaW51dGVzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENNaW51dGVzKCl9LGdldE1vbnRoOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENNb250aCgpfSxnZXRTZWNvbmRzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENTZWNvbmRzKCl9LGdldFRpbWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFRpbWUoKX0sZ2V0VGltZXpvbmVPZmZzZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMH0sdmFsdWVPZjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8udmFsdWVPZigpfSxzZXREYXRlOmZ1bmN0aW9uKCl7cG8uc2V0VVRDRGF0ZS5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX0sc2V0RGF5OmZ1bmN0aW9uKCl7cG8uc2V0VVRDRGF5LmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRGdWxsWWVhcjpmdW5jdGlvbigpe3BvLnNldFVUQ0Z1bGxZZWFyLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRIb3VyczpmdW5jdGlvbigpe3BvLnNldFVUQ0hvdXJzLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRNaWxsaXNlY29uZHM6ZnVuY3Rpb24oKXtwby5zZXRVVENNaWxsaXNlY29uZHMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1pbnV0ZXM6ZnVuY3Rpb24oKXtwby5zZXRVVENNaW51dGVzLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRNb250aDpmdW5jdGlvbigpe3BvLnNldFVUQ01vbnRoLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRTZWNvbmRzOmZ1bmN0aW9uKCl7cG8uc2V0VVRDU2Vjb25kcy5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX0sc2V0VGltZTpmdW5jdGlvbigpe3BvLnNldFRpbWUuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9fTt2YXIgcG89RGF0ZS5wcm90b3R5cGU7aG8ueWVhcj1PbihmdW5jdGlvbihuKXtyZXR1cm4gbj1oby5kYXkobiksbi5zZXRNb250aCgwLDEpLG59LGZ1bmN0aW9uKG4sdCl7bi5zZXRGdWxsWWVhcihuLmdldEZ1bGxZZWFyKCkrdCl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldEZ1bGxZZWFyKCl9KSxoby55ZWFycz1oby55ZWFyLnJhbmdlLGhvLnllYXJzLnV0Yz1oby55ZWFyLnV0Yy5yYW5nZSxoby5kYXk9T24oZnVuY3Rpb24obil7dmFyIHQ9bmV3IGdvKDJlMywwKTtyZXR1cm4gdC5zZXRGdWxsWWVhcihuLmdldEZ1bGxZZWFyKCksbi5nZXRNb250aCgpLG4uZ2V0RGF0ZSgpKSx0fSxmdW5jdGlvbihuLHQpe24uc2V0RGF0ZShuLmdldERhdGUoKSt0KX0sZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF0ZSgpLTF9KSxoby5kYXlzPWhvLmRheS5yYW5nZSxoby5kYXlzLnV0Yz1oby5kYXkudXRjLnJhbmdlLGhvLmRheU9mWWVhcj1mdW5jdGlvbihuKXt2YXIgdD1oby55ZWFyKG4pO3JldHVybiBNYXRoLmZsb29yKChuLXQtNmU0KihuLmdldFRpbWV6b25lT2Zmc2V0KCktdC5nZXRUaW1lem9uZU9mZnNldCgpKSkvODY0ZTUpfSxbInN1bmRheSIsIm1vbmRheSIsInR1ZXNkYXkiLCJ3ZWRuZXNkYXkiLCJ0aHVyc2RheSIsImZyaWRheSIsInNhdHVyZGF5Il0uZm9yRWFjaChmdW5jdGlvbihuLHQpe3Q9Ny10O3ZhciBlPWhvW25dPU9uKGZ1bmN0aW9uKG4pe3JldHVybihuPWhvLmRheShuKSkuc2V0RGF0ZShuLmdldERhdGUoKS0obi5nZXREYXkoKSt0KSU3KSxufSxmdW5jdGlvbihuLHQpe24uc2V0RGF0ZShuLmdldERhdGUoKSs3Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXt2YXIgZT1oby55ZWFyKG4pLmdldERheSgpO3JldHVybiBNYXRoLmZsb29yKChoby5kYXlPZlllYXIobikrKGUrdCklNykvNyktKGUhPT10KX0pO2hvW24rInMiXT1lLnJhbmdlLGhvW24rInMiXS51dGM9ZS51dGMucmFuZ2UsaG9bbisiT2ZZZWFyIl09ZnVuY3Rpb24obil7dmFyIGU9aG8ueWVhcihuKS5nZXREYXkoKTtyZXR1cm4gTWF0aC5mbG9vcigoaG8uZGF5T2ZZZWFyKG4pKyhlK3QpJTcpLzcpfX0pLGhvLndlZWs9aG8uc3VuZGF5LGhvLndlZWtzPWhvLnN1bmRheS5yYW5nZSxoby53ZWVrcy51dGM9aG8uc3VuZGF5LnV0Yy5yYW5nZSxoby53ZWVrT2ZZZWFyPWhvLnN1bmRheU9mWWVhcjt2YXIgdm89eyItIjoiIixfOiIgIiwwOiIwIn0sbW89L15ccypcZCsvLHlvPS9eJS87b2EubG9jYWxlPWZ1bmN0aW9uKG4pe3JldHVybntudW1iZXJGb3JtYXQ6am4obiksdGltZUZvcm1hdDpZbihuKX19O3ZhciBNbz1vYS5sb2NhbGUoe2RlY2ltYWw6Ii4iLHRob3VzYW5kczoiLCIsZ3JvdXBpbmc6WzNdLGN1cnJlbmN5OlsiJCIsIiJdLGRhdGVUaW1lOiIlYSAlYiAlZSAlWCAlWSIsZGF0ZToiJW0vJWQvJVkiLHRpbWU6IiVIOiVNOiVTIixwZXJpb2RzOlsiQU0iLCJQTSJdLGRheXM6WyJTdW5kYXkiLCJNb25kYXkiLCJUdWVzZGF5IiwiV2VkbmVzZGF5IiwiVGh1cnNkYXkiLCJGcmlkYXkiLCJTYXR1cmRheSJdLApzaG9ydERheXM6WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxtb250aHM6WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdLHNob3J0TW9udGhzOlsiSmFuIiwiRmViIiwiTWFyIiwiQXByIiwiTWF5IiwiSnVuIiwiSnVsIiwiQXVnIiwiU2VwIiwiT2N0IiwiTm92IiwiRGVjIl19KTtvYS5mb3JtYXQ9TW8ubnVtYmVyRm9ybWF0LG9hLmdlbz17fSxzdC5wcm90b3R5cGU9e3M6MCx0OjAsYWRkOmZ1bmN0aW9uKG4pe2Z0KG4sdGhpcy50LHhvKSxmdCh4by5zLHRoaXMucyx0aGlzKSx0aGlzLnM/dGhpcy50Kz14by50OnRoaXMucz14by50fSxyZXNldDpmdW5jdGlvbigpe3RoaXMucz10aGlzLnQ9MH0sdmFsdWVPZjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnN9fTt2YXIgeG89bmV3IHN0O29hLmdlby5zdHJlYW09ZnVuY3Rpb24obix0KXtuJiZiby5oYXNPd25Qcm9wZXJ0eShuLnR5cGUpP2JvW24udHlwZV0obix0KTpodChuLHQpfTt2YXIgYm89e0ZlYXR1cmU6ZnVuY3Rpb24obix0KXtodChuLmdlb21ldHJ5LHQpfSxGZWF0dXJlQ29sbGVjdGlvbjpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZT1uLmZlYXR1cmVzLHI9LTEsdT1lLmxlbmd0aDsrK3I8dTspaHQoZVtyXS5nZW9tZXRyeSx0KX19LF9vPXtTcGhlcmU6ZnVuY3Rpb24obix0KXt0LnNwaGVyZSgpfSxQb2ludDpmdW5jdGlvbihuLHQpe249bi5jb29yZGluYXRlcyx0LnBvaW50KG5bMF0sblsxXSxuWzJdKX0sTXVsdGlQb2ludDpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZT1uLmNvb3JkaW5hdGVzLHI9LTEsdT1lLmxlbmd0aDsrK3I8dTspbj1lW3JdLHQucG9pbnQoblswXSxuWzFdLG5bMl0pfSxMaW5lU3RyaW5nOmZ1bmN0aW9uKG4sdCl7Z3Qobi5jb29yZGluYXRlcyx0LDApfSxNdWx0aUxpbmVTdHJpbmc6ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9bi5jb29yZGluYXRlcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KWd0KGVbcl0sdCwwKX0sUG9seWdvbjpmdW5jdGlvbihuLHQpe3B0KG4uY29vcmRpbmF0ZXMsdCl9LE11bHRpUG9seWdvbjpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZT1uLmNvb3JkaW5hdGVzLHI9LTEsdT1lLmxlbmd0aDsrK3I8dTspcHQoZVtyXSx0KX0sR2VvbWV0cnlDb2xsZWN0aW9uOmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciBlPW4uZ2VvbWV0cmllcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KWh0KGVbcl0sdCl9fTtvYS5nZW8uYXJlYT1mdW5jdGlvbihuKXtyZXR1cm4gd289MCxvYS5nZW8uc3RyZWFtKG4sa28pLHdvfTt2YXIgd28sU289bmV3IHN0LGtvPXtzcGhlcmU6ZnVuY3Rpb24oKXt3bys9NCpVYX0scG9pbnQ6YixsaW5lU3RhcnQ6YixsaW5lRW5kOmIscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7U28ucmVzZXQoKSxrby5saW5lU3RhcnQ9dnR9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXt2YXIgbj0yKlNvO3dvKz0wPm4/NCpVYStuOm4sa28ubGluZVN0YXJ0PWtvLmxpbmVFbmQ9a28ucG9pbnQ9Yn19O29hLmdlby5ib3VuZHM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdCl7TS5wdXNoKHg9W3M9bixoPW5dKSxmPnQmJihmPXQpLHQ+ZyYmKGc9dCl9ZnVuY3Rpb24gdCh0LGUpe3ZhciByPWR0KFt0Kk9hLGUqT2FdKTtpZihtKXt2YXIgdT15dChtLHIpLGk9W3VbMV0sLXVbMF0sMF0sYT15dChpLHUpO2J0KGEpLGE9X3QoYSk7dmFyIGw9dC1wLGM9bD4wPzE6LTEsdj1hWzBdKklhKmMsZD1NYShsKT4xODA7aWYoZF4odj5jKnAmJmMqdD52KSl7dmFyIHk9YVsxXSpJYTt5PmcmJihnPXkpfWVsc2UgaWYodj0odiszNjApJTM2MC0xODAsZF4odj5jKnAmJmMqdD52KSl7dmFyIHk9LWFbMV0qSWE7Zj55JiYoZj15KX1lbHNlIGY+ZSYmKGY9ZSksZT5nJiYoZz1lKTtkP3A+dD9vKHMsdCk+byhzLGgpJiYoaD10KTpvKHQsaCk+byhzLGgpJiYocz10KTpoPj1zPyhzPnQmJihzPXQpLHQ+aCYmKGg9dCkpOnQ+cD9vKHMsdCk+byhzLGgpJiYoaD10KTpvKHQsaCk+byhzLGgpJiYocz10KX1lbHNlIG4odCxlKTttPXIscD10fWZ1bmN0aW9uIGUoKXtiLnBvaW50PXR9ZnVuY3Rpb24gcigpe3hbMF09cyx4WzFdPWgsYi5wb2ludD1uLG09bnVsbH1mdW5jdGlvbiB1KG4sZSl7aWYobSl7dmFyIHI9bi1wO3krPU1hKHIpPjE4MD9yKyhyPjA/MzYwOi0zNjApOnJ9ZWxzZSB2PW4sZD1lO2tvLnBvaW50KG4sZSksdChuLGUpfWZ1bmN0aW9uIGkoKXtrby5saW5lU3RhcnQoKX1mdW5jdGlvbiBhKCl7dSh2LGQpLGtvLmxpbmVFbmQoKSxNYSh5KT5EYSYmKHM9LShoPTE4MCkpLHhbMF09cyx4WzFdPWgsbT1udWxsfWZ1bmN0aW9uIG8obix0KXtyZXR1cm4odC09bik8MD90KzM2MDp0fWZ1bmN0aW9uIGwobix0KXtyZXR1cm4gblswXS10WzBdfWZ1bmN0aW9uIGMobix0KXtyZXR1cm4gdFswXTw9dFsxXT90WzBdPD1uJiZuPD10WzFdOm48dFswXXx8dFsxXTxufXZhciBzLGYsaCxnLHAsdixkLG0seSxNLHgsYj17cG9pbnQ6bixsaW5lU3RhcnQ6ZSxsaW5lRW5kOnIscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7Yi5wb2ludD11LGIubGluZVN0YXJ0PWksYi5saW5lRW5kPWEseT0wLGtvLnBvbHlnb25TdGFydCgpfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7a28ucG9seWdvbkVuZCgpLGIucG9pbnQ9bixiLmxpbmVTdGFydD1lLGIubGluZUVuZD1yLDA+U28/KHM9LShoPTE4MCksZj0tKGc9OTApKTp5PkRhP2c9OTA6LURhPnkmJihmPS05MCkseFswXT1zLHhbMV09aH19O3JldHVybiBmdW5jdGlvbihuKXtnPWg9LShzPWY9MS8wKSxNPVtdLG9hLmdlby5zdHJlYW0obixiKTt2YXIgdD1NLmxlbmd0aDtpZih0KXtNLnNvcnQobCk7Zm9yKHZhciBlLHI9MSx1PU1bMF0saT1bdV07dD5yOysrcillPU1bcl0sYyhlWzBdLHUpfHxjKGVbMV0sdSk/KG8odVswXSxlWzFdKT5vKHVbMF0sdVsxXSkmJih1WzFdPWVbMV0pLG8oZVswXSx1WzFdKT5vKHVbMF0sdVsxXSkmJih1WzBdPWVbMF0pKTppLnB1c2godT1lKTtmb3IodmFyIGEsZSxwPS0oMS8wKSx0PWkubGVuZ3RoLTEscj0wLHU9aVt0XTt0Pj1yO3U9ZSwrK3IpZT1pW3JdLChhPW8odVsxXSxlWzBdKSk+cCYmKHA9YSxzPWVbMF0saD11WzFdKX1yZXR1cm4gTT14PW51bGwscz09PTEvMHx8Zj09PTEvMD9bW05hTixOYU5dLFtOYU4sTmFOXV06W1tzLGZdLFtoLGddXX19KCksb2EuZ2VvLmNlbnRyb2lkPWZ1bmN0aW9uKG4pe05vPUVvPUFvPUNvPXpvPUxvPXFvPVRvPVJvPURvPVBvPTAsb2EuZ2VvLnN0cmVhbShuLFVvKTt2YXIgdD1SbyxlPURvLHI9UG8sdT10KnQrZSplK3IqcjtyZXR1cm4gUGE+dSYmKHQ9TG8sZT1xbyxyPVRvLERhPkVvJiYodD1BbyxlPUNvLHI9em8pLHU9dCp0K2UqZStyKnIsUGE+dSk/W05hTixOYU5dOltNYXRoLmF0YW4yKGUsdCkqSWEsdG4oci9NYXRoLnNxcnQodSkpKklhXX07dmFyIE5vLEVvLEFvLENvLHpvLExvLHFvLFRvLFJvLERvLFBvLFVvPXtzcGhlcmU6Yixwb2ludDpTdCxsaW5lU3RhcnQ6TnQsbGluZUVuZDpFdCxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXtVby5saW5lU3RhcnQ9QXR9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXtVby5saW5lU3RhcnQ9TnR9fSxqbz1SdCh6dCxqdCxIdCxbLVVhLC1VYS8yXSksRm89MWU5O29hLmdlby5jbGlwRXh0ZW50PWZ1bmN0aW9uKCl7dmFyIG4sdCxlLHIsdSxpLGE9e3N0cmVhbTpmdW5jdGlvbihuKXtyZXR1cm4gdSYmKHUudmFsaWQ9ITEpLHU9aShuKSx1LnZhbGlkPSEwLHV9LGV4dGVudDpmdW5jdGlvbihvKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1adChuPStvWzBdWzBdLHQ9K29bMF1bMV0sZT0rb1sxXVswXSxyPStvWzFdWzFdKSx1JiYodS52YWxpZD0hMSx1PW51bGwpLGEpOltbbix0XSxbZSxyXV19fTtyZXR1cm4gYS5leHRlbnQoW1swLDBdLFs5NjAsNTAwXV0pfSwob2EuZ2VvLmNvbmljRXF1YWxBcmVhPWZ1bmN0aW9uKCl7cmV0dXJuIFZ0KFh0KX0pLnJhdz1YdCxvYS5nZW8uYWxiZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIG9hLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbOTYsMF0pLmNlbnRlcihbLS42LDM4LjddKS5wYXJhbGxlbHMoWzI5LjUsNDUuNV0pLnNjYWxlKDEwNzApfSxvYS5nZW8uYWxiZXJzVXNhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXt2YXIgaT1uWzBdLGE9blsxXTtyZXR1cm4gdD1udWxsLGUoaSxhKSx0fHwocihpLGEpLHQpfHx1KGksYSksdH12YXIgdCxlLHIsdSxpPW9hLmdlby5hbGJlcnMoKSxhPW9hLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbMTU0LDBdKS5jZW50ZXIoWy0yLDU4LjVdKS5wYXJhbGxlbHMoWzU1LDY1XSksbz1vYS5nZW8uY29uaWNFcXVhbEFyZWEoKS5yb3RhdGUoWzE1NywwXSkuY2VudGVyKFstMywxOS45XSkucGFyYWxsZWxzKFs4LDE4XSksbD17cG9pbnQ6ZnVuY3Rpb24obixlKXt0PVtuLGVdfX07cmV0dXJuIG4uaW52ZXJ0PWZ1bmN0aW9uKG4pe3ZhciB0PWkuc2NhbGUoKSxlPWkudHJhbnNsYXRlKCkscj0oblswXS1lWzBdKS90LHU9KG5bMV0tZVsxXSkvdDtyZXR1cm4odT49LjEyJiYuMjM0PnUmJnI+PS0uNDI1JiYtLjIxND5yP2E6dT49LjE2NiYmLjIzND51JiZyPj0tLjIxNCYmLS4xMTU+cj9vOmkpLmludmVydChuKX0sbi5zdHJlYW09ZnVuY3Rpb24obil7dmFyIHQ9aS5zdHJlYW0obiksZT1hLnN0cmVhbShuKSxyPW8uc3RyZWFtKG4pO3JldHVybntwb2ludDpmdW5jdGlvbihuLHUpe3QucG9pbnQobix1KSxlLnBvaW50KG4sdSksci5wb2ludChuLHUpfSxzcGhlcmU6ZnVuY3Rpb24oKXt0LnNwaGVyZSgpLGUuc3BoZXJlKCksci5zcGhlcmUoKX0sbGluZVN0YXJ0OmZ1bmN0aW9uKCl7dC5saW5lU3RhcnQoKSxlLmxpbmVTdGFydCgpLHIubGluZVN0YXJ0KCl9LGxpbmVFbmQ6ZnVuY3Rpb24oKXt0LmxpbmVFbmQoKSxlLmxpbmVFbmQoKSxyLmxpbmVFbmQoKX0scG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7dC5wb2x5Z29uU3RhcnQoKSxlLnBvbHlnb25TdGFydCgpLHIucG9seWdvblN0YXJ0KCl9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25FbmQoKSxlLnBvbHlnb25FbmQoKSxyLnBvbHlnb25FbmQoKX19fSxuLnByZWNpc2lvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaS5wcmVjaXNpb24odCksYS5wcmVjaXNpb24odCksby5wcmVjaXNpb24odCksbik6aS5wcmVjaXNpb24oKX0sbi5zY2FsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaS5zY2FsZSh0KSxhLnNjYWxlKC4zNSp0KSxvLnNjYWxlKHQpLG4udHJhbnNsYXRlKGkudHJhbnNsYXRlKCkpKTppLnNjYWxlKCl9LG4udHJhbnNsYXRlPWZ1bmN0aW9uKHQpe2lmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiBpLnRyYW5zbGF0ZSgpO3ZhciBjPWkuc2NhbGUoKSxzPSt0WzBdLGY9K3RbMV07cmV0dXJuIGU9aS50cmFuc2xhdGUodCkuY2xpcEV4dGVudChbW3MtLjQ1NSpjLGYtLjIzOCpjXSxbcysuNDU1KmMsZisuMjM4KmNdXSkuc3RyZWFtKGwpLnBvaW50LHI9YS50cmFuc2xhdGUoW3MtLjMwNypjLGYrLjIwMSpjXSkuY2xpcEV4dGVudChbW3MtLjQyNSpjK0RhLGYrLjEyKmMrRGFdLFtzLS4yMTQqYy1EYSxmKy4yMzQqYy1EYV1dKS5zdHJlYW0obCkucG9pbnQsdT1vLnRyYW5zbGF0ZShbcy0uMjA1KmMsZisuMjEyKmNdKS5jbGlwRXh0ZW50KFtbcy0uMjE0KmMrRGEsZisuMTY2KmMrRGFdLFtzLS4xMTUqYy1EYSxmKy4yMzQqYy1EYV1dKS5zdHJlYW0obCkucG9pbnQsbn0sbi5zY2FsZSgxMDcwKX07dmFyIEhvLE9vLElvLFlvLFpvLFZvLFhvPXtwb2ludDpiLGxpbmVTdGFydDpiLGxpbmVFbmQ6Yixwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXtPbz0wLFhvLmxpbmVTdGFydD0kdH0scG9seWdvbkVuZDpmdW5jdGlvbigpe1hvLmxpbmVTdGFydD1Yby5saW5lRW5kPVhvLnBvaW50PWIsSG8rPU1hKE9vLzIpfX0sJG89e3BvaW50OkJ0LGxpbmVTdGFydDpiLGxpbmVFbmQ6Yixwb2x5Z29uU3RhcnQ6Yixwb2x5Z29uRW5kOmJ9LEJvPXtwb2ludDpHdCxsaW5lU3RhcnQ6S3QsbGluZUVuZDpRdCxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXtCby5saW5lU3RhcnQ9bmV9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXtCby5wb2ludD1HdCxCby5saW5lU3RhcnQ9S3QsQm8ubGluZUVuZD1RdH19O29hLmdlby5wYXRoPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtyZXR1cm4gbiYmKCJmdW5jdGlvbiI9PXR5cGVvZiBvJiZpLnBvaW50UmFkaXVzKCtvLmFwcGx5KHRoaXMsYXJndW1lbnRzKSksYSYmYS52YWxpZHx8KGE9dShpKSksb2EuZ2VvLnN0cmVhbShuLGEpKSxpLnJlc3VsdCgpfWZ1bmN0aW9uIHQoKXtyZXR1cm4gYT1udWxsLG59dmFyIGUscix1LGksYSxvPTQuNTtyZXR1cm4gbi5hcmVhPWZ1bmN0aW9uKG4pe3JldHVybiBIbz0wLG9hLmdlby5zdHJlYW0obix1KFhvKSksSG99LG4uY2VudHJvaWQ9ZnVuY3Rpb24obil7cmV0dXJuIEFvPUNvPXpvPUxvPXFvPVRvPVJvPURvPVBvPTAsb2EuZ2VvLnN0cmVhbShuLHUoQm8pKSxQbz9bUm8vUG8sRG8vUG9dOlRvP1tMby9Ubyxxby9Ub106em8/W0FvL3pvLENvL3pvXTpbTmFOLE5hTl19LG4uYm91bmRzPWZ1bmN0aW9uKG4pe3JldHVybiBabz1Wbz0tKElvPVlvPTEvMCksb2EuZ2VvLnN0cmVhbShuLHUoJG8pKSxbW0lvLFlvXSxbWm8sVm9dXX0sbi5wcm9qZWN0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PShlPW4pP24uc3RyZWFtfHxyZShuKTp5LHQoKSk6ZX0sbi5jb250ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPW51bGw9PShyPW4pP25ldyBXdDpuZXcgdGUobiksImZ1bmN0aW9uIiE9dHlwZW9mIG8mJmkucG9pbnRSYWRpdXMobyksdCgpKTpyfSxuLnBvaW50UmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6KGkucG9pbnRSYWRpdXMoK3QpLCt0KSxuKTpvfSxuLnByb2plY3Rpb24ob2EuZ2VvLmFsYmVyc1VzYSgpKS5jb250ZXh0KG51bGwpfSxvYS5nZW8udHJhbnNmb3JtPWZ1bmN0aW9uKG4pe3JldHVybntzdHJlYW06ZnVuY3Rpb24odCl7dmFyIGU9bmV3IHVlKHQpO2Zvcih2YXIgciBpbiBuKWVbcl09bltyXTtyZXR1cm4gZX19fSx1ZS5wcm90b3R5cGU9e3BvaW50OmZ1bmN0aW9uKG4sdCl7dGhpcy5zdHJlYW0ucG9pbnQobix0KX0sc3BoZXJlOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLmxpbmVTdGFydCgpfSxsaW5lRW5kOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0ubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0aGlzLnN0cmVhbS5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLnBvbHlnb25FbmQoKX19LG9hLmdlby5wcm9qZWN0aW9uPWFlLG9hLmdlby5wcm9qZWN0aW9uTXV0YXRvcj1vZSwob2EuZ2VvLmVxdWlyZWN0YW5ndWxhcj1mdW5jdGlvbigpe3JldHVybiBhZShjZSl9KS5yYXc9Y2UuaW52ZXJ0PWNlLG9hLmdlby5yb3RhdGlvbj1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KHQpe3JldHVybiB0PW4odFswXSpPYSx0WzFdKk9hKSx0WzBdKj1JYSx0WzFdKj1JYSx0fXJldHVybiBuPWZlKG5bMF0lMzYwKk9hLG5bMV0qT2Esbi5sZW5ndGg+Mj9uWzJdKk9hOjApLHQuaW52ZXJ0PWZ1bmN0aW9uKHQpe3JldHVybiB0PW4uaW52ZXJ0KHRbMF0qT2EsdFsxXSpPYSksdFswXSo9SWEsdFsxXSo9SWEsdH0sdH0sc2UuaW52ZXJ0PWNlLG9hLmdlby5jaXJjbGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49ImZ1bmN0aW9uIj09dHlwZW9mIHI/ci5hcHBseSh0aGlzLGFyZ3VtZW50cyk6cix0PWZlKC1uWzBdKk9hLC1uWzFdKk9hLDApLmludmVydCx1PVtdO3JldHVybiBlKG51bGwsbnVsbCwxLHtwb2ludDpmdW5jdGlvbihuLGUpe3UucHVzaChuPXQobixlKSksblswXSo9SWEsblsxXSo9SWF9fSkse3R5cGU6IlBvbHlnb24iLGNvb3JkaW5hdGVzOlt1XX19dmFyIHQsZSxyPVswLDBdLHU9NjtyZXR1cm4gbi5vcmlnaW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxuLmFuZ2xlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXZlKCh0PStyKSpPYSx1Kk9hKSxuKTp0fSxuLnByZWNpc2lvbj1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT12ZSh0Kk9hLCh1PStyKSpPYSksbik6dX0sbi5hbmdsZSg5MCl9LG9hLmdlby5kaXN0YW5jZT1mdW5jdGlvbihuLHQpe3ZhciBlLHI9KHRbMF0tblswXSkqT2EsdT1uWzFdKk9hLGk9dFsxXSpPYSxhPU1hdGguc2luKHIpLG89TWF0aC5jb3MociksbD1NYXRoLnNpbih1KSxjPU1hdGguY29zKHUpLHM9TWF0aC5zaW4oaSksZj1NYXRoLmNvcyhpKTtyZXR1cm4gTWF0aC5hdGFuMihNYXRoLnNxcnQoKGU9ZiphKSplKyhlPWMqcy1sKmYqbykqZSksbCpzK2MqZipvKX0sb2EuZ2VvLmdyYXRpY3VsZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXtyZXR1cm57dHlwZToiTXVsdGlMaW5lU3RyaW5nIixjb29yZGluYXRlczp0KCl9fWZ1bmN0aW9uIHQoKXtyZXR1cm4gb2EucmFuZ2UoTWF0aC5jZWlsKGkvZCkqZCx1LGQpLm1hcChoKS5jb25jYXQob2EucmFuZ2UoTWF0aC5jZWlsKGMvbSkqbSxsLG0pLm1hcChnKSkuY29uY2F0KG9hLnJhbmdlKE1hdGguY2VpbChyL3ApKnAsZSxwKS5maWx0ZXIoZnVuY3Rpb24obil7cmV0dXJuIE1hKG4lZCk+RGF9KS5tYXAocykpLmNvbmNhdChvYS5yYW5nZShNYXRoLmNlaWwoby92KSp2LGEsdikuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBNYShuJW0pPkRhfSkubWFwKGYpKX12YXIgZSxyLHUsaSxhLG8sbCxjLHMsZixoLGcscD0xMCx2PXAsZD05MCxtPTM2MCx5PTIuNTtyZXR1cm4gbi5saW5lcz1mdW5jdGlvbigpe3JldHVybiB0KCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybnt0eXBlOiJMaW5lU3RyaW5nIixjb29yZGluYXRlczpufX0pfSxuLm91dGxpbmU9ZnVuY3Rpb24oKXtyZXR1cm57dHlwZToiUG9seWdvbiIsY29vcmRpbmF0ZXM6W2goaSkuY29uY2F0KGcobCkuc2xpY2UoMSksaCh1KS5yZXZlcnNlKCkuc2xpY2UoMSksZyhjKS5yZXZlcnNlKCkuc2xpY2UoMSkpXX19LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JFeHRlbnQodCkubWlub3JFeHRlbnQodCk6bi5taW5vckV4dGVudCgpfSxuLm1ham9yRXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSt0WzBdWzBdLHU9K3RbMV1bMF0sYz0rdFswXVsxXSxsPSt0WzFdWzFdLGk+dSYmKHQ9aSxpPXUsdT10KSxjPmwmJih0PWMsYz1sLGw9dCksbi5wcmVjaXNpb24oeSkpOltbaSxjXSxbdSxsXV19LG4ubWlub3JFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9K3RbMF1bMF0sZT0rdFsxXVswXSxvPSt0WzBdWzFdLGE9K3RbMV1bMV0scj5lJiYodD1yLHI9ZSxlPXQpLG8+YSYmKHQ9byxvPWEsYT10KSxuLnByZWNpc2lvbih5KSk6W1tyLG9dLFtlLGFdXX0sbi5zdGVwPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JTdGVwKHQpLm1pbm9yU3RlcCh0KTpuLm1pbm9yU3RlcCgpfSxuLm1ham9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZD0rdFswXSxtPSt0WzFdLG4pOltkLG1dfSxuLm1pbm9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD0rdFswXSx2PSt0WzFdLG4pOltwLHZdfSxuLnByZWNpc2lvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeT0rdCxzPW1lKG8sYSw5MCksZj15ZShyLGUseSksaD1tZShjLGwsOTApLGc9eWUoaSx1LHkpLG4pOnl9LG4ubWFqb3JFeHRlbnQoW1stMTgwLC05MCtEYV0sWzE4MCw5MC1EYV1dKS5taW5vckV4dGVudChbWy0xODAsLTgwLURhXSxbMTgwLDgwK0RhXV0pfSxvYS5nZW8uZ3JlYXRBcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7cmV0dXJue3R5cGU6IkxpbmVTdHJpbmciLGNvb3JkaW5hdGVzOlt0fHxyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKV19fXZhciB0LGUscj1NZSx1PXhlO3JldHVybiBuLmRpc3RhbmNlPWZ1bmN0aW9uKCl7cmV0dXJuIG9hLmdlby5kaXN0YW5jZSh0fHxyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9LG4uc291cmNlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPWUsdD0iZnVuY3Rpb24iPT10eXBlb2YgZT9udWxsOmUsbik6cn0sbi50YXJnZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9dCxlPSJmdW5jdGlvbiI9PXR5cGVvZiB0P251bGw6dCxuKTp1fSxuLnByZWNpc2lvbj1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP246MH0sbn0sb2EuZ2VvLmludGVycG9sYXRlPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIGJlKG5bMF0qT2EsblsxXSpPYSx0WzBdKk9hLHRbMV0qT2EpfSxvYS5nZW8ubGVuZ3RoPWZ1bmN0aW9uKG4pe3JldHVybiBXbz0wLG9hLmdlby5zdHJlYW0obixKbyksV299O3ZhciBXbyxKbz17c3BoZXJlOmIscG9pbnQ6YixsaW5lU3RhcnQ6X2UsbGluZUVuZDpiLHBvbHlnb25TdGFydDpiLHBvbHlnb25FbmQ6Yn0sR289d2UoZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc3FydCgyLygxK24pKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hc2luKG4vMil9KTsob2EuZ2VvLmF6aW11dGhhbEVxdWFsQXJlYT1mdW5jdGlvbigpe3JldHVybiBhZShHbyl9KS5yYXc9R287dmFyIEtvPXdlKGZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguYWNvcyhuKTtyZXR1cm4gdCYmdC9NYXRoLnNpbih0KX0seSk7KG9hLmdlby5hemltdXRoYWxFcXVpZGlzdGFudD1mdW5jdGlvbigpe3JldHVybiBhZShLbyl9KS5yYXc9S28sKG9hLmdlby5jb25pY0NvbmZvcm1hbD1mdW5jdGlvbigpe3JldHVybiBWdChTZSl9KS5yYXc9U2UsKG9hLmdlby5jb25pY0VxdWlkaXN0YW50PWZ1bmN0aW9uKCl7cmV0dXJuIFZ0KGtlKX0pLnJhdz1rZTt2YXIgUW89d2UoZnVuY3Rpb24obil7cmV0dXJuIDEvbn0sTWF0aC5hdGFuKTsob2EuZ2VvLmdub21vbmljPWZ1bmN0aW9uKCl7cmV0dXJuIGFlKFFvKX0pLnJhdz1RbyxOZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm5bbiwyKk1hdGguYXRhbihNYXRoLmV4cCh0KSktSGFdfSwob2EuZ2VvLm1lcmNhdG9yPWZ1bmN0aW9uKCl7cmV0dXJuIEVlKE5lKX0pLnJhdz1OZTt2YXIgbmw9d2UoZnVuY3Rpb24oKXtyZXR1cm4gMX0sTWF0aC5hc2luKTsob2EuZ2VvLm9ydGhvZ3JhcGhpYz1mdW5jdGlvbigpe3JldHVybiBhZShubCl9KS5yYXc9bmw7dmFyIHRsPXdlKGZ1bmN0aW9uKG4pe3JldHVybiAxLygxK24pfSxmdW5jdGlvbihuKXtyZXR1cm4gMipNYXRoLmF0YW4obil9KTsob2EuZ2VvLnN0ZXJlb2dyYXBoaWM9ZnVuY3Rpb24oKXtyZXR1cm4gYWUodGwpfSkucmF3PXRsLEFlLmludmVydD1mdW5jdGlvbihuLHQpe3JldHVyblstdCwyKk1hdGguYXRhbihNYXRoLmV4cChuKSktSGFdfSwob2EuZ2VvLnRyYW5zdmVyc2VNZXJjYXRvcj1mdW5jdGlvbigpe3ZhciBuPUVlKEFlKSx0PW4uY2VudGVyLGU9bi5yb3RhdGU7cmV0dXJuIG4uY2VudGVyPWZ1bmN0aW9uKG4pe3JldHVybiBuP3QoWy1uWzFdLG5bMF1dKToobj10KCksW25bMV0sLW5bMF1dKX0sbi5yb3RhdGU9ZnVuY3Rpb24obil7cmV0dXJuIG4/ZShbblswXSxuWzFdLG4ubGVuZ3RoPjI/blsyXSs5MDo5MF0pOihuPWUoKSxbblswXSxuWzFdLG5bMl0tOTBdKX0sZShbMCwwLDkwXSl9KS5yYXc9QWUsb2EuZ2VvbT17fSxvYS5nZW9tLmh1bGw9ZnVuY3Rpb24obil7ZnVuY3Rpb24gdChuKXtpZihuLmxlbmd0aDwzKXJldHVybltdO3ZhciB0LHU9RW4oZSksaT1FbihyKSxhPW4ubGVuZ3RoLG89W10sbD1bXTtmb3IodD0wO2E+dDt0Kyspby5wdXNoKFsrdS5jYWxsKHRoaXMsblt0XSx0KSwraS5jYWxsKHRoaXMsblt0XSx0KSx0XSk7Zm9yKG8uc29ydChxZSksdD0wO2E+dDt0KyspbC5wdXNoKFtvW3RdWzBdLC1vW3RdWzFdXSk7dmFyIGM9TGUobykscz1MZShsKSxmPXNbMF09PT1jWzBdLGg9c1tzLmxlbmd0aC0xXT09PWNbYy5sZW5ndGgtMV0sZz1bXTtmb3IodD1jLmxlbmd0aC0xO3Q+PTA7LS10KWcucHVzaChuW29bY1t0XV1bMl1dKTtmb3IodD0rZjt0PHMubGVuZ3RoLWg7Kyt0KWcucHVzaChuW29bc1t0XV1bMl1dKTtyZXR1cm4gZ312YXIgZT1DZSxyPXplO3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3Qobik6KHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHQpOmV9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1uLHQpOnJ9LHQpfSxvYS5nZW9tLnBvbHlnb249ZnVuY3Rpb24obil7cmV0dXJuIFNhKG4sZWwpLG59O3ZhciBlbD1vYS5nZW9tLnBvbHlnb24ucHJvdG90eXBlPVtdO2VsLmFyZWE9ZnVuY3Rpb24oKXtmb3IodmFyIG4sdD0tMSxlPXRoaXMubGVuZ3RoLHI9dGhpc1tlLTFdLHU9MDsrK3Q8ZTspbj1yLHI9dGhpc1t0XSx1Kz1uWzFdKnJbMF0tblswXSpyWzFdO3JldHVybi41KnV9LGVsLmNlbnRyb2lkPWZ1bmN0aW9uKG4pe3ZhciB0LGUscj0tMSx1PXRoaXMubGVuZ3RoLGk9MCxhPTAsbz10aGlzW3UtMV07Zm9yKGFyZ3VtZW50cy5sZW5ndGh8fChuPS0xLyg2KnRoaXMuYXJlYSgpKSk7KytyPHU7KXQ9byxvPXRoaXNbcl0sZT10WzBdKm9bMV0tb1swXSp0WzFdLGkrPSh0WzBdK29bMF0pKmUsYSs9KHRbMV0rb1sxXSkqZTtyZXR1cm5baSpuLGEqbl19LGVsLmNsaXA9ZnVuY3Rpb24obil7Zm9yKHZhciB0LGUscix1LGksYSxvPURlKG4pLGw9LTEsYz10aGlzLmxlbmd0aC1EZSh0aGlzKSxzPXRoaXNbYy0xXTsrK2w8Yzspe2Zvcih0PW4uc2xpY2UoKSxuLmxlbmd0aD0wLHU9dGhpc1tsXSxpPXRbKHI9dC5sZW5ndGgtbyktMV0sZT0tMTsrK2U8cjspYT10W2VdLFRlKGEscyx1KT8oVGUoaSxzLHUpfHxuLnB1c2goUmUoaSxhLHMsdSkpLG4ucHVzaChhKSk6VGUoaSxzLHUpJiZuLnB1c2goUmUoaSxhLHMsdSkpLGk9YTtvJiZuLnB1c2goblswXSkscz11fXJldHVybiBufTt2YXIgcmwsdWwsaWwsYWwsb2wsbGw9W10sY2w9W107WWUucHJvdG90eXBlLnByZXBhcmU9ZnVuY3Rpb24oKXtmb3IodmFyIG4sdD10aGlzLmVkZ2VzLGU9dC5sZW5ndGg7ZS0tOyluPXRbZV0uZWRnZSxuLmImJm4uYXx8dC5zcGxpY2UoZSwxKTtyZXR1cm4gdC5zb3J0KFZlKSx0Lmxlbmd0aH0sdHIucHJvdG90eXBlPXtzdGFydDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVkZ2UubD09PXRoaXMuc2l0ZT90aGlzLmVkZ2UuYTp0aGlzLmVkZ2UuYn0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWRnZS5sPT09dGhpcy5zaXRlP3RoaXMuZWRnZS5iOnRoaXMuZWRnZS5hfX0sZXIucHJvdG90eXBlPXtpbnNlcnQ6ZnVuY3Rpb24obix0KXt2YXIgZSxyLHU7aWYobil7aWYodC5QPW4sdC5OPW4uTixuLk4mJihuLk4uUD10KSxuLk49dCxuLlIpe2ZvcihuPW4uUjtuLkw7KW49bi5MO24uTD10fWVsc2Ugbi5SPXQ7ZT1ufWVsc2UgdGhpcy5fPyhuPWFyKHRoaXMuXyksdC5QPW51bGwsdC5OPW4sbi5QPW4uTD10LGU9bik6KHQuUD10Lk49bnVsbCx0aGlzLl89dCxlPW51bGwpO2Zvcih0Lkw9dC5SPW51bGwsdC5VPWUsdC5DPSEwLG49dDtlJiZlLkM7KXI9ZS5VLGU9PT1yLkw/KHU9ci5SLHUmJnUuQz8oZS5DPXUuQz0hMSxyLkM9ITAsbj1yKToobj09PWUuUiYmKHVyKHRoaXMsZSksbj1lLGU9bi5VKSxlLkM9ITEsci5DPSEwLGlyKHRoaXMscikpKToodT1yLkwsdSYmdS5DPyhlLkM9dS5DPSExLHIuQz0hMCxuPXIpOihuPT09ZS5MJiYoaXIodGhpcyxlKSxuPWUsZT1uLlUpLGUuQz0hMSxyLkM9ITAsdXIodGhpcyxyKSkpLGU9bi5VO3RoaXMuXy5DPSExfSxyZW1vdmU6ZnVuY3Rpb24obil7bi5OJiYobi5OLlA9bi5QKSxuLlAmJihuLlAuTj1uLk4pLG4uTj1uLlA9bnVsbDt2YXIgdCxlLHIsdT1uLlUsaT1uLkwsYT1uLlI7aWYoZT1pP2E/YXIoYSk6aTphLHU/dS5MPT09bj91Lkw9ZTp1LlI9ZTp0aGlzLl89ZSxpJiZhPyhyPWUuQyxlLkM9bi5DLGUuTD1pLGkuVT1lLGUhPT1hPyh1PWUuVSxlLlU9bi5VLG49ZS5SLHUuTD1uLGUuUj1hLGEuVT1lKTooZS5VPXUsdT1lLG49ZS5SKSk6KHI9bi5DLG49ZSksbiYmKG4uVT11KSwhcil7aWYobiYmbi5DKXJldHVybiB2b2lkKG4uQz0hMSk7ZG97aWYobj09PXRoaXMuXylicmVhaztpZihuPT09dS5MKXtpZih0PXUuUix0LkMmJih0LkM9ITEsdS5DPSEwLHVyKHRoaXMsdSksdD11LlIpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuUiYmdC5SLkN8fCh0LkwuQz0hMSx0LkM9ITAsaXIodGhpcyx0KSx0PXUuUiksdC5DPXUuQyx1LkM9dC5SLkM9ITEsdXIodGhpcyx1KSxuPXRoaXMuXzticmVha319ZWxzZSBpZih0PXUuTCx0LkMmJih0LkM9ITEsdS5DPSEwLGlyKHRoaXMsdSksdD11LkwpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuTCYmdC5MLkN8fCh0LlIuQz0hMSx0LkM9ITAsdXIodGhpcyx0KSx0PXUuTCksdC5DPXUuQyx1LkM9dC5MLkM9ITEsaXIodGhpcyx1KSxuPXRoaXMuXzticmVha310LkM9ITAsbj11LHU9dS5VfXdoaWxlKCFuLkMpO24mJihuLkM9ITEpfX19LG9hLmdlb20udm9yb25vaT1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe3ZhciB0PW5ldyBBcnJheShuLmxlbmd0aCkscj1vWzBdWzBdLHU9b1swXVsxXSxpPW9bMV1bMF0sYT1vWzFdWzFdO3JldHVybiBvcihlKG4pLG8pLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oZSxvKXt2YXIgbD1lLmVkZ2VzLGM9ZS5zaXRlLHM9dFtvXT1sLmxlbmd0aD9sLm1hcChmdW5jdGlvbihuKXt2YXIgdD1uLnN0YXJ0KCk7cmV0dXJuW3QueCx0LnldfSk6Yy54Pj1yJiZjLng8PWkmJmMueT49dSYmYy55PD1hP1tbcixhXSxbaSxhXSxbaSx1XSxbcix1XV06W107cy5wb2ludD1uW29dfSksdH1mdW5jdGlvbiBlKG4pe3JldHVybiBuLm1hcChmdW5jdGlvbihuLHQpe3JldHVybnt4Ok1hdGgucm91bmQoaShuLHQpL0RhKSpEYSx5Ok1hdGgucm91bmQoYShuLHQpL0RhKSpEYSxpOnR9fSl9dmFyIHI9Q2UsdT16ZSxpPXIsYT11LG89c2w7cmV0dXJuIG4/dChuKToodC5saW5rcz1mdW5jdGlvbihuKXtyZXR1cm4gb3IoZShuKSkuZWRnZXMuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBuLmwmJm4ucn0pLm1hcChmdW5jdGlvbih0KXtyZXR1cm57c291cmNlOm5bdC5sLmldLHRhcmdldDpuW3Quci5pXX19KX0sdC50cmlhbmdsZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107cmV0dXJuIG9yKGUobikpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oZSxyKXtmb3IodmFyIHUsaSxhPWUuc2l0ZSxvPWUuZWRnZXMuc29ydChWZSksbD0tMSxjPW8ubGVuZ3RoLHM9b1tjLTFdLmVkZ2UsZj1zLmw9PT1hP3MucjpzLmw7KytsPGM7KXU9cyxpPWYscz1vW2xdLmVkZ2UsZj1zLmw9PT1hP3MucjpzLmwscjxpLmkmJnI8Zi5pJiZjcihhLGksZik8MCYmdC5wdXNoKFtuW3JdLG5baS5pXSxuW2YuaV1dKX0pLHR9LHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1FbihyPW4pLHQpOnJ9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1Fbih1PW4pLHQpOnV9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1udWxsPT1uP3NsOm4sdCk6bz09PXNsP251bGw6b30sdC5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3QuY2xpcEV4dGVudChuJiZbWzAsMF0sbl0pOm89PT1zbD9udWxsOm8mJm9bMV19LHQpfTt2YXIgc2w9W1stMWU2LC0xZTZdLFsxZTYsMWU2XV07b2EuZ2VvbS5kZWxhdW5heT1mdW5jdGlvbihuKXtyZXR1cm4gb2EuZ2VvbS52b3Jvbm9pKCkudHJpYW5nbGVzKG4pfSxvYS5nZW9tLnF1YWR0cmVlPWZ1bmN0aW9uKG4sdCxlLHIsdSl7ZnVuY3Rpb24gaShuKXtmdW5jdGlvbiBpKG4sdCxlLHIsdSxpLGEsbyl7aWYoIWlzTmFOKGUpJiYhaXNOYU4ocikpaWYobi5sZWFmKXt2YXIgbD1uLngscz1uLnk7aWYobnVsbCE9bClpZihNYShsLWUpK01hKHMtcik8LjAxKWMobix0LGUscix1LGksYSxvKTtlbHNle3ZhciBmPW4ucG9pbnQ7bi54PW4ueT1uLnBvaW50PW51bGwsYyhuLGYsbCxzLHUsaSxhLG8pLGMobix0LGUscix1LGksYSxvKX1lbHNlIG4ueD1lLG4ueT1yLG4ucG9pbnQ9dH1lbHNlIGMobix0LGUscix1LGksYSxvKX1mdW5jdGlvbiBjKG4sdCxlLHIsdSxhLG8sbCl7dmFyIGM9LjUqKHUrbykscz0uNSooYStsKSxmPWU+PWMsaD1yPj1zLGc9aDw8MXxmO24ubGVhZj0hMSxuPW4ubm9kZXNbZ118fChuLm5vZGVzW2ddPWhyKCkpLGY/dT1jOm89YyxoP2E9czpsPXMsaShuLHQsZSxyLHUsYSxvLGwpfXZhciBzLGYsaCxnLHAsdixkLG0seSxNPUVuKG8pLHg9RW4obCk7aWYobnVsbCE9dCl2PXQsZD1lLG09cix5PXU7ZWxzZSBpZihtPXk9LSh2PWQ9MS8wKSxmPVtdLGg9W10scD1uLmxlbmd0aCxhKWZvcihnPTA7cD5nOysrZylzPW5bZ10scy54PHYmJih2PXMueCkscy55PGQmJihkPXMueSkscy54Pm0mJihtPXMueCkscy55PnkmJih5PXMueSksZi5wdXNoKHMueCksaC5wdXNoKHMueSk7ZWxzZSBmb3IoZz0wO3A+ZzsrK2cpe3ZhciBiPStNKHM9bltnXSxnKSxfPSt4KHMsZyk7dj5iJiYodj1iKSxkPl8mJihkPV8pLGI+bSYmKG09YiksXz55JiYoeT1fKSxmLnB1c2goYiksaC5wdXNoKF8pfXZhciB3PW0tdixTPXktZDt3PlM/eT1kK3c6bT12K1M7dmFyIGs9aHIoKTtpZihrLmFkZD1mdW5jdGlvbihuKXtpKGssbiwrTShuLCsrZyksK3gobixnKSx2LGQsbSx5KX0say52aXNpdD1mdW5jdGlvbihuKXtncihuLGssdixkLG0seSl9LGsuZmluZD1mdW5jdGlvbihuKXtyZXR1cm4gcHIoayxuWzBdLG5bMV0sdixkLG0seSl9LGc9LTEsbnVsbD09dCl7Zm9yKDsrK2c8cDspaShrLG5bZ10sZltnXSxoW2ddLHYsZCxtLHkpOy0tZ31lbHNlIG4uZm9yRWFjaChrLmFkZCk7cmV0dXJuIGY9aD1uPXM9bnVsbCxrfXZhciBhLG89Q2UsbD16ZTtyZXR1cm4oYT1hcmd1bWVudHMubGVuZ3RoKT8obz1zcixsPWZyLDM9PT1hJiYodT1lLHI9dCxlPXQ9MCksaShuKSk6KGkueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1uLGkpOm99LGkueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD1uLGkpOmx9LGkuZXh0ZW50PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhudWxsPT1uP3Q9ZT1yPXU9bnVsbDoodD0rblswXVswXSxlPStuWzBdWzFdLHI9K25bMV1bMF0sdT0rblsxXVsxXSksaSk6bnVsbD09dD9udWxsOltbdCxlXSxbcix1XV19LGkuc2l6ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obnVsbD09bj90PWU9cj11PW51bGw6KHQ9ZT0wLHI9K25bMF0sdT0rblsxXSksaSk6bnVsbD09dD9udWxsOltyLXQsdS1lXX0saSl9LG9hLmludGVycG9sYXRlUmdiPXZyLG9hLmludGVycG9sYXRlT2JqZWN0PWRyLG9hLmludGVycG9sYXRlTnVtYmVyPW1yLG9hLmludGVycG9sYXRlU3RyaW5nPXlyO3ZhciBmbD0vWy0rXT8oPzpcZCtcLj9cZCp8XC4/XGQrKSg/OltlRV1bLStdP1xkKyk/L2csaGw9bmV3IFJlZ0V4cChmbC5zb3VyY2UsImciKTtvYS5pbnRlcnBvbGF0ZT1NcixvYS5pbnRlcnBvbGF0b3JzPVtmdW5jdGlvbihuLHQpe3ZhciBlPXR5cGVvZiB0O3JldHVybigic3RyaW5nIj09PWU/cm8uaGFzKHQudG9Mb3dlckNhc2UoKSl8fC9eKCN8cmdiXCh8aHNsXCgpL2kudGVzdCh0KT92cjp5cjp0IGluc3RhbmNlb2Ygb24/dnI6QXJyYXkuaXNBcnJheSh0KT94cjoib2JqZWN0Ij09PWUmJmlzTmFOKHQpP2RyOm1yKShuLHQpfV0sb2EuaW50ZXJwb2xhdGVBcnJheT14cjt2YXIgZ2w9ZnVuY3Rpb24oKXtyZXR1cm4geX0scGw9b2EubWFwKHtsaW5lYXI6Z2wscG9seTpFcixxdWFkOmZ1bmN0aW9uKCl7cmV0dXJuIFNyfSxjdWJpYzpmdW5jdGlvbigpe3JldHVybiBrcn0sc2luOmZ1bmN0aW9uKCl7cmV0dXJuIEFyfSxleHA6ZnVuY3Rpb24oKXtyZXR1cm4gQ3J9LGNpcmNsZTpmdW5jdGlvbigpe3JldHVybiB6cn0sZWxhc3RpYzpMcixiYWNrOnFyLGJvdW5jZTpmdW5jdGlvbigpe3JldHVybiBUcn19KSx2bD1vYS5tYXAoeyJpbiI6eSxvdXQ6X3IsImluLW91dCI6d3IsIm91dC1pbiI6ZnVuY3Rpb24obil7cmV0dXJuIHdyKF9yKG4pKX19KTtvYS5lYXNlPWZ1bmN0aW9uKG4pe3ZhciB0PW4uaW5kZXhPZigiLSIpLGU9dD49MD9uLnNsaWNlKDAsdCk6bixyPXQ+PTA/bi5zbGljZSh0KzEpOiJpbiI7cmV0dXJuIGU9cGwuZ2V0KGUpfHxnbCxyPXZsLmdldChyKXx8eSxicihyKGUuYXBwbHkobnVsbCxsYS5jYWxsKGFyZ3VtZW50cywxKSkpKX0sb2EuaW50ZXJwb2xhdGVIY2w9UnIsb2EuaW50ZXJwb2xhdGVIc2w9RHIsb2EuaW50ZXJwb2xhdGVMYWI9UHIsb2EuaW50ZXJwb2xhdGVSb3VuZD1VcixvYS50cmFuc2Zvcm09ZnVuY3Rpb24obil7dmFyIHQ9c2EuY3JlYXRlRWxlbWVudE5TKG9hLm5zLnByZWZpeC5zdmcsImciKTtyZXR1cm4ob2EudHJhbnNmb3JtPWZ1bmN0aW9uKG4pe2lmKG51bGwhPW4pe3Quc2V0QXR0cmlidXRlKCJ0cmFuc2Zvcm0iLG4pO3ZhciBlPXQudHJhbnNmb3JtLmJhc2VWYWwuY29uc29saWRhdGUoKX1yZXR1cm4gbmV3IGpyKGU/ZS5tYXRyaXg6ZGwpfSkobil9LGpyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJ0cmFuc2xhdGUoIit0aGlzLnRyYW5zbGF0ZSsiKXJvdGF0ZSgiK3RoaXMucm90YXRlKyIpc2tld1goIit0aGlzLnNrZXcrIilzY2FsZSgiK3RoaXMuc2NhbGUrIikifTt2YXIgZGw9e2E6MSxiOjAsYzowLGQ6MSxlOjAsZjowfTtvYS5pbnRlcnBvbGF0ZVRyYW5zZm9ybT0kcixvYS5sYXlvdXQ9e30sb2EubGF5b3V0LmJ1bmRsZT1mdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbihuKXtmb3IodmFyIHQ9W10sZT0tMSxyPW4ubGVuZ3RoOysrZTxyOyl0LnB1c2goSnIobltlXSkpO3JldHVybiB0fX0sb2EubGF5b3V0LmNob3JkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbigpe3ZhciBuLGMsZixoLGcscD17fSx2PVtdLGQ9b2EucmFuZ2UoaSksbT1bXTtmb3IoZT1bXSxyPVtdLG49MCxoPS0xOysraDxpOyl7Zm9yKGM9MCxnPS0xOysrZzxpOyljKz11W2hdW2ddO3YucHVzaChjKSxtLnB1c2gob2EucmFuZ2UoaSkpLG4rPWN9Zm9yKGEmJmQuc29ydChmdW5jdGlvbihuLHQpe3JldHVybiBhKHZbbl0sdlt0XSl9KSxvJiZtLmZvckVhY2goZnVuY3Rpb24obix0KXtuLnNvcnQoZnVuY3Rpb24obixlKXtyZXR1cm4gbyh1W3RdW25dLHVbdF1bZV0pfSl9KSxuPShqYS1zKmkpL24sYz0wLGg9LTE7KytoPGk7KXtmb3IoZj1jLGc9LTE7KytnPGk7KXt2YXIgeT1kW2hdLE09bVt5XVtnXSx4PXVbeV1bTV0sYj1jLF89Yys9eCpuO3BbeSsiLSIrTV09e2luZGV4Onksc3ViaW5kZXg6TSxzdGFydEFuZ2xlOmIsZW5kQW5nbGU6Xyx2YWx1ZTp4fX1yW3ldPXtpbmRleDp5LHN0YXJ0QW5nbGU6ZixlbmRBbmdsZTpjLHZhbHVlOnZbeV19LGMrPXN9Zm9yKGg9LTE7KytoPGk7KWZvcihnPWgtMTsrK2c8aTspe3ZhciB3PXBbaCsiLSIrZ10sUz1wW2crIi0iK2hdOyh3LnZhbHVlfHxTLnZhbHVlKSYmZS5wdXNoKHcudmFsdWU8Uy52YWx1ZT97c291cmNlOlMsdGFyZ2V0Ond9Ontzb3VyY2U6dyx0YXJnZXQ6U30pfWwmJnQoKX1mdW5jdGlvbiB0KCl7ZS5zb3J0KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIGwoKG4uc291cmNlLnZhbHVlK24udGFyZ2V0LnZhbHVlKS8yLCh0LnNvdXJjZS52YWx1ZSt0LnRhcmdldC52YWx1ZSkvMil9KX12YXIgZSxyLHUsaSxhLG8sbCxjPXt9LHM9MDtyZXR1cm4gYy5tYXRyaXg9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9KHU9bikmJnUubGVuZ3RoLGU9cj1udWxsLGMpOnV9LGMucGFkZGluZz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz1uLGU9cj1udWxsLGMpOnN9LGMuc29ydEdyb3Vwcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1uLGU9cj1udWxsLGMpOmF9LGMuc29ydFN1Ymdyb3Vwcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1uLGU9bnVsbCxjKTpvfSxjLnNvcnRDaG9yZHM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGw9bixlJiZ0KCksYyk6bH0sYy5jaG9yZHM9ZnVuY3Rpb24oKXtyZXR1cm4gZXx8bigpLGV9LGMuZ3JvdXBzPWZ1bmN0aW9uKCl7cmV0dXJuIHJ8fG4oKSxyfSxjfSxvYS5sYXlvdXQuZm9yY2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3JldHVybiBmdW5jdGlvbih0LGUscix1KXtpZih0LnBvaW50IT09bil7dmFyIGk9dC5jeC1uLngsYT10LmN5LW4ueSxvPXUtZSxsPWkqaSthKmE7aWYobD5vKm8vbSl7aWYodj5sKXt2YXIgYz10LmNoYXJnZS9sO24ucHgtPWkqYyxuLnB5LT1hKmN9cmV0dXJuITB9aWYodC5wb2ludCYmbCYmdj5sKXt2YXIgYz10LnBvaW50Q2hhcmdlL2w7bi5weC09aSpjLG4ucHktPWEqY319cmV0dXJuIXQuY2hhcmdlfX1mdW5jdGlvbiB0KG4pe24ucHg9b2EuZXZlbnQueCxuLnB5PW9hLmV2ZW50LnksbC5yZXN1bWUoKX12YXIgZSxyLHUsaSxhLG8sbD17fSxjPW9hLmRpc3BhdGNoKCJzdGFydCIsInRpY2siLCJlbmQiKSxzPVsxLDFdLGY9LjksaD1tbCxnPXlsLHA9LTMwLHY9TWwsZD0uMSxtPS42NCxNPVtdLHg9W107cmV0dXJuIGwudGljaz1mdW5jdGlvbigpe2lmKCh1Kj0uOTkpPC4wMDUpcmV0dXJuIGU9bnVsbCxjLmVuZCh7dHlwZToiZW5kIixhbHBoYTp1PTB9KSwhMDt2YXIgdCxyLGwsaCxnLHYsbSx5LGIsXz1NLmxlbmd0aCx3PXgubGVuZ3RoO2ZvcihyPTA7dz5yOysrcilsPXhbcl0saD1sLnNvdXJjZSxnPWwudGFyZ2V0LHk9Zy54LWgueCxiPWcueS1oLnksKHY9eSp5K2IqYikmJih2PXUqYVtyXSooKHY9TWF0aC5zcXJ0KHYpKS1pW3JdKS92LHkqPXYsYio9dixnLngtPXkqKG09aC53ZWlnaHQrZy53ZWlnaHQ/aC53ZWlnaHQvKGgud2VpZ2h0K2cud2VpZ2h0KTouNSksZy55LT1iKm0saC54Kz15KihtPTEtbSksaC55Kz1iKm0pO2lmKChtPXUqZCkmJih5PXNbMF0vMixiPXNbMV0vMixyPS0xLG0pKWZvcig7KytyPF87KWw9TVtyXSxsLngrPSh5LWwueCkqbSxsLnkrPShiLWwueSkqbTtpZihwKWZvcihydSh0PW9hLmdlb20ucXVhZHRyZWUoTSksdSxvKSxyPS0xOysrcjxfOykobD1NW3JdKS5maXhlZHx8dC52aXNpdChuKGwpKTtmb3Iocj0tMTsrK3I8XzspbD1NW3JdLGwuZml4ZWQ/KGwueD1sLnB4LGwueT1sLnB5KToobC54LT0obC5weC0obC5weD1sLngpKSpmLGwueS09KGwucHktKGwucHk9bC55KSkqZik7Yy50aWNrKHt0eXBlOiJ0aWNrIixhbHBoYTp1fSl9LGwubm9kZXM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KE09bixsKTpNfSxsLmxpbmtzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh4PW4sbCk6eH0sbC5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhzPW4sbCk6c30sbC5saW5rRGlzdGFuY2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGg9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bjorbixsKTpofSxsLmRpc3RhbmNlPWwubGlua0Rpc3RhbmNlLGwubGlua1N0cmVuZ3RoPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPSJmdW5jdGlvbiI9PXR5cGVvZiBuP246K24sbCk6Z30sbC5mcmljdGlvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZj0rbixsKTpmfSxsLmNoYXJnZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD0iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOituLGwpOnB9LGwuY2hhcmdlRGlzdGFuY2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHY9bipuLGwpOk1hdGguc3FydCh2KX0sbC5ncmF2aXR5PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhkPStuLGwpOmR9LGwudGhldGE9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG09bipuLGwpOk1hdGguc3FydChtKX0sbC5hbHBoYT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj0rbix1P24+MD91PW46KGUuYz1udWxsLGUudD1OYU4sZT1udWxsLGMuZW5kKHt0eXBlOiJlbmQiLGFscGhhOnU9MH0pKTpuPjAmJihjLnN0YXJ0KHt0eXBlOiJzdGFydCIsYWxwaGE6dT1ufSksZT1xbihsLnRpY2spKSxsKTp1fSxsLnN0YXJ0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHIpe2lmKCFlKXtmb3IoZT1uZXcgQXJyYXkodSksbD0wO3U+bDsrK2wpZVtsXT1bXTtmb3IobD0wO2M+bDsrK2wpe3ZhciBpPXhbbF07ZVtpLnNvdXJjZS5pbmRleF0ucHVzaChpLnRhcmdldCksZVtpLnRhcmdldC5pbmRleF0ucHVzaChpLnNvdXJjZSl9fWZvcih2YXIgYSxvPWVbdF0sbD0tMSxzPW8ubGVuZ3RoOysrbDxzOylpZighaXNOYU4oYT1vW2xdW25dKSlyZXR1cm4gYTtyZXR1cm4gTWF0aC5yYW5kb20oKSpyfXZhciB0LGUscix1PU0ubGVuZ3RoLGM9eC5sZW5ndGgsZj1zWzBdLHY9c1sxXTtmb3IodD0wO3U+dDsrK3QpKHI9TVt0XSkuaW5kZXg9dCxyLndlaWdodD0wO2Zvcih0PTA7Yz50OysrdClyPXhbdF0sIm51bWJlciI9PXR5cGVvZiByLnNvdXJjZSYmKHIuc291cmNlPU1bci5zb3VyY2VdKSwibnVtYmVyIj09dHlwZW9mIHIudGFyZ2V0JiYoci50YXJnZXQ9TVtyLnRhcmdldF0pLCsrci5zb3VyY2Uud2VpZ2h0LCsrci50YXJnZXQud2VpZ2h0O2Zvcih0PTA7dT50OysrdClyPU1bdF0saXNOYU4oci54KSYmKHIueD1uKCJ4IixmKSksaXNOYU4oci55KSYmKHIueT1uKCJ5Iix2KSksaXNOYU4oci5weCkmJihyLnB4PXIueCksaXNOYU4oci5weSkmJihyLnB5PXIueSk7aWYoaT1bXSwiZnVuY3Rpb24iPT10eXBlb2YgaClmb3IodD0wO2M+dDsrK3QpaVt0XT0raC5jYWxsKHRoaXMseFt0XSx0KTtlbHNlIGZvcih0PTA7Yz50OysrdClpW3RdPWg7aWYoYT1bXSwiZnVuY3Rpb24iPT10eXBlb2YgZylmb3IodD0wO2M+dDsrK3QpYVt0XT0rZy5jYWxsKHRoaXMseFt0XSx0KTtlbHNlIGZvcih0PTA7Yz50OysrdClhW3RdPWc7aWYobz1bXSwiZnVuY3Rpb24iPT10eXBlb2YgcClmb3IodD0wO3U+dDsrK3Qpb1t0XT0rcC5jYWxsKHRoaXMsTVt0XSx0KTtlbHNlIGZvcih0PTA7dT50OysrdClvW3RdPXA7cmV0dXJuIGwucmVzdW1lKCl9LGwucmVzdW1lPWZ1bmN0aW9uKCl7cmV0dXJuIGwuYWxwaGEoLjEpfSxsLnN0b3A9ZnVuY3Rpb24oKXtyZXR1cm4gbC5hbHBoYSgwKX0sbC5kcmFnPWZ1bmN0aW9uKCl7cmV0dXJuIHJ8fChyPW9hLmJlaGF2aW9yLmRyYWcoKS5vcmlnaW4oeSkub24oImRyYWdzdGFydC5mb3JjZSIsUXIpLm9uKCJkcmFnLmZvcmNlIix0KS5vbigiZHJhZ2VuZC5mb3JjZSIsbnUpKSxhcmd1bWVudHMubGVuZ3RoP3ZvaWQgdGhpcy5vbigibW91c2VvdmVyLmZvcmNlIix0dSkub24oIm1vdXNlb3V0LmZvcmNlIixldSkuY2FsbChyKTpyfSxvYS5yZWJpbmQobCxjLCJvbiIpfTt2YXIgbWw9MjAseWw9MSxNbD0xLzA7b2EubGF5b3V0LmhpZXJhcmNoeT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4odSl7dmFyIGksYT1bdV0sbz1bXTtmb3IodS5kZXB0aD0wO251bGwhPShpPWEucG9wKCkpOylpZihvLnB1c2goaSksKGM9ZS5jYWxsKG4saSxpLmRlcHRoKSkmJihsPWMubGVuZ3RoKSl7Zm9yKHZhciBsLGMsczstLWw+PTA7KWEucHVzaChzPWNbbF0pLHMucGFyZW50PWkscy5kZXB0aD1pLmRlcHRoKzE7ciYmKGkudmFsdWU9MCksaS5jaGlsZHJlbj1jfWVsc2UgciYmKGkudmFsdWU9K3IuY2FsbChuLGksaS5kZXB0aCl8fDApLGRlbGV0ZSBpLmNoaWxkcmVuO3JldHVybiBhdSh1LGZ1bmN0aW9uKG4pe3ZhciBlLHU7dCYmKGU9bi5jaGlsZHJlbikmJmUuc29ydCh0KSxyJiYodT1uLnBhcmVudCkmJih1LnZhbHVlKz1uLnZhbHVlKX0pLG99dmFyIHQ9Y3UsZT1vdSxyPWx1O3JldHVybiBuLnNvcnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ZSxuKTp0fSxuLmNoaWxkcmVuPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sbi52YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG4ucmV2YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gciYmKGl1KHQsZnVuY3Rpb24obil7bi5jaGlsZHJlbiYmKG4udmFsdWU9MCl9KSxhdSh0LGZ1bmN0aW9uKHQpe3ZhciBlO3QuY2hpbGRyZW58fCh0LnZhbHVlPStyLmNhbGwobix0LHQuZGVwdGgpfHwwKSwoZT10LnBhcmVudCkmJihlLnZhbHVlKz10LnZhbHVlKX0pKSx0fSxufSxvYS5sYXlvdXQucGFydGl0aW9uPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LGUscix1KXt2YXIgaT10LmNoaWxkcmVuO2lmKHQueD1lLHQueT10LmRlcHRoKnUsdC5keD1yLHQuZHk9dSxpJiYoYT1pLmxlbmd0aCkpe3ZhciBhLG8sbCxjPS0xO2ZvcihyPXQudmFsdWU/ci90LnZhbHVlOjA7KytjPGE7KW4obz1pW2NdLGUsbD1vLnZhbHVlKnIsdSksZSs9bH19ZnVuY3Rpb24gdChuKXt2YXIgZT1uLmNoaWxkcmVuLHI9MDtpZihlJiYodT1lLmxlbmd0aCkpZm9yKHZhciB1LGk9LTE7KytpPHU7KXI9TWF0aC5tYXgocix0KGVbaV0pKTtyZXR1cm4gMStyfWZ1bmN0aW9uIGUoZSxpKXt2YXIgYT1yLmNhbGwodGhpcyxlLGkpO3JldHVybiBuKGFbMF0sMCx1WzBdLHVbMV0vdChhWzBdKSksYX12YXIgcj1vYS5sYXlvdXQuaGllcmFyY2h5KCksdT1bMSwxXTtyZXR1cm4gZS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sZSk6dX0sdXUoZSxyKX0sb2EubGF5b3V0LnBpZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oYSl7dmFyIG8sbD1hLmxlbmd0aCxjPWEubWFwKGZ1bmN0aW9uKGUscil7cmV0dXJuK3QuY2FsbChuLGUscil9KSxzPSsoImZ1bmN0aW9uIj09dHlwZW9mIHI/ci5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ciksZj0oImZ1bmN0aW9uIj09dHlwZW9mIHU/dS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dSktcyxoPU1hdGgubWluKE1hdGguYWJzKGYpL2wsKygiZnVuY3Rpb24iPT10eXBlb2YgaT9pLmFwcGx5KHRoaXMsYXJndW1lbnRzKTppKSksZz1oKigwPmY/LTE6MSkscD1vYS5zdW0oYyksdj1wPyhmLWwqZykvcDowLGQ9b2EucmFuZ2UobCksbT1bXTtyZXR1cm4gbnVsbCE9ZSYmZC5zb3J0KGU9PT14bD9mdW5jdGlvbihuLHQpe3JldHVybiBjW3RdLWNbbl19OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIGUoYVtuXSxhW3RdKX0pLGQuZm9yRWFjaChmdW5jdGlvbihuKXttW25dPXtkYXRhOmFbbl0sdmFsdWU6bz1jW25dLHN0YXJ0QW5nbGU6cyxlbmRBbmdsZTpzKz1vKnYrZyxwYWRBbmdsZTpofX0pLG19dmFyIHQ9TnVtYmVyLGU9eGwscj0wLHU9amEsaT0wO3JldHVybiBuLnZhbHVlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PWUsbik6dH0sbi5zb3J0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sbi5zdGFydEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPXQsbik6cn0sbi5lbmRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG4ucGFkQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9dCxuKTppfSxufTt2YXIgeGw9e307b2EubGF5b3V0LnN0YWNrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihvLGwpe2lmKCEoaD1vLmxlbmd0aCkpcmV0dXJuIG87dmFyIGM9by5tYXAoZnVuY3Rpb24oZSxyKXtyZXR1cm4gdC5jYWxsKG4sZSxyKX0pLHM9Yy5tYXAoZnVuY3Rpb24odCl7cmV0dXJuIHQubWFwKGZ1bmN0aW9uKHQsZSl7cmV0dXJuW2kuY2FsbChuLHQsZSksYS5jYWxsKG4sdCxlKV19KX0pLGY9ZS5jYWxsKG4scyxsKTtjPW9hLnBlcm11dGUoYyxmKSxzPW9hLnBlcm11dGUocyxmKTt2YXIgaCxnLHAsdixkPXIuY2FsbChuLHMsbCksbT1jWzBdLmxlbmd0aDtmb3IocD0wO20+cDsrK3ApZm9yKHUuY2FsbChuLGNbMF1bcF0sdj1kW3BdLHNbMF1bcF1bMV0pLGc9MTtoPmc7KytnKXUuY2FsbChuLGNbZ11bcF0sdis9c1tnLTFdW3BdWzFdLHNbZ11bcF1bMV0pO3JldHVybiBvfXZhciB0PXksZT1wdSxyPXZ1LHU9Z3UsaT1mdSxhPWh1O3JldHVybiBuLnZhbHVlcz1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1lLG4pOnR9LG4ub3JkZXI9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dDpibC5nZXQodCl8fHB1LG4pOmV9LG4ub2Zmc2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6X2wuZ2V0KHQpfHx2dSxuKTpyfSxuLng9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9dCxuKTppfSxuLnk9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9dCxuKTphfSxuLm91dD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG59O3ZhciBibD1vYS5tYXAoeyJpbnNpZGUtb3V0IjpmdW5jdGlvbihuKXt2YXIgdCxlLHI9bi5sZW5ndGgsdT1uLm1hcChkdSksaT1uLm1hcChtdSksYT1vYS5yYW5nZShyKS5zb3J0KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIHVbbl0tdVt0XX0pLG89MCxsPTAsYz1bXSxzPVtdO2Zvcih0PTA7cj50OysrdCllPWFbdF0sbD5vPyhvKz1pW2VdLGMucHVzaChlKSk6KGwrPWlbZV0scy5wdXNoKGUpKTtyZXR1cm4gcy5yZXZlcnNlKCkuY29uY2F0KGMpfSxyZXZlcnNlOmZ1bmN0aW9uKG4pe3JldHVybiBvYS5yYW5nZShuLmxlbmd0aCkucmV2ZXJzZSgpfSwiZGVmYXVsdCI6cHV9KSxfbD1vYS5tYXAoe3NpbGhvdWV0dGU6ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9bi5sZW5ndGgsaT1uWzBdLmxlbmd0aCxhPVtdLG89MCxsPVtdO2ZvcihlPTA7aT5lOysrZSl7Zm9yKHQ9MCxyPTA7dT50O3QrKylyKz1uW3RdW2VdWzFdO3I+byYmKG89ciksYS5wdXNoKHIpfWZvcihlPTA7aT5lOysrZSlsW2VdPShvLWFbZV0pLzI7cmV0dXJuIGx9LHdpZ2dsZTpmdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpLGEsbyxsLGMscz1uLmxlbmd0aCxmPW5bMF0saD1mLmxlbmd0aCxnPVtdO2ZvcihnWzBdPWw9Yz0wLGU9MTtoPmU7KytlKXtmb3IodD0wLHU9MDtzPnQ7Kyt0KXUrPW5bdF1bZV1bMV07Zm9yKHQ9MCxpPTAsbz1mW2VdWzBdLWZbZS0xXVswXTtzPnQ7Kyt0KXtmb3Iocj0wLGE9KG5bdF1bZV1bMV0tblt0XVtlLTFdWzFdKS8oMipvKTt0PnI7KytyKWErPShuW3JdW2VdWzFdLW5bcl1bZS0xXVsxXSkvbztpKz1hKm5bdF1bZV1bMV19Z1tlXT1sLT11P2kvdSpvOjAsYz5sJiYoYz1sKX1mb3IoZT0wO2g+ZTsrK2UpZ1tlXS09YztyZXR1cm4gZ30sZXhwYW5kOmZ1bmN0aW9uKG4pe3ZhciB0LGUscix1PW4ubGVuZ3RoLGk9blswXS5sZW5ndGgsYT0xL3Usbz1bXTtmb3IoZT0wO2k+ZTsrK2Upe2Zvcih0PTAscj0wO3U+dDt0Kyspcis9blt0XVtlXVsxXTtpZihyKWZvcih0PTA7dT50O3QrKyluW3RdW2VdWzFdLz1yO2Vsc2UgZm9yKHQ9MDt1PnQ7dCsrKW5bdF1bZV1bMV09YX1mb3IoZT0wO2k+ZTsrK2Upb1tlXT0wO3JldHVybiBvfSx6ZXJvOnZ1fSk7b2EubGF5b3V0Lmhpc3RvZ3JhbT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixpKXtmb3IodmFyIGEsbyxsPVtdLGM9bi5tYXAoZSx0aGlzKSxzPXIuY2FsbCh0aGlzLGMsaSksZj11LmNhbGwodGhpcyxzLGMsaSksaT0tMSxoPWMubGVuZ3RoLGc9Zi5sZW5ndGgtMSxwPXQ/MToxL2g7KytpPGc7KWE9bFtpXT1bXSxhLmR4PWZbaSsxXS0oYS54PWZbaV0pLGEueT0wO2lmKGc+MClmb3IoaT0tMTsrK2k8aDspbz1jW2ldLG8+PXNbMF0mJm88PXNbMV0mJihhPWxbb2EuYmlzZWN0KGYsbywxLGcpLTFdLGEueSs9cCxhLnB1c2gobltpXSkpO3JldHVybiBsfXZhciB0PSEwLGU9TnVtYmVyLHI9YnUsdT1NdTtyZXR1cm4gbi52YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT10LG4pOmV9LG4ucmFuZ2U9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RW4odCksbik6cn0sbi5iaW5zPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PSJudW1iZXIiPT10eXBlb2YgdD9mdW5jdGlvbihuKXtyZXR1cm4geHUobix0KX06RW4odCksbik6dX0sbi5mcmVxdWVuY3k9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ISFlLG4pOnR9LG59LG9hLmxheW91dC5wYWNrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe3ZhciBhPWUuY2FsbCh0aGlzLG4saSksbz1hWzBdLGw9dVswXSxjPXVbMV0scz1udWxsPT10P01hdGguc3FydDoiZnVuY3Rpb24iPT10eXBlb2YgdD90OmZ1bmN0aW9uKCl7cmV0dXJuIHR9O2lmKG8ueD1vLnk9MCxhdShvLGZ1bmN0aW9uKG4pe24ucj0rcyhuLnZhbHVlKX0pLGF1KG8sTnUpLHIpe3ZhciBmPXIqKHQ/MTpNYXRoLm1heCgyKm8uci9sLDIqby5yL2MpKS8yO2F1KG8sZnVuY3Rpb24obil7bi5yKz1mfSksYXUobyxOdSksYXUobyxmdW5jdGlvbihuKXtuLnItPWZ9KX1yZXR1cm4gQ3UobyxsLzIsYy8yLHQ/MToxL01hdGgubWF4KDIqby5yL2wsMipvLnIvYykpLGF9dmFyIHQsZT1vYS5sYXlvdXQuaGllcmFyY2h5KCkuc29ydChfdSkscj0wLHU9WzEsMV07cmV0dXJuIG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG4ucmFkaXVzPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW51bGw9PWV8fCJmdW5jdGlvbiI9PXR5cGVvZiBlP2U6K2Usbik6dH0sbi5wYWRkaW5nPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPSt0LG4pOnJ9LHV1KG4sZSl9LG9hLmxheW91dC50cmVlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHUpe3ZhciBzPWEuY2FsbCh0aGlzLG4sdSksZj1zWzBdLGg9dChmKTtpZihhdShoLGUpLGgucGFyZW50Lm09LWgueixpdShoLHIpLGMpaXUoZixpKTtlbHNle3ZhciBnPWYscD1mLHY9ZjtpdShmLGZ1bmN0aW9uKG4pe24ueDxnLngmJihnPW4pLG4ueD5wLngmJihwPW4pLG4uZGVwdGg+di5kZXB0aCYmKHY9bil9KTt2YXIgZD1vKGcscCkvMi1nLngsbT1sWzBdLyhwLngrbyhwLGcpLzIrZCkseT1sWzFdLyh2LmRlcHRofHwxKTtpdShmLGZ1bmN0aW9uKG4pe24ueD0obi54K2QpKm0sbi55PW4uZGVwdGgqeX0pfXJldHVybiBzfWZ1bmN0aW9uIHQobil7Zm9yKHZhciB0LGU9e0E6bnVsbCxjaGlsZHJlbjpbbl19LHI9W2VdO251bGwhPSh0PXIucG9wKCkpOylmb3IodmFyIHUsaT10LmNoaWxkcmVuLGE9MCxvPWkubGVuZ3RoO28+YTsrK2Epci5wdXNoKChpW2FdPXU9e186aVthXSxwYXJlbnQ6dCxjaGlsZHJlbjoodT1pW2FdLmNoaWxkcmVuKSYmdS5zbGljZSgpfHxbXSxBOm51bGwsYTpudWxsLHo6MCxtOjAsYzowLHM6MCx0Om51bGwsaTphfSkuYT11KTtyZXR1cm4gZS5jaGlsZHJlblswXX1mdW5jdGlvbiBlKG4pe3ZhciB0PW4uY2hpbGRyZW4sZT1uLnBhcmVudC5jaGlsZHJlbixyPW4uaT9lW24uaS0xXTpudWxsO2lmKHQubGVuZ3RoKXtEdShuKTt2YXIgaT0odFswXS56K3RbdC5sZW5ndGgtMV0ueikvMjtyPyhuLno9ci56K28obi5fLHIuXyksbi5tPW4uei1pKTpuLno9aX1lbHNlIHImJihuLno9ci56K28obi5fLHIuXykpO24ucGFyZW50LkE9dShuLHIsbi5wYXJlbnQuQXx8ZVswXSl9ZnVuY3Rpb24gcihuKXtuLl8ueD1uLnorbi5wYXJlbnQubSxuLm0rPW4ucGFyZW50Lm19ZnVuY3Rpb24gdShuLHQsZSl7aWYodCl7Zm9yKHZhciByLHU9bixpPW4sYT10LGw9dS5wYXJlbnQuY2hpbGRyZW5bMF0sYz11Lm0scz1pLm0sZj1hLm0saD1sLm07YT1UdShhKSx1PXF1KHUpLGEmJnU7KWw9cXUobCksaT1UdShpKSxpLmE9bixyPWEueitmLXUuei1jK28oYS5fLHUuXykscj4wJiYoUnUoUHUoYSxuLGUpLG4sciksYys9cixzKz1yKSxmKz1hLm0sYys9dS5tLGgrPWwubSxzKz1pLm07YSYmIVR1KGkpJiYoaS50PWEsaS5tKz1mLXMpLHUmJiFxdShsKSYmKGwudD11LGwubSs9Yy1oLGU9bil9cmV0dXJuIGV9ZnVuY3Rpb24gaShuKXtuLngqPWxbMF0sbi55PW4uZGVwdGgqbFsxXX12YXIgYT1vYS5sYXlvdXQuaGllcmFyY2h5KCkuc29ydChudWxsKS52YWx1ZShudWxsKSxvPUx1LGw9WzEsMV0sYz1udWxsO3JldHVybiBuLnNlcGFyYXRpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89dCxuKTpvfSxuLnNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGM9bnVsbD09KGw9dCk/aTpudWxsLG4pOmM/bnVsbDpsfSxuLm5vZGVTaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW51bGw9PShsPXQpP251bGw6aSxuKTpjP2w6bnVsbH0sdXUobixhKX0sb2EubGF5b3V0LmNsdXN0ZXI9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4saSl7dmFyIGEsbz10LmNhbGwodGhpcyxuLGkpLGw9b1swXSxjPTA7YXUobCxmdW5jdGlvbihuKXt2YXIgdD1uLmNoaWxkcmVuO3QmJnQubGVuZ3RoPyhuLng9anUodCksbi55PVV1KHQpKToobi54PWE/Yys9ZShuLGEpOjAsbi55PTAsYT1uKX0pO3ZhciBzPUZ1KGwpLGY9SHUobCksaD1zLngtZShzLGYpLzIsZz1mLngrZShmLHMpLzI7cmV0dXJuIGF1KGwsdT9mdW5jdGlvbihuKXtuLng9KG4ueC1sLngpKnJbMF0sbi55PShsLnktbi55KSpyWzFdfTpmdW5jdGlvbihuKXtuLng9KG4ueC1oKS8oZy1oKSpyWzBdLG4ueT0oMS0obC55P24ueS9sLnk6MSkpKnJbMV19KSxvfXZhciB0PW9hLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KG51bGwpLnZhbHVlKG51bGwpLGU9THUscj1bMSwxXSx1PSExO3JldHVybiBuLnNlcGFyYXRpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLnNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bnVsbD09KHI9dCksbik6dT9udWxsOnJ9LG4ubm9kZVNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bnVsbCE9KHI9dCksbik6dT9yOm51bGx9LHV1KG4sdCl9LG9hLmxheW91dC50cmVlbWFwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHQpe2Zvcih2YXIgZSxyLHU9LTEsaT1uLmxlbmd0aDsrK3U8aTspcj0oZT1uW3VdKS52YWx1ZSooMD50PzA6dCksZS5hcmVhPWlzTmFOKHIpfHwwPj1yPzA6cn1mdW5jdGlvbiB0KGUpe3ZhciBpPWUuY2hpbGRyZW47aWYoaSYmaS5sZW5ndGgpe3ZhciBhLG8sbCxjPWYoZSkscz1bXSxoPWkuc2xpY2UoKSxwPTEvMCx2PSJzbGljZSI9PT1nP2MuZHg6ImRpY2UiPT09Zz9jLmR5OiJzbGljZS1kaWNlIj09PWc/MSZlLmRlcHRoP2MuZHk6Yy5keDpNYXRoLm1pbihjLmR4LGMuZHkpO2ZvcihuKGgsYy5keCpjLmR5L2UudmFsdWUpLHMuYXJlYT0wOyhsPWgubGVuZ3RoKT4wOylzLnB1c2goYT1oW2wtMV0pLHMuYXJlYSs9YS5hcmVhLCJzcXVhcmlmeSIhPT1nfHwobz1yKHMsdikpPD1wPyhoLnBvcCgpLHA9byk6KHMuYXJlYS09cy5wb3AoKS5hcmVhLHUocyx2LGMsITEpLHY9TWF0aC5taW4oYy5keCxjLmR5KSxzLmxlbmd0aD1zLmFyZWE9MCxwPTEvMCk7cy5sZW5ndGgmJih1KHMsdixjLCEwKSxzLmxlbmd0aD1zLmFyZWE9MCksaS5mb3JFYWNoKHQpfX1mdW5jdGlvbiBlKHQpe3ZhciByPXQuY2hpbGRyZW47aWYociYmci5sZW5ndGgpe3ZhciBpLGE9Zih0KSxvPXIuc2xpY2UoKSxsPVtdO2ZvcihuKG8sYS5keCphLmR5L3QudmFsdWUpLGwuYXJlYT0wO2k9by5wb3AoKTspbC5wdXNoKGkpLGwuYXJlYSs9aS5hcmVhLG51bGwhPWkueiYmKHUobCxpLno/YS5keDphLmR5LGEsIW8ubGVuZ3RoKSxsLmxlbmd0aD1sLmFyZWE9MCk7ci5mb3JFYWNoKGUpfX1mdW5jdGlvbiByKG4sdCl7Zm9yKHZhciBlLHI9bi5hcmVhLHU9MCxpPTEvMCxhPS0xLG89bi5sZW5ndGg7KythPG87KShlPW5bYV0uYXJlYSkmJihpPmUmJihpPWUpLGU+dSYmKHU9ZSkpO3JldHVybiByKj1yLHQqPXQscj9NYXRoLm1heCh0KnUqcC9yLHIvKHQqaSpwKSk6MS8wfWZ1bmN0aW9uIHUobix0LGUscil7dmFyIHUsaT0tMSxhPW4ubGVuZ3RoLG89ZS54LGM9ZS55LHM9dD9sKG4uYXJlYS90KTowOwppZih0PT1lLmR4KXtmb3IoKHJ8fHM+ZS5keSkmJihzPWUuZHkpOysraTxhOyl1PW5baV0sdS54PW8sdS55PWMsdS5keT1zLG8rPXUuZHg9TWF0aC5taW4oZS54K2UuZHgtbyxzP2wodS5hcmVhL3MpOjApO3Uuej0hMCx1LmR4Kz1lLngrZS5keC1vLGUueSs9cyxlLmR5LT1zfWVsc2V7Zm9yKChyfHxzPmUuZHgpJiYocz1lLmR4KTsrK2k8YTspdT1uW2ldLHUueD1vLHUueT1jLHUuZHg9cyxjKz11LmR5PU1hdGgubWluKGUueStlLmR5LWMscz9sKHUuYXJlYS9zKTowKTt1Lno9ITEsdS5keSs9ZS55K2UuZHktYyxlLngrPXMsZS5keC09c319ZnVuY3Rpb24gaShyKXt2YXIgdT1hfHxvKHIpLGk9dVswXTtyZXR1cm4gaS54PWkueT0wLGkudmFsdWU/KGkuZHg9Y1swXSxpLmR5PWNbMV0pOmkuZHg9aS5keT0wLGEmJm8ucmV2YWx1ZShpKSxuKFtpXSxpLmR4KmkuZHkvaS52YWx1ZSksKGE/ZTp0KShpKSxoJiYoYT11KSx1fXZhciBhLG89b2EubGF5b3V0LmhpZXJhcmNoeSgpLGw9TWF0aC5yb3VuZCxjPVsxLDFdLHM9bnVsbCxmPU91LGg9ITEsZz0ic3F1YXJpZnkiLHA9LjUqKDErTWF0aC5zcXJ0KDUpKTtyZXR1cm4gaS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4saSk6Y30saS5wYWRkaW5nPWZ1bmN0aW9uKG4pe2Z1bmN0aW9uIHQodCl7dmFyIGU9bi5jYWxsKGksdCx0LmRlcHRoKTtyZXR1cm4gbnVsbD09ZT9PdSh0KTpJdSh0LCJudW1iZXIiPT10eXBlb2YgZT9bZSxlLGUsZV06ZSl9ZnVuY3Rpb24gZSh0KXtyZXR1cm4gSXUodCxuKX1pZighYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gczt2YXIgcjtyZXR1cm4gZj1udWxsPT0ocz1uKT9PdToiZnVuY3Rpb24iPT0ocj10eXBlb2Ygbik/dDoibnVtYmVyIj09PXI/KG49W24sbixuLG5dLGUpOmUsaX0saS5yb3VuZD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD1uP01hdGgucm91bmQ6TnVtYmVyLGkpOmwhPU51bWJlcn0saS5zdGlja3k9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGg9bixhPW51bGwsaSk6aH0saS5yYXRpbz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD1uLGkpOnB9LGkubW9kZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZz1uKyIiLGkpOmd9LHV1KGksbyl9LG9hLnJhbmRvbT17bm9ybWFsOmZ1bmN0aW9uKG4sdCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aDtyZXR1cm4gMj5lJiYodD0xKSwxPmUmJihuPTApLGZ1bmN0aW9uKCl7dmFyIGUscix1O2RvIGU9MipNYXRoLnJhbmRvbSgpLTEscj0yKk1hdGgucmFuZG9tKCktMSx1PWUqZStyKnI7d2hpbGUoIXV8fHU+MSk7cmV0dXJuIG4rdCplKk1hdGguc3FydCgtMipNYXRoLmxvZyh1KS91KX19LGxvZ05vcm1hbDpmdW5jdGlvbigpe3ZhciBuPW9hLnJhbmRvbS5ub3JtYWwuYXBwbHkob2EsYXJndW1lbnRzKTtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5leHAobigpKX19LGJhdGVzOmZ1bmN0aW9uKG4pe3ZhciB0PW9hLnJhbmRvbS5pcndpbkhhbGwobik7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIHQoKS9ufX0saXJ3aW5IYWxsOmZ1bmN0aW9uKG4pe3JldHVybiBmdW5jdGlvbigpe2Zvcih2YXIgdD0wLGU9MDtuPmU7ZSsrKXQrPU1hdGgucmFuZG9tKCk7cmV0dXJuIHR9fX0sb2Euc2NhbGU9e307dmFyIHdsPXtmbG9vcjp5LGNlaWw6eX07b2Euc2NhbGUubGluZWFyPWZ1bmN0aW9uKCl7cmV0dXJuIFd1KFswLDFdLFswLDFdLE1yLCExKX07dmFyIFNsPXtzOjEsZzoxLHA6MSxyOjEsZToxfTtvYS5zY2FsZS5sb2c9ZnVuY3Rpb24oKXtyZXR1cm4gcmkob2Euc2NhbGUubGluZWFyKCkuZG9tYWluKFswLDFdKSwxMCwhMCxbMSwxMF0pfTt2YXIga2w9b2EuZm9ybWF0KCIuMGUiKSxObD17Zmxvb3I6ZnVuY3Rpb24obil7cmV0dXJuLU1hdGguY2VpbCgtbil9LGNlaWw6ZnVuY3Rpb24obil7cmV0dXJuLU1hdGguZmxvb3IoLW4pfX07b2Euc2NhbGUucG93PWZ1bmN0aW9uKCl7cmV0dXJuIHVpKG9hLnNjYWxlLmxpbmVhcigpLDEsWzAsMV0pfSxvYS5zY2FsZS5zcXJ0PWZ1bmN0aW9uKCl7cmV0dXJuIG9hLnNjYWxlLnBvdygpLmV4cG9uZW50KC41KX0sb2Euc2NhbGUub3JkaW5hbD1mdW5jdGlvbigpe3JldHVybiBhaShbXSx7dDoicmFuZ2UiLGE6W1tdXX0pfSxvYS5zY2FsZS5jYXRlZ29yeTEwPWZ1bmN0aW9uKCl7cmV0dXJuIG9hLnNjYWxlLm9yZGluYWwoKS5yYW5nZShFbCl9LG9hLnNjYWxlLmNhdGVnb3J5MjA9ZnVuY3Rpb24oKXtyZXR1cm4gb2Euc2NhbGUub3JkaW5hbCgpLnJhbmdlKEFsKX0sb2Euc2NhbGUuY2F0ZWdvcnkyMGI9ZnVuY3Rpb24oKXtyZXR1cm4gb2Euc2NhbGUub3JkaW5hbCgpLnJhbmdlKENsKX0sb2Euc2NhbGUuY2F0ZWdvcnkyMGM9ZnVuY3Rpb24oKXtyZXR1cm4gb2Euc2NhbGUub3JkaW5hbCgpLnJhbmdlKHpsKX07dmFyIEVsPVsyMDYyMjYwLDE2NzQ0MjA2LDI5MjQ1ODgsMTQwMzQ3MjgsOTcyNTg4NSw5MTk3MTMxLDE0OTA3MzMwLDgzNTU3MTEsMTIzNjkxODYsMTU1NjE3NV0ubWFwKHhuKSxBbD1bMjA2MjI2MCwxMTQ1NDQ0MCwxNjc0NDIwNiwxNjc1OTY3MiwyOTI0NTg4LDEwMDE4Njk4LDE0MDM0NzI4LDE2NzUwNzQyLDk3MjU4ODUsMTI5NTU4NjEsOTE5NzEzMSwxMjg4NTE0MCwxNDkwNzMzMCwxNjIzNDE5NCw4MzU1NzExLDEzMDkyODA3LDEyMzY5MTg2LDE0NDA4NTg5LDE1NTYxNzUsMTA0MTA3MjVdLm1hcCh4biksQ2w9WzM3NTA3NzcsNTM5NTYxOSw3MDQwNzE5LDEwMjY0Mjg2LDY1MTkwOTcsOTIxNjU5NCwxMTkxNTExNSwxMzU1NjYzNiw5MjAyOTkzLDEyNDI2ODA5LDE1MTg2NTE0LDE1MTkwOTMyLDg2NjYxNjksMTEzNTY0OTAsMTQwNDk2NDMsMTUxNzczNzIsODA3NzY4MywxMDgzNDMyNCwxMzUyODUwOSwxNDU4OTY1NF0ubWFwKHhuKSx6bD1bMzI0NDczMyw3MDU3MTEwLDEwNDA2NjI1LDEzMDMyNDMxLDE1MDk1MDUzLDE2NjE2NzY0LDE2NjI1MjU5LDE2NjM0MDE4LDMyNTMwNzYsNzY1MjQ3MCwxMDYwNzAwMywxMzEwMTUwNCw3Njk1MjgxLDEwMzk0MzEyLDEyMzY5MzcyLDE0MzQyODkxLDY1MTM1MDcsOTg2ODk1MCwxMjQzNDg3NywxNDI3NzA4MV0ubWFwKHhuKTtvYS5zY2FsZS5xdWFudGlsZT1mdW5jdGlvbigpe3JldHVybiBvaShbXSxbXSl9LG9hLnNjYWxlLnF1YW50aXplPWZ1bmN0aW9uKCl7cmV0dXJuIGxpKDAsMSxbMCwxXSl9LG9hLnNjYWxlLnRocmVzaG9sZD1mdW5jdGlvbigpe3JldHVybiBjaShbLjVdLFswLDFdKX0sb2Euc2NhbGUuaWRlbnRpdHk9ZnVuY3Rpb24oKXtyZXR1cm4gc2koWzAsMV0pfSxvYS5zdmc9e30sb2Euc3ZnLmFyYz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt2YXIgbj1NYXRoLm1heCgwLCtlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSksYz1NYXRoLm1heCgwLCtyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSkscz1hLmFwcGx5KHRoaXMsYXJndW1lbnRzKS1IYSxmPW8uYXBwbHkodGhpcyxhcmd1bWVudHMpLUhhLGg9TWF0aC5hYnMoZi1zKSxnPXM+Zj8wOjE7aWYobj5jJiYocD1jLGM9bixuPXApLGg+PUZhKXJldHVybiB0KGMsZykrKG4/dChuLDEtZyk6IiIpKyJaIjt2YXIgcCx2LGQsbSx5LE0seCxiLF8sdyxTLGssTj0wLEU9MCxBPVtdO2lmKChtPSgrbC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fDApLzIpJiYoZD1pPT09TGw/TWF0aC5zcXJ0KG4qbitjKmMpOitpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxnfHwoRSo9LTEpLGMmJihFPXRuKGQvYypNYXRoLnNpbihtKSkpLG4mJihOPXRuKGQvbipNYXRoLnNpbihtKSkpKSxjKXt5PWMqTWF0aC5jb3MocytFKSxNPWMqTWF0aC5zaW4ocytFKSx4PWMqTWF0aC5jb3MoZi1FKSxiPWMqTWF0aC5zaW4oZi1FKTt2YXIgQz1NYXRoLmFicyhmLXMtMipFKTw9VWE/MDoxO2lmKEUmJm1pKHksTSx4LGIpPT09Z15DKXt2YXIgej0ocytmKS8yO3k9YypNYXRoLmNvcyh6KSxNPWMqTWF0aC5zaW4oeikseD1iPW51bGx9fWVsc2UgeT1NPTA7aWYobil7Xz1uKk1hdGguY29zKGYtTiksdz1uKk1hdGguc2luKGYtTiksUz1uKk1hdGguY29zKHMrTiksaz1uKk1hdGguc2luKHMrTik7dmFyIEw9TWF0aC5hYnMocy1mKzIqTik8PVVhPzA6MTtpZihOJiZtaShfLHcsUyxrKT09PTEtZ15MKXt2YXIgcT0ocytmKS8yO189bipNYXRoLmNvcyhxKSx3PW4qTWF0aC5zaW4ocSksUz1rPW51bGx9fWVsc2UgXz13PTA7aWYoaD5EYSYmKHA9TWF0aC5taW4oTWF0aC5hYnMoYy1uKS8yLCt1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSkpPi4wMDEpe3Y9Yz5uXmc/MDoxO3ZhciBUPXAsUj1wO2lmKFVhPmgpe3ZhciBEPW51bGw9PVM/W18sd106bnVsbD09eD9beSxNXTpSZShbeSxNXSxbUyxrXSxbeCxiXSxbXyx3XSksUD15LURbMF0sVT1NLURbMV0saj14LURbMF0sRj1iLURbMV0sSD0xL01hdGguc2luKE1hdGguYWNvcygoUCpqK1UqRikvKE1hdGguc3FydChQKlArVSpVKSpNYXRoLnNxcnQoaipqK0YqRikpKS8yKSxPPU1hdGguc3FydChEWzBdKkRbMF0rRFsxXSpEWzFdKTtSPU1hdGgubWluKHAsKG4tTykvKEgtMSkpLFQ9TWF0aC5taW4ocCwoYy1PKS8oSCsxKSl9aWYobnVsbCE9eCl7dmFyIEk9eWkobnVsbD09Uz9bXyx3XTpbUyxrXSxbeSxNXSxjLFQsZyksWT15aShbeCxiXSxbXyx3XSxjLFQsZyk7cD09PVQ/QS5wdXNoKCJNIixJWzBdLCJBIixULCIsIixULCIgMCAwLCIsdiwiICIsSVsxXSwiQSIsYywiLCIsYywiIDAgIiwxLWdebWkoSVsxXVswXSxJWzFdWzFdLFlbMV1bMF0sWVsxXVsxXSksIiwiLGcsIiAiLFlbMV0sIkEiLFQsIiwiLFQsIiAwIDAsIix2LCIgIixZWzBdKTpBLnB1c2goIk0iLElbMF0sIkEiLFQsIiwiLFQsIiAwIDEsIix2LCIgIixZWzBdKX1lbHNlIEEucHVzaCgiTSIseSwiLCIsTSk7aWYobnVsbCE9Uyl7dmFyIFo9eWkoW3ksTV0sW1Msa10sbiwtUixnKSxWPXlpKFtfLHddLG51bGw9PXg/W3ksTV06W3gsYl0sbiwtUixnKTtwPT09Uj9BLnB1c2goIkwiLFZbMF0sIkEiLFIsIiwiLFIsIiAwIDAsIix2LCIgIixWWzFdLCJBIixuLCIsIixuLCIgMCAiLGdebWkoVlsxXVswXSxWWzFdWzFdLFpbMV1bMF0sWlsxXVsxXSksIiwiLDEtZywiICIsWlsxXSwiQSIsUiwiLCIsUiwiIDAgMCwiLHYsIiAiLFpbMF0pOkEucHVzaCgiTCIsVlswXSwiQSIsUiwiLCIsUiwiIDAgMCwiLHYsIiAiLFpbMF0pfWVsc2UgQS5wdXNoKCJMIixfLCIsIix3KX1lbHNlIEEucHVzaCgiTSIseSwiLCIsTSksbnVsbCE9eCYmQS5wdXNoKCJBIixjLCIsIixjLCIgMCAiLEMsIiwiLGcsIiAiLHgsIiwiLGIpLEEucHVzaCgiTCIsXywiLCIsdyksbnVsbCE9UyYmQS5wdXNoKCJBIixuLCIsIixuLCIgMCAiLEwsIiwiLDEtZywiICIsUywiLCIsayk7cmV0dXJuIEEucHVzaCgiWiIpLEEuam9pbigiIil9ZnVuY3Rpb24gdChuLHQpe3JldHVybiJNMCwiK24rIkEiK24rIiwiK24rIiAwIDEsIit0KyIgMCwiKy1uKyJBIituKyIsIituKyIgMCAxLCIrdCsiIDAsIitufXZhciBlPWhpLHI9Z2ksdT1maSxpPUxsLGE9cGksbz12aSxsPWRpO3JldHVybiBuLmlubmVyUmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPUVuKHQpLG4pOmV9LG4ub3V0ZXJSYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RW4odCksbik6cn0sbi5jb3JuZXJSYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9RW4odCksbik6dX0sbi5wYWRSYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9dD09TGw/TGw6RW4odCksbik6aX0sbi5zdGFydEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPUVuKHQpLG4pOmF9LG4uZW5kQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89RW4odCksbik6b30sbi5wYWRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD1Fbih0KSxuKTpsfSxuLmNlbnRyb2lkPWZ1bmN0aW9uKCl7dmFyIG49KCtlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSsgK3IuYXBwbHkodGhpcyxhcmd1bWVudHMpKS8yLHQ9KCthLmFwcGx5KHRoaXMsYXJndW1lbnRzKSsgK28uYXBwbHkodGhpcyxhcmd1bWVudHMpKS8yLUhhO3JldHVybltNYXRoLmNvcyh0KSpuLE1hdGguc2luKHQpKm5dfSxufTt2YXIgTGw9ImF1dG8iO29hLnN2Zy5saW5lPWZ1bmN0aW9uKCl7cmV0dXJuIE1pKHkpfTt2YXIgcWw9b2EubWFwKHtsaW5lYXI6eGksImxpbmVhci1jbG9zZWQiOmJpLHN0ZXA6X2ksInN0ZXAtYmVmb3JlIjp3aSwic3RlcC1hZnRlciI6U2ksYmFzaXM6emksImJhc2lzLW9wZW4iOkxpLCJiYXNpcy1jbG9zZWQiOnFpLGJ1bmRsZTpUaSxjYXJkaW5hbDpFaSwiY2FyZGluYWwtb3BlbiI6a2ksImNhcmRpbmFsLWNsb3NlZCI6TmksbW9ub3RvbmU6Rml9KTtxbC5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7dC5rZXk9bix0LmNsb3NlZD0vLWNsb3NlZCQvLnRlc3Qobil9KTt2YXIgVGw9WzAsMi8zLDEvMywwXSxSbD1bMCwxLzMsMi8zLDBdLERsPVswLDEvNiwyLzMsMS82XTtvYS5zdmcubGluZS5yYWRpYWw9ZnVuY3Rpb24oKXt2YXIgbj1NaShIaSk7cmV0dXJuIG4ucmFkaXVzPW4ueCxkZWxldGUgbi54LG4uYW5nbGU9bi55LGRlbGV0ZSBuLnksbn0sd2kucmV2ZXJzZT1TaSxTaS5yZXZlcnNlPXdpLG9hLnN2Zy5hcmVhPWZ1bmN0aW9uKCl7cmV0dXJuIE9pKHkpfSxvYS5zdmcuYXJlYS5yYWRpYWw9ZnVuY3Rpb24oKXt2YXIgbj1PaShIaSk7cmV0dXJuIG4ucmFkaXVzPW4ueCxkZWxldGUgbi54LG4uaW5uZXJSYWRpdXM9bi54MCxkZWxldGUgbi54MCxuLm91dGVyUmFkaXVzPW4ueDEsZGVsZXRlIG4ueDEsbi5hbmdsZT1uLnksZGVsZXRlIG4ueSxuLnN0YXJ0QW5nbGU9bi55MCxkZWxldGUgbi55MCxuLmVuZEFuZ2xlPW4ueTEsZGVsZXRlIG4ueTEsbn0sb2Euc3ZnLmNob3JkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLG8pe3ZhciBsPXQodGhpcyxpLG4sbyksYz10KHRoaXMsYSxuLG8pO3JldHVybiJNIitsLnAwK3IobC5yLGwucDEsbC5hMS1sLmEwKSsoZShsLGMpP3UobC5yLGwucDEsbC5yLGwucDApOnUobC5yLGwucDEsYy5yLGMucDApK3IoYy5yLGMucDEsYy5hMS1jLmEwKSt1KGMucixjLnAxLGwucixsLnAwKSkrIloifWZ1bmN0aW9uIHQobix0LGUscil7dmFyIHU9dC5jYWxsKG4sZSxyKSxpPW8uY2FsbChuLHUsciksYT1sLmNhbGwobix1LHIpLUhhLHM9Yy5jYWxsKG4sdSxyKS1IYTtyZXR1cm57cjppLGEwOmEsYTE6cyxwMDpbaSpNYXRoLmNvcyhhKSxpKk1hdGguc2luKGEpXSxwMTpbaSpNYXRoLmNvcyhzKSxpKk1hdGguc2luKHMpXX19ZnVuY3Rpb24gZShuLHQpe3JldHVybiBuLmEwPT10LmEwJiZuLmExPT10LmExfWZ1bmN0aW9uIHIobix0LGUpe3JldHVybiJBIituKyIsIituKyIgMCAiKyArKGU+VWEpKyIsMSAiK3R9ZnVuY3Rpb24gdShuLHQsZSxyKXtyZXR1cm4iUSAwLDAgIityfXZhciBpPU1lLGE9eGUsbz1JaSxsPXBpLGM9dmk7cmV0dXJuIG4ucmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPUVuKHQpLG4pOm99LG4uc291cmNlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPUVuKHQpLG4pOml9LG4udGFyZ2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPUVuKHQpLG4pOmF9LG4uc3RhcnRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD1Fbih0KSxuKTpsfSxuLmVuZEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPUVuKHQpLG4pOmN9LG59LG9hLnN2Zy5kaWFnb25hbD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obix1KXt2YXIgaT10LmNhbGwodGhpcyxuLHUpLGE9ZS5jYWxsKHRoaXMsbix1KSxvPShpLnkrYS55KS8yLGw9W2kse3g6aS54LHk6b30se3g6YS54LHk6b30sYV07cmV0dXJuIGw9bC5tYXAociksIk0iK2xbMF0rIkMiK2xbMV0rIiAiK2xbMl0rIiAiK2xbM119dmFyIHQ9TWUsZT14ZSxyPVlpO3JldHVybiBuLnNvdXJjZT1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1FbihlKSxuKTp0fSxuLnRhcmdldD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1Fbih0KSxuKTplfSxuLnByb2plY3Rpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxufSxvYS5zdmcuZGlhZ29uYWwucmFkaWFsPWZ1bmN0aW9uKCl7dmFyIG49b2Euc3ZnLmRpYWdvbmFsKCksdD1ZaSxlPW4ucHJvamVjdGlvbjtyZXR1cm4gbi5wcm9qZWN0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP2UoWmkodD1uKSk6dH0sbn0sb2Euc3ZnLnN5bWJvbD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixyKXtyZXR1cm4oUGwuZ2V0KHQuY2FsbCh0aGlzLG4scikpfHwkaSkoZS5jYWxsKHRoaXMsbixyKSl9dmFyIHQ9WGksZT1WaTtyZXR1cm4gbi50eXBlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PUVuKGUpLG4pOnR9LG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1Fbih0KSxuKTplfSxufTt2YXIgUGw9b2EubWFwKHtjaXJjbGU6JGksY3Jvc3M6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4vNSkvMjtyZXR1cm4iTSIrLTMqdCsiLCIrLXQrIkgiKy10KyJWIistMyp0KyJIIit0KyJWIistdCsiSCIrMyp0KyJWIit0KyJIIit0KyJWIiszKnQrIkgiKy10KyJWIit0KyJIIistMyp0KyJaIn0sZGlhbW9uZDpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi8oMipqbCkpLGU9dCpqbDtyZXR1cm4iTTAsIistdCsiTCIrZSsiLDAgMCwiK3QrIiAiKy1lKyIsMFoifSxzcXVhcmU6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4pLzI7cmV0dXJuIk0iKy10KyIsIistdCsiTCIrdCsiLCIrLXQrIiAiK3QrIiwiK3QrIiAiKy10KyIsIit0KyJaIn0sInRyaWFuZ2xlLWRvd24iOmZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguc3FydChuL1VsKSxlPXQqVWwvMjtyZXR1cm4iTTAsIitlKyJMIit0KyIsIistZSsiICIrLXQrIiwiKy1lKyJaIn0sInRyaWFuZ2xlLXVwIjpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi9VbCksZT10KlVsLzI7cmV0dXJuIk0wLCIrLWUrIkwiK3QrIiwiK2UrIiAiKy10KyIsIitlKyJaIn19KTtvYS5zdmcuc3ltYm9sVHlwZXM9UGwua2V5cygpO3ZhciBVbD1NYXRoLnNxcnQoMyksamw9TWF0aC50YW4oMzAqT2EpO0FhLnRyYW5zaXRpb249ZnVuY3Rpb24obil7Zm9yKHZhciB0LGUscj1GbHx8KytZbCx1PUtpKG4pLGk9W10sYT1IbHx8e3RpbWU6RGF0ZS5ub3coKSxlYXNlOk5yLGRlbGF5OjAsZHVyYXRpb246MjUwfSxvPS0xLGw9dGhpcy5sZW5ndGg7KytvPGw7KXtpLnB1c2godD1bXSk7Zm9yKHZhciBjPXRoaXNbb10scz0tMSxmPWMubGVuZ3RoOysrczxmOykoZT1jW3NdKSYmUWkoZSxzLHUscixhKSx0LnB1c2goZSl9cmV0dXJuIFdpKGksdSxyKX0sQWEuaW50ZXJydXB0PWZ1bmN0aW9uKG4pe3JldHVybiB0aGlzLmVhY2gobnVsbD09bj9PbDpCaShLaShuKSkpfTt2YXIgRmwsSGwsT2w9QmkoS2koKSksSWw9W10sWWw9MDtJbC5jYWxsPUFhLmNhbGwsSWwuZW1wdHk9QWEuZW1wdHksSWwubm9kZT1BYS5ub2RlLElsLnNpemU9QWEuc2l6ZSxvYS50cmFuc2l0aW9uPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4mJm4udHJhbnNpdGlvbj9GbD9uLnRyYW5zaXRpb24odCk6bjpvYS5zZWxlY3Rpb24oKS50cmFuc2l0aW9uKG4pfSxvYS50cmFuc2l0aW9uLnByb3RvdHlwZT1JbCxJbC5zZWxlY3Q9ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9dGhpcy5pZCxpPXRoaXMubmFtZXNwYWNlLGE9W107bj1BKG4pO2Zvcih2YXIgbz0tMSxsPXRoaXMubGVuZ3RoOysrbzxsOyl7YS5wdXNoKHQ9W10pO2Zvcih2YXIgYz10aGlzW29dLHM9LTEsZj1jLmxlbmd0aDsrK3M8ZjspKHI9Y1tzXSkmJihlPW4uY2FsbChyLHIuX19kYXRhX18scyxvKSk/KCJfX2RhdGFfXyJpbiByJiYoZS5fX2RhdGFfXz1yLl9fZGF0YV9fKSxRaShlLHMsaSx1LHJbaV1bdV0pLHQucHVzaChlKSk6dC5wdXNoKG51bGwpfXJldHVybiBXaShhLGksdSl9LElsLnNlbGVjdEFsbD1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpLGE9dGhpcy5pZCxvPXRoaXMubmFtZXNwYWNlLGw9W107bj1DKG4pO2Zvcih2YXIgYz0tMSxzPXRoaXMubGVuZ3RoOysrYzxzOylmb3IodmFyIGY9dGhpc1tjXSxoPS0xLGc9Zi5sZW5ndGg7KytoPGc7KWlmKHI9ZltoXSl7aT1yW29dW2FdLGU9bi5jYWxsKHIsci5fX2RhdGFfXyxoLGMpLGwucHVzaCh0PVtdKTtmb3IodmFyIHA9LTEsdj1lLmxlbmd0aDsrK3A8djspKHU9ZVtwXSkmJlFpKHUscCxvLGEsaSksdC5wdXNoKHUpfXJldHVybiBXaShsLG8sYSl9LElsLmZpbHRlcj1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdT1bXTsiZnVuY3Rpb24iIT10eXBlb2YgbiYmKG49TyhuKSk7Zm9yKHZhciBpPTAsYT10aGlzLmxlbmd0aDthPmk7aSsrKXt1LnB1c2godD1bXSk7Zm9yKHZhciBlPXRoaXNbaV0sbz0wLGw9ZS5sZW5ndGg7bD5vO28rKykocj1lW29dKSYmbi5jYWxsKHIsci5fX2RhdGFfXyxvLGkpJiZ0LnB1c2gocil9cmV0dXJuIFdpKHUsdGhpcy5uYW1lc3BhY2UsdGhpcy5pZCl9LElsLnR3ZWVuPWZ1bmN0aW9uKG4sdCl7dmFyIGU9dGhpcy5pZCxyPXRoaXMubmFtZXNwYWNlO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/dGhpcy5ub2RlKClbcl1bZV0udHdlZW4uZ2V0KG4pOlkodGhpcyxudWxsPT10P2Z1bmN0aW9uKHQpe3Rbcl1bZV0udHdlZW4ucmVtb3ZlKG4pfTpmdW5jdGlvbih1KXt1W3JdW2VdLnR3ZWVuLnNldChuLHQpfSl9LElsLmF0dHI9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKCl7dGhpcy5yZW1vdmVBdHRyaWJ1dGUobyl9ZnVuY3Rpb24gcigpe3RoaXMucmVtb3ZlQXR0cmlidXRlTlMoby5zcGFjZSxvLmxvY2FsKX1mdW5jdGlvbiB1KG4pe3JldHVybiBudWxsPT1uP2U6KG4rPSIiLGZ1bmN0aW9uKCl7dmFyIHQsZT10aGlzLmdldEF0dHJpYnV0ZShvKTtyZXR1cm4gZSE9PW4mJih0PWEoZSxuKSxmdW5jdGlvbihuKXt0aGlzLnNldEF0dHJpYnV0ZShvLHQobikpfSl9KX1mdW5jdGlvbiBpKG4pe3JldHVybiBudWxsPT1uP3I6KG4rPSIiLGZ1bmN0aW9uKCl7dmFyIHQsZT10aGlzLmdldEF0dHJpYnV0ZU5TKG8uc3BhY2Usby5sb2NhbCk7cmV0dXJuIGUhPT1uJiYodD1hKGUsbiksZnVuY3Rpb24obil7dGhpcy5zZXRBdHRyaWJ1dGVOUyhvLnNwYWNlLG8ubG9jYWwsdChuKSl9KX0pfWlmKGFyZ3VtZW50cy5sZW5ndGg8Mil7Zm9yKHQgaW4gbil0aGlzLmF0dHIodCxuW3RdKTtyZXR1cm4gdGhpc312YXIgYT0idHJhbnNmb3JtIj09bj8kcjpNcixvPW9hLm5zLnF1YWxpZnkobik7cmV0dXJuIEppKHRoaXMsImF0dHIuIituLHQsby5sb2NhbD9pOnUpfSxJbC5hdHRyVHdlZW49ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKG4sZSl7dmFyIHI9dC5jYWxsKHRoaXMsbixlLHRoaXMuZ2V0QXR0cmlidXRlKHUpKTtyZXR1cm4gciYmZnVuY3Rpb24obil7dGhpcy5zZXRBdHRyaWJ1dGUodSxyKG4pKX19ZnVuY3Rpb24gcihuLGUpe3ZhciByPXQuY2FsbCh0aGlzLG4sZSx0aGlzLmdldEF0dHJpYnV0ZU5TKHUuc3BhY2UsdS5sb2NhbCkpO3JldHVybiByJiZmdW5jdGlvbihuKXt0aGlzLnNldEF0dHJpYnV0ZU5TKHUuc3BhY2UsdS5sb2NhbCxyKG4pKX19dmFyIHU9b2EubnMucXVhbGlmeShuKTtyZXR1cm4gdGhpcy50d2VlbigiYXR0ci4iK24sdS5sb2NhbD9yOmUpfSxJbC5zdHlsZT1mdW5jdGlvbihuLGUscil7ZnVuY3Rpb24gdSgpe3RoaXMuc3R5bGUucmVtb3ZlUHJvcGVydHkobil9ZnVuY3Rpb24gaShlKXtyZXR1cm4gbnVsbD09ZT91OihlKz0iIixmdW5jdGlvbigpe3ZhciB1LGk9dCh0aGlzKS5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKTtyZXR1cm4gaSE9PWUmJih1PU1yKGksZSksZnVuY3Rpb24odCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLHUodCkscil9KX0pfXZhciBhPWFyZ3VtZW50cy5sZW5ndGg7aWYoMz5hKXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+YSYmKGU9IiIpO2ZvcihyIGluIG4pdGhpcy5zdHlsZShyLG5bcl0sZSk7cmV0dXJuIHRoaXN9cj0iIn1yZXR1cm4gSmkodGhpcywic3R5bGUuIituLGUsaSl9LElsLnN0eWxlVHdlZW49ZnVuY3Rpb24obixlLHIpe2Z1bmN0aW9uIHUodSxpKXt2YXIgYT1lLmNhbGwodGhpcyx1LGksdCh0aGlzKS5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKSk7cmV0dXJuIGEmJmZ1bmN0aW9uKHQpe3RoaXMuc3R5bGUuc2V0UHJvcGVydHkobixhKHQpLHIpfX1yZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwzJiYocj0iIiksdGhpcy50d2Vlbigic3R5bGUuIituLHUpfSxJbC50ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBKaSh0aGlzLCJ0ZXh0IixuLEdpKX0sSWwucmVtb3ZlPWZ1bmN0aW9uKCl7dmFyIG49dGhpcy5uYW1lc3BhY2U7cmV0dXJuIHRoaXMuZWFjaCgiZW5kLnRyYW5zaXRpb24iLGZ1bmN0aW9uKCl7dmFyIHQ7dGhpc1tuXS5jb3VudDwyJiYodD10aGlzLnBhcmVudE5vZGUpJiZ0LnJlbW92ZUNoaWxkKHRoaXMpfSl9LElsLmVhc2U9ZnVuY3Rpb24obil7dmFyIHQ9dGhpcy5pZCxlPXRoaXMubmFtZXNwYWNlO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDE/dGhpcy5ub2RlKClbZV1bdF0uZWFzZTooImZ1bmN0aW9uIiE9dHlwZW9mIG4mJihuPW9hLmVhc2UuYXBwbHkob2EsYXJndW1lbnRzKSksWSh0aGlzLGZ1bmN0aW9uKHIpe3JbZV1bdF0uZWFzZT1ufSkpfSxJbC5kZWxheT1mdW5jdGlvbihuKXt2YXIgdD10aGlzLmlkLGU9dGhpcy5uYW1lc3BhY2U7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKVtlXVt0XS5kZWxheTpZKHRoaXMsImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24ocix1LGkpe3JbZV1bdF0uZGVsYXk9K24uY2FsbChyLHIuX19kYXRhX18sdSxpKX06KG49K24sZnVuY3Rpb24ocil7cltlXVt0XS5kZWxheT1ufSkpfSxJbC5kdXJhdGlvbj1mdW5jdGlvbihuKXt2YXIgdD10aGlzLmlkLGU9dGhpcy5uYW1lc3BhY2U7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKVtlXVt0XS5kdXJhdGlvbjpZKHRoaXMsImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24ocix1LGkpe3JbZV1bdF0uZHVyYXRpb249TWF0aC5tYXgoMSxuLmNhbGwocixyLl9fZGF0YV9fLHUsaSkpfToobj1NYXRoLm1heCgxLG4pLGZ1bmN0aW9uKHIpe3JbZV1bdF0uZHVyYXRpb249bn0pKX0sSWwuZWFjaD1mdW5jdGlvbihuLHQpe3ZhciBlPXRoaXMuaWQscj10aGlzLm5hbWVzcGFjZTtpZihhcmd1bWVudHMubGVuZ3RoPDIpe3ZhciB1PUhsLGk9Rmw7dHJ5e0ZsPWUsWSh0aGlzLGZ1bmN0aW9uKHQsdSxpKXtIbD10W3JdW2VdLG4uY2FsbCh0LHQuX19kYXRhX18sdSxpKX0pfWZpbmFsbHl7SGw9dSxGbD1pfX1lbHNlIFkodGhpcyxmdW5jdGlvbih1KXt2YXIgaT11W3JdW2VdOyhpLmV2ZW50fHwoaS5ldmVudD1vYS5kaXNwYXRjaCgic3RhcnQiLCJlbmQiLCJpbnRlcnJ1cHQiKSkpLm9uKG4sdCl9KTtyZXR1cm4gdGhpc30sSWwudHJhbnNpdGlvbj1mdW5jdGlvbigpe2Zvcih2YXIgbix0LGUscix1PXRoaXMuaWQsaT0rK1lsLGE9dGhpcy5uYW1lc3BhY2Usbz1bXSxsPTAsYz10aGlzLmxlbmd0aDtjPmw7bCsrKXtvLnB1c2gobj1bXSk7Zm9yKHZhciB0PXRoaXNbbF0scz0wLGY9dC5sZW5ndGg7Zj5zO3MrKykoZT10W3NdKSYmKHI9ZVthXVt1XSxRaShlLHMsYSxpLHt0aW1lOnIudGltZSxlYXNlOnIuZWFzZSxkZWxheTpyLmRlbGF5K3IuZHVyYXRpb24sZHVyYXRpb246ci5kdXJhdGlvbn0pKSxuLnB1c2goZSl9cmV0dXJuIFdpKG8sYSxpKX0sb2Euc3ZnLmF4aXM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe24uZWFjaChmdW5jdGlvbigpe3ZhciBuLGM9b2Euc2VsZWN0KHRoaXMpLHM9dGhpcy5fX2NoYXJ0X198fGUsZj10aGlzLl9fY2hhcnRfXz1lLmNvcHkoKSxoPW51bGw9PWw/Zi50aWNrcz9mLnRpY2tzLmFwcGx5KGYsbyk6Zi5kb21haW4oKTpsLGc9bnVsbD09dD9mLnRpY2tGb3JtYXQ/Zi50aWNrRm9ybWF0LmFwcGx5KGYsbyk6eTp0LHA9Yy5zZWxlY3RBbGwoIi50aWNrIikuZGF0YShoLGYpLHY9cC5lbnRlcigpLmluc2VydCgiZyIsIi5kb21haW4iKS5hdHRyKCJjbGFzcyIsInRpY2siKS5zdHlsZSgib3BhY2l0eSIsRGEpLGQ9b2EudHJhbnNpdGlvbihwLmV4aXQoKSkuc3R5bGUoIm9wYWNpdHkiLERhKS5yZW1vdmUoKSxtPW9hLnRyYW5zaXRpb24ocC5vcmRlcigpKS5zdHlsZSgib3BhY2l0eSIsMSksTT1NYXRoLm1heCh1LDApK2EseD1adShmKSxiPWMuc2VsZWN0QWxsKCIuZG9tYWluIikuZGF0YShbMF0pLF89KGIuZW50ZXIoKS5hcHBlbmQoInBhdGgiKS5hdHRyKCJjbGFzcyIsImRvbWFpbiIpLG9hLnRyYW5zaXRpb24oYikpO3YuYXBwZW5kKCJsaW5lIiksdi5hcHBlbmQoInRleHQiKTt2YXIgdyxTLGssTixFPXYuc2VsZWN0KCJsaW5lIiksQT1tLnNlbGVjdCgibGluZSIpLEM9cC5zZWxlY3QoInRleHQiKS50ZXh0KGcpLHo9di5zZWxlY3QoInRleHQiKSxMPW0uc2VsZWN0KCJ0ZXh0IikscT0idG9wIj09PXJ8fCJsZWZ0Ij09PXI/LTE6MTtpZigiYm90dG9tIj09PXJ8fCJ0b3AiPT09cj8obj1uYSx3PSJ4IixrPSJ5IixTPSJ4MiIsTj0ieTIiLEMuYXR0cigiZHkiLDA+cT8iMGVtIjoiLjcxZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJtaWRkbGUiKSxfLmF0dHIoImQiLCJNIit4WzBdKyIsIitxKmkrIlYwSCIreFsxXSsiViIrcSppKSk6KG49dGEsdz0ieSIsaz0ieCIsUz0ieTIiLE49IngyIixDLmF0dHIoImR5IiwiLjMyZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLDA+cT8iZW5kIjoic3RhcnQiKSxfLmF0dHIoImQiLCJNIitxKmkrIiwiK3hbMF0rIkgwViIreFsxXSsiSCIrcSppKSksRS5hdHRyKE4scSp1KSx6LmF0dHIoayxxKk0pLEEuYXR0cihTLDApLmF0dHIoTixxKnUpLEwuYXR0cih3LDApLmF0dHIoayxxKk0pLGYucmFuZ2VCYW5kKXt2YXIgVD1mLFI9VC5yYW5nZUJhbmQoKS8yO3M9Zj1mdW5jdGlvbihuKXtyZXR1cm4gVChuKStSfX1lbHNlIHMucmFuZ2VCYW5kP3M9ZjpkLmNhbGwobixmLHMpO3YuY2FsbChuLHMsZiksbS5jYWxsKG4sZixmKX0pfXZhciB0LGU9b2Euc2NhbGUubGluZWFyKCkscj1abCx1PTYsaT02LGE9MyxvPVsxMF0sbD1udWxsO3JldHVybiBuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sbi5vcmllbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCBpbiBWbD90KyIiOlpsLG4pOnJ9LG4udGlja3M9ZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1jYShhcmd1bWVudHMpLG4pOm99LG4udGlja1ZhbHVlcz1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD10LG4pOmx9LG4udGlja0Zvcm1hdD1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1lLG4pOnR9LG4udGlja1NpemU9ZnVuY3Rpb24odCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aDtyZXR1cm4gZT8odT0rdCxpPSthcmd1bWVudHNbZS0xXSxuKTp1fSxuLmlubmVyVGlja1NpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9K3Qsbik6dX0sbi5vdXRlclRpY2tTaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSt0LG4pOml9LG4udGlja1BhZGRpbmc9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9K3Qsbik6YX0sbi50aWNrU3ViZGl2aWRlPWZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGgmJm59LG59O3ZhciBabD0iYm90dG9tIixWbD17dG9wOjEscmlnaHQ6MSxib3R0b206MSxsZWZ0OjF9O29hLnN2Zy5icnVzaD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4odCl7dC5lYWNoKGZ1bmN0aW9uKCl7dmFyIHQ9b2Euc2VsZWN0KHRoaXMpLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsImFsbCIpLnN0eWxlKCItd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3IiLCJyZ2JhKDAsMCwwLDApIikub24oIm1vdXNlZG93bi5icnVzaCIsaSkub24oInRvdWNoc3RhcnQuYnJ1c2giLGkpLGE9dC5zZWxlY3RBbGwoIi5iYWNrZ3JvdW5kIikuZGF0YShbMF0pO2EuZW50ZXIoKS5hcHBlbmQoInJlY3QiKS5hdHRyKCJjbGFzcyIsImJhY2tncm91bmQiKS5zdHlsZSgidmlzaWJpbGl0eSIsImhpZGRlbiIpLnN0eWxlKCJjdXJzb3IiLCJjcm9zc2hhaXIiKSx0LnNlbGVjdEFsbCgiLmV4dGVudCIpLmRhdGEoWzBdKS5lbnRlcigpLmFwcGVuZCgicmVjdCIpLmF0dHIoImNsYXNzIiwiZXh0ZW50Iikuc3R5bGUoImN1cnNvciIsIm1vdmUiKTt2YXIgbz10LnNlbGVjdEFsbCgiLnJlc2l6ZSIpLmRhdGEodix5KTtvLmV4aXQoKS5yZW1vdmUoKSxvLmVudGVyKCkuYXBwZW5kKCJnIikuYXR0cigiY2xhc3MiLGZ1bmN0aW9uKG4pe3JldHVybiJyZXNpemUgIitufSkuc3R5bGUoImN1cnNvciIsZnVuY3Rpb24obil7cmV0dXJuIFhsW25dfSkuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsZnVuY3Rpb24obil7cmV0dXJuL1tld10kLy50ZXN0KG4pPy0zOm51bGx9KS5hdHRyKCJ5IixmdW5jdGlvbihuKXtyZXR1cm4vXltuc10vLnRlc3Qobik/LTM6bnVsbH0pLmF0dHIoIndpZHRoIiw2KS5hdHRyKCJoZWlnaHQiLDYpLnN0eWxlKCJ2aXNpYmlsaXR5IiwiaGlkZGVuIiksby5zdHlsZSgiZGlzcGxheSIsbi5lbXB0eSgpPyJub25lIjpudWxsKTt2YXIgbCxmPW9hLnRyYW5zaXRpb24odCksaD1vYS50cmFuc2l0aW9uKGEpO2MmJihsPVp1KGMpLGguYXR0cigieCIsbFswXSkuYXR0cigid2lkdGgiLGxbMV0tbFswXSkscihmKSkscyYmKGw9WnUocyksaC5hdHRyKCJ5IixsWzBdKS5hdHRyKCJoZWlnaHQiLGxbMV0tbFswXSksdShmKSksZShmKX0pfWZ1bmN0aW9uIGUobil7bi5zZWxlY3RBbGwoIi5yZXNpemUiKS5hdHRyKCJ0cmFuc2Zvcm0iLGZ1bmN0aW9uKG4pe3JldHVybiJ0cmFuc2xhdGUoIitmWysvZSQvLnRlc3QobildKyIsIitoWysvXnMvLnRlc3QobildKyIpIn0pfWZ1bmN0aW9uIHIobil7bi5zZWxlY3QoIi5leHRlbnQiKS5hdHRyKCJ4IixmWzBdKSxuLnNlbGVjdEFsbCgiLmV4dGVudCwubj5yZWN0LC5zPnJlY3QiKS5hdHRyKCJ3aWR0aCIsZlsxXS1mWzBdKX1mdW5jdGlvbiB1KG4pe24uc2VsZWN0KCIuZXh0ZW50IikuYXR0cigieSIsaFswXSksbi5zZWxlY3RBbGwoIi5leHRlbnQsLmU+cmVjdCwudz5yZWN0IikuYXR0cigiaGVpZ2h0IixoWzFdLWhbMF0pfWZ1bmN0aW9uIGkoKXtmdW5jdGlvbiBpKCl7MzI9PW9hLmV2ZW50LmtleUNvZGUmJihDfHwoTT1udWxsLExbMF0tPWZbMV0sTFsxXS09aFsxXSxDPTIpLFMoKSl9ZnVuY3Rpb24gdigpezMyPT1vYS5ldmVudC5rZXlDb2RlJiYyPT1DJiYoTFswXSs9ZlsxXSxMWzFdKz1oWzFdLEM9MCxTKCkpfWZ1bmN0aW9uIGQoKXt2YXIgbj1vYS5tb3VzZShiKSx0PSExO3gmJihuWzBdKz14WzBdLG5bMV0rPXhbMV0pLEN8fChvYS5ldmVudC5hbHRLZXk/KE18fChNPVsoZlswXStmWzFdKS8yLChoWzBdK2hbMV0pLzJdKSxMWzBdPWZbKyhuWzBdPE1bMF0pXSxMWzFdPWhbKyhuWzFdPE1bMV0pXSk6TT1udWxsKSxFJiZtKG4sYywwKSYmKHIoayksdD0hMCksQSYmbShuLHMsMSkmJih1KGspLHQ9ITApLHQmJihlKGspLHcoe3R5cGU6ImJydXNoIixtb2RlOkM/Im1vdmUiOiJyZXNpemUifSkpfWZ1bmN0aW9uIG0obix0LGUpe3ZhciByLHUsaT1adSh0KSxsPWlbMF0sYz1pWzFdLHM9TFtlXSx2PWU/aDpmLGQ9dlsxXS12WzBdO3JldHVybiBDJiYobC09cyxjLT1kK3MpLHI9KGU/cDpnKT9NYXRoLm1heChsLE1hdGgubWluKGMsbltlXSkpOm5bZV0sQz91PShyKz1zKStkOihNJiYocz1NYXRoLm1heChsLE1hdGgubWluKGMsMipNW2VdLXIpKSkscj5zPyh1PXIscj1zKTp1PXMpLHZbMF0hPXJ8fHZbMV0hPXU/KGU/bz1udWxsOmE9bnVsbCx2WzBdPXIsdlsxXT11LCEwKTp2b2lkIDB9ZnVuY3Rpb24geSgpe2QoKSxrLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsImFsbCIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IixuLmVtcHR5KCk/Im5vbmUiOm51bGwpLG9hLnNlbGVjdCgiYm9keSIpLnN0eWxlKCJjdXJzb3IiLG51bGwpLHEub24oIm1vdXNlbW92ZS5icnVzaCIsbnVsbCkub24oIm1vdXNldXAuYnJ1c2giLG51bGwpLm9uKCJ0b3VjaG1vdmUuYnJ1c2giLG51bGwpLm9uKCJ0b3VjaGVuZC5icnVzaCIsbnVsbCkub24oImtleWRvd24uYnJ1c2giLG51bGwpLm9uKCJrZXl1cC5icnVzaCIsbnVsbCkseigpLHcoe3R5cGU6ImJydXNoZW5kIn0pfXZhciBNLHgsYj10aGlzLF89b2Euc2VsZWN0KG9hLmV2ZW50LnRhcmdldCksdz1sLm9mKGIsYXJndW1lbnRzKSxrPW9hLnNlbGVjdChiKSxOPV8uZGF0dW0oKSxFPSEvXihufHMpJC8udGVzdChOKSYmYyxBPSEvXihlfHcpJC8udGVzdChOKSYmcyxDPV8uY2xhc3NlZCgiZXh0ZW50Iiksej1XKGIpLEw9b2EubW91c2UoYikscT1vYS5zZWxlY3QodChiKSkub24oImtleWRvd24uYnJ1c2giLGkpLm9uKCJrZXl1cC5icnVzaCIsdik7aWYob2EuZXZlbnQuY2hhbmdlZFRvdWNoZXM/cS5vbigidG91Y2htb3ZlLmJydXNoIixkKS5vbigidG91Y2hlbmQuYnJ1c2giLHkpOnEub24oIm1vdXNlbW92ZS5icnVzaCIsZCkub24oIm1vdXNldXAuYnJ1c2giLHkpLGsuaW50ZXJydXB0KCkuc2VsZWN0QWxsKCIqIikuaW50ZXJydXB0KCksQylMWzBdPWZbMF0tTFswXSxMWzFdPWhbMF0tTFsxXTtlbHNlIGlmKE4pe3ZhciBUPSsvdyQvLnRlc3QoTiksUj0rL15uLy50ZXN0KE4pO3g9W2ZbMS1UXS1MWzBdLGhbMS1SXS1MWzFdXSxMWzBdPWZbVF0sTFsxXT1oW1JdfWVsc2Ugb2EuZXZlbnQuYWx0S2V5JiYoTT1MLnNsaWNlKCkpO2suc3R5bGUoInBvaW50ZXItZXZlbnRzIiwibm9uZSIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IixudWxsKSxvYS5zZWxlY3QoImJvZHkiKS5zdHlsZSgiY3Vyc29yIixfLnN0eWxlKCJjdXJzb3IiKSksdyh7dHlwZToiYnJ1c2hzdGFydCJ9KSxkKCl9dmFyIGEsbyxsPU4obiwiYnJ1c2hzdGFydCIsImJydXNoIiwiYnJ1c2hlbmQiKSxjPW51bGwscz1udWxsLGY9WzAsMF0saD1bMCwwXSxnPSEwLHA9ITAsdj0kbFswXTtyZXR1cm4gbi5ldmVudD1mdW5jdGlvbihuKXtuLmVhY2goZnVuY3Rpb24oKXt2YXIgbj1sLm9mKHRoaXMsYXJndW1lbnRzKSx0PXt4OmYseTpoLGk6YSxqOm99LGU9dGhpcy5fX2NoYXJ0X198fHQ7dGhpcy5fX2NoYXJ0X189dCxGbD9vYS5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpLmVhY2goInN0YXJ0LmJydXNoIixmdW5jdGlvbigpe2E9ZS5pLG89ZS5qLGY9ZS54LGg9ZS55LG4oe3R5cGU6ImJydXNoc3RhcnQifSl9KS50d2VlbigiYnJ1c2g6YnJ1c2giLGZ1bmN0aW9uKCl7dmFyIGU9eHIoZix0LngpLHI9eHIoaCx0LnkpO3JldHVybiBhPW89bnVsbCxmdW5jdGlvbih1KXtmPXQueD1lKHUpLGg9dC55PXIodSksbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KX19KS5lYWNoKCJlbmQuYnJ1c2giLGZ1bmN0aW9uKCl7YT10Lmksbz10Lmosbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KSxuKHt0eXBlOiJicnVzaGVuZCJ9KX0pOihuKHt0eXBlOiJicnVzaHN0YXJ0In0pLG4oe3R5cGU6ImJydXNoIixtb2RlOiJyZXNpemUifSksbih7dHlwZToiYnJ1c2hlbmQifSkpfSl9LG4ueD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz10LHY9JGxbIWM8PDF8IXNdLG4pOmN9LG4ueT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz10LHY9JGxbIWM8PDF8IXNdLG4pOnN9LG4uY2xhbXA9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGMmJnM/KGc9ISF0WzBdLHA9ISF0WzFdKTpjP2c9ISF0OnMmJihwPSEhdCksbik6YyYmcz9bZyxwXTpjP2c6cz9wOm51bGx9LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3ZhciBlLHIsdSxpLGw7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGMmJihlPXRbMF0scj10WzFdLHMmJihlPWVbMF0scj1yWzBdKSxhPVtlLHJdLGMuaW52ZXJ0JiYoZT1jKGUpLHI9YyhyKSksZT5yJiYobD1lLGU9cixyPWwpLChlIT1mWzBdfHxyIT1mWzFdKSYmKGY9W2Uscl0pKSxzJiYodT10WzBdLGk9dFsxXSxjJiYodT11WzFdLGk9aVsxXSksbz1bdSxpXSxzLmludmVydCYmKHU9cyh1KSxpPXMoaSkpLHU+aSYmKGw9dSx1PWksaT1sKSwodSE9aFswXXx8aSE9aFsxXSkmJihoPVt1LGldKSksbik6KGMmJihhPyhlPWFbMF0scj1hWzFdKTooZT1mWzBdLHI9ZlsxXSxjLmludmVydCYmKGU9Yy5pbnZlcnQoZSkscj1jLmludmVydChyKSksZT5yJiYobD1lLGU9cixyPWwpKSkscyYmKG8/KHU9b1swXSxpPW9bMV0pOih1PWhbMF0saT1oWzFdLHMuaW52ZXJ0JiYodT1zLmludmVydCh1KSxpPXMuaW52ZXJ0KGkpKSx1PmkmJihsPXUsdT1pLGk9bCkpKSxjJiZzP1tbZSx1XSxbcixpXV06Yz9bZSxyXTpzJiZbdSxpXSl9LG4uY2xlYXI9ZnVuY3Rpb24oKXtyZXR1cm4gbi5lbXB0eSgpfHwoZj1bMCwwXSxoPVswLDBdLGE9bz1udWxsKSxufSxuLmVtcHR5PWZ1bmN0aW9uKCl7cmV0dXJuISFjJiZmWzBdPT1mWzFdfHwhIXMmJmhbMF09PWhbMV19LG9hLnJlYmluZChuLGwsIm9uIil9O3ZhciBYbD17bjoibnMtcmVzaXplIixlOiJldy1yZXNpemUiLHM6Im5zLXJlc2l6ZSIsdzoiZXctcmVzaXplIixudzoibndzZS1yZXNpemUiLG5lOiJuZXN3LXJlc2l6ZSIsc2U6Im53c2UtcmVzaXplIixzdzoibmVzdy1yZXNpemUifSwkbD1bWyJuIiwiZSIsInMiLCJ3IiwibnciLCJuZSIsInNlIiwic3ciXSxbImUiLCJ3Il0sWyJuIiwicyJdLFtdXSxCbD1oby5mb3JtYXQ9TW8udGltZUZvcm1hdCxXbD1CbC51dGMsSmw9V2woIiVZLSVtLSVkVCVIOiVNOiVTLiVMWiIpO0JsLmlzbz1EYXRlLnByb3RvdHlwZS50b0lTT1N0cmluZyYmK25ldyBEYXRlKCIyMDAwLTAxLTAxVDAwOjAwOjAwLjAwMFoiKT9lYTpKbCxlYS5wYXJzZT1mdW5jdGlvbihuKXt2YXIgdD1uZXcgRGF0ZShuKTtyZXR1cm4gaXNOYU4odCk/bnVsbDp0fSxlYS50b1N0cmluZz1KbC50b1N0cmluZyxoby5zZWNvbmQ9T24oZnVuY3Rpb24obil7cmV0dXJuIG5ldyBnbygxZTMqTWF0aC5mbG9vcihuLzFlMykpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSsxZTMqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFNlY29uZHMoKX0pLGhvLnNlY29uZHM9aG8uc2Vjb25kLnJhbmdlLGhvLnNlY29uZHMudXRjPWhvLnNlY29uZC51dGMucmFuZ2UsaG8ubWludXRlPU9uKGZ1bmN0aW9uKG4pe3JldHVybiBuZXcgZ28oNmU0Kk1hdGguZmxvb3Iobi82ZTQpKX0sZnVuY3Rpb24obix0KXtuLnNldFRpbWUobi5nZXRUaW1lKCkrNmU0Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaW51dGVzKCl9KSxoby5taW51dGVzPWhvLm1pbnV0ZS5yYW5nZSxoby5taW51dGVzLnV0Yz1oby5taW51dGUudXRjLnJhbmdlLGhvLmhvdXI9T24oZnVuY3Rpb24obil7dmFyIHQ9bi5nZXRUaW1lem9uZU9mZnNldCgpLzYwO3JldHVybiBuZXcgZ28oMzZlNSooTWF0aC5mbG9vcihuLzM2ZTUtdCkrdCkpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSszNmU1Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRIb3VycygpfSksaG8uaG91cnM9aG8uaG91ci5yYW5nZSxoby5ob3Vycy51dGM9aG8uaG91ci51dGMucmFuZ2UsaG8ubW9udGg9T24oZnVuY3Rpb24obil7cmV0dXJuIG49aG8uZGF5KG4pLG4uc2V0RGF0ZSgxKSxufSxmdW5jdGlvbihuLHQpe24uc2V0TW9udGgobi5nZXRNb250aCgpK3QpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNb250aCgpfSksaG8ubW9udGhzPWhvLm1vbnRoLnJhbmdlLGhvLm1vbnRocy51dGM9aG8ubW9udGgudXRjLnJhbmdlO3ZhciBHbD1bMWUzLDVlMywxNWUzLDNlNCw2ZTQsM2U1LDllNSwxOGU1LDM2ZTUsMTA4ZTUsMjE2ZTUsNDMyZTUsODY0ZTUsMTcyOGU1LDYwNDhlNSwyNTkyZTYsNzc3NmU2LDMxNTM2ZTZdLEtsPVtbaG8uc2Vjb25kLDFdLFtoby5zZWNvbmQsNV0sW2hvLnNlY29uZCwxNV0sW2hvLnNlY29uZCwzMF0sW2hvLm1pbnV0ZSwxXSxbaG8ubWludXRlLDVdLFtoby5taW51dGUsMTVdLFtoby5taW51dGUsMzBdLFtoby5ob3VyLDFdLFtoby5ob3VyLDNdLFtoby5ob3VyLDZdLFtoby5ob3VyLDEyXSxbaG8uZGF5LDFdLFtoby5kYXksMl0sW2hvLndlZWssMV0sW2hvLm1vbnRoLDFdLFtoby5tb250aCwzXSxbaG8ueWVhciwxXV0sUWw9QmwubXVsdGkoW1siLiVMIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaWxsaXNlY29uZHMoKX1dLFsiOiVTIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRTZWNvbmRzKCl9XSxbIiVJOiVNIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaW51dGVzKCl9XSxbIiVJICVwIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRIb3VycygpfV0sWyIlYSAlZCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF5KCkmJjEhPW4uZ2V0RGF0ZSgpfV0sWyIlYiAlZCIsZnVuY3Rpb24obil7cmV0dXJuIDEhPW4uZ2V0RGF0ZSgpfV0sWyIlQiIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0TW9udGgoKX1dLFsiJVkiLHp0XV0pLG5jPXtyYW5nZTpmdW5jdGlvbihuLHQsZSl7cmV0dXJuIG9hLnJhbmdlKE1hdGguY2VpbChuL2UpKmUsK3QsZSkubWFwKHVhKX0sZmxvb3I6eSxjZWlsOnl9O0tsLnllYXI9aG8ueWVhcixoby5zY2FsZT1mdW5jdGlvbigpe3JldHVybiByYShvYS5zY2FsZS5saW5lYXIoKSxLbCxRbCl9O3ZhciB0Yz1LbC5tYXAoZnVuY3Rpb24obil7cmV0dXJuW25bMF0udXRjLG5bMV1dfSksZWM9V2wubXVsdGkoW1siLiVMIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENNaWxsaXNlY29uZHMoKX1dLFsiOiVTIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENTZWNvbmRzKCl9XSxbIiVJOiVNIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENNaW51dGVzKCl9XSxbIiVJICVwIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENIb3VycygpfV0sWyIlYSAlZCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDRGF5KCkmJjEhPW4uZ2V0VVRDRGF0ZSgpfV0sWyIlYiAlZCIsZnVuY3Rpb24obil7cmV0dXJuIDEhPW4uZ2V0VVRDRGF0ZSgpfV0sWyIlQiIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDTW9udGgoKX1dLFsiJVkiLHp0XV0pO3RjLnllYXI9aG8ueWVhci51dGMsaG8uc2NhbGUudXRjPWZ1bmN0aW9uKCl7cmV0dXJuIHJhKG9hLnNjYWxlLmxpbmVhcigpLHRjLGVjKX0sb2EudGV4dD1BbihmdW5jdGlvbihuKXtyZXR1cm4gbi5yZXNwb25zZVRleHR9KSxvYS5qc29uPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIENuKG4sImFwcGxpY2F0aW9uL2pzb24iLGlhLHQpfSxvYS5odG1sPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIENuKG4sInRleHQvaHRtbCIsYWEsdCl9LG9hLnhtbD1BbihmdW5jdGlvbihuKXtyZXR1cm4gbi5yZXNwb25zZVhNTH0pLCJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/KHRoaXMuZDM9b2EsZGVmaW5lKG9hKSk6Im9iamVjdCI9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPW9hOnRoaXMuZDM9b2F9KCk7"></script>
<script src="data:application/x-javascript;base64,Ly8gZDMudGlwCi8vIENvcHlyaWdodCAoYykgMjAxMyBKdXN0aW4gUGFsbWVyCi8vCi8vIFRvb2x0aXBzIGZvciBkMy5qcyBTVkcgdmlzdWFsaXphdGlvbnMKCi8vIFB1YmxpYyAtIGNvbnRydWN0cyBhIG5ldyB0b29sdGlwCi8vCi8vIFJldHVybnMgYSB0aXAKZDMudGlwID0gZnVuY3Rpb24oKSB7CiAgdmFyIGRpcmVjdGlvbiA9IGQzX3RpcF9kaXJlY3Rpb24sCiAgICAgIG9mZnNldCAgICA9IGQzX3RpcF9vZmZzZXQsCiAgICAgIGh0bWwgICAgICA9IGQzX3RpcF9odG1sLAogICAgICBub2RlICAgICAgPSBpbml0Tm9kZSgpLAogICAgICBzdmcgICAgICAgPSBudWxsLAogICAgICBwb2ludCAgICAgPSBudWxsLAogICAgICB0YXJnZXQgICAgPSBudWxsCgogIGZ1bmN0aW9uIHRpcCh2aXMpIHsKICAgIHN2ZyA9IGdldFNWR05vZGUodmlzKQogICAgcG9pbnQgPSBzdmcuY3JlYXRlU1ZHUG9pbnQoKQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub2RlKQogIH0KCiAgLy8gUHVibGljIC0gc2hvdyB0aGUgdG9vbHRpcCBvbiB0aGUgc2NyZWVuCiAgLy8KICAvLyBSZXR1cm5zIGEgdGlwCiAgdGlwLnNob3cgPSBmdW5jdGlvbigpIHsKICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKQogICAgaWYoYXJnc1thcmdzLmxlbmd0aCAtIDFdIGluc3RhbmNlb2YgU1ZHRWxlbWVudCkgdGFyZ2V0ID0gYXJncy5wb3AoKQoKICAgIHZhciBjb250ZW50ID0gaHRtbC5hcHBseSh0aGlzLCBhcmdzKSwKICAgICAgICBwb2Zmc2V0ID0gb2Zmc2V0LmFwcGx5KHRoaXMsIGFyZ3MpLAogICAgICAgIGRpciAgICAgPSBkaXJlY3Rpb24uYXBwbHkodGhpcywgYXJncyksCiAgICAgICAgbm9kZWwgICA9IGQzLnNlbGVjdChub2RlKSwgaSA9IDAsCiAgICAgICAgY29vcmRzCgogICAgbm9kZWwuaHRtbChjb250ZW50KQogICAgICAuc3R5bGUoeyBvcGFjaXR5OiAxLCAncG9pbnRlci1ldmVudHMnOiAnYWxsJyB9KQoKICAgIHdoaWxlKGktLSkgbm9kZWwuY2xhc3NlZChkaXJlY3Rpb25zW2ldLCBmYWxzZSkKICAgIGNvb3JkcyA9IGRpcmVjdGlvbl9jYWxsYmFja3MuZ2V0KGRpcikuYXBwbHkodGhpcykKICAgIG5vZGVsLmNsYXNzZWQoZGlyLCB0cnVlKS5zdHlsZSh7CiAgICAgIHRvcDogKGNvb3Jkcy50b3AgKyAgcG9mZnNldFswXSkgKyAncHgnLAogICAgICBsZWZ0OiAoY29vcmRzLmxlZnQgKyBwb2Zmc2V0WzFdKSArICdweCcKICAgIH0pCgogICAgcmV0dXJuIHRpcAogIH0KCiAgLy8gUHVibGljIC0gaGlkZSB0aGUgdG9vbHRpcAogIC8vCiAgLy8gUmV0dXJucyBhIHRpcAogIHRpcC5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICBub2RlbCA9IGQzLnNlbGVjdChub2RlKQogICAgbm9kZWwuc3R5bGUoeyBvcGFjaXR5OiAwLCAncG9pbnRlci1ldmVudHMnOiAnbm9uZScgfSkKICAgIHJldHVybiB0aXAKICB9CgogIC8vIFB1YmxpYzogUHJveHkgYXR0ciBjYWxscyB0byB0aGUgZDMgdGlwIGNvbnRhaW5lci4gIFNldHMgb3IgZ2V0cyBhdHRyaWJ1dGUgdmFsdWUuCiAgLy8KICAvLyBuIC0gbmFtZSBvZiB0aGUgYXR0cmlidXRlCiAgLy8gdiAtIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUKICAvLwogIC8vIFJldHVybnMgdGlwIG9yIGF0dHJpYnV0ZSB2YWx1ZQogIHRpcC5hdHRyID0gZnVuY3Rpb24obiwgdikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyICYmIHR5cGVvZiBuID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gZDMuc2VsZWN0KG5vZGUpLmF0dHIobikKICAgIH0gZWxzZSB7CiAgICAgIHZhciBhcmdzID0gIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykKICAgICAgZDMuc2VsZWN0aW9uLnByb3RvdHlwZS5hdHRyLmFwcGx5KGQzLnNlbGVjdChub2RlKSwgYXJncykKICAgIH0KCiAgICByZXR1cm4gdGlwCiAgfQoKICAvLyBQdWJsaWM6IFByb3h5IHN0eWxlIGNhbGxzIHRvIHRoZSBkMyB0aXAgY29udGFpbmVyLiAgU2V0cyBvciBnZXRzIGEgc3R5bGUgdmFsdWUuCiAgLy8KICAvLyBuIC0gbmFtZSBvZiB0aGUgcHJvcGVydHkKICAvLyB2IC0gdmFsdWUgb2YgdGhlIHByb3BlcnR5CiAgLy8KICAvLyBSZXR1cm5zIHRpcCBvciBzdHlsZSBwcm9wZXJ0eSB2YWx1ZQogIHRpcC5zdHlsZSA9IGZ1bmN0aW9uKG4sIHYpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMiAmJiB0eXBlb2YgbiA9PT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIGQzLnNlbGVjdChub2RlKS5zdHlsZShuKQogICAgfSBlbHNlIHsKICAgICAgdmFyIGFyZ3MgPSAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKQogICAgICBkMy5zZWxlY3Rpb24ucHJvdG90eXBlLnN0eWxlLmFwcGx5KGQzLnNlbGVjdChub2RlKSwgYXJncykKICAgIH0KCiAgICByZXR1cm4gdGlwCiAgfQoKICAvLyBQdWJsaWM6IFNldCBvciBnZXQgdGhlIGRpcmVjdGlvbiBvZiB0aGUgdG9vbHRpcAogIC8vCiAgLy8gdiAtIE9uZSBvZiBuKG5vcnRoKSwgcyhzb3V0aCksIGUoZWFzdCksIG9yIHcod2VzdCksIG53KG5vcnRod2VzdCksCiAgLy8gICAgIHN3KHNvdXRod2VzdCksIG5lKG5vcnRoZWFzdCkgb3Igc2Uoc291dGhlYXN0KQogIC8vCiAgLy8gUmV0dXJucyB0aXAgb3IgZGlyZWN0aW9uCiAgdGlwLmRpcmVjdGlvbiA9IGZ1bmN0aW9uKHYpIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRpcmVjdGlvbgogICAgZGlyZWN0aW9uID0gdiA9PSBudWxsID8gdiA6IGQzLmZ1bmN0b3IodikKCiAgICByZXR1cm4gdGlwCiAgfQoKICAvLyBQdWJsaWM6IFNldHMgb3IgZ2V0cyB0aGUgb2Zmc2V0IG9mIHRoZSB0aXAKICAvLwogIC8vIHYgLSBBcnJheSBvZiBbeCwgeV0gb2Zmc2V0CiAgLy8KICAvLyBSZXR1cm5zIG9mZnNldCBvcgogIHRpcC5vZmZzZXQgPSBmdW5jdGlvbih2KSB7CiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvZmZzZXQKICAgIG9mZnNldCA9IHYgPT0gbnVsbCA/IHYgOiBkMy5mdW5jdG9yKHYpCgogICAgcmV0dXJuIHRpcAogIH0KCiAgLy8gUHVibGljOiBzZXRzIG9yIGdldHMgdGhlIGh0bWwgdmFsdWUgb2YgdGhlIHRvb2x0aXAKICAvLwogIC8vIHYgLSBTdHJpbmcgdmFsdWUgb2YgdGhlIHRpcAogIC8vCiAgLy8gUmV0dXJucyBodG1sIHZhbHVlIG9yIHRpcAogIHRpcC5odG1sID0gZnVuY3Rpb24odikgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gaHRtbAogICAgaHRtbCA9IHYgPT0gbnVsbCA/IHYgOiBkMy5mdW5jdG9yKHYpCgogICAgcmV0dXJuIHRpcAogIH0KCiAgZnVuY3Rpb24gZDNfdGlwX2RpcmVjdGlvbigpIHsgcmV0dXJuICduJyB9CiAgZnVuY3Rpb24gZDNfdGlwX29mZnNldCgpIHsgcmV0dXJuIFswLCAwXSB9CiAgZnVuY3Rpb24gZDNfdGlwX2h0bWwoKSB7IHJldHVybiAnICcgfQoKICB2YXIgZGlyZWN0aW9uX2NhbGxiYWNrcyA9IGQzLm1hcCh7CiAgICBuOiAgZGlyZWN0aW9uX24sCiAgICBzOiAgZGlyZWN0aW9uX3MsCiAgICBlOiAgZGlyZWN0aW9uX2UsCiAgICB3OiAgZGlyZWN0aW9uX3csCiAgICBudzogZGlyZWN0aW9uX253LAogICAgbmU6IGRpcmVjdGlvbl9uZSwKICAgIHN3OiBkaXJlY3Rpb25fc3csCiAgICBzZTogZGlyZWN0aW9uX3NlCiAgfSksCgogIGRpcmVjdGlvbnMgPSBkaXJlY3Rpb25fY2FsbGJhY2tzLmtleXMoKQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fbigpIHsKICAgIHZhciBiYm94ID0gZ2V0U2NyZWVuQkJveCgpCiAgICByZXR1cm4gewogICAgICB0b3A6ICBiYm94Lm4ueSAtIG5vZGUub2Zmc2V0SGVpZ2h0LAogICAgICBsZWZ0OiBiYm94Lm4ueCAtIG5vZGUub2Zmc2V0V2lkdGggLyAyCiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fcygpIHsKICAgIHZhciBiYm94ID0gZ2V0U2NyZWVuQkJveCgpCiAgICByZXR1cm4gewogICAgICB0b3A6ICBiYm94LnMueSwKICAgICAgbGVmdDogYmJveC5zLnggLSBub2RlLm9mZnNldFdpZHRoIC8gMgogICAgfQogIH0KCiAgZnVuY3Rpb24gZGlyZWN0aW9uX2UoKSB7CiAgICB2YXIgYmJveCA9IGdldFNjcmVlbkJCb3goKQogICAgcmV0dXJuIHsKICAgICAgdG9wOiAgYmJveC5lLnkgLSBub2RlLm9mZnNldEhlaWdodCAvIDIsCiAgICAgIGxlZnQ6IGJib3guZS54CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fdygpIHsKICAgIHZhciBiYm94ID0gZ2V0U2NyZWVuQkJveCgpCiAgICByZXR1cm4gewogICAgICB0b3A6ICBiYm94LncueSAtIG5vZGUub2Zmc2V0SGVpZ2h0IC8gMiwKICAgICAgbGVmdDogYmJveC53LnggLSBub2RlLm9mZnNldFdpZHRoCiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fbncoKSB7CiAgICB2YXIgYmJveCA9IGdldFNjcmVlbkJCb3goKQogICAgcmV0dXJuIHsKICAgICAgdG9wOiAgYmJveC5udy55IC0gbm9kZS5vZmZzZXRIZWlnaHQsCiAgICAgIGxlZnQ6IGJib3gubncueCAtIG5vZGUub2Zmc2V0V2lkdGgKICAgIH0KICB9CgogIGZ1bmN0aW9uIGRpcmVjdGlvbl9uZSgpIHsKICAgIHZhciBiYm94ID0gZ2V0U2NyZWVuQkJveCgpCiAgICByZXR1cm4gewogICAgICB0b3A6ICBiYm94Lm5lLnkgLSBub2RlLm9mZnNldEhlaWdodCwKICAgICAgbGVmdDogYmJveC5uZS54CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fc3coKSB7CiAgICB2YXIgYmJveCA9IGdldFNjcmVlbkJCb3goKQogICAgcmV0dXJuIHsKICAgICAgdG9wOiAgYmJveC5zdy55LAogICAgICBsZWZ0OiBiYm94LnN3LnggLSBub2RlLm9mZnNldFdpZHRoCiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fc2UoKSB7CiAgICB2YXIgYmJveCA9IGdldFNjcmVlbkJCb3goKQogICAgcmV0dXJuIHsKICAgICAgdG9wOiAgYmJveC5zZS55LAogICAgICBsZWZ0OiBiYm94LmUueAogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdE5vZGUoKSB7CiAgICB2YXIgbm9kZSA9IGQzLnNlbGVjdChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkKICAgIG5vZGUuc3R5bGUoewogICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgb3BhY2l0eTogMCwKICAgICAgcG9pbnRlckV2ZW50czogJ25vbmUnLAogICAgICBib3hTaXppbmc6ICdib3JkZXItYm94JwogICAgfSkKCiAgICByZXR1cm4gbm9kZS5ub2RlKCkKICB9CgogIGZ1bmN0aW9uIGdldFNWR05vZGUoZWwpIHsKICAgIGVsID0gZWwubm9kZSgpCiAgICBpZihlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gJ3N2ZycpCiAgICAgIHJldHVybiBlbAoKICAgIHJldHVybiBlbC5vd25lclNWR0VsZW1lbnQKICB9CgogIC8vIFByaXZhdGUgLSBnZXRzIHRoZSBzY3JlZW4gY29vcmRpbmF0ZXMgb2YgYSBzaGFwZQogIC8vCiAgLy8gR2l2ZW4gYSBzaGFwZSBvbiB0aGUgc2NyZWVuLCB3aWxsIHJldHVybiBhbiBTVkdQb2ludCBmb3IgdGhlIGRpcmVjdGlvbnMKICAvLyBuKG5vcnRoKSwgcyhzb3V0aCksIGUoZWFzdCksIHcod2VzdCksIG5lKG5vcnRoZWFzdCksIHNlKHNvdXRoZWFzdCksIG53KG5vcnRod2VzdCksCiAgLy8gc3coc291dGh3ZXN0KS4KICAvLwogIC8vICAgICstKy0rCiAgLy8gICAgfCAgIHwKICAvLyAgICArICAgKwogIC8vICAgIHwgICB8CiAgLy8gICAgKy0rLSsKICAvLwogIC8vIFJldHVybnMgYW4gT2JqZWN0IHtuLCBzLCBlLCB3LCBudywgc3csIG5lLCBzZX0KICBmdW5jdGlvbiBnZXRTY3JlZW5CQm94KCkgewogICAgdmFyIHRhcmdldGVsICAgPSB0YXJnZXQgfHwgZDMuZXZlbnQudGFyZ2V0LAogICAgICAgIGJib3ggICAgICAgPSB7fSwKICAgICAgICBtYXRyaXggICAgID0gdGFyZ2V0ZWwuZ2V0U2NyZWVuQ1RNKCksCiAgICAgICAgdGJib3ggICAgICA9IHRhcmdldGVsLmdldEJCb3goKSwKICAgICAgICB3aWR0aCAgICAgID0gdGJib3gud2lkdGgsCiAgICAgICAgaGVpZ2h0ICAgICA9IHRiYm94LmhlaWdodCwKICAgICAgICB4ICAgICAgICAgID0gdGJib3gueCwKICAgICAgICB5ICAgICAgICAgID0gdGJib3gueSwKICAgICAgICBzY3JvbGxUb3AgID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCwKICAgICAgICBzY3JvbGxMZWZ0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0CgoKICAgIHBvaW50LnggPSB4ICsgc2Nyb2xsTGVmdAogICAgcG9pbnQueSA9IHkgKyBzY3JvbGxUb3AKICAgIGJib3gubncgPSBwb2ludC5tYXRyaXhUcmFuc2Zvcm0obWF0cml4KQogICAgcG9pbnQueCArPSB3aWR0aAogICAgYmJveC5uZSA9IHBvaW50Lm1hdHJpeFRyYW5zZm9ybShtYXRyaXgpCiAgICBwb2ludC55ICs9IGhlaWdodAogICAgYmJveC5zZSA9IHBvaW50Lm1hdHJpeFRyYW5zZm9ybShtYXRyaXgpCiAgICBwb2ludC54IC09IHdpZHRoCiAgICBiYm94LnN3ID0gcG9pbnQubWF0cml4VHJhbnNmb3JtKG1hdHJpeCkKICAgIHBvaW50LnkgLT0gaGVpZ2h0IC8gMgogICAgYmJveC53ICA9IHBvaW50Lm1hdHJpeFRyYW5zZm9ybShtYXRyaXgpCiAgICBwb2ludC54ICs9IHdpZHRoCiAgICBiYm94LmUgPSBwb2ludC5tYXRyaXhUcmFuc2Zvcm0obWF0cml4KQogICAgcG9pbnQueCAtPSB3aWR0aCAvIDIKICAgIHBvaW50LnkgLT0gaGVpZ2h0IC8gMgogICAgYmJveC5uID0gcG9pbnQubWF0cml4VHJhbnNmb3JtKG1hdHJpeCkKICAgIHBvaW50LnkgKz0gaGVpZ2h0CiAgICBiYm94LnMgPSBwb2ludC5tYXRyaXhUcmFuc2Zvcm0obWF0cml4KQoKICAgIHJldHVybiBiYm94CiAgfQoKICByZXR1cm4gdGlwCn07Cg=="></script>
<script src="data:application/x-javascript;base64,LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjIuMS40CiAqIGh0dHA6Ly9qcXVlcnkuY29tLwogKgogKiBJbmNsdWRlcyBTaXp6bGUuanMKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICoKICogQ29weXJpZ2h0IDIwMDUsIDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBEYXRlOiAyMDE1LTA0LTI4VDE2OjAxWgogKi8KCihmdW5jdGlvbiggZ2xvYmFsLCBmYWN0b3J5ICkgewoKCWlmICggdHlwZW9mIG1vZHVsZSA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIG1vZHVsZS5leHBvcnRzID09PSAib2JqZWN0IiApIHsKCQkvLyBGb3IgQ29tbW9uSlMgYW5kIENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHdoZXJlIGEgcHJvcGVyIGB3aW5kb3dgCgkJLy8gaXMgcHJlc2VudCwgZXhlY3V0ZSB0aGUgZmFjdG9yeSBhbmQgZ2V0IGpRdWVyeS4KCQkvLyBGb3IgZW52aXJvbm1lbnRzIHRoYXQgZG8gbm90IGhhdmUgYSBgd2luZG93YCB3aXRoIGEgYGRvY3VtZW50YAoJCS8vIChzdWNoIGFzIE5vZGUuanMpLCBleHBvc2UgYSBmYWN0b3J5IGFzIG1vZHVsZS5leHBvcnRzLgoJCS8vIFRoaXMgYWNjZW50dWF0ZXMgdGhlIG5lZWQgZm9yIHRoZSBjcmVhdGlvbiBvZiBhIHJlYWwgYHdpbmRvd2AuCgkJLy8gZS5nLiB2YXIgalF1ZXJ5ID0gcmVxdWlyZSgianF1ZXJ5Iikod2luZG93KTsKCQkvLyBTZWUgdGlja2V0ICMxNDU0OSBmb3IgbW9yZSBpbmZvLgoJCW1vZHVsZS5leHBvcnRzID0gZ2xvYmFsLmRvY3VtZW50ID8KCQkJZmFjdG9yeSggZ2xvYmFsLCB0cnVlICkgOgoJCQlmdW5jdGlvbiggdyApIHsKCQkJCWlmICggIXcuZG9jdW1lbnQgKSB7CgkJCQkJdGhyb3cgbmV3IEVycm9yKCAialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudCIgKTsKCQkJCX0KCQkJCXJldHVybiBmYWN0b3J5KCB3ICk7CgkJCX07Cgl9IGVsc2UgewoJCWZhY3RvcnkoIGdsb2JhbCApOwoJfQoKLy8gUGFzcyB0aGlzIGlmIHdpbmRvdyBpcyBub3QgZGVmaW5lZCB5ZXQKfSh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHRoaXMsIGZ1bmN0aW9uKCB3aW5kb3csIG5vR2xvYmFsICkgewoKLy8gU3VwcG9ydDogRmlyZWZveCAxOCsKLy8gQ2FuJ3QgYmUgaW4gc3RyaWN0IG1vZGUsIHNldmVyYWwgbGlicyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQovLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkKLy8KCnZhciBhcnIgPSBbXTsKCnZhciBzbGljZSA9IGFyci5zbGljZTsKCnZhciBjb25jYXQgPSBhcnIuY29uY2F0OwoKdmFyIHB1c2ggPSBhcnIucHVzaDsKCnZhciBpbmRleE9mID0gYXJyLmluZGV4T2Y7Cgp2YXIgY2xhc3MydHlwZSA9IHt9OwoKdmFyIHRvU3RyaW5nID0gY2xhc3MydHlwZS50b1N0cmluZzsKCnZhciBoYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5OwoKdmFyIHN1cHBvcnQgPSB7fTsKCgoKdmFyCgkvLyBVc2UgdGhlIGNvcnJlY3QgZG9jdW1lbnQgYWNjb3JkaW5nbHkgd2l0aCB3aW5kb3cgYXJndW1lbnQgKHNhbmRib3gpCglkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudCwKCgl2ZXJzaW9uID0gIjIuMS40IiwKCgkvLyBEZWZpbmUgYSBsb2NhbCBjb3B5IG9mIGpRdWVyeQoJalF1ZXJ5ID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCS8vIFRoZSBqUXVlcnkgb2JqZWN0IGlzIGFjdHVhbGx5IGp1c3QgdGhlIGluaXQgY29uc3RydWN0b3IgJ2VuaGFuY2VkJwoJCS8vIE5lZWQgaW5pdCBpZiBqUXVlcnkgaXMgY2FsbGVkIChqdXN0IGFsbG93IGVycm9yIHRvIGJlIHRocm93biBpZiBub3QgaW5jbHVkZWQpCgkJcmV0dXJuIG5ldyBqUXVlcnkuZm4uaW5pdCggc2VsZWN0b3IsIGNvbnRleHQgKTsKCX0sCgoJLy8gU3VwcG9ydDogQW5kcm9pZDw0LjEKCS8vIE1ha2Ugc3VyZSB3ZSB0cmltIEJPTSBhbmQgTkJTUAoJcnRyaW0gPSAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2csCgoJLy8gTWF0Y2hlcyBkYXNoZWQgc3RyaW5nIGZvciBjYW1lbGl6aW5nCglybXNQcmVmaXggPSAvXi1tcy0vLAoJcmRhc2hBbHBoYSA9IC8tKFtcZGEtel0pL2dpLAoKCS8vIFVzZWQgYnkgalF1ZXJ5LmNhbWVsQ2FzZSBhcyBjYWxsYmFjayB0byByZXBsYWNlKCkKCWZjYW1lbENhc2UgPSBmdW5jdGlvbiggYWxsLCBsZXR0ZXIgKSB7CgkJcmV0dXJuIGxldHRlci50b1VwcGVyQ2FzZSgpOwoJfTsKCmpRdWVyeS5mbiA9IGpRdWVyeS5wcm90b3R5cGUgPSB7CgkvLyBUaGUgY3VycmVudCB2ZXJzaW9uIG9mIGpRdWVyeSBiZWluZyB1c2VkCglqcXVlcnk6IHZlcnNpb24sCgoJY29uc3RydWN0b3I6IGpRdWVyeSwKCgkvLyBTdGFydCB3aXRoIGFuIGVtcHR5IHNlbGVjdG9yCglzZWxlY3RvcjogIiIsCgoJLy8gVGhlIGRlZmF1bHQgbGVuZ3RoIG9mIGEgalF1ZXJ5IG9iamVjdCBpcyAwCglsZW5ndGg6IDAsCgoJdG9BcnJheTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHNsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXkKCWdldDogZnVuY3Rpb24oIG51bSApIHsKCQlyZXR1cm4gbnVtICE9IG51bGwgPwoKCQkJLy8gUmV0dXJuIGp1c3QgdGhlIG9uZSBlbGVtZW50IGZyb20gdGhlIHNldAoJCQkoIG51bSA8IDAgPyB0aGlzWyBudW0gKyB0aGlzLmxlbmd0aCBdIDogdGhpc1sgbnVtIF0gKSA6CgoJCQkvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyBpbiBhIGNsZWFuIGFycmF5CgkJCXNsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gVGFrZSBhbiBhcnJheSBvZiBlbGVtZW50cyBhbmQgcHVzaCBpdCBvbnRvIHRoZSBzdGFjawoJLy8gKHJldHVybmluZyB0aGUgbmV3IG1hdGNoZWQgZWxlbWVudCBzZXQpCglwdXNoU3RhY2s6IGZ1bmN0aW9uKCBlbGVtcyApIHsKCgkJLy8gQnVpbGQgYSBuZXcgalF1ZXJ5IG1hdGNoZWQgZWxlbWVudCBzZXQKCQl2YXIgcmV0ID0galF1ZXJ5Lm1lcmdlKCB0aGlzLmNvbnN0cnVjdG9yKCksIGVsZW1zICk7CgoJCS8vIEFkZCB0aGUgb2xkIG9iamVjdCBvbnRvIHRoZSBzdGFjayAoYXMgYSByZWZlcmVuY2UpCgkJcmV0LnByZXZPYmplY3QgPSB0aGlzOwoJCXJldC5jb250ZXh0ID0gdGhpcy5jb250ZXh0OwoKCQkvLyBSZXR1cm4gdGhlIG5ld2x5LWZvcm1lZCBlbGVtZW50IHNldAoJCXJldHVybiByZXQ7Cgl9LAoKCS8vIEV4ZWN1dGUgYSBjYWxsYmFjayBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuCgkvLyAoWW91IGNhbiBzZWVkIHRoZSBhcmd1bWVudHMgd2l0aCBhbiBhcnJheSBvZiBhcmdzLCBidXQgdGhpcyBpcwoJLy8gb25seSB1c2VkIGludGVybmFsbHkuKQoJZWFjaDogZnVuY3Rpb24oIGNhbGxiYWNrLCBhcmdzICkgewoJCXJldHVybiBqUXVlcnkuZWFjaCggdGhpcywgY2FsbGJhY2ssIGFyZ3MgKTsKCX0sCgoJbWFwOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0pKTsKCX0sCgoJc2xpY2U6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggc2xpY2UuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApICk7Cgl9LAoKCWZpcnN0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lcSggMCApOwoJfSwKCglsYXN0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lcSggLTEgKTsKCX0sCgoJZXE6IGZ1bmN0aW9uKCBpICkgewoJCXZhciBsZW4gPSB0aGlzLmxlbmd0aCwKCQkJaiA9ICtpICsgKCBpIDwgMCA/IGxlbiA6IDAgKTsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGogPj0gMCAmJiBqIDwgbGVuID8gWyB0aGlzW2pdIF0gOiBbXSApOwoJfSwKCgllbmQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5jb25zdHJ1Y3RvcihudWxsKTsKCX0sCgoJLy8gRm9yIGludGVybmFsIHVzZSBvbmx5LgoJLy8gQmVoYXZlcyBsaWtlIGFuIEFycmF5J3MgbWV0aG9kLCBub3QgbGlrZSBhIGpRdWVyeSBtZXRob2QuCglwdXNoOiBwdXNoLAoJc29ydDogYXJyLnNvcnQsCglzcGxpY2U6IGFyci5zcGxpY2UKfTsKCmpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7Cgl2YXIgb3B0aW9ucywgbmFtZSwgc3JjLCBjb3B5LCBjb3B5SXNBcnJheSwgY2xvbmUsCgkJdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAoJCWkgPSAxLAoJCWxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCgkJZGVlcCA9IGZhbHNlOwoKCS8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb24KCWlmICggdHlwZW9mIHRhcmdldCA9PT0gImJvb2xlYW4iICkgewoJCWRlZXAgPSB0YXJnZXQ7CgoJCS8vIFNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKCQl0YXJnZXQgPSBhcmd1bWVudHNbIGkgXSB8fCB7fTsKCQlpKys7Cgl9CgoJLy8gSGFuZGxlIGNhc2Ugd2hlbiB0YXJnZXQgaXMgYSBzdHJpbmcgb3Igc29tZXRoaW5nIChwb3NzaWJsZSBpbiBkZWVwIGNvcHkpCglpZiAoIHR5cGVvZiB0YXJnZXQgIT09ICJvYmplY3QiICYmICFqUXVlcnkuaXNGdW5jdGlvbih0YXJnZXQpICkgewoJCXRhcmdldCA9IHt9OwoJfQoKCS8vIEV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZAoJaWYgKCBpID09PSBsZW5ndGggKSB7CgkJdGFyZ2V0ID0gdGhpczsKCQlpLS07Cgl9CgoJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJLy8gT25seSBkZWFsIHdpdGggbm9uLW51bGwvdW5kZWZpbmVkIHZhbHVlcwoJCWlmICggKG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSkgIT0gbnVsbCApIHsKCQkJLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdAoJCQlmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJCQlzcmMgPSB0YXJnZXRbIG5hbWUgXTsKCQkJCWNvcHkgPSBvcHRpb25zWyBuYW1lIF07CgoJCQkJLy8gUHJldmVudCBuZXZlci1lbmRpbmcgbG9vcAoJCQkJaWYgKCB0YXJnZXQgPT09IGNvcHkgKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgoJCQkJLy8gUmVjdXJzZSBpZiB3ZSdyZSBtZXJnaW5nIHBsYWluIG9iamVjdHMgb3IgYXJyYXlzCgkJCQlpZiAoIGRlZXAgJiYgY29weSAmJiAoIGpRdWVyeS5pc1BsYWluT2JqZWN0KGNvcHkpIHx8IChjb3B5SXNBcnJheSA9IGpRdWVyeS5pc0FycmF5KGNvcHkpKSApICkgewoJCQkJCWlmICggY29weUlzQXJyYXkgKSB7CgkJCQkJCWNvcHlJc0FycmF5ID0gZmFsc2U7CgkJCQkJCWNsb25lID0gc3JjICYmIGpRdWVyeS5pc0FycmF5KHNyYykgPyBzcmMgOiBbXTsKCgkJCQkJfSBlbHNlIHsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3Qoc3JjKSA/IHNyYyA6IHt9OwoJCQkJCX0KCgkJCQkJLy8gTmV2ZXIgbW92ZSBvcmlnaW5hbCBvYmplY3RzLCBjbG9uZSB0aGVtCgkJCQkJdGFyZ2V0WyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBkZWVwLCBjbG9uZSwgY29weSApOwoKCQkJCS8vIERvbid0IGJyaW5nIGluIHVuZGVmaW5lZCB2YWx1ZXMKCQkJCX0gZWxzZSBpZiAoIGNvcHkgIT09IHVuZGVmaW5lZCApIHsKCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGNvcHk7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBvYmplY3QKCXJldHVybiB0YXJnZXQ7Cn07CgpqUXVlcnkuZXh0ZW5kKHsKCS8vIFVuaXF1ZSBmb3IgZWFjaCBjb3B5IG9mIGpRdWVyeSBvbiB0aGUgcGFnZQoJZXhwYW5kbzogImpRdWVyeSIgKyAoIHZlcnNpb24gKyBNYXRoLnJhbmRvbSgpICkucmVwbGFjZSggL1xEL2csICIiICksCgoJLy8gQXNzdW1lIGpRdWVyeSBpcyByZWFkeSB3aXRob3V0IHRoZSByZWFkeSBtb2R1bGUKCWlzUmVhZHk6IHRydWUsCgoJZXJyb3I6IGZ1bmN0aW9uKCBtc2cgKSB7CgkJdGhyb3cgbmV3IEVycm9yKCBtc2cgKTsKCX0sCgoJbm9vcDogZnVuY3Rpb24oKSB7fSwKCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5LAoKCWlzV2luZG93OiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT09IG9iai53aW5kb3c7Cgl9LAoKCWlzTnVtZXJpYzogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBwYXJzZUZsb2F0IE5hTnMgbnVtZXJpYy1jYXN0IGZhbHNlIHBvc2l0aXZlcyAobnVsbHx0cnVlfGZhbHNlfCIiKQoJCS8vIC4uLmJ1dCBtaXNpbnRlcnByZXRzIGxlYWRpbmctbnVtYmVyIHN0cmluZ3MsIHBhcnRpY3VsYXJseSBoZXggbGl0ZXJhbHMgKCIweC4uLiIpCgkJLy8gc3VidHJhY3Rpb24gZm9yY2VzIGluZmluaXRpZXMgdG8gTmFOCgkJLy8gYWRkaW5nIDEgY29ycmVjdHMgbG9zcyBvZiBwcmVjaXNpb24gZnJvbSBwYXJzZUZsb2F0ICgjMTUxMDApCgkJcmV0dXJuICFqUXVlcnkuaXNBcnJheSggb2JqICkgJiYgKG9iaiAtIHBhcnNlRmxvYXQoIG9iaiApICsgMSkgPj0gMDsKCX0sCgoJaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBOb3QgcGxhaW4gb2JqZWN0czoKCQkvLyAtIEFueSBvYmplY3Qgb3IgdmFsdWUgd2hvc2UgaW50ZXJuYWwgW1tDbGFzc11dIHByb3BlcnR5IGlzIG5vdCAiW29iamVjdCBPYmplY3RdIgoJCS8vIC0gRE9NIG5vZGVzCgkJLy8gLSB3aW5kb3cKCQlpZiAoIGpRdWVyeS50eXBlKCBvYmogKSAhPT0gIm9iamVjdCIgfHwgb2JqLm5vZGVUeXBlIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmICggb2JqLmNvbnN0cnVjdG9yICYmCgkJCQkhaGFzT3duLmNhbGwoIG9iai5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsICJpc1Byb3RvdHlwZU9mIiApICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBJZiB0aGUgZnVuY3Rpb24gaGFzbid0IHJldHVybmVkIGFscmVhZHksIHdlJ3JlIGNvbmZpZGVudCB0aGF0CgkJLy8gfG9ianwgaXMgYSBwbGFpbiBvYmplY3QsIGNyZWF0ZWQgYnkge30gb3IgY29uc3RydWN0ZWQgd2l0aCBuZXcgT2JqZWN0CgkJcmV0dXJuIHRydWU7Cgl9LAoKCWlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uKCBvYmogKSB7CgkJdmFyIG5hbWU7CgkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJcmV0dXJuIHRydWU7Cgl9LAoKCXR5cGU6IGZ1bmN0aW9uKCBvYmogKSB7CgkJaWYgKCBvYmogPT0gbnVsbCApIHsKCQkJcmV0dXJuIG9iaiArICIiOwoJCX0KCQkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMCwgaU9TPDYgKGZ1bmN0aW9uaXNoIFJlZ0V4cCkKCQlyZXR1cm4gdHlwZW9mIG9iaiA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG9iaiA9PT0gImZ1bmN0aW9uIiA/CgkJCWNsYXNzMnR5cGVbIHRvU3RyaW5nLmNhbGwob2JqKSBdIHx8ICJvYmplY3QiIDoKCQkJdHlwZW9mIG9iajsKCX0sCgoJLy8gRXZhbHVhdGVzIGEgc2NyaXB0IGluIGEgZ2xvYmFsIGNvbnRleHQKCWdsb2JhbEV2YWw6IGZ1bmN0aW9uKCBjb2RlICkgewoJCXZhciBzY3JpcHQsCgkJCWluZGlyZWN0ID0gZXZhbDsKCgkJY29kZSA9IGpRdWVyeS50cmltKCBjb2RlICk7CgoJCWlmICggY29kZSApIHsKCQkJLy8gSWYgdGhlIGNvZGUgaW5jbHVkZXMgYSB2YWxpZCwgcHJvbG9ndWUgcG9zaXRpb24KCQkJLy8gc3RyaWN0IG1vZGUgcHJhZ21hLCBleGVjdXRlIGNvZGUgYnkgaW5qZWN0aW5nIGEKCQkJLy8gc2NyaXB0IHRhZyBpbnRvIHRoZSBkb2N1bWVudC4KCQkJaWYgKCBjb2RlLmluZGV4T2YoInVzZSBzdHJpY3QiKSA9PT0gMSApIHsKCQkJCXNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwoJCQkJc2NyaXB0LnRleHQgPSBjb2RlOwoJCQkJZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCggc2NyaXB0ICkucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCX0gZWxzZSB7CgkJCS8vIE90aGVyd2lzZSwgYXZvaWQgdGhlIERPTSBub2RlIGNyZWF0aW9uLCBpbnNlcnRpb24KCQkJLy8gYW5kIHJlbW92YWwgYnkgdXNpbmcgYW4gaW5kaXJlY3QgZ2xvYmFsIGV2YWwKCQkJCWluZGlyZWN0KCBjb2RlICk7CgkJCX0KCQl9Cgl9LAoKCS8vIENvbnZlcnQgZGFzaGVkIHRvIGNhbWVsQ2FzZTsgdXNlZCBieSB0aGUgY3NzIGFuZCBkYXRhIG1vZHVsZXMKCS8vIFN1cHBvcnQ6IElFOS0xMSsKCS8vIE1pY3Jvc29mdCBmb3Jnb3QgdG8gaHVtcCB0aGVpciB2ZW5kb3IgcHJlZml4ICgjOTU3MikKCWNhbWVsQ2FzZTogZnVuY3Rpb24oIHN0cmluZyApIHsKCQlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHJtc1ByZWZpeCwgIm1zLSIgKS5yZXBsYWNlKCByZGFzaEFscGhhLCBmY2FtZWxDYXNlICk7Cgl9LAoKCW5vZGVOYW1lOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUudG9Mb3dlckNhc2UoKTsKCX0sCgoJLy8gYXJncyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJZWFjaDogZnVuY3Rpb24oIG9iaiwgY2FsbGJhY2ssIGFyZ3MgKSB7CgkJdmFyIHZhbHVlLAoJCQlpID0gMCwKCQkJbGVuZ3RoID0gb2JqLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBvYmogKTsKCgkJaWYgKCBhcmdzICkgewoJCQlpZiAoIGlzQXJyYXkgKSB7CgkJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmFwcGx5KCBvYmpbIGkgXSwgYXJncyApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaSBpbiBvYmogKSB7CgkJCQkJdmFsdWUgPSBjYWxsYmFjay5hcHBseSggb2JqWyBpIF0sIGFyZ3MgKTsKCgkJCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkvLyBBIHNwZWNpYWwsIGZhc3QsIGNhc2UgZm9yIHRoZSBtb3N0IGNvbW1vbiB1c2Ugb2YgZWFjaAoJCX0gZWxzZSB7CgkJCWlmICggaXNBcnJheSApIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpIGluIG9iaiApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmNhbGwoIG9ialsgaSBdLCBpLCBvYmpbIGkgXSApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMQoJdHJpbTogZnVuY3Rpb24oIHRleHQgKSB7CgkJcmV0dXJuIHRleHQgPT0gbnVsbCA/CgkJCSIiIDoKCQkJKCB0ZXh0ICsgIiIgKS5yZXBsYWNlKCBydHJpbSwgIiIgKTsKCX0sCgoJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJbWFrZUFycmF5OiBmdW5jdGlvbiggYXJyLCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQlpZiAoIGlzQXJyYXlsaWtlKCBPYmplY3QoYXJyKSApICkgewoJCQkJalF1ZXJ5Lm1lcmdlKCByZXQsCgkJCQkJdHlwZW9mIGFyciA9PT0gInN0cmluZyIgPwoJCQkJCVsgYXJyIF0gOiBhcnIKCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQlwdXNoLmNhbGwoIHJldCwgYXJyICk7CgkJCX0KCQl9CgoJCXJldHVybiByZXQ7Cgl9LAoKCWluQXJyYXk6IGZ1bmN0aW9uKCBlbGVtLCBhcnIsIGkgKSB7CgkJcmV0dXJuIGFyciA9PSBudWxsID8gLTEgOiBpbmRleE9mLmNhbGwoIGFyciwgZWxlbSwgaSApOwoJfSwKCgltZXJnZTogZnVuY3Rpb24oIGZpcnN0LCBzZWNvbmQgKSB7CgkJdmFyIGxlbiA9ICtzZWNvbmQubGVuZ3RoLAoJCQlqID0gMCwKCQkJaSA9IGZpcnN0Lmxlbmd0aDsKCgkJZm9yICggOyBqIDwgbGVuOyBqKysgKSB7CgkJCWZpcnN0WyBpKysgXSA9IHNlY29uZFsgaiBdOwoJCX0KCgkJZmlyc3QubGVuZ3RoID0gaTsKCgkJcmV0dXJuIGZpcnN0OwoJfSwKCglncmVwOiBmdW5jdGlvbiggZWxlbXMsIGNhbGxiYWNrLCBpbnZlcnQgKSB7CgkJdmFyIGNhbGxiYWNrSW52ZXJzZSwKCQkJbWF0Y2hlcyA9IFtdLAoJCQlpID0gMCwKCQkJbGVuZ3RoID0gZWxlbXMubGVuZ3RoLAoJCQljYWxsYmFja0V4cGVjdCA9ICFpbnZlcnQ7CgoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMKCQkvLyB0aGF0IHBhc3MgdGhlIHZhbGlkYXRvciBmdW5jdGlvbgoJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQljYWxsYmFja0ludmVyc2UgPSAhY2FsbGJhY2soIGVsZW1zWyBpIF0sIGkgKTsKCQkJaWYgKCBjYWxsYmFja0ludmVyc2UgIT09IGNhbGxiYWNrRXhwZWN0ICkgewoJCQkJbWF0Y2hlcy5wdXNoKCBlbGVtc1sgaSBdICk7CgkJCX0KCQl9CgoJCXJldHVybiBtYXRjaGVzOwoJfSwKCgkvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCW1hcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgYXJnICkgewoJCXZhciB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBlbGVtcyApLAoJCQlyZXQgPSBbXTsKCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyIG5ldyB2YWx1ZXMKCQlpZiAoIGlzQXJyYXkgKSB7CgkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJdmFsdWUgPSBjYWxsYmFjayggZWxlbXNbIGkgXSwgaSwgYXJnICk7CgoJCQkJaWYgKCB2YWx1ZSAhPSBudWxsICkgewoJCQkJCXJldC5wdXNoKCB2YWx1ZSApOwoJCQkJfQoJCQl9CgoJCS8vIEdvIHRocm91Z2ggZXZlcnkga2V5IG9uIHRoZSBvYmplY3QsCgkJfSBlbHNlIHsKCQkJZm9yICggaSBpbiBlbGVtcyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXQucHVzaCggdmFsdWUgKTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gRmxhdHRlbiBhbnkgbmVzdGVkIGFycmF5cwoJCXJldHVybiBjb25jYXQuYXBwbHkoIFtdLCByZXQgKTsKCX0sCgoJLy8gQSBnbG9iYWwgR1VJRCBjb3VudGVyIGZvciBvYmplY3RzCglndWlkOiAxLAoKCS8vIEJpbmQgYSBmdW5jdGlvbiB0byBhIGNvbnRleHQsIG9wdGlvbmFsbHkgcGFydGlhbGx5IGFwcGx5aW5nIGFueQoJLy8gYXJndW1lbnRzLgoJcHJveHk6IGZ1bmN0aW9uKCBmbiwgY29udGV4dCApIHsKCQl2YXIgdG1wLCBhcmdzLCBwcm94eTsKCgkJaWYgKCB0eXBlb2YgY29udGV4dCA9PT0gInN0cmluZyIgKSB7CgkJCXRtcCA9IGZuWyBjb250ZXh0IF07CgkJCWNvbnRleHQgPSBmbjsKCQkJZm4gPSB0bXA7CgkJfQoKCQkvLyBRdWljayBjaGVjayB0byBkZXRlcm1pbmUgaWYgdGFyZ2V0IGlzIGNhbGxhYmxlLCBpbiB0aGUgc3BlYwoJCS8vIHRoaXMgdGhyb3dzIGEgVHlwZUVycm9yLCBidXQgd2Ugd2lsbCBqdXN0IHJldHVybiB1bmRlZmluZWQuCgkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIGZuICkgKSB7CgkJCXJldHVybiB1bmRlZmluZWQ7CgkJfQoKCQkvLyBTaW11bGF0ZWQgYmluZAoJCWFyZ3MgPSBzbGljZS5jYWxsKCBhcmd1bWVudHMsIDIgKTsKCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkoIGNvbnRleHQgfHwgdGhpcywgYXJncy5jb25jYXQoIHNsaWNlLmNhbGwoIGFyZ3VtZW50cyApICkgKTsKCQl9OwoKCQkvLyBTZXQgdGhlIGd1aWQgb2YgdW5pcXVlIGhhbmRsZXIgdG8gdGhlIHNhbWUgb2Ygb3JpZ2luYWwgaGFuZGxlciwgc28gaXQgY2FuIGJlIHJlbW92ZWQKCQlwcm94eS5ndWlkID0gZm4uZ3VpZCA9IGZuLmd1aWQgfHwgalF1ZXJ5Lmd1aWQrKzsKCgkJcmV0dXJuIHByb3h5OwoJfSwKCglub3c6IERhdGUubm93LAoKCS8vIGpRdWVyeS5zdXBwb3J0IGlzIG5vdCB1c2VkIGluIENvcmUgYnV0IG90aGVyIHByb2plY3RzIGF0dGFjaCB0aGVpcgoJLy8gcHJvcGVydGllcyB0byBpdCBzbyBpdCBuZWVkcyB0byBleGlzdC4KCXN1cHBvcnQ6IHN1cHBvcnQKfSk7CgovLyBQb3B1bGF0ZSB0aGUgY2xhc3MydHlwZSBtYXAKalF1ZXJ5LmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IiLnNwbGl0KCIgIiksIGZ1bmN0aW9uKGksIG5hbWUpIHsKCWNsYXNzMnR5cGVbICJbb2JqZWN0ICIgKyBuYW1lICsgIl0iIF0gPSBuYW1lLnRvTG93ZXJDYXNlKCk7Cn0pOwoKZnVuY3Rpb24gaXNBcnJheWxpa2UoIG9iaiApIHsKCgkvLyBTdXBwb3J0OiBpT1MgOC4yIChub3QgcmVwcm9kdWNpYmxlIGluIHNpbXVsYXRvcikKCS8vIGBpbmAgY2hlY2sgdXNlZCB0byBwcmV2ZW50IEpJVCBlcnJvciAoZ2gtMjE0NSkKCS8vIGhhc093biBpc24ndCB1c2VkIGhlcmUgZHVlIHRvIGZhbHNlIG5lZ2F0aXZlcwoJLy8gcmVnYXJkaW5nIE5vZGVsaXN0IGxlbmd0aCBpbiBJRQoJdmFyIGxlbmd0aCA9ICJsZW5ndGgiIGluIG9iaiAmJiBvYmoubGVuZ3RoLAoJCXR5cGUgPSBqUXVlcnkudHlwZSggb2JqICk7CgoJaWYgKCB0eXBlID09PSAiZnVuY3Rpb24iIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQoKCWlmICggb2JqLm5vZGVUeXBlID09PSAxICYmIGxlbmd0aCApIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglyZXR1cm4gdHlwZSA9PT0gImFycmF5IiB8fCBsZW5ndGggPT09IDAgfHwKCQl0eXBlb2YgbGVuZ3RoID09PSAibnVtYmVyIiAmJiBsZW5ndGggPiAwICYmICggbGVuZ3RoIC0gMSApIGluIG9iajsKfQp2YXIgU2l6emxlID0KLyohCiAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lIHYyLjIuMC1wcmUKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICoKICogQ29weXJpZ2h0IDIwMDgsIDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBEYXRlOiAyMDE0LTEyLTE2CiAqLwooZnVuY3Rpb24oIHdpbmRvdyApIHsKCnZhciBpLAoJc3VwcG9ydCwKCUV4cHIsCglnZXRUZXh0LAoJaXNYTUwsCgl0b2tlbml6ZSwKCWNvbXBpbGUsCglzZWxlY3QsCglvdXRlcm1vc3RDb250ZXh0LAoJc29ydElucHV0LAoJaGFzRHVwbGljYXRlLAoKCS8vIExvY2FsIGRvY3VtZW50IHZhcnMKCXNldERvY3VtZW50LAoJZG9jdW1lbnQsCglkb2NFbGVtLAoJZG9jdW1lbnRJc0hUTUwsCglyYnVnZ3lRU0EsCglyYnVnZ3lNYXRjaGVzLAoJbWF0Y2hlcywKCWNvbnRhaW5zLAoKCS8vIEluc3RhbmNlLXNwZWNpZmljIGRhdGEKCWV4cGFuZG8gPSAic2l6emxlIiArIDEgKiBuZXcgRGF0ZSgpLAoJcHJlZmVycmVkRG9jID0gd2luZG93LmRvY3VtZW50LAoJZGlycnVucyA9IDAsCglkb25lID0gMCwKCWNsYXNzQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAoJdG9rZW5DYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgljb21waWxlckNhY2hlID0gY3JlYXRlQ2FjaGUoKSwKCXNvcnRPcmRlciA9IGZ1bmN0aW9uKCBhLCBiICkgewoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQl9CgkJcmV0dXJuIDA7Cgl9LAoKCS8vIEdlbmVyYWwtcHVycG9zZSBjb25zdGFudHMKCU1BWF9ORUdBVElWRSA9IDEgPDwgMzEsCgoJLy8gSW5zdGFuY2UgbWV0aG9kcwoJaGFzT3duID0gKHt9KS5oYXNPd25Qcm9wZXJ0eSwKCWFyciA9IFtdLAoJcG9wID0gYXJyLnBvcCwKCXB1c2hfbmF0aXZlID0gYXJyLnB1c2gsCglwdXNoID0gYXJyLnB1c2gsCglzbGljZSA9IGFyci5zbGljZSwKCS8vIFVzZSBhIHN0cmlwcGVkLWRvd24gaW5kZXhPZiBhcyBpdCdzIGZhc3RlciB0aGFuIG5hdGl2ZQoJLy8gaHR0cDovL2pzcGVyZi5jb20vdGhvci1pbmRleG9mLXZzLWZvci81CglpbmRleE9mID0gZnVuY3Rpb24oIGxpc3QsIGVsZW0gKSB7CgkJdmFyIGkgPSAwLAoJCQlsZW4gPSBsaXN0Lmxlbmd0aDsKCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJaWYgKCBsaXN0W2ldID09PSBlbGVtICkgewoJCQkJcmV0dXJuIGk7CgkJCX0KCQl9CgkJcmV0dXJuIC0xOwoJfSwKCglib29sZWFucyA9ICJjaGVja2VkfHNlbGVjdGVkfGFzeW5jfGF1dG9mb2N1c3xhdXRvcGxheXxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58aXNtYXB8bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZCIsCgoJLy8gUmVndWxhciBleHByZXNzaW9ucwoKCS8vIFdoaXRlc3BhY2UgY2hhcmFjdGVycyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jd2hpdGVzcGFjZQoJd2hpdGVzcGFjZSA9ICJbXFx4MjBcXHRcXHJcXG5cXGZdIiwKCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc3ludGF4LyNjaGFyYWN0ZXJzCgljaGFyYWN0ZXJFbmNvZGluZyA9ICIoPzpcXFxcLnxbXFx3LV18W15cXHgwMC1cXHhhMF0pKyIsCgoJLy8gTG9vc2VseSBtb2RlbGVkIG9uIENTUyBpZGVudGlmaWVyIGNoYXJhY3RlcnMKCS8vIEFuIHVucXVvdGVkIHZhbHVlIHNob3VsZCBiZSBhIENTUyBpZGVudGlmaWVyIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc2VsZWN0b3JzLyNhdHRyaWJ1dGUtc2VsZWN0b3JzCgkvLyBQcm9wZXIgc3ludGF4OiBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjdmFsdWUtZGVmLWlkZW50aWZpZXIKCWlkZW50aWZpZXIgPSBjaGFyYWN0ZXJFbmNvZGluZy5yZXBsYWNlKCAidyIsICJ3IyIgKSwKCgkvLyBBdHRyaWJ1dGUgc2VsZWN0b3JzOiBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2F0dHJpYnV0ZS1zZWxlY3RvcnMKCWF0dHJpYnV0ZXMgPSAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSg/OiIgKyB3aGl0ZXNwYWNlICsKCQkvLyBPcGVyYXRvciAoY2FwdHVyZSAyKQoJCSIqKFsqXiR8IX5dPz0pIiArIHdoaXRlc3BhY2UgKwoJCS8vICJBdHRyaWJ1dGUgdmFsdWVzIG11c3QgYmUgQ1NTIGlkZW50aWZpZXJzIFtjYXB0dXJlIDVdIG9yIHN0cmluZ3MgW2NhcHR1cmUgMyBvciBjYXB0dXJlIDRdIgoJCSIqKD86JygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCJ8KCIgKyBpZGVudGlmaWVyICsgIikpfCkiICsgd2hpdGVzcGFjZSArCgkJIipcXF0iLAoKCXBzZXVkb3MgPSAiOigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSg/OlxcKCgiICsKCQkvLyBUbyByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgcHJlRmlsdGVyLCBwcmVmZXIgYXJndW1lbnRzOgoJCS8vIDEuIHF1b3RlZCAoY2FwdHVyZSAzOyBjYXB0dXJlIDQgb3IgY2FwdHVyZSA1KQoJCSIoJygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCIpfCIgKwoJCS8vIDIuIHNpbXBsZSAoY2FwdHVyZSA2KQoJCSIoKD86XFxcXC58W15cXFxcKClbXFxdXXwiICsgYXR0cmlidXRlcyArICIpKil8IiArCgkJLy8gMy4gYW55dGhpbmcgZWxzZSAoY2FwdHVyZSAyKQoJCSIuKiIgKwoJCSIpXFwpfCkiLAoKCS8vIExlYWRpbmcgYW5kIG5vbi1lc2NhcGVkIHRyYWlsaW5nIHdoaXRlc3BhY2UsIGNhcHR1cmluZyBzb21lIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMgcHJlY2VkaW5nIHRoZSBsYXR0ZXIKCXJ3aGl0ZXNwYWNlID0gbmV3IFJlZ0V4cCggd2hpdGVzcGFjZSArICIrIiwgImciICksCglydHJpbSA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIiArIHdoaXRlc3BhY2UgKyAiKyQiLCAiZyIgKSwKCglyY29tbWEgPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIiosIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCXJjb21iaW5hdG9ycyA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKihbPit+XXwiICsgd2hpdGVzcGFjZSArICIpIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCglyYXR0cmlidXRlUXVvdGVzID0gbmV3IFJlZ0V4cCggIj0iICsgd2hpdGVzcGFjZSArICIqKFteXFxdJ1wiXSo/KSIgKyB3aGl0ZXNwYWNlICsgIipcXF0iLCAiZyIgKSwKCglycHNldWRvID0gbmV3IFJlZ0V4cCggcHNldWRvcyApLAoJcmlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKCAiXiIgKyBpZGVudGlmaWVyICsgIiQiICksCgoJbWF0Y2hFeHByID0gewoJCSJJRCI6IG5ldyBSZWdFeHAoICJeIygiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKSwKCQkiQ0xBU1MiOiBuZXcgUmVnRXhwKCAiXlxcLigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKSwKCQkiVEFHIjogbmV3IFJlZ0V4cCggIl4oIiArIGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoICJ3IiwgIncqIiApICsgIikiICksCgkJIkFUVFIiOiBuZXcgUmVnRXhwKCAiXiIgKyBhdHRyaWJ1dGVzICksCgkJIlBTRVVETyI6IG5ldyBSZWdFeHAoICJeIiArIHBzZXVkb3MgKSwKCQkiQ0hJTEQiOiBuZXcgUmVnRXhwKCAiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIiArIHdoaXRlc3BhY2UgKwoJCQkiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIgKyB3aGl0ZXNwYWNlICsgIiooPzooWystXXwpIiArIHdoaXRlc3BhY2UgKwoJCQkiKihcXGQrKXwpKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSIsICJpIiApLAoJCSJib29sIjogbmV3IFJlZ0V4cCggIl4oPzoiICsgYm9vbGVhbnMgKyAiKSQiLCAiaSIgKSwKCQkvLyBGb3IgdXNlIGluIGxpYnJhcmllcyBpbXBsZW1lbnRpbmcgLmlzKCkKCQkvLyBXZSB1c2UgdGhpcyBmb3IgUE9TIG1hdGNoaW5nIGluIGBzZWxlY3RgCgkJIm5lZWRzQ29udGV4dCI6IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKls+K35dfDooZXZlbnxvZGR8ZXF8Z3R8bHR8bnRofGZpcnN0fGxhc3QpKD86XFwoIiArCgkJCXdoaXRlc3BhY2UgKyAiKigoPzotXFxkKT9cXGQqKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSg/PVteLV18JCkiLCAiaSIgKQoJfSwKCglyaW5wdXRzID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSwKCXJoZWFkZXIgPSAvXmhcZCQvaSwKCglybmF0aXZlID0gL15bXntdK1x7XHMqXFtuYXRpdmUgXHcvLAoKCS8vIEVhc2lseS1wYXJzZWFibGUvcmV0cmlldmFibGUgSUQgb3IgVEFHIG9yIENMQVNTIHNlbGVjdG9ycwoJcnF1aWNrRXhwciA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sCgoJcnNpYmxpbmcgPSAvWyt+XS8sCglyZXNjYXBlID0gLyd8XFwvZywKCgkvLyBDU1MgZXNjYXBlcyBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjZXNjYXBlZC1jaGFyYWN0ZXJzCglydW5lc2NhcGUgPSBuZXcgUmVnRXhwKCAiXFxcXChbXFxkYS1mXXsxLDZ9IiArIHdoaXRlc3BhY2UgKyAiP3woIiArIHdoaXRlc3BhY2UgKyAiKXwuKSIsICJpZyIgKSwKCWZ1bmVzY2FwZSA9IGZ1bmN0aW9uKCBfLCBlc2NhcGVkLCBlc2NhcGVkV2hpdGVzcGFjZSApIHsKCQl2YXIgaGlnaCA9ICIweCIgKyBlc2NhcGVkIC0gMHgxMDAwMDsKCQkvLyBOYU4gbWVhbnMgbm9uLWNvZGVwb2ludAoJCS8vIFN1cHBvcnQ6IEZpcmVmb3g8MjQKCQkvLyBXb3JrYXJvdW5kIGVycm9uZW91cyBudW1lcmljIGludGVycHJldGF0aW9uIG9mICsiMHgiCgkJcmV0dXJuIGhpZ2ggIT09IGhpZ2ggfHwgZXNjYXBlZFdoaXRlc3BhY2UgPwoJCQllc2NhcGVkIDoKCQkJaGlnaCA8IDAgPwoJCQkJLy8gQk1QIGNvZGVwb2ludAoJCQkJU3RyaW5nLmZyb21DaGFyQ29kZSggaGlnaCArIDB4MTAwMDAgKSA6CgkJCQkvLyBTdXBwbGVtZW50YWwgUGxhbmUgY29kZXBvaW50IChzdXJyb2dhdGUgcGFpcikKCQkJCVN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggPj4gMTAgfCAweEQ4MDAsIGhpZ2ggJiAweDNGRiB8IDB4REMwMCApOwoJfSwKCgkvLyBVc2VkIGZvciBpZnJhbWVzCgkvLyBTZWUgc2V0RG9jdW1lbnQoKQoJLy8gUmVtb3ZpbmcgdGhlIGZ1bmN0aW9uIHdyYXBwZXIgY2F1c2VzIGEgIlBlcm1pc3Npb24gRGVuaWVkIgoJLy8gZXJyb3IgaW4gSUUKCXVubG9hZEhhbmRsZXIgPSBmdW5jdGlvbigpIHsKCQlzZXREb2N1bWVudCgpOwoJfTsKCi8vIE9wdGltaXplIGZvciBwdXNoLmFwcGx5KCBfLCBOb2RlTGlzdCApCnRyeSB7CglwdXNoLmFwcGx5KAoJCShhcnIgPSBzbGljZS5jYWxsKCBwcmVmZXJyZWREb2MuY2hpbGROb2RlcyApKSwKCQlwcmVmZXJyZWREb2MuY2hpbGROb2RlcwoJKTsKCS8vIFN1cHBvcnQ6IEFuZHJvaWQ8NC4wCgkvLyBEZXRlY3Qgc2lsZW50bHkgZmFpbGluZyBwdXNoLmFwcGx5CglhcnJbIHByZWZlcnJlZERvYy5jaGlsZE5vZGVzLmxlbmd0aCBdLm5vZGVUeXBlOwp9IGNhdGNoICggZSApIHsKCXB1c2ggPSB7IGFwcGx5OiBhcnIubGVuZ3RoID8KCgkJLy8gTGV2ZXJhZ2Ugc2xpY2UgaWYgcG9zc2libGUKCQlmdW5jdGlvbiggdGFyZ2V0LCBlbHMgKSB7CgkJCXB1c2hfbmF0aXZlLmFwcGx5KCB0YXJnZXQsIHNsaWNlLmNhbGwoZWxzKSApOwoJCX0gOgoKCQkvLyBTdXBwb3J0OiBJRTw5CgkJLy8gT3RoZXJ3aXNlIGFwcGVuZCBkaXJlY3RseQoJCWZ1bmN0aW9uKCB0YXJnZXQsIGVscyApIHsKCQkJdmFyIGogPSB0YXJnZXQubGVuZ3RoLAoJCQkJaSA9IDA7CgkJCS8vIENhbid0IHRydXN0IE5vZGVMaXN0Lmxlbmd0aAoJCQl3aGlsZSAoICh0YXJnZXRbaisrXSA9IGVsc1tpKytdKSApIHt9CgkJCXRhcmdldC5sZW5ndGggPSBqIC0gMTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBTaXp6bGUoIHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICkgewoJdmFyIG1hdGNoLCBlbGVtLCBtLCBub2RlVHlwZSwKCQkvLyBRU0EgdmFycwoJCWksIGdyb3Vwcywgb2xkLCBuaWQsIG5ld0NvbnRleHQsIG5ld1NlbGVjdG9yOwoKCWlmICggKCBjb250ZXh0ID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBwcmVmZXJyZWREb2MgKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGNvbnRleHQgKTsKCX0KCgljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCXJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOwoJbm9kZVR5cGUgPSBjb250ZXh0Lm5vZGVUeXBlOwoKCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiB8fCAhc2VsZWN0b3IgfHwKCQlub2RlVHlwZSAhPT0gMSAmJiBub2RlVHlwZSAhPT0gOSAmJiBub2RlVHlwZSAhPT0gMTEgKSB7CgoJCXJldHVybiByZXN1bHRzOwoJfQoKCWlmICggIXNlZWQgJiYgZG9jdW1lbnRJc0hUTUwgKSB7CgoJCS8vIFRyeSB0byBzaG9ydGN1dCBmaW5kIG9wZXJhdGlvbnMgd2hlbiBwb3NzaWJsZSAoZS5nLiwgbm90IHVuZGVyIERvY3VtZW50RnJhZ21lbnQpCgkJaWYgKCBub2RlVHlwZSAhPT0gMTEgJiYgKG1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApKSApIHsKCQkJLy8gU3BlZWQtdXA6IFNpenpsZSgiI0lEIikKCQkJaWYgKCAobSA9IG1hdGNoWzFdKSApIHsKCQkJCWlmICggbm9kZVR5cGUgPT09IDkgKSB7CgkJCQkJZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIG0gKTsKCQkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgKGpRdWVyeSAjNjk2MykKCQkJCQlpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUsIE9wZXJhLCBhbmQgV2Via2l0IHJldHVybiBpdGVtcwoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBlbGVtLmlkID09PSBtICkgewoJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJLy8gQ29udGV4dCBpcyBub3QgYSBkb2N1bWVudAoJCQkJCWlmICggY29udGV4dC5vd25lckRvY3VtZW50ICYmIChlbGVtID0gY29udGV4dC5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtICkpICYmCgkJCQkJCWNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICkgJiYgZWxlbS5pZCA9PT0gbSApIHsKCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCX0KCQkJCX0KCgkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIlRBRyIpCgkJCX0gZWxzZSBpZiAoIG1hdGNoWzJdICkgewoJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgoJCQkvLyBTcGVlZC11cDogU2l6emxlKCIuQ0xBU1MiKQoJCQl9IGVsc2UgaWYgKCAobSA9IG1hdGNoWzNdKSAmJiBzdXBwb3J0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7CgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIG0gKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCX0KCQl9CgoJCS8vIFFTQSBwYXRoCgkJaWYgKCBzdXBwb3J0LnFzYSAmJiAoIXJidWdneVFTQSB8fCAhcmJ1Z2d5UVNBLnRlc3QoIHNlbGVjdG9yICkpICkgewoJCQluaWQgPSBvbGQgPSBleHBhbmRvOwoJCQluZXdDb250ZXh0ID0gY29udGV4dDsKCQkJbmV3U2VsZWN0b3IgPSBub2RlVHlwZSAhPT0gMSAmJiBzZWxlY3RvcjsKCgkJCS8vIHFTQSB3b3JrcyBzdHJhbmdlbHkgb24gRWxlbWVudC1yb290ZWQgcXVlcmllcwoJCQkvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290CgkJCS8vIGFuZCB3b3JraW5nIHVwIGZyb20gdGhlcmUgKFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGUgdGVjaG5pcXVlKQoJCQkvLyBJRSA4IGRvZXNuJ3Qgd29yayBvbiBvYmplY3QgZWxlbWVudHMKCQkJaWYgKCBub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoJCQkJZ3JvdXBzID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJCQkJaWYgKCAob2xkID0gY29udGV4dC5nZXRBdHRyaWJ1dGUoImlkIikpICkgewoJCQkJCW5pZCA9IG9sZC5yZXBsYWNlKCByZXNjYXBlLCAiXFwkJiIgKTsKCQkJCX0gZWxzZSB7CgkJCQkJY29udGV4dC5zZXRBdHRyaWJ1dGUoICJpZCIsIG5pZCApOwoJCQkJfQoJCQkJbmlkID0gIltpZD0nIiArIG5pZCArICInXSAiOwoKCQkJCWkgPSBncm91cHMubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJZ3JvdXBzW2ldID0gbmlkICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQl9CgkJCQluZXdDb250ZXh0ID0gcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiB0ZXN0Q29udGV4dCggY29udGV4dC5wYXJlbnROb2RlICkgfHwgY29udGV4dDsKCQkJCW5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oIiwiKTsKCQkJfQoKCQkJaWYgKCBuZXdTZWxlY3RvciApIHsKCQkJCXRyeSB7CgkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywKCQkJCQkJbmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCBuZXdTZWxlY3RvciApCgkJCQkJKTsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCX0gY2F0Y2gocXNhRXJyb3IpIHsKCQkJCX0gZmluYWxseSB7CgkJCQkJaWYgKCAhb2xkICkgewoJCQkJCQljb250ZXh0LnJlbW92ZUF0dHJpYnV0ZSgiaWQiKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLy8gQWxsIG90aGVycwoJcmV0dXJuIHNlbGVjdCggc2VsZWN0b3IucmVwbGFjZSggcnRyaW0sICIkMSIgKSwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApOwp9CgovKioKICogQ3JlYXRlIGtleS12YWx1ZSBjYWNoZXMgb2YgbGltaXRlZCBzaXplCiAqIEByZXR1cm5zIHtGdW5jdGlvbihzdHJpbmcsIE9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGgKICoJcHJvcGVydHkgbmFtZSB0aGUgKHNwYWNlLXN1ZmZpeGVkKSBzdHJpbmcgYW5kIChpZiB0aGUgY2FjaGUgaXMgbGFyZ2VyIHRoYW4gRXhwci5jYWNoZUxlbmd0aCkKICoJZGVsZXRpbmcgdGhlIG9sZGVzdCBlbnRyeQogKi8KZnVuY3Rpb24gY3JlYXRlQ2FjaGUoKSB7Cgl2YXIga2V5cyA9IFtdOwoKCWZ1bmN0aW9uIGNhY2hlKCBrZXksIHZhbHVlICkgewoJCS8vIFVzZSAoa2V5ICsgIiAiKSB0byBhdm9pZCBjb2xsaXNpb24gd2l0aCBuYXRpdmUgcHJvdG90eXBlIHByb3BlcnRpZXMgKHNlZSBJc3N1ZSAjMTU3KQoJCWlmICgga2V5cy5wdXNoKCBrZXkgKyAiICIgKSA+IEV4cHIuY2FjaGVMZW5ndGggKSB7CgkJCS8vIE9ubHkga2VlcCB0aGUgbW9zdCByZWNlbnQgZW50cmllcwoJCQlkZWxldGUgY2FjaGVbIGtleXMuc2hpZnQoKSBdOwoJCX0KCQlyZXR1cm4gKGNhY2hlWyBrZXkgKyAiICIgXSA9IHZhbHVlKTsKCX0KCXJldHVybiBjYWNoZTsKfQoKLyoqCiAqIE1hcmsgYSBmdW5jdGlvbiBmb3Igc3BlY2lhbCB1c2UgYnkgU2l6emxlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFRoZSBmdW5jdGlvbiB0byBtYXJrCiAqLwpmdW5jdGlvbiBtYXJrRnVuY3Rpb24oIGZuICkgewoJZm5bIGV4cGFuZG8gXSA9IHRydWU7CglyZXR1cm4gZm47Cn0KCi8qKgogKiBTdXBwb3J0IHRlc3RpbmcgdXNpbmcgYW4gZWxlbWVudAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBQYXNzZWQgdGhlIGNyZWF0ZWQgZGl2IGFuZCBleHBlY3RzIGEgYm9vbGVhbiByZXN1bHQKICovCmZ1bmN0aW9uIGFzc2VydCggZm4gKSB7Cgl2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgoJdHJ5IHsKCQlyZXR1cm4gISFmbiggZGl2ICk7Cgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfSBmaW5hbGx5IHsKCQkvLyBSZW1vdmUgZnJvbSBpdHMgcGFyZW50IGJ5IGRlZmF1bHQKCQlpZiAoIGRpdi5wYXJlbnROb2RlICkgewoJCQlkaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZGl2ICk7CgkJfQoJCS8vIHJlbGVhc2UgbWVtb3J5IGluIElFCgkJZGl2ID0gbnVsbDsKCX0KfQoKLyoqCiAqIEFkZHMgdGhlIHNhbWUgaGFuZGxlciBmb3IgYWxsIG9mIHRoZSBzcGVjaWZpZWQgYXR0cnMKICogQHBhcmFtIHtTdHJpbmd9IGF0dHJzIFBpcGUtc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlcwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFRoZSBtZXRob2QgdGhhdCB3aWxsIGJlIGFwcGxpZWQKICovCmZ1bmN0aW9uIGFkZEhhbmRsZSggYXR0cnMsIGhhbmRsZXIgKSB7Cgl2YXIgYXJyID0gYXR0cnMuc3BsaXQoInwiKSwKCQlpID0gYXR0cnMubGVuZ3RoOwoKCXdoaWxlICggaS0tICkgewoJCUV4cHIuYXR0ckhhbmRsZVsgYXJyW2ldIF0gPSBoYW5kbGVyOwoJfQp9CgovKioKICogQ2hlY2tzIGRvY3VtZW50IG9yZGVyIG9mIHR3byBzaWJsaW5ncwogKiBAcGFyYW0ge0VsZW1lbnR9IGEKICogQHBhcmFtIHtFbGVtZW50fSBiCiAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgbGVzcyB0aGFuIDAgaWYgYSBwcmVjZWRlcyBiLCBncmVhdGVyIHRoYW4gMCBpZiBhIGZvbGxvd3MgYgogKi8KZnVuY3Rpb24gc2libGluZ0NoZWNrKCBhLCBiICkgewoJdmFyIGN1ciA9IGIgJiYgYSwKCQlkaWZmID0gY3VyICYmIGEubm9kZVR5cGUgPT09IDEgJiYgYi5ub2RlVHlwZSA9PT0gMSAmJgoJCQkoIH5iLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSApIC0KCQkJKCB+YS5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKTsKCgkvLyBVc2UgSUUgc291cmNlSW5kZXggaWYgYXZhaWxhYmxlIG9uIGJvdGggbm9kZXMKCWlmICggZGlmZiApIHsKCQlyZXR1cm4gZGlmZjsKCX0KCgkvLyBDaGVjayBpZiBiIGZvbGxvd3MgYQoJaWYgKCBjdXIgKSB7CgkJd2hpbGUgKCAoY3VyID0gY3VyLm5leHRTaWJsaW5nKSApIHsKCQkJaWYgKCBjdXIgPT09IGIgKSB7CgkJCQlyZXR1cm4gLTE7CgkJCX0KCQl9Cgl9CgoJcmV0dXJuIGEgPyAxIDogLTE7Cn0KCi8qKgogKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqLwpmdW5jdGlvbiBjcmVhdGVJbnB1dFBzZXVkbyggdHlwZSApIHsKCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQlyZXR1cm4gbmFtZSA9PT0gImlucHV0IiAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBidXR0b25zCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqLwpmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBwb3NpdGlvbmFscwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogKi8KZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25hbFBzZXVkbyggZm4gKSB7CglyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBhcmd1bWVudCApIHsKCQlhcmd1bWVudCA9ICthcmd1bWVudDsKCQlyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQl2YXIgaiwKCQkJCW1hdGNoSW5kZXhlcyA9IGZuKCBbXSwgc2VlZC5sZW5ndGgsIGFyZ3VtZW50ICksCgkJCQlpID0gbWF0Y2hJbmRleGVzLmxlbmd0aDsKCgkJCS8vIE1hdGNoIGVsZW1lbnRzIGZvdW5kIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXhlcwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWlmICggc2VlZFsgKGogPSBtYXRjaEluZGV4ZXNbaV0pIF0gKSB7CgkJCQkJc2VlZFtqXSA9ICEobWF0Y2hlc1tqXSA9IHNlZWRbal0pOwoJCQkJfQoJCQl9CgkJfSk7Cgl9KTsKfQoKLyoqCiAqIENoZWNrcyBhIG5vZGUgZm9yIHZhbGlkaXR5IGFzIGEgU2l6emxlIGNvbnRleHQKICogQHBhcmFtIHtFbGVtZW50fE9iamVjdD19IGNvbnRleHQKICogQHJldHVybnMge0VsZW1lbnR8T2JqZWN0fEJvb2xlYW59IFRoZSBpbnB1dCBub2RlIGlmIGFjY2VwdGFibGUsIG90aGVyd2lzZSBhIGZhbHN5IHZhbHVlCiAqLwpmdW5jdGlvbiB0ZXN0Q29udGV4dCggY29udGV4dCApIHsKCXJldHVybiBjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSAidW5kZWZpbmVkIiAmJiBjb250ZXh0Owp9CgovLyBFeHBvc2Ugc3VwcG9ydCB2YXJzIGZvciBjb252ZW5pZW5jZQpzdXBwb3J0ID0gU2l6emxlLnN1cHBvcnQgPSB7fTsKCi8qKgogKiBEZXRlY3RzIFhNTCBub2RlcwogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBlbGVtIEFuIGVsZW1lbnQgb3IgYSBkb2N1bWVudAogKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZmYgZWxlbSBpcyBhIG5vbi1IVE1MIFhNTCBub2RlCiAqLwppc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJLy8gZG9jdW1lbnRFbGVtZW50IGlzIHZlcmlmaWVkIGZvciBjYXNlcyB3aGVyZSBpdCBkb2Vzbid0IHlldCBleGlzdAoJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKLyoqCiAqIFNldHMgZG9jdW1lbnQtcmVsYXRlZCB2YXJpYWJsZXMgb25jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkb2N1bWVudAogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50CiAqLwpzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJdmFyIGhhc0NvbXBhcmUsIHBhcmVudCwKCQlkb2MgPSBub2RlID8gbm9kZS5vd25lckRvY3VtZW50IHx8IG5vZGUgOiBwcmVmZXJyZWREb2M7CgoJLy8gSWYgbm8gZG9jdW1lbnQgYW5kIGRvY3VtZW50RWxlbWVudCBpcyBhdmFpbGFibGUsIHJldHVybgoJaWYgKCBkb2MgPT09IGRvY3VtZW50IHx8IGRvYy5ub2RlVHlwZSAhPT0gOSB8fCAhZG9jLmRvY3VtZW50RWxlbWVudCApIHsKCQlyZXR1cm4gZG9jdW1lbnQ7Cgl9CgoJLy8gU2V0IG91ciBkb2N1bWVudAoJZG9jdW1lbnQgPSBkb2M7Cglkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudDsKCXBhcmVudCA9IGRvYy5kZWZhdWx0VmlldzsKCgkvLyBTdXBwb3J0OiBJRT44CgkvLyBJZiBpZnJhbWUgZG9jdW1lbnQgaXMgYXNzaWduZWQgdG8gImRvY3VtZW50IiB2YXJpYWJsZSBhbmQgaWYgaWZyYW1lIGhhcyBiZWVuIHJlbG9hZGVkLAoJLy8gSUUgd2lsbCB0aHJvdyAicGVybWlzc2lvbiBkZW5pZWQiIGVycm9yIHdoZW4gYWNjZXNzaW5nICJkb2N1bWVudCIgdmFyaWFibGUsIHNlZSBqUXVlcnkgIzEzOTM2CgkvLyBJRTYtOCBkbyBub3Qgc3VwcG9ydCB0aGUgZGVmYXVsdFZpZXcgcHJvcGVydHkgc28gcGFyZW50IHdpbGwgYmUgdW5kZWZpbmVkCglpZiAoIHBhcmVudCAmJiBwYXJlbnQgIT09IHBhcmVudC50b3AgKSB7CgkJLy8gSUUxMSBkb2VzIG5vdCBoYXZlIGF0dGFjaEV2ZW50LCBzbyBhbGwgbXVzdCBzdWZmZXIKCQlpZiAoIHBhcmVudC5hZGRFdmVudExpc3RlbmVyICkgewoJCQlwYXJlbnQuYWRkRXZlbnRMaXN0ZW5lciggInVubG9hZCIsIHVubG9hZEhhbmRsZXIsIGZhbHNlICk7CgkJfSBlbHNlIGlmICggcGFyZW50LmF0dGFjaEV2ZW50ICkgewoJCQlwYXJlbnQuYXR0YWNoRXZlbnQoICJvbnVubG9hZCIsIHVubG9hZEhhbmRsZXIgKTsKCQl9Cgl9CgoJLyogU3VwcG9ydCB0ZXN0cwoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoJZG9jdW1lbnRJc0hUTUwgPSAhaXNYTUwoIGRvYyApOwoKCS8qIEF0dHJpYnV0ZXMKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkvLyBTdXBwb3J0OiBJRTw4CgkvLyBWZXJpZnkgdGhhdCBnZXRBdHRyaWJ1dGUgcmVhbGx5IHJldHVybnMgYXR0cmlidXRlcyBhbmQgbm90IHByb3BlcnRpZXMKCS8vIChleGNlcHRpbmcgSUU4IGJvb2xlYW5zKQoJc3VwcG9ydC5hdHRyaWJ1dGVzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmNsYXNzTmFtZSA9ICJpIjsKCQlyZXR1cm4gIWRpdi5nZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIpOwoJfSk7CgoJLyogZ2V0RWxlbWVudChzKUJ5KgoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKCS8vIENoZWNrIGlmIGdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikgcmV0dXJucyBvbmx5IGVsZW1lbnRzCglzdXBwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmFwcGVuZENoaWxkKCBkb2MuY3JlYXRlQ29tbWVudCgiIikgKTsKCQlyZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDsKCX0pOwoKCS8vIFN1cHBvcnQ6IElFPDkKCXN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IHJuYXRpdmUudGVzdCggZG9jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKTsKCgkvLyBTdXBwb3J0OiBJRTwxMAoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudEJ5SWQgcmV0dXJucyBlbGVtZW50cyBieSBuYW1lCgkvLyBUaGUgYnJva2VuIGdldEVsZW1lbnRCeUlkIG1ldGhvZHMgZG9uJ3QgcGljayB1cCBwcm9ncmFtYXRpY2FsbHktc2V0IG5hbWVzLAoJLy8gc28gdXNlIGEgcm91bmRhYm91dCBnZXRFbGVtZW50c0J5TmFtZSB0ZXN0CglzdXBwb3J0LmdldEJ5SWQgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBkaXYgKS5pZCA9IGV4cGFuZG87CgkJcmV0dXJuICFkb2MuZ2V0RWxlbWVudHNCeU5hbWUgfHwgIWRvYy5nZXRFbGVtZW50c0J5TmFtZSggZXhwYW5kbyApLmxlbmd0aDsKCX0pOwoKCS8vIElEIGZpbmQgYW5kIGZpbHRlcgoJaWYgKCBzdXBwb3J0LmdldEJ5SWQgKSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSAidW5kZWZpbmVkIiAmJiBkb2N1bWVudElzSFRNTCApIHsKCQkJCXZhciBtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggaWQgKTsKCQkJCS8vIENoZWNrIHBhcmVudE5vZGUgdG8gY2F0Y2ggd2hlbiBCbGFja2JlcnJ5IDQuNiByZXR1cm5zCgkJCQkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgkJCQlyZXR1cm4gbSAmJiBtLnBhcmVudE5vZGUgPyBbIG0gXSA6IFtdOwoJCQl9CgkJfTsKCQlFeHByLmZpbHRlclsiSUQiXSA9IGZ1bmN0aW9uKCBpZCApIHsKCQkJdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgiaWQiKSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9IGVsc2UgewoJCS8vIFN1cHBvcnQ6IElFNi83CgkJLy8gZ2V0RWxlbWVudEJ5SWQgaXMgbm90IHJlbGlhYmxlIGFzIGEgZmluZCBzaG9ydGN1dAoJCWRlbGV0ZSBFeHByLmZpbmRbIklEIl07CgoJCUV4cHIuZmlsdGVyWyJJRCJdID0gIGZ1bmN0aW9uKCBpZCApIHsKCQkJdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBub2RlID0gdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSAhPT0gInVuZGVmaW5lZCIgJiYgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwoJCQkJcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9CgoJLy8gVGFnCglFeHByLmZpbmRbIlRBRyJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkvLyBEb2N1bWVudEZyYWdtZW50IG5vZGVzIGRvbid0IGhhdmUgZ0VCVE4KCQkJfSBlbHNlIGlmICggc3VwcG9ydC5xc2EgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgKTsKCQkJfQoJCX0gOgoKCQlmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCQl2YXIgZWxlbSwKCQkJCXRtcCA9IFtdLAoJCQkJaSA9IDAsCgkJCQkvLyBCeSBoYXBweSBjb2luY2lkZW5jZSwgYSAoYnJva2VuKSBnRUJUTiBhcHBlYXJzIG9uIERvY3VtZW50RnJhZ21lbnQgbm9kZXMgdG9vCgkJCQlyZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkvLyBGaWx0ZXIgb3V0IHBvc3NpYmxlIGNvbW1lbnRzCgkJCWlmICggdGFnID09PSAiKiIgKSB7CgkJCQl3aGlsZSAoIChlbGVtID0gcmVzdWx0c1tpKytdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQkJCXRtcC5wdXNoKCBlbGVtICk7CgkJCQkJfQoJCQkJfQoKCQkJCXJldHVybiB0bXA7CgkJCX0KCQkJcmV0dXJuIHJlc3VsdHM7CgkJfTsKCgkvLyBDbGFzcwoJRXhwci5maW5kWyJDTEFTUyJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKCBjbGFzc05hbWUsIGNvbnRleHQgKSB7CgkJaWYgKCBkb2N1bWVudElzSFRNTCApIHsKCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggY2xhc3NOYW1lICk7CgkJfQoJfTsKCgkvKiBRU0EvbWF0Y2hlc1NlbGVjdG9yCgktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCgoJLy8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydAoKCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCglyYnVnZ3lNYXRjaGVzID0gW107CgoJLy8gcVNhKDpmb2N1cykgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKENocm9tZSAyMSkKCS8vIFdlIGFsbG93IHRoaXMgYmVjYXVzZSBvZiBhIGJ1ZyBpbiBJRTgvOSB0aGF0IHRocm93cyBhbiBlcnJvcgoJLy8gd2hlbmV2ZXIgYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIGlzIGFjY2Vzc2VkIG9uIGFuIGlmcmFtZQoJLy8gU28sIHdlIGFsbG93IDpmb2N1cyB0byBwYXNzIHRocm91Z2ggUVNBIGFsbCB0aGUgdGltZSB0byBhdm9pZCB0aGUgSUUgZXJyb3IKCS8vIFNlZSBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMzM3OAoJcmJ1Z2d5UVNBID0gW107CgoJaWYgKCAoc3VwcG9ydC5xc2EgPSBybmF0aXZlLnRlc3QoIGRvYy5xdWVyeVNlbGVjdG9yQWxsICkpICkgewoJCS8vIEJ1aWxkIFFTQSByZWdleAoJCS8vIFJlZ2V4IHN0cmF0ZWd5IGFkb3B0ZWQgZnJvbSBEaWVnbyBQZXJpbmkKCQlhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkJLy8gU2VsZWN0IGlzIHNldCB0byBlbXB0eSBzdHJpbmcgb24gcHVycG9zZQoJCQkvLyBUaGlzIGlzIHRvIHRlc3QgSUUncyB0cmVhdG1lbnQgb2Ygbm90IGV4cGxpY2l0bHkKCQkJLy8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsCgkJCS8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoCgkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CgkJCWRvY0VsZW0uYXBwZW5kQ2hpbGQoIGRpdiApLmlubmVySFRNTCA9ICI8YSBpZD0nIiArIGV4cGFuZG8gKyAiJz48L2E+IiArCgkJCQkiPHNlbGVjdCBpZD0nIiArIGV4cGFuZG8gKyAiLVxmXScgbXNhbGxvd2NhcHR1cmU9Jyc+IiArCgkJCQkiPG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD4iOwoKCQkJLy8gU3VwcG9ydDogSUU4LCBPcGVyYSAxMS0xMi4xNgoJCQkvLyBOb3RoaW5nIHNob3VsZCBiZSBzZWxlY3RlZCB3aGVuIGVtcHR5IHN0cmluZ3MgZm9sbG93IF49IG9yICQ9IG9yICo9CgkJCS8vIFRoZSB0ZXN0IGF0dHJpYnV0ZSBtdXN0IGJlIHVua25vd24gaW4gT3BlcmEgYnV0ICJzYWZlIiBmb3IgV2luUlQKCQkJLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2hoNDY1Mzg4LmFzcHgjYXR0cmlidXRlX3NlY3Rpb24KCQkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCgiW21zYWxsb3djYXB0dXJlXj0nJ10iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIlsqXiRdPSIgKyB3aGl0ZXNwYWNlICsgIiooPzonJ3xcIlwiKSIgKTsKCQkJfQoKCQkJLy8gU3VwcG9ydDogSUU4CgkJCS8vIEJvb2xlYW4gYXR0cmlidXRlcyBhbmQgInZhbHVlIiBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86dmFsdWV8IiArIGJvb2xlYW5zICsgIikiICk7CgkJCX0KCgkJCS8vIFN1cHBvcnQ6IENocm9tZTwyOSwgQW5kcm9pZDw0LjIrLCBTYWZhcmk8Ny4wKywgaU9TPDcuMCssIFBoYW50b21KUzwxLjkuNysKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoICJbaWR+PSIgKyBleHBhbmRvICsgIi1dIiApLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCJ+PSIpOwoJCQl9CgoJCQkvLyBXZWJraXQvT3BlcmEgLSA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIHNlbGVjdGVkIG9wdGlvbiBlbGVtZW50cwoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDExL1JFQy1jc3MzLXNlbGVjdG9ycy0yMDExMDkyOS8jY2hlY2tlZAoJCQkvLyBJRTggdGhyb3dzIGVycm9yIGhlcmUgYW5kIHdpbGwgbm90IHNlZSBsYXRlciB0ZXN0cwoJCQlpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCgiOmNoZWNrZWQiKTsKCQkJfQoKCQkJLy8gU3VwcG9ydDogU2FmYXJpIDgrLCBpT1MgOCsKCQkJLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEzNjg1MQoJCQkvLyBJbi1wYWdlIGBzZWxlY3RvciNpZCBzaWJpbmctY29tYmluYXRvciBzZWxlY3RvcmAgZmFpbHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoICJhIyIgKyBleHBhbmRvICsgIisqIiApLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCIuIy4rWyt+XSIpOwoJCQl9CgkJfSk7CgoJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCQkvLyBTdXBwb3J0OiBXaW5kb3dzIDggTmF0aXZlIEFwcHMKCQkJLy8gVGhlIHR5cGUgYW5kIG5hbWUgYXR0cmlidXRlcyBhcmUgcmVzdHJpY3RlZCBkdXJpbmcgLmlubmVySFRNTCBhc3NpZ25tZW50CgkJCXZhciBpbnB1dCA9IGRvYy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgImhpZGRlbiIgKTsKCQkJZGl2LmFwcGVuZENoaWxkKCBpbnB1dCApLnNldEF0dHJpYnV0ZSggIm5hbWUiLCAiRCIgKTsKCgkJCS8vIFN1cHBvcnQ6IElFOAoJCQkvLyBFbmZvcmNlIGNhc2Utc2Vuc2l0aXZpdHkgb2YgbmFtZSBhdHRyaWJ1dGUKCQkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCgiW25hbWU9ZF0iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIm5hbWUiICsgd2hpdGVzcGFjZSArICIqWypeJHwhfl0/PSIgKTsKCQkJfQoKCQkJLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZCkKCQkJLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiICk7CgkJCX0KCgkJCS8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCgkJCWRpdi5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4Iik7CgkJCXJidWdneVFTQS5wdXNoKCIsLio6Iik7CgkJfSk7Cgl9CgoJaWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBybmF0aXZlLnRlc3QoIChtYXRjaGVzID0gZG9jRWxlbS5tYXRjaGVzIHx8CgkJZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm1vek1hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ub01hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ubXNNYXRjaGVzU2VsZWN0b3IpICkpICkgewoKCQlhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkJLy8gQ2hlY2sgdG8gc2VlIGlmIGl0J3MgcG9zc2libGUgdG8gZG8gbWF0Y2hlc1NlbGVjdG9yCgkJCS8vIG9uIGEgZGlzY29ubmVjdGVkIG5vZGUgKElFIDkpCgkJCXN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggPSBtYXRjaGVzLmNhbGwoIGRpdiwgImRpdiIgKTsKCgkJCS8vIFRoaXMgc2hvdWxkIGZhaWwgd2l0aCBhbiBleGNlcHRpb24KCQkJLy8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZAoJCQltYXRjaGVzLmNhbGwoIGRpdiwgIltzIT0nJ106eCIgKTsKCQkJcmJ1Z2d5TWF0Y2hlcy5wdXNoKCAiIT0iLCBwc2V1ZG9zICk7CgkJfSk7Cgl9CgoJcmJ1Z2d5UVNBID0gcmJ1Z2d5UVNBLmxlbmd0aCAmJiBuZXcgUmVnRXhwKCByYnVnZ3lRU0Euam9pbigifCIpICk7CglyYnVnZ3lNYXRjaGVzID0gcmJ1Z2d5TWF0Y2hlcy5sZW5ndGggJiYgbmV3IFJlZ0V4cCggcmJ1Z2d5TWF0Y2hlcy5qb2luKCJ8IikgKTsKCgkvKiBDb250YWlucwoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoJaGFzQ29tcGFyZSA9IHJuYXRpdmUudGVzdCggZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiApOwoKCS8vIEVsZW1lbnQgY29udGFpbnMgYW5vdGhlcgoJLy8gUHVycG9zZWZ1bGx5IGRvZXMgbm90IGltcGxlbWVudCBpbmNsdXNpdmUgZGVzY2VuZGVudAoJLy8gQXMgaW4sIGFuIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdHNlbGYKCWNvbnRhaW5zID0gaGFzQ29tcGFyZSB8fCBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29udGFpbnMgKSA/CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCXZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCgkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJcmV0dXJuIGEgPT09IGJ1cCB8fCAhISggYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQlhZG93bi5jb250YWlucyA/CgkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQlhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTYKCQkJKSk7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYiApIHsKCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCWlmICggYiA9PT0gYSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoKCS8qIFNvcnRpbmcKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkvLyBEb2N1bWVudCBvcmRlciBzb3J0aW5nCglzb3J0T3JkZXIgPSBoYXNDb21wYXJlID8KCWZ1bmN0aW9uKCBhLCBiICkgewoKCQkvLyBGbGFnIGZvciBkdXBsaWNhdGUgcmVtb3ZhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQkvLyBTb3J0IG9uIG1ldGhvZCBleGlzdGVuY2UgaWYgb25seSBvbmUgaW5wdXQgaGFzIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uCgkJdmFyIGNvbXBhcmUgPSAhYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uOwoJCWlmICggY29tcGFyZSApIHsKCQkJcmV0dXJuIGNvbXBhcmU7CgkJfQoKCQkvLyBDYWxjdWxhdGUgcG9zaXRpb24gaWYgYm90aCBpbnB1dHMgYmVsb25nIHRvIHRoZSBzYW1lIGRvY3VtZW50CgkJY29tcGFyZSA9ICggYS5vd25lckRvY3VtZW50IHx8IGEgKSA9PT0gKCBiLm93bmVyRG9jdW1lbnQgfHwgYiApID8KCQkJYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYiApIDoKCgkJCS8vIE90aGVyd2lzZSB3ZSBrbm93IHRoZXkgYXJlIGRpc2Nvbm5lY3RlZAoJCQkxOwoKCQkvLyBEaXNjb25uZWN0ZWQgbm9kZXMKCQlpZiAoIGNvbXBhcmUgJiAxIHx8CgkJCSghc3VwcG9ydC5zb3J0RGV0YWNoZWQgJiYgYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYSApID09PSBjb21wYXJlKSApIHsKCgkJCS8vIENob29zZSB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IGlzIHJlbGF0ZWQgdG8gb3VyIHByZWZlcnJlZCBkb2N1bWVudAoJCQlpZiAoIGEgPT09IGRvYyB8fCBhLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGEpICkgewoJCQkJcmV0dXJuIC0xOwoJCQl9CgkJCWlmICggYiA9PT0gZG9jIHx8IGIub3duZXJEb2N1bWVudCA9PT0gcHJlZmVycmVkRG9jICYmIGNvbnRhaW5zKHByZWZlcnJlZERvYywgYikgKSB7CgkJCQlyZXR1cm4gMTsKCQkJfQoKCQkJLy8gTWFpbnRhaW4gb3JpZ2luYWwgb3JkZXIKCQkJcmV0dXJuIHNvcnRJbnB1dCA/CgkJCQkoIGluZGV4T2YoIHNvcnRJbnB1dCwgYSApIC0gaW5kZXhPZiggc29ydElucHV0LCBiICkgKSA6CgkJCQkwOwoJCX0KCgkJcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwoJfSA6CglmdW5jdGlvbiggYSwgYiApIHsKCQkvLyBFeGl0IGVhcmx5IGlmIHRoZSBub2RlcyBhcmUgaWRlbnRpY2FsCgkJaWYgKCBhID09PSBiICkgewoJCQloYXNEdXBsaWNhdGUgPSB0cnVlOwoJCQlyZXR1cm4gMDsKCQl9CgoJCXZhciBjdXIsCgkJCWkgPSAwLAoJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCWJ1cCA9IGIucGFyZW50Tm9kZSwKCQkJYXAgPSBbIGEgXSwKCQkJYnAgPSBbIGIgXTsKCgkJLy8gUGFyZW50bGVzcyBub2RlcyBhcmUgZWl0aGVyIGRvY3VtZW50cyBvciBkaXNjb25uZWN0ZWQKCQlpZiAoICFhdXAgfHwgIWJ1cCApIHsKCQkJcmV0dXJuIGEgPT09IGRvYyA/IC0xIDoKCQkJCWIgPT09IGRvYyA/IDEgOgoJCQkJYXVwID8gLTEgOgoJCQkJYnVwID8gMSA6CgkJCQlzb3J0SW5wdXQgPwoJCQkJKCBpbmRleE9mKCBzb3J0SW5wdXQsIGEgKSAtIGluZGV4T2YoIHNvcnRJbnB1dCwgYiApICkgOgoJCQkJMDsKCgkJLy8gSWYgdGhlIG5vZGVzIGFyZSBzaWJsaW5ncywgd2UgY2FuIGRvIGEgcXVpY2sgY2hlY2sKCQl9IGVsc2UgaWYgKCBhdXAgPT09IGJ1cCApIHsKCQkJcmV0dXJuIHNpYmxpbmdDaGVjayggYSwgYiApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlIHdlIG5lZWQgZnVsbCBsaXN0cyBvZiB0aGVpciBhbmNlc3RvcnMgZm9yIGNvbXBhcmlzb24KCQljdXIgPSBhOwoJCXdoaWxlICggKGN1ciA9IGN1ci5wYXJlbnROb2RlKSApIHsKCQkJYXAudW5zaGlmdCggY3VyICk7CgkJfQoJCWN1ciA9IGI7CgkJd2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkgewoJCQlicC51bnNoaWZ0KCBjdXIgKTsKCQl9CgoJCS8vIFdhbGsgZG93biB0aGUgdHJlZSBsb29raW5nIGZvciBhIGRpc2NyZXBhbmN5CgkJd2hpbGUgKCBhcFtpXSA9PT0gYnBbaV0gKSB7CgkJCWkrKzsKCQl9CgoJCXJldHVybiBpID8KCQkJLy8gRG8gYSBzaWJsaW5nIGNoZWNrIGlmIHRoZSBub2RlcyBoYXZlIGEgY29tbW9uIGFuY2VzdG9yCgkJCXNpYmxpbmdDaGVjayggYXBbaV0sIGJwW2ldICkgOgoKCQkJLy8gT3RoZXJ3aXNlIG5vZGVzIGluIG91ciBkb2N1bWVudCBzb3J0IGZpcnN0CgkJCWFwW2ldID09PSBwcmVmZXJyZWREb2MgPyAtMSA6CgkJCWJwW2ldID09PSBwcmVmZXJyZWREb2MgPyAxIDoKCQkJMDsKCX07CgoJcmV0dXJuIGRvYzsKfTsKClNpenpsZS5tYXRjaGVzID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1lbnRzICkgewoJcmV0dXJuIFNpenpsZSggZXhwciwgbnVsbCwgbnVsbCwgZWxlbWVudHMgKTsKfTsKClNpenpsZS5tYXRjaGVzU2VsZWN0b3IgPSBmdW5jdGlvbiggZWxlbSwgZXhwciApIHsKCS8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZAoJaWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkgewoJCXNldERvY3VtZW50KCBlbGVtICk7Cgl9CgoJLy8gTWFrZSBzdXJlIHRoYXQgYXR0cmlidXRlIHNlbGVjdG9ycyBhcmUgcXVvdGVkCglleHByID0gZXhwci5yZXBsYWNlKCByYXR0cmlidXRlUXVvdGVzLCAiPSckMSddIiApOwoKCWlmICggc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgJiYgZG9jdW1lbnRJc0hUTUwgJiYKCQkoICFyYnVnZ3lNYXRjaGVzIHx8ICFyYnVnZ3lNYXRjaGVzLnRlc3QoIGV4cHIgKSApICYmCgkJKCAhcmJ1Z2d5UVNBICAgICB8fCAhcmJ1Z2d5UVNBLnRlc3QoIGV4cHIgKSApICkgewoKCQl0cnkgewoJCQl2YXIgcmV0ID0gbWF0Y2hlcy5jYWxsKCBlbGVtLCBleHByICk7CgoJCQkvLyBJRSA5J3MgbWF0Y2hlc1NlbGVjdG9yIHJldHVybnMgZmFsc2Ugb24gZGlzY29ubmVjdGVkIG5vZGVzCgkJCWlmICggcmV0IHx8IHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggfHwKCQkJCQkvLyBBcyB3ZWxsLCBkaXNjb25uZWN0ZWQgbm9kZXMgYXJlIHNhaWQgdG8gYmUgaW4gYSBkb2N1bWVudAoJCQkJCS8vIGZyYWdtZW50IGluIElFIDkKCQkJCQllbGVtLmRvY3VtZW50ICYmIGVsZW0uZG9jdW1lbnQubm9kZVR5cGUgIT09IDExICkgewoJCQkJcmV0dXJuIHJldDsKCQkJfQoJCX0gY2F0Y2ggKGUpIHt9Cgl9CgoJcmV0dXJuIFNpenpsZSggZXhwciwgZG9jdW1lbnQsIG51bGwsIFsgZWxlbSBdICkubGVuZ3RoID4gMDsKfTsKClNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBjb250ZXh0LCBlbGVtICkgewoJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCglpZiAoICggY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGNvbnRleHQgKTsKCX0KCXJldHVybiBjb250YWlucyggY29udGV4dCwgZWxlbSApOwp9OwoKU2l6emxlLmF0dHIgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCS8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZAoJaWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkgewoJCXNldERvY3VtZW50KCBlbGVtICk7Cgl9CgoJdmFyIGZuID0gRXhwci5hdHRySGFuZGxlWyBuYW1lLnRvTG93ZXJDYXNlKCkgXSwKCQkvLyBEb24ndCBnZXQgZm9vbGVkIGJ5IE9iamVjdC5wcm90b3R5cGUgcHJvcGVydGllcyAoalF1ZXJ5ICMxMzgwNykKCQl2YWwgPSBmbiAmJiBoYXNPd24uY2FsbCggRXhwci5hdHRySGFuZGxlLCBuYW1lLnRvTG93ZXJDYXNlKCkgKSA/CgkJCWZuKCBlbGVtLCBuYW1lLCAhZG9jdW1lbnRJc0hUTUwgKSA6CgkJCXVuZGVmaW5lZDsKCglyZXR1cm4gdmFsICE9PSB1bmRlZmluZWQgPwoJCXZhbCA6CgkJc3VwcG9ydC5hdHRyaWJ1dGVzIHx8ICFkb2N1bWVudElzSFRNTCA/CgkJCWVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICkgOgoJCQkodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID8KCQkJCXZhbC52YWx1ZSA6CgkJCQludWxsOwp9OwoKU2l6emxlLmVycm9yID0gZnVuY3Rpb24oIG1zZyApIHsKCXRocm93IG5ldyBFcnJvciggIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIgKyBtc2cgKTsKfTsKCi8qKgogKiBEb2N1bWVudCBzb3J0aW5nIGFuZCByZW1vdmluZyBkdXBsaWNhdGVzCiAqIEBwYXJhbSB7QXJyYXlMaWtlfSByZXN1bHRzCiAqLwpTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkgewoJdmFyIGVsZW0sCgkJZHVwbGljYXRlcyA9IFtdLAoJCWogPSAwLAoJCWkgPSAwOwoKCS8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCWhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7Cglzb3J0SW5wdXQgPSAhc3VwcG9ydC5zb3J0U3RhYmxlICYmIHJlc3VsdHMuc2xpY2UoIDAgKTsKCXJlc3VsdHMuc29ydCggc29ydE9yZGVyICk7CgoJaWYgKCBoYXNEdXBsaWNhdGUgKSB7CgkJd2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7CgkJCWlmICggZWxlbSA9PT0gcmVzdWx0c1sgaSBdICkgewoJCQkJaiA9IGR1cGxpY2F0ZXMucHVzaCggaSApOwoJCQl9CgkJfQoJCXdoaWxlICggai0tICkgewoJCQlyZXN1bHRzLnNwbGljZSggZHVwbGljYXRlc1sgaiBdLCAxICk7CgkJfQoJfQoKCS8vIENsZWFyIGlucHV0IGFmdGVyIHNvcnRpbmcgdG8gcmVsZWFzZSBvYmplY3RzCgkvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9zaXp6bGUvcHVsbC8yMjUKCXNvcnRJbnB1dCA9IG51bGw7CgoJcmV0dXJuIHJlc3VsdHM7Cn07CgovKioKICogVXRpbGl0eSBmdW5jdGlvbiBmb3IgcmV0cmlldmluZyB0aGUgdGV4dCB2YWx1ZSBvZiBhbiBhcnJheSBvZiBET00gbm9kZXMKICogQHBhcmFtIHtBcnJheXxFbGVtZW50fSBlbGVtCiAqLwpnZXRUZXh0ID0gU2l6emxlLmdldFRleHQgPSBmdW5jdGlvbiggZWxlbSApIHsKCXZhciBub2RlLAoJCXJldCA9ICIiLAoJCWkgPSAwLAoJCW5vZGVUeXBlID0gZWxlbS5ub2RlVHlwZTsKCglpZiAoICFub2RlVHlwZSApIHsKCQkvLyBJZiBubyBub2RlVHlwZSwgdGhpcyBpcyBleHBlY3RlZCB0byBiZSBhbiBhcnJheQoJCXdoaWxlICggKG5vZGUgPSBlbGVtW2krK10pICkgewoJCQkvLyBEbyBub3QgdHJhdmVyc2UgY29tbWVudCBub2RlcwoJCQlyZXQgKz0gZ2V0VGV4dCggbm9kZSApOwoJCX0KCX0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAxIHx8IG5vZGVUeXBlID09PSA5IHx8IG5vZGVUeXBlID09PSAxMSApIHsKCQkvLyBVc2UgdGV4dENvbnRlbnQgZm9yIGVsZW1lbnRzCgkJLy8gaW5uZXJUZXh0IHVzYWdlIHJlbW92ZWQgZm9yIGNvbnNpc3RlbmN5IG9mIG5ldyBsaW5lcyAoalF1ZXJ5ICMxMTE1MykKCQlpZiAoIHR5cGVvZiBlbGVtLnRleHRDb250ZW50ID09PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIGVsZW0udGV4dENvbnRlbnQ7CgkJfSBlbHNlIHsKCQkJLy8gVHJhdmVyc2UgaXRzIGNoaWxkcmVuCgkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgewoJCQkJcmV0ICs9IGdldFRleHQoIGVsZW0gKTsKCQkJfQoJCX0KCX0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAzIHx8IG5vZGVUeXBlID09PSA0ICkgewoJCXJldHVybiBlbGVtLm5vZGVWYWx1ZTsKCX0KCS8vIERvIG5vdCBpbmNsdWRlIGNvbW1lbnQgb3IgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBub2RlcwoKCXJldHVybiByZXQ7Cn07CgpFeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHsKCgkvLyBDYW4gYmUgYWRqdXN0ZWQgYnkgdGhlIHVzZXIKCWNhY2hlTGVuZ3RoOiA1MCwKCgljcmVhdGVQc2V1ZG86IG1hcmtGdW5jdGlvbiwKCgltYXRjaDogbWF0Y2hFeHByLAoKCWF0dHJIYW5kbGU6IHt9LAoKCWZpbmQ6IHt9LAoKCXJlbGF0aXZlOiB7CgkJIj4iOiB7IGRpcjogInBhcmVudE5vZGUiLCBmaXJzdDogdHJ1ZSB9LAoJCSIgIjogeyBkaXI6ICJwYXJlbnROb2RlIiB9LAoJCSIrIjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciLCBmaXJzdDogdHJ1ZSB9LAoJCSJ+IjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciIH0KCX0sCgoJcHJlRmlsdGVyOiB7CgkJIkFUVFIiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCW1hdGNoWzFdID0gbWF0Y2hbMV0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCS8vIE1vdmUgdGhlIGdpdmVuIHZhbHVlIHRvIG1hdGNoWzNdIHdoZXRoZXIgcXVvdGVkIG9yIHVucXVvdGVkCgkJCW1hdGNoWzNdID0gKCBtYXRjaFszXSB8fCBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCAiIiApLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgoJCQlpZiAoIG1hdGNoWzJdID09PSAifj0iICkgewoJCQkJbWF0Y2hbM10gPSAiICIgKyBtYXRjaFszXSArICIgIjsKCQkJfQoKCQkJcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCA0ICk7CgkJfSwKCgkJIkNISUxEIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQkvKiBtYXRjaGVzIGZyb20gbWF0Y2hFeHByWyJDSElMRCJdCgkJCQkxIHR5cGUgKG9ubHl8bnRofC4uLikKCQkJCTIgd2hhdCAoY2hpbGR8b2YtdHlwZSkKCQkJCTMgYXJndW1lbnQgKGV2ZW58b2RkfFxkKnxcZCpuKFsrLV1cZCspP3wuLi4pCgkJCQk0IHhuLWNvbXBvbmVudCBvZiB4bit5IGFyZ3VtZW50IChbKy1dP1xkKm58KQoJCQkJNSBzaWduIG9mIHhuLWNvbXBvbmVudAoJCQkJNiB4IG9mIHhuLWNvbXBvbmVudAoJCQkJNyBzaWduIG9mIHktY29tcG9uZW50CgkJCQk4IHkgb2YgeS1jb21wb25lbnQKCQkJKi8KCQkJbWF0Y2hbMV0gPSBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpOwoKCQkJaWYgKCBtYXRjaFsxXS5zbGljZSggMCwgMyApID09PSAibnRoIiApIHsKCQkJCS8vIG50aC0qIHJlcXVpcmVzIGFyZ3VtZW50CgkJCQlpZiAoICFtYXRjaFszXSApIHsKCQkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCQl9CgoJCQkJLy8gbnVtZXJpYyB4IGFuZCB5IHBhcmFtZXRlcnMgZm9yIEV4cHIuZmlsdGVyLkNISUxECgkJCQkvLyByZW1lbWJlciB0aGF0IGZhbHNlL3RydWUgY2FzdCByZXNwZWN0aXZlbHkgdG8gMC8xCgkJCQltYXRjaFs0XSA9ICsoIG1hdGNoWzRdID8gbWF0Y2hbNV0gKyAobWF0Y2hbNl0gfHwgMSkgOiAyICogKCBtYXRjaFszXSA9PT0gImV2ZW4iIHx8IG1hdGNoWzNdID09PSAib2RkIiApICk7CgkJCQltYXRjaFs1XSA9ICsoICggbWF0Y2hbN10gKyBtYXRjaFs4XSApIHx8IG1hdGNoWzNdID09PSAib2RkIiApOwoKCQkJLy8gb3RoZXIgdHlwZXMgcHJvaGliaXQgYXJndW1lbnRzCgkJCX0gZWxzZSBpZiAoIG1hdGNoWzNdICkgewoJCQkJU2l6emxlLmVycm9yKCBtYXRjaFswXSApOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2g7CgkJfSwKCgkJIlBTRVVETyI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJdmFyIGV4Y2VzcywKCQkJCXVucXVvdGVkID0gIW1hdGNoWzZdICYmIG1hdGNoWzJdOwoKCQkJaWYgKCBtYXRjaEV4cHJbIkNISUxEIl0udGVzdCggbWF0Y2hbMF0gKSApIHsKCQkJCXJldHVybiBudWxsOwoJCQl9CgoJCQkvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pcwoJCQlpZiAoIG1hdGNoWzNdICkgewoJCQkJbWF0Y2hbMl0gPSBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCAiIjsKCgkJCS8vIFN0cmlwIGV4Y2VzcyBjaGFyYWN0ZXJzIGZyb20gdW5xdW90ZWQgYXJndW1lbnRzCgkJCX0gZWxzZSBpZiAoIHVucXVvdGVkICYmIHJwc2V1ZG8udGVzdCggdW5xdW90ZWQgKSAmJgoJCQkJLy8gR2V0IGV4Y2VzcyBmcm9tIHRva2VuaXplIChyZWN1cnNpdmVseSkKCQkJCShleGNlc3MgPSB0b2tlbml6ZSggdW5xdW90ZWQsIHRydWUgKSkgJiYKCQkJCS8vIGFkdmFuY2UgdG8gdGhlIG5leHQgY2xvc2luZyBwYXJlbnRoZXNpcwoJCQkJKGV4Y2VzcyA9IHVucXVvdGVkLmluZGV4T2YoICIpIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzICkgLSB1bnF1b3RlZC5sZW5ndGgpICkgewoKCQkJCS8vIGV4Y2VzcyBpcyBhIG5lZ2F0aXZlIGluZGV4CgkJCQltYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwLCBleGNlc3MgKTsKCQkJCW1hdGNoWzJdID0gdW5xdW90ZWQuc2xpY2UoIDAsIGV4Y2VzcyApOwoJCQl9CgoJCQkvLyBSZXR1cm4gb25seSBjYXB0dXJlcyBuZWVkZWQgYnkgdGhlIHBzZXVkbyBmaWx0ZXIgbWV0aG9kICh0eXBlIGFuZCBhcmd1bWVudCkKCQkJcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCAzICk7CgkJfQoJfSwKCglmaWx0ZXI6IHsKCgkJIlRBRyI6IGZ1bmN0aW9uKCBub2RlTmFtZVNlbGVjdG9yICkgewoJCQl2YXIgbm9kZU5hbWUgPSBub2RlTmFtZVNlbGVjdG9yLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5vZGVOYW1lU2VsZWN0b3IgPT09ICIqIiA/CgkJCQlmdW5jdGlvbigpIHsgcmV0dXJuIHRydWU7IH0gOgoJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTsKCQkJCX07CgkJfSwKCgkJIkNMQVNTIjogZnVuY3Rpb24oIGNsYXNzTmFtZSApIHsKCQkJdmFyIHBhdHRlcm4gPSBjbGFzc0NhY2hlWyBjbGFzc05hbWUgKyAiICIgXTsKCgkJCXJldHVybiBwYXR0ZXJuIHx8CgkJCQkocGF0dGVybiA9IG5ldyBSZWdFeHAoICIoXnwiICsgd2hpdGVzcGFjZSArICIpIiArIGNsYXNzTmFtZSArICIoIiArIHdoaXRlc3BhY2UgKyAifCQpIiApKSAmJgoJCQkJY2xhc3NDYWNoZSggY2xhc3NOYW1lLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gcGF0dGVybi50ZXN0KCB0eXBlb2YgZWxlbS5jbGFzc05hbWUgPT09ICJzdHJpbmciICYmIGVsZW0uY2xhc3NOYW1lIHx8IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gInVuZGVmaW5lZCIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoImNsYXNzIikgfHwgIiIgKTsKCQkJCX0pOwoJCX0sCgoJCSJBVFRSIjogZnVuY3Rpb24oIG5hbWUsIG9wZXJhdG9yLCBjaGVjayApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJlc3VsdCA9IFNpenpsZS5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkJaWYgKCByZXN1bHQgPT0gbnVsbCApIHsKCQkJCQlyZXR1cm4gb3BlcmF0b3IgPT09ICIhPSI7CgkJCQl9CgkJCQlpZiAoICFvcGVyYXRvciApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCgkJCQlyZXN1bHQgKz0gIiI7CgoJCQkJcmV0dXJuIG9wZXJhdG9yID09PSAiPSIgPyByZXN1bHQgPT09IGNoZWNrIDoKCQkJCQlvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAiXj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOgoJCQkJCW9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPiAtMSA6CgkJCQkJb3BlcmF0b3IgPT09ICIkPSIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAifj0iID8gKCAiICIgKyByZXN1bHQucmVwbGFjZSggcndoaXRlc3BhY2UsICIgIiApICsgIiAiICkuaW5kZXhPZiggY2hlY2sgKSA+IC0xIDoKCQkJCQlvcGVyYXRvciA9PT0gInw9IiA/IHJlc3VsdCA9PT0gY2hlY2sgfHwgcmVzdWx0LnNsaWNlKCAwLCBjaGVjay5sZW5ndGggKyAxICkgPT09IGNoZWNrICsgIi0iIDoKCQkJCQlmYWxzZTsKCQkJfTsKCQl9LAoKCQkiQ0hJTEQiOiBmdW5jdGlvbiggdHlwZSwgd2hhdCwgYXJndW1lbnQsIGZpcnN0LCBsYXN0ICkgewoJCQl2YXIgc2ltcGxlID0gdHlwZS5zbGljZSggMCwgMyApICE9PSAibnRoIiwKCQkJCWZvcndhcmQgPSB0eXBlLnNsaWNlKCAtNCApICE9PSAibGFzdCIsCgkJCQlvZlR5cGUgPSB3aGF0ID09PSAib2YtdHlwZSI7CgoJCQlyZXR1cm4gZmlyc3QgPT09IDEgJiYgbGFzdCA9PT0gMCA/CgoJCQkJLy8gU2hvcnRjdXQgZm9yIDpudGgtKihuKQoJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJcmV0dXJuICEhZWxlbS5wYXJlbnROb2RlOwoJCQkJfSA6CgoJCQkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJCQl2YXIgY2FjaGUsIG91dGVyQ2FjaGUsIG5vZGUsIGRpZmYsIG5vZGVJbmRleCwgc3RhcnQsCgkJCQkJCWRpciA9IHNpbXBsZSAhPT0gZm9yd2FyZCA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIiwKCQkJCQkJcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLAoJCQkJCQluYW1lID0gb2ZUeXBlICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKCQkJCQkJdXNlQ2FjaGUgPSAheG1sICYmICFvZlR5cGU7CgoJCQkJCWlmICggcGFyZW50ICkgewoKCQkJCQkJLy8gOihmaXJzdHxsYXN0fG9ubHkpLShjaGlsZHxvZi10eXBlKQoJCQkJCQlpZiAoIHNpbXBsZSApIHsKCQkJCQkJCXdoaWxlICggZGlyICkgewoJCQkJCQkJCW5vZGUgPSBlbGVtOwoJCQkJCQkJCXdoaWxlICggKG5vZGUgPSBub2RlWyBkaXIgXSkgKSB7CgkJCQkJCQkJCWlmICggb2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCQkvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbykKCQkJCQkJCQlzdGFydCA9IGRpciA9IHR5cGUgPT09ICJvbmx5IiAmJiAhc3RhcnQgJiYgIm5leHRTaWJsaW5nIjsKCQkJCQkJCX0KCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgoJCQkJCQlzdGFydCA9IFsgZm9yd2FyZCA/IHBhcmVudC5maXJzdENoaWxkIDogcGFyZW50Lmxhc3RDaGlsZCBdOwoKCQkJCQkJLy8gbm9uLXhtbCA6bnRoLWNoaWxkKC4uLikgc3RvcmVzIGNhY2hlIGRhdGEgb24gYHBhcmVudGAKCQkJCQkJaWYgKCBmb3J3YXJkICYmIHVzZUNhY2hlICkgewoJCQkJCQkJLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4CgkJCQkJCQlvdXRlckNhY2hlID0gcGFyZW50WyBleHBhbmRvIF0gfHwgKHBhcmVudFsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQkJY2FjaGUgPSBvdXRlckNhY2hlWyB0eXBlIF0gfHwgW107CgkJCQkJCQlub2RlSW5kZXggPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsxXTsKCQkJCQkJCWRpZmYgPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsyXTsKCQkJCQkJCW5vZGUgPSBub2RlSW5kZXggJiYgcGFyZW50LmNoaWxkTm9kZXNbIG5vZGVJbmRleCBdOwoKCQkJCQkJCXdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8CgoJCQkJCQkJCS8vIEZhbGxiYWNrIHRvIHNlZWtpbmcgYGVsZW1gIGZyb20gdGhlIHN0YXJ0CgkJCQkJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7CgoJCQkJCQkJCS8vIFdoZW4gZm91bmQsIGNhY2hlIGluZGV4ZXMgb24gYHBhcmVudGAgYW5kIGJyZWFrCgkJCQkJCQkJaWYgKCBub2RlLm5vZGVUeXBlID09PSAxICYmICsrZGlmZiAmJiBub2RlID09PSBlbGVtICkgewoJCQkJCQkJCQlvdXRlckNhY2hlWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIG5vZGVJbmRleCwgZGlmZiBdOwoJCQkJCQkJCQlicmVhazsKCQkJCQkJCQl9CgkJCQkJCQl9CgoJCQkJCQkvLyBVc2UgcHJldmlvdXNseS1jYWNoZWQgZWxlbWVudCBpbmRleCBpZiBhdmFpbGFibGUKCQkJCQkJfSBlbHNlIGlmICggdXNlQ2FjaGUgJiYgKGNhY2hlID0gKGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pKVsgdHlwZSBdKSAmJiBjYWNoZVswXSA9PT0gZGlycnVucyApIHsKCQkJCQkJCWRpZmYgPSBjYWNoZVsxXTsKCgkJCQkJCS8vIHhtbCA6bnRoLWNoaWxkKC4uLikgb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gVXNlIHRoZSBzYW1lIGxvb3AgYXMgYWJvdmUgdG8gc2VlayBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCXdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8CgkJCQkJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7CgoJCQkJCQkJCWlmICggKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgJiYgKytkaWZmICkgewoJCQkJCQkJCQkvLyBDYWNoZSB0aGUgaW5kZXggb2YgZWFjaCBlbmNvdW50ZXJlZCBlbGVtZW50CgkJCQkJCQkJCWlmICggdXNlQ2FjaGUgKSB7CgkJCQkJCQkJCQkobm9kZVsgZXhwYW5kbyBdIHx8IChub2RlWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIGRpZmYgXTsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJaWYgKCBub2RlID09PSBlbGVtICkgewoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJCS8vIEluY29ycG9yYXRlIHRoZSBvZmZzZXQsIHRoZW4gY2hlY2sgYWdhaW5zdCBjeWNsZSBzaXplCgkJCQkJCWRpZmYgLT0gbGFzdDsKCQkJCQkJcmV0dXJuIGRpZmYgPT09IGZpcnN0IHx8ICggZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwICk7CgkJCQkJfQoJCQkJfTsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIHBzZXVkbywgYXJndW1lbnQgKSB7CgkJCS8vIHBzZXVkby1jbGFzcyBuYW1lcyBhcmUgY2FzZS1pbnNlbnNpdGl2ZQoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzCgkJCS8vIFByaW9yaXRpemUgYnkgY2FzZSBzZW5zaXRpdml0eSBpbiBjYXNlIGN1c3RvbSBwc2V1ZG9zIGFyZSBhZGRlZCB3aXRoIHVwcGVyY2FzZSBsZXR0ZXJzCgkJCS8vIFJlbWVtYmVyIHRoYXQgc2V0RmlsdGVycyBpbmhlcml0cyBmcm9tIHBzZXVkb3MKCQkJdmFyIGFyZ3MsCgkJCQlmbiA9IEV4cHIucHNldWRvc1sgcHNldWRvIF0gfHwgRXhwci5zZXRGaWx0ZXJzWyBwc2V1ZG8udG9Mb3dlckNhc2UoKSBdIHx8CgkJCQkJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgcHNldWRvICk7CgoJCQkvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0CgkJCS8vIGFyZ3VtZW50cyBhcmUgbmVlZGVkIHRvIGNyZWF0ZSB0aGUgZmlsdGVyIGZ1bmN0aW9uCgkJCS8vIGp1c3QgYXMgU2l6emxlIGRvZXMKCQkJaWYgKCBmblsgZXhwYW5kbyBdICkgewoJCQkJcmV0dXJuIGZuKCBhcmd1bWVudCApOwoJCQl9CgoJCQkvLyBCdXQgbWFpbnRhaW4gc3VwcG9ydCBmb3Igb2xkIHNpZ25hdHVyZXMKCQkJaWYgKCBmbi5sZW5ndGggPiAxICkgewoJCQkJYXJncyA9IFsgcHNldWRvLCBwc2V1ZG8sICIiLCBhcmd1bWVudCBdOwoJCQkJcmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eSggcHNldWRvLnRvTG93ZXJDYXNlKCkgKSA/CgkJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQkJCQl2YXIgaWR4LAoJCQkJCQkJbWF0Y2hlZCA9IGZuKCBzZWVkLCBhcmd1bWVudCApLAoJCQkJCQkJaSA9IG1hdGNoZWQubGVuZ3RoOwoJCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJCWlkeCA9IGluZGV4T2YoIHNlZWQsIG1hdGNoZWRbaV0gKTsKCQkJCQkJCXNlZWRbIGlkeCBdID0gISggbWF0Y2hlc1sgaWR4IF0gPSBtYXRjaGVkW2ldICk7CgkJCQkJCX0KCQkJCQl9KSA6CgkJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJCXJldHVybiBmbiggZWxlbSwgMCwgYXJncyApOwoJCQkJCX07CgkJCX0KCgkJCXJldHVybiBmbjsKCQl9Cgl9LAoKCXBzZXVkb3M6IHsKCQkvLyBQb3RlbnRpYWxseSBjb21wbGV4IHBzZXVkb3MKCQkibm90IjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJLy8gVHJpbSB0aGUgc2VsZWN0b3IgcGFzc2VkIHRvIGNvbXBpbGUKCQkJLy8gdG8gYXZvaWQgdHJlYXRpbmcgbGVhZGluZyBhbmQgdHJhaWxpbmcKCQkJLy8gc3BhY2VzIGFzIGNvbWJpbmF0b3JzCgkJCXZhciBpbnB1dCA9IFtdLAoJCQkJcmVzdWx0cyA9IFtdLAoJCQkJbWF0Y2hlciA9IGNvbXBpbGUoIHNlbGVjdG9yLnJlcGxhY2UoIHJ0cmltLCAiJDEiICkgKTsKCgkJCXJldHVybiBtYXRjaGVyWyBleHBhbmRvIF0gPwoJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJdmFyIGVsZW0sCgkJCQkJCXVubWF0Y2hlZCA9IG1hdGNoZXIoIHNlZWQsIG51bGwsIHhtbCwgW10gKSwKCQkJCQkJaSA9IHNlZWQubGVuZ3RoOwoKCQkJCQkvLyBNYXRjaCBlbGVtZW50cyB1bm1hdGNoZWQgYnkgYG1hdGNoZXJgCgkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQkJCQkJc2VlZFtpXSA9ICEobWF0Y2hlc1tpXSA9IGVsZW0pOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSkgOgoJCQkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJCQlpbnB1dFswXSA9IGVsZW07CgkJCQkJbWF0Y2hlciggaW5wdXQsIG51bGwsIHhtbCwgcmVzdWx0cyApOwoJCQkJCS8vIERvbid0IGtlZXAgdGhlIGVsZW1lbnQgKGlzc3VlICMyOTkpCgkJCQkJaW5wdXRbMF0gPSBudWxsOwoJCQkJCXJldHVybiAhcmVzdWx0cy5wb3AoKTsKCQkJCX07CgkJfSksCgoJCSJoYXMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gU2l6emxlKCBzZWxlY3RvciwgZWxlbSApLmxlbmd0aCA+IDA7CgkJCX07CgkJfSksCgoJCSJjb250YWlucyI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggdGV4dCApIHsKCQkJdGV4dCA9IHRleHQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuICggZWxlbS50ZXh0Q29udGVudCB8fCBlbGVtLmlubmVyVGV4dCB8fCBnZXRUZXh0KCBlbGVtICkgKS5pbmRleE9mKCB0ZXh0ICkgPiAtMTsKCQkJfTsKCQl9KSwKCgkJLy8gIldoZXRoZXIgYW4gZWxlbWVudCBpcyByZXByZXNlbnRlZCBieSBhIDpsYW5nKCkgc2VsZWN0b3IKCQkvLyBpcyBiYXNlZCBzb2xlbHkgb24gdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZQoJCS8vIGJlaW5nIGVxdWFsIHRvIHRoZSBpZGVudGlmaWVyIEMsCgkJLy8gb3IgYmVnaW5uaW5nIHdpdGggdGhlIGlkZW50aWZpZXIgQyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSAiLSIuCgkJLy8gVGhlIG1hdGNoaW5nIG9mIEMgYWdhaW5zdCB0aGUgZWxlbWVudCdzIGxhbmd1YWdlIHZhbHVlIGlzIHBlcmZvcm1lZCBjYXNlLWluc2Vuc2l0aXZlbHkuCgkJLy8gVGhlIGlkZW50aWZpZXIgQyBkb2VzIG5vdCBoYXZlIHRvIGJlIGEgdmFsaWQgbGFuZ3VhZ2UgbmFtZS4iCgkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNsYW5nLXBzZXVkbwoJCSJsYW5nIjogbWFya0Z1bmN0aW9uKCBmdW5jdGlvbiggbGFuZyApIHsKCQkJLy8gbGFuZyB2YWx1ZSBtdXN0IGJlIGEgdmFsaWQgaWRlbnRpZmllcgoJCQlpZiAoICFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgIiIpICkgewoJCQkJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgbGFuZzogIiArIGxhbmcgKTsKCQkJfQoJCQlsYW5nID0gbGFuZy5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLnRvTG93ZXJDYXNlKCk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBlbGVtTGFuZzsKCQkJCWRvIHsKCQkJCQlpZiAoIChlbGVtTGFuZyA9IGRvY3VtZW50SXNIVE1MID8KCQkJCQkJZWxlbS5sYW5nIDoKCQkJCQkJZWxlbS5nZXRBdHRyaWJ1dGUoInhtbDpsYW5nIikgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoImxhbmciKSkgKSB7CgoJCQkJCQllbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7CgkJCQkJCXJldHVybiBlbGVtTGFuZyA9PT0gbGFuZyB8fCBlbGVtTGFuZy5pbmRleE9mKCBsYW5nICsgIi0iICkgPT09IDA7CgkJCQkJfQoJCQkJfSB3aGlsZSAoIChlbGVtID0gZWxlbS5wYXJlbnROb2RlKSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX07CgkJfSksCgoJCS8vIE1pc2NlbGxhbmVvdXMKCQkidGFyZ2V0IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoOwoJCQlyZXR1cm4gaGFzaCAmJiBoYXNoLnNsaWNlKCAxICkgPT09IGVsZW0uaWQ7CgkJfSwKCgkJInJvb3QiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0gPT09IGRvY0VsZW07CgkJfSwKCgkJImZvY3VzIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmICghZG9jdW1lbnQuaGFzRm9jdXMgfHwgZG9jdW1lbnQuaGFzRm9jdXMoKSkgJiYgISEoZWxlbS50eXBlIHx8IGVsZW0uaHJlZiB8fCB+ZWxlbS50YWJJbmRleCk7CgkJfSwKCgkJLy8gQm9vbGVhbiBwcm9wZXJ0aWVzCgkJImVuYWJsZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGZhbHNlOwoJCX0sCgoJCSJkaXNhYmxlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZTsKCQl9LAoKCQkiY2hlY2tlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHMKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAxMS9SRUMtY3NzMy1zZWxlY3RvcnMtMjAxMTA5MjkvI2NoZWNrZWQKCQkJdmFyIG5vZGVOYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlyZXR1cm4gKG5vZGVOYW1lID09PSAiaW5wdXQiICYmICEhZWxlbS5jaGVja2VkKSB8fCAobm9kZU5hbWUgPT09ICJvcHRpb24iICYmICEhZWxlbS5zZWxlY3RlZCk7CgkJfSwKCgkJInNlbGVjdGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCS8vIEFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IG1ha2VzIHNlbGVjdGVkLWJ5LWRlZmF1bHQKCQkJLy8gb3B0aW9ucyBpbiBTYWZhcmkgd29yayBwcm9wZXJseQoJCQlpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCWVsZW0ucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwoJCQl9CgoJCQlyZXR1cm4gZWxlbS5zZWxlY3RlZCA9PT0gdHJ1ZTsKCQl9LAoKCQkvLyBDb250ZW50cwoJCSJlbXB0eSI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2VtcHR5LXBzZXVkbwoJCQkvLyA6ZW1wdHkgaXMgbmVnYXRlZCBieSBlbGVtZW50ICgxKSBvciBjb250ZW50IG5vZGVzICh0ZXh0OiAzOyBjZGF0YTogNDsgZW50aXR5IHJlZjogNSksCgkJCS8vICAgYnV0IG5vdCBieSBvdGhlcnMgKGNvbW1lbnQ6IDg7IHByb2Nlc3NpbmcgaW5zdHJ1Y3Rpb246IDc7IGV0Yy4pCgkJCS8vIG5vZGVUeXBlIDwgNiB3b3JrcyBiZWNhdXNlIGF0dHJpYnV0ZXMgKDIpIGRvIG5vdCBhcHBlYXIgYXMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPCA2ICkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gdHJ1ZTsKCQl9LAoKCQkicGFyZW50IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiAhRXhwci5wc2V1ZG9zWyJlbXB0eSJdKCBlbGVtICk7CgkJfSwKCgkJLy8gRWxlbWVudC9pbnB1dCB0eXBlcwoJCSJoZWFkZXIiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHJoZWFkZXIudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCSJpbnB1dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gcmlucHV0cy50ZXN0KCBlbGVtLm5vZGVOYW1lICk7CgkJfSwKCgkJImJ1dHRvbiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgZWxlbS50eXBlID09PSAiYnV0dG9uIiB8fCBuYW1lID09PSAiYnV0dG9uIjsKCQl9LAoKCQkidGV4dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgYXR0cjsKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJZWxlbS50eXBlID09PSAidGV4dCIgJiYKCgkJCQkvLyBTdXBwb3J0OiBJRTw4CgkJCQkvLyBOZXcgSFRNTDUgYXR0cmlidXRlIHZhbHVlcyAoZS5nLiwgInNlYXJjaCIpIGFwcGVhciB3aXRoIGVsZW0udHlwZSA9PT0gInRleHQiCgkJCQkoIChhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgPT0gbnVsbCB8fCBhdHRyLnRvTG93ZXJDYXNlKCkgPT09ICJ0ZXh0IiApOwoJCX0sCgoJCS8vIFBvc2l0aW9uLWluLWNvbGxlY3Rpb24KCQkiZmlyc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gWyAwIF07CgkJfSksCgoJCSJsYXN0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7CgkJCXJldHVybiBbIGxlbmd0aCAtIDEgXTsKCQl9KSwKCgkJImVxIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQlyZXR1cm4gWyBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50IF07CgkJfSksCgoJCSJldmVuIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7CgkJCXZhciBpID0gMDsKCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSksCgoJCSJvZGQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJdmFyIGkgPSAxOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsKCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCX0KCQkJcmV0dXJuIG1hdGNoSW5kZXhlczsKCQl9KSwKCgkJImx0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQl2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7CgkJCWZvciAoIDsgLS1pID49IDA7ICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pLAoKCQkiZ3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCQkJZm9yICggOyArK2kgPCBsZW5ndGg7ICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pCgl9Cn07CgpFeHByLnBzZXVkb3NbIm50aCJdID0gRXhwci5wc2V1ZG9zWyJlcSJdOwoKLy8gQWRkIGJ1dHRvbi9pbnB1dCB0eXBlIHBzZXVkb3MKZm9yICggaSBpbiB7IHJhZGlvOiB0cnVlLCBjaGVja2JveDogdHJ1ZSwgZmlsZTogdHJ1ZSwgcGFzc3dvcmQ6IHRydWUsIGltYWdlOiB0cnVlIH0gKSB7CglFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUlucHV0UHNldWRvKCBpICk7Cn0KZm9yICggaSBpbiB7IHN1Ym1pdDogdHJ1ZSwgcmVzZXQ6IHRydWUgfSApIHsKCUV4cHIucHNldWRvc1sgaSBdID0gY3JlYXRlQnV0dG9uUHNldWRvKCBpICk7Cn0KCi8vIEVhc3kgQVBJIGZvciBjcmVhdGluZyBuZXcgc2V0RmlsdGVycwpmdW5jdGlvbiBzZXRGaWx0ZXJzKCkge30Kc2V0RmlsdGVycy5wcm90b3R5cGUgPSBFeHByLmZpbHRlcnMgPSBFeHByLnBzZXVkb3M7CkV4cHIuc2V0RmlsdGVycyA9IG5ldyBzZXRGaWx0ZXJzKCk7Cgp0b2tlbml6ZSA9IFNpenpsZS50b2tlbml6ZSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgcGFyc2VPbmx5ICkgewoJdmFyIG1hdGNoZWQsIG1hdGNoLCB0b2tlbnMsIHR5cGUsCgkJc29GYXIsIGdyb3VwcywgcHJlRmlsdGVycywKCQljYWNoZWQgPSB0b2tlbkNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggY2FjaGVkICkgewoJCXJldHVybiBwYXJzZU9ubHkgPyAwIDogY2FjaGVkLnNsaWNlKCAwICk7Cgl9CgoJc29GYXIgPSBzZWxlY3RvcjsKCWdyb3VwcyA9IFtdOwoJcHJlRmlsdGVycyA9IEV4cHIucHJlRmlsdGVyOwoKCXdoaWxlICggc29GYXIgKSB7CgoJCS8vIENvbW1hIGFuZCBmaXJzdCBydW4KCQlpZiAoICFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKCBzb0ZhciApKSApIHsKCQkJaWYgKCBtYXRjaCApIHsKCQkJCS8vIERvbid0IGNvbnN1bWUgdHJhaWxpbmcgY29tbWFzIGFzIHZhbGlkCgkJCQlzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaFswXS5sZW5ndGggKSB8fCBzb0ZhcjsKCQkJfQoJCQlncm91cHMucHVzaCggKHRva2VucyA9IFtdKSApOwoJCX0KCgkJbWF0Y2hlZCA9IGZhbHNlOwoKCQkvLyBDb21iaW5hdG9ycwoJCWlmICggKG1hdGNoID0gcmNvbWJpbmF0b3JzLmV4ZWMoIHNvRmFyICkpICkgewoJCQltYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKCQkJdG9rZW5zLnB1c2goewoJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQl9KTsKCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQl9CgoJCS8vIEZpbHRlcnMKCQlmb3IgKCB0eXBlIGluIEV4cHIuZmlsdGVyICkgewoJCQlpZiAoIChtYXRjaCA9IG1hdGNoRXhwclsgdHlwZSBdLmV4ZWMoIHNvRmFyICkpICYmICghcHJlRmlsdGVyc1sgdHlwZSBdIHx8CgkJCQkobWF0Y2ggPSBwcmVGaWx0ZXJzWyB0eXBlIF0oIG1hdGNoICkpKSApIHsKCQkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQkJdG9rZW5zLnB1c2goewoJCQkJCXZhbHVlOiBtYXRjaGVkLAoJCQkJCXR5cGU6IHR5cGUsCgkJCQkJbWF0Y2hlczogbWF0Y2gKCQkJCX0pOwoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQkJfQoJCX0KCgkJaWYgKCAhbWF0Y2hlZCApIHsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJLy8gaWYgd2UncmUganVzdCBwYXJzaW5nCgkvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKCXJldHVybiBwYXJzZU9ubHkgPwoJCXNvRmFyLmxlbmd0aCA6CgkJc29GYXIgPwoJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkvLyBDYWNoZSB0aGUgdG9rZW5zCgkJCXRva2VuQ2FjaGUoIHNlbGVjdG9yLCBncm91cHMgKS5zbGljZSggMCApOwp9OwoKZnVuY3Rpb24gdG9TZWxlY3RvciggdG9rZW5zICkgewoJdmFyIGkgPSAwLAoJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJc2VsZWN0b3IgPSAiIjsKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCXNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTsKCX0KCXJldHVybiBzZWxlY3RvcjsKfQoKZnVuY3Rpb24gYWRkQ29tYmluYXRvciggbWF0Y2hlciwgY29tYmluYXRvciwgYmFzZSApIHsKCXZhciBkaXIgPSBjb21iaW5hdG9yLmRpciwKCQljaGVja05vbkVsZW1lbnRzID0gYmFzZSAmJiBkaXIgPT09ICJwYXJlbnROb2RlIiwKCQlkb25lTmFtZSA9IGRvbmUrKzsKCglyZXR1cm4gY29tYmluYXRvci5maXJzdCA/CgkJLy8gQ2hlY2sgYWdhaW5zdCBjbG9zZXN0IGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50CgkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgewoJCQkJCXJldHVybiBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKTsKCQkJCX0KCQkJfQoJCX0gOgoKCQkvLyBDaGVjayBhZ2FpbnN0IGFsbCBhbmNlc3Rvci9wcmVjZWRpbmcgZWxlbWVudHMKCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl2YXIgb2xkQ2FjaGUsIG91dGVyQ2FjaGUsCgkJCQluZXdDYWNoZSA9IFsgZGlycnVucywgZG9uZU5hbWUgXTsKCgkJCS8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGRpciBjYWNoaW5nCgkJCWlmICggeG1sICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJaWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJb3V0ZXJDYWNoZSA9IGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQlpZiAoIChvbGRDYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJgoJCQkJCQkJb2xkQ2FjaGVbIDAgXSA9PT0gZGlycnVucyAmJiBvbGRDYWNoZVsgMSBdID09PSBkb25lTmFtZSApIHsKCgkJCQkJCQkvLyBBc3NpZ24gdG8gbmV3Q2FjaGUgc28gcmVzdWx0cyBiYWNrLXByb3BhZ2F0ZSB0byBwcmV2aW91cyBlbGVtZW50cwoJCQkJCQkJcmV0dXJuIChuZXdDYWNoZVsgMiBdID0gb2xkQ2FjaGVbIDIgXSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBSZXVzZSBuZXdjYWNoZSBzbyByZXN1bHRzIGJhY2stcHJvcGFnYXRlIHRvIHByZXZpb3VzIGVsZW1lbnRzCgkJCQkJCQlvdXRlckNhY2hlWyBkaXIgXSA9IG5ld0NhY2hlOwoKCQkJCQkJCS8vIEEgbWF0Y2ggbWVhbnMgd2UncmUgZG9uZTsgYSBmYWlsIG1lYW5zIHdlIGhhdmUgdG8ga2VlcCBjaGVja2luZwoJCQkJCQkJaWYgKCAobmV3Q2FjaGVbIDIgXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApKSApIHsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX07Cn0KCmZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApIHsKCXJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8KCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl2YXIgaSA9IG1hdGNoZXJzLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoICFtYXRjaGVyc1tpXSggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJCXJldHVybiB0cnVlOwoJCX0gOgoJCW1hdGNoZXJzWzBdOwp9CgpmdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKCBzZWxlY3RvciwgY29udGV4dHMsIHJlc3VsdHMgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gY29udGV4dHMubGVuZ3RoOwoJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJU2l6emxlKCBzZWxlY3RvciwgY29udGV4dHNbaV0sIHJlc3VsdHMgKTsKCX0KCXJldHVybiByZXN1bHRzOwp9CgpmdW5jdGlvbiBjb25kZW5zZSggdW5tYXRjaGVkLCBtYXAsIGZpbHRlciwgY29udGV4dCwgeG1sICkgewoJdmFyIGVsZW0sCgkJbmV3VW5tYXRjaGVkID0gW10sCgkJaSA9IDAsCgkJbGVuID0gdW5tYXRjaGVkLmxlbmd0aCwKCQltYXBwZWQgPSBtYXAgIT0gbnVsbDsKCglmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQlpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsKCQkJaWYgKCAhZmlsdGVyIHx8IGZpbHRlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQluZXdVbm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJaWYgKCBtYXBwZWQgKSB7CgkJCQkJbWFwLnB1c2goIGkgKTsKCQkJCX0KCQkJfQoJCX0KCX0KCglyZXR1cm4gbmV3VW5tYXRjaGVkOwp9CgpmdW5jdGlvbiBzZXRNYXRjaGVyKCBwcmVGaWx0ZXIsIHNlbGVjdG9yLCBtYXRjaGVyLCBwb3N0RmlsdGVyLCBwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IgKSB7CglpZiAoIHBvc3RGaWx0ZXIgJiYgIXBvc3RGaWx0ZXJbIGV4cGFuZG8gXSApIHsKCQlwb3N0RmlsdGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbHRlciApOwoJfQoJaWYgKCBwb3N0RmluZGVyICYmICFwb3N0RmluZGVyWyBleHBhbmRvIF0gKSB7CgkJcG9zdEZpbmRlciA9IHNldE1hdGNoZXIoIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApOwoJfQoJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sICkgewoJCXZhciB0ZW1wLCBpLCBlbGVtLAoJCQlwcmVNYXAgPSBbXSwKCQkJcG9zdE1hcCA9IFtdLAoJCQlwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLAoKCQkJLy8gR2V0IGluaXRpYWwgZWxlbWVudHMgZnJvbSBzZWVkIG9yIGNvbnRleHQKCQkJZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoIHNlbGVjdG9yIHx8ICIqIiwgY29udGV4dC5ub2RlVHlwZSA/IFsgY29udGV4dCBdIDogY29udGV4dCwgW10gKSwKCgkJCS8vIFByZWZpbHRlciB0byBnZXQgbWF0Y2hlciBpbnB1dCwgcHJlc2VydmluZyBhIG1hcCBmb3Igc2VlZC1yZXN1bHRzIHN5bmNocm9uaXphdGlvbgoJCQltYXRjaGVySW4gPSBwcmVGaWx0ZXIgJiYgKCBzZWVkIHx8ICFzZWxlY3RvciApID8KCQkJCWNvbmRlbnNlKCBlbGVtcywgcHJlTWFwLCBwcmVGaWx0ZXIsIGNvbnRleHQsIHhtbCApIDoKCQkJCWVsZW1zLAoKCQkJbWF0Y2hlck91dCA9IG1hdGNoZXIgPwoJCQkJLy8gSWYgd2UgaGF2ZSBhIHBvc3RGaW5kZXIsIG9yIGZpbHRlcmVkIHNlZWQsIG9yIG5vbi1zZWVkIHBvc3RGaWx0ZXIgb3IgcHJlZXhpc3RpbmcgcmVzdWx0cywKCQkJCXBvc3RGaW5kZXIgfHwgKCBzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlciApID8KCgkJCQkJLy8gLi4uaW50ZXJtZWRpYXRlIHByb2Nlc3NpbmcgaXMgbmVjZXNzYXJ5CgkJCQkJW10gOgoKCQkJCQkvLyAuLi5vdGhlcndpc2UgdXNlIHJlc3VsdHMgZGlyZWN0bHkKCQkJCQlyZXN1bHRzIDoKCQkJCW1hdGNoZXJJbjsKCgkJLy8gRmluZCBwcmltYXJ5IG1hdGNoZXMKCQlpZiAoIG1hdGNoZXIgKSB7CgkJCW1hdGNoZXIoIG1hdGNoZXJJbiwgbWF0Y2hlck91dCwgY29udGV4dCwgeG1sICk7CgkJfQoKCQkvLyBBcHBseSBwb3N0RmlsdGVyCgkJaWYgKCBwb3N0RmlsdGVyICkgewoJCQl0ZW1wID0gY29uZGVuc2UoIG1hdGNoZXJPdXQsIHBvc3RNYXAgKTsKCQkJcG9zdEZpbHRlciggdGVtcCwgW10sIGNvbnRleHQsIHhtbCApOwoKCQkJLy8gVW4tbWF0Y2ggZmFpbGluZyBlbGVtZW50cyBieSBtb3ZpbmcgdGhlbSBiYWNrIHRvIG1hdGNoZXJJbgoJCQlpID0gdGVtcC5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJaWYgKCAoZWxlbSA9IHRlbXBbaV0pICkgewoJCQkJCW1hdGNoZXJPdXRbIHBvc3RNYXBbaV0gXSA9ICEobWF0Y2hlckluWyBwb3N0TWFwW2ldIF0gPSBlbGVtKTsKCQkJCX0KCQkJfQoJCX0KCgkJaWYgKCBzZWVkICkgewoJCQlpZiAoIHBvc3RGaW5kZXIgfHwgcHJlRmlsdGVyICkgewoJCQkJaWYgKCBwb3N0RmluZGVyICkgewoJCQkJCS8vIEdldCB0aGUgZmluYWwgbWF0Y2hlck91dCBieSBjb25kZW5zaW5nIHRoaXMgaW50ZXJtZWRpYXRlIGludG8gcG9zdEZpbmRlciBjb250ZXh0cwoJCQkJCXRlbXAgPSBbXTsKCQkJCQlpID0gbWF0Y2hlck91dC5sZW5ndGg7CgkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCWlmICggKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSApIHsKCQkJCQkJCS8vIFJlc3RvcmUgbWF0Y2hlckluIHNpbmNlIGVsZW0gaXMgbm90IHlldCBhIGZpbmFsIG1hdGNoCgkJCQkJCQl0ZW1wLnB1c2goIChtYXRjaGVySW5baV0gPSBlbGVtKSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXBvc3RGaW5kZXIoIG51bGwsIChtYXRjaGVyT3V0ID0gW10pLCB0ZW1wLCB4bWwgKTsKCQkJCX0KCgkJCQkvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZAoJCQkJaSA9IG1hdGNoZXJPdXQubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICYmCgkJCQkJCSh0ZW1wID0gcG9zdEZpbmRlciA/IGluZGV4T2YoIHNlZWQsIGVsZW0gKSA6IHByZU1hcFtpXSkgPiAtMSApIHsKCgkJCQkJCXNlZWRbdGVtcF0gPSAhKHJlc3VsdHNbdGVtcF0gPSBlbGVtKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJLy8gQWRkIGVsZW1lbnRzIHRvIHJlc3VsdHMsIHRocm91Z2ggcG9zdEZpbmRlciBpZiBkZWZpbmVkCgkJfSBlbHNlIHsKCQkJbWF0Y2hlck91dCA9IGNvbmRlbnNlKAoJCQkJbWF0Y2hlck91dCA9PT0gcmVzdWx0cyA/CgkJCQkJbWF0Y2hlck91dC5zcGxpY2UoIHByZWV4aXN0aW5nLCBtYXRjaGVyT3V0Lmxlbmd0aCApIDoKCQkJCQltYXRjaGVyT3V0CgkJCSk7CgkJCWlmICggcG9zdEZpbmRlciApIHsKCQkJCXBvc3RGaW5kZXIoIG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCApOwoJCQl9IGVsc2UgewoJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgbWF0Y2hlck91dCApOwoJCQl9CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMgKSB7Cgl2YXIgY2hlY2tDb250ZXh0LCBtYXRjaGVyLCBqLAoJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJbGVhZGluZ1JlbGF0aXZlID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zWzBdLnR5cGUgXSwKCQlpbXBsaWNpdFJlbGF0aXZlID0gbGVhZGluZ1JlbGF0aXZlIHx8IEV4cHIucmVsYXRpdmVbIiAiXSwKCQlpID0gbGVhZGluZ1JlbGF0aXZlID8gMSA6IDAsCgoJCS8vIFRoZSBmb3VuZGF0aW9uYWwgbWF0Y2hlciBlbnN1cmVzIHRoYXQgZWxlbWVudHMgYXJlIHJlYWNoYWJsZSBmcm9tIHRvcC1sZXZlbCBjb250ZXh0KHMpCgkJbWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvciggZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBjaGVja0NvbnRleHQ7CgkJfSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSApLAoJCW1hdGNoQW55Q29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gaW5kZXhPZiggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTsKCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciByZXQgPSAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKAoJCQkJKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8KCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQltYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7CgkJCS8vIEF2b2lkIGhhbmdpbmcgb250byBlbGVtZW50IChpc3N1ZSAjMjk5KQoJCQljaGVja0NvbnRleHQgPSBudWxsOwoJCQlyZXR1cm4gcmV0OwoJCX0gXTsKCglmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQlpZiAoIChtYXRjaGVyID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zW2ldLnR5cGUgXSkgKSB7CgkJCW1hdGNoZXJzID0gWyBhZGRDb21iaW5hdG9yKGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLCBtYXRjaGVyKSBdOwoJCX0gZWxzZSB7CgkJCW1hdGNoZXIgPSBFeHByLmZpbHRlclsgdG9rZW5zW2ldLnR5cGUgXS5hcHBseSggbnVsbCwgdG9rZW5zW2ldLm1hdGNoZXMgKTsKCgkJCS8vIFJldHVybiBzcGVjaWFsIHVwb24gc2VlaW5nIGEgcG9zaXRpb25hbCBtYXRjaGVyCgkJCWlmICggbWF0Y2hlclsgZXhwYW5kbyBdICkgewoJCQkJLy8gRmluZCB0aGUgbmV4dCByZWxhdGl2ZSBvcGVyYXRvciAoaWYgYW55KSBmb3IgcHJvcGVyIGhhbmRsaW5nCgkJCQlqID0gKytpOwoJCQkJZm9yICggOyBqIDwgbGVuOyBqKysgKSB7CgkJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyB0b2tlbnNbal0udHlwZSBdICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gc2V0TWF0Y2hlcigKCQkJCQlpID4gMSAmJiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKSwKCQkJCQlpID4gMSAmJiB0b1NlbGVjdG9yKAoJCQkJCQkvLyBJZiB0aGUgcHJlY2VkaW5nIHRva2VuIHdhcyBhIGRlc2NlbmRhbnQgY29tYmluYXRvciwgaW5zZXJ0IGFuIGltcGxpY2l0IGFueS1lbGVtZW50IGAqYAoJCQkJCQl0b2tlbnMuc2xpY2UoIDAsIGkgLSAxICkuY29uY2F0KHsgdmFsdWU6IHRva2Vuc1sgaSAtIDIgXS50eXBlID09PSAiICIgPyAiKiIgOiAiIiB9KQoJCQkJCSkucmVwbGFjZSggcnRyaW0sICIkMSIgKSwKCQkJCQltYXRjaGVyLAoJCQkJCWkgPCBqICYmIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMuc2xpY2UoIGksIGogKSApLAoJCQkJCWogPCBsZW4gJiYgbWF0Y2hlckZyb21Ub2tlbnMoICh0b2tlbnMgPSB0b2tlbnMuc2xpY2UoIGogKSkgKSwKCQkJCQlqIDwgbGVuICYmIHRvU2VsZWN0b3IoIHRva2VucyApCgkJCQkpOwoJCQl9CgkJCW1hdGNoZXJzLnB1c2goIG1hdGNoZXIgKTsKCQl9Cgl9CgoJcmV0dXJuIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApOwp9CgpmdW5jdGlvbiBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoIGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMgKSB7Cgl2YXIgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLAoJCWJ5RWxlbWVudCA9IGVsZW1lbnRNYXRjaGVycy5sZW5ndGggPiAwLAoJCXN1cGVyTWF0Y2hlciA9IGZ1bmN0aW9uKCBzZWVkLCBjb250ZXh0LCB4bWwsIHJlc3VsdHMsIG91dGVybW9zdCApIHsKCQkJdmFyIGVsZW0sIGosIG1hdGNoZXIsCgkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJaSA9ICIwIiwKCQkJCXVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCgkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQljb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKCQkJCS8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3Igb3V0ZXJtb3N0IGNvbnRleHQKCQkJCWVsZW1zID0gc2VlZCB8fCBieUVsZW1lbnQgJiYgRXhwci5maW5kWyJUQUciXSggIioiLCBvdXRlcm1vc3QgKSwKCQkJCS8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCgkJCQlkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKSwKCQkJCWxlbiA9IGVsZW1zLmxlbmd0aDsKCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7CgkJCX0KCgkJCS8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzCgkJCS8vIEtlZXAgYGlgIGEgc3RyaW5nIGlmIHRoZXJlIGFyZSBubyBlbGVtZW50cyBzbyBgbWF0Y2hlZENvdW50YCB3aWxsIGJlICIwMCIgYmVsb3cKCQkJLy8gU3VwcG9ydDogSUU8OSwgU2FmYXJpCgkJCS8vIFRvbGVyYXRlIE5vZGVMaXN0IHByb3BlcnRpZXMgKElFOiAibGVuZ3RoIjsgU2FmYXJpOiA8bnVtYmVyPikgbWF0Y2hpbmcgZWxlbWVudHMgYnkgaWQKCQkJZm9yICggOyBpICE9PSBsZW4gJiYgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQkJaWYgKCBieUVsZW1lbnQgJiYgZWxlbSApIHsKCQkJCQlqID0gMDsKCQkJCQl3aGlsZSAoIChtYXRjaGVyID0gZWxlbWVudE1hdGNoZXJzW2orK10pICkgewoJCQkJCQlpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApICkgewoJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoIG91dGVybW9zdCApIHsKCQkJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIFRyYWNrIHVubWF0Y2hlZCBlbGVtZW50cyBmb3Igc2V0IGZpbHRlcnMKCQkJCWlmICggYnlTZXQgKSB7CgkJCQkJLy8gVGhleSB3aWxsIGhhdmUgZ29uZSB0aHJvdWdoIGFsbCBwb3NzaWJsZSBtYXRjaGVycwoJCQkJCWlmICggKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSApIHsKCQkJCQkJbWF0Y2hlZENvdW50LS07CgkJCQkJfQoKCQkJCQkvLyBMZW5ndGhlbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IGVsZW1lbnQsIG1hdGNoZWQgb3Igbm90CgkJCQkJaWYgKCBzZWVkICkgewoJCQkJCQl1bm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCW1hdGNoZWRDb3VudCArPSBpOwoJCQlpZiAoIGJ5U2V0ICYmIGkgIT09IG1hdGNoZWRDb3VudCApIHsKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pICkgewoJCQkJCW1hdGNoZXIoIHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sICk7CgkJCQl9CgoJCQkJaWYgKCBzZWVkICkgewoJCQkJCS8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmcKCQkJCQlpZiAoIG1hdGNoZWRDb3VudCA+IDAgKSB7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWYgKCAhKHVubWF0Y2hlZFtpXSB8fCBzZXRNYXRjaGVkW2ldKSApIHsKCQkJCQkJCQlzZXRNYXRjaGVkW2ldID0gcG9wLmNhbGwoIHJlc3VsdHMgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKCQkJCQlzZXRNYXRjaGVkID0gY29uZGVuc2UoIHNldE1hdGNoZWQgKTsKCQkJCX0KCgkJCQkvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzCgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7CgoJCQkJLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgkJCQlpZiAoIG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiYKCQkJCQkoIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCApID4gMSApIHsKCgkJCQkJU2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gT3ZlcnJpZGUgbWFuaXB1bGF0aW9uIG9mIGdsb2JhbHMgYnkgbmVzdGVkIG1hdGNoZXJzCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKCQkJfQoKCQkJcmV0dXJuIHVubWF0Y2hlZDsKCQl9OwoKCXJldHVybiBieVNldCA/CgkJbWFya0Z1bmN0aW9uKCBzdXBlck1hdGNoZXIgKSA6CgkJc3VwZXJNYXRjaGVyOwp9Cgpjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIG1hdGNoIC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJdmFyIGksCgkJc2V0TWF0Y2hlcnMgPSBbXSwKCQllbGVtZW50TWF0Y2hlcnMgPSBbXSwKCQljYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggIWNhY2hlZCApIHsKCQkvLyBHZW5lcmF0ZSBhIGZ1bmN0aW9uIG9mIHJlY3Vyc2l2ZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayBlYWNoIGVsZW1lbnQKCQlpZiAoICFtYXRjaCApIHsKCQkJbWF0Y2ggPSB0b2tlbml6ZSggc2VsZWN0b3IgKTsKCQl9CgkJaSA9IG1hdGNoLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJY2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoIG1hdGNoW2ldICk7CgkJCWlmICggY2FjaGVkWyBleHBhbmRvIF0gKSB7CgkJCQlzZXRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfQoJCX0KCgkJLy8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uCgkJY2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7CgoJCS8vIFNhdmUgc2VsZWN0b3IgYW5kIHRva2VuaXphdGlvbgoJCWNhY2hlZC5zZWxlY3RvciA9IHNlbGVjdG9yOwoJfQoJcmV0dXJuIGNhY2hlZDsKfTsKCi8qKgogKiBBIGxvdy1sZXZlbCBzZWxlY3Rpb24gZnVuY3Rpb24gdGhhdCB3b3JrcyB3aXRoIFNpenpsZSdzIGNvbXBpbGVkCiAqICBzZWxlY3RvciBmdW5jdGlvbnMKICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IHNlbGVjdG9yIEEgc2VsZWN0b3Igb3IgYSBwcmUtY29tcGlsZWQKICogIHNlbGVjdG9yIGZ1bmN0aW9uIGJ1aWx0IHdpdGggU2l6emxlLmNvbXBpbGUKICogQHBhcmFtIHtFbGVtZW50fSBjb250ZXh0CiAqIEBwYXJhbSB7QXJyYXl9IFtyZXN1bHRzXQogKiBAcGFyYW0ge0FycmF5fSBbc2VlZF0gQSBzZXQgb2YgZWxlbWVudHMgdG8gbWF0Y2ggYWdhaW5zdAogKi8Kc2VsZWN0ID0gU2l6emxlLnNlbGVjdCA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHsKCXZhciBpLCB0b2tlbnMsIHRva2VuLCB0eXBlLCBmaW5kLAoJCWNvbXBpbGVkID0gdHlwZW9mIHNlbGVjdG9yID09PSAiZnVuY3Rpb24iICYmIHNlbGVjdG9yLAoJCW1hdGNoID0gIXNlZWQgJiYgdG9rZW5pemUoIChzZWxlY3RvciA9IGNvbXBpbGVkLnNlbGVjdG9yIHx8IHNlbGVjdG9yKSApOwoKCXJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOwoKCS8vIFRyeSB0byBtaW5pbWl6ZSBvcGVyYXRpb25zIGlmIHRoZXJlIGlzIG5vIHNlZWQgYW5kIG9ubHkgb25lIGdyb3VwCglpZiAoIG1hdGNoLmxlbmd0aCA9PT0gMSApIHsKCgkJLy8gVGFrZSBhIHNob3J0Y3V0IGFuZCBzZXQgdGhlIGNvbnRleHQgaWYgdGhlIHJvb3Qgc2VsZWN0b3IgaXMgYW4gSUQKCQl0b2tlbnMgPSBtYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwICk7CgkJaWYgKCB0b2tlbnMubGVuZ3RoID4gMiAmJiAodG9rZW4gPSB0b2tlbnNbMF0pLnR5cGUgPT09ICJJRCIgJiYKCQkJCXN1cHBvcnQuZ2V0QnlJZCAmJiBjb250ZXh0Lm5vZGVUeXBlID09PSA5ICYmIGRvY3VtZW50SXNIVE1MICYmCgkJCQlFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkgewoKCQkJY29udGV4dCA9ICggRXhwci5maW5kWyJJRCJdKCB0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLCBjb250ZXh0ICkgfHwgW10gKVswXTsKCQkJaWYgKCAhY29udGV4dCApIHsKCQkJCXJldHVybiByZXN1bHRzOwoKCQkJLy8gUHJlY29tcGlsZWQgbWF0Y2hlcnMgd2lsbCBzdGlsbCB2ZXJpZnkgYW5jZXN0cnksIHNvIHN0ZXAgdXAgYSBsZXZlbAoJCQl9IGVsc2UgaWYgKCBjb21waWxlZCApIHsKCQkJCWNvbnRleHQgPSBjb250ZXh0LnBhcmVudE5vZGU7CgkJCX0KCgkJCXNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UoIHRva2Vucy5zaGlmdCgpLnZhbHVlLmxlbmd0aCApOwoJCX0KCgkJLy8gRmV0Y2ggYSBzZWVkIHNldCBmb3IgcmlnaHQtdG8tbGVmdCBtYXRjaGluZwoJCWkgPSBtYXRjaEV4cHJbIm5lZWRzQ29udGV4dCJdLnRlc3QoIHNlbGVjdG9yICkgPyAwIDogdG9rZW5zLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJdG9rZW4gPSB0b2tlbnNbaV07CgoJCQkvLyBBYm9ydCBpZiB3ZSBoaXQgYSBjb21iaW5hdG9yCgkJCWlmICggRXhwci5yZWxhdGl2ZVsgKHR5cGUgPSB0b2tlbi50eXBlKSBdICkgewoJCQkJYnJlYWs7CgkJCX0KCQkJaWYgKCAoZmluZCA9IEV4cHIuZmluZFsgdHlwZSBdKSApIHsKCQkJCS8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwoJCQkJaWYgKCAoc2VlZCA9IGZpbmQoCgkJCQkJdG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLAoJCQkJCXJzaWJsaW5nLnRlc3QoIHRva2Vuc1swXS50eXBlICkgJiYgdGVzdENvbnRleHQoIGNvbnRleHQucGFyZW50Tm9kZSApIHx8IGNvbnRleHQKCQkJCSkpICkgewoKCQkJCQkvLyBJZiBzZWVkIGlzIGVtcHR5IG9yIG5vIHRva2VucyByZW1haW4sIHdlIGNhbiByZXR1cm4gZWFybHkKCQkJCQl0b2tlbnMuc3BsaWNlKCBpLCAxICk7CgkJCQkJc2VsZWN0b3IgPSBzZWVkLmxlbmd0aCAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKTsKCQkJCQlpZiAoICFzZWxlY3RvciApIHsKCQkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2VlZCApOwoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoJfQoKCS8vIENvbXBpbGUgYW5kIGV4ZWN1dGUgYSBmaWx0ZXJpbmcgZnVuY3Rpb24gaWYgb25lIGlzIG5vdCBwcm92aWRlZAoJLy8gUHJvdmlkZSBgbWF0Y2hgIHRvIGF2b2lkIHJldG9rZW5pemF0aW9uIGlmIHdlIG1vZGlmaWVkIHRoZSBzZWxlY3RvciBhYm92ZQoJKCBjb21waWxlZCB8fCBjb21waWxlKCBzZWxlY3RvciwgbWF0Y2ggKSApKAoJCXNlZWQsCgkJY29udGV4dCwKCQkhZG9jdW1lbnRJc0hUTUwsCgkJcmVzdWx0cywKCQlyc2libGluZy50ZXN0KCBzZWxlY3RvciApICYmIHRlc3RDb250ZXh0KCBjb250ZXh0LnBhcmVudE5vZGUgKSB8fCBjb250ZXh0CgkpOwoJcmV0dXJuIHJlc3VsdHM7Cn07CgovLyBPbmUtdGltZSBhc3NpZ25tZW50cwoKLy8gU29ydCBzdGFiaWxpdHkKc3VwcG9ydC5zb3J0U3RhYmxlID0gZXhwYW5kby5zcGxpdCgiIikuc29ydCggc29ydE9yZGVyICkuam9pbigiIikgPT09IGV4cGFuZG87CgovLyBTdXBwb3J0OiBDaHJvbWUgMTQtMzUrCi8vIEFsd2F5cyBhc3N1bWUgZHVwbGljYXRlcyBpZiB0aGV5IGFyZW4ndCBwYXNzZWQgdG8gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24Kc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzID0gISFoYXNEdXBsaWNhdGU7CgovLyBJbml0aWFsaXplIGFnYWluc3QgdGhlIGRlZmF1bHQgZG9jdW1lbnQKc2V0RG9jdW1lbnQoKTsKCi8vIFN1cHBvcnQ6IFdlYmtpdDw1MzcuMzIgLSBTYWZhcmkgNi4wLjMvQ2hyb21lIDI1IChmaXhlZCBpbiBDaHJvbWUgMjcpCi8vIERldGFjaGVkIG5vZGVzIGNvbmZvdW5kaW5nbHkgZm9sbG93ICplYWNoIG90aGVyKgpzdXBwb3J0LnNvcnREZXRhY2hlZCA9IGFzc2VydChmdW5jdGlvbiggZGl2MSApIHsKCS8vIFNob3VsZCByZXR1cm4gMSwgYnV0IHJldHVybnMgNCAoZm9sbG93aW5nKQoJcmV0dXJuIGRpdjEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpICkgJiAxOwp9KTsKCi8vIFN1cHBvcnQ6IElFPDgKLy8gUHJldmVudCBhdHRyaWJ1dGUvcHJvcGVydHkgImludGVycG9sYXRpb24iCi8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjQyOSUyOFZTLjg1JTI5LmFzcHgKaWYgKCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CglkaXYuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwoJcmV0dXJuIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpID09PSAiIyIgOwp9KSApIHsKCWFkZEhhbmRsZSggInR5cGV8aHJlZnxoZWlnaHR8d2lkdGgiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSwgbmFtZS50b0xvd2VyQ2FzZSgpID09PSAidHlwZSIgPyAxIDogMiApOwoJCX0KCX0pOwp9CgovLyBTdXBwb3J0OiBJRTw5Ci8vIFVzZSBkZWZhdWx0VmFsdWUgaW4gcGxhY2Ugb2YgZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpCmlmICggIXN1cHBvcnQuYXR0cmlidXRlcyB8fCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CglkaXYuaW5uZXJIVE1MID0gIjxpbnB1dC8+IjsKCWRpdi5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSggInZhbHVlIiwgIiIgKTsKCXJldHVybiBkaXYuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoICJ2YWx1ZSIgKSA9PT0gIiI7Cn0pICkgewoJYWRkSGFuZGxlKCAidmFsdWUiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7CgkJaWYgKCAhaXNYTUwgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiICkgewoJCQlyZXR1cm4gZWxlbS5kZWZhdWx0VmFsdWU7CgkJfQoJfSk7Cn0KCi8vIFN1cHBvcnQ6IElFPDkKLy8gVXNlIGdldEF0dHJpYnV0ZU5vZGUgdG8gZmV0Y2ggYm9vbGVhbnMgd2hlbiBnZXRBdHRyaWJ1dGUgbGllcwppZiAoICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCXJldHVybiBkaXYuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09IG51bGw7Cn0pICkgewoJYWRkSGFuZGxlKCBib29sZWFucywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkgewoJCXZhciB2YWw7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCXJldHVybiBlbGVtWyBuYW1lIF0gPT09IHRydWUgPyBuYW1lLnRvTG93ZXJDYXNlKCkgOgoJCQkJCSh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKSkgJiYgdmFsLnNwZWNpZmllZCA/CgkJCQkJdmFsLnZhbHVlIDoKCQkJCW51bGw7CgkJfQoJfSk7Cn0KCnJldHVybiBTaXp6bGU7Cgp9KSggd2luZG93ICk7CgoKCmpRdWVyeS5maW5kID0gU2l6emxlOwpqUXVlcnkuZXhwciA9IFNpenpsZS5zZWxlY3RvcnM7CmpRdWVyeS5leHByWyI6Il0gPSBqUXVlcnkuZXhwci5wc2V1ZG9zOwpqUXVlcnkudW5pcXVlID0gU2l6emxlLnVuaXF1ZVNvcnQ7CmpRdWVyeS50ZXh0ID0gU2l6emxlLmdldFRleHQ7CmpRdWVyeS5pc1hNTERvYyA9IFNpenpsZS5pc1hNTDsKalF1ZXJ5LmNvbnRhaW5zID0gU2l6emxlLmNvbnRhaW5zOwoKCgp2YXIgcm5lZWRzQ29udGV4dCA9IGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dDsKCnZhciByc2luZ2xlVGFnID0gKC9ePChcdyspXHMqXC8/Pig/OjxcL1wxPnwpJC8pOwoKCgp2YXIgcmlzU2ltcGxlID0gL14uW146I1xbXC4sXSokLzsKCi8vIEltcGxlbWVudCB0aGUgaWRlbnRpY2FsIGZ1bmN0aW9uYWxpdHkgZm9yIGZpbHRlciBhbmQgbm90CmZ1bmN0aW9uIHdpbm5vdyggZWxlbWVudHMsIHF1YWxpZmllciwgbm90ICkgewoJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcXVhbGlmaWVyICkgKSB7CgkJcmV0dXJuIGpRdWVyeS5ncmVwKCBlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0sIGkgKSB7CgkJCS8qIGpzaGludCAtVzAxOCAqLwoJCQlyZXR1cm4gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApICE9PSBub3Q7CgkJfSk7CgoJfQoKCWlmICggcXVhbGlmaWVyLm5vZGVUeXBlICkgewoJCXJldHVybiBqUXVlcnkuZ3JlcCggZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gKCBlbGVtID09PSBxdWFsaWZpZXIgKSAhPT0gbm90OwoJCX0pOwoKCX0KCglpZiAoIHR5cGVvZiBxdWFsaWZpZXIgPT09ICJzdHJpbmciICkgewoJCWlmICggcmlzU2ltcGxlLnRlc3QoIHF1YWxpZmllciApICkgewoJCQlyZXR1cm4galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBlbGVtZW50cywgbm90ICk7CgkJfQoKCQlxdWFsaWZpZXIgPSBqUXVlcnkuZmlsdGVyKCBxdWFsaWZpZXIsIGVsZW1lbnRzICk7Cgl9CgoJcmV0dXJuIGpRdWVyeS5ncmVwKCBlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuICggaW5kZXhPZi5jYWxsKCBxdWFsaWZpZXIsIGVsZW0gKSA+PSAwICkgIT09IG5vdDsKCX0pOwp9CgpqUXVlcnkuZmlsdGVyID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1zLCBub3QgKSB7Cgl2YXIgZWxlbSA9IGVsZW1zWyAwIF07CgoJaWYgKCBub3QgKSB7CgkJZXhwciA9ICI6bm90KCIgKyBleHByICsgIikiOwoJfQoKCXJldHVybiBlbGVtcy5sZW5ndGggPT09IDEgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSA/CgkJalF1ZXJ5LmZpbmQubWF0Y2hlc1NlbGVjdG9yKCBlbGVtLCBleHByICkgPyBbIGVsZW0gXSA6IFtdIDoKCQlqUXVlcnkuZmluZC5tYXRjaGVzKCBleHByLCBqUXVlcnkuZ3JlcCggZWxlbXMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5ub2RlVHlwZSA9PT0gMTsKCQl9KSk7Cn07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWZpbmQ6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgaSwKCQkJbGVuID0gdGhpcy5sZW5ndGgsCgkJCXJldCA9IFtdLAoJCQlzZWxmID0gdGhpczsKCgkJaWYgKCB0eXBlb2Ygc2VsZWN0b3IgIT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeSggc2VsZWN0b3IgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9KSApOwoJCX0KCgkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJalF1ZXJ5LmZpbmQoIHNlbGVjdG9yLCBzZWxmWyBpIF0sIHJldCApOwoJCX0KCgkJLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgkJcmV0ID0gdGhpcy5wdXNoU3RhY2soIGxlbiA+IDEgPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldCApOwoJCXJldC5zZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IgPyB0aGlzLnNlbGVjdG9yICsgIiAiICsgc2VsZWN0b3IgOiBzZWxlY3RvcjsKCQlyZXR1cm4gcmV0OwoJfSwKCWZpbHRlcjogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggd2lubm93KHRoaXMsIHNlbGVjdG9yIHx8IFtdLCBmYWxzZSkgKTsKCX0sCglub3Q6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciB8fCBbXSwgdHJ1ZSkgKTsKCX0sCglpczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiAhIXdpbm5vdygKCQkJdGhpcywKCgkJCS8vIElmIHRoaXMgaXMgYSBwb3NpdGlvbmFsL3JlbGF0aXZlIHNlbGVjdG9yLCBjaGVjayBtZW1iZXJzaGlwIGluIHRoZSByZXR1cm5lZCBzZXQKCQkJLy8gc28gJCgicDpmaXJzdCIpLmlzKCJwOmxhc3QiKSB3b24ndCByZXR1cm4gdHJ1ZSBmb3IgYSBkb2Mgd2l0aCB0d28gInAiLgoJCQl0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciICYmIHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3IgKSA/CgkJCQlqUXVlcnkoIHNlbGVjdG9yICkgOgoJCQkJc2VsZWN0b3IgfHwgW10sCgkJCWZhbHNlCgkJKS5sZW5ndGg7Cgl9Cn0pOwoKCi8vIEluaXRpYWxpemUgYSBqUXVlcnkgb2JqZWN0CgoKLy8gQSBjZW50cmFsIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBqUXVlcnkoZG9jdW1lbnQpCnZhciByb290alF1ZXJ5LAoKCS8vIEEgc2ltcGxlIHdheSB0byBjaGVjayBmb3IgSFRNTCBzdHJpbmdzCgkvLyBQcmlvcml0aXplICNpZCBvdmVyIDx0YWc+IHRvIGF2b2lkIFhTUyB2aWEgbG9jYXRpb24uaGFzaCAoIzk1MjEpCgkvLyBTdHJpY3QgSFRNTCByZWNvZ25pdGlvbiAoIzExMjkwOiBtdXN0IHN0YXJ0IHdpdGggPCkKCXJxdWlja0V4cHIgPSAvXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSopKSQvLAoKCWluaXQgPSBqUXVlcnkuZm4uaW5pdCA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQl2YXIgbWF0Y2gsIGVsZW07CgoJCS8vIEhBTkRMRTogJCgiIiksICQobnVsbCksICQodW5kZWZpbmVkKSwgJChmYWxzZSkKCQlpZiAoICFzZWxlY3RvciApIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQkvLyBIYW5kbGUgSFRNTCBzdHJpbmdzCgkJaWYgKCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciICkgewoJCQlpZiAoIHNlbGVjdG9yWzBdID09PSAiPCIgJiYgc2VsZWN0b3JbIHNlbGVjdG9yLmxlbmd0aCAtIDEgXSA9PT0gIj4iICYmIHNlbGVjdG9yLmxlbmd0aCA+PSAzICkgewoJCQkJLy8gQXNzdW1lIHRoYXQgc3RyaW5ncyB0aGF0IHN0YXJ0IGFuZCBlbmQgd2l0aCA8PiBhcmUgSFRNTCBhbmQgc2tpcCB0aGUgcmVnZXggY2hlY2sKCQkJCW1hdGNoID0gWyBudWxsLCBzZWxlY3RvciwgbnVsbCBdOwoKCQkJfSBlbHNlIHsKCQkJCW1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOwoJCQl9CgoJCQkvLyBNYXRjaCBodG1sIG9yIG1ha2Ugc3VyZSBubyBjb250ZXh0IGlzIHNwZWNpZmllZCBmb3IgI2lkCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbMV0gKSB7CgkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WzBdIDogY29udGV4dDsKCgkJCQkJLy8gT3B0aW9uIHRvIHJ1biBzY3JpcHRzIGlzIHRydWUgZm9yIGJhY2stY29tcGF0CgkJCQkJLy8gSW50ZW50aW9uYWxseSBsZXQgdGhlIGVycm9yIGJlIHRocm93biBpZiBwYXJzZUhUTUwgaXMgbm90IHByZXNlbnQKCQkJCQlqUXVlcnkubWVyZ2UoIHRoaXMsIGpRdWVyeS5wYXJzZUhUTUwoCgkJCQkJCW1hdGNoWzFdLAoJCQkJCQljb250ZXh0ICYmIGNvbnRleHQubm9kZVR5cGUgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IGRvY3VtZW50LAoJCQkJCQl0cnVlCgkJCQkJKSApOwoKCQkJCQkvLyBIQU5ETEU6ICQoaHRtbCwgcHJvcHMpCgkJCQkJaWYgKCByc2luZ2xlVGFnLnRlc3QoIG1hdGNoWzFdICkgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGNvbnRleHQgKSApIHsKCQkJCQkJZm9yICggbWF0Y2ggaW4gY29udGV4dCApIHsKCQkJCQkJCS8vIFByb3BlcnRpZXMgb2YgY29udGV4dCBhcmUgY2FsbGVkIGFzIG1ldGhvZHMgaWYgcG9zc2libGUKCQkJCQkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHRoaXNbIG1hdGNoIF0gKSApIHsKCQkJCQkJCQl0aGlzWyBtYXRjaCBdKCBjb250ZXh0WyBtYXRjaCBdICk7CgoJCQkJCQkJLy8gLi4uYW5kIG90aGVyd2lzZSBzZXQgYXMgYXR0cmlidXRlcwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl0aGlzLmF0dHIoIG1hdGNoLCBjb250ZXh0WyBtYXRjaCBdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCXJldHVybiB0aGlzOwoKCQkJCS8vIEhBTkRMRTogJCgjaWQpCgkJCQl9IGVsc2UgewoJCQkJCWVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbWF0Y2hbMl0gKTsKCgkJCQkJLy8gU3VwcG9ydDogQmxhY2tiZXJyeSA0LjYKCQkJCQkvLyBnRUJJRCByZXR1cm5zIG5vZGVzIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgKCM2OTYzKQoJCQkJCWlmICggZWxlbSAmJiBlbGVtLnBhcmVudE5vZGUgKSB7CgkJCQkJCS8vIEluamVjdCB0aGUgZWxlbWVudCBkaXJlY3RseSBpbnRvIHRoZSBqUXVlcnkgb2JqZWN0CgkJCQkJCXRoaXMubGVuZ3RoID0gMTsKCQkJCQkJdGhpc1swXSA9IGVsZW07CgkJCQkJfQoKCQkJCQl0aGlzLmNvbnRleHQgPSBkb2N1bWVudDsKCQkJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgoJCQkvLyBIQU5ETEU6ICQoZXhwciwgJCguLi4pKQoJCQl9IGVsc2UgaWYgKCAhY29udGV4dCB8fCBjb250ZXh0LmpxdWVyeSApIHsKCQkJCXJldHVybiAoIGNvbnRleHQgfHwgcm9vdGpRdWVyeSApLmZpbmQoIHNlbGVjdG9yICk7CgoJCQkvLyBIQU5ETEU6ICQoZXhwciwgY29udGV4dCkKCQkJLy8gKHdoaWNoIGlzIGp1c3QgZXF1aXZhbGVudCB0bzogJChjb250ZXh0KS5maW5kKGV4cHIpCgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5jb25zdHJ1Y3RvciggY29udGV4dCApLmZpbmQoIHNlbGVjdG9yICk7CgkJCX0KCgkJLy8gSEFORExFOiAkKERPTUVsZW1lbnQpCgkJfSBlbHNlIGlmICggc2VsZWN0b3Iubm9kZVR5cGUgKSB7CgkJCXRoaXMuY29udGV4dCA9IHRoaXNbMF0gPSBzZWxlY3RvcjsKCQkJdGhpcy5sZW5ndGggPSAxOwoJCQlyZXR1cm4gdGhpczsKCgkJLy8gSEFORExFOiAkKGZ1bmN0aW9uKQoJCS8vIFNob3J0Y3V0IGZvciBkb2N1bWVudCByZWFkeQoJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBzZWxlY3RvciApICkgewoJCQlyZXR1cm4gdHlwZW9mIHJvb3RqUXVlcnkucmVhZHkgIT09ICJ1bmRlZmluZWQiID8KCQkJCXJvb3RqUXVlcnkucmVhZHkoIHNlbGVjdG9yICkgOgoJCQkJLy8gRXhlY3V0ZSBpbW1lZGlhdGVseSBpZiByZWFkeSBpcyBub3QgcHJlc2VudAoJCQkJc2VsZWN0b3IoIGpRdWVyeSApOwoJCX0KCgkJaWYgKCBzZWxlY3Rvci5zZWxlY3RvciAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CgkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTsKCX07CgovLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBqUXVlcnkgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCmluaXQucHJvdG90eXBlID0galF1ZXJ5LmZuOwoKLy8gSW5pdGlhbGl6ZSBjZW50cmFsIHJlZmVyZW5jZQpyb290alF1ZXJ5ID0galF1ZXJ5KCBkb2N1bWVudCApOwoKCnZhciBycGFyZW50c3ByZXYgPSAvXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLywKCS8vIE1ldGhvZHMgZ3VhcmFudGVlZCB0byBwcm9kdWNlIGEgdW5pcXVlIHNldCB3aGVuIHN0YXJ0aW5nIGZyb20gYSB1bmlxdWUgc2V0CglndWFyYW50ZWVkVW5pcXVlID0gewoJCWNoaWxkcmVuOiB0cnVlLAoJCWNvbnRlbnRzOiB0cnVlLAoJCW5leHQ6IHRydWUsCgkJcHJldjogdHJ1ZQoJfTsKCmpRdWVyeS5leHRlbmQoewoJZGlyOiBmdW5jdGlvbiggZWxlbSwgZGlyLCB1bnRpbCApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdLAoJCQl0cnVuY2F0ZSA9IHVudGlsICE9PSB1bmRlZmluZWQ7CgoJCXdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgJiYgZWxlbS5ub2RlVHlwZSAhPT0gOSApIHsKCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJaWYgKCB0cnVuY2F0ZSAmJiBqUXVlcnkoIGVsZW0gKS5pcyggdW50aWwgKSApIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCW1hdGNoZWQucHVzaCggZWxlbSApOwoJCQl9CgkJfQoJCXJldHVybiBtYXRjaGVkOwoJfSwKCglzaWJsaW5nOiBmdW5jdGlvbiggbiwgZWxlbSApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdOwoKCQlmb3IgKCA7IG47IG4gPSBuLm5leHRTaWJsaW5nICkgewoJCQlpZiAoIG4ubm9kZVR5cGUgPT09IDEgJiYgbiAhPT0gZWxlbSApIHsKCQkJCW1hdGNoZWQucHVzaCggbiApOwoJCQl9CgkJfQoKCQlyZXR1cm4gbWF0Y2hlZDsKCX0KfSk7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWhhczogZnVuY3Rpb24oIHRhcmdldCApIHsKCQl2YXIgdGFyZ2V0cyA9IGpRdWVyeSggdGFyZ2V0LCB0aGlzICksCgkJCWwgPSB0YXJnZXRzLmxlbmd0aDsKCgkJcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCkgewoJCQl2YXIgaSA9IDA7CgkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCB0aGlzLCB0YXJnZXRzW2ldICkgKSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQl9KTsKCX0sCgoJY2xvc2VzdDogZnVuY3Rpb24oIHNlbGVjdG9ycywgY29udGV4dCApIHsKCQl2YXIgY3VyLAoJCQlpID0gMCwKCQkJbCA9IHRoaXMubGVuZ3RoLAoJCQltYXRjaGVkID0gW10sCgkJCXBvcyA9IHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3JzICkgfHwgdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgPwoJCQkJalF1ZXJ5KCBzZWxlY3RvcnMsIGNvbnRleHQgfHwgdGhpcy5jb250ZXh0ICkgOgoJCQkJMDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQlmb3IgKCBjdXIgPSB0aGlzW2ldOyBjdXIgJiYgY3VyICE9PSBjb250ZXh0OyBjdXIgPSBjdXIucGFyZW50Tm9kZSApIHsKCQkJCS8vIEFsd2F5cyBza2lwIGRvY3VtZW50IGZyYWdtZW50cwoJCQkJaWYgKCBjdXIubm9kZVR5cGUgPCAxMSAmJiAocG9zID8KCQkJCQlwb3MuaW5kZXgoY3VyKSA+IC0xIDoKCgkJCQkJLy8gRG9uJ3QgcGFzcyBub24tZWxlbWVudHMgdG8gU2l6emxlCgkJCQkJY3VyLm5vZGVUeXBlID09PSAxICYmCgkJCQkJCWpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihjdXIsIHNlbGVjdG9ycykpICkgewoKCQkJCQltYXRjaGVkLnB1c2goIGN1ciApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIG1hdGNoZWQubGVuZ3RoID4gMSA/IGpRdWVyeS51bmlxdWUoIG1hdGNoZWQgKSA6IG1hdGNoZWQgKTsKCX0sCgoJLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbiB0aGUgc2V0CglpbmRleDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCS8vIE5vIGFyZ3VtZW50LCByZXR1cm4gaW5kZXggaW4gcGFyZW50CgkJaWYgKCAhZWxlbSApIHsKCQkJcmV0dXJuICggdGhpc1sgMCBdICYmIHRoaXNbIDAgXS5wYXJlbnROb2RlICkgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xOwoJCX0KCgkJLy8gSW5kZXggaW4gc2VsZWN0b3IKCQlpZiAoIHR5cGVvZiBlbGVtID09PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIGluZGV4T2YuY2FsbCggalF1ZXJ5KCBlbGVtICksIHRoaXNbIDAgXSApOwoJCX0KCgkJLy8gTG9jYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZGVzaXJlZCBlbGVtZW50CgkJcmV0dXJuIGluZGV4T2YuY2FsbCggdGhpcywKCgkJCS8vIElmIGl0IHJlY2VpdmVzIGEgalF1ZXJ5IG9iamVjdCwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdXNlZAoJCQllbGVtLmpxdWVyeSA/IGVsZW1bIDAgXSA6IGVsZW0KCQkpOwoJfSwKCglhZGQ6IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soCgkJCWpRdWVyeS51bmlxdWUoCgkJCQlqUXVlcnkubWVyZ2UoIHRoaXMuZ2V0KCksIGpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSApCgkJCSkKCQkpOwoJfSwKCglhZGRCYWNrOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMuYWRkKCBzZWxlY3RvciA9PSBudWxsID8KCQkJdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihzZWxlY3RvcikKCQkpOwoJfQp9KTsKCmZ1bmN0aW9uIHNpYmxpbmcoIGN1ciwgZGlyICkgewoJd2hpbGUgKCAoY3VyID0gY3VyW2Rpcl0pICYmIGN1ci5ub2RlVHlwZSAhPT0gMSApIHt9CglyZXR1cm4gY3VyOwp9CgpqUXVlcnkuZWFjaCh7CglwYXJlbnQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CgkJcmV0dXJuIHBhcmVudCAmJiBwYXJlbnQubm9kZVR5cGUgIT09IDExID8gcGFyZW50IDogbnVsbDsKCX0sCglwYXJlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInBhcmVudE5vZGUiICk7Cgl9LAoJcGFyZW50c1VudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwYXJlbnROb2RlIiwgdW50aWwgKTsKCX0sCgluZXh0OiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gc2libGluZyggZWxlbSwgIm5leHRTaWJsaW5nIiApOwoJfSwKCXByZXY6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBzaWJsaW5nKCBlbGVtLCAicHJldmlvdXNTaWJsaW5nIiApOwoJfSwKCW5leHRBbGw6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAibmV4dFNpYmxpbmciICk7Cgl9LAoJcHJldkFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7Cgl9LAoJbmV4dFVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJuZXh0U2libGluZyIsIHVudGlsICk7Cgl9LAoJcHJldlVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciLCB1bnRpbCApOwoJfSwKCXNpYmxpbmdzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LnNpYmxpbmcoICggZWxlbS5wYXJlbnROb2RlIHx8IHt9ICkuZmlyc3RDaGlsZCwgZWxlbSApOwoJfSwKCWNoaWxkcmVuOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LnNpYmxpbmcoIGVsZW0uZmlyc3RDaGlsZCApOwoJfSwKCWNvbnRlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gZWxlbS5jb250ZW50RG9jdW1lbnQgfHwgalF1ZXJ5Lm1lcmdlKCBbXSwgZWxlbS5jaGlsZE5vZGVzICk7Cgl9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBmbiApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHVudGlsLCBzZWxlY3RvciApIHsKCQl2YXIgbWF0Y2hlZCA9IGpRdWVyeS5tYXAoIHRoaXMsIGZuLCB1bnRpbCApOwoKCQlpZiAoIG5hbWUuc2xpY2UoIC01ICkgIT09ICJVbnRpbCIgKSB7CgkJCXNlbGVjdG9yID0gdW50aWw7CgkJfQoKCQlpZiAoIHNlbGVjdG9yICYmIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7CgkJCW1hdGNoZWQgPSBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgbWF0Y2hlZCApOwoJCX0KCgkJaWYgKCB0aGlzLmxlbmd0aCA+IDEgKSB7CgkJCS8vIFJlbW92ZSBkdXBsaWNhdGVzCgkJCWlmICggIWd1YXJhbnRlZWRVbmlxdWVbIG5hbWUgXSApIHsKCQkJCWpRdWVyeS51bmlxdWUoIG1hdGNoZWQgKTsKCQkJfQoKCQkJLy8gUmV2ZXJzZSBvcmRlciBmb3IgcGFyZW50cyogYW5kIHByZXYtZGVyaXZhdGl2ZXMKCQkJaWYgKCBycGFyZW50c3ByZXYudGVzdCggbmFtZSApICkgewoJCQkJbWF0Y2hlZC5yZXZlcnNlKCk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggbWF0Y2hlZCApOwoJfTsKfSk7CnZhciBybm90d2hpdGUgPSAoL1xTKy9nKTsKCgoKLy8gU3RyaW5nIHRvIE9iamVjdCBvcHRpb25zIGZvcm1hdCBjYWNoZQp2YXIgb3B0aW9uc0NhY2hlID0ge307CgovLyBDb252ZXJ0IFN0cmluZy1mb3JtYXR0ZWQgb3B0aW9ucyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcyBhbmQgc3RvcmUgaW4gY2FjaGUKZnVuY3Rpb24gY3JlYXRlT3B0aW9ucyggb3B0aW9ucyApIHsKCXZhciBvYmplY3QgPSBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSA9IHt9OwoJalF1ZXJ5LmVhY2goIG9wdGlvbnMubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdLCBmdW5jdGlvbiggXywgZmxhZyApIHsKCQlvYmplY3RbIGZsYWcgXSA9IHRydWU7Cgl9KTsKCXJldHVybiBvYmplY3Q7Cn0KCi8qCiAqIENyZWF0ZSBhIGNhbGxiYWNrIGxpc3QgdXNpbmcgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgogKgogKglvcHRpb25zOiBhbiBvcHRpb25hbCBsaXN0IG9mIHNwYWNlLXNlcGFyYXRlZCBvcHRpb25zIHRoYXQgd2lsbCBjaGFuZ2UgaG93CiAqCQkJdGhlIGNhbGxiYWNrIGxpc3QgYmVoYXZlcyBvciBhIG1vcmUgdHJhZGl0aW9uYWwgb3B0aW9uIG9iamVjdAogKgogKiBCeSBkZWZhdWx0IGEgY2FsbGJhY2sgbGlzdCB3aWxsIGFjdCBsaWtlIGFuIGV2ZW50IGNhbGxiYWNrIGxpc3QgYW5kIGNhbiBiZQogKiAiZmlyZWQiIG11bHRpcGxlIHRpbWVzLgogKgogKiBQb3NzaWJsZSBvcHRpb25zOgogKgogKglvbmNlOgkJCXdpbGwgZW5zdXJlIHRoZSBjYWxsYmFjayBsaXN0IGNhbiBvbmx5IGJlIGZpcmVkIG9uY2UgKGxpa2UgYSBEZWZlcnJlZCkKICoKICoJbWVtb3J5OgkJCXdpbGwga2VlcCB0cmFjayBvZiBwcmV2aW91cyB2YWx1ZXMgYW5kIHdpbGwgY2FsbCBhbnkgY2FsbGJhY2sgYWRkZWQKICoJCQkJCWFmdGVyIHRoZSBsaXN0IGhhcyBiZWVuIGZpcmVkIHJpZ2h0IGF3YXkgd2l0aCB0aGUgbGF0ZXN0ICJtZW1vcml6ZWQiCiAqCQkJCQl2YWx1ZXMgKGxpa2UgYSBEZWZlcnJlZCkKICoKICoJdW5pcXVlOgkJCXdpbGwgZW5zdXJlIGEgY2FsbGJhY2sgY2FuIG9ubHkgYmUgYWRkZWQgb25jZSAobm8gZHVwbGljYXRlIGluIHRoZSBsaXN0KQogKgogKglzdG9wT25GYWxzZToJaW50ZXJydXB0IGNhbGxpbmdzIHdoZW4gYSBjYWxsYmFjayByZXR1cm5zIGZhbHNlCiAqCiAqLwpqUXVlcnkuQ2FsbGJhY2tzID0gZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgoJLy8gQ29udmVydCBvcHRpb25zIGZyb20gU3RyaW5nLWZvcm1hdHRlZCB0byBPYmplY3QtZm9ybWF0dGVkIGlmIG5lZWRlZAoJLy8gKHdlIGNoZWNrIGluIGNhY2hlIGZpcnN0KQoJb3B0aW9ucyA9IHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiA/CgkJKCBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSB8fCBjcmVhdGVPcHRpb25zKCBvcHRpb25zICkgKSA6CgkJalF1ZXJ5LmV4dGVuZCgge30sIG9wdGlvbnMgKTsKCgl2YXIgLy8gTGFzdCBmaXJlIHZhbHVlIChmb3Igbm9uLWZvcmdldHRhYmxlIGxpc3RzKQoJCW1lbW9yeSwKCQkvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCB3YXMgYWxyZWFkeSBmaXJlZAoJCWZpcmVkLAoJCS8vIEZsYWcgdG8ga25vdyBpZiBsaXN0IGlzIGN1cnJlbnRseSBmaXJpbmcKCQlmaXJpbmcsCgkJLy8gRmlyc3QgY2FsbGJhY2sgdG8gZmlyZSAodXNlZCBpbnRlcm5hbGx5IGJ5IGFkZCBhbmQgZmlyZVdpdGgpCgkJZmlyaW5nU3RhcnQsCgkJLy8gRW5kIG9mIHRoZSBsb29wIHdoZW4gZmlyaW5nCgkJZmlyaW5nTGVuZ3RoLAoJCS8vIEluZGV4IG9mIGN1cnJlbnRseSBmaXJpbmcgY2FsbGJhY2sgKG1vZGlmaWVkIGJ5IHJlbW92ZSBpZiBuZWVkZWQpCgkJZmlyaW5nSW5kZXgsCgkJLy8gQWN0dWFsIGNhbGxiYWNrIGxpc3QKCQlsaXN0ID0gW10sCgkJLy8gU3RhY2sgb2YgZmlyZSBjYWxscyBmb3IgcmVwZWF0YWJsZSBsaXN0cwoJCXN0YWNrID0gIW9wdGlvbnMub25jZSAmJiBbXSwKCQkvLyBGaXJlIGNhbGxiYWNrcwoJCWZpcmUgPSBmdW5jdGlvbiggZGF0YSApIHsKCQkJbWVtb3J5ID0gb3B0aW9ucy5tZW1vcnkgJiYgZGF0YTsKCQkJZmlyZWQgPSB0cnVlOwoJCQlmaXJpbmdJbmRleCA9IGZpcmluZ1N0YXJ0IHx8IDA7CgkJCWZpcmluZ1N0YXJ0ID0gMDsKCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCWZpcmluZyA9IHRydWU7CgkJCWZvciAoIDsgbGlzdCAmJiBmaXJpbmdJbmRleCA8IGZpcmluZ0xlbmd0aDsgZmlyaW5nSW5kZXgrKyApIHsKCQkJCWlmICggbGlzdFsgZmlyaW5nSW5kZXggXS5hcHBseSggZGF0YVsgMCBdLCBkYXRhWyAxIF0gKSA9PT0gZmFsc2UgJiYgb3B0aW9ucy5zdG9wT25GYWxzZSApIHsKCQkJCQltZW1vcnkgPSBmYWxzZTsgLy8gVG8gcHJldmVudCBmdXJ0aGVyIGNhbGxzIHVzaW5nIGFkZAoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCWZpcmluZyA9IGZhbHNlOwoJCQlpZiAoIGxpc3QgKSB7CgkJCQlpZiAoIHN0YWNrICkgewoJCQkJCWlmICggc3RhY2subGVuZ3RoICkgewoJCQkJCQlmaXJlKCBzdGFjay5zaGlmdCgpICk7CgkJCQkJfQoJCQkJfSBlbHNlIGlmICggbWVtb3J5ICkgewoJCQkJCWxpc3QgPSBbXTsKCQkJCX0gZWxzZSB7CgkJCQkJc2VsZi5kaXNhYmxlKCk7CgkJCQl9CgkJCX0KCQl9LAoJCS8vIEFjdHVhbCBDYWxsYmFja3Mgb2JqZWN0CgkJc2VsZiA9IHsKCQkJLy8gQWRkIGEgY2FsbGJhY2sgb3IgYSBjb2xsZWN0aW9uIG9mIGNhbGxiYWNrcyB0byB0aGUgbGlzdAoJCQlhZGQ6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBsaXN0ICkgewoJCQkJCS8vIEZpcnN0LCB3ZSBzYXZlIHRoZSBjdXJyZW50IGxlbmd0aAoJCQkJCXZhciBzdGFydCA9IGxpc3QubGVuZ3RoOwoJCQkJCShmdW5jdGlvbiBhZGQoIGFyZ3MgKSB7CgkJCQkJCWpRdWVyeS5lYWNoKCBhcmdzLCBmdW5jdGlvbiggXywgYXJnICkgewoJCQkJCQkJdmFyIHR5cGUgPSBqUXVlcnkudHlwZSggYXJnICk7CgkJCQkJCQlpZiAoIHR5cGUgPT09ICJmdW5jdGlvbiIgKSB7CgkJCQkJCQkJaWYgKCAhb3B0aW9ucy51bmlxdWUgfHwgIXNlbGYuaGFzKCBhcmcgKSApIHsKCQkJCQkJCQkJbGlzdC5wdXNoKCBhcmcgKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgaWYgKCBhcmcgJiYgYXJnLmxlbmd0aCAmJiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJCQkJCQkvLyBJbnNwZWN0IHJlY3Vyc2l2ZWx5CgkJCQkJCQkJYWRkKCBhcmcgKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJfSkoIGFyZ3VtZW50cyApOwoJCQkJCS8vIERvIHdlIG5lZWQgdG8gYWRkIHRoZSBjYWxsYmFja3MgdG8gdGhlCgkJCQkJLy8gY3VycmVudCBmaXJpbmcgYmF0Y2g/CgkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCWZpcmluZ0xlbmd0aCA9IGxpc3QubGVuZ3RoOwoJCQkJCS8vIFdpdGggbWVtb3J5LCBpZiB3ZSdyZSBub3QgZmlyaW5nIHRoZW4KCQkJCQkvLyB3ZSBzaG91bGQgY2FsbCByaWdodCBhd2F5CgkJCQkJfSBlbHNlIGlmICggbWVtb3J5ICkgewoJCQkJCQlmaXJpbmdTdGFydCA9IHN0YXJ0OwoJCQkJCQlmaXJlKCBtZW1vcnkgKTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gUmVtb3ZlIGEgY2FsbGJhY2sgZnJvbSB0aGUgbGlzdAoJCQlyZW1vdmU6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBsaXN0ICkgewoJCQkJCWpRdWVyeS5lYWNoKCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCXZhciBpbmRleDsKCQkJCQkJd2hpbGUgKCAoIGluZGV4ID0galF1ZXJ5LmluQXJyYXkoIGFyZywgbGlzdCwgaW5kZXggKSApID4gLTEgKSB7CgkJCQkJCQlsaXN0LnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCQkJCS8vIEhhbmRsZSBmaXJpbmcgaW5kZXhlcwoJCQkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCQkJaWYgKCBpbmRleCA8PSBmaXJpbmdMZW5ndGggKSB7CgkJCQkJCQkJCWZpcmluZ0xlbmd0aC0tOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoIGluZGV4IDw9IGZpcmluZ0luZGV4ICkgewoJCQkJCQkJCQlmaXJpbmdJbmRleC0tOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIENoZWNrIGlmIGEgZ2l2ZW4gY2FsbGJhY2sgaXMgaW4gdGhlIGxpc3QuCgkJCS8vIElmIG5vIGFyZ3VtZW50IGlzIGdpdmVuLCByZXR1cm4gd2hldGhlciBvciBub3QgbGlzdCBoYXMgY2FsbGJhY2tzIGF0dGFjaGVkLgoJCQloYXM6IGZ1bmN0aW9uKCBmbiApIHsKCQkJCXJldHVybiBmbiA/IGpRdWVyeS5pbkFycmF5KCBmbiwgbGlzdCApID4gLTEgOiAhISggbGlzdCAmJiBsaXN0Lmxlbmd0aCApOwoJCQl9LAoJCQkvLyBSZW1vdmUgYWxsIGNhbGxiYWNrcyBmcm9tIHRoZSBsaXN0CgkJCWVtcHR5OiBmdW5jdGlvbigpIHsKCQkJCWxpc3QgPSBbXTsKCQkJCWZpcmluZ0xlbmd0aCA9IDA7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSGF2ZSB0aGUgbGlzdCBkbyBub3RoaW5nIGFueW1vcmUKCQkJZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gc3RhY2sgPSBtZW1vcnkgPSB1bmRlZmluZWQ7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSXMgaXQgZGlzYWJsZWQ/CgkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhbGlzdDsKCQkJfSwKCQkJLy8gTG9jayB0aGUgbGlzdCBpbiBpdHMgY3VycmVudCBzdGF0ZQoJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCXN0YWNrID0gdW5kZWZpbmVkOwoJCQkJaWYgKCAhbWVtb3J5ICkgewoJCQkJCXNlbGYuZGlzYWJsZSgpOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIElzIGl0IGxvY2tlZD8KCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhc3RhY2s7CgkJCX0sCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJaWYgKCBsaXN0ICYmICggIWZpcmVkIHx8IHN0YWNrICkgKSB7CgkJCQkJYXJncyA9IGFyZ3MgfHwgW107CgkJCQkJYXJncyA9IFsgY29udGV4dCwgYXJncy5zbGljZSA/IGFyZ3Muc2xpY2UoKSA6IGFyZ3MgXTsKCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJc3RhY2sucHVzaCggYXJncyApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWZpcmUoIGFyZ3MgKTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gQ2FsbCBhbGwgdGhlIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHMKCQkJZmlyZTogZnVuY3Rpb24oKSB7CgkJCQlzZWxmLmZpcmVXaXRoKCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBUbyBrbm93IGlmIHRoZSBjYWxsYmFja3MgaGF2ZSBhbHJlYWR5IGJlZW4gY2FsbGVkIGF0IGxlYXN0IG9uY2UKCQkJZmlyZWQ6IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICEhZmlyZWQ7CgkJCX0KCQl9OwoKCXJldHVybiBzZWxmOwp9OwoKCmpRdWVyeS5leHRlbmQoewoKCURlZmVycmVkOiBmdW5jdGlvbiggZnVuYyApIHsKCQl2YXIgdHVwbGVzID0gWwoJCQkJLy8gYWN0aW9uLCBhZGQgbGlzdGVuZXIsIGxpc3RlbmVyIGxpc3QsIGZpbmFsIHN0YXRlCgkJCQlbICJyZXNvbHZlIiwgImRvbmUiLCBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAicmVzb2x2ZWQiIF0sCgkJCQlbICJyZWplY3QiLCAiZmFpbCIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZWplY3RlZCIgXSwKCQkJCVsgIm5vdGlmeSIsICJwcm9ncmVzcyIsIGpRdWVyeS5DYWxsYmFja3MoIm1lbW9yeSIpIF0KCQkJXSwKCQkJc3RhdGUgPSAicGVuZGluZyIsCgkJCXByb21pc2UgPSB7CgkJCQlzdGF0ZTogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlOwoJCQkJfSwKCQkJCWFsd2F5czogZnVuY3Rpb24oKSB7CgkJCQkJZGVmZXJyZWQuZG9uZSggYXJndW1lbnRzICkuZmFpbCggYXJndW1lbnRzICk7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoJCQkJdGhlbjogZnVuY3Rpb24oIC8qIGZuRG9uZSwgZm5GYWlsLCBmblByb2dyZXNzICovICkgewoJCQkJCXZhciBmbnMgPSBhcmd1bWVudHM7CgkJCQkJcmV0dXJuIGpRdWVyeS5EZWZlcnJlZChmdW5jdGlvbiggbmV3RGVmZXIgKSB7CgkJCQkJCWpRdWVyeS5lYWNoKCB0dXBsZXMsIGZ1bmN0aW9uKCBpLCB0dXBsZSApIHsKCQkJCQkJCXZhciBmbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCBmbnNbIGkgXSApICYmIGZuc1sgaSBdOwoJCQkJCQkJLy8gZGVmZXJyZWRbIGRvbmUgfCBmYWlsIHwgcHJvZ3Jlc3MgXSBmb3IgZm9yd2FyZGluZyBhY3Rpb25zIHRvIG5ld0RlZmVyCgkJCQkJCQlkZWZlcnJlZFsgdHVwbGVbMV0gXShmdW5jdGlvbigpIHsKCQkJCQkJCQl2YXIgcmV0dXJuZWQgPSBmbiAmJiBmbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQkJCQkJaWYgKCByZXR1cm5lZCAmJiBqUXVlcnkuaXNGdW5jdGlvbiggcmV0dXJuZWQucHJvbWlzZSApICkgewoJCQkJCQkJCQlyZXR1cm5lZC5wcm9taXNlKCkKCQkJCQkJCQkJCS5kb25lKCBuZXdEZWZlci5yZXNvbHZlICkKCQkJCQkJCQkJCS5mYWlsKCBuZXdEZWZlci5yZWplY3QgKQoJCQkJCQkJCQkJLnByb2dyZXNzKCBuZXdEZWZlci5ub3RpZnkgKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQluZXdEZWZlclsgdHVwbGVbIDAgXSArICJXaXRoIiBdKCB0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywgZm4gPyBbIHJldHVybmVkIF0gOiBhcmd1bWVudHMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgkJCQkJCWZucyA9IG51bGw7CgkJCQkJfSkucHJvbWlzZSgpOwoJCQkJfSwKCQkJCS8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCXByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCQkJcmV0dXJuIG9iaiAhPSBudWxsID8galF1ZXJ5LmV4dGVuZCggb2JqLCBwcm9taXNlICkgOiBwcm9taXNlOwoJCQkJfQoJCQl9LAoJCQlkZWZlcnJlZCA9IHt9OwoKCQkvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgkJcHJvbWlzZS5waXBlID0gcHJvbWlzZS50aGVuOwoKCQkvLyBBZGQgbGlzdC1zcGVjaWZpYyBtZXRob2RzCgkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQl2YXIgbGlzdCA9IHR1cGxlWyAyIF0sCgkJCQlzdGF0ZVN0cmluZyA9IHR1cGxlWyAzIF07CgoJCQkvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoJCQlwcm9taXNlWyB0dXBsZVsxXSBdID0gbGlzdC5hZGQ7CgoJCQkvLyBIYW5kbGUgc3RhdGUKCQkJaWYgKCBzdGF0ZVN0cmluZyApIHsKCQkJCWxpc3QuYWRkKGZ1bmN0aW9uKCkgewoJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQlzdGF0ZSA9IHN0YXRlU3RyaW5nOwoKCQkJCS8vIFsgcmVqZWN0X2xpc3QgfCByZXNvbHZlX2xpc3QgXS5kaXNhYmxlOyBwcm9ncmVzc19saXN0LmxvY2sKCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQl9CgoJCQkvLyBkZWZlcnJlZFsgcmVzb2x2ZSB8IHJlamVjdCB8IG5vdGlmeSBdCgkJCWRlZmVycmVkWyB0dXBsZVswXSBdID0gZnVuY3Rpb24oKSB7CgkJCQlkZWZlcnJlZFsgdHVwbGVbMF0gKyAiV2l0aCIgXSggdGhpcyA9PT0gZGVmZXJyZWQgPyBwcm9taXNlIDogdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfTsKCQkJZGVmZXJyZWRbIHR1cGxlWzBdICsgIldpdGgiIF0gPSBsaXN0LmZpcmVXaXRoOwoJCX0pOwoKCQkvLyBNYWtlIHRoZSBkZWZlcnJlZCBhIHByb21pc2UKCQlwcm9taXNlLnByb21pc2UoIGRlZmVycmVkICk7CgoJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQlpZiAoIGZ1bmMgKSB7CgkJCWZ1bmMuY2FsbCggZGVmZXJyZWQsIGRlZmVycmVkICk7CgkJfQoKCQkvLyBBbGwgZG9uZSEKCQlyZXR1cm4gZGVmZXJyZWQ7Cgl9LAoKCS8vIERlZmVycmVkIGhlbHBlcgoJd2hlbjogZnVuY3Rpb24oIHN1Ym9yZGluYXRlIC8qICwgLi4uLCBzdWJvcmRpbmF0ZU4gKi8gKSB7CgkJdmFyIGkgPSAwLAoJCQlyZXNvbHZlVmFsdWVzID0gc2xpY2UuY2FsbCggYXJndW1lbnRzICksCgkJCWxlbmd0aCA9IHJlc29sdmVWYWx1ZXMubGVuZ3RoLAoKCQkJLy8gdGhlIGNvdW50IG9mIHVuY29tcGxldGVkIHN1Ym9yZGluYXRlcwoJCQlyZW1haW5pbmcgPSBsZW5ndGggIT09IDEgfHwgKCBzdWJvcmRpbmF0ZSAmJiBqUXVlcnkuaXNGdW5jdGlvbiggc3Vib3JkaW5hdGUucHJvbWlzZSApICkgPyBsZW5ndGggOiAwLAoKCQkJLy8gdGhlIG1hc3RlciBEZWZlcnJlZC4gSWYgcmVzb2x2ZVZhbHVlcyBjb25zaXN0IG9mIG9ubHkgYSBzaW5nbGUgRGVmZXJyZWQsIGp1c3QgdXNlIHRoYXQuCgkJCWRlZmVycmVkID0gcmVtYWluaW5nID09PSAxID8gc3Vib3JkaW5hdGUgOiBqUXVlcnkuRGVmZXJyZWQoKSwKCgkJCS8vIFVwZGF0ZSBmdW5jdGlvbiBmb3IgYm90aCByZXNvbHZlIGFuZCBwcm9ncmVzcyB2YWx1ZXMKCQkJdXBkYXRlRnVuYyA9IGZ1bmN0aW9uKCBpLCBjb250ZXh0cywgdmFsdWVzICkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJCQljb250ZXh0c1sgaSBdID0gdGhpczsKCQkJCQl2YWx1ZXNbIGkgXSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gc2xpY2UuY2FsbCggYXJndW1lbnRzICkgOiB2YWx1ZTsKCQkJCQlpZiAoIHZhbHVlcyA9PT0gcHJvZ3Jlc3NWYWx1ZXMgKSB7CgkJCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsKCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoJCQkJCX0KCQkJCX07CgkJCX0sCgoJCQlwcm9ncmVzc1ZhbHVlcywgcHJvZ3Jlc3NDb250ZXh0cywgcmVzb2x2ZUNvbnRleHRzOwoKCQkvLyBBZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlwcm9ncmVzc1ZhbHVlcyA9IG5ldyBBcnJheSggbGVuZ3RoICk7CgkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlyZXNvbHZlQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCXJlc29sdmVWYWx1ZXNbIGkgXS5wcm9taXNlKCkKCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJLmZhaWwoIGRlZmVycmVkLnJlamVjdCApCgkJCQkJCS5wcm9ncmVzcyggdXBkYXRlRnVuYyggaSwgcHJvZ3Jlc3NDb250ZXh0cywgcHJvZ3Jlc3NWYWx1ZXMgKSApOwoJCQkJfSBlbHNlIHsKCQkJCQktLXJlbWFpbmluZzsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gSWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoJCWlmICggIXJlbWFpbmluZyApIHsKCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCX0KCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKCX0KfSk7CgoKLy8gVGhlIGRlZmVycmVkIHVzZWQgb24gRE9NIHJlYWR5CnZhciByZWFkeUxpc3Q7CgpqUXVlcnkuZm4ucmVhZHkgPSBmdW5jdGlvbiggZm4gKSB7CgkvLyBBZGQgdGhlIGNhbGxiYWNrCglqUXVlcnkucmVhZHkucHJvbWlzZSgpLmRvbmUoIGZuICk7CgoJcmV0dXJuIHRoaXM7Cn07CgpqUXVlcnkuZXh0ZW5kKHsKCS8vIElzIHRoZSBET00gcmVhZHkgdG8gYmUgdXNlZD8gU2V0IHRvIHRydWUgb25jZSBpdCBvY2N1cnMuCglpc1JlYWR5OiBmYWxzZSwKCgkvLyBBIGNvdW50ZXIgdG8gdHJhY2sgaG93IG1hbnkgaXRlbXMgdG8gd2FpdCBmb3IgYmVmb3JlCgkvLyB0aGUgcmVhZHkgZXZlbnQgZmlyZXMuIFNlZSAjNjc4MQoJcmVhZHlXYWl0OiAxLAoKCS8vIEhvbGQgKG9yIHJlbGVhc2UpIHRoZSByZWFkeSBldmVudAoJaG9sZFJlYWR5OiBmdW5jdGlvbiggaG9sZCApIHsKCQlpZiAoIGhvbGQgKSB7CgkJCWpRdWVyeS5yZWFkeVdhaXQrKzsKCQl9IGVsc2UgewoJCQlqUXVlcnkucmVhZHkoIHRydWUgKTsKCQl9Cgl9LAoKCS8vIEhhbmRsZSB3aGVuIHRoZSBET00gaXMgcmVhZHkKCXJlYWR5OiBmdW5jdGlvbiggd2FpdCApIHsKCgkJLy8gQWJvcnQgaWYgdGhlcmUgYXJlIHBlbmRpbmcgaG9sZHMgb3Igd2UncmUgYWxyZWFkeSByZWFkeQoJCWlmICggd2FpdCA9PT0gdHJ1ZSA/IC0talF1ZXJ5LnJlYWR5V2FpdCA6IGpRdWVyeS5pc1JlYWR5ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBSZW1lbWJlciB0aGF0IHRoZSBET00gaXMgcmVhZHkKCQlqUXVlcnkuaXNSZWFkeSA9IHRydWU7CgoJCS8vIElmIGEgbm9ybWFsIERPTSBSZWFkeSBldmVudCBmaXJlZCwgZGVjcmVtZW50LCBhbmQgd2FpdCBpZiBuZWVkIGJlCgkJaWYgKCB3YWl0ICE9PSB0cnVlICYmIC0talF1ZXJ5LnJlYWR5V2FpdCA+IDAgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIElmIHRoZXJlIGFyZSBmdW5jdGlvbnMgYm91bmQsIHRvIGV4ZWN1dGUKCQlyZWFkeUxpc3QucmVzb2x2ZVdpdGgoIGRvY3VtZW50LCBbIGpRdWVyeSBdICk7CgoJCS8vIFRyaWdnZXIgYW55IGJvdW5kIHJlYWR5IGV2ZW50cwoJCWlmICggalF1ZXJ5LmZuLnRyaWdnZXJIYW5kbGVyICkgewoJCQlqUXVlcnkoIGRvY3VtZW50ICkudHJpZ2dlckhhbmRsZXIoICJyZWFkeSIgKTsKCQkJalF1ZXJ5KCBkb2N1bWVudCApLm9mZiggInJlYWR5IiApOwoJCX0KCX0KfSk7CgovKioKICogVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXIgYW5kIHNlbGYgY2xlYW51cCBtZXRob2QKICovCmZ1bmN0aW9uIGNvbXBsZXRlZCgpIHsKCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJalF1ZXJ5LnJlYWR5KCk7Cn0KCmpRdWVyeS5yZWFkeS5wcm9taXNlID0gZnVuY3Rpb24oIG9iaiApIHsKCWlmICggIXJlYWR5TGlzdCApIHsKCgkJcmVhZHlMaXN0ID0galF1ZXJ5LkRlZmVycmVkKCk7CgoJCS8vIENhdGNoIGNhc2VzIHdoZXJlICQoZG9jdW1lbnQpLnJlYWR5KCkgaXMgY2FsbGVkIGFmdGVyIHRoZSBicm93c2VyIGV2ZW50IGhhcyBhbHJlYWR5IG9jY3VycmVkLgoJCS8vIFdlIG9uY2UgdHJpZWQgdG8gdXNlIHJlYWR5U3RhdGUgImludGVyYWN0aXZlIiBoZXJlLCBidXQgaXQgY2F1c2VkIGlzc3VlcyBsaWtlIHRoZSBvbmUKCQkvLyBkaXNjb3ZlcmVkIGJ5IENocmlzUyBoZXJlOiBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMjI4MiNjb21tZW50OjE1CgkJaWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJCQkvLyBIYW5kbGUgaXQgYXN5bmNocm9ub3VzbHkgdG8gYWxsb3cgc2NyaXB0cyB0aGUgb3Bwb3J0dW5pdHkgdG8gZGVsYXkgcmVhZHkKCQkJc2V0VGltZW91dCggalF1ZXJ5LnJlYWR5ICk7CgoJCX0gZWxzZSB7CgoJCQkvLyBVc2UgdGhlIGhhbmR5IGV2ZW50IGNhbGxiYWNrCgkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkLCBmYWxzZSApOwoKCQkJLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsKCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJCX0KCX0KCXJldHVybiByZWFkeUxpc3QucHJvbWlzZSggb2JqICk7Cn07CgovLyBLaWNrIG9mZiB0aGUgRE9NIHJlYWR5IGNoZWNrIGV2ZW4gaWYgdGhlIHVzZXIgZG9lcyBub3QKalF1ZXJ5LnJlYWR5LnByb21pc2UoKTsKCgoKCi8vIE11bHRpZnVuY3Rpb25hbCBtZXRob2QgdG8gZ2V0IGFuZCBzZXQgdmFsdWVzIG9mIGEgY29sbGVjdGlvbgovLyBUaGUgdmFsdWUvcyBjYW4gb3B0aW9uYWxseSBiZSBleGVjdXRlZCBpZiBpdCdzIGEgZnVuY3Rpb24KdmFyIGFjY2VzcyA9IGpRdWVyeS5hY2Nlc3MgPSBmdW5jdGlvbiggZWxlbXMsIGZuLCBrZXksIHZhbHVlLCBjaGFpbmFibGUsIGVtcHR5R2V0LCByYXcgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gZWxlbXMubGVuZ3RoLAoJCWJ1bGsgPSBrZXkgPT0gbnVsbDsKCgkvLyBTZXRzIG1hbnkgdmFsdWVzCglpZiAoIGpRdWVyeS50eXBlKCBrZXkgKSA9PT0gIm9iamVjdCIgKSB7CgkJY2hhaW5hYmxlID0gdHJ1ZTsKCQlmb3IgKCBpIGluIGtleSApIHsKCQkJalF1ZXJ5LmFjY2VzcyggZWxlbXMsIGZuLCBpLCBrZXlbaV0sIHRydWUsIGVtcHR5R2V0LCByYXcgKTsKCQl9CgoJLy8gU2V0cyBvbmUgdmFsdWUKCX0gZWxzZSBpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJY2hhaW5hYmxlID0gdHJ1ZTsKCgkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJhdyA9IHRydWU7CgkJfQoKCQlpZiAoIGJ1bGsgKSB7CgkJCS8vIEJ1bGsgb3BlcmF0aW9ucyBydW4gYWdhaW5zdCB0aGUgZW50aXJlIHNldAoJCQlpZiAoIHJhdyApIHsKCQkJCWZuLmNhbGwoIGVsZW1zLCB2YWx1ZSApOwoJCQkJZm4gPSBudWxsOwoKCQkJLy8gLi4uZXhjZXB0IHdoZW4gZXhlY3V0aW5nIGZ1bmN0aW9uIHZhbHVlcwoJCQl9IGVsc2UgewoJCQkJYnVsayA9IGZuOwoJCQkJZm4gPSBmdW5jdGlvbiggZWxlbSwga2V5LCB2YWx1ZSApIHsKCQkJCQlyZXR1cm4gYnVsay5jYWxsKCBqUXVlcnkoIGVsZW0gKSwgdmFsdWUgKTsKCQkJCX07CgkJCX0KCQl9CgoJCWlmICggZm4gKSB7CgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJZm4oIGVsZW1zW2ldLCBrZXksIHJhdyA/IHZhbHVlIDogdmFsdWUuY2FsbCggZWxlbXNbaV0sIGksIGZuKCBlbGVtc1tpXSwga2V5ICkgKSApOwoJCQl9CgkJfQoJfQoKCXJldHVybiBjaGFpbmFibGUgPwoJCWVsZW1zIDoKCgkJLy8gR2V0cwoJCWJ1bGsgPwoJCQlmbi5jYWxsKCBlbGVtcyApIDoKCQkJbGVuID8gZm4oIGVsZW1zWzBdLCBrZXkgKSA6IGVtcHR5R2V0Owp9OwoKCi8qKgogKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gb2JqZWN0IGNhbiBoYXZlIGRhdGEKICovCmpRdWVyeS5hY2NlcHREYXRhID0gZnVuY3Rpb24oIG93bmVyICkgewoJLy8gQWNjZXB0cyBvbmx5OgoJLy8gIC0gTm9kZQoJLy8gICAgLSBOb2RlLkVMRU1FTlRfTk9ERQoJLy8gICAgLSBOb2RlLkRPQ1VNRU5UX05PREUKCS8vICAtIE9iamVjdAoJLy8gICAgLSBBbnkKCS8qIGpzaGludCAtVzAxOCAqLwoJcmV0dXJuIG93bmVyLm5vZGVUeXBlID09PSAxIHx8IG93bmVyLm5vZGVUeXBlID09PSA5IHx8ICEoICtvd25lci5ub2RlVHlwZSApOwp9OwoKCmZ1bmN0aW9uIERhdGEoKSB7CgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQsCgkvLyBPbGQgV2ViS2l0IGRvZXMgbm90IGhhdmUgT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zL2ZyZWV6ZSBtZXRob2QsCgkvLyByZXR1cm4gbmV3IGVtcHR5IG9iamVjdCBpbnN0ZWFkIHdpdGggbm8gW1tzZXRdXSBhY2Nlc3NvcgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLmNhY2hlID0ge30sIDAsIHsKCQlnZXQ6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4ge307CgkJfQoJfSk7CgoJdGhpcy5leHBhbmRvID0galF1ZXJ5LmV4cGFuZG8gKyBEYXRhLnVpZCsrOwp9CgpEYXRhLnVpZCA9IDE7CkRhdGEuYWNjZXB0cyA9IGpRdWVyeS5hY2NlcHREYXRhOwoKRGF0YS5wcm90b3R5cGUgPSB7CglrZXk6IGZ1bmN0aW9uKCBvd25lciApIHsKCQkvLyBXZSBjYW4gYWNjZXB0IGRhdGEgZm9yIG5vbi1lbGVtZW50IG5vZGVzIGluIG1vZGVybiBicm93c2VycywKCQkvLyBidXQgd2Ugc2hvdWxkIG5vdCwgc2VlICM4MzM1LgoJCS8vIEFsd2F5cyByZXR1cm4gdGhlIGtleSBmb3IgYSBmcm96ZW4gb2JqZWN0LgoJCWlmICggIURhdGEuYWNjZXB0cyggb3duZXIgKSApIHsKCQkJcmV0dXJuIDA7CgkJfQoKCQl2YXIgZGVzY3JpcHRvciA9IHt9LAoJCQkvLyBDaGVjayBpZiB0aGUgb3duZXIgb2JqZWN0IGFscmVhZHkgaGFzIGEgY2FjaGUga2V5CgkJCXVubG9jayA9IG93bmVyWyB0aGlzLmV4cGFuZG8gXTsKCgkJLy8gSWYgbm90LCBjcmVhdGUgb25lCgkJaWYgKCAhdW5sb2NrICkgewoJCQl1bmxvY2sgPSBEYXRhLnVpZCsrOwoKCQkJLy8gU2VjdXJlIGl0IGluIGEgbm9uLWVudW1lcmFibGUsIG5vbi13cml0YWJsZSBwcm9wZXJ0eQoJCQl0cnkgewoJCQkJZGVzY3JpcHRvclsgdGhpcy5leHBhbmRvIF0gPSB7IHZhbHVlOiB1bmxvY2sgfTsKCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBvd25lciwgZGVzY3JpcHRvciApOwoKCQkJLy8gU3VwcG9ydDogQW5kcm9pZDw0CgkJCS8vIEZhbGxiYWNrIHRvIGEgbGVzcyBzZWN1cmUgZGVmaW5pdGlvbgoJCQl9IGNhdGNoICggZSApIHsKCQkJCWRlc2NyaXB0b3JbIHRoaXMuZXhwYW5kbyBdID0gdW5sb2NrOwoJCQkJalF1ZXJ5LmV4dGVuZCggb3duZXIsIGRlc2NyaXB0b3IgKTsKCQkJfQoJCX0KCgkJLy8gRW5zdXJlIHRoZSBjYWNoZSBvYmplY3QKCQlpZiAoICF0aGlzLmNhY2hlWyB1bmxvY2sgXSApIHsKCQkJdGhpcy5jYWNoZVsgdW5sb2NrIF0gPSB7fTsKCQl9CgoJCXJldHVybiB1bmxvY2s7Cgl9LAoJc2V0OiBmdW5jdGlvbiggb3duZXIsIGRhdGEsIHZhbHVlICkgewoJCXZhciBwcm9wLAoJCQkvLyBUaGVyZSBtYXkgYmUgYW4gdW5sb2NrIGFzc2lnbmVkIHRvIHRoaXMgbm9kZSwKCQkJLy8gaWYgdGhlcmUgaXMgbm8gZW50cnkgZm9yIHRoaXMgIm93bmVyIiwgY3JlYXRlIG9uZSBpbmxpbmUKCQkJLy8gYW5kIHNldCB0aGUgdW5sb2NrIGFzIHRob3VnaCBhbiBvd25lciBlbnRyeSBoYWQgYWx3YXlzIGV4aXN0ZWQKCQkJdW5sb2NrID0gdGhpcy5rZXkoIG93bmVyICksCgkJCWNhY2hlID0gdGhpcy5jYWNoZVsgdW5sb2NrIF07CgoJCS8vIEhhbmRsZTogWyBvd25lciwga2V5LCB2YWx1ZSBdIGFyZ3MKCQlpZiAoIHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiApIHsKCQkJY2FjaGVbIGRhdGEgXSA9IHZhbHVlOwoKCQkvLyBIYW5kbGU6IFsgb3duZXIsIHsgcHJvcGVydGllcyB9IF0gYXJncwoJCX0gZWxzZSB7CgkJCS8vIEZyZXNoIGFzc2lnbm1lbnRzIGJ5IG9iamVjdCBhcmUgc2hhbGxvdyBjb3BpZWQKCQkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggY2FjaGUgKSApIHsKCQkJCWpRdWVyeS5leHRlbmQoIHRoaXMuY2FjaGVbIHVubG9jayBdLCBkYXRhICk7CgkJCS8vIE90aGVyd2lzZSwgY29weSB0aGUgcHJvcGVydGllcyBvbmUtYnktb25lIHRvIHRoZSBjYWNoZSBvYmplY3QKCQkJfSBlbHNlIHsKCQkJCWZvciAoIHByb3AgaW4gZGF0YSApIHsKCQkJCQljYWNoZVsgcHJvcCBdID0gZGF0YVsgcHJvcCBdOwoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBjYWNoZTsKCX0sCglnZXQ6IGZ1bmN0aW9uKCBvd25lciwga2V5ICkgewoJCS8vIEVpdGhlciBhIHZhbGlkIGNhY2hlIGlzIGZvdW5kLCBvciB3aWxsIGJlIGNyZWF0ZWQuCgkJLy8gTmV3IGNhY2hlcyB3aWxsIGJlIGNyZWF0ZWQgYW5kIHRoZSB1bmxvY2sgcmV0dXJuZWQsCgkJLy8gYWxsb3dpbmcgZGlyZWN0IGFjY2VzcyB0byB0aGUgbmV3bHkgY3JlYXRlZAoJCS8vIGVtcHR5IGRhdGEgb2JqZWN0LiBBIHZhbGlkIG93bmVyIG9iamVjdCBtdXN0IGJlIHByb3ZpZGVkLgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGVbIHRoaXMua2V5KCBvd25lciApIF07CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCA/CgkJCWNhY2hlIDogY2FjaGVbIGtleSBdOwoJfSwKCWFjY2VzczogZnVuY3Rpb24oIG93bmVyLCBrZXksIHZhbHVlICkgewoJCXZhciBzdG9yZWQ7CgkJLy8gSW4gY2FzZXMgd2hlcmUgZWl0aGVyOgoJCS8vCgkJLy8gICAxLiBObyBrZXkgd2FzIHNwZWNpZmllZAoJCS8vICAgMi4gQSBzdHJpbmcga2V5IHdhcyBzcGVjaWZpZWQsIGJ1dCBubyB2YWx1ZSBwcm92aWRlZAoJCS8vCgkJLy8gVGFrZSB0aGUgInJlYWQiIHBhdGggYW5kIGFsbG93IHRoZSBnZXQgbWV0aG9kIHRvIGRldGVybWluZQoJCS8vIHdoaWNoIHZhbHVlIHRvIHJldHVybiwgcmVzcGVjdGl2ZWx5IGVpdGhlcjoKCQkvLwoJCS8vICAgMS4gVGhlIGVudGlyZSBjYWNoZSBvYmplY3QKCQkvLyAgIDIuIFRoZSBkYXRhIHN0b3JlZCBhdCB0aGUga2V5CgkJLy8KCQlpZiAoIGtleSA9PT0gdW5kZWZpbmVkIHx8CgkJCQkoKGtleSAmJiB0eXBlb2Yga2V5ID09PSAic3RyaW5nIikgJiYgdmFsdWUgPT09IHVuZGVmaW5lZCkgKSB7CgoJCQlzdG9yZWQgPSB0aGlzLmdldCggb3duZXIsIGtleSApOwoKCQkJcmV0dXJuIHN0b3JlZCAhPT0gdW5kZWZpbmVkID8KCQkJCXN0b3JlZCA6IHRoaXMuZ2V0KCBvd25lciwgalF1ZXJ5LmNhbWVsQ2FzZShrZXkpICk7CgkJfQoKCQkvLyBbKl1XaGVuIHRoZSBrZXkgaXMgbm90IGEgc3RyaW5nLCBvciBib3RoIGEga2V5IGFuZCB2YWx1ZQoJCS8vIGFyZSBzcGVjaWZpZWQsIHNldCBvciBleHRlbmQgKGV4aXN0aW5nIG9iamVjdHMpIHdpdGggZWl0aGVyOgoJCS8vCgkJLy8gICAxLiBBbiBvYmplY3Qgb2YgcHJvcGVydGllcwoJCS8vICAgMi4gQSBrZXkgYW5kIHZhbHVlCgkJLy8KCQl0aGlzLnNldCggb3duZXIsIGtleSwgdmFsdWUgKTsKCgkJLy8gU2luY2UgdGhlICJzZXQiIHBhdGggY2FuIGhhdmUgdHdvIHBvc3NpYmxlIGVudHJ5IHBvaW50cwoJCS8vIHJldHVybiB0aGUgZXhwZWN0ZWQgZGF0YSBiYXNlZCBvbiB3aGljaCBwYXRoIHdhcyB0YWtlblsqXQoJCXJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiBrZXk7Cgl9LAoJcmVtb3ZlOiBmdW5jdGlvbiggb3duZXIsIGtleSApIHsKCQl2YXIgaSwgbmFtZSwgY2FtZWwsCgkJCXVubG9jayA9IHRoaXMua2V5KCBvd25lciApLAoJCQljYWNoZSA9IHRoaXMuY2FjaGVbIHVubG9jayBdOwoKCQlpZiAoIGtleSA9PT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLmNhY2hlWyB1bmxvY2sgXSA9IHt9OwoKCQl9IGVsc2UgewoJCQkvLyBTdXBwb3J0IGFycmF5IG9yIHNwYWNlIHNlcGFyYXRlZCBzdHJpbmcgb2Yga2V5cwoJCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBrZXkgKSApIHsKCQkJCS8vIElmICJuYW1lIiBpcyBhbiBhcnJheSBvZiBrZXlzLi4uCgkJCQkvLyBXaGVuIGRhdGEgaXMgaW5pdGlhbGx5IGNyZWF0ZWQsIHZpYSAoImtleSIsICJ2YWwiKSBzaWduYXR1cmUsCgkJCQkvLyBrZXlzIHdpbGwgYmUgY29udmVydGVkIHRvIGNhbWVsQ2FzZS4KCQkJCS8vIFNpbmNlIHRoZXJlIGlzIG5vIHdheSB0byB0ZWxsIF9ob3dfIGEga2V5IHdhcyBhZGRlZCwgcmVtb3ZlCgkJCQkvLyBib3RoIHBsYWluIGtleSBhbmQgY2FtZWxDYXNlIGtleS4gIzEyNzg2CgkJCQkvLyBUaGlzIHdpbGwgb25seSBwZW5hbGl6ZSB0aGUgYXJyYXkgYXJndW1lbnQgcGF0aC4KCQkJCW5hbWUgPSBrZXkuY29uY2F0KCBrZXkubWFwKCBqUXVlcnkuY2FtZWxDYXNlICkgKTsKCQkJfSBlbHNlIHsKCQkJCWNhbWVsID0galF1ZXJ5LmNhbWVsQ2FzZSgga2V5ICk7CgkJCQkvLyBUcnkgdGhlIHN0cmluZyBhcyBhIGtleSBiZWZvcmUgYW55IG1hbmlwdWxhdGlvbgoJCQkJaWYgKCBrZXkgaW4gY2FjaGUgKSB7CgkJCQkJbmFtZSA9IFsga2V5LCBjYW1lbCBdOwoJCQkJfSBlbHNlIHsKCQkJCQkvLyBJZiBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzLCB1c2UgaXQuCgkJCQkJLy8gT3RoZXJ3aXNlLCBjcmVhdGUgYW4gYXJyYXkgYnkgbWF0Y2hpbmcgbm9uLXdoaXRlc3BhY2UKCQkJCQluYW1lID0gY2FtZWw7CgkJCQkJbmFtZSA9IG5hbWUgaW4gY2FjaGUgPwoJCQkJCQlbIG5hbWUgXSA6ICggbmFtZS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW10gKTsKCQkJCX0KCQkJfQoKCQkJaSA9IG5hbWUubGVuZ3RoOwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWRlbGV0ZSBjYWNoZVsgbmFtZVsgaSBdIF07CgkJCX0KCQl9Cgl9LAoJaGFzRGF0YTogZnVuY3Rpb24oIG93bmVyICkgewoJCXJldHVybiAhalF1ZXJ5LmlzRW1wdHlPYmplY3QoCgkJCXRoaXMuY2FjaGVbIG93bmVyWyB0aGlzLmV4cGFuZG8gXSBdIHx8IHt9CgkJKTsKCX0sCglkaXNjYXJkOiBmdW5jdGlvbiggb3duZXIgKSB7CgkJaWYgKCBvd25lclsgdGhpcy5leHBhbmRvIF0gKSB7CgkJCWRlbGV0ZSB0aGlzLmNhY2hlWyBvd25lclsgdGhpcy5leHBhbmRvIF0gXTsKCQl9Cgl9Cn07CnZhciBkYXRhX3ByaXYgPSBuZXcgRGF0YSgpOwoKdmFyIGRhdGFfdXNlciA9IG5ldyBEYXRhKCk7CgoKCi8vCUltcGxlbWVudGF0aW9uIFN1bW1hcnkKLy8KLy8JMS4gRW5mb3JjZSBBUEkgc3VyZmFjZSBhbmQgc2VtYW50aWMgY29tcGF0aWJpbGl0eSB3aXRoIDEuOS54IGJyYW5jaAovLwkyLiBJbXByb3ZlIHRoZSBtb2R1bGUncyBtYWludGFpbmFiaWxpdHkgYnkgcmVkdWNpbmcgdGhlIHN0b3JhZ2UKLy8JCXBhdGhzIHRvIGEgc2luZ2xlIG1lY2hhbmlzbS4KLy8JMy4gVXNlIHRoZSBzYW1lIHNpbmdsZSBtZWNoYW5pc20gdG8gc3VwcG9ydCAicHJpdmF0ZSIgYW5kICJ1c2VyIiBkYXRhLgovLwk0LiBfTmV2ZXJfIGV4cG9zZSAicHJpdmF0ZSIgZGF0YSB0byB1c2VyIGNvZGUgKFRPRE86IERyb3AgX2RhdGEsIF9yZW1vdmVEYXRhKQovLwk1LiBBdm9pZCBleHBvc2luZyBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIG9uIHVzZXIgb2JqZWN0cyAoZWcuIGV4cGFuZG8gcHJvcGVydGllcykKLy8JNi4gUHJvdmlkZSBhIGNsZWFyIHBhdGggZm9yIGltcGxlbWVudGF0aW9uIHVwZ3JhZGUgdG8gV2Vha01hcCBpbiAyMDE0Cgp2YXIgcmJyYWNlID0gL14oPzpce1tcd1xXXSpcfXxcW1tcd1xXXSpcXSkkLywKCXJtdWx0aURhc2ggPSAvKFtBLVpdKS9nOwoKZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHsKCXZhciBuYW1lOwoKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQluYW1lID0gImRhdGEtIiArIGtleS5yZXBsYWNlKCBybXVsdGlEYXNoLCAiLSQxIiApLnRvTG93ZXJDYXNlKCk7CgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJZGF0YSA9PT0gIm51bGwiID8gbnVsbCA6CgkJCQkJLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKCQkJCQkrZGF0YSArICIiID09PSBkYXRhID8gK2RhdGEgOgoJCQkJCXJicmFjZS50ZXN0KCBkYXRhICkgPyBqUXVlcnkucGFyc2VKU09OKCBkYXRhICkgOgoJCQkJCWRhdGE7CgkJCX0gY2F0Y2goIGUgKSB7fQoKCQkJLy8gTWFrZSBzdXJlIHdlIHNldCB0aGUgZGF0YSBzbyBpdCBpc24ndCBjaGFuZ2VkIGxhdGVyCgkJCWRhdGFfdXNlci5zZXQoIGVsZW0sIGtleSwgZGF0YSApOwoJCX0gZWxzZSB7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoJfQoJcmV0dXJuIGRhdGE7Cn0KCmpRdWVyeS5leHRlbmQoewoJaGFzRGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGRhdGFfdXNlci5oYXNEYXRhKCBlbGVtICkgfHwgZGF0YV9wcml2Lmhhc0RhdGEoIGVsZW0gKTsKCX0sCgoJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGRhdGFfdXNlci5hY2Nlc3MoIGVsZW0sIG5hbWUsIGRhdGEgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJZGF0YV91c2VyLnJlbW92ZSggZWxlbSwgbmFtZSApOwoJfSwKCgkvLyBUT0RPOiBOb3cgdGhhdCBhbGwgY2FsbHMgdG8gX2RhdGEgYW5kIF9yZW1vdmVEYXRhIGhhdmUgYmVlbiByZXBsYWNlZAoJLy8gd2l0aCBkaXJlY3QgY2FsbHMgdG8gZGF0YV9wcml2IG1ldGhvZHMsIHRoZXNlIGNhbiBiZSBkZXByZWNhdGVkLgoJX2RhdGE6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBkYXRhICkgewoJCXJldHVybiBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCBuYW1lLCBkYXRhICk7Cgl9LAoKCV9yZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlkYXRhX3ByaXYucmVtb3ZlKCBlbGVtLCBuYW1lICk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglkYXRhOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgaSwgbmFtZSwgZGF0YSwKCQkJZWxlbSA9IHRoaXNbIDAgXSwKCQkJYXR0cnMgPSBlbGVtICYmIGVsZW0uYXR0cmlidXRlczsKCgkJLy8gR2V0cyBhbGwgdmFsdWVzCgkJaWYgKCBrZXkgPT09IHVuZGVmaW5lZCApIHsKCQkJaWYgKCB0aGlzLmxlbmd0aCApIHsKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtICk7CgoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICFkYXRhX3ByaXYuZ2V0KCBlbGVtLCAiaGFzRGF0YUF0dHJzIiApICkgewoJCQkJCWkgPSBhdHRycy5sZW5ndGg7CgkJCQkJd2hpbGUgKCBpLS0gKSB7CgoJCQkJCQkvLyBTdXBwb3J0OiBJRTExKwoJCQkJCQkvLyBUaGUgYXR0cnMgZWxlbWVudHMgY2FuIGJlIG51bGwgKCMxNDg5NCkKCQkJCQkJaWYgKCBhdHRyc1sgaSBdICkgewoJCQkJCQkJbmFtZSA9IGF0dHJzWyBpIF0ubmFtZTsKCQkJCQkJCWlmICggbmFtZS5pbmRleE9mKCAiZGF0YS0iICkgPT09IDAgKSB7CgkJCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUuc2xpY2UoNSkgKTsKCQkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJZGF0YV9wcml2LnNldCggZWxlbSwgImhhc0RhdGFBdHRycyIsIHRydWUgKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIGRhdGE7CgkJfQoKCQkvLyBTZXRzIG11bHRpcGxlIHZhbHVlcwoJCWlmICggdHlwZW9mIGtleSA9PT0gIm9iamVjdCIgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlkYXRhX3VzZXIuc2V0KCB0aGlzLCBrZXkgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciBkYXRhLAoJCQkJY2FtZWxLZXkgPSBqUXVlcnkuY2FtZWxDYXNlKCBrZXkgKTsKCgkJCS8vIFRoZSBjYWxsaW5nIGpRdWVyeSBvYmplY3QgKGVsZW1lbnQgbWF0Y2hlcykgaXMgbm90IGVtcHR5CgkJCS8vIChhbmQgdGhlcmVmb3JlIGhhcyBhbiBlbGVtZW50IGFwcGVhcnMgYXQgdGhpc1sgMCBdKSBhbmQgdGhlCgkJCS8vIGB2YWx1ZWAgcGFyYW1ldGVyIHdhcyBub3QgdW5kZWZpbmVkLiBBbiBlbXB0eSBqUXVlcnkgb2JqZWN0CgkJCS8vIHdpbGwgcmVzdWx0IGluIGB1bmRlZmluZWRgIGZvciBlbGVtID0gdGhpc1sgMCBdIHdoaWNoIHdpbGwKCQkJLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGFuIGF0dGVtcHQgdG8gcmVhZCBhIGRhdGEgY2FjaGUgaXMgbWFkZS4KCQkJaWYgKCBlbGVtICYmIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCQkvLyBBdHRlbXB0IHRvIGdldCBkYXRhIGZyb20gdGhlIGNhY2hlCgkJCQkvLyB3aXRoIHRoZSBrZXkgYXMtaXMKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtLCBrZXkgKTsKCQkJCWlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiBkYXRhOwoJCQkJfQoKCQkJCS8vIEF0dGVtcHQgdG8gZ2V0IGRhdGEgZnJvbSB0aGUgY2FjaGUKCQkJCS8vIHdpdGggdGhlIGtleSBjYW1lbGl6ZWQKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtLCBjYW1lbEtleSApOwoJCQkJaWYgKCBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJcmV0dXJuIGRhdGE7CgkJCQl9CgoJCQkJLy8gQXR0ZW1wdCB0byAiZGlzY292ZXIiIHRoZSBkYXRhIGluCgkJCQkvLyBIVE1MNSBjdXN0b20gZGF0YS0qIGF0dHJzCgkJCQlkYXRhID0gZGF0YUF0dHIoIGVsZW0sIGNhbWVsS2V5LCB1bmRlZmluZWQgKTsKCQkJCWlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiBkYXRhOwoJCQkJfQoKCQkJCS8vIFdlIHRyaWVkIHJlYWxseSBoYXJkLCBidXQgdGhlIGRhdGEgZG9lc24ndCBleGlzdC4KCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU2V0IHRoZSBkYXRhLi4uCgkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCS8vIEZpcnN0LCBhdHRlbXB0IHRvIHN0b3JlIGEgY29weSBvciByZWZlcmVuY2Ugb2YgYW55CgkJCQkvLyBkYXRhIHRoYXQgbWlnaHQndmUgYmVlbiBzdG9yZSB3aXRoIGEgY2FtZWxDYXNlZCBrZXkuCgkJCQl2YXIgZGF0YSA9IGRhdGFfdXNlci5nZXQoIHRoaXMsIGNhbWVsS2V5ICk7CgoJCQkJLy8gRm9yIEhUTUw1IGRhdGEtKiBhdHRyaWJ1dGUgaW50ZXJvcCwgd2UgaGF2ZSB0bwoJCQkJLy8gc3RvcmUgcHJvcGVydHkgbmFtZXMgd2l0aCBkYXNoZXMgaW4gYSBjYW1lbENhc2UgZm9ybS4KCQkJCS8vIFRoaXMgbWlnaHQgbm90IGFwcGx5IHRvIGFsbCBwcm9wZXJ0aWVzLi4uKgoJCQkJZGF0YV91c2VyLnNldCggdGhpcywgY2FtZWxLZXksIHZhbHVlICk7CgoJCQkJLy8gKi4uLiBJbiB0aGUgY2FzZSBvZiBwcm9wZXJ0aWVzIHRoYXQgbWlnaHQgX2FjdHVhbGx5XwoJCQkJLy8gaGF2ZSBkYXNoZXMsIHdlIG5lZWQgdG8gYWxzbyBzdG9yZSBhIGNvcHkgb2YgdGhhdAoJCQkJLy8gdW5jaGFuZ2VkIHByb3BlcnR5LgoJCQkJaWYgKCBrZXkuaW5kZXhPZigiLSIpICE9PSAtMSAmJiBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJZGF0YV91c2VyLnNldCggdGhpcywga2V5LCB2YWx1ZSApOwoJCQkJfQoJCQl9KTsKCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsIHRydWUgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlkYXRhX3VzZXIucmVtb3ZlKCB0aGlzLCBrZXkgKTsKCQl9KTsKCX0KfSk7CgoKalF1ZXJ5LmV4dGVuZCh7CglxdWV1ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGRhdGEgKSB7CgkJdmFyIHF1ZXVlOwoKCQlpZiAoIGVsZW0gKSB7CgkJCXR5cGUgPSAoIHR5cGUgfHwgImZ4IiApICsgInF1ZXVlIjsKCQkJcXVldWUgPSBkYXRhX3ByaXYuZ2V0KCBlbGVtLCB0eXBlICk7CgoJCQkvLyBTcGVlZCB1cCBkZXF1ZXVlIGJ5IGdldHRpbmcgb3V0IHF1aWNrbHkgaWYgdGhpcyBpcyBqdXN0IGEgbG9va3VwCgkJCWlmICggZGF0YSApIHsKCQkJCWlmICggIXF1ZXVlIHx8IGpRdWVyeS5pc0FycmF5KCBkYXRhICkgKSB7CgkJCQkJcXVldWUgPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpICk7CgkJCQl9IGVsc2UgewoJCQkJCXF1ZXVlLnB1c2goIGRhdGEgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gcXVldWUgfHwgW107CgkJfQoJfSwKCglkZXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJc3RhcnRMZW5ndGggPSBxdWV1ZS5sZW5ndGgsCgkJCWZuID0gcXVldWUuc2hpZnQoKSwKCQkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sIHR5cGUgKSwKCQkJbmV4dCA9IGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRlcXVldWUoIGVsZW0sIHR5cGUgKTsKCQkJfTsKCgkJLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbAoJCWlmICggZm4gPT09ICJpbnByb2dyZXNzIiApIHsKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpOwoJCQlzdGFydExlbmd0aC0tOwoJCX0KCgkJaWYgKCBmbiApIHsKCgkJCS8vIEFkZCBhIHByb2dyZXNzIHNlbnRpbmVsIHRvIHByZXZlbnQgdGhlIGZ4IHF1ZXVlIGZyb20gYmVpbmcKCQkJLy8gYXV0b21hdGljYWxseSBkZXF1ZXVlZAoJCQlpZiAoIHR5cGUgPT09ICJmeCIgKSB7CgkJCQlxdWV1ZS51bnNoaWZ0KCAiaW5wcm9ncmVzcyIgKTsKCQkJfQoKCQkJLy8gQ2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJZm4uY2FsbCggZWxlbSwgbmV4dCwgaG9va3MgKTsKCQl9CgoJCWlmICggIXN0YXJ0TGVuZ3RoICYmIGhvb2tzICkgewoJCQlob29rcy5lbXB0eS5maXJlKCk7CgkJfQoJfSwKCgkvLyBOb3QgcHVibGljIC0gZ2VuZXJhdGUgYSBxdWV1ZUhvb2tzIG9iamVjdCwgb3IgcmV0dXJuIHRoZSBjdXJyZW50IG9uZQoJX3F1ZXVlSG9va3M6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCXJldHVybiBkYXRhX3ByaXYuZ2V0KCBlbGVtLCBrZXkgKSB8fCBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCBrZXksIHsKCQkJZW1wdHk6IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IikuYWRkKGZ1bmN0aW9uKCkgewoJCQkJZGF0YV9wcml2LnJlbW92ZSggZWxlbSwgWyB0eXBlICsgInF1ZXVlIiwga2V5IF0gKTsKCQkJfSkKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCXF1ZXVlOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHsKCQl2YXIgc2V0dGVyID0gMjsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCWRhdGEgPSB0eXBlOwoJCQl0eXBlID0gImZ4IjsKCQkJc2V0dGVyLS07CgkJfQoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPCBzZXR0ZXIgKSB7CgkJCXJldHVybiBqUXVlcnkucXVldWUoIHRoaXNbMF0sIHR5cGUgKTsKCQl9CgoJCXJldHVybiBkYXRhID09PSB1bmRlZmluZWQgPwoJCQl0aGlzIDoKCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIHF1ZXVlID0galF1ZXJ5LnF1ZXVlKCB0aGlzLCB0eXBlLCBkYXRhICk7CgoJCQkJLy8gRW5zdXJlIGEgaG9va3MgZm9yIHRoaXMgcXVldWUKCQkJCWpRdWVyeS5fcXVldWVIb29rcyggdGhpcywgdHlwZSApOwoKCQkJCWlmICggdHlwZSA9PT0gImZ4IiAmJiBxdWV1ZVswXSAhPT0gImlucHJvZ3Jlc3MiICkgewoJCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCQl9CgkJCX0pOwoJfSwKCWRlcXVldWU6IGZ1bmN0aW9uKCB0eXBlICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJfSk7Cgl9LAoJY2xlYXJRdWV1ZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJcmV0dXJuIHRoaXMucXVldWUoIHR5cGUgfHwgImZ4IiwgW10gKTsKCX0sCgkvLyBHZXQgYSBwcm9taXNlIHJlc29sdmVkIHdoZW4gcXVldWVzIG9mIGEgY2VydGFpbiB0eXBlCgkvLyBhcmUgZW1wdGllZCAoZnggaXMgdGhlIHR5cGUgYnkgZGVmYXVsdCkKCXByb21pc2U6IGZ1bmN0aW9uKCB0eXBlLCBvYmogKSB7CgkJdmFyIHRtcCwKCQkJY291bnQgPSAxLAoJCQlkZWZlciA9IGpRdWVyeS5EZWZlcnJlZCgpLAoJCQllbGVtZW50cyA9IHRoaXMsCgkJCWkgPSB0aGlzLmxlbmd0aCwKCQkJcmVzb2x2ZSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAhKCAtLWNvdW50ICkgKSB7CgkJCQkJZGVmZXIucmVzb2x2ZVdpdGgoIGVsZW1lbnRzLCBbIGVsZW1lbnRzIF0gKTsKCQkJCX0KCQkJfTsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCW9iaiA9IHR5cGU7CgkJCXR5cGUgPSB1bmRlZmluZWQ7CgkJfQoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXdoaWxlICggaS0tICkgewoJCQl0bXAgPSBkYXRhX3ByaXYuZ2V0KCBlbGVtZW50c1sgaSBdLCB0eXBlICsgInF1ZXVlSG9va3MiICk7CgkJCWlmICggdG1wICYmIHRtcC5lbXB0eSApIHsKCQkJCWNvdW50Kys7CgkJCQl0bXAuZW1wdHkuYWRkKCByZXNvbHZlICk7CgkJCX0KCQl9CgkJcmVzb2x2ZSgpOwoJCXJldHVybiBkZWZlci5wcm9taXNlKCBvYmogKTsKCX0KfSk7CnZhciBwbnVtID0gKC9bKy1dPyg/OlxkKlwufClcZCsoPzpbZUVdWystXT9cZCt8KS8pLnNvdXJjZTsKCnZhciBjc3NFeHBhbmQgPSBbICJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiIF07Cgp2YXIgaXNIaWRkZW4gPSBmdW5jdGlvbiggZWxlbSwgZWwgKSB7CgkJLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKCQkvLyBpbiB0aGF0IGNhc2UsIGVsZW1lbnQgd2lsbCBiZSBzZWNvbmQgYXJndW1lbnQKCQllbGVtID0gZWwgfHwgZWxlbTsKCQlyZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgPT09ICJub25lIiB8fCAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKCX07Cgp2YXIgcmNoZWNrYWJsZVR5cGUgPSAoL14oPzpjaGVja2JveHxyYWRpbykkL2kpOwoKCgooZnVuY3Rpb24oKSB7Cgl2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCgkJZGl2ID0gZnJhZ21lbnQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICkgKSwKCQlpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJpbnB1dCIgKTsKCgkvLyBTdXBwb3J0OiBTYWZhcmk8PTUuMQoJLy8gQ2hlY2sgc3RhdGUgbG9zdCBpZiB0aGUgbmFtZSBpcyBzZXQgKCMxMTIxNykKCS8vIFN1cHBvcnQ6IFdpbmRvd3MgV2ViIEFwcHMgKFdXQSkKCS8vIGBuYW1lYCBhbmQgYHR5cGVgIG11c3QgdXNlIC5zZXRBdHRyaWJ1dGUgZm9yIFdXQSAoIzE0OTAxKQoJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJyYWRpbyIgKTsKCWlucHV0LnNldEF0dHJpYnV0ZSggImNoZWNrZWQiLCAiY2hlY2tlZCIgKTsKCWlucHV0LnNldEF0dHJpYnV0ZSggIm5hbWUiLCAidCIgKTsKCglkaXYuYXBwZW5kQ2hpbGQoIGlucHV0ICk7CgoJLy8gU3VwcG9ydDogU2FmYXJpPD01LjEsIEFuZHJvaWQ8NC4yCgkvLyBPbGRlciBXZWJLaXQgZG9lc24ndCBjbG9uZSBjaGVja2VkIHN0YXRlIGNvcnJlY3RseSBpbiBmcmFnbWVudHMKCXN1cHBvcnQuY2hlY2tDbG9uZSA9IGRpdi5jbG9uZU5vZGUoIHRydWUgKS5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuY2hlY2tlZDsKCgkvLyBTdXBwb3J0OiBJRTw9MTErCgkvLyBNYWtlIHN1cmUgdGV4dGFyZWEgKGFuZCBjaGVja2JveCkgZGVmYXVsdFZhbHVlIGlzIHByb3Blcmx5IGNsb25lZAoJZGl2LmlubmVySFRNTCA9ICI8dGV4dGFyZWE+eDwvdGV4dGFyZWE+IjsKCXN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSAhIWRpdi5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuZGVmYXVsdFZhbHVlOwp9KSgpOwp2YXIgc3RydW5kZWZpbmVkID0gdHlwZW9mIHVuZGVmaW5lZDsKCgoKc3VwcG9ydC5mb2N1c2luQnViYmxlcyA9ICJvbmZvY3VzaW4iIGluIHdpbmRvdzsKCgp2YXIKCXJrZXlFdmVudCA9IC9ea2V5LywKCXJtb3VzZUV2ZW50ID0gL14oPzptb3VzZXxwb2ludGVyfGNvbnRleHRtZW51KXxjbGljay8sCglyZm9jdXNNb3JwaCA9IC9eKD86Zm9jdXNpbmZvY3VzfGZvY3Vzb3V0Ymx1cikkLywKCXJ0eXBlbmFtZXNwYWNlID0gL14oW14uXSopKD86XC4oLispfCkkLzsKCmZ1bmN0aW9uIHJldHVyblRydWUoKSB7CglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gcmV0dXJuRmFsc2UoKSB7CglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIHNhZmVBY3RpdmVFbGVtZW50KCkgewoJdHJ5IHsKCQlyZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKCX0gY2F0Y2ggKCBlcnIgKSB7IH0KfQoKLyoKICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLgogKiBQcm9wcyB0byBEZWFuIEVkd2FyZHMnIGFkZEV2ZW50IGxpYnJhcnkgZm9yIG1hbnkgb2YgdGhlIGlkZWFzLgogKi8KalF1ZXJ5LmV2ZW50ID0gewoKCWdsb2JhbDoge30sCgoJYWRkOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIGRhdGEsIHNlbGVjdG9yICkgewoKCQl2YXIgaGFuZGxlT2JqSW4sIGV2ZW50SGFuZGxlLCB0bXAsCgkJCWV2ZW50cywgdCwgaGFuZGxlT2JqLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwgbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0gZGF0YV9wcml2LmdldCggZWxlbSApOwoKCQkvLyBEb24ndCBhdHRhY2ggZXZlbnRzIHRvIG5vRGF0YSBvciB0ZXh0L2NvbW1lbnQgbm9kZXMgKGJ1dCBhbGxvdyBwbGFpbiBvYmplY3RzKQoJCWlmICggIWVsZW1EYXRhICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYW4gb2JqZWN0IG9mIGN1c3RvbSBkYXRhIGluIGxpZXUgb2YgdGhlIGhhbmRsZXIKCQlpZiAoIGhhbmRsZXIuaGFuZGxlciApIHsKCQkJaGFuZGxlT2JqSW4gPSBoYW5kbGVyOwoJCQloYW5kbGVyID0gaGFuZGxlT2JqSW4uaGFuZGxlcjsKCQkJc2VsZWN0b3IgPSBoYW5kbGVPYmpJbi5zZWxlY3RvcjsKCQl9CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBoYW5kbGVyIGhhcyBhIHVuaXF1ZSBJRCwgdXNlZCB0byBmaW5kL3JlbW92ZSBpdCBsYXRlcgoJCWlmICggIWhhbmRsZXIuZ3VpZCApIHsKCQkJaGFuZGxlci5ndWlkID0galF1ZXJ5Lmd1aWQrKzsKCQl9CgoJCS8vIEluaXQgdGhlIGVsZW1lbnQncyBldmVudCBzdHJ1Y3R1cmUgYW5kIG1haW4gaGFuZGxlciwgaWYgdGhpcyBpcyB0aGUgZmlyc3QKCQlpZiAoICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSApIHsKCQkJZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzID0ge307CgkJfQoJCWlmICggIShldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSkgKSB7CgkJCWV2ZW50SGFuZGxlID0gZWxlbURhdGEuaGFuZGxlID0gZnVuY3Rpb24oIGUgKSB7CgkJCQkvLyBEaXNjYXJkIHRoZSBzZWNvbmQgZXZlbnQgb2YgYSBqUXVlcnkuZXZlbnQudHJpZ2dlcigpIGFuZAoJCQkJLy8gd2hlbiBhbiBldmVudCBpcyBjYWxsZWQgYWZ0ZXIgYSBwYWdlIGhhcyB1bmxvYWRlZAoJCQkJcmV0dXJuIHR5cGVvZiBqUXVlcnkgIT09IHN0cnVuZGVmaW5lZCAmJiBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICE9PSBlLnR5cGUgPwoJCQkJCWpRdWVyeS5ldmVudC5kaXNwYXRjaC5hcHBseSggZWxlbSwgYXJndW1lbnRzICkgOiB1bmRlZmluZWQ7CgkJCX07CgkJfQoKCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFsgIiIgXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1t0XSApIHx8IFtdOwoJCQl0eXBlID0gb3JpZ1R5cGUgPSB0bXBbMV07CgkJCW5hbWVzcGFjZXMgPSAoIHRtcFsyXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBUaGVyZSAqbXVzdCogYmUgYSB0eXBlLCBubyBhdHRhY2hpbmcgbmFtZXNwYWNlLW9ubHkgaGFuZGxlcnMKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBJZiBldmVudCBjaGFuZ2VzIGl0cyB0eXBlLCB1c2UgdGhlIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMgZm9yIHRoZSBjaGFuZ2VkIHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBJZiBzZWxlY3RvciBkZWZpbmVkLCBkZXRlcm1pbmUgc3BlY2lhbCBldmVudCBhcGkgdHlwZSwgb3RoZXJ3aXNlIGdpdmVuIHR5cGUKCQkJdHlwZSA9ICggc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlOwoKCQkJLy8gVXBkYXRlIHNwZWNpYWwgYmFzZWQgb24gbmV3bHkgcmVzZXQgdHlwZQoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCgkJCS8vIGhhbmRsZU9iaiBpcyBwYXNzZWQgdG8gYWxsIGV2ZW50IGhhbmRsZXJzCgkJCWhhbmRsZU9iaiA9IGpRdWVyeS5leHRlbmQoewoJCQkJdHlwZTogdHlwZSwKCQkJCW9yaWdUeXBlOiBvcmlnVHlwZSwKCQkJCWRhdGE6IGRhdGEsCgkJCQloYW5kbGVyOiBoYW5kbGVyLAoJCQkJZ3VpZDogaGFuZGxlci5ndWlkLAoJCQkJc2VsZWN0b3I6IHNlbGVjdG9yLAoJCQkJbmVlZHNDb250ZXh0OiBzZWxlY3RvciAmJiBqUXVlcnkuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3IgKSwKCQkJCW5hbWVzcGFjZTogbmFtZXNwYWNlcy5qb2luKCIuIikKCQkJfSwgaGFuZGxlT2JqSW4gKTsKCgkJCS8vIEluaXQgdGhlIGV2ZW50IGhhbmRsZXIgcXVldWUgaWYgd2UncmUgdGhlIGZpcnN0CgkJCWlmICggIShoYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdKSApIHsKCQkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gPSBbXTsKCQkJCWhhbmRsZXJzLmRlbGVnYXRlQ291bnQgPSAwOwoKCQkJCS8vIE9ubHkgdXNlIGFkZEV2ZW50TGlzdGVuZXIgaWYgdGhlIHNwZWNpYWwgZXZlbnRzIGhhbmRsZXIgcmV0dXJucyBmYWxzZQoJCQkJaWYgKCAhc3BlY2lhbC5zZXR1cCB8fCBzcGVjaWFsLnNldHVwLmNhbGwoIGVsZW0sIGRhdGEsIG5hbWVzcGFjZXMsIGV2ZW50SGFuZGxlICkgPT09IGZhbHNlICkgewoJCQkJCWlmICggZWxlbS5hZGRFdmVudExpc3RlbmVyICkgewoJCQkJCQllbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYgKCBzcGVjaWFsLmFkZCApIHsKCQkJCXNwZWNpYWwuYWRkLmNhbGwoIGVsZW0sIGhhbmRsZU9iaiApOwoKCQkJCWlmICggIWhhbmRsZU9iai5oYW5kbGVyLmd1aWQgKSB7CgkJCQkJaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCA9IGhhbmRsZXIuZ3VpZDsKCQkJCX0KCQkJfQoKCQkJLy8gQWRkIHRvIHRoZSBlbGVtZW50J3MgaGFuZGxlciBsaXN0LCBkZWxlZ2F0ZXMgaW4gZnJvbnQKCQkJaWYgKCBzZWxlY3RvciApIHsKCQkJCWhhbmRsZXJzLnNwbGljZSggaGFuZGxlcnMuZGVsZWdhdGVDb3VudCsrLCAwLCBoYW5kbGVPYmogKTsKCQkJfSBlbHNlIHsKCQkJCWhhbmRsZXJzLnB1c2goIGhhbmRsZU9iaiApOwoJCQl9CgoJCQkvLyBLZWVwIHRyYWNrIG9mIHdoaWNoIGV2ZW50cyBoYXZlIGV2ZXIgYmVlbiB1c2VkLCBmb3IgZXZlbnQgb3B0aW1pemF0aW9uCgkJCWpRdWVyeS5ldmVudC5nbG9iYWxbIHR5cGUgXSA9IHRydWU7CgkJfQoKCX0sCgoJLy8gRGV0YWNoIGFuIGV2ZW50IG9yIHNldCBvZiBldmVudHMgZnJvbSBhbiBlbGVtZW50CglyZW1vdmU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlcywgaGFuZGxlciwgc2VsZWN0b3IsIG1hcHBlZFR5cGVzICkgewoKCQl2YXIgaiwgb3JpZ0NvdW50LCB0bXAsCgkJCWV2ZW50cywgdCwgaGFuZGxlT2JqLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwgbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0gZGF0YV9wcml2Lmhhc0RhdGEoIGVsZW0gKSAmJiBkYXRhX3ByaXYuZ2V0KCBlbGVtICk7CgoJCWlmICggIWVsZW1EYXRhIHx8ICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gT25jZSBmb3IgZWFjaCB0eXBlLm5hbWVzcGFjZSBpbiB0eXBlczsgdHlwZSBtYXkgYmUgb21pdHRlZAoJCXR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbICIiIF07CgkJdCA9IHR5cGVzLmxlbmd0aDsKCQl3aGlsZSAoIHQtLSApIHsKCQkJdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsKCQkJdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOwoKCQkJLy8gVW5iaW5kIGFsbCBldmVudHMgKG9uIHRoaXMgbmFtZXNwYWNlLCBpZiBwcm92aWRlZCkgZm9yIHRoZSBlbGVtZW50CgkJCWlmICggIXR5cGUgKSB7CgkJCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICsgdHlwZXNbIHQgXSwgaGFuZGxlciwgc2VsZWN0b3IsIHRydWUgKTsKCQkJCX0KCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQkJdHlwZSA9ICggc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlOwoJCQloYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdIHx8IFtdOwoJCQl0bXAgPSB0bXBbMl0gJiYgbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIgKTsKCgkJCS8vIFJlbW92ZSBtYXRjaGluZyBldmVudHMKCQkJb3JpZ0NvdW50ID0gaiA9IGhhbmRsZXJzLmxlbmd0aDsKCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQloYW5kbGVPYmogPSBoYW5kbGVyc1sgaiBdOwoKCQkJCWlmICggKCBtYXBwZWRUeXBlcyB8fCBvcmlnVHlwZSA9PT0gaGFuZGxlT2JqLm9yaWdUeXBlICkgJiYKCQkJCQkoICFoYW5kbGVyIHx8IGhhbmRsZXIuZ3VpZCA9PT0gaGFuZGxlT2JqLmd1aWQgKSAmJgoJCQkJCSggIXRtcCB8fCB0bXAudGVzdCggaGFuZGxlT2JqLm5hbWVzcGFjZSApICkgJiYKCQkJCQkoICFzZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gaGFuZGxlT2JqLnNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSAiKioiICYmIGhhbmRsZU9iai5zZWxlY3RvciApICkgewoJCQkJCWhhbmRsZXJzLnNwbGljZSggaiwgMSApOwoKCQkJCQlpZiAoIGhhbmRsZU9iai5zZWxlY3RvciApIHsKCQkJCQkJaGFuZGxlcnMuZGVsZWdhdGVDb3VudC0tOwoJCQkJCX0KCQkJCQlpZiAoIHNwZWNpYWwucmVtb3ZlICkgewoJCQkJCQlzcGVjaWFsLnJlbW92ZS5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFJlbW92ZSBnZW5lcmljIGV2ZW50IGhhbmRsZXIgaWYgd2UgcmVtb3ZlZCBzb21ldGhpbmcgYW5kIG5vIG1vcmUgaGFuZGxlcnMgZXhpc3QKCQkJLy8gKGF2b2lkcyBwb3RlbnRpYWwgZm9yIGVuZGxlc3MgcmVjdXJzaW9uIGR1cmluZyByZW1vdmFsIG9mIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMpCgkJCWlmICggb3JpZ0NvdW50ICYmICFoYW5kbGVycy5sZW5ndGggKSB7CgkJCQlpZiAoICFzcGVjaWFsLnRlYXJkb3duIHx8IHNwZWNpYWwudGVhcmRvd24uY2FsbCggZWxlbSwgbmFtZXNwYWNlcywgZWxlbURhdGEuaGFuZGxlICkgPT09IGZhbHNlICkgewoJCQkJCWpRdWVyeS5yZW1vdmVFdmVudCggZWxlbSwgdHlwZSwgZWxlbURhdGEuaGFuZGxlICk7CgkJCQl9CgoJCQkJZGVsZXRlIGV2ZW50c1sgdHlwZSBdOwoJCQl9CgkJfQoKCQkvLyBSZW1vdmUgdGhlIGV4cGFuZG8gaWYgaXQncyBubyBsb25nZXIgdXNlZAoJCWlmICggalF1ZXJ5LmlzRW1wdHlPYmplY3QoIGV2ZW50cyApICkgewoJCQlkZWxldGUgZWxlbURhdGEuaGFuZGxlOwoJCQlkYXRhX3ByaXYucmVtb3ZlKCBlbGVtLCAiZXZlbnRzIiApOwoJCX0KCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7CgoJCXZhciBpLCBjdXIsIHRtcCwgYnViYmxlVHlwZSwgb250eXBlLCBoYW5kbGUsIHNwZWNpYWwsCgkJCWV2ZW50UGF0aCA9IFsgZWxlbSB8fCBkb2N1bWVudCBdLAoJCQl0eXBlID0gaGFzT3duLmNhbGwoIGV2ZW50LCAidHlwZSIgKSA/IGV2ZW50LnR5cGUgOiBldmVudCwKCQkJbmFtZXNwYWNlcyA9IGhhc093bi5jYWxsKCBldmVudCwgIm5hbWVzcGFjZSIgKSA/IGV2ZW50Lm5hbWVzcGFjZS5zcGxpdCgiLiIpIDogW107CgoJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCIuIikgPj0gMCApIHsKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwoJCQl0eXBlID0gbmFtZXNwYWNlcy5zaGlmdCgpOwoJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQl9CgkJb250eXBlID0gdHlwZS5pbmRleE9mKCI6IikgPCAwICYmICJvbiIgKyB0eXBlOwoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYSBqUXVlcnkuRXZlbnQgb2JqZWN0LCBPYmplY3QsIG9yIGp1c3QgYW4gZXZlbnQgdHlwZSBzdHJpbmcKCQlldmVudCA9IGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdID8KCQkJZXZlbnQgOgoJCQluZXcgalF1ZXJ5LkV2ZW50KCB0eXBlLCB0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiICYmIGV2ZW50ICk7CgoJCS8vIFRyaWdnZXIgYml0bWFzazogJiAxIGZvciBuYXRpdmUgaGFuZGxlcnM7ICYgMiBmb3IgalF1ZXJ5IChhbHdheXMgdHJ1ZSkKCQlldmVudC5pc1RyaWdnZXIgPSBvbmx5SGFuZGxlcnMgPyAyIDogMzsKCQlldmVudC5uYW1lc3BhY2UgPSBuYW1lc3BhY2VzLmpvaW4oIi4iKTsKCQlldmVudC5uYW1lc3BhY2VfcmUgPSBldmVudC5uYW1lc3BhY2UgPwoJCQluZXcgUmVnRXhwKCAiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIiApIDoKCQkJbnVsbDsKCgkJLy8gQ2xlYW4gdXAgdGhlIGV2ZW50IGluIGNhc2UgaXQgaXMgYmVpbmcgcmV1c2VkCgkJZXZlbnQucmVzdWx0ID0gdW5kZWZpbmVkOwoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gZWxlbTsKCQl9CgoJCS8vIENsb25lIGFueSBpbmNvbWluZyBkYXRhIGFuZCBwcmVwZW5kIHRoZSBldmVudCwgY3JlYXRpbmcgdGhlIGhhbmRsZXIgYXJnIGxpc3QKCQlkYXRhID0gZGF0YSA9PSBudWxsID8KCQkJWyBldmVudCBdIDoKCQkJalF1ZXJ5Lm1ha2VBcnJheSggZGF0YSwgWyBldmVudCBdICk7CgoJCS8vIEFsbG93IHNwZWNpYWwgZXZlbnRzIHRvIGRyYXcgb3V0c2lkZSB0aGUgbGluZXMKCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgc3BlY2lhbC50cmlnZ2VyICYmIHNwZWNpYWwudHJpZ2dlci5hcHBseSggZWxlbSwgZGF0YSApID09PSBmYWxzZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRGV0ZXJtaW5lIGV2ZW50IHByb3BhZ2F0aW9uIHBhdGggaW4gYWR2YW5jZSwgcGVyIFczQyBldmVudHMgc3BlYyAoIzk5NTEpCgkJLy8gQnViYmxlIHVwIHRvIGRvY3VtZW50LCB0aGVuIHRvIHdpbmRvdzsgd2F0Y2ggZm9yIGEgZ2xvYmFsIG93bmVyRG9jdW1lbnQgdmFyICgjOTcyNCkKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgIXNwZWNpYWwubm9CdWJibGUgJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJYnViYmxlVHlwZSA9IHNwZWNpYWwuZGVsZWdhdGVUeXBlIHx8IHR5cGU7CgkJCWlmICggIXJmb2N1c01vcnBoLnRlc3QoIGJ1YmJsZVR5cGUgKyB0eXBlICkgKSB7CgkJCQljdXIgPSBjdXIucGFyZW50Tm9kZTsKCQkJfQoJCQlmb3IgKCA7IGN1cjsgY3VyID0gY3VyLnBhcmVudE5vZGUgKSB7CgkJCQlldmVudFBhdGgucHVzaCggY3VyICk7CgkJCQl0bXAgPSBjdXI7CgkJCX0KCgkJCS8vIE9ubHkgYWRkIHdpbmRvdyBpZiB3ZSBnb3QgdG8gZG9jdW1lbnQgKGUuZy4sIG5vdCBwbGFpbiBvYmogb3IgZGV0YWNoZWQgRE9NKQoJCQlpZiAoIHRtcCA9PT0gKGVsZW0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCkgKSB7CgkJCQlldmVudFBhdGgucHVzaCggdG1wLmRlZmF1bHRWaWV3IHx8IHRtcC5wYXJlbnRXaW5kb3cgfHwgd2luZG93ICk7CgkJCX0KCQl9CgoJCS8vIEZpcmUgaGFuZGxlcnMgb24gdGhlIGV2ZW50IHBhdGgKCQlpID0gMDsKCQl3aGlsZSAoIChjdXIgPSBldmVudFBhdGhbaSsrXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgoJCQlldmVudC50eXBlID0gaSA+IDEgPwoJCQkJYnViYmxlVHlwZSA6CgkJCQlzcGVjaWFsLmJpbmRUeXBlIHx8IHR5cGU7CgoJCQkvLyBqUXVlcnkgaGFuZGxlcgoJCQloYW5kbGUgPSAoIGRhdGFfcHJpdi5nZXQoIGN1ciwgImV2ZW50cyIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gJiYgZGF0YV9wcml2LmdldCggY3VyLCAiaGFuZGxlIiApOwoJCQlpZiAoIGhhbmRsZSApIHsKCQkJCWhhbmRsZS5hcHBseSggY3VyLCBkYXRhICk7CgkJCX0KCgkJCS8vIE5hdGl2ZSBoYW5kbGVyCgkJCWhhbmRsZSA9IG9udHlwZSAmJiBjdXJbIG9udHlwZSBdOwoJCQlpZiAoIGhhbmRsZSAmJiBoYW5kbGUuYXBwbHkgJiYgalF1ZXJ5LmFjY2VwdERhdGEoIGN1ciApICkgewoJCQkJZXZlbnQucmVzdWx0ID0gaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKTsKCQkJCWlmICggZXZlbnQucmVzdWx0ID09PSBmYWxzZSApIHsKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJfQoJCQl9CgkJfQoJCWV2ZW50LnR5cGUgPSB0eXBlOwoKCQkvLyBJZiBub2JvZHkgcHJldmVudGVkIHRoZSBkZWZhdWx0IGFjdGlvbiwgZG8gaXQgbm93CgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCgkJCWlmICggKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGV2ZW50UGF0aC5wb3AoKSwgZGF0YSApID09PSBmYWxzZSkgJiYKCQkJCWpRdWVyeS5hY2NlcHREYXRhKCBlbGVtICkgKSB7CgoJCQkJLy8gQ2FsbCBhIG5hdGl2ZSBET00gbWV0aG9kIG9uIHRoZSB0YXJnZXQgd2l0aCB0aGUgc2FtZSBuYW1lIG5hbWUgYXMgdGhlIGV2ZW50LgoJCQkJLy8gRG9uJ3QgZG8gZGVmYXVsdCBhY3Rpb25zIG9uIHdpbmRvdywgdGhhdCdzIHdoZXJlIGdsb2JhbCB2YXJpYWJsZXMgYmUgKCM2MTcwKQoJCQkJaWYgKCBvbnR5cGUgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIGVsZW1bIHR5cGUgXSApICYmICFqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCgkJCQkJLy8gRG9uJ3QgcmUtdHJpZ2dlciBhbiBvbkZPTyBldmVudCB3aGVuIHdlIGNhbGwgaXRzIEZPTygpIG1ldGhvZAoJCQkJCXRtcCA9IGVsZW1bIG9udHlwZSBdOwoKCQkJCQlpZiAoIHRtcCApIHsKCQkJCQkJZWxlbVsgb250eXBlIF0gPSBudWxsOwoJCQkJCX0KCgkJCQkJLy8gUHJldmVudCByZS10cmlnZ2VyaW5nIG9mIHRoZSBzYW1lIGV2ZW50LCBzaW5jZSB3ZSBhbHJlYWR5IGJ1YmJsZWQgaXQgYWJvdmUKCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdHlwZTsKCQkJCQllbGVtWyB0eXBlIF0oKTsKCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdW5kZWZpbmVkOwoKCQkJCQlpZiAoIHRtcCApIHsKCQkJCQkJZWxlbVsgb250eXBlIF0gPSB0bXA7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gZXZlbnQucmVzdWx0OwoJfSwKCglkaXNwYXRjaDogZnVuY3Rpb24oIGV2ZW50ICkgewoKCQkvLyBNYWtlIGEgd3JpdGFibGUgalF1ZXJ5LkV2ZW50IGZyb20gdGhlIG5hdGl2ZSBldmVudCBvYmplY3QKCQlldmVudCA9IGpRdWVyeS5ldmVudC5maXgoIGV2ZW50ICk7CgoJCXZhciBpLCBqLCByZXQsIG1hdGNoZWQsIGhhbmRsZU9iaiwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWFyZ3MgPSBzbGljZS5jYWxsKCBhcmd1bWVudHMgKSwKCQkJaGFuZGxlcnMgPSAoIGRhdGFfcHJpdi5nZXQoIHRoaXMsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdIHx8IFtdLAoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGV2ZW50LnR5cGUgXSB8fCB7fTsKCgkJLy8gVXNlIHRoZSBmaXgtZWQgalF1ZXJ5LkV2ZW50IHJhdGhlciB0aGFuIHRoZSAocmVhZC1vbmx5KSBuYXRpdmUgZXZlbnQKCQlhcmdzWzBdID0gZXZlbnQ7CgkJZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzOwoKCQkvLyBDYWxsIHRoZSBwcmVEaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUsIGFuZCBsZXQgaXQgYmFpbCBpZiBkZXNpcmVkCgkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBoYW5kbGVycwoJCWhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKCB0aGlzLCBldmVudCwgaGFuZGxlcnMgKTsKCgkJLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKCQlpID0gMDsKCQl3aGlsZSAoIChtYXRjaGVkID0gaGFuZGxlclF1ZXVlWyBpKysgXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCWV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CgoJCQlqID0gMDsKCQkJd2hpbGUgKCAoaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1sgaisrIF0pICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJCS8vIFRyaWdnZXJlZCBldmVudCBtdXN0IGVpdGhlciAxKSBoYXZlIG5vIG5hbWVzcGFjZSwgb3IgMikgaGF2ZSBuYW1lc3BhY2UocykKCQkJCS8vIGEgc3Vic2V0IG9yIGVxdWFsIHRvIHRob3NlIGluIHRoZSBib3VuZCBldmVudCAoYm90aCBjYW4gaGF2ZSBubyBuYW1lc3BhY2UpLgoJCQkJaWYgKCAhZXZlbnQubmFtZXNwYWNlX3JlIHx8IGV2ZW50Lm5hbWVzcGFjZV9yZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7CgoJCQkJCWV2ZW50LmhhbmRsZU9iaiA9IGhhbmRsZU9iajsKCQkJCQlldmVudC5kYXRhID0gaGFuZGxlT2JqLmRhdGE7CgoJCQkJCXJldCA9ICggKGpRdWVyeS5ldmVudC5zcGVjaWFsWyBoYW5kbGVPYmoub3JpZ1R5cGUgXSB8fCB7fSkuaGFuZGxlIHx8IGhhbmRsZU9iai5oYW5kbGVyICkKCQkJCQkJCS5hcHBseSggbWF0Y2hlZC5lbGVtLCBhcmdzICk7CgoJCQkJCWlmICggcmV0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCWlmICggKGV2ZW50LnJlc3VsdCA9IHJldCkgPT09IGZhbHNlICkgewoJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsIHRoZSBwb3N0RGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlCgkJaWYgKCBzcGVjaWFsLnBvc3REaXNwYXRjaCApIHsKCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWhhbmRsZXJzOiBmdW5jdGlvbiggZXZlbnQsIGhhbmRsZXJzICkgewoJCXZhciBpLCBtYXRjaGVzLCBzZWwsIGhhbmRsZU9iaiwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LAoJCQljdXIgPSBldmVudC50YXJnZXQ7CgoJCS8vIEZpbmQgZGVsZWdhdGUgaGFuZGxlcnMKCQkvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQoJCS8vIEF2b2lkIG5vbi1sZWZ0LWNsaWNrIGJ1YmJsaW5nIGluIEZpcmVmb3ggKCMzODYxKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYgKCFldmVudC5idXR0b24gfHwgZXZlbnQudHlwZSAhPT0gImNsaWNrIikgKSB7CgoJCQlmb3IgKCA7IGN1ciAhPT0gdGhpczsgY3VyID0gY3VyLnBhcmVudE5vZGUgfHwgdGhpcyApIHsKCgkJCQkvLyBEb24ndCBwcm9jZXNzIGNsaWNrcyBvbiBkaXNhYmxlZCBlbGVtZW50cyAoIzY5MTEsICM4MTY1LCAjMTEzODIsICMxMTc2NCkKCQkJCWlmICggY3VyLmRpc2FibGVkICE9PSB0cnVlIHx8IGV2ZW50LnR5cGUgIT09ICJjbGljayIgKSB7CgkJCQkJbWF0Y2hlcyA9IFtdOwoJCQkJCWZvciAoIGkgPSAwOyBpIDwgZGVsZWdhdGVDb3VudDsgaSsrICkgewoJCQkJCQloYW5kbGVPYmogPSBoYW5kbGVyc1sgaSBdOwoKCQkJCQkJLy8gRG9uJ3QgY29uZmxpY3Qgd2l0aCBPYmplY3QucHJvdG90eXBlIHByb3BlcnRpZXMgKCMxMzIwMykKCQkJCQkJc2VsID0gaGFuZGxlT2JqLnNlbGVjdG9yICsgIiAiOwoKCQkJCQkJaWYgKCBtYXRjaGVzWyBzZWwgXSA9PT0gdW5kZWZpbmVkICkgewoJCQkJCQkJbWF0Y2hlc1sgc2VsIF0gPSBoYW5kbGVPYmoubmVlZHNDb250ZXh0ID8KCQkJCQkJCQlqUXVlcnkoIHNlbCwgdGhpcyApLmluZGV4KCBjdXIgKSA+PSAwIDoKCQkJCQkJCQlqUXVlcnkuZmluZCggc2VsLCB0aGlzLCBudWxsLCBbIGN1ciBdICkubGVuZ3RoOwoJCQkJCQl9CgkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gKSB7CgkJCQkJCQltYXRjaGVzLnB1c2goIGhhbmRsZU9iaiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggbWF0Y2hlcy5sZW5ndGggKSB7CgkJCQkJCWhhbmRsZXJRdWV1ZS5wdXNoKHsgZWxlbTogY3VyLCBoYW5kbGVyczogbWF0Y2hlcyB9KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEFkZCB0aGUgcmVtYWluaW5nIChkaXJlY3RseS1ib3VuZCkgaGFuZGxlcnMKCQlpZiAoIGRlbGVnYXRlQ291bnQgPCBoYW5kbGVycy5sZW5ndGggKSB7CgkJCWhhbmRsZXJRdWV1ZS5wdXNoKHsgZWxlbTogdGhpcywgaGFuZGxlcnM6IGhhbmRsZXJzLnNsaWNlKCBkZWxlZ2F0ZUNvdW50ICkgfSk7CgkJfQoKCQlyZXR1cm4gaGFuZGxlclF1ZXVlOwoJfSwKCgkvLyBJbmNsdWRlcyBzb21lIGV2ZW50IHByb3BzIHNoYXJlZCBieSBLZXlFdmVudCBhbmQgTW91c2VFdmVudAoJcHJvcHM6ICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksCgoJZml4SG9va3M6IHt9LAoKCWtleUhvb2tzOiB7CgkJcHJvcHM6ICJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLAoJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCgkJCS8vIEFkZCB3aGljaCBmb3Iga2V5IGV2ZW50cwoJCQlpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7CgkJCQlldmVudC53aGljaCA9IG9yaWdpbmFsLmNoYXJDb2RlICE9IG51bGwgPyBvcmlnaW5hbC5jaGFyQ29kZSA6IG9yaWdpbmFsLmtleUNvZGU7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCW1vdXNlSG9va3M6IHsKCQlwcm9wczogImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSwKCQlmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7CgkJCXZhciBldmVudERvYywgZG9jLCBib2R5LAoJCQkJYnV0dG9uID0gb3JpZ2luYWwuYnV0dG9uOwoKCQkJLy8gQ2FsY3VsYXRlIHBhZ2VYL1kgaWYgbWlzc2luZyBhbmQgY2xpZW50WC9ZIGF2YWlsYWJsZQoJCQlpZiAoIGV2ZW50LnBhZ2VYID09IG51bGwgJiYgb3JpZ2luYWwuY2xpZW50WCAhPSBudWxsICkgewoJCQkJZXZlbnREb2MgPSBldmVudC50YXJnZXQub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDsKCQkJCWRvYyA9IGV2ZW50RG9jLmRvY3VtZW50RWxlbWVudDsKCQkJCWJvZHkgPSBldmVudERvYy5ib2R5OwoKCQkJCWV2ZW50LnBhZ2VYID0gb3JpZ2luYWwuY2xpZW50WCArICggZG9jICYmIGRvYy5zY3JvbGxMZWZ0IHx8IGJvZHkgJiYgYm9keS5zY3JvbGxMZWZ0IHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRMZWZ0IHx8IGJvZHkgJiYgYm9keS5jbGllbnRMZWZ0IHx8IDAgKTsKCQkJCWV2ZW50LnBhZ2VZID0gb3JpZ2luYWwuY2xpZW50WSArICggZG9jICYmIGRvYy5zY3JvbGxUb3AgIHx8IGJvZHkgJiYgYm9keS5zY3JvbGxUb3AgIHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRUb3AgIHx8IGJvZHkgJiYgYm9keS5jbGllbnRUb3AgIHx8IDAgKTsKCQkJfQoKCQkJLy8gQWRkIHdoaWNoIGZvciBjbGljazogMSA9PT0gbGVmdDsgMiA9PT0gbWlkZGxlOyAzID09PSByaWdodAoJCQkvLyBOb3RlOiBidXR0b24gaXMgbm90IG5vcm1hbGl6ZWQsIHNvIGRvbid0IHVzZSBpdAoJCQlpZiAoICFldmVudC53aGljaCAmJiBidXR0b24gIT09IHVuZGVmaW5lZCApIHsKCQkJCWV2ZW50LndoaWNoID0gKCBidXR0b24gJiAxID8gMSA6ICggYnV0dG9uICYgMiA/IDMgOiAoIGJ1dHRvbiAmIDQgPyAyIDogMCApICkgKTsKCQkJfQoKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsIGNvcHksCgkJCXR5cGUgPSBldmVudC50eXBlLAoJCQlvcmlnaW5hbEV2ZW50ID0gZXZlbnQsCgkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCWlmICggIWZpeEhvb2sgKSB7CgkJCXRoaXMuZml4SG9va3NbIHR5cGUgXSA9IGZpeEhvb2sgPQoJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCXJrZXlFdmVudC50ZXN0KCB0eXBlICkgPyB0aGlzLmtleUhvb2tzIDoKCQkJCXt9OwoJCX0KCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTsKCgkJaSA9IGNvcHkubGVuZ3RoOwoJCXdoaWxlICggaS0tICkgewoJCQlwcm9wID0gY29weVsgaSBdOwoJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCX0KCgkJLy8gU3VwcG9ydDogQ29yZG92YSAyLjUgKFdlYktpdCkgKCMxMzI1NSkKCQkvLyBBbGwgZXZlbnRzIHNob3VsZCBoYXZlIGEgdGFyZ2V0OyBDb3Jkb3ZhIGRldmljZXJlYWR5IGRvZXNuJ3QKCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGRvY3VtZW50OwoJCX0KCgkJLy8gU3VwcG9ydDogU2FmYXJpIDYuMCssIENocm9tZTwyOAoJCS8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgkJaWYgKCBldmVudC50YXJnZXQubm9kZVR5cGUgPT09IDMgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwoJCX0KCgkJcmV0dXJuIGZpeEhvb2suZmlsdGVyID8gZml4SG9vay5maWx0ZXIoIGV2ZW50LCBvcmlnaW5hbEV2ZW50ICkgOiBldmVudDsKCX0sCgoJc3BlY2lhbDogewoJCWxvYWQ6IHsKCQkJLy8gUHJldmVudCB0cmlnZ2VyZWQgaW1hZ2UubG9hZCBldmVudHMgZnJvbSBidWJibGluZyB0byB3aW5kb3cubG9hZAoJCQlub0J1YmJsZTogdHJ1ZQoJCX0sCgkJZm9jdXM6IHsKCQkJLy8gRmlyZSBuYXRpdmUgZXZlbnQgaWYgcG9zc2libGUgc28gYmx1ci9mb2N1cyBzZXF1ZW5jZSBpcyBjb3JyZWN0CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzICE9PSBzYWZlQWN0aXZlRWxlbWVudCgpICYmIHRoaXMuZm9jdXMgKSB7CgkJCQkJdGhpcy5mb2N1cygpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCQkJZGVsZWdhdGVUeXBlOiAiZm9jdXNpbiIKCQl9LAoJCWJsdXI6IHsKCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHRoaXMgPT09IHNhZmVBY3RpdmVFbGVtZW50KCkgJiYgdGhpcy5ibHVyICkgewoJCQkJCXRoaXMuYmx1cigpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCQkJZGVsZWdhdGVUeXBlOiAiZm9jdXNvdXQiCgkJfSwKCQljbGljazogewoJCQkvLyBGb3IgY2hlY2tib3gsIGZpcmUgbmF0aXZlIGV2ZW50IHNvIGNoZWNrZWQgc3RhdGUgd2lsbCBiZSByaWdodAoJCQl0cmlnZ2VyOiBmdW5jdGlvbigpIHsKCQkJCWlmICggdGhpcy50eXBlID09PSAiY2hlY2tib3giICYmIHRoaXMuY2xpY2sgJiYgalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiaW5wdXQiICkgKSB7CgkJCQkJdGhpcy5jbGljaygpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCgkJCS8vIEZvciBjcm9zcy1icm93c2VyIGNvbnNpc3RlbmN5LCBkb24ndCBmaXJlIG5hdGl2ZSAuY2xpY2soKSBvbiBsaW5rcwoJCQlfZGVmYXVsdDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZXZlbnQudGFyZ2V0LCAiYSIgKTsKCQkJfQoJCX0sCgoJCWJlZm9yZXVubG9hZDogewoJCQlwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJCQkvLyBTdXBwb3J0OiBGaXJlZm94IDIwKwoJCQkJLy8gRmlyZWZveCBkb2Vzbid0IGFsZXJ0IGlmIHRoZSByZXR1cm5WYWx1ZSBmaWVsZCBpcyBub3Qgc2V0LgoJCQkJaWYgKCBldmVudC5yZXN1bHQgIT09IHVuZGVmaW5lZCAmJiBldmVudC5vcmlnaW5hbEV2ZW50ICkgewoJCQkJCWV2ZW50Lm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBldmVudC5yZXN1bHQ7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCXNpbXVsYXRlOiBmdW5jdGlvbiggdHlwZSwgZWxlbSwgZXZlbnQsIGJ1YmJsZSApIHsKCQkvLyBQaWdneWJhY2sgb24gYSBkb25vciBldmVudCB0byBzaW11bGF0ZSBhIGRpZmZlcmVudCBvbmUuCgkJLy8gRmFrZSBvcmlnaW5hbEV2ZW50IHRvIGF2b2lkIGRvbm9yJ3Mgc3RvcFByb3BhZ2F0aW9uLCBidXQgaWYgdGhlCgkJLy8gc2ltdWxhdGVkIGV2ZW50IHByZXZlbnRzIGRlZmF1bHQgdGhlbiB3ZSBkbyB0aGUgc2FtZSBvbiB0aGUgZG9ub3IuCgkJdmFyIGUgPSBqUXVlcnkuZXh0ZW5kKAoJCQluZXcgalF1ZXJ5LkV2ZW50KCksCgkJCWV2ZW50LAoJCQl7CgkJCQl0eXBlOiB0eXBlLAoJCQkJaXNTaW11bGF0ZWQ6IHRydWUsCgkJCQlvcmlnaW5hbEV2ZW50OiB7fQoJCQl9CgkJKTsKCQlpZiAoIGJ1YmJsZSApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCQl9IGVsc2UgewoJCQlqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbCggZWxlbSwgZSApOwoJCX0KCQlpZiAoIGUuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJfQoJfQp9OwoKalF1ZXJ5LnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGhhbmRsZSApIHsKCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCWVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lciggdHlwZSwgaGFuZGxlLCBmYWxzZSApOwoJfQp9OwoKalF1ZXJ5LkV2ZW50ID0gZnVuY3Rpb24oIHNyYywgcHJvcHMgKSB7CgkvLyBBbGxvdyBpbnN0YW50aWF0aW9uIHdpdGhvdXQgdGhlICduZXcnIGtleXdvcmQKCWlmICggISh0aGlzIGluc3RhbmNlb2YgalF1ZXJ5LkV2ZW50KSApIHsKCQlyZXR1cm4gbmV3IGpRdWVyeS5FdmVudCggc3JjLCBwcm9wcyApOwoJfQoKCS8vIEV2ZW50IG9iamVjdAoJaWYgKCBzcmMgJiYgc3JjLnR5cGUgKSB7CgkJdGhpcy5vcmlnaW5hbEV2ZW50ID0gc3JjOwoJCXRoaXMudHlwZSA9IHNyYy50eXBlOwoKCQkvLyBFdmVudHMgYnViYmxpbmcgdXAgdGhlIGRvY3VtZW50IG1heSBoYXZlIGJlZW4gbWFya2VkIGFzIHByZXZlbnRlZAoJCS8vIGJ5IGEgaGFuZGxlciBsb3dlciBkb3duIHRoZSB0cmVlOyByZWZsZWN0IHRoZSBjb3JyZWN0IHZhbHVlLgoJCXRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gc3JjLmRlZmF1bHRQcmV2ZW50ZWQgfHwKCQkJCXNyYy5kZWZhdWx0UHJldmVudGVkID09PSB1bmRlZmluZWQgJiYKCQkJCS8vIFN1cHBvcnQ6IEFuZHJvaWQ8NC4wCgkJCQlzcmMucmV0dXJuVmFsdWUgPT09IGZhbHNlID8KCQkJcmV0dXJuVHJ1ZSA6CgkJCXJldHVybkZhbHNlOwoKCS8vIEV2ZW50IHR5cGUKCX0gZWxzZSB7CgkJdGhpcy50eXBlID0gc3JjOwoJfQoKCS8vIFB1dCBleHBsaWNpdGx5IHByb3ZpZGVkIHByb3BlcnRpZXMgb250byB0aGUgZXZlbnQgb2JqZWN0CglpZiAoIHByb3BzICkgewoJCWpRdWVyeS5leHRlbmQoIHRoaXMsIHByb3BzICk7Cgl9CgoJLy8gQ3JlYXRlIGEgdGltZXN0YW1wIGlmIGluY29taW5nIGV2ZW50IGRvZXNuJ3QgaGF2ZSBvbmUKCXRoaXMudGltZVN0YW1wID0gc3JjICYmIHNyYy50aW1lU3RhbXAgfHwgalF1ZXJ5Lm5vdygpOwoKCS8vIE1hcmsgaXQgYXMgZml4ZWQKCXRoaXNbIGpRdWVyeS5leHBhbmRvIF0gPSB0cnVlOwp9OwoKLy8galF1ZXJ5LkV2ZW50IGlzIGJhc2VkIG9uIERPTTMgRXZlbnRzIGFzIHNwZWNpZmllZCBieSB0aGUgRUNNQVNjcmlwdCBMYW5ndWFnZSBCaW5kaW5nCi8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDMvV0QtRE9NLUxldmVsLTMtRXZlbnRzLTIwMDMwMzMxL2VjbWEtc2NyaXB0LWJpbmRpbmcuaHRtbApqUXVlcnkuRXZlbnQucHJvdG90eXBlID0gewoJaXNEZWZhdWx0UHJldmVudGVkOiByZXR1cm5GYWxzZSwKCWlzUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwKCWlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwKCglwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7CgkJdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7CgoJCXRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gcmV0dXJuVHJ1ZTsKCgkJaWYgKCBlICYmIGUucHJldmVudERlZmF1bHQgKSB7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9LAoJc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCWlmICggZSAmJiBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9Cgl9LAoJc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCWlmICggZSAmJiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQl9CgoJCXRoaXMuc3RvcFByb3BhZ2F0aW9uKCk7Cgl9Cn07CgovLyBDcmVhdGUgbW91c2VlbnRlci9sZWF2ZSBldmVudHMgdXNpbmcgbW91c2VvdmVyL291dCBhbmQgZXZlbnQtdGltZSBjaGVja3MKLy8gU3VwcG9ydDogQ2hyb21lIDE1KwpqUXVlcnkuZWFjaCh7Cgltb3VzZWVudGVyOiAibW91c2VvdmVyIiwKCW1vdXNlbGVhdmU6ICJtb3VzZW91dCIsCglwb2ludGVyZW50ZXI6ICJwb2ludGVyb3ZlciIsCglwb2ludGVybGVhdmU6ICJwb2ludGVyb3V0Igp9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoJalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIG9yaWcgXSA9IHsKCQlkZWxlZ2F0ZVR5cGU6IGZpeCwKCQliaW5kVHlwZTogZml4LAoKCQloYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIHJldCwKCQkJCXRhcmdldCA9IHRoaXMsCgkJCQlyZWxhdGVkID0gZXZlbnQucmVsYXRlZFRhcmdldCwKCQkJCWhhbmRsZU9iaiA9IGV2ZW50LmhhbmRsZU9iajsKCgkJCS8vIEZvciBtb3VzZW50ZXIvbGVhdmUgY2FsbCB0aGUgaGFuZGxlciBpZiByZWxhdGVkIGlzIG91dHNpZGUgdGhlIHRhcmdldC4KCQkJLy8gTkI6IE5vIHJlbGF0ZWRUYXJnZXQgaWYgdGhlIG1vdXNlIGxlZnQvZW50ZXJlZCB0aGUgYnJvd3NlciB3aW5kb3cKCQkJaWYgKCAhcmVsYXRlZCB8fCAocmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnMoIHRhcmdldCwgcmVsYXRlZCApKSApIHsKCQkJCWV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CgkJCQlyZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlldmVudC50eXBlID0gZml4OwoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKfSk7CgovLyBTdXBwb3J0OiBGaXJlZm94LCBDaHJvbWUsIFNhZmFyaQovLyBDcmVhdGUgImJ1YmJsaW5nIiBmb2N1cyBhbmQgYmx1ciBldmVudHMKaWYgKCAhc3VwcG9ydC5mb2N1c2luQnViYmxlcyApIHsKCWpRdWVyeS5lYWNoKHsgZm9jdXM6ICJmb2N1c2luIiwgYmx1cjogImZvY3Vzb3V0IiB9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoKCQkvLyBBdHRhY2ggYSBzaW5nbGUgY2FwdHVyaW5nIGhhbmRsZXIgb24gdGhlIGRvY3VtZW50IHdoaWxlIHNvbWVvbmUgd2FudHMgZm9jdXNpbi9mb2N1c291dAoJCXZhciBoYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCBmaXgsIGV2ZW50LnRhcmdldCwgalF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKSwgdHJ1ZSApOwoJCQl9OwoKCQlqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZml4IF0gPSB7CgkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCXZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcywKCQkJCQlhdHRhY2hlcyA9IGRhdGFfcHJpdi5hY2Nlc3MoIGRvYywgZml4ICk7CgoJCQkJaWYgKCAhYXR0YWNoZXMgKSB7CgkJCQkJZG9jLmFkZEV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCX0KCQkJCWRhdGFfcHJpdi5hY2Nlc3MoIGRvYywgZml4LCAoIGF0dGFjaGVzIHx8IDAgKSArIDEgKTsKCQkJfSwKCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkgewoJCQkJdmFyIGRvYyA9IHRoaXMub3duZXJEb2N1bWVudCB8fCB0aGlzLAoJCQkJCWF0dGFjaGVzID0gZGF0YV9wcml2LmFjY2VzcyggZG9jLCBmaXggKSAtIDE7CgoJCQkJaWYgKCAhYXR0YWNoZXMgKSB7CgkJCQkJZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCQlkYXRhX3ByaXYucmVtb3ZlKCBkb2MsIGZpeCApOwoKCQkJCX0gZWxzZSB7CgkJCQkJZGF0YV9wcml2LmFjY2VzcyggZG9jLCBmaXgsIGF0dGFjaGVzICk7CgkJCQl9CgkJCX0KCQl9OwoJfSk7Cn0KCmpRdWVyeS5mbi5leHRlbmQoewoKCW9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgLypJTlRFUk5BTCovIG9uZSApIHsKCQl2YXIgb3JpZ0ZuLCB0eXBlOwoKCQkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgkJCS8vICggdHlwZXMtT2JqZWN0LCBzZWxlY3RvciwgZGF0YSApCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMtT2JqZWN0LCBkYXRhICkKCQkJCWRhdGEgPSBkYXRhIHx8IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub24oIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgkJCS8vICggdHlwZXMsIGZuICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7CgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCgkJCQlmbiA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJCWpRdWVyeSgpLm9mZiggZXZlbnQgKTsKCQkJCXJldHVybiBvcmlnRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9OwoJCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCQlmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKCBvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKysgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGVzLCBmbiwgZGF0YSwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCglvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7Cgl9LAoJb2ZmOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBmbiApIHsKCQl2YXIgaGFuZGxlT2JqLCB0eXBlOwoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoJCQkvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50CgkJCWhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajsKCQkJalF1ZXJ5KCB0eXBlcy5kZWxlZ2F0ZVRhcmdldCApLm9mZigKCQkJCWhhbmRsZU9iai5uYW1lc3BhY2UgPyBoYW5kbGVPYmoub3JpZ1R5cGUgKyAiLiIgKyBoYW5kbGVPYmoubmFtZXNwYWNlIDogaGFuZGxlT2JqLm9yaWdUeXBlLAoJCQkJaGFuZGxlT2JqLnNlbGVjdG9yLAoJCQkJaGFuZGxlT2JqLmhhbmRsZXIKCQkJKTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCQkJLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIgKSB7CgkJCS8vICggdHlwZXMgWywgZm5dICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggZm4gPT09IGZhbHNlICkgewoJCQlmbiA9IHJldHVybkZhbHNlOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCB0eXBlcywgZm4sIHNlbGVjdG9yICk7CgkJfSk7Cgl9LAoKCXRyaWdnZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCB0aGlzICk7CgkJfSk7Cgl9LAoJdHJpZ2dlckhhbmRsZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgewoJCXZhciBlbGVtID0gdGhpc1swXTsKCQlpZiAoIGVsZW0gKSB7CgkJCXJldHVybiBqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgZWxlbSwgdHJ1ZSApOwoJCX0KCX0KfSk7CgoKdmFyCglyeGh0bWxUYWcgPSAvPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2dpLAoJcnRhZ05hbWUgPSAvPChbXHc6XSspLywKCXJodG1sID0gLzx8JiM/XHcrOy8sCglybm9Jbm5lcmh0bWwgPSAvPCg/OnNjcmlwdHxzdHlsZXxsaW5rKS9pLAoJLy8gY2hlY2tlZD0iY2hlY2tlZCIgb3IgY2hlY2tlZAoJcmNoZWNrZWQgPSAvY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSwKCXJzY3JpcHRUeXBlID0gL14kfFwvKD86amF2YXxlY21hKXNjcmlwdC9pLAoJcnNjcmlwdFR5cGVNYXNrZWQgPSAvXnRydWVcLyguKikvLAoJcmNsZWFuU2NyaXB0ID0gL15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nLAoKCS8vIFdlIGhhdmUgdG8gY2xvc2UgdGhlc2UgdGFncyB0byBzdXBwb3J0IFhIVE1MICgjMTMyMDApCgl3cmFwTWFwID0gewoKCQkvLyBTdXBwb3J0OiBJRTkKCQlvcHRpb246IFsgMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+IiBdLAoKCQl0aGVhZDogWyAxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiIgXSwKCQljb2w6IFsgMiwgIjx0YWJsZT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCgkJdHI6IFsgMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwvdGJvZHk+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgoJCV9kZWZhdWx0OiBbIDAsICIiLCAiIiBdCgl9OwoKLy8gU3VwcG9ydDogSUU5CndyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbjsKCndyYXBNYXAudGJvZHkgPSB3cmFwTWFwLnRmb290ID0gd3JhcE1hcC5jb2xncm91cCA9IHdyYXBNYXAuY2FwdGlvbiA9IHdyYXBNYXAudGhlYWQ7CndyYXBNYXAudGggPSB3cmFwTWFwLnRkOwoKLy8gU3VwcG9ydDogMS54IGNvbXBhdGliaWxpdHkKLy8gTWFuaXB1bGF0aW5nIHRhYmxlcyByZXF1aXJlcyBhIHRib2R5CmZ1bmN0aW9uIG1hbmlwdWxhdGlvblRhcmdldCggZWxlbSwgY29udGVudCApIHsKCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJ0YWJsZSIgKSAmJgoJCWpRdWVyeS5ub2RlTmFtZSggY29udGVudC5ub2RlVHlwZSAhPT0gMTEgPyBjb250ZW50IDogY29udGVudC5maXJzdENoaWxkLCAidHIiICkgPwoKCQllbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpWzBdIHx8CgkJCWVsZW0uYXBwZW5kQ2hpbGQoIGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpICkgOgoJCWVsZW07Cn0KCi8vIFJlcGxhY2UvcmVzdG9yZSB0aGUgdHlwZSBhdHRyaWJ1dGUgb2Ygc2NyaXB0IGVsZW1lbnRzIGZvciBzYWZlIERPTSBtYW5pcHVsYXRpb24KZnVuY3Rpb24gZGlzYWJsZVNjcmlwdCggZWxlbSApIHsKCWVsZW0udHlwZSA9IChlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpICE9PSBudWxsKSArICIvIiArIGVsZW0udHlwZTsKCXJldHVybiBlbGVtOwp9CmZ1bmN0aW9uIHJlc3RvcmVTY3JpcHQoIGVsZW0gKSB7Cgl2YXIgbWF0Y2ggPSByc2NyaXB0VHlwZU1hc2tlZC5leGVjKCBlbGVtLnR5cGUgKTsKCglpZiAoIG1hdGNoICkgewoJCWVsZW0udHlwZSA9IG1hdGNoWyAxIF07Cgl9IGVsc2UgewoJCWVsZW0ucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIik7Cgl9CgoJcmV0dXJuIGVsZW07Cn0KCi8vIE1hcmsgc2NyaXB0cyBhcyBoYXZpbmcgYWxyZWFkeSBiZWVuIGV2YWx1YXRlZApmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7Cgl2YXIgaSA9IDAsCgkJbCA9IGVsZW1zLmxlbmd0aDsKCglmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJZGF0YV9wcml2LnNldCgKCQkJZWxlbXNbIGkgXSwgImdsb2JhbEV2YWwiLCAhcmVmRWxlbWVudHMgfHwgZGF0YV9wcml2LmdldCggcmVmRWxlbWVudHNbIGkgXSwgImdsb2JhbEV2YWwiICkKCQkpOwoJfQp9CgpmdW5jdGlvbiBjbG9uZUNvcHlFdmVudCggc3JjLCBkZXN0ICkgewoJdmFyIGksIGwsIHR5cGUsIHBkYXRhT2xkLCBwZGF0YUN1ciwgdWRhdGFPbGQsIHVkYXRhQ3VyLCBldmVudHM7CgoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkgewoJCXJldHVybjsKCX0KCgkvLyAxLiBDb3B5IHByaXZhdGUgZGF0YTogZXZlbnRzLCBoYW5kbGVycywgZXRjLgoJaWYgKCBkYXRhX3ByaXYuaGFzRGF0YSggc3JjICkgKSB7CgkJcGRhdGFPbGQgPSBkYXRhX3ByaXYuYWNjZXNzKCBzcmMgKTsKCQlwZGF0YUN1ciA9IGRhdGFfcHJpdi5zZXQoIGRlc3QsIHBkYXRhT2xkICk7CgkJZXZlbnRzID0gcGRhdGFPbGQuZXZlbnRzOwoKCQlpZiAoIGV2ZW50cyApIHsKCQkJZGVsZXRlIHBkYXRhQ3VyLmhhbmRsZTsKCQkJcGRhdGFDdXIuZXZlbnRzID0ge307CgoJCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJCWZvciAoIGkgPSAwLCBsID0gZXZlbnRzWyB0eXBlIF0ubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIGRlc3QsIHR5cGUsIGV2ZW50c1sgdHlwZSBdWyBpIF0gKTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyAyLiBDb3B5IHVzZXIgZGF0YQoJaWYgKCBkYXRhX3VzZXIuaGFzRGF0YSggc3JjICkgKSB7CgkJdWRhdGFPbGQgPSBkYXRhX3VzZXIuYWNjZXNzKCBzcmMgKTsKCQl1ZGF0YUN1ciA9IGpRdWVyeS5leHRlbmQoIHt9LCB1ZGF0YU9sZCApOwoKCQlkYXRhX3VzZXIuc2V0KCBkZXN0LCB1ZGF0YUN1ciApOwoJfQp9CgpmdW5jdGlvbiBnZXRBbGwoIGNvbnRleHQsIHRhZyApIHsKCXZhciByZXQgPSBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lID8gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnIHx8ICIqIiApIDoKCQkJY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsID8gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgfHwgIioiICkgOgoJCQlbXTsKCglyZXR1cm4gdGFnID09PSB1bmRlZmluZWQgfHwgdGFnICYmIGpRdWVyeS5ub2RlTmFtZSggY29udGV4dCwgdGFnICkgPwoJCWpRdWVyeS5tZXJnZSggWyBjb250ZXh0IF0sIHJldCApIDoKCQlyZXQ7Cn0KCi8vIEZpeCBJRSBidWdzLCBzZWUgc3VwcG9ydCB0ZXN0cwpmdW5jdGlvbiBmaXhJbnB1dCggc3JjLCBkZXN0ICkgewoJdmFyIG5vZGVOYW1lID0gZGVzdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoKCS8vIEZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3ggb3IgcmFkaW8gYnV0dG9uLgoJaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiAmJiByY2hlY2thYmxlVHlwZS50ZXN0KCBzcmMudHlwZSApICkgewoJCWRlc3QuY2hlY2tlZCA9IHNyYy5jaGVja2VkOwoKCS8vIEZhaWxzIHRvIHJldHVybiB0aGUgc2VsZWN0ZWQgb3B0aW9uIHRvIHRoZSBkZWZhdWx0IHNlbGVjdGVkIHN0YXRlIHdoZW4gY2xvbmluZyBvcHRpb25zCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoewoJY2xvbmU6IGZ1bmN0aW9uKCBlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQl2YXIgaSwgbCwgc3JjRWxlbWVudHMsIGRlc3RFbGVtZW50cywKCQkJY2xvbmUgPSBlbGVtLmNsb25lTm9kZSggdHJ1ZSApLAoJCQlpblBhZ2UgPSBqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApOwoKCQkvLyBGaXggSUUgY2xvbmluZyBpc3N1ZXMKCQlpZiAoICFzdXBwb3J0Lm5vQ2xvbmVDaGVja2VkICYmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBlbGVtLm5vZGVUeXBlID09PSAxMSApICYmCgkJCQkhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgKSB7CgoJCQkvLyBXZSBlc2NoZXcgU2l6emxlIGhlcmUgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnM6IGh0dHA6Ly9qc3BlcmYuY29tL2dldGFsbC12cy1zaXp6bGUvMgoJCQlkZXN0RWxlbWVudHMgPSBnZXRBbGwoIGNsb25lICk7CgkJCXNyY0VsZW1lbnRzID0gZ2V0QWxsKCBlbGVtICk7CgoJCQlmb3IgKCBpID0gMCwgbCA9IHNyY0VsZW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKyApIHsKCQkJCWZpeElucHV0KCBzcmNFbGVtZW50c1sgaSBdLCBkZXN0RWxlbWVudHNbIGkgXSApOwoJCQl9CgkJfQoKCQkvLyBDb3B5IHRoZSBldmVudHMgZnJvbSB0aGUgb3JpZ2luYWwgdG8gdGhlIGNsb25lCgkJaWYgKCBkYXRhQW5kRXZlbnRzICkgewoJCQlpZiAoIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQkJc3JjRWxlbWVudHMgPSBzcmNFbGVtZW50cyB8fCBnZXRBbGwoIGVsZW0gKTsKCQkJCWRlc3RFbGVtZW50cyA9IGRlc3RFbGVtZW50cyB8fCBnZXRBbGwoIGNsb25lICk7CgoJCQkJZm9yICggaSA9IDAsIGwgPSBzcmNFbGVtZW50cy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQkJY2xvbmVDb3B5RXZlbnQoIHNyY0VsZW1lbnRzWyBpIF0sIGRlc3RFbGVtZW50c1sgaSBdICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQljbG9uZUNvcHlFdmVudCggZWxlbSwgY2xvbmUgKTsKCQkJfQoJCX0KCgkJLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQoJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUsICJzY3JpcHQiICk7CgkJaWYgKCBkZXN0RWxlbWVudHMubGVuZ3RoID4gMCApIHsKCQkJc2V0R2xvYmFsRXZhbCggZGVzdEVsZW1lbnRzLCAhaW5QYWdlICYmIGdldEFsbCggZWxlbSwgInNjcmlwdCIgKSApOwoJCX0KCgkJLy8gUmV0dXJuIHRoZSBjbG9uZWQgc2V0CgkJcmV0dXJuIGNsb25lOwoJfSwKCglidWlsZEZyYWdtZW50OiBmdW5jdGlvbiggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiApIHsKCQl2YXIgZWxlbSwgdG1wLCB0YWcsIHdyYXAsIGNvbnRhaW5zLCBqLAoJCQlmcmFnbWVudCA9IGNvbnRleHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQlub2RlcyA9IFtdLAoJCQlpID0gMCwKCQkJbCA9IGVsZW1zLmxlbmd0aDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQllbGVtID0gZWxlbXNbIGkgXTsKCgkJCWlmICggZWxlbSB8fCBlbGVtID09PSAwICkgewoKCQkJCS8vIEFkZCBub2RlcyBkaXJlY3RseQoJCQkJaWYgKCBqUXVlcnkudHlwZSggZWxlbSApID09PSAib2JqZWN0IiApIHsKCQkJCQkvLyBTdXBwb3J0OiBRdFdlYktpdCwgUGhhbnRvbUpTCgkJCQkJLy8gcHVzaC5hcHBseShfLCBhcnJheWxpa2UpIHRocm93cyBvbiBhbmNpZW50IFdlYktpdAoJCQkJCWpRdWVyeS5tZXJnZSggbm9kZXMsIGVsZW0ubm9kZVR5cGUgPyBbIGVsZW0gXSA6IGVsZW0gKTsKCgkJCQkvLyBDb252ZXJ0IG5vbi1odG1sIGludG8gYSB0ZXh0IG5vZGUKCQkJCX0gZWxzZSBpZiAoICFyaHRtbC50ZXN0KCBlbGVtICkgKSB7CgkJCQkJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggZWxlbSApICk7CgoJCQkJLy8gQ29udmVydCBodG1sIGludG8gRE9NIG5vZGVzCgkJCQl9IGVsc2UgewoJCQkJCXRtcCA9IHRtcCB8fCBmcmFnbWVudC5hcHBlbmRDaGlsZCggY29udGV4dC5jcmVhdGVFbGVtZW50KCJkaXYiKSApOwoKCQkJCQkvLyBEZXNlcmlhbGl6ZSBhIHN0YW5kYXJkIHJlcHJlc2VudGF0aW9uCgkJCQkJdGFnID0gKCBydGFnTmFtZS5leGVjKCBlbGVtICkgfHwgWyAiIiwgIiIgXSApWyAxIF0udG9Mb3dlckNhc2UoKTsKCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdDsKCQkJCQl0bXAuaW5uZXJIVE1MID0gd3JhcFsgMSBdICsgZWxlbS5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICkgKyB3cmFwWyAyIF07CgoJCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJCWogPSB3cmFwWyAwIF07CgkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCXRtcCA9IHRtcC5sYXN0Q2hpbGQ7CgkJCQkJfQoKCQkJCQkvLyBTdXBwb3J0OiBRdFdlYktpdCwgUGhhbnRvbUpTCgkJCQkJLy8gcHVzaC5hcHBseShfLCBhcnJheWxpa2UpIHRocm93cyBvbiBhbmNpZW50IFdlYktpdAoJCQkJCWpRdWVyeS5tZXJnZSggbm9kZXMsIHRtcC5jaGlsZE5vZGVzICk7CgoJCQkJCS8vIFJlbWVtYmVyIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyCgkJCQkJdG1wID0gZnJhZ21lbnQuZmlyc3RDaGlsZDsKCgkJCQkJLy8gRW5zdXJlIHRoZSBjcmVhdGVkIG5vZGVzIGFyZSBvcnBoYW5lZCAoIzEyMzkyKQoJCQkJCXRtcC50ZXh0Q29udGVudCA9ICIiOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBSZW1vdmUgd3JhcHBlciBmcm9tIGZyYWdtZW50CgkJZnJhZ21lbnQudGV4dENvbnRlbnQgPSAiIjsKCgkJaSA9IDA7CgkJd2hpbGUgKCAoZWxlbSA9IG5vZGVzWyBpKysgXSkgKSB7CgoJCQkvLyAjNDA4NyAtIElmIG9yaWdpbiBhbmQgZGVzdGluYXRpb24gZWxlbWVudHMgYXJlIHRoZSBzYW1lLCBhbmQgdGhpcyBpcwoJCQkvLyB0aGF0IGVsZW1lbnQsIGRvIG5vdCBkbyBhbnl0aGluZwoJCQlpZiAoIHNlbGVjdGlvbiAmJiBqUXVlcnkuaW5BcnJheSggZWxlbSwgc2VsZWN0aW9uICkgIT09IC0xICkgewoJCQkJY29udGludWU7CgkJCX0KCgkJCWNvbnRhaW5zID0galF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKCgkJCS8vIEFwcGVuZCB0byBmcmFnbWVudAoJCQl0bXAgPSBnZXRBbGwoIGZyYWdtZW50LmFwcGVuZENoaWxkKCBlbGVtICksICJzY3JpcHQiICk7CgoJCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJCWlmICggY29udGFpbnMgKSB7CgkJCQlzZXRHbG9iYWxFdmFsKCB0bXAgKTsKCQkJfQoKCQkJLy8gQ2FwdHVyZSBleGVjdXRhYmxlcwoJCQlpZiAoIHNjcmlwdHMgKSB7CgkJCQlqID0gMDsKCQkJCXdoaWxlICggKGVsZW0gPSB0bXBbIGorKyBdKSApIHsKCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSB8fCAiIiApICkgewoJCQkJCQlzY3JpcHRzLnB1c2goIGVsZW0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBmcmFnbWVudDsKCX0sCgoJY2xlYW5EYXRhOiBmdW5jdGlvbiggZWxlbXMgKSB7CgkJdmFyIGRhdGEsIGVsZW0sIHR5cGUsIGtleSwKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zWyBpIF0pICE9PSB1bmRlZmluZWQ7IGkrKyApIHsKCQkJaWYgKCBqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCQkJa2V5ID0gZWxlbVsgZGF0YV9wcml2LmV4cGFuZG8gXTsKCgkJCQlpZiAoIGtleSAmJiAoZGF0YSA9IGRhdGFfcHJpdi5jYWNoZVsga2V5IF0pICkgewoJCQkJCWlmICggZGF0YS5ldmVudHMgKSB7CgkJCQkJCWZvciAoIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7CgoJCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJaWYgKCBkYXRhX3ByaXYuY2FjaGVbIGtleSBdICkgewoJCQkJCQkvLyBEaXNjYXJkIGFueSByZW1haW5pbmcgYHByaXZhdGVgIGRhdGEKCQkJCQkJZGVsZXRlIGRhdGFfcHJpdi5jYWNoZVsga2V5IF07CgkJCQkJfQoJCQkJfQoJCQl9CgkJCS8vIERpc2NhcmQgYW55IHJlbWFpbmluZyBgdXNlcmAgZGF0YQoJCQlkZWxldGUgZGF0YV91c2VyLmNhY2hlWyBlbGVtWyBkYXRhX3VzZXIuZXhwYW5kbyBdIF07CgkJfQoJfQp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPwoJCQkJalF1ZXJ5LnRleHQoIHRoaXMgKSA6CgkJCQl0aGlzLmVtcHR5KCkuZWFjaChmdW5jdGlvbigpIHsKCQkJCQlpZiAoIHRoaXMubm9kZVR5cGUgPT09IDEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gMTEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gOSApIHsKCQkJCQkJdGhpcy50ZXh0Q29udGVudCA9IHZhbHVlOwoJCQkJCX0KCQkJCX0pOwoJCX0sIG51bGwsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoICk7Cgl9LAoKCWFwcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgewoJCQkJdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCggdGhpcywgZWxlbSApOwoJCQkJdGFyZ2V0LmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9KTsKCX0sCgoJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgewoJCQkJdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCggdGhpcywgZWxlbSApOwoJCQkJdGFyZ2V0Lmluc2VydEJlZm9yZSggZWxlbSwgdGFyZ2V0LmZpcnN0Q2hpbGQgKTsKCQkJfQoJCX0pOwoJfSwKCgliZWZvcmU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmRvbU1hbmlwKCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSApIHsKCQkJCXRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIGVsZW0sIHRoaXMgKTsKCQkJfQoJCX0pOwoJfSwKCglhZnRlcjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9CgkJfSk7Cgl9LAoKCXJlbW92ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCBrZWVwRGF0YSAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHsKCQl2YXIgZWxlbSwKCQkJZWxlbXMgPSBzZWxlY3RvciA/IGpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCB0aGlzICkgOiB0aGlzLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCWlmICggIWtlZXBEYXRhICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0gKSApOwoJCQl9CgoJCQlpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCWlmICgga2VlcERhdGEgJiYgalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCQlzZXRHbG9iYWxFdmFsKCBnZXRBbGwoIGVsZW0sICJzY3JpcHQiICkgKTsKCQkJCX0KCQkJCWVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZWxlbSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZW1wdHk6IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoKCQkJCS8vIFByZXZlbnQgbWVtb3J5IGxlYWtzCgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsKCgkJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQkJZWxlbS50ZXh0Q29udGVudCA9ICIiOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQlkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwoJCWRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKCgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4galF1ZXJ5LmNsb25lKCB0aGlzLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApOwoJCX0pOwoJfSwKCglodG1sOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgZWxlbSA9IHRoaXNbIDAgXSB8fCB7fSwKCQkJCWkgPSAwLAoJCQkJbCA9IHRoaXMubGVuZ3RoOwoKCQkJaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlyZXR1cm4gZWxlbS5pbm5lckhUTUw7CgkJCX0KCgkJCS8vIFNlZSBpZiB3ZSBjYW4gdGFrZSBhIHNob3J0Y3V0IGFuZCBqdXN0IHVzZSBpbm5lckhUTUwKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmICFybm9Jbm5lcmh0bWwudGVzdCggdmFsdWUgKSAmJgoJCQkJIXdyYXBNYXBbICggcnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbICIiLCAiIiBdIClbIDEgXS50b0xvd2VyQ2FzZSgpIF0gKSB7CgoJCQkJdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICk7CgoJCQkJdHJ5IHsKCQkJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQkJCWVsZW0gPSB0aGlzWyBpIF0gfHwge307CgoJCQkJCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MKCQkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQkJalF1ZXJ5LmNsZWFuRGF0YSggZ2V0QWxsKCBlbGVtLCBmYWxzZSApICk7CgkJCQkJCQllbGVtLmlubmVySFRNTCA9IHZhbHVlOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQllbGVtID0gMDsKCgkJCQkvLyBJZiB1c2luZyBpbm5lckhUTUwgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgdXNlIHRoZSBmYWxsYmFjayBtZXRob2QKCQkJCX0gY2F0Y2goIGUgKSB7fQoJCQl9CgoJCQlpZiAoIGVsZW0gKSB7CgkJCQl0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApOwoJCQl9CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJcmVwbGFjZVdpdGg6IGZ1bmN0aW9uKCkgewoJCXZhciBhcmcgPSBhcmd1bWVudHNbIDAgXTsKCgkJLy8gTWFrZSB0aGUgY2hhbmdlcywgcmVwbGFjaW5nIGVhY2ggY29udGV4dCBlbGVtZW50IHdpdGggdGhlIG5ldyBjb250ZW50CgkJdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJYXJnID0gdGhpcy5wYXJlbnROb2RlOwoKCQkJalF1ZXJ5LmNsZWFuRGF0YSggZ2V0QWxsKCB0aGlzICkgKTsKCgkJCWlmICggYXJnICkgewoJCQkJYXJnLnJlcGxhY2VDaGlsZCggZWxlbSwgdGhpcyApOwoJCQl9CgkJfSk7CgoJCS8vIEZvcmNlIHJlbW92YWwgaWYgdGhlcmUgd2FzIG5vIG5ldyBjb250ZW50IChlLmcuLCBmcm9tIGVtcHR5IGFyZ3VtZW50cykKCQlyZXR1cm4gYXJnICYmIChhcmcubGVuZ3RoIHx8IGFyZy5ub2RlVHlwZSkgPyB0aGlzIDogdGhpcy5yZW1vdmUoKTsKCX0sCgoJZGV0YWNoOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMucmVtb3ZlKCBzZWxlY3RvciwgdHJ1ZSApOwoJfSwKCglkb21NYW5pcDogZnVuY3Rpb24oIGFyZ3MsIGNhbGxiYWNrICkgewoKCQkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgkJYXJncyA9IGNvbmNhdC5hcHBseSggW10sIGFyZ3MgKTsKCgkJdmFyIGZyYWdtZW50LCBmaXJzdCwgc2NyaXB0cywgaGFzU2NyaXB0cywgbm9kZSwgZG9jLAoJCQlpID0gMCwKCQkJbCA9IHRoaXMubGVuZ3RoLAoJCQlzZXQgPSB0aGlzLAoJCQlpTm9DbG9uZSA9IGwgLSAxLAoJCQl2YWx1ZSA9IGFyZ3NbIDAgXSwKCQkJaXNGdW5jdGlvbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApOwoKCQkvLyBXZSBjYW4ndCBjbG9uZU5vZGUgZnJhZ21lbnRzIHRoYXQgY29udGFpbiBjaGVja2VkLCBpbiBXZWJLaXQKCQlpZiAoIGlzRnVuY3Rpb24gfHwKCQkJCSggbCA+IDEgJiYgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJgoJCQkJCSFzdXBwb3J0LmNoZWNrQ2xvbmUgJiYgcmNoZWNrZWQudGVzdCggdmFsdWUgKSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpbmRleCApIHsKCQkJCXZhciBzZWxmID0gc2V0LmVxKCBpbmRleCApOwoJCQkJaWYgKCBpc0Z1bmN0aW9uICkgewoJCQkJCWFyZ3NbIDAgXSA9IHZhbHVlLmNhbGwoIHRoaXMsIGluZGV4LCBzZWxmLmh0bWwoKSApOwoJCQkJfQoJCQkJc2VsZi5kb21NYW5pcCggYXJncywgY2FsbGJhY2sgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIGwgKSB7CgkJCWZyYWdtZW50ID0galF1ZXJ5LmJ1aWxkRnJhZ21lbnQoIGFyZ3MsIHRoaXNbIDAgXS5vd25lckRvY3VtZW50LCBmYWxzZSwgdGhpcyApOwoJCQlmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgoJCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQkJZnJhZ21lbnQgPSBmaXJzdDsKCQkJfQoKCQkJaWYgKCBmaXJzdCApIHsKCQkJCXNjcmlwdHMgPSBqUXVlcnkubWFwKCBnZXRBbGwoIGZyYWdtZW50LCAic2NyaXB0IiApLCBkaXNhYmxlU2NyaXB0ICk7CgkJCQloYXNTY3JpcHRzID0gc2NyaXB0cy5sZW5ndGg7CgoJCQkJLy8gVXNlIHRoZSBvcmlnaW5hbCBmcmFnbWVudCBmb3IgdGhlIGxhc3QgaXRlbSBpbnN0ZWFkIG9mIHRoZSBmaXJzdCBiZWNhdXNlIGl0IGNhbiBlbmQgdXAKCQkJCS8vIGJlaW5nIGVtcHRpZWQgaW5jb3JyZWN0bHkgaW4gY2VydGFpbiBzaXR1YXRpb25zICgjODA3MCkuCgkJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQkJbm9kZSA9IGZyYWdtZW50OwoKCQkJCQlpZiAoIGkgIT09IGlOb0Nsb25lICkgewoJCQkJCQlub2RlID0galF1ZXJ5LmNsb25lKCBub2RlLCB0cnVlLCB0cnVlICk7CgoJCQkJCQkvLyBLZWVwIHJlZmVyZW5jZXMgdG8gY2xvbmVkIHNjcmlwdHMgZm9yIGxhdGVyIHJlc3RvcmF0aW9uCgkJCQkJCWlmICggaGFzU2NyaXB0cyApIHsKCQkJCQkJCS8vIFN1cHBvcnQ6IFF0V2ViS2l0CgkJCQkJCQkvLyBqUXVlcnkubWVyZ2UgYmVjYXVzZSBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzCgkJCQkJCQlqUXVlcnkubWVyZ2UoIHNjcmlwdHMsIGdldEFsbCggbm9kZSwgInNjcmlwdCIgKSApOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQljYWxsYmFjay5jYWxsKCB0aGlzWyBpIF0sIG5vZGUsIGkgKTsKCQkJCX0KCgkJCQlpZiAoIGhhc1NjcmlwdHMgKSB7CgkJCQkJZG9jID0gc2NyaXB0c1sgc2NyaXB0cy5sZW5ndGggLSAxIF0ub3duZXJEb2N1bWVudDsKCgkJCQkJLy8gUmVlbmFibGUgc2NyaXB0cwoJCQkJCWpRdWVyeS5tYXAoIHNjcmlwdHMsIHJlc3RvcmVTY3JpcHQgKTsKCgkJCQkJLy8gRXZhbHVhdGUgZXhlY3V0YWJsZSBzY3JpcHRzIG9uIGZpcnN0IGRvY3VtZW50IGluc2VydGlvbgoJCQkJCWZvciAoIGkgPSAwOyBpIDwgaGFzU2NyaXB0czsgaSsrICkgewoJCQkJCQlub2RlID0gc2NyaXB0c1sgaSBdOwoJCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIG5vZGUudHlwZSB8fCAiIiApICYmCgkJCQkJCQkhZGF0YV9wcml2LmFjY2Vzcyggbm9kZSwgImdsb2JhbEV2YWwiICkgJiYgalF1ZXJ5LmNvbnRhaW5zKCBkb2MsIG5vZGUgKSApIHsKCgkJCQkJCQlpZiAoIG5vZGUuc3JjICkgewoJCQkJCQkJCS8vIE9wdGlvbmFsIEFKQVggZGVwZW5kZW5jeSwgYnV0IHdvbid0IHJ1biBzY3JpcHRzIGlmIG5vdCBwcmVzZW50CgkJCQkJCQkJaWYgKCBqUXVlcnkuX2V2YWxVcmwgKSB7CgkJCQkJCQkJCWpRdWVyeS5fZXZhbFVybCggbm9kZS5zcmMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWpRdWVyeS5nbG9iYWxFdmFsKCBub2RlLnRleHRDb250ZW50LnJlcGxhY2UoIHJjbGVhblNjcmlwdCwgIiIgKSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0KfSk7CgpqUXVlcnkuZWFjaCh7CglhcHBlbmRUbzogImFwcGVuZCIsCglwcmVwZW5kVG86ICJwcmVwZW5kIiwKCWluc2VydEJlZm9yZTogImJlZm9yZSIsCglpbnNlcnRBZnRlcjogImFmdGVyIiwKCXJlcGxhY2VBbGw6ICJyZXBsYWNlV2l0aCIKfSwgZnVuY3Rpb24oIG5hbWUsIG9yaWdpbmFsICkgewoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJdmFyIGVsZW1zLAoJCQlyZXQgPSBbXSwKCQkJaW5zZXJ0ID0galF1ZXJ5KCBzZWxlY3RvciApLAoJCQlsYXN0ID0gaW5zZXJ0Lmxlbmd0aCAtIDEsCgkJCWkgPSAwOwoKCQlmb3IgKCA7IGkgPD0gbGFzdDsgaSsrICkgewoJCQllbGVtcyA9IGkgPT09IGxhc3QgPyB0aGlzIDogdGhpcy5jbG9uZSggdHJ1ZSApOwoJCQlqUXVlcnkoIGluc2VydFsgaSBdIClbIG9yaWdpbmFsIF0oIGVsZW1zICk7CgoJCQkvLyBTdXBwb3J0OiBRdFdlYktpdAoJCQkvLyAuZ2V0KCkgYmVjYXVzZSBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzCgkJCXB1c2guYXBwbHkoIHJldCwgZWxlbXMuZ2V0KCkgKTsKCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7Cgl9Owp9KTsKCgp2YXIgaWZyYW1lLAoJZWxlbWRpc3BsYXkgPSB7fTsKCi8qKgogKiBSZXRyaWV2ZSB0aGUgYWN0dWFsIGRpc3BsYXkgb2YgYSBlbGVtZW50CiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIG5vZGVOYW1lIG9mIHRoZSBlbGVtZW50CiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MgRG9jdW1lbnQgb2JqZWN0CiAqLwovLyBDYWxsZWQgb25seSBmcm9tIHdpdGhpbiBkZWZhdWx0RGlzcGxheQpmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7Cgl2YXIgc3R5bGUsCgkJZWxlbSA9IGpRdWVyeSggZG9jLmNyZWF0ZUVsZW1lbnQoIG5hbWUgKSApLmFwcGVuZFRvKCBkb2MuYm9keSApLAoKCQkvLyBnZXREZWZhdWx0Q29tcHV0ZWRTdHlsZSBtaWdodCBiZSByZWxpYWJseSB1c2VkIG9ubHkgb24gYXR0YWNoZWQgZWxlbWVudAoJCWRpc3BsYXkgPSB3aW5kb3cuZ2V0RGVmYXVsdENvbXB1dGVkU3R5bGUgJiYgKCBzdHlsZSA9IHdpbmRvdy5nZXREZWZhdWx0Q29tcHV0ZWRTdHlsZSggZWxlbVsgMCBdICkgKSA/CgoJCQkvLyBVc2Ugb2YgdGhpcyBtZXRob2QgaXMgYSB0ZW1wb3JhcnkgZml4IChtb3JlIGxpa2Ugb3B0aW1pemF0aW9uKSB1bnRpbCBzb21ldGhpbmcgYmV0dGVyIGNvbWVzIGFsb25nLAoJCQkvLyBzaW5jZSBpdCB3YXMgcmVtb3ZlZCBmcm9tIHNwZWNpZmljYXRpb24gYW5kIHN1cHBvcnRlZCBvbmx5IGluIEZGCgkJCXN0eWxlLmRpc3BsYXkgOiBqUXVlcnkuY3NzKCBlbGVtWyAwIF0sICJkaXNwbGF5IiApOwoKCS8vIFdlIGRvbid0IGhhdmUgYW55IGRhdGEgc3RvcmVkIG9uIHRoZSBlbGVtZW50LAoJLy8gc28gdXNlICJkZXRhY2giIG1ldGhvZCBhcyBmYXN0IHdheSB0byBnZXQgcmlkIG9mIHRoZSBlbGVtZW50CgllbGVtLmRldGFjaCgpOwoKCXJldHVybiBkaXNwbGF5Owp9CgovKioKICogVHJ5IHRvIGRldGVybWluZSB0aGUgZGVmYXVsdCBkaXNwbGF5IHZhbHVlIG9mIGFuIGVsZW1lbnQKICogQHBhcmFtIHtTdHJpbmd9IG5vZGVOYW1lCiAqLwpmdW5jdGlvbiBkZWZhdWx0RGlzcGxheSggbm9kZU5hbWUgKSB7Cgl2YXIgZG9jID0gZG9jdW1lbnQsCgkJZGlzcGxheSA9IGVsZW1kaXNwbGF5WyBub2RlTmFtZSBdOwoKCWlmICggIWRpc3BsYXkgKSB7CgkJZGlzcGxheSA9IGFjdHVhbERpc3BsYXkoIG5vZGVOYW1lLCBkb2MgKTsKCgkJLy8gSWYgdGhlIHNpbXBsZSB3YXkgZmFpbHMsIHJlYWQgZnJvbSBpbnNpZGUgYW4gaWZyYW1lCgkJaWYgKCBkaXNwbGF5ID09PSAibm9uZSIgfHwgIWRpc3BsYXkgKSB7CgoJCQkvLyBVc2UgdGhlIGFscmVhZHktY3JlYXRlZCBpZnJhbWUgaWYgcG9zc2libGUKCQkJaWZyYW1lID0gKGlmcmFtZSB8fCBqUXVlcnkoICI8aWZyYW1lIGZyYW1lYm9yZGVyPScwJyB3aWR0aD0nMCcgaGVpZ2h0PScwJy8+IiApKS5hcHBlbmRUbyggZG9jLmRvY3VtZW50RWxlbWVudCApOwoKCQkJLy8gQWx3YXlzIHdyaXRlIGEgbmV3IEhUTUwgc2tlbGV0b24gc28gV2Via2l0IGFuZCBGaXJlZm94IGRvbid0IGNob2tlIG9uIHJldXNlCgkJCWRvYyA9IGlmcmFtZVsgMCBdLmNvbnRlbnREb2N1bWVudDsKCgkJCS8vIFN1cHBvcnQ6IElFCgkJCWRvYy53cml0ZSgpOwoJCQlkb2MuY2xvc2UoKTsKCgkJCWRpc3BsYXkgPSBhY3R1YWxEaXNwbGF5KCBub2RlTmFtZSwgZG9jICk7CgkJCWlmcmFtZS5kZXRhY2goKTsKCQl9CgoJCS8vIFN0b3JlIHRoZSBjb3JyZWN0IGRlZmF1bHQgZGlzcGxheQoJCWVsZW1kaXNwbGF5WyBub2RlTmFtZSBdID0gZGlzcGxheTsKCX0KCglyZXR1cm4gZGlzcGxheTsKfQp2YXIgcm1hcmdpbiA9ICgvXm1hcmdpbi8pOwoKdmFyIHJudW1ub25weCA9IG5ldyBSZWdFeHAoICJeKCIgKyBwbnVtICsgIikoPyFweClbYS16JV0rJCIsICJpIiApOwoKdmFyIGdldFN0eWxlcyA9IGZ1bmN0aW9uKCBlbGVtICkgewoJCS8vIFN1cHBvcnQ6IElFPD0xMSssIEZpcmVmb3g8PTMwKyAoIzE1MDk4LCAjMTQxNTApCgkJLy8gSUUgdGhyb3dzIG9uIGVsZW1lbnRzIGNyZWF0ZWQgaW4gcG9wdXBzCgkJLy8gRkYgbWVhbndoaWxlIHRocm93cyBvbiBmcmFtZSBlbGVtZW50cyB0aHJvdWdoICJkZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlIgoJCWlmICggZWxlbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3Lm9wZW5lciApIHsKCQkJcmV0dXJuIGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICk7CgkJfQoKCQlyZXR1cm4gd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGVsZW0sIG51bGwgKTsKCX07CgoKCmZ1bmN0aW9uIGN1ckNTUyggZWxlbSwgbmFtZSwgY29tcHV0ZWQgKSB7Cgl2YXIgd2lkdGgsIG1pbldpZHRoLCBtYXhXaWR0aCwgcmV0LAoJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgljb21wdXRlZCA9IGNvbXB1dGVkIHx8IGdldFN0eWxlcyggZWxlbSApOwoKCS8vIFN1cHBvcnQ6IElFOQoJLy8gZ2V0UHJvcGVydHlWYWx1ZSBpcyBvbmx5IG5lZWRlZCBmb3IgLmNzcygnZmlsdGVyJykgKCMxMjUzNykKCWlmICggY29tcHV0ZWQgKSB7CgkJcmV0ID0gY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApIHx8IGNvbXB1dGVkWyBuYW1lIF07Cgl9CgoJaWYgKCBjb21wdXRlZCApIHsKCgkJaWYgKCByZXQgPT09ICIiICYmICFqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApICkgewoJCQlyZXQgPSBqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUgKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IGlPUyA8IDYKCQkvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgoJCS8vIGlPUyA8IDYgKGF0IGxlYXN0KSByZXR1cm5zIHBlcmNlbnRhZ2UgZm9yIGEgbGFyZ2VyIHNldCBvZiB2YWx1ZXMsIGJ1dCB3aWR0aCBzZWVtcyB0byBiZSByZWxpYWJseSBwaXhlbHMKCQkvLyB0aGlzIGlzIGFnYWluc3QgdGhlIENTU09NIGRyYWZ0IHNwZWM6IGh0dHA6Ly9kZXYudzMub3JnL2Nzc3dnL2Nzc29tLyNyZXNvbHZlZC12YWx1ZXMKCQlpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiBybWFyZ2luLnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJd2lkdGggPSBzdHlsZS53aWR0aDsKCQkJbWluV2lkdGggPSBzdHlsZS5taW5XaWR0aDsKCQkJbWF4V2lkdGggPSBzdHlsZS5tYXhXaWR0aDsKCgkJCS8vIFB1dCBpbiB0aGUgbmV3IHZhbHVlcyB0byBnZXQgYSBjb21wdXRlZCB2YWx1ZSBvdXQKCQkJc3R5bGUubWluV2lkdGggPSBzdHlsZS5tYXhXaWR0aCA9IHN0eWxlLndpZHRoID0gcmV0OwoJCQlyZXQgPSBjb21wdXRlZC53aWR0aDsKCgkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJc3R5bGUud2lkdGggPSB3aWR0aDsKCQkJc3R5bGUubWluV2lkdGggPSBtaW5XaWR0aDsKCQkJc3R5bGUubWF4V2lkdGggPSBtYXhXaWR0aDsKCQl9Cgl9CgoJcmV0dXJuIHJldCAhPT0gdW5kZWZpbmVkID8KCQkvLyBTdXBwb3J0OiBJRQoJCS8vIElFIHJldHVybnMgekluZGV4IHZhbHVlIGFzIGFuIGludGVnZXIuCgkJcmV0ICsgIiIgOgoJCXJldDsKfQoKCmZ1bmN0aW9uIGFkZEdldEhvb2tJZiggY29uZGl0aW9uRm4sIGhvb2tGbiApIHsKCS8vIERlZmluZSB0aGUgaG9vaywgd2UnbGwgY2hlY2sgb24gdGhlIGZpcnN0IHJ1biBpZiBpdCdzIHJlYWxseSBuZWVkZWQuCglyZXR1cm4gewoJCWdldDogZnVuY3Rpb24oKSB7CgkJCWlmICggY29uZGl0aW9uRm4oKSApIHsKCQkJCS8vIEhvb2sgbm90IG5lZWRlZCAob3IgaXQncyBub3QgcG9zc2libGUgdG8gdXNlIGl0IGR1ZQoJCQkJLy8gdG8gbWlzc2luZyBkZXBlbmRlbmN5KSwgcmVtb3ZlIGl0LgoJCQkJZGVsZXRlIHRoaXMuZ2V0OwoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBIb29rIG5lZWRlZDsgcmVkZWZpbmUgaXQgc28gdGhhdCB0aGUgc3VwcG9ydCB0ZXN0IGlzIG5vdCBleGVjdXRlZCBhZ2Fpbi4KCQkJcmV0dXJuICh0aGlzLmdldCA9IGhvb2tGbikuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCX0KCX07Cn0KCgooZnVuY3Rpb24oKSB7Cgl2YXIgcGl4ZWxQb3NpdGlvblZhbCwgYm94U2l6aW5nUmVsaWFibGVWYWwsCgkJZG9jRWxlbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKCQljb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLAoJCWRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgoJaWYgKCAhZGl2LnN0eWxlICkgewoJCXJldHVybjsKCX0KCgkvLyBTdXBwb3J0OiBJRTktMTErCgkvLyBTdHlsZSBvZiBjbG9uZWQgZWxlbWVudCBhZmZlY3RzIHNvdXJjZSBlbGVtZW50IGNsb25lZCAoIzg5MDgpCglkaXYuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiY29udGVudC1ib3giOwoJZGl2LmNsb25lTm9kZSggdHJ1ZSApLnN0eWxlLmJhY2tncm91bmRDbGlwID0gIiI7CglzdXBwb3J0LmNsZWFyQ2xvbmVTdHlsZSA9IGRpdi5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9PT0gImNvbnRlbnQtYm94IjsKCgljb250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICJib3JkZXI6MDt3aWR0aDowO2hlaWdodDowO3RvcDowO2xlZnQ6LTk5OTlweDttYXJnaW4tdG9wOjFweDsiICsKCQkicG9zaXRpb246YWJzb2x1dGUiOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKCBkaXYgKTsKCgkvLyBFeGVjdXRpbmcgYm90aCBwaXhlbFBvc2l0aW9uICYgYm94U2l6aW5nUmVsaWFibGUgdGVzdHMgcmVxdWlyZSBvbmx5IG9uZSBsYXlvdXQKCS8vIHNvIHRoZXkncmUgZXhlY3V0ZWQgYXQgdGhlIHNhbWUgdGltZSB0byBzYXZlIHRoZSBzZWNvbmQgY29tcHV0YXRpb24uCglmdW5jdGlvbiBjb21wdXRlUGl4ZWxQb3NpdGlvbkFuZEJveFNpemluZ1JlbGlhYmxlKCkgewoJCWRpdi5zdHlsZS5jc3NUZXh0ID0KCQkJLy8gU3VwcG9ydDogRmlyZWZveDwyOSwgQW5kcm9pZCAyLjMKCQkJLy8gVmVuZG9yLXByZWZpeCBib3gtc2l6aW5nCgkJCSItd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDstbW96LWJveC1zaXppbmc6Ym9yZGVyLWJveDsiICsKCQkJImJveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmJsb2NrO21hcmdpbi10b3A6MSU7dG9wOjElOyIgKwoJCQkiYm9yZGVyOjFweDtwYWRkaW5nOjFweDt3aWR0aDo0cHg7cG9zaXRpb246YWJzb2x1dGUiOwoJCWRpdi5pbm5lckhUTUwgPSAiIjsKCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBjb250YWluZXIgKTsKCgkJdmFyIGRpdlN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGRpdiwgbnVsbCApOwoJCXBpeGVsUG9zaXRpb25WYWwgPSBkaXZTdHlsZS50b3AgIT09ICIxJSI7CgkJYm94U2l6aW5nUmVsaWFibGVWYWwgPSBkaXZTdHlsZS53aWR0aCA9PT0gIjRweCI7CgoJCWRvY0VsZW0ucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoJfQoKCS8vIFN1cHBvcnQ6IG5vZGUuanMganNkb20KCS8vIERvbid0IGFzc3VtZSB0aGF0IGdldENvbXB1dGVkU3R5bGUgaXMgYSBwcm9wZXJ0eSBvZiB0aGUgZ2xvYmFsIG9iamVjdAoJaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsKCQlqUXVlcnkuZXh0ZW5kKCBzdXBwb3J0LCB7CgkJCXBpeGVsUG9zaXRpb246IGZ1bmN0aW9uKCkgewoKCQkJCS8vIFRoaXMgdGVzdCBpcyBleGVjdXRlZCBvbmx5IG9uY2UgYnV0IHdlIHN0aWxsIGRvIG1lbW9pemluZwoJCQkJLy8gc2luY2Ugd2UgY2FuIHVzZSB0aGUgYm94U2l6aW5nUmVsaWFibGUgcHJlLWNvbXB1dGluZy4KCQkJCS8vIE5vIG5lZWQgdG8gY2hlY2sgaWYgdGhlIHRlc3Qgd2FzIGFscmVhZHkgcGVyZm9ybWVkLCB0aG91Z2guCgkJCQljb21wdXRlUGl4ZWxQb3NpdGlvbkFuZEJveFNpemluZ1JlbGlhYmxlKCk7CgkJCQlyZXR1cm4gcGl4ZWxQb3NpdGlvblZhbDsKCQkJfSwKCQkJYm94U2l6aW5nUmVsaWFibGU6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBib3hTaXppbmdSZWxpYWJsZVZhbCA9PSBudWxsICkgewoJCQkJCWNvbXB1dGVQaXhlbFBvc2l0aW9uQW5kQm94U2l6aW5nUmVsaWFibGUoKTsKCQkJCX0KCQkJCXJldHVybiBib3hTaXppbmdSZWxpYWJsZVZhbDsKCQkJfSwKCQkJcmVsaWFibGVNYXJnaW5SaWdodDogZnVuY3Rpb24oKSB7CgoJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkJCS8vIENoZWNrIGlmIGRpdiB3aXRoIGV4cGxpY2l0IHdpZHRoIGFuZCBubyBtYXJnaW4tcmlnaHQgaW5jb3JyZWN0bHkKCQkJCS8vIGdldHMgY29tcHV0ZWQgbWFyZ2luLXJpZ2h0IGJhc2VkIG9uIHdpZHRoIG9mIGNvbnRhaW5lci4gKCMzMzMzKQoJCQkJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CgkJCQkvLyBUaGlzIHN1cHBvcnQgZnVuY3Rpb24gaXMgb25seSBleGVjdXRlZCBvbmNlIHNvIG5vIG1lbW9pemluZyBpcyBuZWVkZWQuCgkJCQl2YXIgcmV0LAoJCQkJCW1hcmdpbkRpdiA9IGRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKSApOwoKCQkJCS8vIFJlc2V0IENTUzogYm94LXNpemluZzsgZGlzcGxheTsgbWFyZ2luOyBib3JkZXI7IHBhZGRpbmcKCQkJCW1hcmdpbkRpdi5zdHlsZS5jc3NUZXh0ID0gZGl2LnN0eWxlLmNzc1RleHQgPQoJCQkJCS8vIFN1cHBvcnQ6IEZpcmVmb3g8MjksIEFuZHJvaWQgMi4zCgkJCQkJLy8gVmVuZG9yLXByZWZpeCBib3gtc2l6aW5nCgkJCQkJIi13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDstbW96LWJveC1zaXppbmc6Y29udGVudC1ib3g7IiArCgkJCQkJImJveC1zaXppbmc6Y29udGVudC1ib3g7ZGlzcGxheTpibG9jazttYXJnaW46MDtib3JkZXI6MDtwYWRkaW5nOjAiOwoJCQkJbWFyZ2luRGl2LnN0eWxlLm1hcmdpblJpZ2h0ID0gbWFyZ2luRGl2LnN0eWxlLndpZHRoID0gIjAiOwoJCQkJZGl2LnN0eWxlLndpZHRoID0gIjFweCI7CgkJCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBjb250YWluZXIgKTsKCgkJCQlyZXQgPSAhcGFyc2VGbG9hdCggd2luZG93LmdldENvbXB1dGVkU3R5bGUoIG1hcmdpbkRpdiwgbnVsbCApLm1hcmdpblJpZ2h0ICk7CgoJCQkJZG9jRWxlbS5yZW1vdmVDaGlsZCggY29udGFpbmVyICk7CgkJCQlkaXYucmVtb3ZlQ2hpbGQoIG1hcmdpbkRpdiApOwoKCQkJCXJldHVybiByZXQ7CgkJCX0KCQl9KTsKCX0KfSkoKTsKCgovLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zLgpqUXVlcnkuc3dhcCA9IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBjYWxsYmFjaywgYXJncyApIHsKCXZhciByZXQsIG5hbWUsCgkJb2xkID0ge307CgoJLy8gUmVtZW1iZXIgdGhlIG9sZCB2YWx1ZXMsIGFuZCBpbnNlcnQgdGhlIG5ldyBvbmVzCglmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJb2xkWyBuYW1lIF0gPSBlbGVtLnN0eWxlWyBuYW1lIF07CgkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb3B0aW9uc1sgbmFtZSBdOwoJfQoKCXJldCA9IGNhbGxiYWNrLmFwcGx5KCBlbGVtLCBhcmdzIHx8IFtdICk7CgoJLy8gUmV2ZXJ0IHRoZSBvbGQgdmFsdWVzCglmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb2xkWyBuYW1lIF07Cgl9CgoJcmV0dXJuIHJldDsKfTsKCgp2YXIKCS8vIFN3YXBwYWJsZSBpZiBkaXNwbGF5IGlzIG5vbmUgb3Igc3RhcnRzIHdpdGggdGFibGUgZXhjZXB0ICJ0YWJsZSIsICJ0YWJsZS1jZWxsIiwgb3IgInRhYmxlLWNhcHRpb24iCgkvLyBTZWUgaGVyZSBmb3IgZGlzcGxheSB2YWx1ZXM6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvQ1NTL2Rpc3BsYXkKCXJkaXNwbGF5c3dhcCA9IC9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLywKCXJudW1zcGxpdCA9IG5ldyBSZWdFeHAoICJeKCIgKyBwbnVtICsgIikoLiopJCIsICJpIiApLAoJcnJlbE51bSA9IG5ldyBSZWdFeHAoICJeKFsrLV0pPSgiICsgcG51bSArICIpIiwgImkiICksCgoJY3NzU2hvdyA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sCgljc3NOb3JtYWxUcmFuc2Zvcm0gPSB7CgkJbGV0dGVyU3BhY2luZzogIjAiLAoJCWZvbnRXZWlnaHQ6ICI0MDAiCgl9LAoKCWNzc1ByZWZpeGVzID0gWyAiV2Via2l0IiwgIk8iLCAiTW96IiwgIm1zIiBdOwoKLy8gUmV0dXJuIGEgY3NzIHByb3BlcnR5IG1hcHBlZCB0byBhIHBvdGVudGlhbGx5IHZlbmRvciBwcmVmaXhlZCBwcm9wZXJ0eQpmdW5jdGlvbiB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG5hbWUgKSB7CgoJLy8gU2hvcnRjdXQgZm9yIG5hbWVzIHRoYXQgYXJlIG5vdCB2ZW5kb3IgcHJlZml4ZWQKCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQlyZXR1cm4gbmFtZTsKCX0KCgkvLyBDaGVjayBmb3IgdmVuZG9yIHByZWZpeGVkIG5hbWVzCgl2YXIgY2FwTmFtZSA9IG5hbWVbMF0udG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSksCgkJb3JpZ05hbWUgPSBuYW1lLAoJCWkgPSBjc3NQcmVmaXhlcy5sZW5ndGg7CgoJd2hpbGUgKCBpLS0gKSB7CgkJbmFtZSA9IGNzc1ByZWZpeGVzWyBpIF0gKyBjYXBOYW1lOwoJCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoJfQoKCXJldHVybiBvcmlnTmFtZTsKfQoKZnVuY3Rpb24gc2V0UG9zaXRpdmVOdW1iZXIoIGVsZW0sIHZhbHVlLCBzdWJ0cmFjdCApIHsKCXZhciBtYXRjaGVzID0gcm51bXNwbGl0LmV4ZWMoIHZhbHVlICk7CglyZXR1cm4gbWF0Y2hlcyA/CgkJLy8gR3VhcmQgYWdhaW5zdCB1bmRlZmluZWQgInN1YnRyYWN0IiwgZS5nLiwgd2hlbiB1c2VkIGFzIGluIGNzc0hvb2tzCgkJTWF0aC5tYXgoIDAsIG1hdGNoZXNbIDEgXSAtICggc3VidHJhY3QgfHwgMCApICkgKyAoIG1hdGNoZXNbIDIgXSB8fCAicHgiICkgOgoJCXZhbHVlOwp9CgpmdW5jdGlvbiBhdWdtZW50V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEsIGlzQm9yZGVyQm94LCBzdHlsZXMgKSB7Cgl2YXIgaSA9IGV4dHJhID09PSAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSA/CgkJLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHRoZSByaWdodCBtZWFzdXJlbWVudCwgYXZvaWQgYXVnbWVudGF0aW9uCgkJNCA6CgkJLy8gT3RoZXJ3aXNlIGluaXRpYWxpemUgZm9yIGhvcml6b250YWwgb3IgdmVydGljYWwgcHJvcGVydGllcwoJCW5hbWUgPT09ICJ3aWR0aCIgPyAxIDogMCwKCgkJdmFsID0gMDsKCglmb3IgKCA7IGkgPCA0OyBpICs9IDIgKSB7CgkJLy8gQm90aCBib3ggbW9kZWxzIGV4Y2x1ZGUgbWFyZ2luLCBzbyBhZGQgaXQgaWYgd2Ugd2FudCBpdAoJCWlmICggZXh0cmEgPT09ICJtYXJnaW4iICkgewoJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgZXh0cmEgKyBjc3NFeHBhbmRbIGkgXSwgdHJ1ZSwgc3R5bGVzICk7CgkJfQoKCQlpZiAoIGlzQm9yZGVyQm94ICkgewoJCQkvLyBib3JkZXItYm94IGluY2x1ZGVzIHBhZGRpbmcsIHNvIHJlbW92ZSBpdCBpZiB3ZSB3YW50IGNvbnRlbnQKCQkJaWYgKCBleHRyYSA9PT0gImNvbnRlbnQiICkgewoJCQkJdmFsIC09IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCQkJfQoKCQkJLy8gQXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgYm9yZGVyIG5vciBtYXJnaW4sIHNvIHJlbW92ZSBib3JkZXIKCQkJaWYgKCBleHRyYSAhPT0gIm1hcmdpbiIgKSB7CgkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQl9CgkJfSBlbHNlIHsKCQkJLy8gQXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCwgc28gYWRkIHBhZGRpbmcKCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCgkJCS8vIEF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGNvbnRlbnQgbm9yIHBhZGRpbmcsIHNvIGFkZCBib3JkZXIKCQkJaWYgKCBleHRyYSAhPT0gInBhZGRpbmciICkgewoJCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJib3JkZXIiICsgY3NzRXhwYW5kWyBpIF0gKyAiV2lkdGgiLCB0cnVlLCBzdHlsZXMgKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdmFsOwp9CgpmdW5jdGlvbiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApIHsKCgkvLyBTdGFydCB3aXRoIG9mZnNldCBwcm9wZXJ0eSwgd2hpY2ggaXMgZXF1aXZhbGVudCB0byB0aGUgYm9yZGVyLWJveCB2YWx1ZQoJdmFyIHZhbHVlSXNCb3JkZXJCb3ggPSB0cnVlLAoJCXZhbCA9IG5hbWUgPT09ICJ3aWR0aCIgPyBlbGVtLm9mZnNldFdpZHRoIDogZWxlbS5vZmZzZXRIZWlnaHQsCgkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICksCgkJaXNCb3JkZXJCb3ggPSBqUXVlcnkuY3NzKCBlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcyApID09PSAiYm9yZGVyLWJveCI7CgoJLy8gU29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKCS8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnkKCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCWlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkJdmFsID0gZWxlbS5zdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gQ29tcHV0ZWQgdW5pdCBpcyBub3QgcGl4ZWxzLiBTdG9wIGhlcmUgYW5kIHJldHVybi4KCQlpZiAoIHJudW1ub25weC50ZXN0KHZhbCkgKSB7CgkJCXJldHVybiB2YWw7CgkJfQoKCQkvLyBDaGVjayBmb3Igc3R5bGUgaW4gY2FzZSBhIGJyb3dzZXIgd2hpY2ggcmV0dXJucyB1bnJlbGlhYmxlIHZhbHVlcwoJCS8vIGZvciBnZXRDb21wdXRlZFN0eWxlIHNpbGVudGx5IGZhbGxzIGJhY2sgdG8gdGhlIHJlbGlhYmxlIGVsZW0uc3R5bGUKCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYKCQkJKCBzdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlKCkgfHwgdmFsID09PSBlbGVtLnN0eWxlWyBuYW1lIF0gKTsKCgkJLy8gTm9ybWFsaXplICIiLCBhdXRvLCBhbmQgcHJlcGFyZSBmb3IgZXh0cmEKCQl2YWwgPSBwYXJzZUZsb2F0KCB2YWwgKSB8fCAwOwoJfQoKCS8vIFVzZSB0aGUgYWN0aXZlIGJveC1zaXppbmcgbW9kZWwgdG8gYWRkL3N1YnRyYWN0IGlycmVsZXZhbnQgc3R5bGVzCglyZXR1cm4gKCB2YWwgKwoJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQllbGVtLAoJCQluYW1lLAoJCQlleHRyYSB8fCAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSwKCQkJdmFsdWVJc0JvcmRlckJveCwKCQkJc3R5bGVzCgkJKQoJKSArICJweCI7Cn0KCmZ1bmN0aW9uIHNob3dIaWRlKCBlbGVtZW50cywgc2hvdyApIHsKCXZhciBkaXNwbGF5LCBlbGVtLCBoaWRkZW4sCgkJdmFsdWVzID0gW10sCgkJaW5kZXggPSAwLAoJCWxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aDsKCglmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCWVsZW0gPSBlbGVtZW50c1sgaW5kZXggXTsKCQlpZiAoICFlbGVtLnN0eWxlICkgewoJCQljb250aW51ZTsKCQl9CgoJCXZhbHVlc1sgaW5kZXggXSA9IGRhdGFfcHJpdi5nZXQoIGVsZW0sICJvbGRkaXNwbGF5IiApOwoJCWRpc3BsYXkgPSBlbGVtLnN0eWxlLmRpc3BsYXk7CgkJaWYgKCBzaG93ICkgewoJCQkvLyBSZXNldCB0aGUgaW5saW5lIGRpc3BsYXkgb2YgdGhpcyBlbGVtZW50IHRvIGxlYXJuIGlmIGl0IGlzCgkJCS8vIGJlaW5nIGhpZGRlbiBieSBjYXNjYWRlZCBydWxlcyBvciBub3QKCQkJaWYgKCAhdmFsdWVzWyBpbmRleCBdICYmIGRpc3BsYXkgPT09ICJub25lIiApIHsKCQkJCWVsZW0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCQl9CgoJCQkvLyBTZXQgZWxlbWVudHMgd2hpY2ggaGF2ZSBiZWVuIG92ZXJyaWRkZW4gd2l0aCBkaXNwbGF5OiBub25lCgkJCS8vIGluIGEgc3R5bGVzaGVldCB0byB3aGF0ZXZlciB0aGUgZGVmYXVsdCBicm93c2VyIHN0eWxlIGlzCgkJCS8vIGZvciBzdWNoIGFuIGVsZW1lbnQKCQkJaWYgKCBlbGVtLnN0eWxlLmRpc3BsYXkgPT09ICIiICYmIGlzSGlkZGVuKCBlbGVtICkgKSB7CgkJCQl2YWx1ZXNbIGluZGV4IF0gPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCAib2xkZGlzcGxheSIsIGRlZmF1bHREaXNwbGF5KGVsZW0ubm9kZU5hbWUpICk7CgkJCX0KCQl9IGVsc2UgewoJCQloaWRkZW4gPSBpc0hpZGRlbiggZWxlbSApOwoKCQkJaWYgKCBkaXNwbGF5ICE9PSAibm9uZSIgfHwgIWhpZGRlbiApIHsKCQkJCWRhdGFfcHJpdi5zZXQoIGVsZW0sICJvbGRkaXNwbGF5IiwgaGlkZGVuID8gZGlzcGxheSA6IGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApICk7CgkJCX0KCQl9Cgl9CgoJLy8gU2V0IHRoZSBkaXNwbGF5IG9mIG1vc3Qgb2YgdGhlIGVsZW1lbnRzIGluIGEgc2Vjb25kIGxvb3AKCS8vIHRvIGF2b2lkIHRoZSBjb25zdGFudCByZWZsb3cKCWZvciAoIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCWlmICggIWVsZW0uc3R5bGUgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoICFzaG93IHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIm5vbmUiIHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgKSB7CgkJCWVsZW0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyB2YWx1ZXNbIGluZGV4IF0gfHwgIiIgOiAibm9uZSI7CgkJfQoJfQoKCXJldHVybiBlbGVtZW50czsKfQoKalF1ZXJ5LmV4dGVuZCh7CgoJLy8gQWRkIGluIHN0eWxlIHByb3BlcnR5IGhvb2tzIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0CgkvLyBiZWhhdmlvciBvZiBnZXR0aW5nIGFuZCBzZXR0aW5nIGEgc3R5bGUgcHJvcGVydHkKCWNzc0hvb2tzOiB7CgkJb3BhY2l0eTogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkJCS8vIFdlIHNob3VsZCBhbHdheXMgZ2V0IGEgbnVtYmVyIGJhY2sgZnJvbSBvcGFjaXR5CgkJCQkJdmFyIHJldCA9IGN1ckNTUyggZWxlbSwgIm9wYWNpdHkiICk7CgkJCQkJcmV0dXJuIHJldCA9PT0gIiIgPyAiMSIgOiByZXQ7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCS8vIERvbid0IGF1dG9tYXRpY2FsbHkgYWRkICJweCIgdG8gdGhlc2UgcG9zc2libHktdW5pdGxlc3MgcHJvcGVydGllcwoJY3NzTnVtYmVyOiB7CgkJImNvbHVtbkNvdW50IjogdHJ1ZSwKCQkiZmlsbE9wYWNpdHkiOiB0cnVlLAoJCSJmbGV4R3JvdyI6IHRydWUsCgkJImZsZXhTaHJpbmsiOiB0cnVlLAoJCSJmb250V2VpZ2h0IjogdHJ1ZSwKCQkibGluZUhlaWdodCI6IHRydWUsCgkJIm9wYWNpdHkiOiB0cnVlLAoJCSJvcmRlciI6IHRydWUsCgkJIm9ycGhhbnMiOiB0cnVlLAoJCSJ3aWRvd3MiOiB0cnVlLAoJCSJ6SW5kZXgiOiB0cnVlLAoJCSJ6b29tIjogdHJ1ZQoJfSwKCgkvLyBBZGQgaW4gcHJvcGVydGllcyB3aG9zZSBuYW1lcyB5b3Ugd2lzaCB0byBmaXggYmVmb3JlCgkvLyBzZXR0aW5nIG9yIGdldHRpbmcgdGhlIHZhbHVlCgljc3NQcm9wczogewoJCSJmbG9hdCI6ICJjc3NGbG9hdCIKCX0sCgoJLy8gR2V0IGFuZCBzZXQgdGhlIHN0eWxlIHByb3BlcnR5IG9uIGEgRE9NIE5vZGUKCXN0eWxlOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUsIGV4dHJhICkgewoKCQkvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoICFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJdmFyIHJldCwgdHlwZSwgaG9va3MsCgkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG9yaWdOYW1lICkgKTsKCgkJLy8gR2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbiwgdGhlbiB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gQ2hlY2sgaWYgd2UncmUgc2V0dGluZyBhIHZhbHVlCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJLy8gQ29udmVydCAiKz0iIG9yICItPSIgdG8gcmVsYXRpdmUgbnVtYmVycyAoIzczNDUpCgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgJiYgKHJldCA9IHJyZWxOdW0uZXhlYyggdmFsdWUgKSkgKSB7CgkJCQl2YWx1ZSA9ICggcmV0WzFdICsgMSApICogcmV0WzJdICsgcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApICk7CgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgbnVsbCBhbmQgTmFOIHZhbHVlcyBhcmVuJ3Qgc2V0ICgjNzExNikKCQkJaWYgKCB2YWx1ZSA9PSBudWxsIHx8IHZhbHVlICE9PSB2YWx1ZSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gSWYgYSBudW1iZXIsIGFkZCAncHgnIHRvIHRoZSAoZXhjZXB0IGZvciBjZXJ0YWluIENTUyBwcm9wZXJ0aWVzKQoJCQlpZiAoIHR5cGUgPT09ICJudW1iZXIiICYmICFqUXVlcnkuY3NzTnVtYmVyWyBvcmlnTmFtZSBdICkgewoJCQkJdmFsdWUgKz0gInB4IjsKCQkJfQoKCQkJLy8gU3VwcG9ydDogSUU5LTExKwoJCQkvLyBiYWNrZ3JvdW5kLSogcHJvcHMgYWZmZWN0IG9yaWdpbmFsIGNsb25lJ3MgdmFsdWVzCgkJCWlmICggIXN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlICYmIHZhbHVlID09PSAiIiAmJiBuYW1lLmluZGV4T2YoICJiYWNrZ3JvdW5kIiApID09PSAwICkgewoJCQkJc3R5bGVbIG5hbWUgXSA9ICJpbmhlcml0IjsKCQkJfQoKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCwgdXNlIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBqdXN0IHNldCB0aGUgc3BlY2lmaWVkIHZhbHVlCgkJCWlmICggIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8ICh2YWx1ZSA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCQlzdHlsZVsgbmFtZSBdID0gdmFsdWU7CgkJCX0KCgkJfSBlbHNlIHsKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIG5vbi1jb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgZmFsc2UsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgoJCQkvLyBPdGhlcndpc2UganVzdCBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHN0eWxlIG9iamVjdAoJCQlyZXR1cm4gc3R5bGVbIG5hbWUgXTsKCQl9Cgl9LAoKCWNzczogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGV4dHJhLCBzdHlsZXMgKSB7CgkJdmFyIHZhbCwgbnVtLCBob29rcywKCQkJb3JpZ05hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICk7CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZQoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggZWxlbS5zdHlsZSwgb3JpZ05hbWUgKSApOwoKCQkvLyBUcnkgcHJlZml4ZWQgbmFtZSBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCBuYW1lCgkJaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSB8fCBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07CgoJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyApIHsKCQkJdmFsID0gaG9va3MuZ2V0KCBlbGVtLCB0cnVlLCBleHRyYSApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlLCBpZiBhIHdheSB0byBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGV4aXN0cywgdXNlIHRoYXQKCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCX0KCgkJLy8gQ29udmVydCAibm9ybWFsIiB0byBjb21wdXRlZCB2YWx1ZQoJCWlmICggdmFsID09PSAibm9ybWFsIiAmJiBuYW1lIGluIGNzc05vcm1hbFRyYW5zZm9ybSApIHsKCQkJdmFsID0gY3NzTm9ybWFsVHJhbnNmb3JtWyBuYW1lIF07CgkJfQoKCQkvLyBNYWtlIG51bWVyaWMgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCQlpZiAoIGV4dHJhID09PSAiIiB8fCBleHRyYSApIHsKCQkJbnVtID0gcGFyc2VGbG9hdCggdmFsICk7CgkJCXJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBqUXVlcnkuaXNOdW1lcmljKCBudW0gKSA/IG51bSB8fCAwIDogdmFsOwoJCX0KCQlyZXR1cm4gdmFsOwoJfQp9KTsKCmpRdWVyeS5lYWNoKFsgImhlaWdodCIsICJ3aWR0aCIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CglqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCwgZXh0cmEgKSB7CgkJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkJLy8gQ2VydGFpbiBlbGVtZW50cyBjYW4gaGF2ZSBkaW1lbnNpb24gaW5mbyBpZiB3ZSBpbnZpc2libHkgc2hvdyB0aGVtCgkJCQkvLyBidXQgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdAoJCQkJcmV0dXJuIHJkaXNwbGF5c3dhcC50ZXN0KCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSApICYmIGVsZW0ub2Zmc2V0V2lkdGggPT09IDAgPwoJCQkJCWpRdWVyeS5zd2FwKCBlbGVtLCBjc3NTaG93LCBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIGdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICk7CgkJCQkJfSkgOgoJCQkJCWdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICk7CgkJCX0KCQl9LAoKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgZXh0cmEgKSB7CgkJCXZhciBzdHlsZXMgPSBleHRyYSAmJiBnZXRTdHlsZXMoIGVsZW0gKTsKCQkJcmV0dXJuIHNldFBvc2l0aXZlTnVtYmVyKCBlbGVtLCB2YWx1ZSwgZXh0cmEgPwoJCQkJYXVnbWVudFdpZHRoT3JIZWlnaHQoCgkJCQkJZWxlbSwKCQkJCQluYW1lLAoJCQkJCWV4dHJhLAoJCQkJCWpRdWVyeS5jc3MoIGVsZW0sICJib3hTaXppbmciLCBmYWxzZSwgc3R5bGVzICkgPT09ICJib3JkZXItYm94IiwKCQkJCQlzdHlsZXMKCQkJCSkgOiAwCgkJCSk7CgkJfQoJfTsKfSk7CgovLyBTdXBwb3J0OiBBbmRyb2lkIDIuMwpqUXVlcnkuY3NzSG9va3MubWFyZ2luUmlnaHQgPSBhZGRHZXRIb29rSWYoIHN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCwKCWZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQlpZiAoIGNvbXB1dGVkICkgewoJCQlyZXR1cm4galF1ZXJ5LnN3YXAoIGVsZW0sIHsgImRpc3BsYXkiOiAiaW5saW5lLWJsb2NrIiB9LAoJCQkJY3VyQ1NTLCBbIGVsZW0sICJtYXJnaW5SaWdodCIgXSApOwoJCX0KCX0KKTsKCi8vIFRoZXNlIGhvb2tzIGFyZSB1c2VkIGJ5IGFuaW1hdGUgdG8gZXhwYW5kIHByb3BlcnRpZXMKalF1ZXJ5LmVhY2goewoJbWFyZ2luOiAiIiwKCXBhZGRpbmc6ICIiLAoJYm9yZGVyOiAiV2lkdGgiCn0sIGZ1bmN0aW9uKCBwcmVmaXgsIHN1ZmZpeCApIHsKCWpRdWVyeS5jc3NIb29rc1sgcHJlZml4ICsgc3VmZml4IF0gPSB7CgkJZXhwYW5kOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciBpID0gMCwKCQkJCWV4cGFuZGVkID0ge30sCgoJCQkJLy8gQXNzdW1lcyBhIHNpbmdsZSBudW1iZXIgaWYgbm90IGEgc3RyaW5nCgkJCQlwYXJ0cyA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgPyB2YWx1ZS5zcGxpdCgiICIpIDogWyB2YWx1ZSBdOwoKCQkJZm9yICggOyBpIDwgNDsgaSsrICkgewoJCQkJZXhwYW5kZWRbIHByZWZpeCArIGNzc0V4cGFuZFsgaSBdICsgc3VmZml4IF0gPQoJCQkJCXBhcnRzWyBpIF0gfHwgcGFydHNbIGkgLSAyIF0gfHwgcGFydHNbIDAgXTsKCQkJfQoKCQkJcmV0dXJuIGV4cGFuZGVkOwoJCX0KCX07CgoJaWYgKCAhcm1hcmdpbi50ZXN0KCBwcmVmaXggKSApIHsKCQlqUXVlcnkuY3NzSG9va3NbIHByZWZpeCArIHN1ZmZpeCBdLnNldCA9IHNldFBvc2l0aXZlTnVtYmVyOwoJfQp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJY3NzOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCQl2YXIgc3R5bGVzLCBsZW4sCgkJCQltYXAgPSB7fSwKCQkJCWkgPSAwOwoKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggbmFtZSApICkgewoJCQkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICk7CgkJCQlsZW4gPSBuYW1lLmxlbmd0aDsKCgkJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCQltYXBbIG5hbWVbIGkgXSBdID0galF1ZXJ5LmNzcyggZWxlbSwgbmFtZVsgaSBdLCBmYWxzZSwgc3R5bGVzICk7CgkJCQl9CgoJCQkJcmV0dXJuIG1hcDsKCQkJfQoKCQkJcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgPwoJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCBuYW1lLCB2YWx1ZSApIDoKCQkJCWpRdWVyeS5jc3MoIGVsZW0sIG5hbWUgKTsKCQl9LCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCglzaG93OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMsIHRydWUgKTsKCX0sCgloaWRlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMgKTsKCX0sCgl0b2dnbGU6IGZ1bmN0aW9uKCBzdGF0ZSApIHsKCQlpZiAoIHR5cGVvZiBzdGF0ZSA9PT0gImJvb2xlYW4iICkgewoJCQlyZXR1cm4gc3RhdGUgPyB0aGlzLnNob3coKSA6IHRoaXMuaGlkZSgpOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJaWYgKCBpc0hpZGRlbiggdGhpcyApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkuc2hvdygpOwoJCQl9IGVsc2UgewoJCQkJalF1ZXJ5KCB0aGlzICkuaGlkZSgpOwoJCQl9CgkJfSk7Cgl9Cn0pOwoKCmZ1bmN0aW9uIFR3ZWVuKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZyApIHsKCXJldHVybiBuZXcgVHdlZW4ucHJvdG90eXBlLmluaXQoIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICk7Cn0KalF1ZXJ5LlR3ZWVuID0gVHdlZW47CgpUd2Vlbi5wcm90b3R5cGUgPSB7Cgljb25zdHJ1Y3RvcjogVHdlZW4sCglpbml0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcsIHVuaXQgKSB7CgkJdGhpcy5lbGVtID0gZWxlbTsKCQl0aGlzLnByb3AgPSBwcm9wOwoJCXRoaXMuZWFzaW5nID0gZWFzaW5nIHx8ICJzd2luZyI7CgkJdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCQl0aGlzLnN0YXJ0ID0gdGhpcy5ub3cgPSB0aGlzLmN1cigpOwoJCXRoaXMuZW5kID0gZW5kOwoJCXRoaXMudW5pdCA9IHVuaXQgfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsKCX0sCgljdXI6IGZ1bmN0aW9uKCkgewoJCXZhciBob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCXJldHVybiBob29rcyAmJiBob29rcy5nZXQgPwoJCQlob29rcy5nZXQoIHRoaXMgKSA6CgkJCVR3ZWVuLnByb3BIb29rcy5fZGVmYXVsdC5nZXQoIHRoaXMgKTsKCX0sCglydW46IGZ1bmN0aW9uKCBwZXJjZW50ICkgewoJCXZhciBlYXNlZCwKCQkJaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbIHRoaXMucHJvcCBdOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5kdXJhdGlvbiApIHsKCQkJdGhpcy5wb3MgPSBlYXNlZCA9IGpRdWVyeS5lYXNpbmdbIHRoaXMuZWFzaW5nIF0oCgkJCQlwZXJjZW50LCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBwZXJjZW50LCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24KCQkJKTsKCQl9IGVsc2UgewoJCQl0aGlzLnBvcyA9IGVhc2VkID0gcGVyY2VudDsKCQl9CgkJdGhpcy5ub3cgPSAoIHRoaXMuZW5kIC0gdGhpcy5zdGFydCApICogZWFzZWQgKyB0aGlzLnN0YXJ0OwoKCQlpZiAoIHRoaXMub3B0aW9ucy5zdGVwICkgewoJCQl0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKCB0aGlzLmVsZW0sIHRoaXMubm93LCB0aGlzICk7CgkJfQoKCQlpZiAoIGhvb2tzICYmIGhvb2tzLnNldCApIHsKCQkJaG9va3Muc2V0KCB0aGlzICk7CgkJfSBlbHNlIHsKCQkJVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LnNldCggdGhpcyApOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0KfTsKClR3ZWVuLnByb3RvdHlwZS5pbml0LnByb3RvdHlwZSA9IFR3ZWVuLnByb3RvdHlwZTsKClR3ZWVuLnByb3BIb29rcyA9IHsKCV9kZWZhdWx0OiB7CgkJZ2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJCXZhciByZXN1bHQ7CgoJCQlpZiAoIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSAhPSBudWxsICYmCgkJCQkoIXR3ZWVuLmVsZW0uc3R5bGUgfHwgdHdlZW4uZWxlbS5zdHlsZVsgdHdlZW4ucHJvcCBdID09IG51bGwpICkgewoJCQkJcmV0dXJuIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXTsKCQkJfQoKCQkJLy8gUGFzc2luZyBhbiBlbXB0eSBzdHJpbmcgYXMgYSAzcmQgcGFyYW1ldGVyIHRvIC5jc3Mgd2lsbCBhdXRvbWF0aWNhbGx5CgkJCS8vIGF0dGVtcHQgYSBwYXJzZUZsb2F0IGFuZCBmYWxsYmFjayB0byBhIHN0cmluZyBpZiB0aGUgcGFyc2UgZmFpbHMuCgkJCS8vIFNpbXBsZSB2YWx1ZXMgc3VjaCBhcyAiMTBweCIgYXJlIHBhcnNlZCB0byBGbG9hdDsKCQkJLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMtaXMuCgkJCXJlc3VsdCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsICIiICk7CgkJCS8vIEVtcHR5IHN0cmluZ3MsIG51bGwsIHVuZGVmaW5lZCBhbmQgImF1dG8iIGFyZSBjb252ZXJ0ZWQgdG8gMC4KCQkJcmV0dXJuICFyZXN1bHQgfHwgcmVzdWx0ID09PSAiYXV0byIgPyAwIDogcmVzdWx0OwoJCX0sCgkJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJCS8vIFVzZSBzdGVwIGhvb2sgZm9yIGJhY2sgY29tcGF0LgoJCQkvLyBVc2UgY3NzSG9vayBpZiBpdHMgdGhlcmUuCgkJCS8vIFVzZSAuc3R5bGUgaWYgYXZhaWxhYmxlIGFuZCB1c2UgcGxhaW4gcHJvcGVydGllcyB3aGVyZSBhdmFpbGFibGUuCgkJCWlmICggalF1ZXJ5LmZ4LnN0ZXBbIHR3ZWVuLnByb3AgXSApIHsKCQkJCWpRdWVyeS5meC5zdGVwWyB0d2Vlbi5wcm9wIF0oIHR3ZWVuICk7CgkJCX0gZWxzZSBpZiAoIHR3ZWVuLmVsZW0uc3R5bGUgJiYgKCB0d2Vlbi5lbGVtLnN0eWxlWyBqUXVlcnkuY3NzUHJvcHNbIHR3ZWVuLnByb3AgXSBdICE9IG51bGwgfHwgalF1ZXJ5LmNzc0hvb2tzWyB0d2Vlbi5wcm9wIF0gKSApIHsKCQkJCWpRdWVyeS5zdHlsZSggdHdlZW4uZWxlbSwgdHdlZW4ucHJvcCwgdHdlZW4ubm93ICsgdHdlZW4udW5pdCApOwoJCQl9IGVsc2UgewoJCQkJdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdID0gdHdlZW4ubm93OwoJCQl9CgkJfQoJfQp9OwoKLy8gU3VwcG9ydDogSUU5Ci8vIFBhbmljIGJhc2VkIGFwcHJvYWNoIHRvIHNldHRpbmcgdGhpbmdzIG9uIGRpc2Nvbm5lY3RlZCBub2RlcwpUd2Vlbi5wcm9wSG9va3Muc2Nyb2xsVG9wID0gVHdlZW4ucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7CglzZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQlpZiAoIHR3ZWVuLmVsZW0ubm9kZVR5cGUgJiYgdHdlZW4uZWxlbS5wYXJlbnROb2RlICkgewoJCQl0d2Vlbi5lbGVtWyB0d2Vlbi5wcm9wIF0gPSB0d2Vlbi5ub3c7CgkJfQoJfQp9OwoKalF1ZXJ5LmVhc2luZyA9IHsKCWxpbmVhcjogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHA7Cgl9LAoJc3dpbmc6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiAwLjUgLSBNYXRoLmNvcyggcCAqIE1hdGguUEkgKSAvIDI7Cgl9Cn07CgpqUXVlcnkuZnggPSBUd2Vlbi5wcm90b3R5cGUuaW5pdDsKCi8vIEJhY2sgQ29tcGF0IDwxLjggZXh0ZW5zaW9uIHBvaW50CmpRdWVyeS5meC5zdGVwID0ge307CgoKCgp2YXIKCWZ4Tm93LCB0aW1lcklkLAoJcmZ4dHlwZXMgPSAvXig/OnRvZ2dsZXxzaG93fGhpZGUpJC8sCglyZnhudW0gPSBuZXcgUmVnRXhwKCAiXig/OihbKy1dKT18KSgiICsgcG51bSArICIpKFthLXolXSopJCIsICJpIiApLAoJcnJ1biA9IC9xdWV1ZUhvb2tzJC8sCglhbmltYXRpb25QcmVmaWx0ZXJzID0gWyBkZWZhdWx0UHJlZmlsdGVyIF0sCgl0d2VlbmVycyA9IHsKCQkiKiI6IFsgZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgewoJCQl2YXIgdHdlZW4gPSB0aGlzLmNyZWF0ZVR3ZWVuKCBwcm9wLCB2YWx1ZSApLAoJCQkJdGFyZ2V0ID0gdHdlZW4uY3VyKCksCgkJCQlwYXJ0cyA9IHJmeG51bS5leGVjKCB2YWx1ZSApLAoJCQkJdW5pdCA9IHBhcnRzICYmIHBhcnRzWyAzIF0gfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKSwKCgkJCQkvLyBTdGFydGluZyB2YWx1ZSBjb21wdXRhdGlvbiBpcyByZXF1aXJlZCBmb3IgcG90ZW50aWFsIHVuaXQgbWlzbWF0Y2hlcwoJCQkJc3RhcnQgPSAoIGpRdWVyeS5jc3NOdW1iZXJbIHByb3AgXSB8fCB1bml0ICE9PSAicHgiICYmICt0YXJnZXQgKSAmJgoJCQkJCXJmeG51bS5leGVjKCBqUXVlcnkuY3NzKCB0d2Vlbi5lbGVtLCBwcm9wICkgKSwKCQkJCXNjYWxlID0gMSwKCQkJCW1heEl0ZXJhdGlvbnMgPSAyMDsKCgkJCWlmICggc3RhcnQgJiYgc3RhcnRbIDMgXSAhPT0gdW5pdCApIHsKCQkJCS8vIFRydXN0IHVuaXRzIHJlcG9ydGVkIGJ5IGpRdWVyeS5jc3MKCQkJCXVuaXQgPSB1bml0IHx8IHN0YXJ0WyAzIF07CgoJCQkJLy8gTWFrZSBzdXJlIHdlIHVwZGF0ZSB0aGUgdHdlZW4gcHJvcGVydGllcyBsYXRlciBvbgoJCQkJcGFydHMgPSBwYXJ0cyB8fCBbXTsKCgkJCQkvLyBJdGVyYXRpdmVseSBhcHByb3hpbWF0ZSBmcm9tIGEgbm9uemVybyBzdGFydGluZyBwb2ludAoJCQkJc3RhcnQgPSArdGFyZ2V0IHx8IDE7CgoJCQkJZG8gewoJCQkJCS8vIElmIHByZXZpb3VzIGl0ZXJhdGlvbiB6ZXJvZWQgb3V0LCBkb3VibGUgdW50aWwgd2UgZ2V0ICpzb21ldGhpbmcqLgoJCQkJCS8vIFVzZSBzdHJpbmcgZm9yIGRvdWJsaW5nIHNvIHdlIGRvbid0IGFjY2lkZW50YWxseSBzZWUgc2NhbGUgYXMgdW5jaGFuZ2VkIGJlbG93CgkJCQkJc2NhbGUgPSBzY2FsZSB8fCAiLjUiOwoKCQkJCQkvLyBBZGp1c3QgYW5kIGFwcGx5CgkJCQkJc3RhcnQgPSBzdGFydCAvIHNjYWxlOwoJCQkJCWpRdWVyeS5zdHlsZSggdHdlZW4uZWxlbSwgcHJvcCwgc3RhcnQgKyB1bml0ICk7CgoJCQkJLy8gVXBkYXRlIHNjYWxlLCB0b2xlcmF0aW5nIHplcm8gb3IgTmFOIGZyb20gdHdlZW4uY3VyKCksCgkJCQkvLyBicmVhayB0aGUgbG9vcCBpZiBzY2FsZSBpcyB1bmNoYW5nZWQgb3IgcGVyZmVjdCwgb3IgaWYgd2UndmUganVzdCBoYWQgZW5vdWdoCgkJCQl9IHdoaWxlICggc2NhbGUgIT09IChzY2FsZSA9IHR3ZWVuLmN1cigpIC8gdGFyZ2V0KSAmJiBzY2FsZSAhPT0gMSAmJiAtLW1heEl0ZXJhdGlvbnMgKTsKCQkJfQoKCQkJLy8gVXBkYXRlIHR3ZWVuIHByb3BlcnRpZXMKCQkJaWYgKCBwYXJ0cyApIHsKCQkJCXN0YXJ0ID0gdHdlZW4uc3RhcnQgPSArc3RhcnQgfHwgK3RhcmdldCB8fCAwOwoJCQkJdHdlZW4udW5pdCA9IHVuaXQ7CgkJCQkvLyBJZiBhICs9Ly09IHRva2VuIHdhcyBwcm92aWRlZCwgd2UncmUgZG9pbmcgYSByZWxhdGl2ZSBhbmltYXRpb24KCQkJCXR3ZWVuLmVuZCA9IHBhcnRzWyAxIF0gPwoJCQkJCXN0YXJ0ICsgKCBwYXJ0c1sgMSBdICsgMSApICogcGFydHNbIDIgXSA6CgkJCQkJK3BhcnRzWyAyIF07CgkJCX0KCgkJCXJldHVybiB0d2VlbjsKCQl9IF0KCX07CgovLyBBbmltYXRpb25zIGNyZWF0ZWQgc3luY2hyb25vdXNseSB3aWxsIHJ1biBzeW5jaHJvbm91c2x5CmZ1bmN0aW9uIGNyZWF0ZUZ4Tm93KCkgewoJc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQlmeE5vdyA9IHVuZGVmaW5lZDsKCX0pOwoJcmV0dXJuICggZnhOb3cgPSBqUXVlcnkubm93KCkgKTsKfQoKLy8gR2VuZXJhdGUgcGFyYW1ldGVycyB0byBjcmVhdGUgYSBzdGFuZGFyZCBhbmltYXRpb24KZnVuY3Rpb24gZ2VuRngoIHR5cGUsIGluY2x1ZGVXaWR0aCApIHsKCXZhciB3aGljaCwKCQlpID0gMCwKCQlhdHRycyA9IHsgaGVpZ2h0OiB0eXBlIH07CgoJLy8gSWYgd2UgaW5jbHVkZSB3aWR0aCwgc3RlcCB2YWx1ZSBpcyAxIHRvIGRvIGFsbCBjc3NFeHBhbmQgdmFsdWVzLAoJLy8gb3RoZXJ3aXNlIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKCWluY2x1ZGVXaWR0aCA9IGluY2x1ZGVXaWR0aCA/IDEgOiAwOwoJZm9yICggOyBpIDwgNCA7IGkgKz0gMiAtIGluY2x1ZGVXaWR0aCApIHsKCQl3aGljaCA9IGNzc0V4cGFuZFsgaSBdOwoJCWF0dHJzWyAibWFyZ2luIiArIHdoaWNoIF0gPSBhdHRyc1sgInBhZGRpbmciICsgd2hpY2ggXSA9IHR5cGU7Cgl9CgoJaWYgKCBpbmNsdWRlV2lkdGggKSB7CgkJYXR0cnMub3BhY2l0eSA9IGF0dHJzLndpZHRoID0gdHlwZTsKCX0KCglyZXR1cm4gYXR0cnM7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVR3ZWVuKCB2YWx1ZSwgcHJvcCwgYW5pbWF0aW9uICkgewoJdmFyIHR3ZWVuLAoJCWNvbGxlY3Rpb24gPSAoIHR3ZWVuZXJzWyBwcm9wIF0gfHwgW10gKS5jb25jYXQoIHR3ZWVuZXJzWyAiKiIgXSApLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKCWZvciAoIDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJaWYgKCAodHdlZW4gPSBjb2xsZWN0aW9uWyBpbmRleCBdLmNhbGwoIGFuaW1hdGlvbiwgcHJvcCwgdmFsdWUgKSkgKSB7CgoJCQkvLyBXZSdyZSBkb25lIHdpdGggdGhpcyBwcm9wZXJ0eQoJCQlyZXR1cm4gdHdlZW47CgkJfQoJfQp9CgpmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCS8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KCXZhciBwcm9wLCB2YWx1ZSwgdG9nZ2xlLCB0d2VlbiwgaG9va3MsIG9sZGZpcmUsIGRpc3BsYXksIGNoZWNrRGlzcGxheSwKCQlhbmltID0gdGhpcywKCQlvcmlnID0ge30sCgkJc3R5bGUgPSBlbGVtLnN0eWxlLAoJCWhpZGRlbiA9IGVsZW0ubm9kZVR5cGUgJiYgaXNIaWRkZW4oIGVsZW0gKSwKCQlkYXRhU2hvdyA9IGRhdGFfcHJpdi5nZXQoIGVsZW0sICJmeHNob3ciICk7CgoJLy8gSGFuZGxlIHF1ZXVlOiBmYWxzZSBwcm9taXNlcwoJaWYgKCAhb3B0cy5xdWV1ZSApIHsKCQlob29rcyA9IGpRdWVyeS5fcXVldWVIb29rcyggZWxlbSwgImZ4IiApOwoJCWlmICggaG9va3MudW5xdWV1ZWQgPT0gbnVsbCApIHsKCQkJaG9va3MudW5xdWV1ZWQgPSAwOwoJCQlvbGRmaXJlID0gaG9va3MuZW1wdHkuZmlyZTsKCQkJaG9va3MuZW1wdHkuZmlyZSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAhaG9va3MudW5xdWV1ZWQgKSB7CgkJCQkJb2xkZmlyZSgpOwoJCQkJfQoJCQl9OwoJCX0KCQlob29rcy51bnF1ZXVlZCsrOwoKCQlhbmltLmFsd2F5cyhmdW5jdGlvbigpIHsKCQkJLy8gRW5zdXJlIHRoZSBjb21wbGV0ZSBoYW5kbGVyIGlzIGNhbGxlZCBiZWZvcmUgdGhpcyBjb21wbGV0ZXMKCQkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCQlob29rcy51bnF1ZXVlZC0tOwoJCQkJaWYgKCAhalF1ZXJ5LnF1ZXVlKCBlbGVtLCAiZngiICkubGVuZ3RoICkgewoJCQkJCWhvb2tzLmVtcHR5LmZpcmUoKTsKCQkJCX0KCQkJfSk7CgkJfSk7Cgl9CgoJLy8gSGVpZ2h0L3dpZHRoIG92ZXJmbG93IHBhc3MKCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoICJoZWlnaHQiIGluIHByb3BzIHx8ICJ3aWR0aCIgaW4gcHJvcHMgKSApIHsKCQkvLyBNYWtlIHN1cmUgdGhhdCBub3RoaW5nIHNuZWFrcyBvdXQKCQkvLyBSZWNvcmQgYWxsIDMgb3ZlcmZsb3cgYXR0cmlidXRlcyBiZWNhdXNlIElFOS0xMCBkbyBub3QKCQkvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmQKCQkvLyBvdmVyZmxvd1kgYXJlIHNldCB0byB0aGUgc2FtZSB2YWx1ZQoJCW9wdHMub3ZlcmZsb3cgPSBbIHN0eWxlLm92ZXJmbG93LCBzdHlsZS5vdmVyZmxvd1gsIHN0eWxlLm92ZXJmbG93WSBdOwoKCQkvLyBTZXQgZGlzcGxheSBwcm9wZXJ0eSB0byBpbmxpbmUtYmxvY2sgZm9yIGhlaWdodC93aWR0aAoJCS8vIGFuaW1hdGlvbnMgb24gaW5saW5lIGVsZW1lbnRzIHRoYXQgYXJlIGhhdmluZyB3aWR0aC9oZWlnaHQgYW5pbWF0ZWQKCQlkaXNwbGF5ID0galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICk7CgoJCS8vIFRlc3QgZGVmYXVsdCBkaXNwbGF5IGlmIGRpc3BsYXkgaXMgY3VycmVudGx5ICJub25lIgoJCWNoZWNrRGlzcGxheSA9IGRpc3BsYXkgPT09ICJub25lIiA/CgkJCWRhdGFfcHJpdi5nZXQoIGVsZW0sICJvbGRkaXNwbGF5IiApIHx8IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgOiBkaXNwbGF5OwoKCQlpZiAoIGNoZWNrRGlzcGxheSA9PT0gImlubGluZSIgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgkJCXN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQl9Cgl9CgoJaWYgKCBvcHRzLm92ZXJmbG93ICkgewoJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCXN0eWxlLm92ZXJmbG93ID0gb3B0cy5vdmVyZmxvd1sgMCBdOwoJCQlzdHlsZS5vdmVyZmxvd1ggPSBvcHRzLm92ZXJmbG93WyAxIF07CgkJCXN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbIDIgXTsKCQl9KTsKCX0KCgkvLyBzaG93L2hpZGUgcGFzcwoJZm9yICggcHJvcCBpbiBwcm9wcyApIHsKCQl2YWx1ZSA9IHByb3BzWyBwcm9wIF07CgkJaWYgKCByZnh0eXBlcy5leGVjKCB2YWx1ZSApICkgewoJCQlkZWxldGUgcHJvcHNbIHByb3AgXTsKCQkJdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCQkJaWYgKCB2YWx1ZSA9PT0gKCBoaWRkZW4gPyAiaGlkZSIgOiAic2hvdyIgKSApIHsKCgkJCQkvLyBJZiB0aGVyZSBpcyBkYXRhU2hvdyBsZWZ0IG92ZXIgZnJvbSBhIHN0b3BwZWQgaGlkZSBvciBzaG93IGFuZCB3ZSBhcmUgZ29pbmcgdG8gcHJvY2VlZCB3aXRoIHNob3csIHdlIHNob3VsZCBwcmV0ZW5kIHRvIGJlIGhpZGRlbgoJCQkJaWYgKCB2YWx1ZSA9PT0gInNob3ciICYmIGRhdGFTaG93ICYmIGRhdGFTaG93WyBwcm9wIF0gIT09IHVuZGVmaW5lZCApIHsKCQkJCQloaWRkZW4gPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCQkJfQoJCQlvcmlnWyBwcm9wIF0gPSBkYXRhU2hvdyAmJiBkYXRhU2hvd1sgcHJvcCBdIHx8IGpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCApOwoKCQkvLyBBbnkgbm9uLWZ4IHZhbHVlIHN0b3BzIHVzIGZyb20gcmVzdG9yaW5nIHRoZSBvcmlnaW5hbCBkaXNwbGF5IHZhbHVlCgkJfSBlbHNlIHsKCQkJZGlzcGxheSA9IHVuZGVmaW5lZDsKCQl9Cgl9CgoJaWYgKCAhalF1ZXJ5LmlzRW1wdHlPYmplY3QoIG9yaWcgKSApIHsKCQlpZiAoIGRhdGFTaG93ICkgewoJCQlpZiAoICJoaWRkZW4iIGluIGRhdGFTaG93ICkgewoJCQkJaGlkZGVuID0gZGF0YVNob3cuaGlkZGVuOwoJCQl9CgkJfSBlbHNlIHsKCQkJZGF0YVNob3cgPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCAiZnhzaG93Iiwge30gKTsKCQl9CgoJCS8vIFN0b3JlIHN0YXRlIGlmIGl0cyB0b2dnbGUgLSBlbmFibGVzIC5zdG9wKCkudG9nZ2xlKCkgdG8gInJldmVyc2UiCgkJaWYgKCB0b2dnbGUgKSB7CgkJCWRhdGFTaG93LmhpZGRlbiA9ICFoaWRkZW47CgkJfQoJCWlmICggaGlkZGVuICkgewoJCQlqUXVlcnkoIGVsZW0gKS5zaG93KCk7CgkJfSBlbHNlIHsKCQkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQl9KTsKCQl9CgkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQl2YXIgcHJvcDsKCgkJCWRhdGFfcHJpdi5yZW1vdmUoIGVsZW0sICJmeHNob3ciICk7CgkJCWZvciAoIHByb3AgaW4gb3JpZyApIHsKCQkJCWpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCwgb3JpZ1sgcHJvcCBdICk7CgkJCX0KCQl9KTsKCQlmb3IgKCBwcm9wIGluIG9yaWcgKSB7CgkJCXR3ZWVuID0gY3JlYXRlVHdlZW4oIGhpZGRlbiA/IGRhdGFTaG93WyBwcm9wIF0gOiAwLCBwcm9wLCBhbmltICk7CgoJCQlpZiAoICEoIHByb3AgaW4gZGF0YVNob3cgKSApIHsKCQkJCWRhdGFTaG93WyBwcm9wIF0gPSB0d2Vlbi5zdGFydDsKCQkJCWlmICggaGlkZGVuICkgewoJCQkJCXR3ZWVuLmVuZCA9IHR3ZWVuLnN0YXJ0OwoJCQkJCXR3ZWVuLnN0YXJ0ID0gcHJvcCA9PT0gIndpZHRoIiB8fCBwcm9wID09PSAiaGVpZ2h0IiA/IDEgOiAwOwoJCQkJfQoJCQl9CgkJfQoKCS8vIElmIHRoaXMgaXMgYSBub29wIGxpa2UgLmhpZGUoKS5oaWRlKCksIHJlc3RvcmUgYW4gb3ZlcndyaXR0ZW4gZGlzcGxheSB2YWx1ZQoJfSBlbHNlIGlmICggKGRpc3BsYXkgPT09ICJub25lIiA/IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgOiBkaXNwbGF5KSA9PT0gImlubGluZSIgKSB7CgkJc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7Cgl9Cn0KCmZ1bmN0aW9uIHByb3BGaWx0ZXIoIHByb3BzLCBzcGVjaWFsRWFzaW5nICkgewoJdmFyIGluZGV4LCBuYW1lLCBlYXNpbmcsIHZhbHVlLCBob29rczsKCgkvLyBjYW1lbENhc2UsIHNwZWNpYWxFYXNpbmcgYW5kIGV4cGFuZCBjc3NIb29rIHBhc3MKCWZvciAoIGluZGV4IGluIHByb3BzICkgewoJCW5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBpbmRleCApOwoJCWVhc2luZyA9IHNwZWNpYWxFYXNpbmdbIG5hbWUgXTsKCQl2YWx1ZSA9IHByb3BzWyBpbmRleCBdOwoJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCWVhc2luZyA9IHZhbHVlWyAxIF07CgkJCXZhbHVlID0gcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgMCBdOwoJCX0KCgkJaWYgKCBpbmRleCAhPT0gbmFtZSApIHsKCQkJcHJvcHNbIG5hbWUgXSA9IHZhbHVlOwoJCQlkZWxldGUgcHJvcHNbIGluZGV4IF07CgkJfQoKCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdOwoJCWlmICggaG9va3MgJiYgImV4cGFuZCIgaW4gaG9va3MgKSB7CgkJCXZhbHVlID0gaG9va3MuZXhwYW5kKCB2YWx1ZSApOwoJCQlkZWxldGUgcHJvcHNbIG5hbWUgXTsKCgkJCS8vIE5vdCBxdWl0ZSAkLmV4dGVuZCwgdGhpcyB3b24ndCBvdmVyd3JpdGUgZXhpc3Rpbmcga2V5cy4KCQkJLy8gUmV1c2luZyAnaW5kZXgnIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY29ycmVjdCAibmFtZSIKCQkJZm9yICggaW5kZXggaW4gdmFsdWUgKSB7CgkJCQlpZiAoICEoIGluZGV4IGluIHByb3BzICkgKSB7CgkJCQkJcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgaW5kZXggXTsKCQkJCQlzcGVjaWFsRWFzaW5nWyBpbmRleCBdID0gZWFzaW5nOwoJCQkJfQoJCQl9CgkJfSBlbHNlIHsKCQkJc3BlY2lhbEVhc2luZ1sgbmFtZSBdID0gZWFzaW5nOwoJCX0KCX0KfQoKZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJdmFyIHJlc3VsdCwKCQlzdG9wcGVkLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBhbmltYXRpb25QcmVmaWx0ZXJzLmxlbmd0aCwKCQlkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCS8vIERvbid0IG1hdGNoIGVsZW0gaW4gdGhlIDphbmltYXRlZCBzZWxlY3RvcgoJCQlkZWxldGUgdGljay5lbGVtOwoJCX0pLAoJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJaWYgKCBzdG9wcGVkICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXZhciBjdXJyZW50VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCksCgkJCQlyZW1haW5pbmcgPSBNYXRoLm1heCggMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lICksCgkJCQkvLyBTdXBwb3J0OiBBbmRyb2lkIDIuMwoJCQkJLy8gQXJjaGFpYyBjcmFzaCBidWcgd29uJ3QgYWxsb3cgdXMgdG8gdXNlIGAxIC0gKCAwLjUgfHwgMCApYCAoIzEyNDk3KQoJCQkJdGVtcCA9IHJlbWFpbmluZyAvIGFuaW1hdGlvbi5kdXJhdGlvbiB8fCAwLAoJCQkJcGVyY2VudCA9IDEgLSB0ZW1wLAoJCQkJaW5kZXggPSAwLAoJCQkJbGVuZ3RoID0gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGg7CgoJCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCBwZXJjZW50ICk7CgkJCX0KCgkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBwZXJjZW50LCByZW1haW5pbmcgXSk7CgoJCQlpZiAoIHBlcmNlbnQgPCAxICYmIGxlbmd0aCApIHsKCQkJCXJldHVybiByZW1haW5pbmc7CgkJCX0gZWxzZSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24gXSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSwKCQlhbmltYXRpb24gPSBkZWZlcnJlZC5wcm9taXNlKHsKCQkJZWxlbTogZWxlbSwKCQkJcHJvcHM6IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wZXJ0aWVzICksCgkJCW9wdHM6IGpRdWVyeS5leHRlbmQoIHRydWUsIHsgc3BlY2lhbEVhc2luZzoge30gfSwgb3B0aW9ucyApLAoJCQlvcmlnaW5hbFByb3BlcnRpZXM6IHByb3BlcnRpZXMsCgkJCW9yaWdpbmFsT3B0aW9uczogb3B0aW9ucywKCQkJc3RhcnRUaW1lOiBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQlkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKCQkJdHdlZW5zOiBbXSwKCQkJY3JlYXRlVHdlZW46IGZ1bmN0aW9uKCBwcm9wLCBlbmQgKSB7CgkJCQl2YXIgdHdlZW4gPSBqUXVlcnkuVHdlZW4oIGVsZW0sIGFuaW1hdGlvbi5vcHRzLCBwcm9wLCBlbmQsCgkJCQkJCWFuaW1hdGlvbi5vcHRzLnNwZWNpYWxFYXNpbmdbIHByb3AgXSB8fCBhbmltYXRpb24ub3B0cy5lYXNpbmcgKTsKCQkJCWFuaW1hdGlvbi50d2VlbnMucHVzaCggdHdlZW4gKTsKCQkJCXJldHVybiB0d2VlbjsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJCQl2YXIgaW5kZXggPSAwLAoJCQkJCS8vIElmIHdlIGFyZSBnb2luZyB0byB0aGUgZW5kLCB3ZSB3YW50IHRvIHJ1biBhbGwgdGhlIHR3ZWVucwoJCQkJCS8vIG90aGVyd2lzZSB3ZSBza2lwIHRoaXMgcGFydAoJCQkJCWxlbmd0aCA9IGdvdG9FbmQgPyBhbmltYXRpb24udHdlZW5zLmxlbmd0aCA6IDA7CgkJCQlpZiAoIHN0b3BwZWQgKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCQlzdG9wcGVkID0gdHJ1ZTsKCQkJCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCAxICk7CgkJCQl9CgoJCQkJLy8gUmVzb2x2ZSB3aGVuIHdlIHBsYXllZCB0aGUgbGFzdCBmcmFtZTsgb3RoZXJ3aXNlLCByZWplY3QKCQkJCWlmICggZ290b0VuZCApIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZWplY3RXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgZ290b0VuZCBdICk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0pLAoJCXByb3BzID0gYW5pbWF0aW9uLnByb3BzOwoKCXByb3BGaWx0ZXIoIHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nICk7CgoJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJcmVzdWx0ID0gYW5pbWF0aW9uUHJlZmlsdGVyc1sgaW5kZXggXS5jYWxsKCBhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyApOwoJCWlmICggcmVzdWx0ICkgewoJCQlyZXR1cm4gcmVzdWx0OwoJCX0KCX0KCglqUXVlcnkubWFwKCBwcm9wcywgY3JlYXRlVHdlZW4sIGFuaW1hdGlvbiApOwoKCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGFuaW1hdGlvbi5vcHRzLnN0YXJ0ICkgKSB7CgkJYW5pbWF0aW9uLm9wdHMuc3RhcnQuY2FsbCggZWxlbSwgYW5pbWF0aW9uICk7Cgl9CgoJalF1ZXJ5LmZ4LnRpbWVyKAoJCWpRdWVyeS5leHRlbmQoIHRpY2ssIHsKCQkJZWxlbTogZWxlbSwKCQkJYW5pbTogYW5pbWF0aW9uLAoJCQlxdWV1ZTogYW5pbWF0aW9uLm9wdHMucXVldWUKCQl9KQoJKTsKCgkvLyBhdHRhY2ggY2FsbGJhY2tzIGZyb20gb3B0aW9ucwoJcmV0dXJuIGFuaW1hdGlvbi5wcm9ncmVzcyggYW5pbWF0aW9uLm9wdHMucHJvZ3Jlc3MgKQoJCS5kb25lKCBhbmltYXRpb24ub3B0cy5kb25lLCBhbmltYXRpb24ub3B0cy5jb21wbGV0ZSApCgkJLmZhaWwoIGFuaW1hdGlvbi5vcHRzLmZhaWwgKQoJCS5hbHdheXMoIGFuaW1hdGlvbi5vcHRzLmFsd2F5cyApOwp9CgpqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJdHdlZW5lcjogZnVuY3Rpb24oIHByb3BzLCBjYWxsYmFjayApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBwcm9wcyApICkgewoJCQljYWxsYmFjayA9IHByb3BzOwoJCQlwcm9wcyA9IFsgIioiIF07CgkJfSBlbHNlIHsKCQkJcHJvcHMgPSBwcm9wcy5zcGxpdCgiICIpOwoJCX0KCgkJdmFyIHByb3AsCgkJCWluZGV4ID0gMCwKCQkJbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJcHJvcCA9IHByb3BzWyBpbmRleCBdOwoJCQl0d2VlbmVyc1sgcHJvcCBdID0gdHdlZW5lcnNbIHByb3AgXSB8fCBbXTsKCQkJdHdlZW5lcnNbIHByb3AgXS51bnNoaWZ0KCBjYWxsYmFjayApOwoJCX0KCX0sCgoJcHJlZmlsdGVyOiBmdW5jdGlvbiggY2FsbGJhY2ssIHByZXBlbmQgKSB7CgkJaWYgKCBwcmVwZW5kICkgewoJCQlhbmltYXRpb25QcmVmaWx0ZXJzLnVuc2hpZnQoIGNhbGxiYWNrICk7CgkJfSBlbHNlIHsKCQkJYW5pbWF0aW9uUHJlZmlsdGVycy5wdXNoKCBjYWxsYmFjayApOwoJCX0KCX0KfSk7CgpqUXVlcnkuc3BlZWQgPSBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgZm4gKSB7Cgl2YXIgb3B0ID0gc3BlZWQgJiYgdHlwZW9mIHNwZWVkID09PSAib2JqZWN0IiA/IGpRdWVyeS5leHRlbmQoIHt9LCBzcGVlZCApIDogewoJCWNvbXBsZXRlOiBmbiB8fCAhZm4gJiYgZWFzaW5nIHx8CgkJCWpRdWVyeS5pc0Z1bmN0aW9uKCBzcGVlZCApICYmIHNwZWVkLAoJCWR1cmF0aW9uOiBzcGVlZCwKCQllYXNpbmc6IGZuICYmIGVhc2luZyB8fCBlYXNpbmcgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKCBlYXNpbmcgKSAmJiBlYXNpbmcKCX07CgoJb3B0LmR1cmF0aW9uID0galF1ZXJ5LmZ4Lm9mZiA/IDAgOiB0eXBlb2Ygb3B0LmR1cmF0aW9uID09PSAibnVtYmVyIiA/IG9wdC5kdXJhdGlvbiA6CgkJb3B0LmR1cmF0aW9uIGluIGpRdWVyeS5meC5zcGVlZHMgPyBqUXVlcnkuZnguc3BlZWRzWyBvcHQuZHVyYXRpb24gXSA6IGpRdWVyeS5meC5zcGVlZHMuX2RlZmF1bHQ7CgoJLy8gTm9ybWFsaXplIG9wdC5xdWV1ZSAtIHRydWUvdW5kZWZpbmVkL251bGwgLT4gImZ4IgoJaWYgKCBvcHQucXVldWUgPT0gbnVsbCB8fCBvcHQucXVldWUgPT09IHRydWUgKSB7CgkJb3B0LnF1ZXVlID0gImZ4IjsKCX0KCgkvLyBRdWV1ZWluZwoJb3B0Lm9sZCA9IG9wdC5jb21wbGV0ZTsKCglvcHQuY29tcGxldGUgPSBmdW5jdGlvbigpIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHQub2xkICkgKSB7CgkJCW9wdC5vbGQuY2FsbCggdGhpcyApOwoJCX0KCgkJaWYgKCBvcHQucXVldWUgKSB7CgkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCBvcHQucXVldWUgKTsKCQl9Cgl9OwoKCXJldHVybiBvcHQ7Cn07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWZhZGVUbzogZnVuY3Rpb24oIHNwZWVkLCB0bywgZWFzaW5nLCBjYWxsYmFjayApIHsKCgkJLy8gU2hvdyBhbnkgaGlkZGVuIGVsZW1lbnRzIGFmdGVyIHNldHRpbmcgb3BhY2l0eSB0byAwCgkJcmV0dXJuIHRoaXMuZmlsdGVyKCBpc0hpZGRlbiApLmNzcyggIm9wYWNpdHkiLCAwICkuc2hvdygpCgoJCQkvLyBBbmltYXRlIHRvIHRoZSB2YWx1ZSBzcGVjaWZpZWQKCQkJLmVuZCgpLmFuaW1hdGUoeyBvcGFjaXR5OiB0byB9LCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfSwKCWFuaW1hdGU6IGZ1bmN0aW9uKCBwcm9wLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQl2YXIgZW1wdHkgPSBqUXVlcnkuaXNFbXB0eU9iamVjdCggcHJvcCApLAoJCQlvcHRhbGwgPSBqUXVlcnkuc3BlZWQoIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICksCgkJCWRvQW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7CgkJCQkvLyBPcGVyYXRlIG9uIGEgY29weSBvZiBwcm9wIHNvIHBlci1wcm9wZXJ0eSBlYXNpbmcgd29uJ3QgYmUgbG9zdAoJCQkJdmFyIGFuaW0gPSBBbmltYXRpb24oIHRoaXMsIGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wICksIG9wdGFsbCApOwoKCQkJCS8vIEVtcHR5IGFuaW1hdGlvbnMsIG9yIGZpbmlzaGluZyByZXNvbHZlcyBpbW1lZGlhdGVseQoJCQkJaWYgKCBlbXB0eSB8fCBkYXRhX3ByaXYuZ2V0KCB0aGlzLCAiZmluaXNoIiApICkgewoJCQkJCWFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJfQoJCQl9OwoJCQlkb0FuaW1hdGlvbi5maW5pc2ggPSBkb0FuaW1hdGlvbjsKCgkJcmV0dXJuIGVtcHR5IHx8IG9wdGFsbC5xdWV1ZSA9PT0gZmFsc2UgPwoJCQl0aGlzLmVhY2goIGRvQW5pbWF0aW9uICkgOgoJCQl0aGlzLnF1ZXVlKCBvcHRhbGwucXVldWUsIGRvQW5pbWF0aW9uICk7Cgl9LAoJc3RvcDogZnVuY3Rpb24oIHR5cGUsIGNsZWFyUXVldWUsIGdvdG9FbmQgKSB7CgkJdmFyIHN0b3BRdWV1ZSA9IGZ1bmN0aW9uKCBob29rcyApIHsKCQkJdmFyIHN0b3AgPSBob29rcy5zdG9wOwoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJc3RvcCggZ290b0VuZCApOwoJCX07CgoJCWlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQlnb3RvRW5kID0gY2xlYXJRdWV1ZTsKCQkJY2xlYXJRdWV1ZSA9IHR5cGU7CgkJCXR5cGUgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggY2xlYXJRdWV1ZSAmJiB0eXBlICE9PSBmYWxzZSApIHsKCQkJdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGRlcXVldWUgPSB0cnVlLAoJCQkJaW5kZXggPSB0eXBlICE9IG51bGwgJiYgdHlwZSArICJxdWV1ZUhvb2tzIiwKCQkJCXRpbWVycyA9IGpRdWVyeS50aW1lcnMsCgkJCQlkYXRhID0gZGF0YV9wcml2LmdldCggdGhpcyApOwoKCQkJaWYgKCBpbmRleCApIHsKCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgKSB7CgkJCQkJc3RvcFF1ZXVlKCBkYXRhWyBpbmRleCBdICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpbmRleCBpbiBkYXRhICkgewoJCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgJiYgcnJ1bi50ZXN0KCBpbmRleCApICkgewoJCQkJCQlzdG9wUXVldWUoIGRhdGFbIGluZGV4IF0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWZvciAoIGluZGV4ID0gdGltZXJzLmxlbmd0aDsgaW5kZXgtLTsgKSB7CgkJCQlpZiAoIHRpbWVyc1sgaW5kZXggXS5lbGVtID09PSB0aGlzICYmICh0eXBlID09IG51bGwgfHwgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlKSApIHsKCQkJCQl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCBnb3RvRW5kICk7CgkJCQkJZGVxdWV1ZSA9IGZhbHNlOwoJCQkJCXRpbWVycy5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQl9CgkJCX0KCgkJCS8vIFN0YXJ0IHRoZSBuZXh0IGluIHRoZSBxdWV1ZSBpZiB0aGUgbGFzdCBzdGVwIHdhc24ndCBmb3JjZWQuCgkJCS8vIFRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2gKCQkJLy8gd2lsbCBkZXF1ZXVlIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kLgoJCQlpZiAoIGRlcXVldWUgfHwgIWdvdG9FbmQgKSB7CgkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQl9CgkJfSk7Cgl9LAoJZmluaXNoOiBmdW5jdGlvbiggdHlwZSApIHsKCQlpZiAoIHR5cGUgIT09IGZhbHNlICkgewoJCQl0eXBlID0gdHlwZSB8fCAiZngiOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgaW5kZXgsCgkJCQlkYXRhID0gZGF0YV9wcml2LmdldCggdGhpcyApLAoJCQkJcXVldWUgPSBkYXRhWyB0eXBlICsgInF1ZXVlIiBdLAoJCQkJaG9va3MgPSBkYXRhWyB0eXBlICsgInF1ZXVlSG9va3MiIF0sCgkJCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCQkJbGVuZ3RoID0gcXVldWUgPyBxdWV1ZS5sZW5ndGggOiAwOwoKCQkJLy8gRW5hYmxlIGZpbmlzaGluZyBmbGFnIG9uIHByaXZhdGUgZGF0YQoJCQlkYXRhLmZpbmlzaCA9IHRydWU7CgoJCQkvLyBFbXB0eSB0aGUgcXVldWUgZmlyc3QKCQkJalF1ZXJ5LnF1ZXVlKCB0aGlzLCB0eXBlLCBbXSApOwoKCQkJaWYgKCBob29rcyAmJiBob29rcy5zdG9wICkgewoJCQkJaG9va3Muc3RvcC5jYWxsKCB0aGlzLCB0cnVlICk7CgkJCX0KCgkJCS8vIExvb2sgZm9yIGFueSBhY3RpdmUgYW5pbWF0aW9ucywgYW5kIGZpbmlzaCB0aGVtCgkJCWZvciAoIGluZGV4ID0gdGltZXJzLmxlbmd0aDsgaW5kZXgtLTsgKSB7CgkJCQlpZiAoIHRpbWVyc1sgaW5kZXggXS5lbGVtID09PSB0aGlzICYmIHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSApIHsKCQkJCQl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCB0cnVlICk7CgkJCQkJdGltZXJzLnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCX0KCQkJfQoKCQkJLy8gTG9vayBmb3IgYW55IGFuaW1hdGlvbnMgaW4gdGhlIG9sZCBxdWV1ZSBhbmQgZmluaXNoIHRoZW0KCQkJZm9yICggaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQkJCWlmICggcXVldWVbIGluZGV4IF0gJiYgcXVldWVbIGluZGV4IF0uZmluaXNoICkgewoJCQkJCXF1ZXVlWyBpbmRleCBdLmZpbmlzaC5jYWxsKCB0aGlzICk7CgkJCQl9CgkJCX0KCgkJCS8vIFR1cm4gb2ZmIGZpbmlzaGluZyBmbGFnCgkJCWRlbGV0ZSBkYXRhLmZpbmlzaDsKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZWFjaChbICJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCXZhciBjc3NGbiA9IGpRdWVyeS5mblsgbmFtZSBdOwoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHNwZWVkID09IG51bGwgfHwgdHlwZW9mIHNwZWVkID09PSAiYm9vbGVhbiIgPwoJCQljc3NGbi5hcHBseSggdGhpcywgYXJndW1lbnRzICkgOgoJCQl0aGlzLmFuaW1hdGUoIGdlbkZ4KCBuYW1lLCB0cnVlICksIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7Cgl9Owp9KTsKCi8vIEdlbmVyYXRlIHNob3J0Y3V0cyBmb3IgY3VzdG9tIGFuaW1hdGlvbnMKalF1ZXJ5LmVhY2goewoJc2xpZGVEb3duOiBnZW5GeCgic2hvdyIpLAoJc2xpZGVVcDogZ2VuRngoImhpZGUiKSwKCXNsaWRlVG9nZ2xlOiBnZW5GeCgidG9nZ2xlIiksCglmYWRlSW46IHsgb3BhY2l0eTogInNob3ciIH0sCglmYWRlT3V0OiB7IG9wYWNpdHk6ICJoaWRlIiB9LAoJZmFkZVRvZ2dsZTogeyBvcGFjaXR5OiAidG9nZ2xlIiB9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBwcm9wcyApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCXJldHVybiB0aGlzLmFuaW1hdGUoIHByb3BzLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfTsKfSk7CgpqUXVlcnkudGltZXJzID0gW107CmpRdWVyeS5meC50aWNrID0gZnVuY3Rpb24oKSB7Cgl2YXIgdGltZXIsCgkJaSA9IDAsCgkJdGltZXJzID0galF1ZXJ5LnRpbWVyczsKCglmeE5vdyA9IGpRdWVyeS5ub3coKTsKCglmb3IgKCA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKysgKSB7CgkJdGltZXIgPSB0aW1lcnNbIGkgXTsKCQkvLyBDaGVja3MgdGhlIHRpbWVyIGhhcyBub3QgYWxyZWFkeSBiZWVuIHJlbW92ZWQKCQlpZiAoICF0aW1lcigpICYmIHRpbWVyc1sgaSBdID09PSB0aW1lciApIHsKCQkJdGltZXJzLnNwbGljZSggaS0tLCAxICk7CgkJfQoJfQoKCWlmICggIXRpbWVycy5sZW5ndGggKSB7CgkJalF1ZXJ5LmZ4LnN0b3AoKTsKCX0KCWZ4Tm93ID0gdW5kZWZpbmVkOwp9OwoKalF1ZXJ5LmZ4LnRpbWVyID0gZnVuY3Rpb24oIHRpbWVyICkgewoJalF1ZXJ5LnRpbWVycy5wdXNoKCB0aW1lciApOwoJaWYgKCB0aW1lcigpICkgewoJCWpRdWVyeS5meC5zdGFydCgpOwoJfSBlbHNlIHsKCQlqUXVlcnkudGltZXJzLnBvcCgpOwoJfQp9OwoKalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CgpqUXVlcnkuZnguc3RhcnQgPSBmdW5jdGlvbigpIHsKCWlmICggIXRpbWVySWQgKSB7CgkJdGltZXJJZCA9IHNldEludGVydmFsKCBqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsICk7Cgl9Cn07CgpqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewoJY2xlYXJJbnRlcnZhbCggdGltZXJJZCApOwoJdGltZXJJZCA9IG51bGw7Cn07CgpqUXVlcnkuZnguc3BlZWRzID0gewoJc2xvdzogNjAwLAoJZmFzdDogMjAwLAoJLy8gRGVmYXVsdCBzcGVlZAoJX2RlZmF1bHQ6IDQwMAp9OwoKCi8vIEJhc2VkIG9mZiBvZiB0aGUgcGx1Z2luIGJ5IENsaW50IEhlbGZlcnMsIHdpdGggcGVybWlzc2lvbi4KLy8gaHR0cDovL2JsaW5kc2lnbmFscy5jb20vaW5kZXgucGhwLzIwMDkvMDcvanF1ZXJ5LWRlbGF5LwpqUXVlcnkuZm4uZGVsYXkgPSBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCXRpbWUgPSBqUXVlcnkuZnggPyBqUXVlcnkuZnguc3BlZWRzWyB0aW1lIF0gfHwgdGltZSA6IHRpbWU7Cgl0eXBlID0gdHlwZSB8fCAiZngiOwoKCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJdmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCBuZXh0LCB0aW1lICk7CgkJaG9va3Muc3RvcCA9IGZ1bmN0aW9uKCkgewoJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQl9OwoJfSk7Cn07CgoKKGZ1bmN0aW9uKCkgewoJdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImlucHV0IiApLAoJCXNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJzZWxlY3QiICksCgkJb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAib3B0aW9uIiApICk7CgoJaW5wdXQudHlwZSA9ICJjaGVja2JveCI7CgoJLy8gU3VwcG9ydDogaU9TPD01LjEsIEFuZHJvaWQ8PTQuMisKCS8vIERlZmF1bHQgdmFsdWUgZm9yIGEgY2hlY2tib3ggc2hvdWxkIGJlICJvbiIKCXN1cHBvcnQuY2hlY2tPbiA9IGlucHV0LnZhbHVlICE9PSAiIjsKCgkvLyBTdXBwb3J0OiBJRTw9MTErCgkvLyBNdXN0IGFjY2VzcyBzZWxlY3RlZEluZGV4IHRvIG1ha2UgZGVmYXVsdCBvcHRpb25zIHNlbGVjdAoJc3VwcG9ydC5vcHRTZWxlY3RlZCA9IG9wdC5zZWxlY3RlZDsKCgkvLyBTdXBwb3J0OiBBbmRyb2lkPD0yLjMKCS8vIE9wdGlvbnMgaW5zaWRlIGRpc2FibGVkIHNlbGVjdHMgYXJlIGluY29ycmVjdGx5IG1hcmtlZCBhcyBkaXNhYmxlZAoJc2VsZWN0LmRpc2FibGVkID0gdHJ1ZTsKCXN1cHBvcnQub3B0RGlzYWJsZWQgPSAhb3B0LmRpc2FibGVkOwoKCS8vIFN1cHBvcnQ6IElFPD0xMSsKCS8vIEFuIGlucHV0IGxvc2VzIGl0cyB2YWx1ZSBhZnRlciBiZWNvbWluZyBhIHJhZGlvCglpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJpbnB1dCIgKTsKCWlucHV0LnZhbHVlID0gInQiOwoJaW5wdXQudHlwZSA9ICJyYWRpbyI7CglzdXBwb3J0LnJhZGlvVmFsdWUgPSBpbnB1dC52YWx1ZSA9PT0gInQiOwp9KSgpOwoKCnZhciBub2RlSG9vaywgYm9vbEhvb2ssCglhdHRySGFuZGxlID0galF1ZXJ5LmV4cHIuYXR0ckhhbmRsZTsKCmpRdWVyeS5mbi5leHRlbmQoewoJYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGpRdWVyeS5hdHRyLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCgoJcmVtb3ZlQXR0cjogZnVuY3Rpb24oIG5hbWUgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIHRoaXMsIG5hbWUgKTsKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCWF0dHI6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHsKCQl2YXIgaG9va3MsIHJldCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gc3RydW5kZWZpbmVkICkgewoJCQlyZXR1cm4galF1ZXJ5LnByb3AoIGVsZW0sIG5hbWUsIHZhbHVlICk7CgkJfQoKCQkvLyBBbGwgYXR0cmlidXRlcyBhcmUgbG93ZXJjYXNlCgkJLy8gR3JhYiBuZWNlc3NhcnkgaG9vayBpZiBvbmUgaXMgZGVmaW5lZAoJCWlmICggblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyggZWxlbSApICkgewoJCQluYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlob29rcyA9IGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSB8fAoJCQkJKCBqUXVlcnkuZXhwci5tYXRjaC5ib29sLnRlc3QoIG5hbWUgKSA/IGJvb2xIb29rIDogbm9kZUhvb2sgKTsKCQl9CgoJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggdmFsdWUgPT09IG51bGwgKSB7CgkJCQlqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApOwoKCQkJfSBlbHNlIGlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgoJCQl9IGVsc2UgewoJCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIHZhbHVlICsgIiIgKTsKCQkJCXJldHVybiB2YWx1ZTsKCQkJfQoKCQl9IGVsc2UgaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsICkgewoJCQlyZXR1cm4gcmV0OwoKCQl9IGVsc2UgewoJCQlyZXQgPSBqUXVlcnkuZmluZC5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkvLyBOb24tZXhpc3RlbnQgYXR0cmlidXRlcyByZXR1cm4gbnVsbCwgd2Ugbm9ybWFsaXplIHRvIHVuZGVmaW5lZAoJCQlyZXR1cm4gcmV0ID09IG51bGwgPwoJCQkJdW5kZWZpbmVkIDoKCQkJCXJldDsKCQl9Cgl9LAoKCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQl2YXIgbmFtZSwgcHJvcE5hbWUsCgkJCWkgPSAwLAoJCQlhdHRyTmFtZXMgPSB2YWx1ZSAmJiB2YWx1ZS5tYXRjaCggcm5vdHdoaXRlICk7CgoJCWlmICggYXR0ck5hbWVzICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCXdoaWxlICggKG5hbWUgPSBhdHRyTmFtZXNbaSsrXSkgKSB7CgkJCQlwcm9wTmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCgkJCQkvLyBCb29sZWFuIGF0dHJpYnV0ZXMgZ2V0IHNwZWNpYWwgdHJlYXRtZW50ICgjMTA4NzApCgkJCQlpZiAoIGpRdWVyeS5leHByLm1hdGNoLmJvb2wudGVzdCggbmFtZSApICkgewoJCQkJCS8vIFNldCBjb3JyZXNwb25kaW5nIHByb3BlcnR5IHRvIGZhbHNlCgkJCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOwoJCQkJfQoKCQkJCWVsZW0ucmVtb3ZlQXR0cmlidXRlKCBuYW1lICk7CgkJCX0KCQl9Cgl9LAoKCWF0dHJIb29rczogewoJCXR5cGU6IHsKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQlpZiAoICFzdXBwb3J0LnJhZGlvVmFsdWUgJiYgdmFsdWUgPT09ICJyYWRpbyIgJiYKCQkJCQlqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSApIHsKCQkJCQl2YXIgdmFsID0gZWxlbS52YWx1ZTsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggInR5cGUiLCB2YWx1ZSApOwoJCQkJCWlmICggdmFsICkgewoJCQkJCQllbGVtLnZhbHVlID0gdmFsOwoJCQkJCX0KCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCX0KCQl9Cgl9Cn0pOwoKLy8gSG9va3MgZm9yIGJvb2xlYW4gYXR0cmlidXRlcwpib29sSG9vayA9IHsKCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBuYW1lICkgewoJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkvLyBSZW1vdmUgYm9vbGVhbiBhdHRyaWJ1dGVzIHdoZW4gc2V0IHRvIGZhbHNlCgkJCWpRdWVyeS5yZW1vdmVBdHRyKCBlbGVtLCBuYW1lICk7CgkJfSBlbHNlIHsKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIG5hbWUgKTsKCQl9CgkJcmV0dXJuIG5hbWU7Cgl9Cn07CmpRdWVyeS5lYWNoKCBqUXVlcnkuZXhwci5tYXRjaC5ib29sLnNvdXJjZS5tYXRjaCggL1x3Ky9nICksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJdmFyIGdldHRlciA9IGF0dHJIYW5kbGVbIG5hbWUgXSB8fCBqUXVlcnkuZmluZC5hdHRyOwoKCWF0dHJIYW5kbGVbIG5hbWUgXSA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHsKCQl2YXIgcmV0LCBoYW5kbGU7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCS8vIEF2b2lkIGFuIGluZmluaXRlIGxvb3AgYnkgdGVtcG9yYXJpbHkgcmVtb3ZpbmcgdGhpcyBmdW5jdGlvbiBmcm9tIHRoZSBnZXR0ZXIKCQkJaGFuZGxlID0gYXR0ckhhbmRsZVsgbmFtZSBdOwoJCQlhdHRySGFuZGxlWyBuYW1lIF0gPSByZXQ7CgkJCXJldCA9IGdldHRlciggZWxlbSwgbmFtZSwgaXNYTUwgKSAhPSBudWxsID8KCQkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCQludWxsOwoJCQlhdHRySGFuZGxlWyBuYW1lIF0gPSBoYW5kbGU7CgkJfQoJCXJldHVybiByZXQ7Cgl9Owp9KTsKCgoKCnZhciByZm9jdXNhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaTsKCmpRdWVyeS5mbi5leHRlbmQoewoJcHJvcDogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGpRdWVyeS5wcm9wLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCgoJcmVtb3ZlUHJvcDogZnVuY3Rpb24oIG5hbWUgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJZGVsZXRlIHRoaXNbIGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZSBdOwoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJcHJvcEZpeDogewoJCSJmb3IiOiAiaHRtbEZvciIsCgkJImNsYXNzIjogImNsYXNzTmFtZSIKCX0sCgoJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCXZhciByZXQsIGhvb2tzLCBub3R4bWwsCgkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJLy8gRG9uJ3QgZ2V0L3NldCBwcm9wZXJ0aWVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2RlcwoJCWlmICggIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIgKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJaWYgKCBub3R4bWwgKSB7CgkJCS8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzWyBuYW1lIF07CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiBob29rcyAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkID8KCQkJCXJldCA6CgkJCQkoIGVsZW1bIG5hbWUgXSA9IHZhbHVlICk7CgoJCX0gZWxzZSB7CgkJCXJldHVybiBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsID8KCQkJCXJldCA6CgkJCQllbGVtWyBuYW1lIF07CgkJfQoJfSwKCglwcm9wSG9va3M6IHsKCQl0YWJJbmRleDogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uaGFzQXR0cmlidXRlKCAidGFiaW5kZXgiICkgfHwgcmZvY3VzYWJsZS50ZXN0KCBlbGVtLm5vZGVOYW1lICkgfHwgZWxlbS5ocmVmID8KCQkJCQllbGVtLnRhYkluZGV4IDoKCQkJCQktMTsKCQkJfQoJCX0KCX0KfSk7CgppZiAoICFzdXBwb3J0Lm9wdFNlbGVjdGVkICkgewoJalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoJCQlpZiAoIHBhcmVudCAmJiBwYXJlbnQucGFyZW50Tm9kZSApIHsKCQkJCXBhcmVudC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJfTsKfQoKalF1ZXJ5LmVhY2goWwoJInRhYkluZGV4IiwKCSJyZWFkT25seSIsCgkibWF4TGVuZ3RoIiwKCSJjZWxsU3BhY2luZyIsCgkiY2VsbFBhZGRpbmciLAoJInJvd1NwYW4iLAoJImNvbFNwYW4iLAoJInVzZU1hcCIsCgkiZnJhbWVCb3JkZXIiLAoJImNvbnRlbnRFZGl0YWJsZSIKXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkucHJvcEZpeFsgdGhpcy50b0xvd2VyQ2FzZSgpIF0gPSB0aGlzOwp9KTsKCgoKCnZhciByY2xhc3MgPSAvW1x0XHJcblxmXS9nOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglhZGRDbGFzczogZnVuY3Rpb24oIHZhbHVlICkgewoJCXZhciBjbGFzc2VzLCBlbGVtLCBjdXIsIGNsYXp6LCBqLCBmaW5hbFZhbHVlLAoJCQlwcm9jZWVkID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkgewoJCQkJalF1ZXJ5KCB0aGlzICkuYWRkQ2xhc3MoIHZhbHVlLmNhbGwoIHRoaXMsIGosIHRoaXMuY2xhc3NOYW1lICkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHByb2NlZWQgKSB7CgkJCS8vIFRoZSBkaXNqdW5jdGlvbiBoZXJlIGlzIGZvciBiZXR0ZXIgY29tcHJlc3NpYmlsaXR5IChzZWUgcmVtb3ZlQ2xhc3MpCgkJCWNsYXNzZXMgPSAoIHZhbHVlIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdOwoKCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQllbGVtID0gdGhpc1sgaSBdOwoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiAiCgkJCQkpOwoKCQkJCWlmICggY3VyICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKGNsYXp6ID0gY2xhc3Nlc1tqKytdKSApIHsKCQkJCQkJaWYgKCBjdXIuaW5kZXhPZiggIiAiICsgY2xhenogKyAiICIgKSA8IDAgKSB7CgkJCQkJCQljdXIgKz0gY2xhenogKyAiICI7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIG9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCgkJCQkJZmluYWxWYWx1ZSA9IGpRdWVyeS50cmltKCBjdXIgKTsKCQkJCQlpZiAoIGVsZW0uY2xhc3NOYW1lICE9PSBmaW5hbFZhbHVlICkgewoJCQkJCQllbGVtLmNsYXNzTmFtZSA9IGZpbmFsVmFsdWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgY2xhc3NlcywgZWxlbSwgY3VyLCBjbGF6eiwgaiwgZmluYWxWYWx1ZSwKCQkJcHJvY2VlZCA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVtb3ZlQ2xhc3MoIHZhbHVlLmNhbGwoIHRoaXMsIGosIHRoaXMuY2xhc3NOYW1lICkgKTsKCQkJfSk7CgkJfQoJCWlmICggcHJvY2VlZCApIHsKCQkJY2xhc3NlcyA9ICggdmFsdWUgfHwgIiIgKS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW107CgoJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgkJCQkvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiIKCQkJCSk7CgoJCQkJaWYgKCBjdXIgKSB7CgkJCQkJaiA9IDA7CgkJCQkJd2hpbGUgKCAoY2xhenogPSBjbGFzc2VzW2orK10pICkgewoJCQkJCQkvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCgkJCQkJCXdoaWxlICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPj0gMCApIHsKCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIE9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCgkJCQkJZmluYWxWYWx1ZSA9IHZhbHVlID8galF1ZXJ5LnRyaW0oIGN1ciApIDogIiI7CgkJCQkJaWYgKCBlbGVtLmNsYXNzTmFtZSAhPT0gZmluYWxWYWx1ZSApIHsKCQkJCQkJZWxlbS5jbGFzc05hbWUgPSBmaW5hbFZhbHVlOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXRvZ2dsZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUsIHN0YXRlVmFsICkgewoJCXZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQlpZiAoIHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iICYmIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gc3RhdGVWYWwgPyB0aGlzLmFkZENsYXNzKCB2YWx1ZSApIDogdGhpcy5yZW1vdmVDbGFzcyggdmFsdWUgKTsKCQl9CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS50b2dnbGVDbGFzcyggdmFsdWUuY2FsbCh0aGlzLCBpLCB0aGlzLmNsYXNzTmFtZSwgc3RhdGVWYWwpLCBzdGF0ZVZhbCApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgKSB7CgkJCQkvLyBUb2dnbGUgaW5kaXZpZHVhbCBjbGFzcyBuYW1lcwoJCQkJdmFyIGNsYXNzTmFtZSwKCQkJCQlpID0gMCwKCQkJCQlzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQkJY2xhc3NOYW1lcyA9IHZhbHVlLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbXTsKCgkJCQl3aGlsZSAoIChjbGFzc05hbWUgPSBjbGFzc05hbWVzWyBpKysgXSkgKSB7CgkJCQkJLy8gQ2hlY2sgZWFjaCBjbGFzc05hbWUgZ2l2ZW4sIHNwYWNlIHNlcGFyYXRlZCBsaXN0CgkJCQkJaWYgKCBzZWxmLmhhc0NsYXNzKCBjbGFzc05hbWUgKSApIHsKCQkJCQkJc2VsZi5yZW1vdmVDbGFzcyggY2xhc3NOYW1lICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJc2VsZi5hZGRDbGFzcyggY2xhc3NOYW1lICk7CgkJCQkJfQoJCQkJfQoKCQkJLy8gVG9nZ2xlIHdob2xlIGNsYXNzIG5hbWUKCQkJfSBlbHNlIGlmICggdHlwZSA9PT0gc3RydW5kZWZpbmVkIHx8IHR5cGUgPT09ICJib29sZWFuIiApIHsKCQkJCWlmICggdGhpcy5jbGFzc05hbWUgKSB7CgkJCQkJLy8gc3RvcmUgY2xhc3NOYW1lIGlmIHNldAoJCQkJCWRhdGFfcHJpdi5zZXQoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUgKTsKCQkJCX0KCgkJCQkvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBjbGFzcyBuYW1lIG9yIGlmIHdlJ3JlIHBhc3NlZCBgZmFsc2VgLAoJCQkJLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KCQkJCS8vIE90aGVyd2lzZSBicmluZyBiYWNrIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IHNhdmVkIChpZiBhbnl0aGluZyksCgkJCQkvLyBmYWxsaW5nIGJhY2sgdG8gdGhlIGVtcHR5IHN0cmluZyBpZiBub3RoaW5nIHdhcyBzdG9yZWQuCgkJCQl0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogZGF0YV9wcml2LmdldCggdGhpcywgIl9fY2xhc3NOYW1lX18iICkgfHwgIiI7CgkJCX0KCQl9KTsKCX0sCgoJaGFzQ2xhc3M6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgY2xhc3NOYW1lID0gIiAiICsgc2VsZWN0b3IgKyAiICIsCgkJCWkgPSAwLAoJCQlsID0gdGhpcy5sZW5ndGg7CgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQlpZiAoIHRoaXNbaV0ubm9kZVR5cGUgPT09IDEgJiYgKCIgIiArIHRoaXNbaV0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKHJjbGFzcywgIiAiKS5pbmRleE9mKCBjbGFzc05hbWUgKSA+PSAwICkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9CgoJCXJldHVybiBmYWxzZTsKCX0KfSk7CgoKCgp2YXIgcnJldHVybiA9IC9cci9nOwoKalF1ZXJ5LmZuLmV4dGVuZCh7Cgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgaG9va3MsIHJldCwgaXNGdW5jdGlvbiwKCQkJZWxlbSA9IHRoaXNbMF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQlyZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPwoJCQkJCS8vIEhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZShycmV0dXJuLCAiIikgOgoJCQkJCS8vIEhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHZhbDsKCgkJCWlmICggdGhpcy5ub2RlVHlwZSAhPT0gMSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKCBpc0Z1bmN0aW9uICkgewoJCQkJdmFsID0gdmFsdWUuY2FsbCggdGhpcywgaSwgalF1ZXJ5KCB0aGlzICkudmFsKCkgKTsKCQkJfSBlbHNlIHsKCQkJCXZhbCA9IHZhbHVlOwoJCQl9CgoJCQkvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyAiIjsgY29udmVydCBudW1iZXJzIHRvIHN0cmluZwoJCQlpZiAoIHZhbCA9PSBudWxsICkgewoJCQkJdmFsID0gIiI7CgoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgdmFsID09PSAibnVtYmVyIiApIHsKCQkJCXZhbCArPSAiIjsKCgkJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0FycmF5KCB2YWwgKSApIHsKCQkJCXZhbCA9IGpRdWVyeS5tYXAoIHZhbCwgZnVuY3Rpb24oIHZhbHVlICkgewoJCQkJCXJldHVybiB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZSArICIiOwoJCQkJfSk7CgkJCX0KCgkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyB0aGlzLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIHRoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJLy8gSWYgc2V0IHJldHVybnMgdW5kZWZpbmVkLCBmYWxsIGJhY2sgdG8gbm9ybWFsIHNldHRpbmcKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgaG9va3Muc2V0KCB0aGlzLCB2YWwsICJ2YWx1ZSIgKSA9PT0gdW5kZWZpbmVkICkgewoJCQkJdGhpcy52YWx1ZSA9IHZhbDsKCQkJfQoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJdmFsSG9va3M6IHsKCQlvcHRpb246IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciB2YWwgPSBqUXVlcnkuZmluZC5hdHRyKCBlbGVtLCAidmFsdWUiICk7CgkJCQlyZXR1cm4gdmFsICE9IG51bGwgPwoJCQkJCXZhbCA6CgkJCQkJLy8gU3VwcG9ydDogSUUxMC0xMSsKCQkJCQkvLyBvcHRpb24udGV4dCB0aHJvd3MgZXhjZXB0aW9ucyAoIzE0Njg2LCAjMTQ4NTgpCgkJCQkJalF1ZXJ5LnRyaW0oIGpRdWVyeS50ZXh0KCBlbGVtICkgKTsKCQkJfQoJCX0sCgkJc2VsZWN0OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgdmFsdWUsIG9wdGlvbiwKCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCWluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LAoJCQkJCW9uZSA9IGVsZW0udHlwZSA9PT0gInNlbGVjdC1vbmUiIHx8IGluZGV4IDwgMCwKCQkJCQl2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCgkJCQkJbWF4ID0gb25lID8gaW5kZXggKyAxIDogb3B0aW9ucy5sZW5ndGgsCgkJCQkJaSA9IGluZGV4IDwgMCA/CgkJCQkJCW1heCA6CgkJCQkJCW9uZSA/IGluZGV4IDogMDsKCgkJCQkvLyBMb29wIHRocm91Z2ggYWxsIHRoZSBzZWxlY3RlZCBvcHRpb25zCgkJCQlmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHsKCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCS8vIElFNi05IGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKQoJCQkJCWlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJgoJCQkJCQkJLy8gRG9uJ3QgcmV0dXJuIG9wdGlvbnMgdGhhdCBhcmUgZGlzYWJsZWQgb3IgaW4gYSBkaXNhYmxlZCBvcHRncm91cAoJCQkJCQkJKCBzdXBwb3J0Lm9wdERpc2FibGVkID8gIW9wdGlvbi5kaXNhYmxlZCA6IG9wdGlvbi5nZXRBdHRyaWJ1dGUoICJkaXNhYmxlZCIgKSA9PT0gbnVsbCApICYmCgkJCQkJCQkoICFvcHRpb24ucGFyZW50Tm9kZS5kaXNhYmxlZCB8fCAhalF1ZXJ5Lm5vZGVOYW1lKCBvcHRpb24ucGFyZW50Tm9kZSwgIm9wdGdyb3VwIiApICkgKSB7CgoJCQkJCQkvLyBHZXQgdGhlIHNwZWNpZmljIHZhbHVlIGZvciB0aGUgb3B0aW9uCgkJCQkJCXZhbHVlID0galF1ZXJ5KCBvcHRpb24gKS52YWwoKTsKCgkJCQkJCS8vIFdlIGRvbid0IG5lZWQgYW4gYXJyYXkgZm9yIG9uZSBzZWxlY3RzCgkJCQkJCWlmICggb25lICkgewoJCQkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJCQl9CgoJCQkJCQkvLyBNdWx0aS1TZWxlY3RzIHJldHVybiBhbiBhcnJheQoJCQkJCQl2YWx1ZXMucHVzaCggdmFsdWUgKTsKCQkJCQl9CgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlczsKCQkJfSwKCgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJdmFyIG9wdGlvblNldCwgb3B0aW9uLAoJCQkJCW9wdGlvbnMgPSBlbGVtLm9wdGlvbnMsCgkJCQkJdmFsdWVzID0galF1ZXJ5Lm1ha2VBcnJheSggdmFsdWUgKSwKCQkJCQlpID0gb3B0aW9ucy5sZW5ndGg7CgoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJb3B0aW9uID0gb3B0aW9uc1sgaSBdOwoJCQkJCWlmICggKG9wdGlvbi5zZWxlY3RlZCA9IGpRdWVyeS5pbkFycmF5KCBvcHRpb24udmFsdWUsIHZhbHVlcyApID49IDApICkgewoJCQkJCQlvcHRpb25TZXQgPSB0cnVlOwoJCQkJCX0KCQkJCX0KCgkJCQkvLyBGb3JjZSBicm93c2VycyB0byBiZWhhdmUgY29uc2lzdGVudGx5IHdoZW4gbm9uLW1hdGNoaW5nIHZhbHVlIGlzIHNldAoJCQkJaWYgKCAhb3B0aW9uU2V0ICkgewoJCQkJCWVsZW0uc2VsZWN0ZWRJbmRleCA9IC0xOwoJCQkJfQoJCQkJcmV0dXJuIHZhbHVlczsKCQkJfQoJCX0KCX0KfSk7CgovLyBSYWRpb3MgYW5kIGNoZWNrYm94ZXMgZ2V0dGVyL3NldHRlcgpqUXVlcnkuZWFjaChbICJyYWRpbyIsICJjaGVja2JveCIgXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IHsKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJCXJldHVybiAoIGVsZW0uY2hlY2tlZCA9IGpRdWVyeS5pbkFycmF5KCBqUXVlcnkoZWxlbSkudmFsKCksIHZhbHVlICkgPj0gMCApOwoJCQl9CgkJfQoJfTsKCWlmICggIXN1cHBvcnQuY2hlY2tPbiApIHsKCQlqUXVlcnkudmFsSG9va3NbIHRoaXMgXS5nZXQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpID09PSBudWxsID8gIm9uIiA6IGVsZW0udmFsdWU7CgkJfTsKCX0KfSk7CgoKCgovLyBSZXR1cm4galF1ZXJ5IGZvciBhdHRyaWJ1dGVzLW9ubHkgaW5jbHVzaW9uCgoKalF1ZXJ5LmVhY2goICgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgIiArCgkibW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgIiArCgkiY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIpLnNwbGl0KCIgIiksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCS8vIEhhbmRsZSBldmVudCBiaW5kaW5nCglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPwoJCQl0aGlzLm9uKCBuYW1lLCBudWxsLCBkYXRhLCBmbiApIDoKCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7Cgl9Owp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJaG92ZXI6IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkgewoJCXJldHVybiB0aGlzLm1vdXNlZW50ZXIoIGZuT3ZlciApLm1vdXNlbGVhdmUoIGZuT3V0IHx8IGZuT3ZlciApOwoJfSwKCgliaW5kOiBmdW5jdGlvbiggdHlwZXMsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgbnVsbCwgZGF0YSwgZm4gKTsKCX0sCgl1bmJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZm4gKSB7CgkJcmV0dXJuIHRoaXMub2ZmKCB0eXBlcywgbnVsbCwgZm4gKTsKCX0sCgoJZGVsZWdhdGU6IGZ1bmN0aW9uKCBzZWxlY3RvciwgdHlwZXMsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICk7Cgl9LAoJdW5kZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZm4gKSB7CgkJLy8gKCBuYW1lc3BhY2UgKSBvciAoIHNlbGVjdG9yLCB0eXBlcyBbLCBmbl0gKQoJCXJldHVybiBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gdGhpcy5vZmYoIHNlbGVjdG9yLCAiKioiICkgOiB0aGlzLm9mZiggdHlwZXMsIHNlbGVjdG9yIHx8ICIqKiIsIGZuICk7Cgl9Cn0pOwoKCnZhciBub25jZSA9IGpRdWVyeS5ub3coKTsKCnZhciBycXVlcnkgPSAoL1w/Lyk7CgoKCi8vIFN1cHBvcnQ6IEFuZHJvaWQgMi4zCi8vIFdvcmthcm91bmQgZmFpbHVyZSB0byBzdHJpbmctY2FzdCBudWxsIGlucHV0CmpRdWVyeS5wYXJzZUpTT04gPSBmdW5jdGlvbiggZGF0YSApIHsKCXJldHVybiBKU09OLnBhcnNlKCBkYXRhICsgIiIgKTsKfTsKCgovLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCmpRdWVyeS5wYXJzZVhNTCA9IGZ1bmN0aW9uKCBkYXRhICkgewoJdmFyIHhtbCwgdG1wOwoJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJcmV0dXJuIG51bGw7Cgl9CgoJLy8gU3VwcG9ydDogSUU5Cgl0cnkgewoJCXRtcCA9IG5ldyBET01QYXJzZXIoKTsKCQl4bWwgPSB0bXAucGFyc2VGcm9tU3RyaW5nKCBkYXRhLCAidGV4dC94bWwiICk7Cgl9IGNhdGNoICggZSApIHsKCQl4bWwgPSB1bmRlZmluZWQ7Cgl9CgoJaWYgKCAheG1sIHx8IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSggInBhcnNlcmVycm9yIiApLmxlbmd0aCApIHsKCQlqUXVlcnkuZXJyb3IoICJJbnZhbGlkIFhNTDogIiArIGRhdGEgKTsKCX0KCXJldHVybiB4bWw7Cn07CgoKdmFyCglyaGFzaCA9IC8jLiokLywKCXJ0cyA9IC8oWz8mXSlfPVteJl0qLywKCXJoZWFkZXJzID0gL14oLio/KTpbIFx0XSooW15cclxuXSopJC9tZywKCS8vICM3NjUzLCAjODEyNSwgIzgxNTI6IGxvY2FsIHByb3RvY29sIGRldGVjdGlvbgoJcmxvY2FsUHJvdG9jb2wgPSAvXig/OmFib3V0fGFwcHxhcHAtc3RvcmFnZXwuKy1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLywKCXJub0NvbnRlbnQgPSAvXig/OkdFVHxIRUFEKSQvLAoJcnByb3RvY29sID0gL15cL1wvLywKCXJ1cmwgPSAvXihbXHcuKy1dKzopKD86XC9cLyg/OlteXC8/I10qQHwpKFteXC8/IzpdKikoPzo6KFxkKyl8KXwpLywKCgkvKiBQcmVmaWx0ZXJzCgkgKiAxKSBUaGV5IGFyZSB1c2VmdWwgdG8gaW50cm9kdWNlIGN1c3RvbSBkYXRhVHlwZXMgKHNlZSBhamF4L2pzb25wLmpzIGZvciBhbiBleGFtcGxlKQoJICogMikgVGhlc2UgYXJlIGNhbGxlZDoKCSAqICAgIC0gQkVGT1JFIGFza2luZyBmb3IgYSB0cmFuc3BvcnQKCSAqICAgIC0gQUZURVIgcGFyYW0gc2VyaWFsaXphdGlvbiAocy5kYXRhIGlzIGEgc3RyaW5nIGlmIHMucHJvY2Vzc0RhdGEgaXMgdHJ1ZSkKCSAqIDMpIGtleSBpcyB0aGUgZGF0YVR5cGUKCSAqIDQpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCgkgKiA1KSBleGVjdXRpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBjb250aW51ZSBkb3duIHRvICIqIiBpZiBuZWVkZWQKCSAqLwoJcHJlZmlsdGVycyA9IHt9LAoKCS8qIFRyYW5zcG9ydHMgYmluZGluZ3MKCSAqIDEpIGtleSBpcyB0aGUgZGF0YVR5cGUKCSAqIDIpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCgkgKiAzKSBzZWxlY3Rpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBnbyB0byAiKiIgaWYgbmVlZGVkCgkgKi8KCXRyYW5zcG9ydHMgPSB7fSwKCgkvLyBBdm9pZCBjb21tZW50LXByb2xvZyBjaGFyIHNlcXVlbmNlICgjMTAwOTgpOyBtdXN0IGFwcGVhc2UgbGludCBhbmQgZXZhZGUgY29tcHJlc3Npb24KCWFsbFR5cGVzID0gIiovIi5jb25jYXQoICIqIiApLAoKCS8vIERvY3VtZW50IGxvY2F0aW9uCglhamF4TG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZiwKCgkvLyBTZWdtZW50IGxvY2F0aW9uIGludG8gcGFydHMKCWFqYXhMb2NQYXJ0cyA9IHJ1cmwuZXhlYyggYWpheExvY2F0aW9uLnRvTG93ZXJDYXNlKCkgKSB8fCBbXTsKCi8vIEJhc2UgImNvbnN0cnVjdG9yIiBmb3IgalF1ZXJ5LmFqYXhQcmVmaWx0ZXIgYW5kIGpRdWVyeS5hamF4VHJhbnNwb3J0CmZ1bmN0aW9uIGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlICkgewoKCS8vIGRhdGFUeXBlRXhwcmVzc2lvbiBpcyBvcHRpb25hbCBhbmQgZGVmYXVsdHMgdG8gIioiCglyZXR1cm4gZnVuY3Rpb24oIGRhdGFUeXBlRXhwcmVzc2lvbiwgZnVuYyApIHsKCgkJaWYgKCB0eXBlb2YgZGF0YVR5cGVFeHByZXNzaW9uICE9PSAic3RyaW5nIiApIHsKCQkJZnVuYyA9IGRhdGFUeXBlRXhwcmVzc2lvbjsKCQkJZGF0YVR5cGVFeHByZXNzaW9uID0gIioiOwoJCX0KCgkJdmFyIGRhdGFUeXBlLAoJCQlpID0gMCwKCQkJZGF0YVR5cGVzID0gZGF0YVR5cGVFeHByZXNzaW9uLnRvTG93ZXJDYXNlKCkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBmdW5jICkgKSB7CgkJCS8vIEZvciBlYWNoIGRhdGFUeXBlIGluIHRoZSBkYXRhVHlwZUV4cHJlc3Npb24KCQkJd2hpbGUgKCAoZGF0YVR5cGUgPSBkYXRhVHlwZXNbaSsrXSkgKSB7CgkJCQkvLyBQcmVwZW5kIGlmIHJlcXVlc3RlZAoJCQkJaWYgKCBkYXRhVHlwZVswXSA9PT0gIisiICkgewoJCQkJCWRhdGFUeXBlID0gZGF0YVR5cGUuc2xpY2UoIDEgKSB8fCAiKiI7CgkJCQkJKHN0cnVjdHVyZVsgZGF0YVR5cGUgXSA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSkudW5zaGlmdCggZnVuYyApOwoKCQkJCS8vIE90aGVyd2lzZSBhcHBlbmQKCQkJCX0gZWxzZSB7CgkJCQkJKHN0cnVjdHVyZVsgZGF0YVR5cGUgXSA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSkucHVzaCggZnVuYyApOwoJCQkJfQoJCQl9CgkJfQoJfTsKfQoKLy8gQmFzZSBpbnNwZWN0aW9uIGZ1bmN0aW9uIGZvciBwcmVmaWx0ZXJzIGFuZCB0cmFuc3BvcnRzCmZ1bmN0aW9uIGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUsIG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIgKSB7CgoJdmFyIGluc3BlY3RlZCA9IHt9LAoJCXNlZWtpbmdUcmFuc3BvcnQgPSAoIHN0cnVjdHVyZSA9PT0gdHJhbnNwb3J0cyApOwoKCWZ1bmN0aW9uIGluc3BlY3QoIGRhdGFUeXBlICkgewoJCXZhciBzZWxlY3RlZDsKCQlpbnNwZWN0ZWRbIGRhdGFUeXBlIF0gPSB0cnVlOwoJCWpRdWVyeS5lYWNoKCBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10sIGZ1bmN0aW9uKCBfLCBwcmVmaWx0ZXJPckZhY3RvcnkgKSB7CgkJCXZhciBkYXRhVHlwZU9yVHJhbnNwb3J0ID0gcHJlZmlsdGVyT3JGYWN0b3J5KCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSICk7CgkJCWlmICggdHlwZW9mIGRhdGFUeXBlT3JUcmFuc3BvcnQgPT09ICJzdHJpbmciICYmICFzZWVraW5nVHJhbnNwb3J0ICYmICFpbnNwZWN0ZWRbIGRhdGFUeXBlT3JUcmFuc3BvcnQgXSApIHsKCQkJCW9wdGlvbnMuZGF0YVR5cGVzLnVuc2hpZnQoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCWluc3BlY3QoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSBlbHNlIGlmICggc2Vla2luZ1RyYW5zcG9ydCApIHsKCQkJCXJldHVybiAhKCBzZWxlY3RlZCA9IGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJfQoJCX0pOwoJCXJldHVybiBzZWxlY3RlZDsKCX0KCglyZXR1cm4gaW5zcGVjdCggb3B0aW9ucy5kYXRhVHlwZXNbIDAgXSApIHx8ICFpbnNwZWN0ZWRbICIqIiBdICYmIGluc3BlY3QoICIqIiApOwp9CgovLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKLy8gdGhhdCB0YWtlcyAiZmxhdCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpCi8vIEZpeGVzICM5ODg3CmZ1bmN0aW9uIGFqYXhFeHRlbmQoIHRhcmdldCwgc3JjICkgewoJdmFyIGtleSwgZGVlcCwKCQlmbGF0T3B0aW9ucyA9IGpRdWVyeS5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307CgoJZm9yICgga2V5IGluIHNyYyApIHsKCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKGRlZXAgPSB7fSkgKSApWyBrZXkgXSA9IHNyY1sga2V5IF07CgkJfQoJfQoJaWYgKCBkZWVwICkgewoJCWpRdWVyeS5leHRlbmQoIHRydWUsIHRhcmdldCwgZGVlcCApOwoJfQoKCXJldHVybiB0YXJnZXQ7Cn0KCi8qIEhhbmRsZXMgcmVzcG9uc2VzIHRvIGFuIGFqYXggcmVxdWVzdDoKICogLSBmaW5kcyB0aGUgcmlnaHQgZGF0YVR5cGUgKG1lZGlhdGVzIGJldHdlZW4gY29udGVudC10eXBlIGFuZCBleHBlY3RlZCBkYXRhVHlwZSkKICogLSByZXR1cm5zIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlCiAqLwpmdW5jdGlvbiBhamF4SGFuZGxlUmVzcG9uc2VzKCBzLCBqcVhIUiwgcmVzcG9uc2VzICkgewoKCXZhciBjdCwgdHlwZSwgZmluYWxEYXRhVHlwZSwgZmlyc3REYXRhVHlwZSwKCQljb250ZW50cyA9IHMuY29udGVudHMsCgkJZGF0YVR5cGVzID0gcy5kYXRhVHlwZXM7CgoJLy8gUmVtb3ZlIGF1dG8gZGF0YVR5cGUgYW5kIGdldCBjb250ZW50LXR5cGUgaW4gdGhlIHByb2Nlc3MKCXdoaWxlICggZGF0YVR5cGVzWyAwIF0gPT09ICIqIiApIHsKCQlkYXRhVHlwZXMuc2hpZnQoKTsKCQlpZiAoIGN0ID09PSB1bmRlZmluZWQgKSB7CgkJCWN0ID0gcy5taW1lVHlwZSB8fCBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1UeXBlIik7CgkJfQoJfQoKCS8vIENoZWNrIGlmIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIGtub3duIGNvbnRlbnQtdHlwZQoJaWYgKCBjdCApIHsKCQlmb3IgKCB0eXBlIGluIGNvbnRlbnRzICkgewoJCQlpZiAoIGNvbnRlbnRzWyB0eXBlIF0gJiYgY29udGVudHNbIHR5cGUgXS50ZXN0KCBjdCApICkgewoJCQkJZGF0YVR5cGVzLnVuc2hpZnQoIHR5cGUgKTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoKCS8vIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcmVzcG9uc2UgZm9yIHRoZSBleHBlY3RlZCBkYXRhVHlwZQoJaWYgKCBkYXRhVHlwZXNbIDAgXSBpbiByZXNwb25zZXMgKSB7CgkJZmluYWxEYXRhVHlwZSA9IGRhdGFUeXBlc1sgMCBdOwoJfSBlbHNlIHsKCQkvLyBUcnkgY29udmVydGlibGUgZGF0YVR5cGVzCgkJZm9yICggdHlwZSBpbiByZXNwb25zZXMgKSB7CgkJCWlmICggIWRhdGFUeXBlc1sgMCBdIHx8IHMuY29udmVydGVyc1sgdHlwZSArICIgIiArIGRhdGFUeXBlc1swXSBdICkgewoJCQkJZmluYWxEYXRhVHlwZSA9IHR5cGU7CgkJCQlicmVhazsKCQkJfQoJCQlpZiAoICFmaXJzdERhdGFUeXBlICkgewoJCQkJZmlyc3REYXRhVHlwZSA9IHR5cGU7CgkJCX0KCQl9CgkJLy8gT3IganVzdCB1c2UgZmlyc3Qgb25lCgkJZmluYWxEYXRhVHlwZSA9IGZpbmFsRGF0YVR5cGUgfHwgZmlyc3REYXRhVHlwZTsKCX0KCgkvLyBJZiB3ZSBmb3VuZCBhIGRhdGFUeXBlCgkvLyBXZSBhZGQgdGhlIGRhdGFUeXBlIHRvIHRoZSBsaXN0IGlmIG5lZWRlZAoJLy8gYW5kIHJldHVybiB0aGUgY29ycmVzcG9uZGluZyByZXNwb25zZQoJaWYgKCBmaW5hbERhdGFUeXBlICkgewoJCWlmICggZmluYWxEYXRhVHlwZSAhPT0gZGF0YVR5cGVzWyAwIF0gKSB7CgkJCWRhdGFUeXBlcy51bnNoaWZ0KCBmaW5hbERhdGFUeXBlICk7CgkJfQoJCXJldHVybiByZXNwb25zZXNbIGZpbmFsRGF0YVR5cGUgXTsKCX0KfQoKLyogQ2hhaW4gY29udmVyc2lvbnMgZ2l2ZW4gdGhlIHJlcXVlc3QgYW5kIHRoZSBvcmlnaW5hbCByZXNwb25zZQogKiBBbHNvIHNldHMgdGhlIHJlc3BvbnNlWFhYIGZpZWxkcyBvbiB0aGUganFYSFIgaW5zdGFuY2UKICovCmZ1bmN0aW9uIGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSwganFYSFIsIGlzU3VjY2VzcyApIHsKCXZhciBjb252MiwgY3VycmVudCwgY29udiwgdG1wLCBwcmV2LAoJCWNvbnZlcnRlcnMgPSB7fSwKCQkvLyBXb3JrIHdpdGggYSBjb3B5IG9mIGRhdGFUeXBlcyBpbiBjYXNlIHdlIG5lZWQgdG8gbW9kaWZ5IGl0IGZvciBjb252ZXJzaW9uCgkJZGF0YVR5cGVzID0gcy5kYXRhVHlwZXMuc2xpY2UoKTsKCgkvLyBDcmVhdGUgY29udmVydGVycyBtYXAgd2l0aCBsb3dlcmNhc2VkIGtleXMKCWlmICggZGF0YVR5cGVzWyAxIF0gKSB7CgkJZm9yICggY29udiBpbiBzLmNvbnZlcnRlcnMgKSB7CgkJCWNvbnZlcnRlcnNbIGNvbnYudG9Mb3dlckNhc2UoKSBdID0gcy5jb252ZXJ0ZXJzWyBjb252IF07CgkJfQoJfQoKCWN1cnJlbnQgPSBkYXRhVHlwZXMuc2hpZnQoKTsKCgkvLyBDb252ZXJ0IHRvIGVhY2ggc2VxdWVudGlhbCBkYXRhVHlwZQoJd2hpbGUgKCBjdXJyZW50ICkgewoKCQlpZiAoIHMucmVzcG9uc2VGaWVsZHNbIGN1cnJlbnQgXSApIHsKCQkJanFYSFJbIHMucmVzcG9uc2VGaWVsZHNbIGN1cnJlbnQgXSBdID0gcmVzcG9uc2U7CgkJfQoKCQkvLyBBcHBseSB0aGUgZGF0YUZpbHRlciBpZiBwcm92aWRlZAoJCWlmICggIXByZXYgJiYgaXNTdWNjZXNzICYmIHMuZGF0YUZpbHRlciApIHsKCQkJcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIoIHJlc3BvbnNlLCBzLmRhdGFUeXBlICk7CgkJfQoKCQlwcmV2ID0gY3VycmVudDsKCQljdXJyZW50ID0gZGF0YVR5cGVzLnNoaWZ0KCk7CgoJCWlmICggY3VycmVudCApIHsKCgkJLy8gVGhlcmUncyBvbmx5IHdvcmsgdG8gZG8gaWYgY3VycmVudCBkYXRhVHlwZSBpcyBub24tYXV0bwoJCQlpZiAoIGN1cnJlbnQgPT09ICIqIiApIHsKCgkJCQljdXJyZW50ID0gcHJldjsKCgkJCS8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKCQkJfSBlbHNlIGlmICggcHJldiAhPT0gIioiICYmIHByZXYgIT09IGN1cnJlbnQgKSB7CgoJCQkJLy8gU2VlayBhIGRpcmVjdCBjb252ZXJ0ZXIKCQkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBwcmV2ICsgIiAiICsgY3VycmVudCBdIHx8IGNvbnZlcnRlcnNbICIqICIgKyBjdXJyZW50IF07CgoJCQkJLy8gSWYgbm9uZSBmb3VuZCwgc2VlayBhIHBhaXIKCQkJCWlmICggIWNvbnYgKSB7CgkJCQkJZm9yICggY29udjIgaW4gY29udmVydGVycyApIHsKCgkJCQkJCS8vIElmIGNvbnYyIG91dHB1dHMgY3VycmVudAoJCQkJCQl0bXAgPSBjb252Mi5zcGxpdCggIiAiICk7CgkJCQkJCWlmICggdG1wWyAxIF0gPT09IGN1cnJlbnQgKSB7CgoJCQkJCQkJLy8gSWYgcHJldiBjYW4gYmUgY29udmVydGVkIHRvIGFjY2VwdGVkIGlucHV0CgkJCQkJCQljb252ID0gY29udmVydGVyc1sgcHJldiArICIgIiArIHRtcFsgMCBdIF0gfHwKCQkJCQkJCQljb252ZXJ0ZXJzWyAiKiAiICsgdG1wWyAwIF0gXTsKCQkJCQkJCWlmICggY29udiApIHsKCQkJCQkJCQkvLyBDb25kZW5zZSBlcXVpdmFsZW5jZSBjb252ZXJ0ZXJzCgkJCQkJCQkJaWYgKCBjb252ID09PSB0cnVlICkgewoJCQkJCQkJCQljb252ID0gY29udmVydGVyc1sgY29udjIgXTsKCgkJCQkJCQkJLy8gT3RoZXJ3aXNlLCBpbnNlcnQgdGhlIGludGVybWVkaWF0ZSBkYXRhVHlwZQoJCQkJCQkJCX0gZWxzZSBpZiAoIGNvbnZlcnRlcnNbIGNvbnYyIF0gIT09IHRydWUgKSB7CgkJCQkJCQkJCWN1cnJlbnQgPSB0bXBbIDAgXTsKCQkJCQkJCQkJZGF0YVR5cGVzLnVuc2hpZnQoIHRtcFsgMSBdICk7CgkJCQkJCQkJfQoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoKCQkJCS8vIEFwcGx5IGNvbnZlcnRlciAoaWYgbm90IGFuIGVxdWl2YWxlbmNlKQoJCQkJaWYgKCBjb252ICE9PSB0cnVlICkgewoKCQkJCQkvLyBVbmxlc3MgZXJyb3JzIGFyZSBhbGxvd2VkIHRvIGJ1YmJsZSwgY2F0Y2ggYW5kIHJldHVybiB0aGVtCgkJCQkJaWYgKCBjb252ICYmIHNbICJ0aHJvd3MiIF0gKSB7CgkJCQkJCXJlc3BvbnNlID0gY29udiggcmVzcG9uc2UgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl0cnkgewoJCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCQl9IGNhdGNoICggZSApIHsKCQkJCQkJCXJldHVybiB7IHN0YXRlOiAicGFyc2VyZXJyb3IiLCBlcnJvcjogY29udiA/IGUgOiAiTm8gY29udmVyc2lvbiBmcm9tICIgKyBwcmV2ICsgIiB0byAiICsgY3VycmVudCB9OwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiB7IHN0YXRlOiAic3VjY2VzcyIsIGRhdGE6IHJlc3BvbnNlIH07Cn0KCmpRdWVyeS5leHRlbmQoewoKCS8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcwoJYWN0aXZlOiAwLAoKCS8vIExhc3QtTW9kaWZpZWQgaGVhZGVyIGNhY2hlIGZvciBuZXh0IHJlcXVlc3QKCWxhc3RNb2RpZmllZDoge30sCglldGFnOiB7fSwKCglhamF4U2V0dGluZ3M6IHsKCQl1cmw6IGFqYXhMb2NhdGlvbiwKCQl0eXBlOiAiR0VUIiwKCQlpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KCBhamF4TG9jUGFydHNbIDEgXSApLAoJCWdsb2JhbDogdHJ1ZSwKCQlwcm9jZXNzRGF0YTogdHJ1ZSwKCQlhc3luYzogdHJ1ZSwKCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsCgkJLyoKCQl0aW1lb3V0OiAwLAoJCWRhdGE6IG51bGwsCgkJZGF0YVR5cGU6IG51bGwsCgkJdXNlcm5hbWU6IG51bGwsCgkJcGFzc3dvcmQ6IG51bGwsCgkJY2FjaGU6IG51bGwsCgkJdGhyb3dzOiBmYWxzZSwKCQl0cmFkaXRpb25hbDogZmFsc2UsCgkJaGVhZGVyczoge30sCgkJKi8KCgkJYWNjZXB0czogewoJCQkiKiI6IGFsbFR5cGVzLAoJCQl0ZXh0OiAidGV4dC9wbGFpbiIsCgkJCWh0bWw6ICJ0ZXh0L2h0bWwiLAoJCQl4bWw6ICJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIiwKCQkJanNvbjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIKCQl9LAoKCQljb250ZW50czogewoJCQl4bWw6IC94bWwvLAoJCQlodG1sOiAvaHRtbC8sCgkJCWpzb246IC9qc29uLwoJCX0sCgoJCXJlc3BvbnNlRmllbGRzOiB7CgkJCXhtbDogInJlc3BvbnNlWE1MIiwKCQkJdGV4dDogInJlc3BvbnNlVGV4dCIsCgkJCWpzb246ICJyZXNwb25zZUpTT04iCgkJfSwKCgkJLy8gRGF0YSBjb252ZXJ0ZXJzCgkJLy8gS2V5cyBzZXBhcmF0ZSBzb3VyY2UgKG9yIGNhdGNoYWxsICIqIikgYW5kIGRlc3RpbmF0aW9uIHR5cGVzIHdpdGggYSBzaW5nbGUgc3BhY2UKCQljb252ZXJ0ZXJzOiB7CgoJCQkvLyBDb252ZXJ0IGFueXRoaW5nIHRvIHRleHQKCQkJIiogdGV4dCI6IFN0cmluZywKCgkJCS8vIFRleHQgdG8gaHRtbCAodHJ1ZSA9IG5vIHRyYW5zZm9ybWF0aW9uKQoJCQkidGV4dCBodG1sIjogdHJ1ZSwKCgkJCS8vIEV2YWx1YXRlIHRleHQgYXMgYSBqc29uIGV4cHJlc3Npb24KCQkJInRleHQganNvbiI6IGpRdWVyeS5wYXJzZUpTT04sCgoJCQkvLyBQYXJzZSB0ZXh0IGFzIHhtbAoJCQkidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKCQl9LAoKCQkvLyBGb3Igb3B0aW9ucyB0aGF0IHNob3VsZG4ndCBiZSBkZWVwIGV4dGVuZGVkOgoJCS8vIHlvdSBjYW4gYWRkIHlvdXIgb3duIGN1c3RvbSBvcHRpb25zIGhlcmUgaWYKCQkvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQoJCS8vIGRlZXAgZXh0ZW5kZWQgKHNlZSBhamF4RXh0ZW5kKQoJCWZsYXRPcHRpb25zOiB7CgkJCXVybDogdHJ1ZSwKCQkJY29udGV4dDogdHJ1ZQoJCX0KCX0sCgoJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCS8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KCS8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCglhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCXJldHVybiBzZXR0aW5ncyA/CgoJCQkvLyBCdWlsZGluZyBhIHNldHRpbmdzIG9iamVjdAoJCQlhamF4RXh0ZW5kKCBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKSwgc2V0dGluZ3MgKSA6CgoJCQkvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCgkJCWFqYXhFeHRlbmQoIGpRdWVyeS5hamF4U2V0dGluZ3MsIHRhcmdldCApOwoJfSwKCglhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMgKSwKCWFqYXhUcmFuc3BvcnQ6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cyApLAoKCS8vIE1haW4gbWV0aG9kCglhamF4OiBmdW5jdGlvbiggdXJsLCBvcHRpb25zICkgewoKCQkvLyBJZiB1cmwgaXMgYW4gb2JqZWN0LCBzaW11bGF0ZSBwcmUtMS41IHNpZ25hdHVyZQoJCWlmICggdHlwZW9mIHVybCA9PT0gIm9iamVjdCIgKSB7CgkJCW9wdGlvbnMgPSB1cmw7CgkJCXVybCA9IHVuZGVmaW5lZDsKCQl9CgoJCS8vIEZvcmNlIG9wdGlvbnMgdG8gYmUgYW4gb2JqZWN0CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCXZhciB0cmFuc3BvcnQsCgkJCS8vIFVSTCB3aXRob3V0IGFudGktY2FjaGUgcGFyYW0KCQkJY2FjaGVVUkwsCgkJCS8vIFJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nLAoJCQlyZXNwb25zZUhlYWRlcnMsCgkJCS8vIHRpbWVvdXQgaGFuZGxlCgkJCXRpbWVvdXRUaW1lciwKCQkJLy8gQ3Jvc3MtZG9tYWluIGRldGVjdGlvbiB2YXJzCgkJCXBhcnRzLAoJCQkvLyBUbyBrbm93IGlmIGdsb2JhbCBldmVudHMgYXJlIHRvIGJlIGRpc3BhdGNoZWQKCQkJZmlyZUdsb2JhbHMsCgkJCS8vIExvb3AgdmFyaWFibGUKCQkJaSwKCQkJLy8gQ3JlYXRlIHRoZSBmaW5hbCBvcHRpb25zIG9iamVjdAoJCQlzID0galF1ZXJ5LmFqYXhTZXR1cCgge30sIG9wdGlvbnMgKSwKCQkJLy8gQ2FsbGJhY2tzIGNvbnRleHQKCQkJY2FsbGJhY2tDb250ZXh0ID0gcy5jb250ZXh0IHx8IHMsCgkJCS8vIENvbnRleHQgZm9yIGdsb2JhbCBldmVudHMgaXMgY2FsbGJhY2tDb250ZXh0IGlmIGl0IGlzIGEgRE9NIG5vZGUgb3IgalF1ZXJ5IGNvbGxlY3Rpb24KCQkJZ2xvYmFsRXZlbnRDb250ZXh0ID0gcy5jb250ZXh0ICYmICggY2FsbGJhY2tDb250ZXh0Lm5vZGVUeXBlIHx8IGNhbGxiYWNrQ29udGV4dC5qcXVlcnkgKSA/CgkJCQlqUXVlcnkoIGNhbGxiYWNrQ29udGV4dCApIDoKCQkJCWpRdWVyeS5ldmVudCwKCQkJLy8gRGVmZXJyZWRzCgkJCWRlZmVycmVkID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLAoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlzdGF0dXNDb2RlID0gcy5zdGF0dXNDb2RlIHx8IHt9LAoJCQkvLyBIZWFkZXJzICh0aGV5IGFyZSBzZW50IGFsbCBhdCBvbmNlKQoJCQlyZXF1ZXN0SGVhZGVycyA9IHt9LAoJCQlyZXF1ZXN0SGVhZGVyc05hbWVzID0ge30sCgkJCS8vIFRoZSBqcVhIUiBzdGF0ZQoJCQlzdGF0ZSA9IDAsCgkJCS8vIERlZmF1bHQgYWJvcnQgbWVzc2FnZQoJCQlzdHJBYm9ydCA9ICJjYW5jZWxlZCIsCgkJCS8vIEZha2UgeGhyCgkJCWpxWEhSID0gewoJCQkJcmVhZHlTdGF0ZTogMCwKCgkJCQkvLyBCdWlsZHMgaGVhZGVycyBoYXNodGFibGUgaWYgbmVlZGVkCgkJCQlnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24oIGtleSApIHsKCQkJCQl2YXIgbWF0Y2g7CgkJCQkJaWYgKCBzdGF0ZSA9PT0gMiApIHsKCQkJCQkJaWYgKCAhcmVzcG9uc2VIZWFkZXJzICkgewoJCQkJCQkJcmVzcG9uc2VIZWFkZXJzID0ge307CgkJCQkJCQl3aGlsZSAoIChtYXRjaCA9IHJoZWFkZXJzLmV4ZWMoIHJlc3BvbnNlSGVhZGVyc1N0cmluZyApKSApIHsKCQkJCQkJCQlyZXNwb25zZUhlYWRlcnNbIG1hdGNoWzFdLnRvTG93ZXJDYXNlKCkgXSA9IG1hdGNoWyAyIF07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJbWF0Y2ggPSByZXNwb25zZUhlYWRlcnNbIGtleS50b0xvd2VyQ2FzZSgpIF07CgkJCQkJfQoJCQkJCXJldHVybiBtYXRjaCA9PSBudWxsID8gbnVsbCA6IG1hdGNoOwoJCQkJfSwKCgkJCQkvLyBSYXcgc3RyaW5nCgkJCQlnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBzdGF0ZSA9PT0gMiA/IHJlc3BvbnNlSGVhZGVyc1N0cmluZyA6IG51bGw7CgkJCQl9LAoKCQkJCS8vIENhY2hlcyB0aGUgaGVhZGVyCgkJCQlzZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7CgkJCQkJdmFyIGxuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJCQkJCWlmICggIXN0YXRlICkgewoJCQkJCQluYW1lID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSA9IHJlcXVlc3RIZWFkZXJzTmFtZXNbIGxuYW1lIF0gfHwgbmFtZTsKCQkJCQkJcmVxdWVzdEhlYWRlcnNbIG5hbWUgXSA9IHZhbHVlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gT3ZlcnJpZGVzIHJlc3BvbnNlIGNvbnRlbnQtdHlwZSBoZWFkZXIKCQkJCW92ZXJyaWRlTWltZVR5cGU6IGZ1bmN0aW9uKCB0eXBlICkgewoJCQkJCWlmICggIXN0YXRlICkgewoJCQkJCQlzLm1pbWVUeXBlID0gdHlwZTsKCQkJCQl9CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoKCQkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCQlzdGF0dXNDb2RlOiBmdW5jdGlvbiggbWFwICkgewoJCQkJCXZhciBjb2RlOwoJCQkJCWlmICggbWFwICkgewoJCQkJCQlpZiAoIHN0YXRlIDwgMiApIHsKCQkJCQkJCWZvciAoIGNvZGUgaW4gbWFwICkgewoJCQkJCQkJCS8vIExhenktYWRkIHRoZSBuZXcgY2FsbGJhY2sgaW4gYSB3YXkgdGhhdCBwcmVzZXJ2ZXMgb2xkIG9uZXMKCQkJCQkJCQlzdGF0dXNDb2RlWyBjb2RlIF0gPSBbIHN0YXR1c0NvZGVbIGNvZGUgXSwgbWFwWyBjb2RlIF0gXTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCS8vIEV4ZWN1dGUgdGhlIGFwcHJvcHJpYXRlIGNhbGxiYWNrcwoJCQkJCQkJanFYSFIuYWx3YXlzKCBtYXBbIGpxWEhSLnN0YXR1cyBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoKCQkJCS8vIENhbmNlbCB0aGUgcmVxdWVzdAoJCQkJYWJvcnQ6IGZ1bmN0aW9uKCBzdGF0dXNUZXh0ICkgewoJCQkJCXZhciBmaW5hbFRleHQgPSBzdGF0dXNUZXh0IHx8IHN0ckFib3J0OwoJCQkJCWlmICggdHJhbnNwb3J0ICkgewoJCQkJCQl0cmFuc3BvcnQuYWJvcnQoIGZpbmFsVGV4dCApOwoJCQkJCX0KCQkJCQlkb25lKCAwLCBmaW5hbFRleHQgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCQkJfTsKCgkJLy8gQXR0YWNoIGRlZmVycmVkcwoJCWRlZmVycmVkLnByb21pc2UoIGpxWEhSICkuY29tcGxldGUgPSBjb21wbGV0ZURlZmVycmVkLmFkZDsKCQlqcVhIUi5zdWNjZXNzID0ganFYSFIuZG9uZTsKCQlqcVhIUi5lcnJvciA9IGpxWEhSLmZhaWw7CgoJCS8vIFJlbW92ZSBoYXNoIGNoYXJhY3RlciAoIzc1MzE6IGFuZCBzdHJpbmcgcHJvbW90aW9uKQoJCS8vIEFkZCBwcm90b2NvbCBpZiBub3QgcHJvdmlkZWQgKHByZWZpbHRlcnMgbWlnaHQgZXhwZWN0IGl0KQoJCS8vIEhhbmRsZSBmYWxzeSB1cmwgaW4gdGhlIHNldHRpbmdzIG9iamVjdCAoIzEwMDkzOiBjb25zaXN0ZW5jeSB3aXRoIG9sZCBzaWduYXR1cmUpCgkJLy8gV2UgYWxzbyB1c2UgdGhlIHVybCBwYXJhbWV0ZXIgaWYgYXZhaWxhYmxlCgkJcy51cmwgPSAoICggdXJsIHx8IHMudXJsIHx8IGFqYXhMb2NhdGlvbiApICsgIiIgKS5yZXBsYWNlKCByaGFzaCwgIiIgKQoJCQkucmVwbGFjZSggcnByb3RvY29sLCBhamF4TG9jUGFydHNbIDEgXSArICIvLyIgKTsKCgkJLy8gQWxpYXMgbWV0aG9kIG9wdGlvbiB0byB0eXBlIGFzIHBlciB0aWNrZXQgIzEyMDA0CgkJcy50eXBlID0gb3B0aW9ucy5tZXRob2QgfHwgb3B0aW9ucy50eXBlIHx8IHMubWV0aG9kIHx8IHMudHlwZTsKCgkJLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAoJCXMuZGF0YVR5cGVzID0galF1ZXJ5LnRyaW0oIHMuZGF0YVR5cGUgfHwgIioiICkudG9Mb3dlckNhc2UoKS5tYXRjaCggcm5vdHdoaXRlICkgfHwgWyAiIiBdOwoKCQkvLyBBIGNyb3NzLWRvbWFpbiByZXF1ZXN0IGlzIGluIG9yZGVyIHdoZW4gd2UgaGF2ZSBhIHByb3RvY29sOmhvc3Q6cG9ydCBtaXNtYXRjaAoJCWlmICggcy5jcm9zc0RvbWFpbiA9PSBudWxsICkgewoJCQlwYXJ0cyA9IHJ1cmwuZXhlYyggcy51cmwudG9Mb3dlckNhc2UoKSApOwoJCQlzLmNyb3NzRG9tYWluID0gISEoIHBhcnRzICYmCgkJCQkoIHBhcnRzWyAxIF0gIT09IGFqYXhMb2NQYXJ0c1sgMSBdIHx8IHBhcnRzWyAyIF0gIT09IGFqYXhMb2NQYXJ0c1sgMiBdIHx8CgkJCQkJKCBwYXJ0c1sgMyBdIHx8ICggcGFydHNbIDEgXSA9PT0gImh0dHA6IiA/ICI4MCIgOiAiNDQzIiApICkgIT09CgkJCQkJCSggYWpheExvY1BhcnRzWyAzIF0gfHwgKCBhamF4TG9jUGFydHNbIDEgXSA9PT0gImh0dHA6IiA/ICI4MCIgOiAiNDQzIiApICkgKQoJCQkpOwoJCX0KCgkJLy8gQ29udmVydCBkYXRhIGlmIG5vdCBhbHJlYWR5IGEgc3RyaW5nCgkJaWYgKCBzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9PSAic3RyaW5nIiApIHsKCQkJcy5kYXRhID0galF1ZXJ5LnBhcmFtKCBzLmRhdGEsIHMudHJhZGl0aW9uYWwgKTsKCQl9CgoJCS8vIEFwcGx5IHByZWZpbHRlcnMKCQlpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgcmVxdWVzdCB3YXMgYWJvcnRlZCBpbnNpZGUgYSBwcmVmaWx0ZXIsIHN0b3AgdGhlcmUKCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQlyZXR1cm4ganFYSFI7CgkJfQoKCQkvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoJCS8vIERvbid0IGZpcmUgZXZlbnRzIGlmIGpRdWVyeS5ldmVudCBpcyB1bmRlZmluZWQgaW4gYW4gQU1ELXVzYWdlIHNjZW5hcmlvICgjMTUxMTgpCgkJZmlyZUdsb2JhbHMgPSBqUXVlcnkuZXZlbnQgJiYgcy5nbG9iYWw7CgoJCS8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMKCQlpZiAoIGZpcmVHbG9iYWxzICYmIGpRdWVyeS5hY3RpdmUrKyA9PT0gMCApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpOwoJCX0KCgkJLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgkJcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7CgoJCS8vIERldGVybWluZSBpZiByZXF1ZXN0IGhhcyBjb250ZW50CgkJcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7CgoJCS8vIFNhdmUgdGhlIFVSTCBpbiBjYXNlIHdlJ3JlIHRveWluZyB3aXRoIHRoZSBJZi1Nb2RpZmllZC1TaW5jZQoJCS8vIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciBsYXRlciBvbgoJCWNhY2hlVVJMID0gcy51cmw7CgoJCS8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50CgkJaWYgKCAhcy5oYXNDb250ZW50ICkgewoKCQkJLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUsIGFwcGVuZCBkYXRhIHRvIHVybAoJCQlpZiAoIHMuZGF0YSApIHsKCQkJCWNhY2hlVVJMID0gKCBzLnVybCArPSAoIHJxdWVyeS50ZXN0KCBjYWNoZVVSTCApID8gIiYiIDogIj8iICkgKyBzLmRhdGEgKTsKCQkJCS8vICM5NjgyOiByZW1vdmUgZGF0YSBzbyB0aGF0IGl0J3Mgbm90IHVzZWQgaW4gYW4gZXZlbnR1YWwgcmV0cnkKCQkJCWRlbGV0ZSBzLmRhdGE7CgkJCX0KCgkJCS8vIEFkZCBhbnRpLWNhY2hlIGluIHVybCBpZiBuZWVkZWQKCQkJaWYgKCBzLmNhY2hlID09PSBmYWxzZSApIHsKCQkJCXMudXJsID0gcnRzLnRlc3QoIGNhY2hlVVJMICkgPwoKCQkJCQkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IGEgJ18nIHBhcmFtZXRlciwgc2V0IGl0cyB2YWx1ZQoJCQkJCWNhY2hlVVJMLnJlcGxhY2UoIHJ0cywgIiQxXz0iICsgbm9uY2UrKyApIDoKCgkJCQkJLy8gT3RoZXJ3aXNlIGFkZCBvbmUgdG8gdGhlIGVuZAoJCQkJCWNhY2hlVVJMICsgKCBycXVlcnkudGVzdCggY2FjaGVVUkwgKSA/ICImIiA6ICI/IiApICsgIl89IiArIG5vbmNlKys7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCgkJaWYgKCBzLmlmTW9kaWZpZWQgKSB7CgkJCWlmICggalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApIHsKCQkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoICJJZi1Nb2RpZmllZC1TaW5jZSIsIGpRdWVyeS5sYXN0TW9kaWZpZWRbIGNhY2hlVVJMIF0gKTsKCQkJfQoJCQlpZiAoIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU5vbmUtTWF0Y2giLCBqUXVlcnkuZXRhZ1sgY2FjaGVVUkwgXSApOwoJCQl9CgkJfQoKCQkvLyBTZXQgdGhlIGNvcnJlY3QgaGVhZGVyLCBpZiBkYXRhIGlzIGJlaW5nIHNlbnQKCQlpZiAoIHMuZGF0YSAmJiBzLmhhc0NvbnRlbnQgJiYgcy5jb250ZW50VHlwZSAhPT0gZmFsc2UgfHwgb3B0aW9ucy5jb250ZW50VHlwZSApIHsKCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIkNvbnRlbnQtVHlwZSIsIHMuY29udGVudFR5cGUgKTsKCQl9CgoJCS8vIFNldCB0aGUgQWNjZXB0cyBoZWFkZXIgZm9yIHRoZSBzZXJ2ZXIsIGRlcGVuZGluZyBvbiB0aGUgZGF0YVR5cGUKCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKAoJCQkiQWNjZXB0IiwKCQkJcy5kYXRhVHlwZXNbIDAgXSAmJiBzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gPwoJCQkJcy5hY2NlcHRzWyBzLmRhdGFUeXBlc1swXSBdICsgKCBzLmRhdGFUeXBlc1sgMCBdICE9PSAiKiIgPyAiLCAiICsgYWxsVHlwZXMgKyAiOyBxPTAuMDEiIDogIiIgKSA6CgkJCQlzLmFjY2VwdHNbICIqIiBdCgkJKTsKCgkJLy8gQ2hlY2sgZm9yIGhlYWRlcnMgb3B0aW9uCgkJZm9yICggaSBpbiBzLmhlYWRlcnMgKSB7CgkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIGksIHMuaGVhZGVyc1sgaSBdICk7CgkJfQoKCQkvLyBBbGxvdyBjdXN0b20gaGVhZGVycy9taW1ldHlwZXMgYW5kIGVhcmx5IGFib3J0CgkJaWYgKCBzLmJlZm9yZVNlbmQgJiYgKCBzLmJlZm9yZVNlbmQuY2FsbCggY2FsbGJhY2tDb250ZXh0LCBqcVhIUiwgcyApID09PSBmYWxzZSB8fCBzdGF0ZSA9PT0gMiApICkgewoJCQkvLyBBYm9ydCBpZiBub3QgZG9uZSBhbHJlYWR5IGFuZCByZXR1cm4KCQkJcmV0dXJuIGpxWEhSLmFib3J0KCk7CgkJfQoKCQkvLyBBYm9ydGluZyBpcyBubyBsb25nZXIgYSBjYW5jZWxsYXRpb24KCQlzdHJBYm9ydCA9ICJhYm9ydCI7CgoJCS8vIEluc3RhbGwgY2FsbGJhY2tzIG9uIGRlZmVycmVkcwoJCWZvciAoIGkgaW4geyBzdWNjZXNzOiAxLCBlcnJvcjogMSwgY29tcGxldGU6IDEgfSApIHsKCQkJanFYSFJbIGkgXSggc1sgaSBdICk7CgkJfQoKCQkvLyBHZXQgdHJhbnNwb3J0CgkJdHJhbnNwb3J0ID0gaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHRyYW5zcG9ydHMsIHMsIG9wdGlvbnMsIGpxWEhSICk7CgoJCS8vIElmIG5vIHRyYW5zcG9ydCwgd2UgYXV0by1hYm9ydAoJCWlmICggIXRyYW5zcG9ydCApIHsKCQkJZG9uZSggLTEsICJObyBUcmFuc3BvcnQiICk7CgkJfSBlbHNlIHsKCQkJanFYSFIucmVhZHlTdGF0ZSA9IDE7CgoJCQkvLyBTZW5kIGdsb2JhbCBldmVudAoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoICJhamF4U2VuZCIsIFsganFYSFIsIHMgXSApOwoJCQl9CgkJCS8vIFRpbWVvdXQKCQkJaWYgKCBzLmFzeW5jICYmIHMudGltZW91dCA+IDAgKSB7CgkJCQl0aW1lb3V0VGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJCWpxWEhSLmFib3J0KCJ0aW1lb3V0Iik7CgkJCQl9LCBzLnRpbWVvdXQgKTsKCQkJfQoKCQkJdHJ5IHsKCQkJCXN0YXRlID0gMTsKCQkJCXRyYW5zcG9ydC5zZW5kKCByZXF1ZXN0SGVhZGVycywgZG9uZSApOwoJCQl9IGNhdGNoICggZSApIHsKCQkJCS8vIFByb3BhZ2F0ZSBleGNlcHRpb24gYXMgZXJyb3IgaWYgbm90IGRvbmUKCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCWRvbmUoIC0xLCBlICk7CgkJCQkvLyBTaW1wbHkgcmV0aHJvdyBvdGhlcndpc2UKCQkJCX0gZWxzZSB7CgkJCQkJdGhyb3cgZTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gQ2FsbGJhY2sgZm9yIHdoZW4gZXZlcnl0aGluZyBpcyBkb25lCgkJZnVuY3Rpb24gZG9uZSggc3RhdHVzLCBuYXRpdmVTdGF0dXNUZXh0LCByZXNwb25zZXMsIGhlYWRlcnMgKSB7CgkJCXZhciBpc1N1Y2Nlc3MsIHN1Y2Nlc3MsIGVycm9yLCByZXNwb25zZSwgbW9kaWZpZWQsCgkJCQlzdGF0dXNUZXh0ID0gbmF0aXZlU3RhdHVzVGV4dDsKCgkJCS8vIENhbGxlZCBvbmNlCgkJCWlmICggc3RhdGUgPT09IDIgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIFN0YXRlIGlzICJkb25lIiBub3cKCQkJc3RhdGUgPSAyOwoKCQkJLy8gQ2xlYXIgdGltZW91dCBpZiBpdCBleGlzdHMKCQkJaWYgKCB0aW1lb3V0VGltZXIgKSB7CgkJCQljbGVhclRpbWVvdXQoIHRpbWVvdXRUaW1lciApOwoJCQl9CgoJCQkvLyBEZXJlZmVyZW5jZSB0cmFuc3BvcnQgZm9yIGVhcmx5IGdhcmJhZ2UgY29sbGVjdGlvbgoJCQkvLyAobm8gbWF0dGVyIGhvdyBsb25nIHRoZSBqcVhIUiBvYmplY3Qgd2lsbCBiZSB1c2VkKQoJCQl0cmFuc3BvcnQgPSB1bmRlZmluZWQ7CgoJCQkvLyBDYWNoZSByZXNwb25zZSBoZWFkZXJzCgkJCXJlc3BvbnNlSGVhZGVyc1N0cmluZyA9IGhlYWRlcnMgfHwgIiI7CgoJCQkvLyBTZXQgcmVhZHlTdGF0ZQoJCQlqcVhIUi5yZWFkeVN0YXRlID0gc3RhdHVzID4gMCA/IDQgOiAwOwoKCQkJLy8gRGV0ZXJtaW5lIGlmIHN1Y2Nlc3NmdWwKCQkJaXNTdWNjZXNzID0gc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAgfHwgc3RhdHVzID09PSAzMDQ7CgoJCQkvLyBHZXQgcmVzcG9uc2UgZGF0YQoJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCXJlc3BvbnNlID0gYWpheEhhbmRsZVJlc3BvbnNlcyggcywganFYSFIsIHJlc3BvbnNlcyApOwoJCQl9CgoJCQkvLyBDb252ZXJ0IG5vIG1hdHRlciB3aGF0ICh0aGF0IHdheSByZXNwb25zZVhYWCBmaWVsZHMgYXJlIGFsd2F5cyBzZXQpCgkJCXJlc3BvbnNlID0gYWpheENvbnZlcnQoIHMsIHJlc3BvbnNlLCBqcVhIUiwgaXNTdWNjZXNzICk7CgoJCQkvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZwoJCQlpZiAoIGlzU3VjY2VzcyApIHsKCgkJCQkvLyBTZXQgdGhlIElmLU1vZGlmaWVkLVNpbmNlIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciwgaWYgaW4gaWZNb2RpZmllZCBtb2RlLgoJCQkJaWYgKCBzLmlmTW9kaWZpZWQgKSB7CgkJCQkJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpOwoJCQkJCWlmICggbW9kaWZpZWQgKSB7CgkJCQkJCWpRdWVyeS5sYXN0TW9kaWZpZWRbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQkJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiZXRhZyIpOwoJCQkJCWlmICggbW9kaWZpZWQgKSB7CgkJCQkJCWpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdID0gbW9kaWZpZWQ7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIGlmIG5vIGNvbnRlbnQKCQkJCWlmICggc3RhdHVzID09PSAyMDQgfHwgcy50eXBlID09PSAiSEVBRCIgKSB7CgkJCQkJc3RhdHVzVGV4dCA9ICJub2NvbnRlbnQiOwoKCQkJCS8vIGlmIG5vdCBtb2RpZmllZAoJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAzMDQgKSB7CgkJCQkJc3RhdHVzVGV4dCA9ICJub3Rtb2RpZmllZCI7CgoJCQkJLy8gSWYgd2UgaGF2ZSBkYXRhLCBsZXQncyBjb252ZXJ0IGl0CgkJCQl9IGVsc2UgewoJCQkJCXN0YXR1c1RleHQgPSByZXNwb25zZS5zdGF0ZTsKCQkJCQlzdWNjZXNzID0gcmVzcG9uc2UuZGF0YTsKCQkJCQllcnJvciA9IHJlc3BvbnNlLmVycm9yOwoJCQkJCWlzU3VjY2VzcyA9ICFlcnJvcjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIEV4dHJhY3QgZXJyb3IgZnJvbSBzdGF0dXNUZXh0IGFuZCBub3JtYWxpemUgZm9yIG5vbi1hYm9ydHMKCQkJCWVycm9yID0gc3RhdHVzVGV4dDsKCQkJCWlmICggc3RhdHVzIHx8ICFzdGF0dXNUZXh0ICkgewoJCQkJCXN0YXR1c1RleHQgPSAiZXJyb3IiOwoJCQkJCWlmICggc3RhdHVzIDwgMCApIHsKCQkJCQkJc3RhdHVzID0gMDsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CgkJCWpxWEhSLnN0YXR1cyA9IHN0YXR1czsKCQkJanFYSFIuc3RhdHVzVGV4dCA9ICggbmF0aXZlU3RhdHVzVGV4dCB8fCBzdGF0dXNUZXh0ICkgKyAiIjsKCgkJCS8vIFN1Y2Nlc3MvRXJyb3IKCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIHN1Y2Nlc3MsIHN0YXR1c1RleHQsIGpxWEhSIF0gKTsKCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7CgkJCXN0YXR1c0NvZGUgPSB1bmRlZmluZWQ7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIGlzU3VjY2VzcyA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwKCQkJCQlbIGpxWEhSLCBzLCBpc1N1Y2Nlc3MgPyBzdWNjZXNzIDogZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBDb21wbGV0ZQoJCQljb21wbGV0ZURlZmVycmVkLmZpcmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQgXSApOwoKCQkJaWYgKCBmaXJlR2xvYmFscyApIHsKCQkJCWdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgWyBqcVhIUiwgcyBdICk7CgkJCQkvLyBIYW5kbGUgdGhlIGdsb2JhbCBBSkFYIGNvdW50ZXIKCQkJCWlmICggISggLS1qUXVlcnkuYWN0aXZlICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIik7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBqcVhIUjsKCX0sCgoJZ2V0SlNPTjogZnVuY3Rpb24oIHVybCwgZGF0YSwgY2FsbGJhY2sgKSB7CgkJcmV0dXJuIGpRdWVyeS5nZXQoIHVybCwgZGF0YSwgY2FsbGJhY2ssICJqc29uIiApOwoJfSwKCglnZXRTY3JpcHQ6IGZ1bmN0aW9uKCB1cmwsIGNhbGxiYWNrICkgewoJCXJldHVybiBqUXVlcnkuZ2V0KCB1cmwsIHVuZGVmaW5lZCwgY2FsbGJhY2ssICJzY3JpcHQiICk7Cgl9Cn0pOwoKalF1ZXJ5LmVhY2goIFsgImdldCIsICJwb3N0IiBdLCBmdW5jdGlvbiggaSwgbWV0aG9kICkgewoJalF1ZXJ5WyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrLCB0eXBlICkgewoJCS8vIFNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbWl0dGVkCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZGF0YSApICkgewoJCQl0eXBlID0gdHlwZSB8fCBjYWxsYmFjazsKCQkJY2FsbGJhY2sgPSBkYXRhOwoJCQlkYXRhID0gdW5kZWZpbmVkOwoJCX0KCgkJcmV0dXJuIGpRdWVyeS5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCXR5cGU6IG1ldGhvZCwKCQkJZGF0YVR5cGU6IHR5cGUsCgkJCWRhdGE6IGRhdGEsCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrCgkJfSk7Cgl9Owp9KTsKCgpqUXVlcnkuX2V2YWxVcmwgPSBmdW5jdGlvbiggdXJsICkgewoJcmV0dXJuIGpRdWVyeS5hamF4KHsKCQl1cmw6IHVybCwKCQl0eXBlOiAiR0VUIiwKCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJYXN5bmM6IGZhbHNlLAoJCWdsb2JhbDogZmFsc2UsCgkJInRocm93cyI6IHRydWUKCX0pOwp9OwoKCmpRdWVyeS5mbi5leHRlbmQoewoJd3JhcEFsbDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJdmFyIHdyYXA7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCWpRdWVyeSggdGhpcyApLndyYXBBbGwoIGh0bWwuY2FsbCh0aGlzLCBpKSApOwoJCQl9KTsKCQl9CgoJCWlmICggdGhpc1sgMCBdICkgewoKCQkJLy8gVGhlIGVsZW1lbnRzIHRvIHdyYXAgdGhlIHRhcmdldCBhcm91bmQKCQkJd3JhcCA9IGpRdWVyeSggaHRtbCwgdGhpc1sgMCBdLm93bmVyRG9jdW1lbnQgKS5lcSggMCApLmNsb25lKCB0cnVlICk7CgoJCQlpZiAoIHRoaXNbIDAgXS5wYXJlbnROb2RlICkgewoJCQkJd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbIDAgXSApOwoJCQl9CgoJCQl3cmFwLm1hcChmdW5jdGlvbigpIHsKCQkJCXZhciBlbGVtID0gdGhpczsKCgkJCQl3aGlsZSAoIGVsZW0uZmlyc3RFbGVtZW50Q2hpbGQgKSB7CgkJCQkJZWxlbSA9IGVsZW0uZmlyc3RFbGVtZW50Q2hpbGQ7CgkJCQl9CgoJCQkJcmV0dXJuIGVsZW07CgkJCX0pLmFwcGVuZCggdGhpcyApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXdyYXBJbm5lcjogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkud3JhcElubmVyKCBodG1sLmNhbGwodGhpcywgaSkgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgc2VsZiA9IGpRdWVyeSggdGhpcyApLAoJCQkJY29udGVudHMgPSBzZWxmLmNvbnRlbnRzKCk7CgoJCQlpZiAoIGNvbnRlbnRzLmxlbmd0aCApIHsKCQkJCWNvbnRlbnRzLndyYXBBbGwoIGh0bWwgKTsKCgkJCX0gZWxzZSB7CgkJCQlzZWxmLmFwcGVuZCggaHRtbCApOwoJCQl9CgkJfSk7Cgl9LAoKCXdyYXA6IGZ1bmN0aW9uKCBodG1sICkgewoJCXZhciBpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCh0aGlzLCBpKSA6IGh0bWwgKTsKCQl9KTsKCX0sCgoJdW53cmFwOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJib2R5IiApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVwbGFjZVdpdGgoIHRoaXMuY2hpbGROb2RlcyApOwoJCQl9CgkJfSkuZW5kKCk7Cgl9Cn0pOwoKCmpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkvLyBTdXBwb3J0OiBPcGVyYSA8PSAxMi4xMgoJLy8gT3BlcmEgcmVwb3J0cyBvZmZzZXRXaWR0aHMgYW5kIG9mZnNldEhlaWdodHMgbGVzcyB0aGFuIHplcm8gb24gc29tZSBlbGVtZW50cwoJcmV0dXJuIGVsZW0ub2Zmc2V0V2lkdGggPD0gMCAmJiBlbGVtLm9mZnNldEhlaWdodCA8PSAwOwp9OwpqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCXJldHVybiAhalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4oIGVsZW0gKTsKfTsKCgoKCnZhciByMjAgPSAvJTIwL2csCglyYnJhY2tldCA9IC9cW1xdJC8sCglyQ1JMRiA9IC9ccj9cbi9nLAoJcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAoJcnN1Ym1pdHRhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOwoKZnVuY3Rpb24gYnVpbGRQYXJhbXMoIHByZWZpeCwgb2JqLCB0cmFkaXRpb25hbCwgYWRkICkgewoJdmFyIG5hbWU7CgoJaWYgKCBqUXVlcnkuaXNBcnJheSggb2JqICkgKSB7CgkJLy8gU2VyaWFsaXplIGFycmF5IGl0ZW0uCgkJalF1ZXJ5LmVhY2goIG9iaiwgZnVuY3Rpb24oIGksIHYgKSB7CgkJCWlmICggdHJhZGl0aW9uYWwgfHwgcmJyYWNrZXQudGVzdCggcHJlZml4ICkgKSB7CgkJCQkvLyBUcmVhdCBlYWNoIGFycmF5IGl0ZW0gYXMgYSBzY2FsYXIuCgkJCQlhZGQoIHByZWZpeCwgdiApOwoKCQkJfSBlbHNlIHsKCQkJCS8vIEl0ZW0gaXMgbm9uLXNjYWxhciAoYXJyYXkgb3Igb2JqZWN0KSwgZW5jb2RlIGl0cyBudW1lcmljIGluZGV4LgoJCQkJYnVpbGRQYXJhbXMoIHByZWZpeCArICJbIiArICggdHlwZW9mIHYgPT09ICJvYmplY3QiID8gaSA6ICIiICkgKyAiXSIsIHYsIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQkJfQoJCX0pOwoKCX0gZWxzZSBpZiAoICF0cmFkaXRpb25hbCAmJiBqUXVlcnkudHlwZSggb2JqICkgPT09ICJvYmplY3QiICkgewoJCS8vIFNlcmlhbGl6ZSBvYmplY3QgaXRlbS4KCQlmb3IgKCBuYW1lIGluIG9iaiApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCArICJbIiArIG5hbWUgKyAiXSIsIG9ialsgbmFtZSBdLCB0cmFkaXRpb25hbCwgYWRkICk7CgkJfQoKCX0gZWxzZSB7CgkJLy8gU2VyaWFsaXplIHNjYWxhciBpdGVtLgoJCWFkZCggcHJlZml4LCBvYmogKTsKCX0KfQoKLy8gU2VyaWFsaXplIGFuIGFycmF5IG9mIGZvcm0gZWxlbWVudHMgb3IgYSBzZXQgb2YKLy8ga2V5L3ZhbHVlcyBpbnRvIGEgcXVlcnkgc3RyaW5nCmpRdWVyeS5wYXJhbSA9IGZ1bmN0aW9uKCBhLCB0cmFkaXRpb25hbCApIHsKCXZhciBwcmVmaXgsCgkJcyA9IFtdLAoJCWFkZCA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQkvLyBJZiB2YWx1ZSBpcyBhIGZ1bmN0aW9uLCBpbnZva2UgaXQgYW5kIHJldHVybiBpdHMgdmFsdWUKCQkJdmFsdWUgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSA/IHZhbHVlKCkgOiAoIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICk7CgkJCXNbIHMubGVuZ3RoIF0gPSBlbmNvZGVVUklDb21wb25lbnQoIGtleSApICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KCB2YWx1ZSApOwoJCX07CgoJLy8gU2V0IHRyYWRpdGlvbmFsIHRvIHRydWUgZm9yIGpRdWVyeSA8PSAxLjMuMiBiZWhhdmlvci4KCWlmICggdHJhZGl0aW9uYWwgPT09IHVuZGVmaW5lZCApIHsKCQl0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MgJiYgalF1ZXJ5LmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbDsKCX0KCgkvLyBJZiBhbiBhcnJheSB3YXMgcGFzc2VkIGluLCBhc3N1bWUgdGhhdCBpdCBpcyBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzLgoJaWYgKCBqUXVlcnkuaXNBcnJheSggYSApIHx8ICggYS5qcXVlcnkgJiYgIWpRdWVyeS5pc1BsYWluT2JqZWN0KCBhICkgKSApIHsKCQkvLyBTZXJpYWxpemUgdGhlIGZvcm0gZWxlbWVudHMKCQlqUXVlcnkuZWFjaCggYSwgZnVuY3Rpb24oKSB7CgkJCWFkZCggdGhpcy5uYW1lLCB0aGlzLnZhbHVlICk7CgkJfSk7CgoJfSBlbHNlIHsKCQkvLyBJZiB0cmFkaXRpb25hbCwgZW5jb2RlIHRoZSAib2xkIiB3YXkgKHRoZSB3YXkgMS4zLjIgb3Igb2xkZXIKCQkvLyBkaWQgaXQpLCBvdGhlcndpc2UgZW5jb2RlIHBhcmFtcyByZWN1cnNpdmVseS4KCQlmb3IgKCBwcmVmaXggaW4gYSApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCwgYVsgcHJlZml4IF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSByZXN1bHRpbmcgc2VyaWFsaXphdGlvbgoJcmV0dXJuIHMuam9pbiggIiYiICkucmVwbGFjZSggcjIwLCAiKyIgKTsKfTsKCmpRdWVyeS5mbi5leHRlbmQoewoJc2VyaWFsaXplOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4galF1ZXJ5LnBhcmFtKCB0aGlzLnNlcmlhbGl6ZUFycmF5KCkgKTsKCX0sCglzZXJpYWxpemVBcnJheTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQkvLyBDYW4gYWRkIHByb3BIb29rIGZvciAiZWxlbWVudHMiIHRvIGZpbHRlciBvciBhZGQgZm9ybSBlbGVtZW50cwoJCQl2YXIgZWxlbWVudHMgPSBqUXVlcnkucHJvcCggdGhpcywgImVsZW1lbnRzIiApOwoJCQlyZXR1cm4gZWxlbWVudHMgPyBqUXVlcnkubWFrZUFycmF5KCBlbGVtZW50cyApIDogdGhpczsKCQl9KQoJCS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCXZhciB0eXBlID0gdGhpcy50eXBlOwoKCQkJLy8gVXNlIC5pcyggIjpkaXNhYmxlZCIgKSBzbyB0aGF0IGZpZWxkc2V0W2Rpc2FibGVkXSB3b3JrcwoJCQlyZXR1cm4gdGhpcy5uYW1lICYmICFqUXVlcnkoIHRoaXMgKS5pcyggIjpkaXNhYmxlZCIgKSAmJgoJCQkJcnN1Ym1pdHRhYmxlLnRlc3QoIHRoaXMubm9kZU5hbWUgKSAmJiAhcnN1Ym1pdHRlclR5cGVzLnRlc3QoIHR5cGUgKSAmJgoJCQkJKCB0aGlzLmNoZWNrZWQgfHwgIXJjaGVja2FibGVUeXBlLnRlc3QoIHR5cGUgKSApOwoJCX0pCgkJLm1hcChmdW5jdGlvbiggaSwgZWxlbSApIHsKCQkJdmFyIHZhbCA9IGpRdWVyeSggdGhpcyApLnZhbCgpOwoKCQkJcmV0dXJuIHZhbCA9PSBudWxsID8KCQkJCW51bGwgOgoJCQkJalF1ZXJ5LmlzQXJyYXkoIHZhbCApID8KCQkJCQlqUXVlcnkubWFwKCB2YWwsIGZ1bmN0aW9uKCB2YWwgKSB7CgkJCQkJCXJldHVybiB7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQkJCQl9KSA6CgkJCQkJeyBuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWwucmVwbGFjZSggckNSTEYsICJcclxuIiApIH07CgkJfSkuZ2V0KCk7Cgl9Cn0pOwoKCmpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gZnVuY3Rpb24oKSB7Cgl0cnkgewoJCXJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCX0gY2F0Y2goIGUgKSB7fQp9OwoKdmFyIHhocklkID0gMCwKCXhockNhbGxiYWNrcyA9IHt9LAoJeGhyU3VjY2Vzc1N0YXR1cyA9IHsKCQkvLyBmaWxlIHByb3RvY29sIGFsd2F5cyB5aWVsZHMgc3RhdHVzIGNvZGUgMCwgYXNzdW1lIDIwMAoJCTA6IDIwMCwKCQkvLyBTdXBwb3J0OiBJRTkKCQkvLyAjMTQ1MDogc29tZXRpbWVzIElFIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQKCQkxMjIzOiAyMDQKCX0sCgl4aHJTdXBwb3J0ZWQgPSBqUXVlcnkuYWpheFNldHRpbmdzLnhocigpOwoKLy8gU3VwcG9ydDogSUU5Ci8vIE9wZW4gcmVxdWVzdHMgbXVzdCBiZSBtYW51YWxseSBhYm9ydGVkIG9uIHVubG9hZCAoIzUyODApCi8vIFNlZSBodHRwczovL3N1cHBvcnQubWljcm9zb2Z0LmNvbS9rYi8yODU2NzQ2IGZvciBtb3JlIGluZm8KaWYgKCB3aW5kb3cuYXR0YWNoRXZlbnQgKSB7Cgl3aW5kb3cuYXR0YWNoRXZlbnQoICJvbnVubG9hZCIsIGZ1bmN0aW9uKCkgewoJCWZvciAoIHZhciBrZXkgaW4geGhyQ2FsbGJhY2tzICkgewoJCQl4aHJDYWxsYmFja3NbIGtleSBdKCk7CgkJfQoJfSk7Cn0KCnN1cHBvcnQuY29ycyA9ICEheGhyU3VwcG9ydGVkICYmICggIndpdGhDcmVkZW50aWFscyIgaW4geGhyU3VwcG9ydGVkICk7CnN1cHBvcnQuYWpheCA9IHhoclN1cHBvcnRlZCA9ICEheGhyU3VwcG9ydGVkOwoKalF1ZXJ5LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oIG9wdGlvbnMgKSB7Cgl2YXIgY2FsbGJhY2s7CgoJLy8gQ3Jvc3MgZG9tYWluIG9ubHkgYWxsb3dlZCBpZiBzdXBwb3J0ZWQgdGhyb3VnaCBYTUxIdHRwUmVxdWVzdAoJaWYgKCBzdXBwb3J0LmNvcnMgfHwgeGhyU3VwcG9ydGVkICYmICFvcHRpb25zLmNyb3NzRG9tYWluICkgewoJCXJldHVybiB7CgkJCXNlbmQ6IGZ1bmN0aW9uKCBoZWFkZXJzLCBjb21wbGV0ZSApIHsKCQkJCXZhciBpLAoJCQkJCXhociA9IG9wdGlvbnMueGhyKCksCgkJCQkJaWQgPSArK3hocklkOwoKCQkJCXhoci5vcGVuKCBvcHRpb25zLnR5cGUsIG9wdGlvbnMudXJsLCBvcHRpb25zLmFzeW5jLCBvcHRpb25zLnVzZXJuYW1lLCBvcHRpb25zLnBhc3N3b3JkICk7CgoJCQkJLy8gQXBwbHkgY3VzdG9tIGZpZWxkcyBpZiBwcm92aWRlZAoJCQkJaWYgKCBvcHRpb25zLnhockZpZWxkcyApIHsKCQkJCQlmb3IgKCBpIGluIG9wdGlvbnMueGhyRmllbGRzICkgewoJCQkJCQl4aHJbIGkgXSA9IG9wdGlvbnMueGhyRmllbGRzWyBpIF07CgkJCQkJfQoJCQkJfQoKCQkJCS8vIE92ZXJyaWRlIG1pbWUgdHlwZSBpZiBuZWVkZWQKCQkJCWlmICggb3B0aW9ucy5taW1lVHlwZSAmJiB4aHIub3ZlcnJpZGVNaW1lVHlwZSApIHsKCQkJCQl4aHIub3ZlcnJpZGVNaW1lVHlwZSggb3B0aW9ucy5taW1lVHlwZSApOwoJCQkJfQoKCQkJCS8vIFgtUmVxdWVzdGVkLVdpdGggaGVhZGVyCgkJCQkvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlCgkJCQkvLyBha2luIHRvIGEgamlnc2F3IHB1enpsZSwgd2Ugc2ltcGx5IG5ldmVyIHNldCBpdCB0byBiZSBzdXJlLgoJCQkJLy8gKGl0IGNhbiBhbHdheXMgYmUgc2V0IG9uIGEgcGVyLXJlcXVlc3QgYmFzaXMgb3IgZXZlbiB1c2luZyBhamF4U2V0dXApCgkJCQkvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC4KCQkJCWlmICggIW9wdGlvbnMuY3Jvc3NEb21haW4gJiYgIWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSApIHsKCQkJCQloZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gPSAiWE1MSHR0cFJlcXVlc3QiOwoJCQkJfQoKCQkJCS8vIFNldCBoZWFkZXJzCgkJCQlmb3IgKCBpIGluIGhlYWRlcnMgKSB7CgkJCQkJeGhyLnNldFJlcXVlc3RIZWFkZXIoIGksIGhlYWRlcnNbIGkgXSApOwoJCQkJfQoKCQkJCS8vIENhbGxiYWNrCgkJCQljYWxsYmFjayA9IGZ1bmN0aW9uKCB0eXBlICkgewoJCQkJCXJldHVybiBmdW5jdGlvbigpIHsKCQkJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQkJCWRlbGV0ZSB4aHJDYWxsYmFja3NbIGlkIF07CgkJCQkJCQljYWxsYmFjayA9IHhoci5vbmxvYWQgPSB4aHIub25lcnJvciA9IG51bGw7CgoJCQkJCQkJaWYgKCB0eXBlID09PSAiYWJvcnQiICkgewoJCQkJCQkJCXhoci5hYm9ydCgpOwoJCQkJCQkJfSBlbHNlIGlmICggdHlwZSA9PT0gImVycm9yIiApIHsKCQkJCQkJCQljb21wbGV0ZSgKCQkJCQkJCQkJLy8gZmlsZTogcHJvdG9jb2wgYWx3YXlzIHlpZWxkcyBzdGF0dXMgMDsgc2VlICM4NjA1LCAjMTQyMDcKCQkJCQkJCQkJeGhyLnN0YXR1cywKCQkJCQkJCQkJeGhyLnN0YXR1c1RleHQKCQkJCQkJCQkpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQljb21wbGV0ZSgKCQkJCQkJCQkJeGhyU3VjY2Vzc1N0YXR1c1sgeGhyLnN0YXR1cyBdIHx8IHhoci5zdGF0dXMsCgkJCQkJCQkJCXhoci5zdGF0dXNUZXh0LAoJCQkJCQkJCQkvLyBTdXBwb3J0OiBJRTkKCQkJCQkJCQkJLy8gQWNjZXNzaW5nIGJpbmFyeS1kYXRhIHJlc3BvbnNlVGV4dCB0aHJvd3MgYW4gZXhjZXB0aW9uCgkJCQkJCQkJCS8vICgjMTE0MjYpCgkJCQkJCQkJCXR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ID09PSAic3RyaW5nIiA/IHsKCQkJCQkJCQkJCXRleHQ6IHhoci5yZXNwb25zZVRleHQKCQkJCQkJCQkJfSA6IHVuZGVmaW5lZCwKCQkJCQkJCQkJeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpCgkJCQkJCQkJKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX07CgkJCQl9OwoKCQkJCS8vIExpc3RlbiB0byBldmVudHMKCQkJCXhoci5vbmxvYWQgPSBjYWxsYmFjaygpOwoJCQkJeGhyLm9uZXJyb3IgPSBjYWxsYmFjaygiZXJyb3IiKTsKCgkJCQkvLyBDcmVhdGUgdGhlIGFib3J0IGNhbGxiYWNrCgkJCQljYWxsYmFjayA9IHhockNhbGxiYWNrc1sgaWQgXSA9IGNhbGxiYWNrKCJhYm9ydCIpOwoKCQkJCXRyeSB7CgkJCQkJLy8gRG8gc2VuZCB0aGUgcmVxdWVzdCAodGhpcyBtYXkgcmFpc2UgYW4gZXhjZXB0aW9uKQoJCQkJCXhoci5zZW5kKCBvcHRpb25zLmhhc0NvbnRlbnQgJiYgb3B0aW9ucy5kYXRhIHx8IG51bGwgKTsKCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCS8vICMxNDY4MzogT25seSByZXRocm93IGlmIHRoaXMgaGFzbid0IGJlZW4gbm90aWZpZWQgYXMgYW4gZXJyb3IgeWV0CgkJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQkJdGhyb3cgZTsKCQkJCQl9CgkJCQl9CgkJCX0sCgoJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCWNhbGxiYWNrKCk7CgkJCQl9CgkJCX0KCQl9OwoJfQp9KTsKCgoKCi8vIEluc3RhbGwgc2NyaXB0IGRhdGFUeXBlCmpRdWVyeS5hamF4U2V0dXAoewoJYWNjZXB0czogewoJCXNjcmlwdDogInRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCwgYXBwbGljYXRpb24vZWNtYXNjcmlwdCwgYXBwbGljYXRpb24veC1lY21hc2NyaXB0IgoJfSwKCWNvbnRlbnRzOiB7CgkJc2NyaXB0OiAvKD86amF2YXxlY21hKXNjcmlwdC8KCX0sCgljb252ZXJ0ZXJzOiB7CgkJInRleHQgc2NyaXB0IjogZnVuY3Rpb24oIHRleHQgKSB7CgkJCWpRdWVyeS5nbG9iYWxFdmFsKCB0ZXh0ICk7CgkJCXJldHVybiB0ZXh0OwoJCX0KCX0KfSk7CgovLyBIYW5kbGUgY2FjaGUncyBzcGVjaWFsIGNhc2UgYW5kIGNyb3NzRG9tYWluCmpRdWVyeS5hamF4UHJlZmlsdGVyKCAic2NyaXB0IiwgZnVuY3Rpb24oIHMgKSB7CglpZiAoIHMuY2FjaGUgPT09IHVuZGVmaW5lZCApIHsKCQlzLmNhY2hlID0gZmFsc2U7Cgl9CglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgkJcy50eXBlID0gIkdFVCI7Cgl9Cn0pOwoKLy8gQmluZCBzY3JpcHQgdGFnIGhhY2sgdHJhbnNwb3J0CmpRdWVyeS5hamF4VHJhbnNwb3J0KCAic2NyaXB0IiwgZnVuY3Rpb24oIHMgKSB7CgkvLyBUaGlzIHRyYW5zcG9ydCBvbmx5IGRlYWxzIHdpdGggY3Jvc3MgZG9tYWluIHJlcXVlc3RzCglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgkJdmFyIHNjcmlwdCwgY2FsbGJhY2s7CgkJcmV0dXJuIHsKCQkJc2VuZDogZnVuY3Rpb24oIF8sIGNvbXBsZXRlICkgewoJCQkJc2NyaXB0ID0galF1ZXJ5KCI8c2NyaXB0PiIpLnByb3AoewoJCQkJCWFzeW5jOiB0cnVlLAoJCQkJCWNoYXJzZXQ6IHMuc2NyaXB0Q2hhcnNldCwKCQkJCQlzcmM6IHMudXJsCgkJCQl9KS5vbigKCQkJCQkibG9hZCBlcnJvciIsCgkJCQkJY2FsbGJhY2sgPSBmdW5jdGlvbiggZXZ0ICkgewoJCQkJCQlzY3JpcHQucmVtb3ZlKCk7CgkJCQkJCWNhbGxiYWNrID0gbnVsbDsKCQkJCQkJaWYgKCBldnQgKSB7CgkJCQkJCQljb21wbGV0ZSggZXZ0LnR5cGUgPT09ICJlcnJvciIgPyA0MDQgOiAyMDAsIGV2dC50eXBlICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkpOwoJCQkJZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCggc2NyaXB0WyAwIF0gKTsKCQkJfSwKCQkJYWJvcnQ6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQljYWxsYmFjaygpOwoJCQkJfQoJCQl9CgkJfTsKCX0KfSk7CgoKCgp2YXIgb2xkQ2FsbGJhY2tzID0gW10sCglyanNvbnAgPSAvKD0pXD8oPz0mfCQpfFw/XD8vOwoKLy8gRGVmYXVsdCBqc29ucCBzZXR0aW5ncwpqUXVlcnkuYWpheFNldHVwKHsKCWpzb25wOiAiY2FsbGJhY2siLAoJanNvbnBDYWxsYmFjazogZnVuY3Rpb24oKSB7CgkJdmFyIGNhbGxiYWNrID0gb2xkQ2FsbGJhY2tzLnBvcCgpIHx8ICggalF1ZXJ5LmV4cGFuZG8gKyAiXyIgKyAoIG5vbmNlKysgKSApOwoJCXRoaXNbIGNhbGxiYWNrIF0gPSB0cnVlOwoJCXJldHVybiBjYWxsYmFjazsKCX0KfSk7CgovLyBEZXRlY3QsIG5vcm1hbGl6ZSBvcHRpb25zIGFuZCBpbnN0YWxsIGNhbGxiYWNrcyBmb3IganNvbnAgcmVxdWVzdHMKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJqc29uIGpzb25wIiwgZnVuY3Rpb24oIHMsIG9yaWdpbmFsU2V0dGluZ3MsIGpxWEhSICkgewoKCXZhciBjYWxsYmFja05hbWUsIG92ZXJ3cml0dGVuLCByZXNwb25zZUNvbnRhaW5lciwKCQlqc29uUHJvcCA9IHMuanNvbnAgIT09IGZhbHNlICYmICggcmpzb25wLnRlc3QoIHMudXJsICkgPwoJCQkidXJsIiA6CgkJCXR5cGVvZiBzLmRhdGEgPT09ICJzdHJpbmciICYmICEoIHMuY29udGVudFR5cGUgfHwgIiIgKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSAmJiByanNvbnAudGVzdCggcy5kYXRhICkgJiYgImRhdGEiCgkJKTsKCgkvLyBIYW5kbGUgaWZmIHRoZSBleHBlY3RlZCBkYXRhIHR5cGUgaXMgImpzb25wIiBvciB3ZSBoYXZlIGEgcGFyYW1ldGVyIHRvIHNldAoJaWYgKCBqc29uUHJvcCB8fCBzLmRhdGFUeXBlc1sgMCBdID09PSAianNvbnAiICkgewoKCQkvLyBHZXQgY2FsbGJhY2sgbmFtZSwgcmVtZW1iZXJpbmcgcHJlZXhpc3RpbmcgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIGl0CgkJY2FsbGJhY2tOYW1lID0gcy5qc29ucENhbGxiYWNrID0galF1ZXJ5LmlzRnVuY3Rpb24oIHMuanNvbnBDYWxsYmFjayApID8KCQkJcy5qc29ucENhbGxiYWNrKCkgOgoJCQlzLmpzb25wQ2FsbGJhY2s7CgoJCS8vIEluc2VydCBjYWxsYmFjayBpbnRvIHVybCBvciBmb3JtIGRhdGEKCQlpZiAoIGpzb25Qcm9wICkgewoJCQlzWyBqc29uUHJvcCBdID0gc1sganNvblByb3AgXS5yZXBsYWNlKCByanNvbnAsICIkMSIgKyBjYWxsYmFja05hbWUgKTsKCQl9IGVsc2UgaWYgKCBzLmpzb25wICE9PSBmYWxzZSApIHsKCQkJcy51cmwgKz0gKCBycXVlcnkudGVzdCggcy51cmwgKSA/ICImIiA6ICI/IiApICsgcy5qc29ucCArICI9IiArIGNhbGxiYWNrTmFtZTsKCQl9CgoJCS8vIFVzZSBkYXRhIGNvbnZlcnRlciB0byByZXRyaWV2ZSBqc29uIGFmdGVyIHNjcmlwdCBleGVjdXRpb24KCQlzLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl0gPSBmdW5jdGlvbigpIHsKCQkJaWYgKCAhcmVzcG9uc2VDb250YWluZXIgKSB7CgkJCQlqUXVlcnkuZXJyb3IoIGNhbGxiYWNrTmFtZSArICIgd2FzIG5vdCBjYWxsZWQiICk7CgkJCX0KCQkJcmV0dXJuIHJlc3BvbnNlQ29udGFpbmVyWyAwIF07CgkJfTsKCgkJLy8gZm9yY2UganNvbiBkYXRhVHlwZQoJCXMuZGF0YVR5cGVzWyAwIF0gPSAianNvbiI7CgoJCS8vIEluc3RhbGwgY2FsbGJhY2sKCQlvdmVyd3JpdHRlbiA9IHdpbmRvd1sgY2FsbGJhY2tOYW1lIF07CgkJd2luZG93WyBjYWxsYmFja05hbWUgXSA9IGZ1bmN0aW9uKCkgewoJCQlyZXNwb25zZUNvbnRhaW5lciA9IGFyZ3VtZW50czsKCQl9OwoKCQkvLyBDbGVhbi11cCBmdW5jdGlvbiAoZmlyZXMgYWZ0ZXIgY29udmVydGVycykKCQlqcVhIUi5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCS8vIFJlc3RvcmUgcHJlZXhpc3RpbmcgdmFsdWUKCQkJd2luZG93WyBjYWxsYmFja05hbWUgXSA9IG92ZXJ3cml0dGVuOwoKCQkJLy8gU2F2ZSBiYWNrIGFzIGZyZWUKCQkJaWYgKCBzWyBjYWxsYmFja05hbWUgXSApIHsKCQkJCS8vIG1ha2Ugc3VyZSB0aGF0IHJlLXVzaW5nIHRoZSBvcHRpb25zIGRvZXNuJ3Qgc2NyZXcgdGhpbmdzIGFyb3VuZAoJCQkJcy5qc29ucENhbGxiYWNrID0gb3JpZ2luYWxTZXR0aW5ncy5qc29ucENhbGxiYWNrOwoKCQkJCS8vIHNhdmUgdGhlIGNhbGxiYWNrIG5hbWUgZm9yIGZ1dHVyZSB1c2UKCQkJCW9sZENhbGxiYWNrcy5wdXNoKCBjYWxsYmFja05hbWUgKTsKCQkJfQoKCQkJLy8gQ2FsbCBpZiBpdCB3YXMgYSBmdW5jdGlvbiBhbmQgd2UgaGF2ZSBhIHJlc3BvbnNlCgkJCWlmICggcmVzcG9uc2VDb250YWluZXIgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIG92ZXJ3cml0dGVuICkgKSB7CgkJCQlvdmVyd3JpdHRlbiggcmVzcG9uc2VDb250YWluZXJbIDAgXSApOwoJCQl9CgoJCQlyZXNwb25zZUNvbnRhaW5lciA9IG92ZXJ3cml0dGVuID0gdW5kZWZpbmVkOwoJCX0pOwoKCQkvLyBEZWxlZ2F0ZSB0byBzY3JpcHQKCQlyZXR1cm4gInNjcmlwdCI7Cgl9Cn0pOwoKCgoKLy8gZGF0YTogc3RyaW5nIG9mIGh0bWwKLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LCBkZWZhdWx0cyB0byBkb2N1bWVudAovLyBrZWVwU2NyaXB0cyAob3B0aW9uYWwpOiBJZiB0cnVlLCB3aWxsIGluY2x1ZGUgc2NyaXB0cyBwYXNzZWQgaW4gdGhlIGh0bWwgc3RyaW5nCmpRdWVyeS5wYXJzZUhUTUwgPSBmdW5jdGlvbiggZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMgKSB7CglpZiAoICFkYXRhIHx8IHR5cGVvZiBkYXRhICE9PSAic3RyaW5nIiApIHsKCQlyZXR1cm4gbnVsbDsKCX0KCWlmICggdHlwZW9mIGNvbnRleHQgPT09ICJib29sZWFuIiApIHsKCQlrZWVwU2NyaXB0cyA9IGNvbnRleHQ7CgkJY29udGV4dCA9IGZhbHNlOwoJfQoJY29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7CgoJdmFyIHBhcnNlZCA9IHJzaW5nbGVUYWcuZXhlYyggZGF0YSApLAoJCXNjcmlwdHMgPSAha2VlcFNjcmlwdHMgJiYgW107CgoJLy8gU2luZ2xlIHRhZwoJaWYgKCBwYXJzZWQgKSB7CgkJcmV0dXJuIFsgY29udGV4dC5jcmVhdGVFbGVtZW50KCBwYXJzZWRbMV0gKSBdOwoJfQoKCXBhcnNlZCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBbIGRhdGEgXSwgY29udGV4dCwgc2NyaXB0cyApOwoKCWlmICggc2NyaXB0cyAmJiBzY3JpcHRzLmxlbmd0aCApIHsKCQlqUXVlcnkoIHNjcmlwdHMgKS5yZW1vdmUoKTsKCX0KCglyZXR1cm4galF1ZXJ5Lm1lcmdlKCBbXSwgcGFyc2VkLmNoaWxkTm9kZXMgKTsKfTsKCgovLyBLZWVwIGEgY29weSBvZiB0aGUgb2xkIGxvYWQgbWV0aG9kCnZhciBfbG9hZCA9IGpRdWVyeS5mbi5sb2FkOwoKLyoqCiAqIExvYWQgYSB1cmwgaW50byBhIHBhZ2UKICovCmpRdWVyeS5mbi5sb2FkID0gZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCWlmICggdHlwZW9mIHVybCAhPT0gInN0cmluZyIgJiYgX2xvYWQgKSB7CgkJcmV0dXJuIF9sb2FkLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCX0KCgl2YXIgc2VsZWN0b3IsIHR5cGUsIHJlc3BvbnNlLAoJCXNlbGYgPSB0aGlzLAoJCW9mZiA9IHVybC5pbmRleE9mKCIgIik7CgoJaWYgKCBvZmYgPj0gMCApIHsKCQlzZWxlY3RvciA9IGpRdWVyeS50cmltKCB1cmwuc2xpY2UoIG9mZiApICk7CgkJdXJsID0gdXJsLnNsaWNlKCAwLCBvZmYgKTsKCX0KCgkvLyBJZiBpdCdzIGEgZnVuY3Rpb24KCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHBhcmFtcyApICkgewoKCQkvLyBXZSBhc3N1bWUgdGhhdCBpdCdzIHRoZSBjYWxsYmFjawoJCWNhbGxiYWNrID0gcGFyYW1zOwoJCXBhcmFtcyA9IHVuZGVmaW5lZDsKCgkvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nCgl9IGVsc2UgaWYgKCBwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gIm9iamVjdCIgKSB7CgkJdHlwZSA9ICJQT1NUIjsKCX0KCgkvLyBJZiB3ZSBoYXZlIGVsZW1lbnRzIHRvIG1vZGlmeSwgbWFrZSB0aGUgcmVxdWVzdAoJaWYgKCBzZWxmLmxlbmd0aCA+IDAgKSB7CgkJalF1ZXJ5LmFqYXgoewoJCQl1cmw6IHVybCwKCgkJCS8vIGlmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZAoJCQl0eXBlOiB0eXBlLAoJCQlkYXRhVHlwZTogImh0bWwiLAoJCQlkYXRhOiBwYXJhbXMKCQl9KS5kb25lKGZ1bmN0aW9uKCByZXNwb25zZVRleHQgKSB7CgoJCQkvLyBTYXZlIHJlc3BvbnNlIGZvciB1c2UgaW4gY29tcGxldGUgY2FsbGJhY2sKCQkJcmVzcG9uc2UgPSBhcmd1bWVudHM7CgoJCQlzZWxmLmh0bWwoIHNlbGVjdG9yID8KCgkJCQkvLyBJZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQsIGxvY2F0ZSB0aGUgcmlnaHQgZWxlbWVudHMgaW4gYSBkdW1teSBkaXYKCQkJCS8vIEV4Y2x1ZGUgc2NyaXB0cyB0byBhdm9pZCBJRSAnUGVybWlzc2lvbiBEZW5pZWQnIGVycm9ycwoJCQkJalF1ZXJ5KCI8ZGl2PiIpLmFwcGVuZCggalF1ZXJ5LnBhcnNlSFRNTCggcmVzcG9uc2VUZXh0ICkgKS5maW5kKCBzZWxlY3RvciApIDoKCgkJCQkvLyBPdGhlcndpc2UgdXNlIHRoZSBmdWxsIHJlc3VsdAoJCQkJcmVzcG9uc2VUZXh0ICk7CgoJCX0pLmNvbXBsZXRlKCBjYWxsYmFjayAmJiBmdW5jdGlvbigganFYSFIsIHN0YXR1cyApIHsKCQkJc2VsZi5lYWNoKCBjYWxsYmFjaywgcmVzcG9uc2UgfHwgWyBqcVhIUi5yZXNwb25zZVRleHQsIHN0YXR1cywganFYSFIgXSApOwoJCX0pOwoJfQoKCXJldHVybiB0aGlzOwp9OwoKCgoKLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMKalF1ZXJ5LmVhY2goIFsgImFqYXhTdGFydCIsICJhamF4U3RvcCIsICJhamF4Q29tcGxldGUiLCAiYWpheEVycm9yIiwgImFqYXhTdWNjZXNzIiwgImFqYXhTZW5kIiBdLCBmdW5jdGlvbiggaSwgdHlwZSApIHsKCWpRdWVyeS5mblsgdHlwZSBdID0gZnVuY3Rpb24oIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlLCBmbiApOwoJfTsKfSk7CgoKCgpqUXVlcnkuZXhwci5maWx0ZXJzLmFuaW1hdGVkID0gZnVuY3Rpb24oIGVsZW0gKSB7CglyZXR1cm4galF1ZXJ5LmdyZXAoalF1ZXJ5LnRpbWVycywgZnVuY3Rpb24oIGZuICkgewoJCXJldHVybiBlbGVtID09PSBmbi5lbGVtOwoJfSkubGVuZ3RoOwp9OwoKCgoKdmFyIGRvY0VsZW0gPSB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKLyoqCiAqIEdldHMgYSB3aW5kb3cgZnJvbSBhbiBlbGVtZW50CiAqLwpmdW5jdGlvbiBnZXRXaW5kb3coIGVsZW0gKSB7CglyZXR1cm4galF1ZXJ5LmlzV2luZG93KCBlbGVtICkgPyBlbGVtIDogZWxlbS5ub2RlVHlwZSA9PT0gOSAmJiBlbGVtLmRlZmF1bHRWaWV3Owp9CgpqUXVlcnkub2Zmc2V0ID0gewoJc2V0T2Zmc2V0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgaSApIHsKCQl2YXIgY3VyUG9zaXRpb24sIGN1ckxlZnQsIGN1ckNTU1RvcCwgY3VyVG9wLCBjdXJPZmZzZXQsIGN1ckNTU0xlZnQsIGNhbGN1bGF0ZVBvc2l0aW9uLAoJCQlwb3NpdGlvbiA9IGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKSwKCQkJY3VyRWxlbSA9IGpRdWVyeSggZWxlbSApLAoJCQlwcm9wcyA9IHt9OwoKCQkvLyBTZXQgcG9zaXRpb24gZmlyc3QsIGluLWNhc2UgdG9wL2xlZnQgYXJlIHNldCBldmVuIG9uIHN0YXRpYyBlbGVtCgkJaWYgKCBwb3NpdGlvbiA9PT0gInN0YXRpYyIgKSB7CgkJCWVsZW0uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCX0KCgkJY3VyT2Zmc2V0ID0gY3VyRWxlbS5vZmZzZXQoKTsKCQljdXJDU1NUb3AgPSBqUXVlcnkuY3NzKCBlbGVtLCAidG9wIiApOwoJCWN1ckNTU0xlZnQgPSBqUXVlcnkuY3NzKCBlbGVtLCAibGVmdCIgKTsKCQljYWxjdWxhdGVQb3NpdGlvbiA9ICggcG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgfHwgcG9zaXRpb24gPT09ICJmaXhlZCIgKSAmJgoJCQkoIGN1ckNTU1RvcCArIGN1ckNTU0xlZnQgKS5pbmRleE9mKCJhdXRvIikgPiAtMTsKCgkJLy8gTmVlZCB0byBiZSBhYmxlIHRvIGNhbGN1bGF0ZSBwb3NpdGlvbiBpZiBlaXRoZXIKCQkvLyB0b3Agb3IgbGVmdCBpcyBhdXRvIGFuZCBwb3NpdGlvbiBpcyBlaXRoZXIgYWJzb2x1dGUgb3IgZml4ZWQKCQlpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkgewoJCQljdXJQb3NpdGlvbiA9IGN1ckVsZW0ucG9zaXRpb24oKTsKCQkJY3VyVG9wID0gY3VyUG9zaXRpb24udG9wOwoJCQljdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKCgkJfSBlbHNlIHsKCQkJY3VyVG9wID0gcGFyc2VGbG9hdCggY3VyQ1NTVG9wICkgfHwgMDsKCQkJY3VyTGVmdCA9IHBhcnNlRmxvYXQoIGN1ckNTU0xlZnQgKSB8fCAwOwoJCX0KCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0aW9ucyApICkgewoJCQlvcHRpb25zID0gb3B0aW9ucy5jYWxsKCBlbGVtLCBpLCBjdXJPZmZzZXQgKTsKCQl9CgoJCWlmICggb3B0aW9ucy50b3AgIT0gbnVsbCApIHsKCQkJcHJvcHMudG9wID0gKCBvcHRpb25zLnRvcCAtIGN1ck9mZnNldC50b3AgKSArIGN1clRvcDsKCQl9CgkJaWYgKCBvcHRpb25zLmxlZnQgIT0gbnVsbCApIHsKCQkJcHJvcHMubGVmdCA9ICggb3B0aW9ucy5sZWZ0IC0gY3VyT2Zmc2V0LmxlZnQgKSArIGN1ckxlZnQ7CgkJfQoKCQlpZiAoICJ1c2luZyIgaW4gb3B0aW9ucyApIHsKCQkJb3B0aW9ucy51c2luZy5jYWxsKCBlbGVtLCBwcm9wcyApOwoKCQl9IGVsc2UgewoJCQljdXJFbGVtLmNzcyggcHJvcHMgKTsKCQl9Cgl9Cn07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCW9mZnNldDogZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoICkgewoJCQlyZXR1cm4gb3B0aW9ucyA9PT0gdW5kZWZpbmVkID8KCQkJCXRoaXMgOgoJCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJCWpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7CgkJCQl9KTsKCQl9CgoJCXZhciBkb2NFbGVtLCB3aW4sCgkJCWVsZW0gPSB0aGlzWyAwIF0sCgkJCWJveCA9IHsgdG9wOiAwLCBsZWZ0OiAwIH0sCgkJCWRvYyA9IGVsZW0gJiYgZWxlbS5vd25lckRvY3VtZW50OwoKCQlpZiAoICFkb2MgKSB7CgkJCXJldHVybjsKCQl9CgoJCWRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50OwoKCQkvLyBNYWtlIHN1cmUgaXQncyBub3QgYSBkaXNjb25uZWN0ZWQgRE9NIG5vZGUKCQlpZiAoICFqUXVlcnkuY29udGFpbnMoIGRvY0VsZW0sIGVsZW0gKSApIHsKCQkJcmV0dXJuIGJveDsKCQl9CgoJCS8vIFN1cHBvcnQ6IEJsYWNrQmVycnkgNSwgaU9TIDMgKG9yaWdpbmFsIGlQaG9uZSkKCQkvLyBJZiB3ZSBkb24ndCBoYXZlIGdCQ1IsIGp1c3QgdXNlIDAsMCByYXRoZXIgdGhhbiBlcnJvcgoJCWlmICggdHlwZW9mIGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0ICE9PSBzdHJ1bmRlZmluZWQgKSB7CgkJCWJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgkJfQoJCXdpbiA9IGdldFdpbmRvdyggZG9jICk7CgkJcmV0dXJuIHsKCQkJdG9wOiBib3gudG9wICsgd2luLnBhZ2VZT2Zmc2V0IC0gZG9jRWxlbS5jbGllbnRUb3AsCgkJCWxlZnQ6IGJveC5sZWZ0ICsgd2luLnBhZ2VYT2Zmc2V0IC0gZG9jRWxlbS5jbGllbnRMZWZ0CgkJfTsKCX0sCgoJcG9zaXRpb246IGZ1bmN0aW9uKCkgewoJCWlmICggIXRoaXNbIDAgXSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIG9mZnNldFBhcmVudCwgb2Zmc2V0LAoJCQllbGVtID0gdGhpc1sgMCBdLAoJCQlwYXJlbnRPZmZzZXQgPSB7IHRvcDogMCwgbGVmdDogMCB9OwoKCQkvLyBGaXhlZCBlbGVtZW50cyBhcmUgb2Zmc2V0IGZyb20gd2luZG93IChwYXJlbnRPZmZzZXQgPSB7dG9wOjAsIGxlZnQ6IDB9LCBiZWNhdXNlIGl0IGlzIGl0cyBvbmx5IG9mZnNldCBwYXJlbnQKCQlpZiAoIGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKSA9PT0gImZpeGVkIiApIHsKCQkJLy8gQXNzdW1lIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBpcyB0aGVyZSB3aGVuIGNvbXB1dGVkIHBvc2l0aW9uIGlzIGZpeGVkCgkJCW9mZnNldCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgoJCX0gZWxzZSB7CgkJCS8vIEdldCAqcmVhbCogb2Zmc2V0UGFyZW50CgkJCW9mZnNldFBhcmVudCA9IHRoaXMub2Zmc2V0UGFyZW50KCk7CgoJCQkvLyBHZXQgY29ycmVjdCBvZmZzZXRzCgkJCW9mZnNldCA9IHRoaXMub2Zmc2V0KCk7CgkJCWlmICggIWpRdWVyeS5ub2RlTmFtZSggb2Zmc2V0UGFyZW50WyAwIF0sICJodG1sIiApICkgewoJCQkJcGFyZW50T2Zmc2V0ID0gb2Zmc2V0UGFyZW50Lm9mZnNldCgpOwoJCQl9CgoJCQkvLyBBZGQgb2Zmc2V0UGFyZW50IGJvcmRlcnMKCQkJcGFyZW50T2Zmc2V0LnRvcCArPSBqUXVlcnkuY3NzKCBvZmZzZXRQYXJlbnRbIDAgXSwgImJvcmRlclRvcFdpZHRoIiwgdHJ1ZSApOwoJCQlwYXJlbnRPZmZzZXQubGVmdCArPSBqUXVlcnkuY3NzKCBvZmZzZXRQYXJlbnRbIDAgXSwgImJvcmRlckxlZnRXaWR0aCIsIHRydWUgKTsKCQl9CgoJCS8vIFN1YnRyYWN0IHBhcmVudCBvZmZzZXRzIGFuZCBlbGVtZW50IG1hcmdpbnMKCQlyZXR1cm4gewoJCQl0b3A6IG9mZnNldC50b3AgLSBwYXJlbnRPZmZzZXQudG9wIC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpblRvcCIsIHRydWUgKSwKCQkJbGVmdDogb2Zmc2V0LmxlZnQgLSBwYXJlbnRPZmZzZXQubGVmdCAtIGpRdWVyeS5jc3MoIGVsZW0sICJtYXJnaW5MZWZ0IiwgdHJ1ZSApCgkJfTsKCX0sCgoJb2Zmc2V0UGFyZW50OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7CgkJCXZhciBvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCB8fCBkb2NFbGVtOwoKCQkJd2hpbGUgKCBvZmZzZXRQYXJlbnQgJiYgKCAhalF1ZXJ5Lm5vZGVOYW1lKCBvZmZzZXRQYXJlbnQsICJodG1sIiApICYmIGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudCwgInBvc2l0aW9uIiApID09PSAic3RhdGljIiApICkgewoJCQkJb2Zmc2V0UGFyZW50ID0gb2Zmc2V0UGFyZW50Lm9mZnNldFBhcmVudDsKCQkJfQoKCQkJcmV0dXJuIG9mZnNldFBhcmVudCB8fCBkb2NFbGVtOwoJCX0pOwoJfQp9KTsKCi8vIENyZWF0ZSBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgbWV0aG9kcwpqUXVlcnkuZWFjaCggeyBzY3JvbGxMZWZ0OiAicGFnZVhPZmZzZXQiLCBzY3JvbGxUb3A6ICJwYWdlWU9mZnNldCIgfSwgZnVuY3Rpb24oIG1ldGhvZCwgcHJvcCApIHsKCXZhciB0b3AgPSAicGFnZVlPZmZzZXQiID09PSBwcm9wOwoKCWpRdWVyeS5mblsgbWV0aG9kIF0gPSBmdW5jdGlvbiggdmFsICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBtZXRob2QsIHZhbCApIHsKCQkJdmFyIHdpbiA9IGdldFdpbmRvdyggZWxlbSApOwoKCQkJaWYgKCB2YWwgPT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiB3aW4gPyB3aW5bIHByb3AgXSA6IGVsZW1bIG1ldGhvZCBdOwoJCQl9CgoJCQlpZiAoIHdpbiApIHsKCQkJCXdpbi5zY3JvbGxUbygKCQkJCQkhdG9wID8gdmFsIDogd2luZG93LnBhZ2VYT2Zmc2V0LAoJCQkJCXRvcCA/IHZhbCA6IHdpbmRvdy5wYWdlWU9mZnNldAoJCQkJKTsKCgkJCX0gZWxzZSB7CgkJCQllbGVtWyBtZXRob2QgXSA9IHZhbDsKCQkJfQoJCX0sIG1ldGhvZCwgdmFsLCBhcmd1bWVudHMubGVuZ3RoLCBudWxsICk7Cgl9Owp9KTsKCi8vIFN1cHBvcnQ6IFNhZmFyaTw3KywgQ2hyb21lPDM3KwovLyBBZGQgdGhlIHRvcC9sZWZ0IGNzc0hvb2tzIHVzaW5nIGpRdWVyeS5mbi5wb3NpdGlvbgovLyBXZWJraXQgYnVnOiBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MjkwODQKLy8gQmxpbmsgYnVnOiBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MjI5MjgwCi8vIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyBwZXJjZW50IHdoZW4gc3BlY2lmaWVkIGZvciB0b3AvbGVmdC9ib3R0b20vcmlnaHQ7Ci8vIHJhdGhlciB0aGFuIG1ha2UgdGhlIGNzcyBtb2R1bGUgZGVwZW5kIG9uIHRoZSBvZmZzZXQgbW9kdWxlLCBqdXN0IGNoZWNrIGZvciBpdCBoZXJlCmpRdWVyeS5lYWNoKCBbICJ0b3AiLCAibGVmdCIgXSwgZnVuY3Rpb24oIGksIHByb3AgKSB7CglqUXVlcnkuY3NzSG9va3NbIHByb3AgXSA9IGFkZEdldEhvb2tJZiggc3VwcG9ydC5waXhlbFBvc2l0aW9uLAoJCWZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCWNvbXB1dGVkID0gY3VyQ1NTKCBlbGVtLCBwcm9wICk7CgkJCQkvLyBJZiBjdXJDU1MgcmV0dXJucyBwZXJjZW50YWdlLCBmYWxsYmFjayB0byBvZmZzZXQKCQkJCXJldHVybiBybnVtbm9ucHgudGVzdCggY29tcHV0ZWQgKSA/CgkJCQkJalF1ZXJ5KCBlbGVtICkucG9zaXRpb24oKVsgcHJvcCBdICsgInB4IiA6CgkJCQkJY29tcHV0ZWQ7CgkJCX0KCQl9CgkpOwp9KTsKCgovLyBDcmVhdGUgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIGhlaWdodCwgd2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHMKalF1ZXJ5LmVhY2goIHsgSGVpZ2h0OiAiaGVpZ2h0IiwgV2lkdGg6ICJ3aWR0aCIgfSwgZnVuY3Rpb24oIG5hbWUsIHR5cGUgKSB7CglqUXVlcnkuZWFjaCggeyBwYWRkaW5nOiAiaW5uZXIiICsgbmFtZSwgY29udGVudDogdHlwZSwgIiI6ICJvdXRlciIgKyBuYW1lIH0sIGZ1bmN0aW9uKCBkZWZhdWx0RXh0cmEsIGZ1bmNOYW1lICkgewoJCS8vIE1hcmdpbiBpcyBvbmx5IGZvciBvdXRlckhlaWdodCwgb3V0ZXJXaWR0aAoJCWpRdWVyeS5mblsgZnVuY05hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4sIHZhbHVlICkgewoJCQl2YXIgY2hhaW5hYmxlID0gYXJndW1lbnRzLmxlbmd0aCAmJiAoIGRlZmF1bHRFeHRyYSB8fCB0eXBlb2YgbWFyZ2luICE9PSAiYm9vbGVhbiIgKSwKCQkJCWV4dHJhID0gZGVmYXVsdEV4dHJhIHx8ICggbWFyZ2luID09PSB0cnVlIHx8IHZhbHVlID09PSB0cnVlID8gIm1hcmdpbiIgOiAiYm9yZGVyIiApOwoKCQkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIHR5cGUsIHZhbHVlICkgewoJCQkJdmFyIGRvYzsKCgkJCQlpZiAoIGpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoJCQkJCS8vIEFzIG9mIDUvOC8yMDEyIHRoaXMgd2lsbCB5aWVsZCBpbmNvcnJlY3QgcmVzdWx0cyBmb3IgTW9iaWxlIFNhZmFyaSwgYnV0IHRoZXJlCgkJCQkJLy8gaXNuJ3QgYSB3aG9sZSBsb3Qgd2UgY2FuIGRvLiBTZWUgcHVsbCByZXF1ZXN0IGF0IHRoaXMgVVJMIGZvciBkaXNjdXNzaW9uOgoJCQkJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5L3B1bGwvNzY0CgkJCQkJcmV0dXJuIGVsZW0uZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyAiY2xpZW50IiArIG5hbWUgXTsKCQkJCX0KCgkJCQkvLyBHZXQgZG9jdW1lbnQgd2lkdGggb3IgaGVpZ2h0CgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDkgKSB7CgkJCQkJZG9jID0gZWxlbS5kb2N1bWVudEVsZW1lbnQ7CgoJCQkJCS8vIEVpdGhlciBzY3JvbGxbV2lkdGgvSGVpZ2h0XSBvciBvZmZzZXRbV2lkdGgvSGVpZ2h0XSBvciBjbGllbnRbV2lkdGgvSGVpZ2h0XSwKCQkJCQkvLyB3aGljaGV2ZXIgaXMgZ3JlYXRlc3QKCQkJCQlyZXR1cm4gTWF0aC5tYXgoCgkJCQkJCWVsZW0uYm9keVsgInNjcm9sbCIgKyBuYW1lIF0sIGRvY1sgInNjcm9sbCIgKyBuYW1lIF0sCgkJCQkJCWVsZW0uYm9keVsgIm9mZnNldCIgKyBuYW1lIF0sIGRvY1sgIm9mZnNldCIgKyBuYW1lIF0sCgkJCQkJCWRvY1sgImNsaWVudCIgKyBuYW1lIF0KCQkJCQkpOwoJCQkJfQoKCQkJCXJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8KCQkJCQkvLyBHZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50LCByZXF1ZXN0aW5nIGJ1dCBub3QgZm9yY2luZyBwYXJzZUZsb2F0CgkJCQkJalF1ZXJ5LmNzcyggZWxlbSwgdHlwZSwgZXh0cmEgKSA6CgoJCQkJCS8vIFNldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQKCQkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHR5cGUsIHZhbHVlLCBleHRyYSApOwoJCQl9LCB0eXBlLCBjaGFpbmFibGUgPyBtYXJnaW4gOiB1bmRlZmluZWQsIGNoYWluYWJsZSwgbnVsbCApOwoJCX07Cgl9KTsKfSk7CgoKLy8gVGhlIG51bWJlciBvZiBlbGVtZW50cyBjb250YWluZWQgaW4gdGhlIG1hdGNoZWQgZWxlbWVudCBzZXQKalF1ZXJ5LmZuLnNpemUgPSBmdW5jdGlvbigpIHsKCXJldHVybiB0aGlzLmxlbmd0aDsKfTsKCmpRdWVyeS5mbi5hbmRTZWxmID0galF1ZXJ5LmZuLmFkZEJhY2s7CgoKCgovLyBSZWdpc3RlciBhcyBhIG5hbWVkIEFNRCBtb2R1bGUsIHNpbmNlIGpRdWVyeSBjYW4gYmUgY29uY2F0ZW5hdGVkIHdpdGggb3RoZXIKLy8gZmlsZXMgdGhhdCBtYXkgdXNlIGRlZmluZSwgYnV0IG5vdCB2aWEgYSBwcm9wZXIgY29uY2F0ZW5hdGlvbiBzY3JpcHQgdGhhdAovLyB1bmRlcnN0YW5kcyBhbm9ueW1vdXMgQU1EIG1vZHVsZXMuIEEgbmFtZWQgQU1EIGlzIHNhZmVzdCBhbmQgbW9zdCByb2J1c3QKLy8gd2F5IHRvIHJlZ2lzdGVyLiBMb3dlcmNhc2UganF1ZXJ5IGlzIHVzZWQgYmVjYXVzZSBBTUQgbW9kdWxlIG5hbWVzIGFyZQovLyBkZXJpdmVkIGZyb20gZmlsZSBuYW1lcywgYW5kIGpRdWVyeSBpcyBub3JtYWxseSBkZWxpdmVyZWQgaW4gYSBsb3dlcmNhc2UKLy8gZmlsZSBuYW1lLiBEbyB0aGlzIGFmdGVyIGNyZWF0aW5nIHRoZSBnbG9iYWwgc28gdGhhdCBpZiBhbiBBTUQgbW9kdWxlIHdhbnRzCi8vIHRvIGNhbGwgbm9Db25mbGljdCB0byBoaWRlIHRoaXMgdmVyc2lvbiBvZiBqUXVlcnksIGl0IHdpbGwgd29yay4KCi8vIE5vdGUgdGhhdCBmb3IgbWF4aW11bSBwb3J0YWJpbGl0eSwgbGlicmFyaWVzIHRoYXQgYXJlIG5vdCBqUXVlcnkgc2hvdWxkCi8vIGRlY2xhcmUgdGhlbXNlbHZlcyBhcyBhbm9ueW1vdXMgbW9kdWxlcywgYW5kIGF2b2lkIHNldHRpbmcgYSBnbG9iYWwgaWYgYW4KLy8gQU1EIGxvYWRlciBpcyBwcmVzZW50LiBqUXVlcnkgaXMgYSBzcGVjaWFsIGNhc2UuIEZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUKLy8gaHR0cHM6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzL3dpa2kvVXBkYXRpbmctZXhpc3RpbmctbGlicmFyaWVzI3dpa2ktYW5vbgoKaWYgKCB0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQgKSB7CglkZWZpbmUoICJqcXVlcnkiLCBbXSwgZnVuY3Rpb24oKSB7CgkJcmV0dXJuIGpRdWVyeTsKCX0pOwp9CgoKCgp2YXIKCS8vIE1hcCBvdmVyIGpRdWVyeSBpbiBjYXNlIG9mIG92ZXJ3cml0ZQoJX2pRdWVyeSA9IHdpbmRvdy5qUXVlcnksCgoJLy8gTWFwIG92ZXIgdGhlICQgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCV8kID0gd2luZG93LiQ7CgpqUXVlcnkubm9Db25mbGljdCA9IGZ1bmN0aW9uKCBkZWVwICkgewoJaWYgKCB3aW5kb3cuJCA9PT0galF1ZXJ5ICkgewoJCXdpbmRvdy4kID0gXyQ7Cgl9CgoJaWYgKCBkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSApIHsKCQl3aW5kb3cualF1ZXJ5ID0gX2pRdWVyeTsKCX0KCglyZXR1cm4galF1ZXJ5Owp9OwoKLy8gRXhwb3NlIGpRdWVyeSBhbmQgJCBpZGVudGlmaWVycywgZXZlbiBpbiBBTUQKLy8gKCM3MTAyI2NvbW1lbnQ6MTAsIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5L3B1bGwvNTU3KQovLyBhbmQgQ29tbW9uSlMgZm9yIGJyb3dzZXIgZW11bGF0b3JzICgjMTM1NjYpCmlmICggdHlwZW9mIG5vR2xvYmFsID09PSBzdHJ1bmRlZmluZWQgKSB7Cgl3aW5kb3cualF1ZXJ5ID0gd2luZG93LiQgPSBqUXVlcnk7Cn0KCgoKCnJldHVybiBqUXVlcnk7Cgp9KSk7Cg=="></script>
<script src="data:application/x-javascript;base64,Ly8gVGhpcyBwcm9kdWN0IGluY2x1ZGVzIGNvbG9yIHNwZWNpZmljYXRpb25zIGFuZCBkZXNpZ25zIGRldmVsb3BlZCBieSBDeW50aGlhIEJyZXdlciAoaHR0cDovL2NvbG9yYnJld2VyLm9yZy8pLgp2YXIgY29sb3JicmV3ZXIgPSB7WWxHbjogewozOiBbIiNmN2ZjYjkiLCIjYWRkZDhlIiwiIzMxYTM1NCJdLAo0OiBbIiNmZmZmY2MiLCIjYzJlNjk5IiwiIzc4YzY3OSIsIiMyMzg0NDMiXSwKNTogWyIjZmZmZmNjIiwiI2MyZTY5OSIsIiM3OGM2NzkiLCIjMzFhMzU0IiwiIzAwNjgzNyJdLAo2OiBbIiNmZmZmY2MiLCIjZDlmMGEzIiwiI2FkZGQ4ZSIsIiM3OGM2NzkiLCIjMzFhMzU0IiwiIzAwNjgzNyJdLAo3OiBbIiNmZmZmY2MiLCIjZDlmMGEzIiwiI2FkZGQ4ZSIsIiM3OGM2NzkiLCIjNDFhYjVkIiwiIzIzODQ0MyIsIiMwMDVhMzIiXSwKODogWyIjZmZmZmU1IiwiI2Y3ZmNiOSIsIiNkOWYwYTMiLCIjYWRkZDhlIiwiIzc4YzY3OSIsIiM0MWFiNWQiLCIjMjM4NDQzIiwiIzAwNWEzMiJdLAo5OiBbIiNmZmZmZTUiLCIjZjdmY2I5IiwiI2Q5ZjBhMyIsIiNhZGRkOGUiLCIjNzhjNjc5IiwiIzQxYWI1ZCIsIiMyMzg0NDMiLCIjMDA2ODM3IiwiIzAwNDUyOSJdCn0sWWxHbkJ1OiB7CjM6IFsiI2VkZjhiMSIsIiM3ZmNkYmIiLCIjMmM3ZmI4Il0sCjQ6IFsiI2ZmZmZjYyIsIiNhMWRhYjQiLCIjNDFiNmM0IiwiIzIyNWVhOCJdLAo1OiBbIiNmZmZmY2MiLCIjYTFkYWI0IiwiIzQxYjZjNCIsIiMyYzdmYjgiLCIjMjUzNDk0Il0sCjY6IFsiI2ZmZmZjYyIsIiNjN2U5YjQiLCIjN2ZjZGJiIiwiIzQxYjZjNCIsIiMyYzdmYjgiLCIjMjUzNDk0Il0sCjc6IFsiI2ZmZmZjYyIsIiNjN2U5YjQiLCIjN2ZjZGJiIiwiIzQxYjZjNCIsIiMxZDkxYzAiLCIjMjI1ZWE4IiwiIzBjMmM4NCJdLAo4OiBbIiNmZmZmZDkiLCIjZWRmOGIxIiwiI2M3ZTliNCIsIiM3ZmNkYmIiLCIjNDFiNmM0IiwiIzFkOTFjMCIsIiMyMjVlYTgiLCIjMGMyYzg0Il0sCjk6IFsiI2ZmZmZkOSIsIiNlZGY4YjEiLCIjYzdlOWI0IiwiIzdmY2RiYiIsIiM0MWI2YzQiLCIjMWQ5MWMwIiwiIzIyNWVhOCIsIiMyNTM0OTQiLCIjMDgxZDU4Il0KfSxHbkJ1OiB7CjM6IFsiI2UwZjNkYiIsIiNhOGRkYjUiLCIjNDNhMmNhIl0sCjQ6IFsiI2YwZjllOCIsIiNiYWU0YmMiLCIjN2JjY2M0IiwiIzJiOGNiZSJdLAo1OiBbIiNmMGY5ZTgiLCIjYmFlNGJjIiwiIzdiY2NjNCIsIiM0M2EyY2EiLCIjMDg2OGFjIl0sCjY6IFsiI2YwZjllOCIsIiNjY2ViYzUiLCIjYThkZGI1IiwiIzdiY2NjNCIsIiM0M2EyY2EiLCIjMDg2OGFjIl0sCjc6IFsiI2YwZjllOCIsIiNjY2ViYzUiLCIjYThkZGI1IiwiIzdiY2NjNCIsIiM0ZWIzZDMiLCIjMmI4Y2JlIiwiIzA4NTg5ZSJdLAo4OiBbIiNmN2ZjZjAiLCIjZTBmM2RiIiwiI2NjZWJjNSIsIiNhOGRkYjUiLCIjN2JjY2M0IiwiIzRlYjNkMyIsIiMyYjhjYmUiLCIjMDg1ODllIl0sCjk6IFsiI2Y3ZmNmMCIsIiNlMGYzZGIiLCIjY2NlYmM1IiwiI2E4ZGRiNSIsIiM3YmNjYzQiLCIjNGViM2QzIiwiIzJiOGNiZSIsIiMwODY4YWMiLCIjMDg0MDgxIl0KfSxCdUduOiB7CjM6IFsiI2U1ZjVmOSIsIiM5OWQ4YzkiLCIjMmNhMjVmIl0sCjQ6IFsiI2VkZjhmYiIsIiNiMmUyZTIiLCIjNjZjMmE0IiwiIzIzOGI0NSJdLAo1OiBbIiNlZGY4ZmIiLCIjYjJlMmUyIiwiIzY2YzJhNCIsIiMyY2EyNWYiLCIjMDA2ZDJjIl0sCjY6IFsiI2VkZjhmYiIsIiNjY2VjZTYiLCIjOTlkOGM5IiwiIzY2YzJhNCIsIiMyY2EyNWYiLCIjMDA2ZDJjIl0sCjc6IFsiI2VkZjhmYiIsIiNjY2VjZTYiLCIjOTlkOGM5IiwiIzY2YzJhNCIsIiM0MWFlNzYiLCIjMjM4YjQ1IiwiIzAwNTgyNCJdLAo4OiBbIiNmN2ZjZmQiLCIjZTVmNWY5IiwiI2NjZWNlNiIsIiM5OWQ4YzkiLCIjNjZjMmE0IiwiIzQxYWU3NiIsIiMyMzhiNDUiLCIjMDA1ODI0Il0sCjk6IFsiI2Y3ZmNmZCIsIiNlNWY1ZjkiLCIjY2NlY2U2IiwiIzk5ZDhjOSIsIiM2NmMyYTQiLCIjNDFhZTc2IiwiIzIzOGI0NSIsIiMwMDZkMmMiLCIjMDA0NDFiIl0KfSxQdUJ1R246IHsKMzogWyIjZWNlMmYwIiwiI2E2YmRkYiIsIiMxYzkwOTkiXSwKNDogWyIjZjZlZmY3IiwiI2JkYzllMSIsIiM2N2E5Y2YiLCIjMDI4MThhIl0sCjU6IFsiI2Y2ZWZmNyIsIiNiZGM5ZTEiLCIjNjdhOWNmIiwiIzFjOTA5OSIsIiMwMTZjNTkiXSwKNjogWyIjZjZlZmY3IiwiI2QwZDFlNiIsIiNhNmJkZGIiLCIjNjdhOWNmIiwiIzFjOTA5OSIsIiMwMTZjNTkiXSwKNzogWyIjZjZlZmY3IiwiI2QwZDFlNiIsIiNhNmJkZGIiLCIjNjdhOWNmIiwiIzM2OTBjMCIsIiMwMjgxOGEiLCIjMDE2NDUwIl0sCjg6IFsiI2ZmZjdmYiIsIiNlY2UyZjAiLCIjZDBkMWU2IiwiI2E2YmRkYiIsIiM2N2E5Y2YiLCIjMzY5MGMwIiwiIzAyODE4YSIsIiMwMTY0NTAiXSwKOTogWyIjZmZmN2ZiIiwiI2VjZTJmMCIsIiNkMGQxZTYiLCIjYTZiZGRiIiwiIzY3YTljZiIsIiMzNjkwYzAiLCIjMDI4MThhIiwiIzAxNmM1OSIsIiMwMTQ2MzYiXQp9LFB1QnU6IHsKMzogWyIjZWNlN2YyIiwiI2E2YmRkYiIsIiMyYjhjYmUiXSwKNDogWyIjZjFlZWY2IiwiI2JkYzllMSIsIiM3NGE5Y2YiLCIjMDU3MGIwIl0sCjU6IFsiI2YxZWVmNiIsIiNiZGM5ZTEiLCIjNzRhOWNmIiwiIzJiOGNiZSIsIiMwNDVhOGQiXSwKNjogWyIjZjFlZWY2IiwiI2QwZDFlNiIsIiNhNmJkZGIiLCIjNzRhOWNmIiwiIzJiOGNiZSIsIiMwNDVhOGQiXSwKNzogWyIjZjFlZWY2IiwiI2QwZDFlNiIsIiNhNmJkZGIiLCIjNzRhOWNmIiwiIzM2OTBjMCIsIiMwNTcwYjAiLCIjMDM0ZTdiIl0sCjg6IFsiI2ZmZjdmYiIsIiNlY2U3ZjIiLCIjZDBkMWU2IiwiI2E2YmRkYiIsIiM3NGE5Y2YiLCIjMzY5MGMwIiwiIzA1NzBiMCIsIiMwMzRlN2IiXSwKOTogWyIjZmZmN2ZiIiwiI2VjZTdmMiIsIiNkMGQxZTYiLCIjYTZiZGRiIiwiIzc0YTljZiIsIiMzNjkwYzAiLCIjMDU3MGIwIiwiIzA0NWE4ZCIsIiMwMjM4NTgiXQp9LEJ1UHU6IHsKMzogWyIjZTBlY2Y0IiwiIzllYmNkYSIsIiM4ODU2YTciXSwKNDogWyIjZWRmOGZiIiwiI2IzY2RlMyIsIiM4Yzk2YzYiLCIjODg0MTlkIl0sCjU6IFsiI2VkZjhmYiIsIiNiM2NkZTMiLCIjOGM5NmM2IiwiIzg4NTZhNyIsIiM4MTBmN2MiXSwKNjogWyIjZWRmOGZiIiwiI2JmZDNlNiIsIiM5ZWJjZGEiLCIjOGM5NmM2IiwiIzg4NTZhNyIsIiM4MTBmN2MiXSwKNzogWyIjZWRmOGZiIiwiI2JmZDNlNiIsIiM5ZWJjZGEiLCIjOGM5NmM2IiwiIzhjNmJiMSIsIiM4ODQxOWQiLCIjNmUwMTZiIl0sCjg6IFsiI2Y3ZmNmZCIsIiNlMGVjZjQiLCIjYmZkM2U2IiwiIzllYmNkYSIsIiM4Yzk2YzYiLCIjOGM2YmIxIiwiIzg4NDE5ZCIsIiM2ZTAxNmIiXSwKOTogWyIjZjdmY2ZkIiwiI2UwZWNmNCIsIiNiZmQzZTYiLCIjOWViY2RhIiwiIzhjOTZjNiIsIiM4YzZiYjEiLCIjODg0MTlkIiwiIzgxMGY3YyIsIiM0ZDAwNGIiXQp9LFJkUHU6IHsKMzogWyIjZmRlMGRkIiwiI2ZhOWZiNSIsIiNjNTFiOGEiXSwKNDogWyIjZmVlYmUyIiwiI2ZiYjRiOSIsIiNmNzY4YTEiLCIjYWUwMTdlIl0sCjU6IFsiI2ZlZWJlMiIsIiNmYmI0YjkiLCIjZjc2OGExIiwiI2M1MWI4YSIsIiM3YTAxNzciXSwKNjogWyIjZmVlYmUyIiwiI2ZjYzVjMCIsIiNmYTlmYjUiLCIjZjc2OGExIiwiI2M1MWI4YSIsIiM3YTAxNzciXSwKNzogWyIjZmVlYmUyIiwiI2ZjYzVjMCIsIiNmYTlmYjUiLCIjZjc2OGExIiwiI2RkMzQ5NyIsIiNhZTAxN2UiLCIjN2EwMTc3Il0sCjg6IFsiI2ZmZjdmMyIsIiNmZGUwZGQiLCIjZmNjNWMwIiwiI2ZhOWZiNSIsIiNmNzY4YTEiLCIjZGQzNDk3IiwiI2FlMDE3ZSIsIiM3YTAxNzciXSwKOTogWyIjZmZmN2YzIiwiI2ZkZTBkZCIsIiNmY2M1YzAiLCIjZmE5ZmI1IiwiI2Y3NjhhMSIsIiNkZDM0OTciLCIjYWUwMTdlIiwiIzdhMDE3NyIsIiM0OTAwNmEiXQp9LFB1UmQ6IHsKMzogWyIjZTdlMWVmIiwiI2M5OTRjNyIsIiNkZDFjNzciXSwKNDogWyIjZjFlZWY2IiwiI2Q3YjVkOCIsIiNkZjY1YjAiLCIjY2UxMjU2Il0sCjU6IFsiI2YxZWVmNiIsIiNkN2I1ZDgiLCIjZGY2NWIwIiwiI2RkMWM3NyIsIiM5ODAwNDMiXSwKNjogWyIjZjFlZWY2IiwiI2Q0YjlkYSIsIiNjOTk0YzciLCIjZGY2NWIwIiwiI2RkMWM3NyIsIiM5ODAwNDMiXSwKNzogWyIjZjFlZWY2IiwiI2Q0YjlkYSIsIiNjOTk0YzciLCIjZGY2NWIwIiwiI2U3Mjk4YSIsIiNjZTEyNTYiLCIjOTEwMDNmIl0sCjg6IFsiI2Y3ZjRmOSIsIiNlN2UxZWYiLCIjZDRiOWRhIiwiI2M5OTRjNyIsIiNkZjY1YjAiLCIjZTcyOThhIiwiI2NlMTI1NiIsIiM5MTAwM2YiXSwKOTogWyIjZjdmNGY5IiwiI2U3ZTFlZiIsIiNkNGI5ZGEiLCIjYzk5NGM3IiwiI2RmNjViMCIsIiNlNzI5OGEiLCIjY2UxMjU2IiwiIzk4MDA0MyIsIiM2NzAwMWYiXQp9LE9yUmQ6IHsKMzogWyIjZmVlOGM4IiwiI2ZkYmI4NCIsIiNlMzRhMzMiXSwKNDogWyIjZmVmMGQ5IiwiI2ZkY2M4YSIsIiNmYzhkNTkiLCIjZDczMDFmIl0sCjU6IFsiI2ZlZjBkOSIsIiNmZGNjOGEiLCIjZmM4ZDU5IiwiI2UzNGEzMyIsIiNiMzAwMDAiXSwKNjogWyIjZmVmMGQ5IiwiI2ZkZDQ5ZSIsIiNmZGJiODQiLCIjZmM4ZDU5IiwiI2UzNGEzMyIsIiNiMzAwMDAiXSwKNzogWyIjZmVmMGQ5IiwiI2ZkZDQ5ZSIsIiNmZGJiODQiLCIjZmM4ZDU5IiwiI2VmNjU0OCIsIiNkNzMwMWYiLCIjOTkwMDAwIl0sCjg6IFsiI2ZmZjdlYyIsIiNmZWU4YzgiLCIjZmRkNDllIiwiI2ZkYmI4NCIsIiNmYzhkNTkiLCIjZWY2NTQ4IiwiI2Q3MzAxZiIsIiM5OTAwMDAiXSwKOTogWyIjZmZmN2VjIiwiI2ZlZThjOCIsIiNmZGQ0OWUiLCIjZmRiYjg0IiwiI2ZjOGQ1OSIsIiNlZjY1NDgiLCIjZDczMDFmIiwiI2IzMDAwMCIsIiM3ZjAwMDAiXQp9LFlsT3JSZDogewozOiBbIiNmZmVkYTAiLCIjZmViMjRjIiwiI2YwM2IyMCJdLAo0OiBbIiNmZmZmYjIiLCIjZmVjYzVjIiwiI2ZkOGQzYyIsIiNlMzFhMWMiXSwKNTogWyIjZmZmZmIyIiwiI2ZlY2M1YyIsIiNmZDhkM2MiLCIjZjAzYjIwIiwiI2JkMDAyNiJdLAo2OiBbIiNmZmZmYjIiLCIjZmVkOTc2IiwiI2ZlYjI0YyIsIiNmZDhkM2MiLCIjZjAzYjIwIiwiI2JkMDAyNiJdLAo3OiBbIiNmZmZmYjIiLCIjZmVkOTc2IiwiI2ZlYjI0YyIsIiNmZDhkM2MiLCIjZmM0ZTJhIiwiI2UzMWExYyIsIiNiMTAwMjYiXSwKODogWyIjZmZmZmNjIiwiI2ZmZWRhMCIsIiNmZWQ5NzYiLCIjZmViMjRjIiwiI2ZkOGQzYyIsIiNmYzRlMmEiLCIjZTMxYTFjIiwiI2IxMDAyNiJdLAo5OiBbIiNmZmZmY2MiLCIjZmZlZGEwIiwiI2ZlZDk3NiIsIiNmZWIyNGMiLCIjZmQ4ZDNjIiwiI2ZjNGUyYSIsIiNlMzFhMWMiLCIjYmQwMDI2IiwiIzgwMDAyNiJdCn0sWWxPckJyOiB7CjM6IFsiI2ZmZjdiYyIsIiNmZWM0NGYiLCIjZDk1ZjBlIl0sCjQ6IFsiI2ZmZmZkNCIsIiNmZWQ5OGUiLCIjZmU5OTI5IiwiI2NjNGMwMiJdLAo1OiBbIiNmZmZmZDQiLCIjZmVkOThlIiwiI2ZlOTkyOSIsIiNkOTVmMGUiLCIjOTkzNDA0Il0sCjY6IFsiI2ZmZmZkNCIsIiNmZWUzOTEiLCIjZmVjNDRmIiwiI2ZlOTkyOSIsIiNkOTVmMGUiLCIjOTkzNDA0Il0sCjc6IFsiI2ZmZmZkNCIsIiNmZWUzOTEiLCIjZmVjNDRmIiwiI2ZlOTkyOSIsIiNlYzcwMTQiLCIjY2M0YzAyIiwiIzhjMmQwNCJdLAo4OiBbIiNmZmZmZTUiLCIjZmZmN2JjIiwiI2ZlZTM5MSIsIiNmZWM0NGYiLCIjZmU5OTI5IiwiI2VjNzAxNCIsIiNjYzRjMDIiLCIjOGMyZDA0Il0sCjk6IFsiI2ZmZmZlNSIsIiNmZmY3YmMiLCIjZmVlMzkxIiwiI2ZlYzQ0ZiIsIiNmZTk5MjkiLCIjZWM3MDE0IiwiI2NjNGMwMiIsIiM5OTM0MDQiLCIjNjYyNTA2Il0KfSxQdXJwbGVzOiB7CjM6IFsiI2VmZWRmNSIsIiNiY2JkZGMiLCIjNzU2YmIxIl0sCjQ6IFsiI2YyZjBmNyIsIiNjYmM5ZTIiLCIjOWU5YWM4IiwiIzZhNTFhMyJdLAo1OiBbIiNmMmYwZjciLCIjY2JjOWUyIiwiIzllOWFjOCIsIiM3NTZiYjEiLCIjNTQyNzhmIl0sCjY6IFsiI2YyZjBmNyIsIiNkYWRhZWIiLCIjYmNiZGRjIiwiIzllOWFjOCIsIiM3NTZiYjEiLCIjNTQyNzhmIl0sCjc6IFsiI2YyZjBmNyIsIiNkYWRhZWIiLCIjYmNiZGRjIiwiIzllOWFjOCIsIiM4MDdkYmEiLCIjNmE1MWEzIiwiIzRhMTQ4NiJdLAo4OiBbIiNmY2ZiZmQiLCIjZWZlZGY1IiwiI2RhZGFlYiIsIiNiY2JkZGMiLCIjOWU5YWM4IiwiIzgwN2RiYSIsIiM2YTUxYTMiLCIjNGExNDg2Il0sCjk6IFsiI2ZjZmJmZCIsIiNlZmVkZjUiLCIjZGFkYWViIiwiI2JjYmRkYyIsIiM5ZTlhYzgiLCIjODA3ZGJhIiwiIzZhNTFhMyIsIiM1NDI3OGYiLCIjM2YwMDdkIl0KfSxCbHVlczogewozOiBbIiNkZWViZjciLCIjOWVjYWUxIiwiIzMxODJiZCJdLAo0OiBbIiNlZmYzZmYiLCIjYmRkN2U3IiwiIzZiYWVkNiIsIiMyMTcxYjUiXSwKNTogWyIjZWZmM2ZmIiwiI2JkZDdlNyIsIiM2YmFlZDYiLCIjMzE4MmJkIiwiIzA4NTE5YyJdLAo2OiBbIiNlZmYzZmYiLCIjYzZkYmVmIiwiIzllY2FlMSIsIiM2YmFlZDYiLCIjMzE4MmJkIiwiIzA4NTE5YyJdLAo3OiBbIiNlZmYzZmYiLCIjYzZkYmVmIiwiIzllY2FlMSIsIiM2YmFlZDYiLCIjNDI5MmM2IiwiIzIxNzFiNSIsIiMwODQ1OTQiXSwKODogWyIjZjdmYmZmIiwiI2RlZWJmNyIsIiNjNmRiZWYiLCIjOWVjYWUxIiwiIzZiYWVkNiIsIiM0MjkyYzYiLCIjMjE3MWI1IiwiIzA4NDU5NCJdLAo5OiBbIiNmN2ZiZmYiLCIjZGVlYmY3IiwiI2M2ZGJlZiIsIiM5ZWNhZTEiLCIjNmJhZWQ2IiwiIzQyOTJjNiIsIiMyMTcxYjUiLCIjMDg1MTljIiwiIzA4MzA2YiJdCn0sR3JlZW5zOiB7CjM6IFsiI2U1ZjVlMCIsIiNhMWQ5OWIiLCIjMzFhMzU0Il0sCjQ6IFsiI2VkZjhlOSIsIiNiYWU0YjMiLCIjNzRjNDc2IiwiIzIzOGI0NSJdLAo1OiBbIiNlZGY4ZTkiLCIjYmFlNGIzIiwiIzc0YzQ3NiIsIiMzMWEzNTQiLCIjMDA2ZDJjIl0sCjY6IFsiI2VkZjhlOSIsIiNjN2U5YzAiLCIjYTFkOTliIiwiIzc0YzQ3NiIsIiMzMWEzNTQiLCIjMDA2ZDJjIl0sCjc6IFsiI2VkZjhlOSIsIiNjN2U5YzAiLCIjYTFkOTliIiwiIzc0YzQ3NiIsIiM0MWFiNWQiLCIjMjM4YjQ1IiwiIzAwNWEzMiJdLAo4OiBbIiNmN2ZjZjUiLCIjZTVmNWUwIiwiI2M3ZTljMCIsIiNhMWQ5OWIiLCIjNzRjNDc2IiwiIzQxYWI1ZCIsIiMyMzhiNDUiLCIjMDA1YTMyIl0sCjk6IFsiI2Y3ZmNmNSIsIiNlNWY1ZTAiLCIjYzdlOWMwIiwiI2ExZDk5YiIsIiM3NGM0NzYiLCIjNDFhYjVkIiwiIzIzOGI0NSIsIiMwMDZkMmMiLCIjMDA0NDFiIl0KfSxPcmFuZ2VzOiB7CjM6IFsiI2ZlZTZjZSIsIiNmZGFlNmIiLCIjZTY1NTBkIl0sCjQ6IFsiI2ZlZWRkZSIsIiNmZGJlODUiLCIjZmQ4ZDNjIiwiI2Q5NDcwMSJdLAo1OiBbIiNmZWVkZGUiLCIjZmRiZTg1IiwiI2ZkOGQzYyIsIiNlNjU1MGQiLCIjYTYzNjAzIl0sCjY6IFsiI2ZlZWRkZSIsIiNmZGQwYTIiLCIjZmRhZTZiIiwiI2ZkOGQzYyIsIiNlNjU1MGQiLCIjYTYzNjAzIl0sCjc6IFsiI2ZlZWRkZSIsIiNmZGQwYTIiLCIjZmRhZTZiIiwiI2ZkOGQzYyIsIiNmMTY5MTMiLCIjZDk0ODAxIiwiIzhjMmQwNCJdLAo4OiBbIiNmZmY1ZWIiLCIjZmVlNmNlIiwiI2ZkZDBhMiIsIiNmZGFlNmIiLCIjZmQ4ZDNjIiwiI2YxNjkxMyIsIiNkOTQ4MDEiLCIjOGMyZDA0Il0sCjk6IFsiI2ZmZjVlYiIsIiNmZWU2Y2UiLCIjZmRkMGEyIiwiI2ZkYWU2YiIsIiNmZDhkM2MiLCIjZjE2OTEzIiwiI2Q5NDgwMSIsIiNhNjM2MDMiLCIjN2YyNzA0Il0KfSxSZWRzOiB7CjM6IFsiI2ZlZTBkMiIsIiNmYzkyNzIiLCIjZGUyZDI2Il0sCjQ6IFsiI2ZlZTVkOSIsIiNmY2FlOTEiLCIjZmI2YTRhIiwiI2NiMTgxZCJdLAo1OiBbIiNmZWU1ZDkiLCIjZmNhZTkxIiwiI2ZiNmE0YSIsIiNkZTJkMjYiLCIjYTUwZjE1Il0sCjY6IFsiI2ZlZTVkOSIsIiNmY2JiYTEiLCIjZmM5MjcyIiwiI2ZiNmE0YSIsIiNkZTJkMjYiLCIjYTUwZjE1Il0sCjc6IFsiI2ZlZTVkOSIsIiNmY2JiYTEiLCIjZmM5MjcyIiwiI2ZiNmE0YSIsIiNlZjNiMmMiLCIjY2IxODFkIiwiIzk5MDAwZCJdLAo4OiBbIiNmZmY1ZjAiLCIjZmVlMGQyIiwiI2ZjYmJhMSIsIiNmYzkyNzIiLCIjZmI2YTRhIiwiI2VmM2IyYyIsIiNjYjE4MWQiLCIjOTkwMDBkIl0sCjk6IFsiI2ZmZjVmMCIsIiNmZWUwZDIiLCIjZmNiYmExIiwiI2ZjOTI3MiIsIiNmYjZhNGEiLCIjZWYzYjJjIiwiI2NiMTgxZCIsIiNhNTBmMTUiLCIjNjcwMDBkIl0KfSxHcmV5czogewozOiBbIiNmMGYwZjAiLCIjYmRiZGJkIiwiIzYzNjM2MyJdLAo0OiBbIiNmN2Y3ZjciLCIjY2NjY2NjIiwiIzk2OTY5NiIsIiM1MjUyNTIiXSwKNTogWyIjZjdmN2Y3IiwiI2NjY2NjYyIsIiM5Njk2OTYiLCIjNjM2MzYzIiwiIzI1MjUyNSJdLAo2OiBbIiNmN2Y3ZjciLCIjZDlkOWQ5IiwiI2JkYmRiZCIsIiM5Njk2OTYiLCIjNjM2MzYzIiwiIzI1MjUyNSJdLAo3OiBbIiNmN2Y3ZjciLCIjZDlkOWQ5IiwiI2JkYmRiZCIsIiM5Njk2OTYiLCIjNzM3MzczIiwiIzUyNTI1MiIsIiMyNTI1MjUiXSwKODogWyIjZmZmZmZmIiwiI2YwZjBmMCIsIiNkOWQ5ZDkiLCIjYmRiZGJkIiwiIzk2OTY5NiIsIiM3MzczNzMiLCIjNTI1MjUyIiwiIzI1MjUyNSJdLAo5OiBbIiNmZmZmZmYiLCIjZjBmMGYwIiwiI2Q5ZDlkOSIsIiNiZGJkYmQiLCIjOTY5Njk2IiwiIzczNzM3MyIsIiM1MjUyNTIiLCIjMjUyNTI1IiwiIzAwMDAwMCJdCn0sUHVPcjogewozOiBbIiNmMWEzNDAiLCIjZjdmN2Y3IiwiIzk5OGVjMyJdLAo0OiBbIiNlNjYxMDEiLCIjZmRiODYzIiwiI2IyYWJkMiIsIiM1ZTNjOTkiXSwKNTogWyIjZTY2MTAxIiwiI2ZkYjg2MyIsIiNmN2Y3ZjciLCIjYjJhYmQyIiwiIzVlM2M5OSJdLAo2OiBbIiNiMzU4MDYiLCIjZjFhMzQwIiwiI2ZlZTBiNiIsIiNkOGRhZWIiLCIjOTk4ZWMzIiwiIzU0Mjc4OCJdLAo3OiBbIiNiMzU4MDYiLCIjZjFhMzQwIiwiI2ZlZTBiNiIsIiNmN2Y3ZjciLCIjZDhkYWViIiwiIzk5OGVjMyIsIiM1NDI3ODgiXSwKODogWyIjYjM1ODA2IiwiI2UwODIxNCIsIiNmZGI4NjMiLCIjZmVlMGI2IiwiI2Q4ZGFlYiIsIiNiMmFiZDIiLCIjODA3M2FjIiwiIzU0Mjc4OCJdLAo5OiBbIiNiMzU4MDYiLCIjZTA4MjE0IiwiI2ZkYjg2MyIsIiNmZWUwYjYiLCIjZjdmN2Y3IiwiI2Q4ZGFlYiIsIiNiMmFiZDIiLCIjODA3M2FjIiwiIzU0Mjc4OCJdLAoxMDogWyIjN2YzYjA4IiwiI2IzNTgwNiIsIiNlMDgyMTQiLCIjZmRiODYzIiwiI2ZlZTBiNiIsIiNkOGRhZWIiLCIjYjJhYmQyIiwiIzgwNzNhYyIsIiM1NDI3ODgiLCIjMmQwMDRiIl0sCjExOiBbIiM3ZjNiMDgiLCIjYjM1ODA2IiwiI2UwODIxNCIsIiNmZGI4NjMiLCIjZmVlMGI2IiwiI2Y3ZjdmNyIsIiNkOGRhZWIiLCIjYjJhYmQyIiwiIzgwNzNhYyIsIiM1NDI3ODgiLCIjMmQwMDRiIl0KfSxCckJHOiB7CjM6IFsiI2Q4YjM2NSIsIiNmNWY1ZjUiLCIjNWFiNGFjIl0sCjQ6IFsiI2E2NjExYSIsIiNkZmMyN2QiLCIjODBjZGMxIiwiIzAxODU3MSJdLAo1OiBbIiNhNjYxMWEiLCIjZGZjMjdkIiwiI2Y1ZjVmNSIsIiM4MGNkYzEiLCIjMDE4NTcxIl0sCjY6IFsiIzhjNTEwYSIsIiNkOGIzNjUiLCIjZjZlOGMzIiwiI2M3ZWFlNSIsIiM1YWI0YWMiLCIjMDE2NjVlIl0sCjc6IFsiIzhjNTEwYSIsIiNkOGIzNjUiLCIjZjZlOGMzIiwiI2Y1ZjVmNSIsIiNjN2VhZTUiLCIjNWFiNGFjIiwiIzAxNjY1ZSJdLAo4OiBbIiM4YzUxMGEiLCIjYmY4MTJkIiwiI2RmYzI3ZCIsIiNmNmU4YzMiLCIjYzdlYWU1IiwiIzgwY2RjMSIsIiMzNTk3OGYiLCIjMDE2NjVlIl0sCjk6IFsiIzhjNTEwYSIsIiNiZjgxMmQiLCIjZGZjMjdkIiwiI2Y2ZThjMyIsIiNmNWY1ZjUiLCIjYzdlYWU1IiwiIzgwY2RjMSIsIiMzNTk3OGYiLCIjMDE2NjVlIl0sCjEwOiBbIiM1NDMwMDUiLCIjOGM1MTBhIiwiI2JmODEyZCIsIiNkZmMyN2QiLCIjZjZlOGMzIiwiI2M3ZWFlNSIsIiM4MGNkYzEiLCIjMzU5NzhmIiwiIzAxNjY1ZSIsIiMwMDNjMzAiXSwKMTE6IFsiIzU0MzAwNSIsIiM4YzUxMGEiLCIjYmY4MTJkIiwiI2RmYzI3ZCIsIiNmNmU4YzMiLCIjZjVmNWY1IiwiI2M3ZWFlNSIsIiM4MGNkYzEiLCIjMzU5NzhmIiwiIzAxNjY1ZSIsIiMwMDNjMzAiXQp9LFBSR246IHsKMzogWyIjYWY4ZGMzIiwiI2Y3ZjdmNyIsIiM3ZmJmN2IiXSwKNDogWyIjN2IzMjk0IiwiI2MyYTVjZiIsIiNhNmRiYTAiLCIjMDA4ODM3Il0sCjU6IFsiIzdiMzI5NCIsIiNjMmE1Y2YiLCIjZjdmN2Y3IiwiI2E2ZGJhMCIsIiMwMDg4MzciXSwKNjogWyIjNzYyYTgzIiwiI2FmOGRjMyIsIiNlN2Q0ZTgiLCIjZDlmMGQzIiwiIzdmYmY3YiIsIiMxYjc4MzciXSwKNzogWyIjNzYyYTgzIiwiI2FmOGRjMyIsIiNlN2Q0ZTgiLCIjZjdmN2Y3IiwiI2Q5ZjBkMyIsIiM3ZmJmN2IiLCIjMWI3ODM3Il0sCjg6IFsiIzc2MmE4MyIsIiM5OTcwYWIiLCIjYzJhNWNmIiwiI2U3ZDRlOCIsIiNkOWYwZDMiLCIjYTZkYmEwIiwiIzVhYWU2MSIsIiMxYjc4MzciXSwKOTogWyIjNzYyYTgzIiwiIzk5NzBhYiIsIiNjMmE1Y2YiLCIjZTdkNGU4IiwiI2Y3ZjdmNyIsIiNkOWYwZDMiLCIjYTZkYmEwIiwiIzVhYWU2MSIsIiMxYjc4MzciXSwKMTA6IFsiIzQwMDA0YiIsIiM3NjJhODMiLCIjOTk3MGFiIiwiI2MyYTVjZiIsIiNlN2Q0ZTgiLCIjZDlmMGQzIiwiI2E2ZGJhMCIsIiM1YWFlNjEiLCIjMWI3ODM3IiwiIzAwNDQxYiJdLAoxMTogWyIjNDAwMDRiIiwiIzc2MmE4MyIsIiM5OTcwYWIiLCIjYzJhNWNmIiwiI2U3ZDRlOCIsIiNmN2Y3ZjciLCIjZDlmMGQzIiwiI2E2ZGJhMCIsIiM1YWFlNjEiLCIjMWI3ODM3IiwiIzAwNDQxYiJdCn0sUGlZRzogewozOiBbIiNlOWEzYzkiLCIjZjdmN2Y3IiwiI2ExZDc2YSJdLAo0OiBbIiNkMDFjOGIiLCIjZjFiNmRhIiwiI2I4ZTE4NiIsIiM0ZGFjMjYiXSwKNTogWyIjZDAxYzhiIiwiI2YxYjZkYSIsIiNmN2Y3ZjciLCIjYjhlMTg2IiwiIzRkYWMyNiJdLAo2OiBbIiNjNTFiN2QiLCIjZTlhM2M5IiwiI2ZkZTBlZiIsIiNlNmY1ZDAiLCIjYTFkNzZhIiwiIzRkOTIyMSJdLAo3OiBbIiNjNTFiN2QiLCIjZTlhM2M5IiwiI2ZkZTBlZiIsIiNmN2Y3ZjciLCIjZTZmNWQwIiwiI2ExZDc2YSIsIiM0ZDkyMjEiXSwKODogWyIjYzUxYjdkIiwiI2RlNzdhZSIsIiNmMWI2ZGEiLCIjZmRlMGVmIiwiI2U2ZjVkMCIsIiNiOGUxODYiLCIjN2ZiYzQxIiwiIzRkOTIyMSJdLAo5OiBbIiNjNTFiN2QiLCIjZGU3N2FlIiwiI2YxYjZkYSIsIiNmZGUwZWYiLCIjZjdmN2Y3IiwiI2U2ZjVkMCIsIiNiOGUxODYiLCIjN2ZiYzQxIiwiIzRkOTIyMSJdLAoxMDogWyIjOGUwMTUyIiwiI2M1MWI3ZCIsIiNkZTc3YWUiLCIjZjFiNmRhIiwiI2ZkZTBlZiIsIiNlNmY1ZDAiLCIjYjhlMTg2IiwiIzdmYmM0MSIsIiM0ZDkyMjEiLCIjMjc2NDE5Il0sCjExOiBbIiM4ZTAxNTIiLCIjYzUxYjdkIiwiI2RlNzdhZSIsIiNmMWI2ZGEiLCIjZmRlMGVmIiwiI2Y3ZjdmNyIsIiNlNmY1ZDAiLCIjYjhlMTg2IiwiIzdmYmM0MSIsIiM0ZDkyMjEiLCIjMjc2NDE5Il0KfSxSZEJ1OiB7CjM6IFsiI2VmOGE2MiIsIiNmN2Y3ZjciLCIjNjdhOWNmIl0sCjQ6IFsiI2NhMDAyMCIsIiNmNGE1ODIiLCIjOTJjNWRlIiwiIzA1NzFiMCJdLAo1OiBbIiNjYTAwMjAiLCIjZjRhNTgyIiwiI2Y3ZjdmNyIsIiM5MmM1ZGUiLCIjMDU3MWIwIl0sCjY6IFsiI2IyMTgyYiIsIiNlZjhhNjIiLCIjZmRkYmM3IiwiI2QxZTVmMCIsIiM2N2E5Y2YiLCIjMjE2NmFjIl0sCjc6IFsiI2IyMTgyYiIsIiNlZjhhNjIiLCIjZmRkYmM3IiwiI2Y3ZjdmNyIsIiNkMWU1ZjAiLCIjNjdhOWNmIiwiIzIxNjZhYyJdLAo4OiBbIiNiMjE4MmIiLCIjZDY2MDRkIiwiI2Y0YTU4MiIsIiNmZGRiYzciLCIjZDFlNWYwIiwiIzkyYzVkZSIsIiM0MzkzYzMiLCIjMjE2NmFjIl0sCjk6IFsiI2IyMTgyYiIsIiNkNjYwNGQiLCIjZjRhNTgyIiwiI2ZkZGJjNyIsIiNmN2Y3ZjciLCIjZDFlNWYwIiwiIzkyYzVkZSIsIiM0MzkzYzMiLCIjMjE2NmFjIl0sCjEwOiBbIiM2NzAwMWYiLCIjYjIxODJiIiwiI2Q2NjA0ZCIsIiNmNGE1ODIiLCIjZmRkYmM3IiwiI2QxZTVmMCIsIiM5MmM1ZGUiLCIjNDM5M2MzIiwiIzIxNjZhYyIsIiMwNTMwNjEiXSwKMTE6IFsiIzY3MDAxZiIsIiNiMjE4MmIiLCIjZDY2MDRkIiwiI2Y0YTU4MiIsIiNmZGRiYzciLCIjZjdmN2Y3IiwiI2QxZTVmMCIsIiM5MmM1ZGUiLCIjNDM5M2MzIiwiIzIxNjZhYyIsIiMwNTMwNjEiXQp9LFJkR3k6IHsKMzogWyIjZWY4YTYyIiwiI2ZmZmZmZiIsIiM5OTk5OTkiXSwKNDogWyIjY2EwMDIwIiwiI2Y0YTU4MiIsIiNiYWJhYmEiLCIjNDA0MDQwIl0sCjU6IFsiI2NhMDAyMCIsIiNmNGE1ODIiLCIjZmZmZmZmIiwiI2JhYmFiYSIsIiM0MDQwNDAiXSwKNjogWyIjYjIxODJiIiwiI2VmOGE2MiIsIiNmZGRiYzciLCIjZTBlMGUwIiwiIzk5OTk5OSIsIiM0ZDRkNGQiXSwKNzogWyIjYjIxODJiIiwiI2VmOGE2MiIsIiNmZGRiYzciLCIjZmZmZmZmIiwiI2UwZTBlMCIsIiM5OTk5OTkiLCIjNGQ0ZDRkIl0sCjg6IFsiI2IyMTgyYiIsIiNkNjYwNGQiLCIjZjRhNTgyIiwiI2ZkZGJjNyIsIiNlMGUwZTAiLCIjYmFiYWJhIiwiIzg3ODc4NyIsIiM0ZDRkNGQiXSwKOTogWyIjYjIxODJiIiwiI2Q2NjA0ZCIsIiNmNGE1ODIiLCIjZmRkYmM3IiwiI2ZmZmZmZiIsIiNlMGUwZTAiLCIjYmFiYWJhIiwiIzg3ODc4NyIsIiM0ZDRkNGQiXSwKMTA6IFsiIzY3MDAxZiIsIiNiMjE4MmIiLCIjZDY2MDRkIiwiI2Y0YTU4MiIsIiNmZGRiYzciLCIjZTBlMGUwIiwiI2JhYmFiYSIsIiM4Nzg3ODciLCIjNGQ0ZDRkIiwiIzFhMWExYSJdLAoxMTogWyIjNjcwMDFmIiwiI2IyMTgyYiIsIiNkNjYwNGQiLCIjZjRhNTgyIiwiI2ZkZGJjNyIsIiNmZmZmZmYiLCIjZTBlMGUwIiwiI2JhYmFiYSIsIiM4Nzg3ODciLCIjNGQ0ZDRkIiwiIzFhMWExYSJdCn0sUmRZbEJ1OiB7CjM6IFsiI2ZjOGQ1OSIsIiNmZmZmYmYiLCIjOTFiZmRiIl0sCjQ6IFsiI2Q3MTkxYyIsIiNmZGFlNjEiLCIjYWJkOWU5IiwiIzJjN2JiNiJdLAo1OiBbIiNkNzE5MWMiLCIjZmRhZTYxIiwiI2ZmZmZiZiIsIiNhYmQ5ZTkiLCIjMmM3YmI2Il0sCjY6IFsiI2Q3MzAyNyIsIiNmYzhkNTkiLCIjZmVlMDkwIiwiI2UwZjNmOCIsIiM5MWJmZGIiLCIjNDU3NWI0Il0sCjc6IFsiI2Q3MzAyNyIsIiNmYzhkNTkiLCIjZmVlMDkwIiwiI2ZmZmZiZiIsIiNlMGYzZjgiLCIjOTFiZmRiIiwiIzQ1NzViNCJdLAo4OiBbIiNkNzMwMjciLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOTAiLCIjZTBmM2Y4IiwiI2FiZDllOSIsIiM3NGFkZDEiLCIjNDU3NWI0Il0sCjk6IFsiI2Q3MzAyNyIsIiNmNDZkNDMiLCIjZmRhZTYxIiwiI2ZlZTA5MCIsIiNmZmZmYmYiLCIjZTBmM2Y4IiwiI2FiZDllOSIsIiM3NGFkZDEiLCIjNDU3NWI0Il0sCjEwOiBbIiNhNTAwMjYiLCIjZDczMDI3IiwiI2Y0NmQ0MyIsIiNmZGFlNjEiLCIjZmVlMDkwIiwiI2UwZjNmOCIsIiNhYmQ5ZTkiLCIjNzRhZGQxIiwiIzQ1NzViNCIsIiMzMTM2OTUiXSwKMTE6IFsiI2E1MDAyNiIsIiNkNzMwMjciLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOTAiLCIjZmZmZmJmIiwiI2UwZjNmOCIsIiNhYmQ5ZTkiLCIjNzRhZGQxIiwiIzQ1NzViNCIsIiMzMTM2OTUiXQp9LFNwZWN0cmFsOiB7CjM6IFsiI2ZjOGQ1OSIsIiNmZmZmYmYiLCIjOTlkNTk0Il0sCjQ6IFsiI2Q3MTkxYyIsIiNmZGFlNjEiLCIjYWJkZGE0IiwiIzJiODNiYSJdLAo1OiBbIiNkNzE5MWMiLCIjZmRhZTYxIiwiI2ZmZmZiZiIsIiNhYmRkYTQiLCIjMmI4M2JhIl0sCjY6IFsiI2Q1M2U0ZiIsIiNmYzhkNTkiLCIjZmVlMDhiIiwiI2U2ZjU5OCIsIiM5OWQ1OTQiLCIjMzI4OGJkIl0sCjc6IFsiI2Q1M2U0ZiIsIiNmYzhkNTkiLCIjZmVlMDhiIiwiI2ZmZmZiZiIsIiNlNmY1OTgiLCIjOTlkNTk0IiwiIzMyODhiZCJdLAo4OiBbIiNkNTNlNGYiLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOGIiLCIjZTZmNTk4IiwiI2FiZGRhNCIsIiM2NmMyYTUiLCIjMzI4OGJkIl0sCjk6IFsiI2Q1M2U0ZiIsIiNmNDZkNDMiLCIjZmRhZTYxIiwiI2ZlZTA4YiIsIiNmZmZmYmYiLCIjZTZmNTk4IiwiI2FiZGRhNCIsIiM2NmMyYTUiLCIjMzI4OGJkIl0sCjEwOiBbIiM5ZTAxNDIiLCIjZDUzZTRmIiwiI2Y0NmQ0MyIsIiNmZGFlNjEiLCIjZmVlMDhiIiwiI2U2ZjU5OCIsIiNhYmRkYTQiLCIjNjZjMmE1IiwiIzMyODhiZCIsIiM1ZTRmYTIiXSwKMTE6IFsiIzllMDE0MiIsIiNkNTNlNGYiLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOGIiLCIjZmZmZmJmIiwiI2U2ZjU5OCIsIiNhYmRkYTQiLCIjNjZjMmE1IiwiIzMyODhiZCIsIiM1ZTRmYTIiXQp9LFJkWWxHbjogewozOiBbIiNmYzhkNTkiLCIjZmZmZmJmIiwiIzkxY2Y2MCJdLAo0OiBbIiNkNzE5MWMiLCIjZmRhZTYxIiwiI2E2ZDk2YSIsIiMxYTk2NDEiXSwKNTogWyIjZDcxOTFjIiwiI2ZkYWU2MSIsIiNmZmZmYmYiLCIjYTZkOTZhIiwiIzFhOTY0MSJdLAo2OiBbIiNkNzMwMjciLCIjZmM4ZDU5IiwiI2ZlZTA4YiIsIiNkOWVmOGIiLCIjOTFjZjYwIiwiIzFhOTg1MCJdLAo3OiBbIiNkNzMwMjciLCIjZmM4ZDU5IiwiI2ZlZTA4YiIsIiNmZmZmYmYiLCIjZDllZjhiIiwiIzkxY2Y2MCIsIiMxYTk4NTAiXSwKODogWyIjZDczMDI3IiwiI2Y0NmQ0MyIsIiNmZGFlNjEiLCIjZmVlMDhiIiwiI2Q5ZWY4YiIsIiNhNmQ5NmEiLCIjNjZiZDYzIiwiIzFhOTg1MCJdLAo5OiBbIiNkNzMwMjciLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOGIiLCIjZmZmZmJmIiwiI2Q5ZWY4YiIsIiNhNmQ5NmEiLCIjNjZiZDYzIiwiIzFhOTg1MCJdLAoxMDogWyIjYTUwMDI2IiwiI2Q3MzAyNyIsIiNmNDZkNDMiLCIjZmRhZTYxIiwiI2ZlZTA4YiIsIiNkOWVmOGIiLCIjYTZkOTZhIiwiIzY2YmQ2MyIsIiMxYTk4NTAiLCIjMDA2ODM3Il0sCjExOiBbIiNhNTAwMjYiLCIjZDczMDI3IiwiI2Y0NmQ0MyIsIiNmZGFlNjEiLCIjZmVlMDhiIiwiI2ZmZmZiZiIsIiNkOWVmOGIiLCIjYTZkOTZhIiwiIzY2YmQ2MyIsIiMxYTk4NTAiLCIjMDA2ODM3Il0KfSxBY2NlbnQ6IHsKMzogWyIjN2ZjOTdmIiwiI2JlYWVkNCIsIiNmZGMwODYiXSwKNDogWyIjN2ZjOTdmIiwiI2JlYWVkNCIsIiNmZGMwODYiLCIjZmZmZjk5Il0sCjU6IFsiIzdmYzk3ZiIsIiNiZWFlZDQiLCIjZmRjMDg2IiwiI2ZmZmY5OSIsIiMzODZjYjAiXSwKNjogWyIjN2ZjOTdmIiwiI2JlYWVkNCIsIiNmZGMwODYiLCIjZmZmZjk5IiwiIzM4NmNiMCIsIiNmMDAyN2YiXSwKNzogWyIjN2ZjOTdmIiwiI2JlYWVkNCIsIiNmZGMwODYiLCIjZmZmZjk5IiwiIzM4NmNiMCIsIiNmMDAyN2YiLCIjYmY1YjE3Il0sCjg6IFsiIzdmYzk3ZiIsIiNiZWFlZDQiLCIjZmRjMDg2IiwiI2ZmZmY5OSIsIiMzODZjYjAiLCIjZjAwMjdmIiwiI2JmNWIxNyIsIiM2NjY2NjYiXQp9LERhcmsyOiB7CjM6IFsiIzFiOWU3NyIsIiNkOTVmMDIiLCIjNzU3MGIzIl0sCjQ6IFsiIzFiOWU3NyIsIiNkOTVmMDIiLCIjNzU3MGIzIiwiI2U3Mjk4YSJdLAo1OiBbIiMxYjllNzciLCIjZDk1ZjAyIiwiIzc1NzBiMyIsIiNlNzI5OGEiLCIjNjZhNjFlIl0sCjY6IFsiIzFiOWU3NyIsIiNkOTVmMDIiLCIjNzU3MGIzIiwiI2U3Mjk4YSIsIiM2NmE2MWUiLCIjZTZhYjAyIl0sCjc6IFsiIzFiOWU3NyIsIiNkOTVmMDIiLCIjNzU3MGIzIiwiI2U3Mjk4YSIsIiM2NmE2MWUiLCIjZTZhYjAyIiwiI2E2NzYxZCJdLAo4OiBbIiMxYjllNzciLCIjZDk1ZjAyIiwiIzc1NzBiMyIsIiNlNzI5OGEiLCIjNjZhNjFlIiwiI2U2YWIwMiIsIiNhNjc2MWQiLCIjNjY2NjY2Il0KfSxQYWlyZWQ6IHsKMzogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiXSwKNDogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIl0sCjU6IFsiI2E2Y2VlMyIsIiMxZjc4YjQiLCIjYjJkZjhhIiwiIzMzYTAyYyIsIiNmYjlhOTkiXSwKNjogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiXSwKNzogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiLCIjZmRiZjZmIl0sCjg6IFsiI2E2Y2VlMyIsIiMxZjc4YjQiLCIjYjJkZjhhIiwiIzMzYTAyYyIsIiNmYjlhOTkiLCIjZTMxYTFjIiwiI2ZkYmY2ZiIsIiNmZjdmMDAiXSwKOTogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiLCIjZmRiZjZmIiwiI2ZmN2YwMCIsIiNjYWIyZDYiXSwKMTA6IFsiI2E2Y2VlMyIsIiMxZjc4YjQiLCIjYjJkZjhhIiwiIzMzYTAyYyIsIiNmYjlhOTkiLCIjZTMxYTFjIiwiI2ZkYmY2ZiIsIiNmZjdmMDAiLCIjY2FiMmQ2IiwiIzZhM2Q5YSJdLAoxMTogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiLCIjZmRiZjZmIiwiI2ZmN2YwMCIsIiNjYWIyZDYiLCIjNmEzZDlhIiwiI2ZmZmY5OSJdLAoxMjogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiLCIjZmRiZjZmIiwiI2ZmN2YwMCIsIiNjYWIyZDYiLCIjNmEzZDlhIiwiI2ZmZmY5OSIsIiNiMTU5MjgiXQp9LFBhc3RlbDE6IHsKMzogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiXSwKNDogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiLCIjZGVjYmU0Il0sCjU6IFsiI2ZiYjRhZSIsIiNiM2NkZTMiLCIjY2NlYmM1IiwiI2RlY2JlNCIsIiNmZWQ5YTYiXSwKNjogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiLCIjZGVjYmU0IiwiI2ZlZDlhNiIsIiNmZmZmY2MiXSwKNzogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiLCIjZGVjYmU0IiwiI2ZlZDlhNiIsIiNmZmZmY2MiLCIjZTVkOGJkIl0sCjg6IFsiI2ZiYjRhZSIsIiNiM2NkZTMiLCIjY2NlYmM1IiwiI2RlY2JlNCIsIiNmZWQ5YTYiLCIjZmZmZmNjIiwiI2U1ZDhiZCIsIiNmZGRhZWMiXSwKOTogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiLCIjZGVjYmU0IiwiI2ZlZDlhNiIsIiNmZmZmY2MiLCIjZTVkOGJkIiwiI2ZkZGFlYyIsIiNmMmYyZjIiXQp9LFBhc3RlbDI6IHsKMzogWyIjYjNlMmNkIiwiI2ZkY2RhYyIsIiNjYmQ1ZTgiXSwKNDogWyIjYjNlMmNkIiwiI2ZkY2RhYyIsIiNjYmQ1ZTgiLCIjZjRjYWU0Il0sCjU6IFsiI2IzZTJjZCIsIiNmZGNkYWMiLCIjY2JkNWU4IiwiI2Y0Y2FlNCIsIiNlNmY1YzkiXSwKNjogWyIjYjNlMmNkIiwiI2ZkY2RhYyIsIiNjYmQ1ZTgiLCIjZjRjYWU0IiwiI2U2ZjVjOSIsIiNmZmYyYWUiXSwKNzogWyIjYjNlMmNkIiwiI2ZkY2RhYyIsIiNjYmQ1ZTgiLCIjZjRjYWU0IiwiI2U2ZjVjOSIsIiNmZmYyYWUiLCIjZjFlMmNjIl0sCjg6IFsiI2IzZTJjZCIsIiNmZGNkYWMiLCIjY2JkNWU4IiwiI2Y0Y2FlNCIsIiNlNmY1YzkiLCIjZmZmMmFlIiwiI2YxZTJjYyIsIiNjY2NjY2MiXQp9LFNldDE6IHsKMzogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiXSwKNDogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiLCIjOTg0ZWEzIl0sCjU6IFsiI2U0MWExYyIsIiMzNzdlYjgiLCIjNGRhZjRhIiwiIzk4NGVhMyIsIiNmZjdmMDAiXSwKNjogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiLCIjOTg0ZWEzIiwiI2ZmN2YwMCIsIiNmZmZmMzMiXSwKNzogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiLCIjOTg0ZWEzIiwiI2ZmN2YwMCIsIiNmZmZmMzMiLCIjYTY1NjI4Il0sCjg6IFsiI2U0MWExYyIsIiMzNzdlYjgiLCIjNGRhZjRhIiwiIzk4NGVhMyIsIiNmZjdmMDAiLCIjZmZmZjMzIiwiI2E2NTYyOCIsIiNmNzgxYmYiXSwKOTogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiLCIjOTg0ZWEzIiwiI2ZmN2YwMCIsIiNmZmZmMzMiLCIjYTY1NjI4IiwiI2Y3ODFiZiIsIiM5OTk5OTkiXQp9LFNldDI6IHsKMzogWyIjNjZjMmE1IiwiI2ZjOGQ2MiIsIiM4ZGEwY2IiXSwKNDogWyIjNjZjMmE1IiwiI2ZjOGQ2MiIsIiM4ZGEwY2IiLCIjZTc4YWMzIl0sCjU6IFsiIzY2YzJhNSIsIiNmYzhkNjIiLCIjOGRhMGNiIiwiI2U3OGFjMyIsIiNhNmQ4NTQiXSwKNjogWyIjNjZjMmE1IiwiI2ZjOGQ2MiIsIiM4ZGEwY2IiLCIjZTc4YWMzIiwiI2E2ZDg1NCIsIiNmZmQ5MmYiXSwKNzogWyIjNjZjMmE1IiwiI2ZjOGQ2MiIsIiM4ZGEwY2IiLCIjZTc4YWMzIiwiI2E2ZDg1NCIsIiNmZmQ5MmYiLCIjZTVjNDk0Il0sCjg6IFsiIzY2YzJhNSIsIiNmYzhkNjIiLCIjOGRhMGNiIiwiI2U3OGFjMyIsIiNhNmQ4NTQiLCIjZmZkOTJmIiwiI2U1YzQ5NCIsIiNiM2IzYjMiXQp9LFNldDM6IHsKMzogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiXSwKNDogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIl0sCjU6IFsiIzhkZDNjNyIsIiNmZmZmYjMiLCIjYmViYWRhIiwiI2ZiODA3MiIsIiM4MGIxZDMiXSwKNjogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiXSwKNzogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiLCIjYjNkZTY5Il0sCjg6IFsiIzhkZDNjNyIsIiNmZmZmYjMiLCIjYmViYWRhIiwiI2ZiODA3MiIsIiM4MGIxZDMiLCIjZmRiNDYyIiwiI2IzZGU2OSIsIiNmY2NkZTUiXSwKOTogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiLCIjYjNkZTY5IiwiI2ZjY2RlNSIsIiNkOWQ5ZDkiXSwKMTA6IFsiIzhkZDNjNyIsIiNmZmZmYjMiLCIjYmViYWRhIiwiI2ZiODA3MiIsIiM4MGIxZDMiLCIjZmRiNDYyIiwiI2IzZGU2OSIsIiNmY2NkZTUiLCIjZDlkOWQ5IiwiI2JjODBiZCJdLAoxMTogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiLCIjYjNkZTY5IiwiI2ZjY2RlNSIsIiNkOWQ5ZDkiLCIjYmM4MGJkIiwiI2NjZWJjNSJdLAoxMjogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiLCIjYjNkZTY5IiwiI2ZjY2RlNSIsIiNkOWQ5ZDkiLCIjYmM4MGJkIiwiI2NjZWJjNSIsIiNmZmVkNmYiXQp9fTs="></script>
<script src="data:application/x-javascript;base64,Ly8gICAgIFVuZGVyc2NvcmUuanMgMS44LjMKLy8gICAgIGh0dHA6Ly91bmRlcnNjb3JlanMub3JnCi8vICAgICAoYykgMjAwOS0yMDE1IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCi8vICAgICBVbmRlcnNjb3JlIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgoKKGZ1bmN0aW9uKCkgewoKICAvLyBCYXNlbGluZSBzZXR1cAogIC8vIC0tLS0tLS0tLS0tLS0tCgogIC8vIEVzdGFibGlzaCB0aGUgcm9vdCBvYmplY3QsIGB3aW5kb3dgIGluIHRoZSBicm93c2VyLCBvciBgZXhwb3J0c2Agb24gdGhlIHNlcnZlci4KICB2YXIgcm9vdCA9IHRoaXM7CgogIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgX2AgdmFyaWFibGUuCiAgdmFyIHByZXZpb3VzVW5kZXJzY29yZSA9IHJvb3QuXzsKCiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjoKICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7CgogIC8vIENyZWF0ZSBxdWljayByZWZlcmVuY2UgdmFyaWFibGVzIGZvciBzcGVlZCBhY2Nlc3MgdG8gY29yZSBwcm90b3R5cGVzLgogIHZhcgogICAgcHVzaCAgICAgICAgICAgICA9IEFycmF5UHJvdG8ucHVzaCwKICAgIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLAogICAgaGFzT3duUHJvcGVydHkgICA9IE9ialByb3RvLmhhc093blByb3BlcnR5OwoKICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2UKICAvLyBhcmUgZGVjbGFyZWQgaGVyZS4KICB2YXIKICAgIG5hdGl2ZUlzQXJyYXkgICAgICA9IEFycmF5LmlzQXJyYXksCiAgICBuYXRpdmVLZXlzICAgICAgICAgPSBPYmplY3Qua2V5cywKICAgIG5hdGl2ZUJpbmQgICAgICAgICA9IEZ1bmNQcm90by5iaW5kLAogICAgbmF0aXZlQ3JlYXRlICAgICAgID0gT2JqZWN0LmNyZWF0ZTsKCiAgLy8gTmFrZWQgZnVuY3Rpb24gcmVmZXJlbmNlIGZvciBzdXJyb2dhdGUtcHJvdG90eXBlLXN3YXBwaW5nLgogIHZhciBDdG9yID0gZnVuY3Rpb24oKXt9OwoKICAvLyBDcmVhdGUgYSBzYWZlIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yIHVzZSBiZWxvdy4KICB2YXIgXyA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF8pIHJldHVybiBvYmo7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgXykpIHJldHVybiBuZXcgXyhvYmopOwogICAgdGhpcy5fd3JhcHBlZCA9IG9iajsKICB9OwoKICAvLyBFeHBvcnQgdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciAqKk5vZGUuanMqKiwgd2l0aAogIC8vIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IGZvciB0aGUgb2xkIGByZXF1aXJlKClgIEFQSS4gSWYgd2UncmUgaW4KICAvLyB0aGUgYnJvd3NlciwgYWRkIGBfYCBhcyBhIGdsb2JhbCBvYmplY3QuCiAgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykgewogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IF87CiAgICB9CiAgICBleHBvcnRzLl8gPSBfOwogIH0gZWxzZSB7CiAgICByb290Ll8gPSBfOwogIH0KCiAgLy8gQ3VycmVudCB2ZXJzaW9uLgogIF8uVkVSU0lPTiA9ICcxLjguMyc7CgogIC8vIEludGVybmFsIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhbiBlZmZpY2llbnQgKGZvciBjdXJyZW50IGVuZ2luZXMpIHZlcnNpb24KICAvLyBvZiB0aGUgcGFzc2VkLWluIGNhbGxiYWNrLCB0byBiZSByZXBlYXRlZGx5IGFwcGxpZWQgaW4gb3RoZXIgVW5kZXJzY29yZQogIC8vIGZ1bmN0aW9ucy4KICB2YXIgb3B0aW1pemVDYiA9IGZ1bmN0aW9uKGZ1bmMsIGNvbnRleHQsIGFyZ0NvdW50KSB7CiAgICBpZiAoY29udGV4dCA9PT0gdm9pZCAwKSByZXR1cm4gZnVuYzsKICAgIHN3aXRjaCAoYXJnQ291bnQgPT0gbnVsbCA/IDMgOiBhcmdDb3VudCkgewogICAgICBjYXNlIDE6IHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUpOwogICAgICB9OwogICAgICBjYXNlIDI6IHJldHVybiBmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHsKICAgICAgICByZXR1cm4gZnVuYy5jYWxsKGNvbnRleHQsIHZhbHVlLCBvdGhlcik7CiAgICAgIH07CiAgICAgIGNhc2UgMzogcmV0dXJuIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgewogICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsKICAgICAgfTsKICAgICAgY2FzZSA0OiByZXR1cm4gZnVuY3Rpb24oYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgewogICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7CiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3VtZW50cyk7CiAgICB9OwogIH07CgogIC8vIEEgbW9zdGx5LWludGVybmFsIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIGNhbGxiYWNrcyB0aGF0IGNhbiBiZSBhcHBsaWVkCiAgLy8gdG8gZWFjaCBlbGVtZW50IGluIGEgY29sbGVjdGlvbiwgcmV0dXJuaW5nIHRoZSBkZXNpcmVkIHJlc3VsdCDigJQgZWl0aGVyCiAgLy8gaWRlbnRpdHksIGFuIGFyYml0cmFyeSBjYWxsYmFjaywgYSBwcm9wZXJ0eSBtYXRjaGVyLCBvciBhIHByb3BlcnR5IGFjY2Vzc29yLgogIHZhciBjYiA9IGZ1bmN0aW9uKHZhbHVlLCBjb250ZXh0LCBhcmdDb3VudCkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHJldHVybiBfLmlkZW50aXR5OwogICAgaWYgKF8uaXNGdW5jdGlvbih2YWx1ZSkpIHJldHVybiBvcHRpbWl6ZUNiKHZhbHVlLCBjb250ZXh0LCBhcmdDb3VudCk7CiAgICBpZiAoXy5pc09iamVjdCh2YWx1ZSkpIHJldHVybiBfLm1hdGNoZXIodmFsdWUpOwogICAgcmV0dXJuIF8ucHJvcGVydHkodmFsdWUpOwogIH07CiAgXy5pdGVyYXRlZSA9IGZ1bmN0aW9uKHZhbHVlLCBjb250ZXh0KSB7CiAgICByZXR1cm4gY2IodmFsdWUsIGNvbnRleHQsIEluZmluaXR5KTsKICB9OwoKICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYXNzaWduZXIgZnVuY3Rpb25zLgogIHZhciBjcmVhdGVBc3NpZ25lciA9IGZ1bmN0aW9uKGtleXNGdW5jLCB1bmRlZmluZWRPbmx5KSB7CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICBpZiAobGVuZ3RoIDwgMiB8fCBvYmogPT0gbnVsbCkgcmV0dXJuIG9iajsKICAgICAgZm9yICh2YXIgaW5kZXggPSAxOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaW5kZXhdLAogICAgICAgICAgICBrZXlzID0ga2V5c0Z1bmMoc291cmNlKSwKICAgICAgICAgICAgbCA9IGtleXMubGVuZ3RoOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgICAgIGlmICghdW5kZWZpbmVkT25seSB8fCBvYmpba2V5XSA9PT0gdm9pZCAwKSBvYmpba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gb2JqOwogICAgfTsKICB9OwoKICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYSBuZXcgb2JqZWN0IHRoYXQgaW5oZXJpdHMgZnJvbSBhbm90aGVyLgogIHZhciBiYXNlQ3JlYXRlID0gZnVuY3Rpb24ocHJvdG90eXBlKSB7CiAgICBpZiAoIV8uaXNPYmplY3QocHJvdG90eXBlKSkgcmV0dXJuIHt9OwogICAgaWYgKG5hdGl2ZUNyZWF0ZSkgcmV0dXJuIG5hdGl2ZUNyZWF0ZShwcm90b3R5cGUpOwogICAgQ3Rvci5wcm90b3R5cGUgPSBwcm90b3R5cGU7CiAgICB2YXIgcmVzdWx0ID0gbmV3IEN0b3I7CiAgICBDdG9yLnByb3RvdHlwZSA9IG51bGw7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIHZhciBwcm9wZXJ0eSA9IGZ1bmN0aW9uKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gb2JqID09IG51bGwgPyB2b2lkIDAgOiBvYmpba2V5XTsKICAgIH07CiAgfTsKCiAgLy8gSGVscGVyIGZvciBjb2xsZWN0aW9uIG1ldGhvZHMgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBjb2xsZWN0aW9uCiAgLy8gc2hvdWxkIGJlIGl0ZXJhdGVkIGFzIGFuIGFycmF5IG9yIGFzIGFuIG9iamVjdAogIC8vIFJlbGF0ZWQ6IGh0dHA6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLXRvbGVuZ3RoCiAgLy8gQXZvaWRzIGEgdmVyeSBuYXN0eSBpT1MgOCBKSVQgYnVnIG9uIEFSTS02NC4gIzIwOTQKICB2YXIgTUFYX0FSUkFZX0lOREVYID0gTWF0aC5wb3coMiwgNTMpIC0gMTsKICB2YXIgZ2V0TGVuZ3RoID0gcHJvcGVydHkoJ2xlbmd0aCcpOwogIHZhciBpc0FycmF5TGlrZSA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24pIHsKICAgIHZhciBsZW5ndGggPSBnZXRMZW5ndGgoY29sbGVjdGlvbik7CiAgICByZXR1cm4gdHlwZW9mIGxlbmd0aCA9PSAnbnVtYmVyJyAmJiBsZW5ndGggPj0gMCAmJiBsZW5ndGggPD0gTUFYX0FSUkFZX0lOREVYOwogIH07CgogIC8vIENvbGxlY3Rpb24gRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gVGhlIGNvcm5lcnN0b25lLCBhbiBgZWFjaGAgaW1wbGVtZW50YXRpb24sIGFrYSBgZm9yRWFjaGAuCiAgLy8gSGFuZGxlcyByYXcgb2JqZWN0cyBpbiBhZGRpdGlvbiB0byBhcnJheS1saWtlcy4gVHJlYXRzIGFsbAogIC8vIHNwYXJzZSBhcnJheS1saWtlcyBhcyBpZiB0aGV5IHdlcmUgZGVuc2UuCiAgXy5lYWNoID0gXy5mb3JFYWNoID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaXRlcmF0ZWUgPSBvcHRpbWl6ZUNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgIHZhciBpLCBsZW5ndGg7CiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkgewogICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpdGVyYXRlZShvYmpbaV0sIGksIG9iaik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpdGVyYXRlZShvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSByZXN1bHRzIG9mIGFwcGx5aW5nIHRoZSBpdGVyYXRlZSB0byBlYWNoIGVsZW1lbnQuCiAgXy5tYXAgPSBfLmNvbGxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7CiAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksCiAgICAgICAgbGVuZ3RoID0gKGtleXMgfHwgb2JqKS5sZW5ndGgsCiAgICAgICAgcmVzdWx0cyA9IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIHZhciBjdXJyZW50S2V5ID0ga2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXg7CiAgICAgIHJlc3VsdHNbaW5kZXhdID0gaXRlcmF0ZWUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgLy8gQ3JlYXRlIGEgcmVkdWNpbmcgZnVuY3Rpb24gaXRlcmF0aW5nIGxlZnQgb3IgcmlnaHQuCiAgZnVuY3Rpb24gY3JlYXRlUmVkdWNlKGRpcikgewogICAgLy8gT3B0aW1pemVkIGl0ZXJhdG9yIGZ1bmN0aW9uIGFzIHVzaW5nIGFyZ3VtZW50cy5sZW5ndGgKICAgIC8vIGluIHRoZSBtYWluIGZ1bmN0aW9uIHdpbGwgZGVvcHRpbWl6ZSB0aGUsIHNlZSAjMTk5MS4KICAgIGZ1bmN0aW9uIGl0ZXJhdG9yKG9iaiwgaXRlcmF0ZWUsIG1lbW8sIGtleXMsIGluZGV4LCBsZW5ndGgpIHsKICAgICAgZm9yICg7IGluZGV4ID49IDAgJiYgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IGRpcikgewogICAgICAgIHZhciBjdXJyZW50S2V5ID0ga2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXg7CiAgICAgICAgbWVtbyA9IGl0ZXJhdGVlKG1lbW8sIG9ialtjdXJyZW50S2V5XSwgY3VycmVudEtleSwgb2JqKTsKICAgICAgfQogICAgICByZXR1cm4gbWVtbzsKICAgIH0KCiAgICByZXR1cm4gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgbWVtbywgY29udGV4dCkgewogICAgICBpdGVyYXRlZSA9IG9wdGltaXplQ2IoaXRlcmF0ZWUsIGNvbnRleHQsIDQpOwogICAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLAogICAgICAgICAgbGVuZ3RoID0gKGtleXMgfHwgb2JqKS5sZW5ndGgsCiAgICAgICAgICBpbmRleCA9IGRpciA+IDAgPyAwIDogbGVuZ3RoIC0gMTsKICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBpbml0aWFsIHZhbHVlIGlmIG5vbmUgaXMgcHJvdmlkZWQuCiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykgewogICAgICAgIG1lbW8gPSBvYmpba2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXhdOwogICAgICAgIGluZGV4ICs9IGRpcjsKICAgICAgfQogICAgICByZXR1cm4gaXRlcmF0b3Iob2JqLCBpdGVyYXRlZSwgbWVtbywga2V5cywgaW5kZXgsIGxlbmd0aCk7CiAgICB9OwogIH0KCiAgLy8gKipSZWR1Y2UqKiBidWlsZHMgdXAgYSBzaW5nbGUgcmVzdWx0IGZyb20gYSBsaXN0IG9mIHZhbHVlcywgYWthIGBpbmplY3RgLAogIC8vIG9yIGBmb2xkbGAuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBjcmVhdGVSZWR1Y2UoMSk7CgogIC8vIFRoZSByaWdodC1hc3NvY2lhdGl2ZSB2ZXJzaW9uIG9mIHJlZHVjZSwgYWxzbyBrbm93biBhcyBgZm9sZHJgLgogIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gY3JlYXRlUmVkdWNlKC0xKTsKCiAgLy8gUmV0dXJuIHRoZSBmaXJzdCB2YWx1ZSB3aGljaCBwYXNzZXMgYSB0cnV0aCB0ZXN0LiBBbGlhc2VkIGFzIGBkZXRlY3RgLgogIF8uZmluZCA9IF8uZGV0ZWN0ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHZhciBrZXk7CiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkgewogICAgICBrZXkgPSBfLmZpbmRJbmRleChvYmosIHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICB9IGVsc2UgewogICAgICBrZXkgPSBfLmZpbmRLZXkob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpOwogICAgfQogICAgaWYgKGtleSAhPT0gdm9pZCAwICYmIGtleSAhPT0gLTEpIHJldHVybiBvYmpba2V5XTsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LgogIC8vIEFsaWFzZWQgYXMgYHNlbGVjdGAuCiAgXy5maWx0ZXIgPSBfLnNlbGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuCiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcmV0dXJuIF8uZmlsdGVyKG9iaiwgXy5uZWdhdGUoY2IocHJlZGljYXRlKSksIGNvbnRleHQpOwogIH07CgogIC8vIERldGVybWluZSB3aGV0aGVyIGFsbCBvZiB0aGUgZWxlbWVudHMgbWF0Y2ggYSB0cnV0aCB0ZXN0LgogIC8vIEFsaWFzZWQgYXMgYGFsbGAuCiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSA9IGNiKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLAogICAgICAgIGxlbmd0aCA9IChrZXlzIHx8IG9iaikubGVuZ3RoOwogICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4OwogICAgICBpZiAoIXByZWRpY2F0ZShvYmpbY3VycmVudEtleV0sIGN1cnJlbnRLZXksIG9iaikpIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH07CgogIC8vIERldGVybWluZSBpZiBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgb2JqZWN0IG1hdGNoZXMgYSB0cnV0aCB0ZXN0LgogIC8vIEFsaWFzZWQgYXMgYGFueWAuCiAgXy5zb21lID0gXy5hbnkgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksCiAgICAgICAgbGVuZ3RoID0gKGtleXMgfHwgb2JqKS5sZW5ndGg7CiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIHZhciBjdXJyZW50S2V5ID0ga2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXg7CiAgICAgIGlmIChwcmVkaWNhdGUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopKSByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9OwoKICAvLyBEZXRlcm1pbmUgaWYgdGhlIGFycmF5IG9yIG9iamVjdCBjb250YWlucyBhIGdpdmVuIGl0ZW0gKHVzaW5nIGA9PT1gKS4KICAvLyBBbGlhc2VkIGFzIGBpbmNsdWRlc2AgYW5kIGBpbmNsdWRlYC4KICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlcyA9IF8uaW5jbHVkZSA9IGZ1bmN0aW9uKG9iaiwgaXRlbSwgZnJvbUluZGV4LCBndWFyZCkgewogICAgaWYgKCFpc0FycmF5TGlrZShvYmopKSBvYmogPSBfLnZhbHVlcyhvYmopOwogICAgaWYgKHR5cGVvZiBmcm9tSW5kZXggIT0gJ251bWJlcicgfHwgZ3VhcmQpIGZyb21JbmRleCA9IDA7CiAgICByZXR1cm4gXy5pbmRleE9mKG9iaiwgaXRlbSwgZnJvbUluZGV4KSA+PSAwOwogIH07CgogIC8vIEludm9rZSBhIG1ldGhvZCAod2l0aCBhcmd1bWVudHMpIG9uIGV2ZXJ5IGl0ZW0gaW4gYSBjb2xsZWN0aW9uLgogIF8uaW52b2tlID0gZnVuY3Rpb24ob2JqLCBtZXRob2QpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgdmFyIGlzRnVuYyA9IF8uaXNGdW5jdGlvbihtZXRob2QpOwogICAgcmV0dXJuIF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgdmFyIGZ1bmMgPSBpc0Z1bmMgPyBtZXRob2QgOiB2YWx1ZVttZXRob2RdOwogICAgICByZXR1cm4gZnVuYyA9PSBudWxsID8gZnVuYyA6IGZ1bmMuYXBwbHkodmFsdWUsIGFyZ3MpOwogICAgfSk7CiAgfTsKCiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgbWFwYDogZmV0Y2hpbmcgYSBwcm9wZXJ0eS4KICBfLnBsdWNrID0gZnVuY3Rpb24ob2JqLCBrZXkpIHsKICAgIHJldHVybiBfLm1hcChvYmosIF8ucHJvcGVydHkoa2V5KSk7CiAgfTsKCiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgZmlsdGVyYDogc2VsZWN0aW5nIG9ubHkgb2JqZWN0cwogIC8vIGNvbnRhaW5pbmcgc3BlY2lmaWMgYGtleTp2YWx1ZWAgcGFpcnMuCiAgXy53aGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHsKICAgIHJldHVybiBfLmZpbHRlcihvYmosIF8ubWF0Y2hlcihhdHRycykpOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbmRgOiBnZXR0aW5nIHRoZSBmaXJzdCBvYmplY3QKICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8uZmluZFdoZXJlID0gZnVuY3Rpb24ob2JqLCBhdHRycykgewogICAgcmV0dXJuIF8uZmluZChvYmosIF8ubWF0Y2hlcihhdHRycykpOwogIH07CgogIC8vIFJldHVybiB0aGUgbWF4aW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQgPSAtSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IC1JbmZpbml0eSwKICAgICAgICB2YWx1ZSwgY29tcHV0ZWQ7CiAgICBpZiAoaXRlcmF0ZWUgPT0gbnVsbCAmJiBvYmogIT0gbnVsbCkgewogICAgICBvYmogPSBpc0FycmF5TGlrZShvYmopID8gb2JqIDogXy52YWx1ZXMob2JqKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iai5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIHZhbHVlID0gb2JqW2ldOwogICAgICAgIGlmICh2YWx1ZSA+IHJlc3VsdCkgewogICAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgICAgXy5lYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSh2YWx1ZSwgaW5kZXgsIGxpc3QpOwogICAgICAgIGlmIChjb21wdXRlZCA+IGxhc3RDb21wdXRlZCB8fCBjb21wdXRlZCA9PT0gLUluZmluaXR5ICYmIHJlc3VsdCA9PT0gLUluZmluaXR5KSB7CiAgICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICAgIGxhc3RDb21wdXRlZCA9IGNvbXB1dGVkOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFJldHVybiB0aGUgbWluaW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICBfLm1pbiA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQgPSBJbmZpbml0eSwgbGFzdENvbXB1dGVkID0gSW5maW5pdHksCiAgICAgICAgdmFsdWUsIGNvbXB1dGVkOwogICAgaWYgKGl0ZXJhdGVlID09IG51bGwgJiYgb2JqICE9IG51bGwpIHsKICAgICAgb2JqID0gaXNBcnJheUxpa2Uob2JqKSA/IG9iaiA6IF8udmFsdWVzKG9iaik7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICB2YWx1ZSA9IG9ialtpXTsKICAgICAgICBpZiAodmFsdWUgPCByZXN1bHQpIHsKICAgICAgICAgIHJlc3VsdCA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7CiAgICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBsaXN0KTsKICAgICAgICBpZiAoY29tcHV0ZWQgPCBsYXN0Q29tcHV0ZWQgfHwgY29tcHV0ZWQgPT09IEluZmluaXR5ICYmIHJlc3VsdCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgIHJlc3VsdCA9IHZhbHVlOwogICAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gU2h1ZmZsZSBhIGNvbGxlY3Rpb24sIHVzaW5nIHRoZSBtb2Rlcm4gdmVyc2lvbiBvZiB0aGUKICAvLyBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVy4oCTWWF0ZXNfc2h1ZmZsZSkuCiAgXy5zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgc2V0ID0gaXNBcnJheUxpa2Uob2JqKSA/IG9iaiA6IF8udmFsdWVzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0gc2V0Lmxlbmd0aDsKICAgIHZhciBzaHVmZmxlZCA9IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpbmRleCA9IDAsIHJhbmQ7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIHJhbmQgPSBfLnJhbmRvbSgwLCBpbmRleCk7CiAgICAgIGlmIChyYW5kICE9PSBpbmRleCkgc2h1ZmZsZWRbaW5kZXhdID0gc2h1ZmZsZWRbcmFuZF07CiAgICAgIHNodWZmbGVkW3JhbmRdID0gc2V0W2luZGV4XTsKICAgIH0KICAgIHJldHVybiBzaHVmZmxlZDsKICB9OwoKICAvLyBTYW1wbGUgKipuKiogcmFuZG9tIHZhbHVlcyBmcm9tIGEgY29sbGVjdGlvbi4KICAvLyBJZiAqKm4qKiBpcyBub3Qgc3BlY2lmaWVkLCByZXR1cm5zIGEgc2luZ2xlIHJhbmRvbSBlbGVtZW50LgogIC8vIFRoZSBpbnRlcm5hbCBgZ3VhcmRgIGFyZ3VtZW50IGFsbG93cyBpdCB0byB3b3JrIHdpdGggYG1hcGAuCiAgXy5zYW1wbGUgPSBmdW5jdGlvbihvYmosIG4sIGd1YXJkKSB7CiAgICBpZiAobiA9PSBudWxsIHx8IGd1YXJkKSB7CiAgICAgIGlmICghaXNBcnJheUxpa2Uob2JqKSkgb2JqID0gXy52YWx1ZXMob2JqKTsKICAgICAgcmV0dXJuIG9ialtfLnJhbmRvbShvYmoubGVuZ3RoIC0gMSldOwogICAgfQogICAgcmV0dXJuIF8uc2h1ZmZsZShvYmopLnNsaWNlKDAsIE1hdGgubWF4KDAsIG4pKTsKICB9OwoKICAvLyBTb3J0IHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24gcHJvZHVjZWQgYnkgYW4gaXRlcmF0ZWUuCiAgXy5zb3J0QnkgPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7CiAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgIHJldHVybiBfLnBsdWNrKF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIGluZGV4OiBpbmRleCwKICAgICAgICBjcml0ZXJpYTogaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBsaXN0KQogICAgICB9OwogICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWE7CiAgICAgIHZhciBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIGlmIChhICE9PSBiKSB7CiAgICAgICAgaWYgKGEgPiBiIHx8IGEgPT09IHZvaWQgMCkgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEgPCBiIHx8IGIgPT09IHZvaWQgMCkgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHJldHVybiBsZWZ0LmluZGV4IC0gcmlnaHQuaW5kZXg7CiAgICB9KSwgJ3ZhbHVlJyk7CiAgfTsKCiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmb3IgYWdncmVnYXRlICJncm91cCBieSIgb3BlcmF0aW9ucy4KICB2YXIgZ3JvdXAgPSBmdW5jdGlvbihiZWhhdmlvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgICAgXy5lYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgICAgdmFyIGtleSA9IGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgb2JqKTsKICAgICAgICBiZWhhdmlvcihyZXN1bHQsIHZhbHVlLCBrZXkpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gR3JvdXBzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24uIFBhc3MgZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZQogIC8vIHRvIGdyb3VwIGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY3JpdGVyaW9uLgogIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkgewogICAgaWYgKF8uaGFzKHJlc3VsdCwga2V5KSkgcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSk7IGVsc2UgcmVzdWx0W2tleV0gPSBbdmFsdWVdOwogIH0pOwoKICAvLyBJbmRleGVzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24sIHNpbWlsYXIgdG8gYGdyb3VwQnlgLCBidXQgZm9yCiAgLy8gd2hlbiB5b3Uga25vdyB0aGF0IHlvdXIgaW5kZXggdmFsdWVzIHdpbGwgYmUgdW5pcXVlLgogIF8uaW5kZXhCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkgewogICAgcmVzdWx0W2tleV0gPSB2YWx1ZTsKICB9KTsKCiAgLy8gQ291bnRzIGluc3RhbmNlcyBvZiBhbiBvYmplY3QgdGhhdCBncm91cCBieSBhIGNlcnRhaW4gY3JpdGVyaW9uLiBQYXNzCiAgLy8gZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZSB0byBjb3VudCBieSwgb3IgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlCiAgLy8gY3JpdGVyaW9uLgogIF8uY291bnRCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkgewogICAgaWYgKF8uaGFzKHJlc3VsdCwga2V5KSkgcmVzdWx0W2tleV0rKzsgZWxzZSByZXN1bHRba2V5XSA9IDE7CiAgfSk7CgogIC8vIFNhZmVseSBjcmVhdGUgYSByZWFsLCBsaXZlIGFycmF5IGZyb20gYW55dGhpbmcgaXRlcmFibGUuCiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIW9iaikgcmV0dXJuIFtdOwogICAgaWYgKF8uaXNBcnJheShvYmopKSByZXR1cm4gc2xpY2UuY2FsbChvYmopOwogICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHJldHVybiBfLm1hcChvYmosIF8uaWRlbnRpdHkpOwogICAgcmV0dXJuIF8udmFsdWVzKG9iaik7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gYW4gb2JqZWN0LgogIF8uc2l6ZSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gMDsKICAgIHJldHVybiBpc0FycmF5TGlrZShvYmopID8gb2JqLmxlbmd0aCA6IF8ua2V5cyhvYmopLmxlbmd0aDsKICB9OwoKICAvLyBTcGxpdCBhIGNvbGxlY3Rpb24gaW50byB0d28gYXJyYXlzOiBvbmUgd2hvc2UgZWxlbWVudHMgYWxsIHNhdGlzZnkgdGhlIGdpdmVuCiAgLy8gcHJlZGljYXRlLCBhbmQgb25lIHdob3NlIGVsZW1lbnRzIGFsbCBkbyBub3Qgc2F0aXNmeSB0aGUgcHJlZGljYXRlLgogIF8ucGFydGl0aW9uID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSA9IGNiKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICB2YXIgcGFzcyA9IFtdLCBmYWlsID0gW107CiAgICBfLmVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmopIHsKICAgICAgKHByZWRpY2F0ZSh2YWx1ZSwga2V5LCBvYmopID8gcGFzcyA6IGZhaWwpLnB1c2godmFsdWUpOwogICAgfSk7CiAgICByZXR1cm4gW3Bhc3MsIGZhaWxdOwogIH07CgogIC8vIEFycmF5IEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLQoKICAvLyBHZXQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4gYXJyYXkuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gdGhlIGZpcnN0IE4KICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LiBBbGlhc2VkIGFzIGBoZWFkYCBhbmQgYHRha2VgLiBUaGUgKipndWFyZCoqIGNoZWNrCiAgLy8gYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLgogIF8uZmlyc3QgPSBfLmhlYWQgPSBfLnRha2UgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkgcmV0dXJuIGFycmF5WzBdOwogICAgcmV0dXJuIF8uaW5pdGlhbChhcnJheSwgYXJyYXkubGVuZ3RoIC0gbik7CiAgfTsKCiAgLy8gUmV0dXJucyBldmVyeXRoaW5nIGJ1dCB0aGUgbGFzdCBlbnRyeSBvZiB0aGUgYXJyYXkuIEVzcGVjaWFsbHkgdXNlZnVsIG9uCiAgLy8gdGhlIGFyZ3VtZW50cyBvYmplY3QuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gYWxsIHRoZSB2YWx1ZXMgaW4KICAvLyB0aGUgYXJyYXksIGV4Y2x1ZGluZyB0aGUgbGFzdCBOLgogIF8uaW5pdGlhbCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIE1hdGgubWF4KDAsIGFycmF5Lmxlbmd0aCAtIChuID09IG51bGwgfHwgZ3VhcmQgPyAxIDogbikpKTsKICB9OwoKICAvLyBHZXQgdGhlIGxhc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgbGFzdCBOCiAgLy8gdmFsdWVzIGluIHRoZSBhcnJheS4KICBfLmxhc3QgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkgcmV0dXJuIGFycmF5W2FycmF5Lmxlbmd0aCAtIDFdOwogICAgcmV0dXJuIF8ucmVzdChhcnJheSwgTWF0aC5tYXgoMCwgYXJyYXkubGVuZ3RoIC0gbikpOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKm4qKiB3aWxsIHJldHVybgogIC8vIHRoZSByZXN0IE4gdmFsdWVzIGluIHRoZSBhcnJheS4KICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCBuID09IG51bGwgfHwgZ3VhcmQgPyAxIDogbik7CiAgfTsKCiAgLy8gVHJpbSBvdXQgYWxsIGZhbHN5IHZhbHVlcyBmcm9tIGFuIGFycmF5LgogIF8uY29tcGFjdCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIF8uaWRlbnRpdHkpOwogIH07CgogIC8vIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIGEgcmVjdXJzaXZlIGBmbGF0dGVuYCBmdW5jdGlvbi4KICB2YXIgZmxhdHRlbiA9IGZ1bmN0aW9uKGlucHV0LCBzaGFsbG93LCBzdHJpY3QsIHN0YXJ0SW5kZXgpIHsKICAgIHZhciBvdXRwdXQgPSBbXSwgaWR4ID0gMDsKICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4IHx8IDAsIGxlbmd0aCA9IGdldExlbmd0aChpbnB1dCk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgdmFsdWUgPSBpbnB1dFtpXTsKICAgICAgaWYgKGlzQXJyYXlMaWtlKHZhbHVlKSAmJiAoXy5pc0FycmF5KHZhbHVlKSB8fCBfLmlzQXJndW1lbnRzKHZhbHVlKSkpIHsKICAgICAgICAvL2ZsYXR0ZW4gY3VycmVudCBsZXZlbCBvZiBhcnJheSBvciBhcmd1bWVudHMgb2JqZWN0CiAgICAgICAgaWYgKCFzaGFsbG93KSB2YWx1ZSA9IGZsYXR0ZW4odmFsdWUsIHNoYWxsb3csIHN0cmljdCk7CiAgICAgICAgdmFyIGogPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7CiAgICAgICAgb3V0cHV0Lmxlbmd0aCArPSBsZW47CiAgICAgICAgd2hpbGUgKGogPCBsZW4pIHsKICAgICAgICAgIG91dHB1dFtpZHgrK10gPSB2YWx1ZVtqKytdOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghc3RyaWN0KSB7CiAgICAgICAgb3V0cHV0W2lkeCsrXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gb3V0cHV0OwogIH07CgogIC8vIEZsYXR0ZW4gb3V0IGFuIGFycmF5LCBlaXRoZXIgcmVjdXJzaXZlbHkgKGJ5IGRlZmF1bHQpLCBvciBqdXN0IG9uZSBsZXZlbC4KICBfLmZsYXR0ZW4gPSBmdW5jdGlvbihhcnJheSwgc2hhbGxvdykgewogICAgcmV0dXJuIGZsYXR0ZW4oYXJyYXksIHNoYWxsb3csIGZhbHNlKTsKICB9OwoKICAvLyBSZXR1cm4gYSB2ZXJzaW9uIG9mIHRoZSBhcnJheSB0aGF0IGRvZXMgbm90IGNvbnRhaW4gdGhlIHNwZWNpZmllZCB2YWx1ZShzKS4KICBfLndpdGhvdXQgPSBmdW5jdGlvbihhcnJheSkgewogICAgcmV0dXJuIF8uZGlmZmVyZW5jZShhcnJheSwgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICB9OwoKICAvLyBQcm9kdWNlIGEgZHVwbGljYXRlLWZyZWUgdmVyc2lvbiBvZiB0aGUgYXJyYXkuIElmIHRoZSBhcnJheSBoYXMgYWxyZWFkeQogIC8vIGJlZW4gc29ydGVkLCB5b3UgaGF2ZSB0aGUgb3B0aW9uIG9mIHVzaW5nIGEgZmFzdGVyIGFsZ29yaXRobS4KICAvLyBBbGlhc2VkIGFzIGB1bmlxdWVgLgogIF8udW5pcSA9IF8udW5pcXVlID0gZnVuY3Rpb24oYXJyYXksIGlzU29ydGVkLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaWYgKCFfLmlzQm9vbGVhbihpc1NvcnRlZCkpIHsKICAgICAgY29udGV4dCA9IGl0ZXJhdGVlOwogICAgICBpdGVyYXRlZSA9IGlzU29ydGVkOwogICAgICBpc1NvcnRlZCA9IGZhbHNlOwogICAgfQogICAgaWYgKGl0ZXJhdGVlICE9IG51bGwpIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpOwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgdmFyIHNlZW4gPSBbXTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBnZXRMZW5ndGgoYXJyYXkpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaV0sCiAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUsIGksIGFycmF5KSA6IHZhbHVlOwogICAgICBpZiAoaXNTb3J0ZWQpIHsKICAgICAgICBpZiAoIWkgfHwgc2VlbiAhPT0gY29tcHV0ZWQpIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgICBzZWVuID0gY29tcHV0ZWQ7CiAgICAgIH0gZWxzZSBpZiAoaXRlcmF0ZWUpIHsKICAgICAgICBpZiAoIV8uY29udGFpbnMoc2VlbiwgY29tcHV0ZWQpKSB7CiAgICAgICAgICBzZWVuLnB1c2goY29tcHV0ZWQpOwogICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghXy5jb250YWlucyhyZXN1bHQsIHZhbHVlKSkgewogICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2YKICAvLyB0aGUgcGFzc2VkLWluIGFycmF5cy4KICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy51bmlxKGZsYXR0ZW4oYXJndW1lbnRzLCB0cnVlLCB0cnVlKSk7CiAgfTsKCiAgLy8gUHJvZHVjZSBhbiBhcnJheSB0aGF0IGNvbnRhaW5zIGV2ZXJ5IGl0ZW0gc2hhcmVkIGJldHdlZW4gYWxsIHRoZQogIC8vIHBhc3NlZC1pbiBhcnJheXMuCiAgXy5pbnRlcnNlY3Rpb24gPSBmdW5jdGlvbihhcnJheSkgewogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgdmFyIGFyZ3NMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGdldExlbmd0aChhcnJheSk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgaXRlbSA9IGFycmF5W2ldOwogICAgICBpZiAoXy5jb250YWlucyhyZXN1bHQsIGl0ZW0pKSBjb250aW51ZTsKICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBhcmdzTGVuZ3RoOyBqKyspIHsKICAgICAgICBpZiAoIV8uY29udGFpbnMoYXJndW1lbnRzW2pdLCBpdGVtKSkgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGogPT09IGFyZ3NMZW5ndGgpIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBUYWtlIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gb25lIGFycmF5IGFuZCBhIG51bWJlciBvZiBvdGhlciBhcnJheXMuCiAgLy8gT25seSB0aGUgZWxlbWVudHMgcHJlc2VudCBpbiBqdXN0IHRoZSBmaXJzdCBhcnJheSB3aWxsIHJlbWFpbi4KICBfLmRpZmZlcmVuY2UgPSBmdW5jdGlvbihhcnJheSkgewogICAgdmFyIHJlc3QgPSBmbGF0dGVuKGFyZ3VtZW50cywgdHJ1ZSwgdHJ1ZSwgMSk7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKXsKICAgICAgcmV0dXJuICFfLmNvbnRhaW5zKHJlc3QsIHZhbHVlKTsKICAgIH0pOwogIH07CgogIC8vIFppcCB0b2dldGhlciBtdWx0aXBsZSBsaXN0cyBpbnRvIGEgc2luZ2xlIGFycmF5IC0tIGVsZW1lbnRzIHRoYXQgc2hhcmUKICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci4KICBfLnppcCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIF8udW56aXAoYXJndW1lbnRzKTsKICB9OwoKICAvLyBDb21wbGVtZW50IG9mIF8uemlwLiBVbnppcCBhY2NlcHRzIGFuIGFycmF5IG9mIGFycmF5cyBhbmQgZ3JvdXBzCiAgLy8gZWFjaCBhcnJheSdzIGVsZW1lbnRzIG9uIHNoYXJlZCBpbmRpY2VzCiAgXy51bnppcCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgJiYgXy5tYXgoYXJyYXksIGdldExlbmd0aCkubGVuZ3RoIHx8IDA7CiAgICB2YXIgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTsKCiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIHJlc3VsdFtpbmRleF0gPSBfLnBsdWNrKGFycmF5LCBpbmRleCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIENvbnZlcnRzIGxpc3RzIGludG8gb2JqZWN0cy4gUGFzcyBlaXRoZXIgYSBzaW5nbGUgYXJyYXkgb2YgYFtrZXksIHZhbHVlXWAKICAvLyBwYWlycywgb3IgdHdvIHBhcmFsbGVsIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGggLS0gb25lIG9mIGtleXMsIGFuZCBvbmUgb2YKICAvLyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXMuCiAgXy5vYmplY3QgPSBmdW5jdGlvbihsaXN0LCB2YWx1ZXMpIHsKICAgIHZhciByZXN1bHQgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBnZXRMZW5ndGgobGlzdCk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBpZiAodmFsdWVzKSB7CiAgICAgICAgcmVzdWx0W2xpc3RbaV1dID0gdmFsdWVzW2ldOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdFtsaXN0W2ldWzBdXSA9IGxpc3RbaV1bMV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gR2VuZXJhdG9yIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0aGUgZmluZEluZGV4IGFuZCBmaW5kTGFzdEluZGV4IGZ1bmN0aW9ucwogIGZ1bmN0aW9uIGNyZWF0ZVByZWRpY2F0ZUluZGV4RmluZGVyKGRpcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKGFycmF5LCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTsKICAgICAgdmFyIGxlbmd0aCA9IGdldExlbmd0aChhcnJheSk7CiAgICAgIHZhciBpbmRleCA9IGRpciA+IDAgPyAwIDogbGVuZ3RoIC0gMTsKICAgICAgZm9yICg7IGluZGV4ID49IDAgJiYgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IGRpcikgewogICAgICAgIGlmIChwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgICAgcmV0dXJuIC0xOwogICAgfTsKICB9CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGluZGV4IG9uIGFuIGFycmF5LWxpa2UgdGhhdCBwYXNzZXMgYSBwcmVkaWNhdGUgdGVzdAogIF8uZmluZEluZGV4ID0gY3JlYXRlUHJlZGljYXRlSW5kZXhGaW5kZXIoMSk7CiAgXy5maW5kTGFzdEluZGV4ID0gY3JlYXRlUHJlZGljYXRlSW5kZXhGaW5kZXIoLTEpOwoKICAvLyBVc2UgYSBjb21wYXJhdG9yIGZ1bmN0aW9uIHRvIGZpZ3VyZSBvdXQgdGhlIHNtYWxsZXN0IGluZGV4IGF0IHdoaWNoCiAgLy8gYW4gb2JqZWN0IHNob3VsZCBiZSBpbnNlcnRlZCBzbyBhcyB0byBtYWludGFpbiBvcmRlci4gVXNlcyBiaW5hcnkgc2VhcmNoLgogIF8uc29ydGVkSW5kZXggPSBmdW5jdGlvbihhcnJheSwgb2JqLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCwgMSk7CiAgICB2YXIgdmFsdWUgPSBpdGVyYXRlZShvYmopOwogICAgdmFyIGxvdyA9IDAsIGhpZ2ggPSBnZXRMZW5ndGgoYXJyYXkpOwogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IE1hdGguZmxvb3IoKGxvdyArIGhpZ2gpIC8gMik7CiAgICAgIGlmIChpdGVyYXRlZShhcnJheVttaWRdKSA8IHZhbHVlKSBsb3cgPSBtaWQgKyAxOyBlbHNlIGhpZ2ggPSBtaWQ7CiAgICB9CiAgICByZXR1cm4gbG93OwogIH07CgogIC8vIEdlbmVyYXRvciBmdW5jdGlvbiB0byBjcmVhdGUgdGhlIGluZGV4T2YgYW5kIGxhc3RJbmRleE9mIGZ1bmN0aW9ucwogIGZ1bmN0aW9uIGNyZWF0ZUluZGV4RmluZGVyKGRpciwgcHJlZGljYXRlRmluZCwgc29ydGVkSW5kZXgpIHsKICAgIHJldHVybiBmdW5jdGlvbihhcnJheSwgaXRlbSwgaWR4KSB7CiAgICAgIHZhciBpID0gMCwgbGVuZ3RoID0gZ2V0TGVuZ3RoKGFycmF5KTsKICAgICAgaWYgKHR5cGVvZiBpZHggPT0gJ251bWJlcicpIHsKICAgICAgICBpZiAoZGlyID4gMCkgewogICAgICAgICAgICBpID0gaWR4ID49IDAgPyBpZHggOiBNYXRoLm1heChpZHggKyBsZW5ndGgsIGkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxlbmd0aCA9IGlkeCA+PSAwID8gTWF0aC5taW4oaWR4ICsgMSwgbGVuZ3RoKSA6IGlkeCArIGxlbmd0aCArIDE7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHNvcnRlZEluZGV4ICYmIGlkeCAmJiBsZW5ndGgpIHsKICAgICAgICBpZHggPSBzb3J0ZWRJbmRleChhcnJheSwgaXRlbSk7CiAgICAgICAgcmV0dXJuIGFycmF5W2lkeF0gPT09IGl0ZW0gPyBpZHggOiAtMTsKICAgICAgfQogICAgICBpZiAoaXRlbSAhPT0gaXRlbSkgewogICAgICAgIGlkeCA9IHByZWRpY2F0ZUZpbmQoc2xpY2UuY2FsbChhcnJheSwgaSwgbGVuZ3RoKSwgXy5pc05hTik7CiAgICAgICAgcmV0dXJuIGlkeCA+PSAwID8gaWR4ICsgaSA6IC0xOwogICAgICB9CiAgICAgIGZvciAoaWR4ID0gZGlyID4gMCA/IGkgOiBsZW5ndGggLSAxOyBpZHggPj0gMCAmJiBpZHggPCBsZW5ndGg7IGlkeCArPSBkaXIpIHsKICAgICAgICBpZiAoYXJyYXlbaWR4XSA9PT0gaXRlbSkgcmV0dXJuIGlkeDsKICAgICAgfQogICAgICByZXR1cm4gLTE7CiAgICB9OwogIH0KCiAgLy8gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbiBpdGVtIGluIGFuIGFycmF5LAogIC8vIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuCiAgLy8gSWYgdGhlIGFycmF5IGlzIGxhcmdlIGFuZCBhbHJlYWR5IGluIHNvcnQgb3JkZXIsIHBhc3MgYHRydWVgCiAgLy8gZm9yICoqaXNTb3J0ZWQqKiB0byB1c2UgYmluYXJ5IHNlYXJjaC4KICBfLmluZGV4T2YgPSBjcmVhdGVJbmRleEZpbmRlcigxLCBfLmZpbmRJbmRleCwgXy5zb3J0ZWRJbmRleCk7CiAgXy5sYXN0SW5kZXhPZiA9IGNyZWF0ZUluZGV4RmluZGVyKC0xLCBfLmZpbmRMYXN0SW5kZXgpOwoKICAvLyBHZW5lcmF0ZSBhbiBpbnRlZ2VyIEFycmF5IGNvbnRhaW5pbmcgYW4gYXJpdGhtZXRpYyBwcm9ncmVzc2lvbi4gQSBwb3J0IG9mCiAgLy8gdGhlIG5hdGl2ZSBQeXRob24gYHJhbmdlKClgIGZ1bmN0aW9uLiBTZWUKICAvLyBbdGhlIFB5dGhvbiBkb2N1bWVudGF0aW9uXShodHRwOi8vZG9jcy5weXRob24ub3JnL2xpYnJhcnkvZnVuY3Rpb25zLmh0bWwjcmFuZ2UpLgogIF8ucmFuZ2UgPSBmdW5jdGlvbihzdGFydCwgc3RvcCwgc3RlcCkgewogICAgaWYgKHN0b3AgPT0gbnVsbCkgewogICAgICBzdG9wID0gc3RhcnQgfHwgMDsKICAgICAgc3RhcnQgPSAwOwogICAgfQogICAgc3RlcCA9IHN0ZXAgfHwgMTsKCiAgICB2YXIgbGVuZ3RoID0gTWF0aC5tYXgoTWF0aC5jZWlsKChzdG9wIC0gc3RhcnQpIC8gc3RlcCksIDApOwogICAgdmFyIHJhbmdlID0gQXJyYXkobGVuZ3RoKTsKCiAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrLCBzdGFydCArPSBzdGVwKSB7CiAgICAgIHJhbmdlW2lkeF0gPSBzdGFydDsKICAgIH0KCiAgICByZXR1cm4gcmFuZ2U7CiAgfTsKCiAgLy8gRnVuY3Rpb24gKGFoZW0pIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBEZXRlcm1pbmVzIHdoZXRoZXIgdG8gZXhlY3V0ZSBhIGZ1bmN0aW9uIGFzIGEgY29uc3RydWN0b3IKICAvLyBvciBhIG5vcm1hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm92aWRlZCBhcmd1bWVudHMKICB2YXIgZXhlY3V0ZUJvdW5kID0gZnVuY3Rpb24oc291cmNlRnVuYywgYm91bmRGdW5jLCBjb250ZXh0LCBjYWxsaW5nQ29udGV4dCwgYXJncykgewogICAgaWYgKCEoY2FsbGluZ0NvbnRleHQgaW5zdGFuY2VvZiBib3VuZEZ1bmMpKSByZXR1cm4gc291cmNlRnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgIHZhciBzZWxmID0gYmFzZUNyZWF0ZShzb3VyY2VGdW5jLnByb3RvdHlwZSk7CiAgICB2YXIgcmVzdWx0ID0gc291cmNlRnVuYy5hcHBseShzZWxmLCBhcmdzKTsKICAgIGlmIChfLmlzT2JqZWN0KHJlc3VsdCkpIHJldHVybiByZXN1bHQ7CiAgICByZXR1cm4gc2VsZjsKICB9OwoKICAvLyBDcmVhdGUgYSBmdW5jdGlvbiBib3VuZCB0byBhIGdpdmVuIG9iamVjdCAoYXNzaWduaW5nIGB0aGlzYCwgYW5kIGFyZ3VtZW50cywKICAvLyBvcHRpb25hbGx5KS4gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYEZ1bmN0aW9uLmJpbmRgIGlmCiAgLy8gYXZhaWxhYmxlLgogIF8uYmluZCA9IGZ1bmN0aW9uKGZ1bmMsIGNvbnRleHQpIHsKICAgIGlmIChuYXRpdmVCaW5kICYmIGZ1bmMuYmluZCA9PT0gbmF0aXZlQmluZCkgcmV0dXJuIG5hdGl2ZUJpbmQuYXBwbHkoZnVuYywgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgIGlmICghXy5pc0Z1bmN0aW9uKGZ1bmMpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdCaW5kIG11c3QgYmUgY2FsbGVkIG9uIGEgZnVuY3Rpb24nKTsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgdmFyIGJvdW5kID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBleGVjdXRlQm91bmQoZnVuYywgYm91bmQsIGNvbnRleHQsIHRoaXMsIGFyZ3MuY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgfTsKICAgIHJldHVybiBib3VuZDsKICB9OwoKICAvLyBQYXJ0aWFsbHkgYXBwbHkgYSBmdW5jdGlvbiBieSBjcmVhdGluZyBhIHZlcnNpb24gdGhhdCBoYXMgaGFkIHNvbWUgb2YgaXRzCiAgLy8gYXJndW1lbnRzIHByZS1maWxsZWQsIHdpdGhvdXQgY2hhbmdpbmcgaXRzIGR5bmFtaWMgYHRoaXNgIGNvbnRleHQuIF8gYWN0cwogIC8vIGFzIGEgcGxhY2Vob2xkZXIsIGFsbG93aW5nIGFueSBjb21iaW5hdGlvbiBvZiBhcmd1bWVudHMgdG8gYmUgcHJlLWZpbGxlZC4KICBfLnBhcnRpYWwgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgYm91bmRBcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgdmFyIGJvdW5kID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBwb3NpdGlvbiA9IDAsIGxlbmd0aCA9IGJvdW5kQXJncy5sZW5ndGg7CiAgICAgIHZhciBhcmdzID0gQXJyYXkobGVuZ3RoKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGFyZ3NbaV0gPSBib3VuZEFyZ3NbaV0gPT09IF8gPyBhcmd1bWVudHNbcG9zaXRpb24rK10gOiBib3VuZEFyZ3NbaV07CiAgICAgIH0KICAgICAgd2hpbGUgKHBvc2l0aW9uIDwgYXJndW1lbnRzLmxlbmd0aCkgYXJncy5wdXNoKGFyZ3VtZW50c1twb3NpdGlvbisrXSk7CiAgICAgIHJldHVybiBleGVjdXRlQm91bmQoZnVuYywgYm91bmQsIHRoaXMsIHRoaXMsIGFyZ3MpOwogICAgfTsKICAgIHJldHVybiBib3VuZDsKICB9OwoKICAvLyBCaW5kIGEgbnVtYmVyIG9mIGFuIG9iamVjdCdzIG1ldGhvZHMgdG8gdGhhdCBvYmplY3QuIFJlbWFpbmluZyBhcmd1bWVudHMKICAvLyBhcmUgdGhlIG1ldGhvZCBuYW1lcyB0byBiZSBib3VuZC4gVXNlZnVsIGZvciBlbnN1cmluZyB0aGF0IGFsbCBjYWxsYmFja3MKICAvLyBkZWZpbmVkIG9uIGFuIG9iamVjdCBiZWxvbmcgdG8gaXQuCiAgXy5iaW5kQWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgaSwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCwga2V5OwogICAgaWYgKGxlbmd0aCA8PSAxKSB0aHJvdyBuZXcgRXJyb3IoJ2JpbmRBbGwgbXVzdCBiZSBwYXNzZWQgZnVuY3Rpb24gbmFtZXMnKTsKICAgIGZvciAoaSA9IDE7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBrZXkgPSBhcmd1bWVudHNbaV07CiAgICAgIG9ialtrZXldID0gXy5iaW5kKG9ialtrZXldLCBvYmopOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBNZW1vaXplIGFuIGV4cGVuc2l2ZSBmdW5jdGlvbiBieSBzdG9yaW5nIGl0cyByZXN1bHRzLgogIF8ubWVtb2l6ZSA9IGZ1bmN0aW9uKGZ1bmMsIGhhc2hlcikgewogICAgdmFyIG1lbW9pemUgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgdmFyIGNhY2hlID0gbWVtb2l6ZS5jYWNoZTsKICAgICAgdmFyIGFkZHJlc3MgPSAnJyArIChoYXNoZXIgPyBoYXNoZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGtleSk7CiAgICAgIGlmICghXy5oYXMoY2FjaGUsIGFkZHJlc3MpKSBjYWNoZVthZGRyZXNzXSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIGNhY2hlW2FkZHJlc3NdOwogICAgfTsKICAgIG1lbW9pemUuY2FjaGUgPSB7fTsKICAgIHJldHVybiBtZW1vaXplOwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7CiAgICB9LCB3YWl0KTsKICB9OwoKICAvLyBEZWZlcnMgYSBmdW5jdGlvbiwgc2NoZWR1bGluZyBpdCB0byBydW4gYWZ0ZXIgdGhlIGN1cnJlbnQgY2FsbCBzdGFjayBoYXMKICAvLyBjbGVhcmVkLgogIF8uZGVmZXIgPSBfLnBhcnRpYWwoXy5kZWxheSwgXywgMSk7CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiwgdGhhdCwgd2hlbiBpbnZva2VkLCB3aWxsIG9ubHkgYmUgdHJpZ2dlcmVkIGF0IG1vc3Qgb25jZQogIC8vIGR1cmluZyBhIGdpdmVuIHdpbmRvdyBvZiB0aW1lLiBOb3JtYWxseSwgdGhlIHRocm90dGxlZCBmdW5jdGlvbiB3aWxsIHJ1bgogIC8vIGFzIG11Y2ggYXMgaXQgY2FuLCB3aXRob3V0IGV2ZXIgZ29pbmcgbW9yZSB0aGFuIG9uY2UgcGVyIGB3YWl0YCBkdXJhdGlvbjsKICAvLyBidXQgaWYgeW91J2QgbGlrZSB0byBkaXNhYmxlIHRoZSBleGVjdXRpb24gb24gdGhlIGxlYWRpbmcgZWRnZSwgcGFzcwogIC8vIGB7bGVhZGluZzogZmFsc2V9YC4gVG8gZGlzYWJsZSBleGVjdXRpb24gb24gdGhlIHRyYWlsaW5nIGVkZ2UsIGRpdHRvLgogIF8udGhyb3R0bGUgPSBmdW5jdGlvbihmdW5jLCB3YWl0LCBvcHRpb25zKSB7CiAgICB2YXIgY29udGV4dCwgYXJncywgcmVzdWx0OwogICAgdmFyIHRpbWVvdXQgPSBudWxsOwogICAgdmFyIHByZXZpb3VzID0gMDsKICAgIGlmICghb3B0aW9ucykgb3B0aW9ucyA9IHt9OwogICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgIHByZXZpb3VzID0gb3B0aW9ucy5sZWFkaW5nID09PSBmYWxzZSA/IDAgOiBfLm5vdygpOwogICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgaWYgKCF0aW1lb3V0KSBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICB9OwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgbm93ID0gXy5ub3coKTsKICAgICAgaWYgKCFwcmV2aW91cyAmJiBvcHRpb25zLmxlYWRpbmcgPT09IGZhbHNlKSBwcmV2aW91cyA9IG5vdzsKICAgICAgdmFyIHJlbWFpbmluZyA9IHdhaXQgLSAobm93IC0gcHJldmlvdXMpOwogICAgICBjb250ZXh0ID0gdGhpczsKICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgaWYgKHJlbWFpbmluZyA8PSAwIHx8IHJlbWFpbmluZyA+IHdhaXQpIHsKICAgICAgICBpZiAodGltZW91dCkgewogICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHByZXZpb3VzID0gbm93OwogICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgaWYgKCF0aW1lb3V0KSBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0aW9ucy50cmFpbGluZyAhPT0gZmFsc2UpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZQogIC8vIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuCiAgXy5kZWJvdW5jZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0OwoKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbGFzdCA9IF8ubm93KCkgLSB0aW1lc3RhbXA7CgogICAgICBpZiAobGFzdCA8IHdhaXQgJiYgbGFzdCA+PSAwKSB7CiAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQgLSBsYXN0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBpZiAoIWltbWVkaWF0ZSkgewogICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgIGlmICghdGltZW91dCkgY29udGV4dCA9IGFyZ3MgPSBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGNvbnRleHQgPSB0aGlzOwogICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICB0aW1lc3RhbXAgPSBfLm5vdygpOwogICAgICB2YXIgY2FsbE5vdyA9IGltbWVkaWF0ZSAmJiAhdGltZW91dDsKICAgICAgaWYgKCF0aW1lb3V0KSB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgIGlmIChjYWxsTm93KSB7CiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byB0aGUgc2Vjb25kLAogIC8vIGFsbG93aW5nIHlvdSB0byBhZGp1c3QgYXJndW1lbnRzLCBydW4gY29kZSBiZWZvcmUgYW5kIGFmdGVyLCBhbmQKICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLgogIF8ud3JhcCA9IGZ1bmN0aW9uKGZ1bmMsIHdyYXBwZXIpIHsKICAgIHJldHVybiBfLnBhcnRpYWwod3JhcHBlciwgZnVuYyk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIG5lZ2F0ZWQgdmVyc2lvbiBvZiB0aGUgcGFzc2VkLWluIHByZWRpY2F0ZS4KICBfLm5lZ2F0ZSA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gIXByZWRpY2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBpcyB0aGUgY29tcG9zaXRpb24gb2YgYSBsaXN0IG9mIGZ1bmN0aW9ucywgZWFjaAogIC8vIGNvbnN1bWluZyB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBmdW5jdGlvbiB0aGF0IGZvbGxvd3MuCiAgXy5jb21wb3NlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgIHZhciBzdGFydCA9IGFyZ3MubGVuZ3RoIC0gMTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGkgPSBzdGFydDsKICAgICAgdmFyIHJlc3VsdCA9IGFyZ3Nbc3RhcnRdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHdoaWxlIChpLS0pIHJlc3VsdCA9IGFyZ3NbaV0uY2FsbCh0aGlzLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgb24gYW5kIGFmdGVyIHRoZSBOdGggY2FsbC4KICBfLmFmdGVyID0gZnVuY3Rpb24odGltZXMsIGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKC0tdGltZXMgPCAxKSB7CiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgdXAgdG8gKGJ1dCBub3QgaW5jbHVkaW5nKSB0aGUgTnRoIGNhbGwuCiAgXy5iZWZvcmUgPSBmdW5jdGlvbih0aW1lcywgZnVuYykgewogICAgdmFyIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmICgtLXRpbWVzID4gMCkgewogICAgICAgIG1lbW8gPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgaWYgKHRpbWVzIDw9IDEpIGZ1bmMgPSBudWxsOwogICAgICByZXR1cm4gbWVtbzsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBfLnBhcnRpYWwoXy5iZWZvcmUsIDIpOwoKICAvLyBPYmplY3QgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBLZXlzIGluIElFIDwgOSB0aGF0IHdvbid0IGJlIGl0ZXJhdGVkIGJ5IGBmb3Iga2V5IGluIC4uLmAgYW5kIHRodXMgbWlzc2VkLgogIHZhciBoYXNFbnVtQnVnID0gIXt0b1N0cmluZzogbnVsbH0ucHJvcGVydHlJc0VudW1lcmFibGUoJ3RvU3RyaW5nJyk7CiAgdmFyIG5vbkVudW1lcmFibGVQcm9wcyA9IFsndmFsdWVPZicsICdpc1Byb3RvdHlwZU9mJywgJ3RvU3RyaW5nJywKICAgICAgICAgICAgICAgICAgICAgICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsICdoYXNPd25Qcm9wZXJ0eScsICd0b0xvY2FsZVN0cmluZyddOwoKICBmdW5jdGlvbiBjb2xsZWN0Tm9uRW51bVByb3BzKG9iaiwga2V5cykgewogICAgdmFyIG5vbkVudW1JZHggPSBub25FbnVtZXJhYmxlUHJvcHMubGVuZ3RoOwogICAgdmFyIGNvbnN0cnVjdG9yID0gb2JqLmNvbnN0cnVjdG9yOwogICAgdmFyIHByb3RvID0gKF8uaXNGdW5jdGlvbihjb25zdHJ1Y3RvcikgJiYgY29uc3RydWN0b3IucHJvdG90eXBlKSB8fCBPYmpQcm90bzsKCiAgICAvLyBDb25zdHJ1Y3RvciBpcyBhIHNwZWNpYWwgY2FzZS4KICAgIHZhciBwcm9wID0gJ2NvbnN0cnVjdG9yJzsKICAgIGlmIChfLmhhcyhvYmosIHByb3ApICYmICFfLmNvbnRhaW5zKGtleXMsIHByb3ApKSBrZXlzLnB1c2gocHJvcCk7CgogICAgd2hpbGUgKG5vbkVudW1JZHgtLSkgewogICAgICBwcm9wID0gbm9uRW51bWVyYWJsZVByb3BzW25vbkVudW1JZHhdOwogICAgICBpZiAocHJvcCBpbiBvYmogJiYgb2JqW3Byb3BdICE9PSBwcm90b1twcm9wXSAmJiAhXy5jb250YWlucyhrZXlzLCBwcm9wKSkgewogICAgICAgIGtleXMucHVzaChwcm9wKTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gUmV0cmlldmUgdGhlIG5hbWVzIG9mIGFuIG9iamVjdCdzIG93biBwcm9wZXJ0aWVzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBPYmplY3Qua2V5c2AKICBfLmtleXMgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gW107CiAgICBpZiAobmF0aXZlS2V5cykgcmV0dXJuIG5hdGl2ZUtleXMob2JqKTsKICAgIHZhciBrZXlzID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoXy5oYXMob2JqLCBrZXkpKSBrZXlzLnB1c2goa2V5KTsKICAgIC8vIEFoZW0sIElFIDwgOS4KICAgIGlmIChoYXNFbnVtQnVnKSBjb2xsZWN0Tm9uRW51bVByb3BzKG9iaiwga2V5cyk7CiAgICByZXR1cm4ga2V5czsKICB9OwoKICAvLyBSZXRyaWV2ZSBhbGwgdGhlIHByb3BlcnR5IG5hbWVzIG9mIGFuIG9iamVjdC4KICBfLmFsbEtleXMgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gW107CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikga2V5cy5wdXNoKGtleSk7CiAgICAvLyBBaGVtLCBJRSA8IDkuCiAgICBpZiAoaGFzRW51bUJ1ZykgY29sbGVjdE5vbkVudW1Qcm9wcyhvYmosIGtleXMpOwogICAgcmV0dXJuIGtleXM7CiAgfTsKCiAgLy8gUmV0cmlldmUgdGhlIHZhbHVlcyBvZiBhbiBvYmplY3QncyBwcm9wZXJ0aWVzLgogIF8udmFsdWVzID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopOwogICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgdmFyIHZhbHVlcyA9IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhbHVlc1tpXSA9IG9ialtrZXlzW2ldXTsKICAgIH0KICAgIHJldHVybiB2YWx1ZXM7CiAgfTsKCiAgLy8gUmV0dXJucyB0aGUgcmVzdWx0cyBvZiBhcHBseWluZyB0aGUgaXRlcmF0ZWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBvYmplY3QKICAvLyBJbiBjb250cmFzdCB0byBfLm1hcCBpdCByZXR1cm5zIGFuIG9iamVjdAogIF8ubWFwT2JqZWN0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7CiAgICB2YXIga2V5cyA9ICBfLmtleXMob2JqKSwKICAgICAgICAgIGxlbmd0aCA9IGtleXMubGVuZ3RoLAogICAgICAgICAgcmVzdWx0cyA9IHt9LAogICAgICAgICAgY3VycmVudEtleTsKICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIGN1cnJlbnRLZXkgPSBrZXlzW2luZGV4XTsKICAgICAgICByZXN1bHRzW2N1cnJlbnRLZXldID0gaXRlcmF0ZWUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIENvbnZlcnQgYW4gb2JqZWN0IGludG8gYSBsaXN0IG9mIGBba2V5LCB2YWx1ZV1gIHBhaXJzLgogIF8ucGFpcnMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICB2YXIgcGFpcnMgPSBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBwYWlyc1tpXSA9IFtrZXlzW2ldLCBvYmpba2V5c1tpXV1dOwogICAgfQogICAgcmV0dXJuIHBhaXJzOwogIH07CgogIC8vIEludmVydCB0aGUga2V5cyBhbmQgdmFsdWVzIG9mIGFuIG9iamVjdC4gVGhlIHZhbHVlcyBtdXN0IGJlIHNlcmlhbGl6YWJsZS4KICBfLmludmVydCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIHJlc3VsdCA9IHt9OwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdFtvYmpba2V5c1tpXV1dID0ga2V5c1tpXTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSkgbmFtZXMucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGNyZWF0ZUFzc2lnbmVyKF8uYWxsS2V5cyk7CgogIC8vIEFzc2lnbnMgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIG93biBwcm9wZXJ0aWVzIGluIHRoZSBwYXNzZWQtaW4gb2JqZWN0KHMpCiAgLy8gKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9hc3NpZ24pCiAgXy5leHRlbmRPd24gPSBfLmFzc2lnbiA9IGNyZWF0ZUFzc2lnbmVyKF8ua2V5cyk7CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGtleSBvbiBhbiBvYmplY3QgdGhhdCBwYXNzZXMgYSBwcmVkaWNhdGUgdGVzdAogIF8uZmluZEtleSA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpOwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKSwga2V5OwogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAga2V5ID0ga2V5c1tpXTsKICAgICAgaWYgKHByZWRpY2F0ZShvYmpba2V5XSwga2V5LCBvYmopKSByZXR1cm4ga2V5OwogICAgfQogIH07CgogIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCBvbmx5IGNvbnRhaW5pbmcgdGhlIHdoaXRlbGlzdGVkIHByb3BlcnRpZXMuCiAgXy5waWNrID0gZnVuY3Rpb24ob2JqZWN0LCBvaXRlcmF0ZWUsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQgPSB7fSwgb2JqID0gb2JqZWN0LCBpdGVyYXRlZSwga2V5czsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChfLmlzRnVuY3Rpb24ob2l0ZXJhdGVlKSkgewogICAgICBrZXlzID0gXy5hbGxLZXlzKG9iaik7CiAgICAgIGl0ZXJhdGVlID0gb3B0aW1pemVDYihvaXRlcmF0ZWUsIGNvbnRleHQpOwogICAgfSBlbHNlIHsKICAgICAga2V5cyA9IGZsYXR0ZW4oYXJndW1lbnRzLCBmYWxzZSwgZmFsc2UsIDEpOwogICAgICBpdGVyYXRlZSA9IGZ1bmN0aW9uKHZhbHVlLCBrZXksIG9iaikgeyByZXR1cm4ga2V5IGluIG9iajsgfTsKICAgICAgb2JqID0gT2JqZWN0KG9iaik7CiAgICB9CiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgdmFyIHZhbHVlID0gb2JqW2tleV07CiAgICAgIGlmIChpdGVyYXRlZSh2YWx1ZSwga2V5LCBvYmopKSByZXN1bHRba2V5XSA9IHZhbHVlOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgb2JqZWN0IHdpdGhvdXQgdGhlIGJsYWNrbGlzdGVkIHByb3BlcnRpZXMuCiAgXy5vbWl0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaWYgKF8uaXNGdW5jdGlvbihpdGVyYXRlZSkpIHsKICAgICAgaXRlcmF0ZWUgPSBfLm5lZ2F0ZShpdGVyYXRlZSk7CiAgICB9IGVsc2UgewogICAgICB2YXIga2V5cyA9IF8ubWFwKGZsYXR0ZW4oYXJndW1lbnRzLCBmYWxzZSwgZmFsc2UsIDEpLCBTdHJpbmcpOwogICAgICBpdGVyYXRlZSA9IGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgICAgICByZXR1cm4gIV8uY29udGFpbnMoa2V5cywga2V5KTsKICAgICAgfTsKICAgIH0KICAgIHJldHVybiBfLnBpY2sob2JqLCBpdGVyYXRlZSwgY29udGV4dCk7CiAgfTsKCiAgLy8gRmlsbCBpbiBhIGdpdmVuIG9iamVjdCB3aXRoIGRlZmF1bHQgcHJvcGVydGllcy4KICBfLmRlZmF1bHRzID0gY3JlYXRlQXNzaWduZXIoXy5hbGxLZXlzLCB0cnVlKTsKCiAgLy8gQ3JlYXRlcyBhbiBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIHRoZSBnaXZlbiBwcm90b3R5cGUgb2JqZWN0LgogIC8vIElmIGFkZGl0aW9uYWwgcHJvcGVydGllcyBhcmUgcHJvdmlkZWQgdGhlbiB0aGV5IHdpbGwgYmUgYWRkZWQgdG8gdGhlCiAgLy8gY3JlYXRlZCBvYmplY3QuCiAgXy5jcmVhdGUgPSBmdW5jdGlvbihwcm90b3R5cGUsIHByb3BzKSB7CiAgICB2YXIgcmVzdWx0ID0gYmFzZUNyZWF0ZShwcm90b3R5cGUpOwogICAgaWYgKHByb3BzKSBfLmV4dGVuZE93bihyZXN1bHQsIHByb3BzKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gQ3JlYXRlIGEgKHNoYWxsb3ctY2xvbmVkKSBkdXBsaWNhdGUgb2YgYW4gb2JqZWN0LgogIF8uY2xvbmUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gb2JqOwogICAgcmV0dXJuIF8uaXNBcnJheShvYmopID8gb2JqLnNsaWNlKCkgOiBfLmV4dGVuZCh7fSwgb2JqKTsKICB9OwoKICAvLyBJbnZva2VzIGludGVyY2VwdG9yIHdpdGggdGhlIG9iaiwgYW5kIHRoZW4gcmV0dXJucyBvYmouCiAgLy8gVGhlIHByaW1hcnkgcHVycG9zZSBvZiB0aGlzIG1ldGhvZCBpcyB0byAidGFwIGludG8iIGEgbWV0aG9kIGNoYWluLCBpbgogIC8vIG9yZGVyIHRvIHBlcmZvcm0gb3BlcmF0aW9ucyBvbiBpbnRlcm1lZGlhdGUgcmVzdWx0cyB3aXRoaW4gdGhlIGNoYWluLgogIF8udGFwID0gZnVuY3Rpb24ob2JqLCBpbnRlcmNlcHRvcikgewogICAgaW50ZXJjZXB0b3Iob2JqKTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gUmV0dXJucyB3aGV0aGVyIGFuIG9iamVjdCBoYXMgYSBnaXZlbiBzZXQgb2YgYGtleTp2YWx1ZWAgcGFpcnMuCiAgXy5pc01hdGNoID0gZnVuY3Rpb24ob2JqZWN0LCBhdHRycykgewogICAgdmFyIGtleXMgPSBfLmtleXMoYXR0cnMpLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgIGlmIChvYmplY3QgPT0gbnVsbCkgcmV0dXJuICFsZW5ndGg7CiAgICB2YXIgb2JqID0gT2JqZWN0KG9iamVjdCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICBpZiAoYXR0cnNba2V5XSAhPT0gb2JqW2tleV0gfHwgIShrZXkgaW4gb2JqKSkgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfTsKCgogIC8vIEludGVybmFsIHJlY3Vyc2l2ZSBjb21wYXJpc29uIGZ1bmN0aW9uIGZvciBgaXNFcXVhbGAuCiAgdmFyIGVxID0gZnVuY3Rpb24oYSwgYiwgYVN0YWNrLCBiU3RhY2spIHsKICAgIC8vIElkZW50aWNhbCBvYmplY3RzIGFyZSBlcXVhbC4gYDAgPT09IC0wYCwgYnV0IHRoZXkgYXJlbid0IGlkZW50aWNhbC4KICAgIC8vIFNlZSB0aGUgW0hhcm1vbnkgYGVnYWxgIHByb3Bvc2FsXShodHRwOi8vd2lraS5lY21hc2NyaXB0Lm9yZy9kb2t1LnBocD9pZD1oYXJtb255OmVnYWwpLgogICAgaWYgKGEgPT09IGIpIHJldHVybiBhICE9PSAwIHx8IDEgLyBhID09PSAxIC8gYjsKICAgIC8vIEEgc3RyaWN0IGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5IGJlY2F1c2UgYG51bGwgPT0gdW5kZWZpbmVkYC4KICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEgaW5zdGFuY2VvZiBfKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiIGluc3RhbmNlb2YgXykgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBDb21wYXJlIGBbW0NsYXNzXV1gIG5hbWVzLgogICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSk7CiAgICBpZiAoY2xhc3NOYW1lICE9PSB0b1N0cmluZy5jYWxsKGIpKSByZXR1cm4gZmFsc2U7CiAgICBzd2l0Y2ggKGNsYXNzTmFtZSkgewogICAgICAvLyBTdHJpbmdzLCBudW1iZXJzLCByZWd1bGFyIGV4cHJlc3Npb25zLCBkYXRlcywgYW5kIGJvb2xlYW5zIGFyZSBjb21wYXJlZCBieSB2YWx1ZS4KICAgICAgY2FzZSAnW29iamVjdCBSZWdFeHBdJzoKICAgICAgLy8gUmVnRXhwcyBhcmUgY29lcmNlZCB0byBzdHJpbmdzIGZvciBjb21wYXJpc29uIChOb3RlOiAnJyArIC9hL2kgPT09ICcvYS9pJykKICAgICAgY2FzZSAnW29iamVjdCBTdHJpbmddJzoKICAgICAgICAvLyBQcmltaXRpdmVzIGFuZCB0aGVpciBjb3JyZXNwb25kaW5nIG9iamVjdCB3cmFwcGVycyBhcmUgZXF1aXZhbGVudDsgdGh1cywgYCI1ImAgaXMKICAgICAgICAvLyBlcXVpdmFsZW50IHRvIGBuZXcgU3RyaW5nKCI1IilgLgogICAgICAgIHJldHVybiAnJyArIGEgPT09ICcnICsgYjsKICAgICAgY2FzZSAnW29iamVjdCBOdW1iZXJdJzoKICAgICAgICAvLyBgTmFOYHMgYXJlIGVxdWl2YWxlbnQsIGJ1dCBub24tcmVmbGV4aXZlLgogICAgICAgIC8vIE9iamVjdChOYU4pIGlzIGVxdWl2YWxlbnQgdG8gTmFOCiAgICAgICAgaWYgKCthICE9PSArYSkgcmV0dXJuICtiICE9PSArYjsKICAgICAgICAvLyBBbiBgZWdhbGAgY29tcGFyaXNvbiBpcyBwZXJmb3JtZWQgZm9yIG90aGVyIG51bWVyaWMgdmFsdWVzLgogICAgICAgIHJldHVybiArYSA9PT0gMCA/IDEgLyArYSA9PT0gMSAvIGIgOiArYSA9PT0gK2I7CiAgICAgIGNhc2UgJ1tvYmplY3QgRGF0ZV0nOgogICAgICBjYXNlICdbb2JqZWN0IEJvb2xlYW5dJzoKICAgICAgICAvLyBDb2VyY2UgZGF0ZXMgYW5kIGJvb2xlYW5zIHRvIG51bWVyaWMgcHJpbWl0aXZlIHZhbHVlcy4gRGF0ZXMgYXJlIGNvbXBhcmVkIGJ5IHRoZWlyCiAgICAgICAgLy8gbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zLiBOb3RlIHRoYXQgaW52YWxpZCBkYXRlcyB3aXRoIG1pbGxpc2Vjb25kIHJlcHJlc2VudGF0aW9ucwogICAgICAgIC8vIG9mIGBOYU5gIGFyZSBub3QgZXF1aXZhbGVudC4KICAgICAgICByZXR1cm4gK2EgPT09ICtiOwogICAgfQoKICAgIHZhciBhcmVBcnJheXMgPSBjbGFzc05hbWUgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICBpZiAoIWFyZUFycmF5cykgewogICAgICBpZiAodHlwZW9mIGEgIT0gJ29iamVjdCcgfHwgdHlwZW9mIGIgIT0gJ29iamVjdCcpIHJldHVybiBmYWxzZTsKCiAgICAgIC8vIE9iamVjdHMgd2l0aCBkaWZmZXJlbnQgY29uc3RydWN0b3JzIGFyZSBub3QgZXF1aXZhbGVudCwgYnV0IGBPYmplY3RgcyBvciBgQXJyYXlgcwogICAgICAvLyBmcm9tIGRpZmZlcmVudCBmcmFtZXMgYXJlLgogICAgICB2YXIgYUN0b3IgPSBhLmNvbnN0cnVjdG9yLCBiQ3RvciA9IGIuY29uc3RydWN0b3I7CiAgICAgIGlmIChhQ3RvciAhPT0gYkN0b3IgJiYgIShfLmlzRnVuY3Rpb24oYUN0b3IpICYmIGFDdG9yIGluc3RhbmNlb2YgYUN0b3IgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uaXNGdW5jdGlvbihiQ3RvcikgJiYgYkN0b3IgaW5zdGFuY2VvZiBiQ3RvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAoJ2NvbnN0cnVjdG9yJyBpbiBhICYmICdjb25zdHJ1Y3RvcicgaW4gYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIC8vIEFzc3VtZSBlcXVhbGl0eSBmb3IgY3ljbGljIHN0cnVjdHVyZXMuIFRoZSBhbGdvcml0aG0gZm9yIGRldGVjdGluZyBjeWNsaWMKICAgIC8vIHN0cnVjdHVyZXMgaXMgYWRhcHRlZCBmcm9tIEVTIDUuMSBzZWN0aW9uIDE1LjEyLjMsIGFic3RyYWN0IG9wZXJhdGlvbiBgSk9gLgoKICAgIC8vIEluaXRpYWxpemluZyBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIC8vIEl0J3MgZG9uZSBoZXJlIHNpbmNlIHdlIG9ubHkgbmVlZCB0aGVtIGZvciBvYmplY3RzIGFuZCBhcnJheXMgY29tcGFyaXNvbi4KICAgIGFTdGFjayA9IGFTdGFjayB8fCBbXTsKICAgIGJTdGFjayA9IGJTdGFjayB8fCBbXTsKICAgIHZhciBsZW5ndGggPSBhU3RhY2subGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIC8vIExpbmVhciBzZWFyY2guIFBlcmZvcm1hbmNlIGlzIGludmVyc2VseSBwcm9wb3J0aW9uYWwgdG8gdGhlIG51bWJlciBvZgogICAgICAvLyB1bmlxdWUgbmVzdGVkIHN0cnVjdHVyZXMuCiAgICAgIGlmIChhU3RhY2tbbGVuZ3RoXSA9PT0gYSkgcmV0dXJuIGJTdGFja1tsZW5ndGhdID09PSBiOwogICAgfQoKICAgIC8vIEFkZCB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIGFTdGFjay5wdXNoKGEpOwogICAgYlN0YWNrLnB1c2goYik7CgogICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIGFuZCBhcnJheXMuCiAgICBpZiAoYXJlQXJyYXlzKSB7CiAgICAgIC8vIENvbXBhcmUgYXJyYXkgbGVuZ3RocyB0byBkZXRlcm1pbmUgaWYgYSBkZWVwIGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5LgogICAgICBsZW5ndGggPSBhLmxlbmd0aDsKICAgICAgaWYgKGxlbmd0aCAhPT0gYi5sZW5ndGgpIHJldHVybiBmYWxzZTsKICAgICAgLy8gRGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllcy4KICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgaWYgKCFlcShhW2xlbmd0aF0sIGJbbGVuZ3RoXSwgYVN0YWNrLCBiU3RhY2spKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIERlZXAgY29tcGFyZSBvYmplY3RzLgogICAgICB2YXIga2V5cyA9IF8ua2V5cyhhKSwga2V5OwogICAgICBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgICAgLy8gRW5zdXJlIHRoYXQgYm90aCBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMgYmVmb3JlIGNvbXBhcmluZyBkZWVwIGVxdWFsaXR5LgogICAgICBpZiAoXy5rZXlzKGIpLmxlbmd0aCAhPT0gbGVuZ3RoKSByZXR1cm4gZmFsc2U7CiAgICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAgIC8vIERlZXAgY29tcGFyZSBlYWNoIG1lbWJlcgogICAgICAgIGtleSA9IGtleXNbbGVuZ3RoXTsKICAgICAgICBpZiAoIShfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBhU3RhY2ssIGJTdGFjaykpKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIC8vIFJlbW92ZSB0aGUgZmlyc3Qgb2JqZWN0IGZyb20gdGhlIHN0YWNrIG9mIHRyYXZlcnNlZCBvYmplY3RzLgogICAgYVN0YWNrLnBvcCgpOwogICAgYlN0YWNrLnBvcCgpOwogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gUGVyZm9ybSBhIGRlZXAgY29tcGFyaXNvbiB0byBjaGVjayBpZiB0d28gb2JqZWN0cyBhcmUgZXF1YWwuCiAgXy5pc0VxdWFsID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGVxKGEsIGIpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwogIC8vIEFuICJlbXB0eSIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLgogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChpc0FycmF5TGlrZShvYmopICYmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikgfHwgXy5pc0FyZ3VtZW50cyhvYmopKSkgcmV0dXJuIG9iai5sZW5ndGggPT09IDA7CiAgICByZXR1cm4gXy5rZXlzKG9iaikubGVuZ3RoID09PSAwOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBET00gZWxlbWVudD8KICBfLmlzRWxlbWVudCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuICEhKG9iaiAmJiBvYmoubm9kZVR5cGUgPT09IDEpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYW4gYXJyYXk/CiAgLy8gRGVsZWdhdGVzIHRvIEVDTUE1J3MgbmF0aXZlIEFycmF5LmlzQXJyYXkKICBfLmlzQXJyYXkgPSBuYXRpdmVJc0FycmF5IHx8IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIGFuIG9iamVjdD8KICBfLmlzT2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgdHlwZSA9IHR5cGVvZiBvYmo7CiAgICByZXR1cm4gdHlwZSA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlID09PSAnb2JqZWN0JyAmJiAhIW9iajsKICB9OwoKICAvLyBBZGQgc29tZSBpc1R5cGUgbWV0aG9kczogaXNBcmd1bWVudHMsIGlzRnVuY3Rpb24sIGlzU3RyaW5nLCBpc051bWJlciwgaXNEYXRlLCBpc1JlZ0V4cCwgaXNFcnJvci4KICBfLmVhY2goWydBcmd1bWVudHMnLCAnRnVuY3Rpb24nLCAnU3RyaW5nJywgJ051bWJlcicsICdEYXRlJywgJ1JlZ0V4cCcsICdFcnJvciddLCBmdW5jdGlvbihuYW1lKSB7CiAgICBfWydpcycgKyBuYW1lXSA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCAnICsgbmFtZSArICddJzsKICAgIH07CiAgfSk7CgogIC8vIERlZmluZSBhIGZhbGxiYWNrIHZlcnNpb24gb2YgdGhlIG1ldGhvZCBpbiBicm93c2VycyAoYWhlbSwgSUUgPCA5KSwgd2hlcmUKICAvLyB0aGVyZSBpc24ndCBhbnkgaW5zcGVjdGFibGUgIkFyZ3VtZW50cyIgdHlwZS4KICBpZiAoIV8uaXNBcmd1bWVudHMoYXJndW1lbnRzKSkgewogICAgXy5pc0FyZ3VtZW50cyA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gXy5oYXMob2JqLCAnY2FsbGVlJyk7CiAgICB9OwogIH0KCiAgLy8gT3B0aW1pemUgYGlzRnVuY3Rpb25gIGlmIGFwcHJvcHJpYXRlLiBXb3JrIGFyb3VuZCBzb21lIHR5cGVvZiBidWdzIGluIG9sZCB2OCwKICAvLyBJRSAxMSAoIzE2MjEpLCBhbmQgaW4gU2FmYXJpIDggKCMxOTI5KS4KICBpZiAodHlwZW9mIC8uLyAhPSAnZnVuY3Rpb24nICYmIHR5cGVvZiBJbnQ4QXJyYXkgIT0gJ29iamVjdCcpIHsKICAgIF8uaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PSAnZnVuY3Rpb24nIHx8IGZhbHNlOwogICAgfTsKICB9CgogIC8vIElzIGEgZ2l2ZW4gb2JqZWN0IGEgZmluaXRlIG51bWJlcj8KICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gaXNGaW5pdGUob2JqKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChvYmopKTsKICB9OwoKICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/IChOYU4gaXMgdGhlIG9ubHkgbnVtYmVyIHdoaWNoIGRvZXMgbm90IGVxdWFsIGl0c2VsZikuCiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8uaXNOdW1iZXIob2JqKSAmJiBvYmogIT09ICtvYmo7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIGJvb2xlYW4/CiAgXy5pc0Jvb2xlYW4gPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IHRydWUgfHwgb2JqID09PSBmYWxzZSB8fCB0b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEJvb2xlYW5dJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGVxdWFsIHRvIG51bGw/CiAgXy5pc051bGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IG51bGw7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSB1bmRlZmluZWQ/CiAgXy5pc1VuZGVmaW5lZCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdm9pZCAwOwogIH07CgogIC8vIFNob3J0Y3V0IGZ1bmN0aW9uIGZvciBjaGVja2luZyBpZiBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gcHJvcGVydHkgZGlyZWN0bHkKICAvLyBvbiBpdHNlbGYgKGluIG90aGVyIHdvcmRzLCBub3Qgb24gYSBwcm90b3R5cGUpLgogIF8uaGFzID0gZnVuY3Rpb24ob2JqLCBrZXkpIHsKICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKICB9OwoKICAvLyBVdGlsaXR5IEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJ1biBVbmRlcnNjb3JlLmpzIGluICpub0NvbmZsaWN0KiBtb2RlLCByZXR1cm5pbmcgdGhlIGBfYCB2YXJpYWJsZSB0byBpdHMKICAvLyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QuCiAgXy5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICByb290Ll8gPSBwcmV2aW91c1VuZGVyc2NvcmU7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyBLZWVwIHRoZSBpZGVudGl0eSBmdW5jdGlvbiBhcm91bmQgZm9yIGRlZmF1bHQgaXRlcmF0ZWVzLgogIF8uaWRlbnRpdHkgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlOwogIH07CgogIC8vIFByZWRpY2F0ZS1nZW5lcmF0aW5nIGZ1bmN0aW9ucy4gT2Z0ZW4gdXNlZnVsIG91dHNpZGUgb2YgVW5kZXJzY29yZS4KICBfLmNvbnN0YW50ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICB9OwoKICBfLm5vb3AgPSBmdW5jdGlvbigpe307CgogIF8ucHJvcGVydHkgPSBwcm9wZXJ0eTsKCiAgLy8gR2VuZXJhdGVzIGEgZnVuY3Rpb24gZm9yIGEgZ2l2ZW4gb2JqZWN0IHRoYXQgcmV0dXJucyBhIGdpdmVuIHByb3BlcnR5LgogIF8ucHJvcGVydHlPZiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PSBudWxsID8gZnVuY3Rpb24oKXt9IDogZnVuY3Rpb24oa2V5KSB7CiAgICAgIHJldHVybiBvYmpba2V5XTsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIHByZWRpY2F0ZSBmb3IgY2hlY2tpbmcgd2hldGhlciBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gc2V0IG9mCiAgLy8gYGtleTp2YWx1ZWAgcGFpcnMuCiAgXy5tYXRjaGVyID0gXy5tYXRjaGVzID0gZnVuY3Rpb24oYXR0cnMpIHsKICAgIGF0dHJzID0gXy5leHRlbmRPd24oe30sIGF0dHJzKTsKICAgIHJldHVybiBmdW5jdGlvbihvYmopIHsKICAgICAgcmV0dXJuIF8uaXNNYXRjaChvYmosIGF0dHJzKTsKICAgIH07CiAgfTsKCiAgLy8gUnVuIGEgZnVuY3Rpb24gKipuKiogdGltZXMuCiAgXy50aW1lcyA9IGZ1bmN0aW9uKG4sIGl0ZXJhdGVlLCBjb250ZXh0KSB7CiAgICB2YXIgYWNjdW0gPSBBcnJheShNYXRoLm1heCgwLCBuKSk7CiAgICBpdGVyYXRlZSA9IG9wdGltaXplQ2IoaXRlcmF0ZWUsIGNvbnRleHQsIDEpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIGFjY3VtW2ldID0gaXRlcmF0ZWUoaSk7CiAgICByZXR1cm4gYWNjdW07CiAgfTsKCiAgLy8gUmV0dXJuIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gYW5kIG1heCAoaW5jbHVzaXZlKS4KICBfLnJhbmRvbSA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7CiAgICBpZiAobWF4ID09IG51bGwpIHsKICAgICAgbWF4ID0gbWluOwogICAgICBtaW4gPSAwOwogICAgfQogICAgcmV0dXJuIG1pbiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSk7CiAgfTsKCiAgLy8gQSAocG9zc2libHkgZmFzdGVyKSB3YXkgdG8gZ2V0IHRoZSBjdXJyZW50IHRpbWVzdGFtcCBhcyBhbiBpbnRlZ2VyLgogIF8ubm93ID0gRGF0ZS5ub3cgfHwgZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgfTsKCiAgIC8vIExpc3Qgb2YgSFRNTCBlbnRpdGllcyBmb3IgZXNjYXBpbmcuCiAgdmFyIGVzY2FwZU1hcCA9IHsKICAgICcmJzogJyZhbXA7JywKICAgICc8JzogJyZsdDsnLAogICAgJz4nOiAnJmd0OycsCiAgICAnIic6ICcmcXVvdDsnLAogICAgIiciOiAnJiN4Mjc7JywKICAgICdgJzogJyYjeDYwOycKICB9OwogIHZhciB1bmVzY2FwZU1hcCA9IF8uaW52ZXJ0KGVzY2FwZU1hcCk7CgogIC8vIEZ1bmN0aW9ucyBmb3IgZXNjYXBpbmcgYW5kIHVuZXNjYXBpbmcgc3RyaW5ncyB0by9mcm9tIEhUTUwgaW50ZXJwb2xhdGlvbi4KICB2YXIgY3JlYXRlRXNjYXBlciA9IGZ1bmN0aW9uKG1hcCkgewogICAgdmFyIGVzY2FwZXIgPSBmdW5jdGlvbihtYXRjaCkgewogICAgICByZXR1cm4gbWFwW21hdGNoXTsKICAgIH07CiAgICAvLyBSZWdleGVzIGZvciBpZGVudGlmeWluZyBhIGtleSB0aGF0IG5lZWRzIHRvIGJlIGVzY2FwZWQKICAgIHZhciBzb3VyY2UgPSAnKD86JyArIF8ua2V5cyhtYXApLmpvaW4oJ3wnKSArICcpJzsKICAgIHZhciB0ZXN0UmVnZXhwID0gUmVnRXhwKHNvdXJjZSk7CiAgICB2YXIgcmVwbGFjZVJlZ2V4cCA9IFJlZ0V4cChzb3VyY2UsICdnJyk7CiAgICByZXR1cm4gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIHN0cmluZyA9IHN0cmluZyA9PSBudWxsID8gJycgOiAnJyArIHN0cmluZzsKICAgICAgcmV0dXJuIHRlc3RSZWdleHAudGVzdChzdHJpbmcpID8gc3RyaW5nLnJlcGxhY2UocmVwbGFjZVJlZ2V4cCwgZXNjYXBlcikgOiBzdHJpbmc7CiAgICB9OwogIH07CiAgXy5lc2NhcGUgPSBjcmVhdGVFc2NhcGVyKGVzY2FwZU1hcCk7CiAgXy51bmVzY2FwZSA9IGNyZWF0ZUVzY2FwZXIodW5lc2NhcGVNYXApOwoKICAvLyBJZiB0aGUgdmFsdWUgb2YgdGhlIG5hbWVkIGBwcm9wZXJ0eWAgaXMgYSBmdW5jdGlvbiB0aGVuIGludm9rZSBpdCB3aXRoIHRoZQogIC8vIGBvYmplY3RgIGFzIGNvbnRleHQ7IG90aGVyd2lzZSwgcmV0dXJuIGl0LgogIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSwgZmFsbGJhY2spIHsKICAgIHZhciB2YWx1ZSA9IG9iamVjdCA9PSBudWxsID8gdm9pZCAwIDogb2JqZWN0W3Byb3BlcnR5XTsKICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7CiAgICAgIHZhbHVlID0gZmFsbGJhY2s7CiAgICB9CiAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlLmNhbGwob2JqZWN0KSA6IHZhbHVlOwogIH07CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuCiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KICB2YXIgaWRDb3VudGVyID0gMDsKICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7CiAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnOwogICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7CiAgfTsKCiAgLy8gQnkgZGVmYXVsdCwgVW5kZXJzY29yZSB1c2VzIEVSQi1zdHlsZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLCBjaGFuZ2UgdGhlCiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLgogIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgIGV2YWx1YXRlICAgIDogLzwlKFtcc1xTXSs/KSU+L2csCiAgICBpbnRlcnBvbGF0ZSA6IC88JT0oW1xzXFNdKz8pJT4vZywKICAgIGVzY2FwZSAgICAgIDogLzwlLShbXHNcU10rPyklPi9nCiAgfTsKCiAgLy8gV2hlbiBjdXN0b21pemluZyBgdGVtcGxhdGVTZXR0aW5nc2AsIGlmIHlvdSBkb24ndCB3YW50IHRvIGRlZmluZSBhbgogIC8vIGludGVycG9sYXRpb24sIGV2YWx1YXRpb24gb3IgZXNjYXBpbmcgcmVnZXgsIHdlIG5lZWQgb25lIHRoYXQgaXMKICAvLyBndWFyYW50ZWVkIG5vdCB0byBtYXRjaC4KICB2YXIgbm9NYXRjaCA9IC8oLileLzsKCiAgLy8gQ2VydGFpbiBjaGFyYWN0ZXJzIG5lZWQgdG8gYmUgZXNjYXBlZCBzbyB0aGF0IHRoZXkgY2FuIGJlIHB1dCBpbnRvIGEKICAvLyBzdHJpbmcgbGl0ZXJhbC4KICB2YXIgZXNjYXBlcyA9IHsKICAgICInIjogICAgICAiJyIsCiAgICAnXFwnOiAgICAgJ1xcJywKICAgICdccic6ICAgICAncicsCiAgICAnXG4nOiAgICAgJ24nLAogICAgJ1x1MjAyOCc6ICd1MjAyOCcsCiAgICAnXHUyMDI5JzogJ3UyMDI5JwogIH07CgogIHZhciBlc2NhcGVyID0gL1xcfCd8XHJ8XG58XHUyMDI4fFx1MjAyOS9nOwoKICB2YXIgZXNjYXBlQ2hhciA9IGZ1bmN0aW9uKG1hdGNoKSB7CiAgICByZXR1cm4gJ1xcJyArIGVzY2FwZXNbbWF0Y2hdOwogIH07CgogIC8vIEphdmFTY3JpcHQgbWljcm8tdGVtcGxhdGluZywgc2ltaWxhciB0byBKb2huIFJlc2lnJ3MgaW1wbGVtZW50YXRpb24uCiAgLy8gVW5kZXJzY29yZSB0ZW1wbGF0aW5nIGhhbmRsZXMgYXJiaXRyYXJ5IGRlbGltaXRlcnMsIHByZXNlcnZlcyB3aGl0ZXNwYWNlLAogIC8vIGFuZCBjb3JyZWN0bHkgZXNjYXBlcyBxdW90ZXMgd2l0aGluIGludGVycG9sYXRlZCBjb2RlLgogIC8vIE5COiBgb2xkU2V0dGluZ3NgIG9ubHkgZXhpc3RzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4KICBfLnRlbXBsYXRlID0gZnVuY3Rpb24odGV4dCwgc2V0dGluZ3MsIG9sZFNldHRpbmdzKSB7CiAgICBpZiAoIXNldHRpbmdzICYmIG9sZFNldHRpbmdzKSBzZXR0aW5ncyA9IG9sZFNldHRpbmdzOwogICAgc2V0dGluZ3MgPSBfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgXy50ZW1wbGF0ZVNldHRpbmdzKTsKCiAgICAvLyBDb21iaW5lIGRlbGltaXRlcnMgaW50byBvbmUgcmVndWxhciBleHByZXNzaW9uIHZpYSBhbHRlcm5hdGlvbi4KICAgIHZhciBtYXRjaGVyID0gUmVnRXhwKFsKICAgICAgKHNldHRpbmdzLmVzY2FwZSB8fCBub01hdGNoKS5zb3VyY2UsCiAgICAgIChzZXR0aW5ncy5pbnRlcnBvbGF0ZSB8fCBub01hdGNoKS5zb3VyY2UsCiAgICAgIChzZXR0aW5ncy5ldmFsdWF0ZSB8fCBub01hdGNoKS5zb3VyY2UKICAgIF0uam9pbignfCcpICsgJ3wkJywgJ2cnKTsKCiAgICAvLyBDb21waWxlIHRoZSB0ZW1wbGF0ZSBzb3VyY2UsIGVzY2FwaW5nIHN0cmluZyBsaXRlcmFscyBhcHByb3ByaWF0ZWx5LgogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBzb3VyY2UgPSAiX19wKz0nIjsKICAgIHRleHQucmVwbGFjZShtYXRjaGVyLCBmdW5jdGlvbihtYXRjaCwgZXNjYXBlLCBpbnRlcnBvbGF0ZSwgZXZhbHVhdGUsIG9mZnNldCkgewogICAgICBzb3VyY2UgKz0gdGV4dC5zbGljZShpbmRleCwgb2Zmc2V0KS5yZXBsYWNlKGVzY2FwZXIsIGVzY2FwZUNoYXIpOwogICAgICBpbmRleCA9IG9mZnNldCArIG1hdGNoLmxlbmd0aDsKCiAgICAgIGlmIChlc2NhcGUpIHsKICAgICAgICBzb3VyY2UgKz0gIicrXG4oKF9fdD0oIiArIGVzY2FwZSArICIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcbiciOwogICAgICB9IGVsc2UgaWYgKGludGVycG9sYXRlKSB7CiAgICAgICAgc291cmNlICs9ICInK1xuKChfX3Q9KCIgKyBpbnRlcnBvbGF0ZSArICIpKT09bnVsbD8nJzpfX3QpK1xuJyI7CiAgICAgIH0gZWxzZSBpZiAoZXZhbHVhdGUpIHsKICAgICAgICBzb3VyY2UgKz0gIic7XG4iICsgZXZhbHVhdGUgKyAiXG5fX3ArPSciOwogICAgICB9CgogICAgICAvLyBBZG9iZSBWTXMgbmVlZCB0aGUgbWF0Y2ggcmV0dXJuZWQgdG8gcHJvZHVjZSB0aGUgY29ycmVjdCBvZmZlc3QuCiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0pOwogICAgc291cmNlICs9ICInO1xuIjsKCiAgICAvLyBJZiBhIHZhcmlhYmxlIGlzIG5vdCBzcGVjaWZpZWQsIHBsYWNlIGRhdGEgdmFsdWVzIGluIGxvY2FsIHNjb3BlLgogICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XG4nICsgc291cmNlICsgJ31cbic7CgogICAgc291cmNlID0gInZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbiwiICsKICAgICAgInByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307XG4iICsKICAgICAgc291cmNlICsgJ3JldHVybiBfX3A7XG4nOwoKICAgIHRyeSB7CiAgICAgIHZhciByZW5kZXIgPSBuZXcgRnVuY3Rpb24oc2V0dGluZ3MudmFyaWFibGUgfHwgJ29iaicsICdfJywgc291cmNlKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgZS5zb3VyY2UgPSBzb3VyY2U7CiAgICAgIHRocm93IGU7CiAgICB9CgogICAgdmFyIHRlbXBsYXRlID0gZnVuY3Rpb24oZGF0YSkgewogICAgICByZXR1cm4gcmVuZGVyLmNhbGwodGhpcywgZGF0YSwgXyk7CiAgICB9OwoKICAgIC8vIFByb3ZpZGUgdGhlIGNvbXBpbGVkIHNvdXJjZSBhcyBhIGNvbnZlbmllbmNlIGZvciBwcmVjb21waWxhdGlvbi4KICAgIHZhciBhcmd1bWVudCA9IHNldHRpbmdzLnZhcmlhYmxlIHx8ICdvYmonOwogICAgdGVtcGxhdGUuc291cmNlID0gJ2Z1bmN0aW9uKCcgKyBhcmd1bWVudCArICcpe1xuJyArIHNvdXJjZSArICd9JzsKCiAgICByZXR1cm4gdGVtcGxhdGU7CiAgfTsKCiAgLy8gQWRkIGEgImNoYWluIiBmdW5jdGlvbi4gU3RhcnQgY2hhaW5pbmcgYSB3cmFwcGVkIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8uY2hhaW4gPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBpbnN0YW5jZSA9IF8ob2JqKTsKICAgIGluc3RhbmNlLl9jaGFpbiA9IHRydWU7CiAgICByZXR1cm4gaW5zdGFuY2U7CiAgfTsKCiAgLy8gT09QCiAgLy8gLS0tLS0tLS0tLS0tLS0tCiAgLy8gSWYgVW5kZXJzY29yZSBpcyBjYWxsZWQgYXMgYSBmdW5jdGlvbiwgaXQgcmV0dXJucyBhIHdyYXBwZWQgb2JqZWN0IHRoYXQKICAvLyBjYW4gYmUgdXNlZCBPTy1zdHlsZS4gVGhpcyB3cmFwcGVyIGhvbGRzIGFsdGVyZWQgdmVyc2lvbnMgb2YgYWxsIHRoZQogIC8vIHVuZGVyc2NvcmUgZnVuY3Rpb25zLiBXcmFwcGVkIG9iamVjdHMgbWF5IGJlIGNoYWluZWQuCgogIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjb250aW51ZSBjaGFpbmluZyBpbnRlcm1lZGlhdGUgcmVzdWx0cy4KICB2YXIgcmVzdWx0ID0gZnVuY3Rpb24oaW5zdGFuY2UsIG9iaikgewogICAgcmV0dXJuIGluc3RhbmNlLl9jaGFpbiA/IF8ob2JqKS5jaGFpbigpIDogb2JqOwogIH07CgogIC8vIEFkZCB5b3VyIG93biBjdXN0b20gZnVuY3Rpb25zIHRvIHRoZSBVbmRlcnNjb3JlIG9iamVjdC4KICBfLm1peGluID0gZnVuY3Rpb24ob2JqKSB7CiAgICBfLmVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgZnVuYyA9IF9bbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fd3JhcHBlZF07CiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiByZXN1bHQodGhpcywgZnVuYy5hcHBseShfLCBhcmdzKSk7CiAgICAgIH07CiAgICB9KTsKICB9OwoKICAvLyBBZGQgYWxsIG9mIHRoZSBVbmRlcnNjb3JlIGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlciBvYmplY3QuCiAgXy5taXhpbihfKTsKCiAgLy8gQWRkIGFsbCBtdXRhdG9yIEFycmF5IGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlci4KICBfLmVhY2goWydwb3AnLCAncHVzaCcsICdyZXZlcnNlJywgJ3NoaWZ0JywgJ3NvcnQnLCAnc3BsaWNlJywgJ3Vuc2hpZnQnXSwgZnVuY3Rpb24obmFtZSkgewogICAgdmFyIG1ldGhvZCA9IEFycmF5UHJvdG9bbmFtZV07CiAgICBfLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgb2JqID0gdGhpcy5fd3JhcHBlZDsKICAgICAgbWV0aG9kLmFwcGx5KG9iaiwgYXJndW1lbnRzKTsKICAgICAgaWYgKChuYW1lID09PSAnc2hpZnQnIHx8IG5hbWUgPT09ICdzcGxpY2UnKSAmJiBvYmoubGVuZ3RoID09PSAwKSBkZWxldGUgb2JqWzBdOwogICAgICByZXR1cm4gcmVzdWx0KHRoaXMsIG9iaik7CiAgICB9OwogIH0pOwoKICAvLyBBZGQgYWxsIGFjY2Vzc29yIEFycmF5IGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlci4KICBfLmVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQodGhpcywgbWV0aG9kLmFwcGx5KHRoaXMuX3dyYXBwZWQsIGFyZ3VtZW50cykpOwogICAgfTsKICB9KTsKCiAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgXy5wcm90b3R5cGUudmFsdWUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogIH07CgogIC8vIFByb3ZpZGUgdW53cmFwcGluZyBwcm94eSBmb3Igc29tZSBtZXRob2RzIHVzZWQgaW4gZW5naW5lIG9wZXJhdGlvbnMKICAvLyBzdWNoIGFzIGFyaXRobWV0aWMgYW5kIEpTT04gc3RyaW5naWZpY2F0aW9uLgogIF8ucHJvdG90eXBlLnZhbHVlT2YgPSBfLnByb3RvdHlwZS50b0pTT04gPSBfLnByb3RvdHlwZS52YWx1ZTsKCiAgXy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiAnJyArIHRoaXMuX3dyYXBwZWQ7CiAgfTsKCiAgLy8gQU1EIHJlZ2lzdHJhdGlvbiBoYXBwZW5zIGF0IHRoZSBlbmQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBBTUQgbG9hZGVycwogIC8vIHRoYXQgbWF5IG5vdCBlbmZvcmNlIG5leHQtdHVybiBzZW1hbnRpY3Mgb24gbW9kdWxlcy4gRXZlbiB0aG91Z2ggZ2VuZXJhbAogIC8vIHByYWN0aWNlIGZvciBBTUQgcmVnaXN0cmF0aW9uIGlzIHRvIGJlIGFub255bW91cywgdW5kZXJzY29yZSByZWdpc3RlcnMKICAvLyBhcyBhIG5hbWVkIG1vZHVsZSBiZWNhdXNlLCBsaWtlIGpRdWVyeSwgaXQgaXMgYSBiYXNlIGxpYnJhcnkgdGhhdCBpcwogIC8vIHBvcHVsYXIgZW5vdWdoIHRvIGJlIGJ1bmRsZWQgaW4gYSB0aGlyZCBwYXJ0eSBsaWIsIGJ1dCBub3QgYmUgcGFydCBvZgogIC8vIGFuIEFNRCBsb2FkIHJlcXVlc3QuIFRob3NlIGNhc2VzIGNvdWxkIGdlbmVyYXRlIGFuIGVycm9yIHdoZW4gYW4KICAvLyBhbm9ueW1vdXMgZGVmaW5lKCkgaXMgY2FsbGVkIG91dHNpZGUgb2YgYSBsb2FkZXIgcmVxdWVzdC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ3VuZGVyc2NvcmUnLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfOwogICAgfSk7CiAgfQp9LmNhbGwodGhpcykpOwo="></script>
<link href="data:text/css;charset=utf-8,table%2EdataTable%7Bwidth%3A100%25%3Bmargin%3A0%20auto%3Bclear%3Aboth%3Bborder%2Dcollapse%3Aseparate%3Bborder%2Dspacing%3A0%7Dtable%2EdataTable%20thead%20th%2Ctable%2EdataTable%20tfoot%20th%7Bfont%2Dweight%3Abold%7Dtable%2EdataTable%20thead%20th%2Ctable%2EdataTable%20thead%20td%7Bpadding%3A10px%2018px%3Bborder%2Dbottom%3A1px%20solid%20%23111%7Dtable%2EdataTable%20thead%20th%3Aactive%2Ctable%2EdataTable%20thead%20td%3Aactive%7Boutline%3Anone%7Dtable%2EdataTable%20tfoot%20th%2Ctable%2EdataTable%20tfoot%20td%7Bpadding%3A10px%2018px%206px%2018px%3Bborder%2Dtop%3A1px%20solid%20%23111%7Dtable%2EdataTable%20thead%20%2Esorting%2Ctable%2EdataTable%20thead%20%2Esorting%5Fasc%2Ctable%2EdataTable%20thead%20%2Esorting%5Fdesc%7Bcursor%3Apointer%3B%2Acursor%3Ahand%7Dtable%2EdataTable%20thead%20%2Esorting%2Ctable%2EdataTable%20thead%20%2Esorting%5Fasc%2Ctable%2EdataTable%20thead%20%2Esorting%5Fdesc%2Ctable%2EdataTable%20thead%20%2Esorting%5Fasc%5Fdisabled%2Ctable%2EdataTable%20thead%20%2Esorting%5Fdesc%5Fdisabled%7Bbackground%2Drepeat%3Ano%2Drepeat%3Bbackground%2Dposition%3Acenter%20right%7Dtable%2EdataTable%20thead%20%2Esorting%7Bbackground%2Dimage%3Aurl%28data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAkElEQVQoz7XQMQ5AQBCF4dWQSJxC5wwax1Cq1e7BAdxD5SL%2BTq%2FQCM1oNiJidwox0355mXnG%2FDrEtIQ6azioNZQxI0ykPhTQIwhCR%2BBmBYtlK7kLJYwWCcJA9M4qdrZrd8pPjZWPtOqdRQy320YSV17OatFC4euts6z39GYMKRPCTKY9UnPQ6P%2BGtMRfGtPnBCiqhAeJPmkqAAAAAElFTkSuQmCC%29%7Dtable%2EdataTable%20thead%20%2Esorting%5Fasc%7Bbackground%2Dimage%3Aurl%28data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZ0lEQVQ4y2NgGLKgquEuFxBPAGI2ahhWCsS%2FgDibUoO0gPgxEP8H4ttArEyuQYxAPBdqEAxPBImTY5gjEL9DM%2BwTENuQahAvEO9DMwiGdwAxOymGJQLxTyD%2BjgWDxCMZRsEoGAVoAADeemwtPcZI2wAAAABJRU5ErkJggg%3D%3D%29%7Dtable%2EdataTable%20thead%20%2Esorting%5Fdesc%7Bbackground%2Dimage%3Aurl%28data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZUlEQVQ4y2NgGAWjYBSggaqGu5FA%2FBOIv2PBIPFEUgxjB%2BIdQPwfC94HxLykus4GiD%2BhGfQOiB3J8SojEE9EM2wuSJzcsFMG4ttQgx4DsRalkZENxL%2BAuJQaMcsGxBOAmGvopk8AVz1sLZgg0bsAAAAASUVORK5CYII%3D%29%7Dtable%2EdataTable%20thead%20%2Esorting%5Fasc%5Fdisabled%7Bbackground%2Dimage%3Aurl%28data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAW0lEQVQoz2NgoCm4w3Vnwh02wspK7%2Fy6k01Ikdadx3f%2B37l9RxmfIsY7c4GKQHDiHUbcyhzvvIMq%2B3THBpci3jv7oIpAcMcdduzKEu%2F8vPMdDn%2FeiWQYBYMKAAC3ykIEuYQJUgAAAABJRU5ErkJggg%3D%3D%29%7Dtable%2EdataTable%20thead%20%2Esorting%5Fdesc%5Fdisabled%7Bbackground%2Dimage%3Aurl%28data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAWUlEQVQoz2NgGAWDCtyJvPPzznc4%2FHknEbsy9js77vyHw313eHGZZ3PnE1TRuzuOuK1lvDMRqmzuHUZ87lO%2Bcxuo6PEdLUIeyb7z604pYf%2By3Zlwh4u2YQoAc7ZCBHH4jigAAAAASUVORK5CYII%3D%29%7Dtable%2EdataTable%20tbody%20tr%7Bbackground%2Dcolor%3A%23fff%7Dtable%2EdataTable%20tbody%20tr%2Eselected%7Bbackground%2Dcolor%3A%23B0BED9%7Dtable%2EdataTable%20tbody%20th%2Ctable%2EdataTable%20tbody%20td%7Bpadding%3A8px%2010px%7Dtable%2EdataTable%2Erow%2Dborder%20tbody%20th%2Ctable%2EdataTable%2Erow%2Dborder%20tbody%20td%2Ctable%2EdataTable%2Edisplay%20tbody%20th%2Ctable%2EdataTable%2Edisplay%20tbody%20td%7Bborder%2Dtop%3A1px%20solid%20%23ddd%7Dtable%2EdataTable%2Erow%2Dborder%20tbody%20tr%3Afirst%2Dchild%20th%2Ctable%2EdataTable%2Erow%2Dborder%20tbody%20tr%3Afirst%2Dchild%20td%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%3Afirst%2Dchild%20th%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%3Afirst%2Dchild%20td%7Bborder%2Dtop%3Anone%7Dtable%2EdataTable%2Ecell%2Dborder%20tbody%20th%2Ctable%2EdataTable%2Ecell%2Dborder%20tbody%20td%7Bborder%2Dtop%3A1px%20solid%20%23ddd%3Bborder%2Dright%3A1px%20solid%20%23ddd%7Dtable%2EdataTable%2Ecell%2Dborder%20tbody%20tr%20th%3Afirst%2Dchild%2Ctable%2EdataTable%2Ecell%2Dborder%20tbody%20tr%20td%3Afirst%2Dchild%7Bborder%2Dleft%3A1px%20solid%20%23ddd%7Dtable%2EdataTable%2Ecell%2Dborder%20tbody%20tr%3Afirst%2Dchild%20th%2Ctable%2EdataTable%2Ecell%2Dborder%20tbody%20tr%3Afirst%2Dchild%20td%7Bborder%2Dtop%3Anone%7Dtable%2EdataTable%2Estripe%20tbody%20tr%2Eodd%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%2Eodd%7Bbackground%2Dcolor%3A%23f9f9f9%7Dtable%2EdataTable%2Estripe%20tbody%20tr%2Eodd%2Eselected%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%2Eodd%2Eselected%7Bbackground%2Dcolor%3A%23abb9d3%7Dtable%2EdataTable%2Ehover%20tbody%20tr%3Ahover%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%3Ahover%7Bbackground%2Dcolor%3A%23f5f5f5%7Dtable%2EdataTable%2Ehover%20tbody%20tr%3Ahover%2Eselected%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%3Ahover%2Eselected%7Bbackground%2Dcolor%3A%23a9b7d1%7Dtable%2EdataTable%2Eorder%2Dcolumn%20tbody%20tr%3E%2Esorting%5F1%2Ctable%2EdataTable%2Eorder%2Dcolumn%20tbody%20tr%3E%2Esorting%5F2%2Ctable%2EdataTable%2Eorder%2Dcolumn%20tbody%20tr%3E%2Esorting%5F3%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%3E%2Esorting%5F1%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%3E%2Esorting%5F2%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%3E%2Esorting%5F3%7Bbackground%2Dcolor%3A%23f9f9f9%7Dtable%2EdataTable%2Eorder%2Dcolumn%20tbody%20tr%2Eselected%3E%2Esorting%5F1%2Ctable%2EdataTable%2Eorder%2Dcolumn%20tbody%20tr%2Eselected%3E%2Esorting%5F2%2Ctable%2EdataTable%2Eorder%2Dcolumn%20tbody%20tr%2Eselected%3E%2Esorting%5F3%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%2Eselected%3E%2Esorting%5F1%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%2Eselected%3E%2Esorting%5F2%2Ctable%2EdataTable%2Edisplay%20tbody%20tr%2Eselected%3E%2Esorting%5F3%7Bbackground%2Dcolor%3A%23acbad4%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eodd%3E%2Esorting%5F1%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eodd%3E%2Esorting%5F1%7Bbackground%2Dcolor%3A%23f1f1f1%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eodd%3E%2Esorting%5F2%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eodd%3E%2Esorting%5F2%7Bbackground%2Dcolor%3A%23f3f3f3%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eodd%3E%2Esorting%5F3%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eodd%3E%2Esorting%5F3%7Bbackground%2Dcolor%3A%23f5f5f5%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eodd%2Eselected%3E%2Esorting%5F1%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eodd%2Eselected%3E%2Esorting%5F1%7Bbackground%2Dcolor%3A%23a6b3cd%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eodd%2Eselected%3E%2Esorting%5F2%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eodd%2Eselected%3E%2Esorting%5F2%7Bbackground%2Dcolor%3A%23a7b5ce%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eodd%2Eselected%3E%2Esorting%5F3%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eodd%2Eselected%3E%2Esorting%5F3%7Bbackground%2Dcolor%3A%23a9b6d0%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eeven%3E%2Esorting%5F1%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eeven%3E%2Esorting%5F1%7Bbackground%2Dcolor%3A%23f9f9f9%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eeven%3E%2Esorting%5F2%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eeven%3E%2Esorting%5F2%7Bbackground%2Dcolor%3A%23fbfbfb%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eeven%3E%2Esorting%5F3%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eeven%3E%2Esorting%5F3%7Bbackground%2Dcolor%3A%23fdfdfd%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eeven%2Eselected%3E%2Esorting%5F1%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eeven%2Eselected%3E%2Esorting%5F1%7Bbackground%2Dcolor%3A%23acbad4%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eeven%2Eselected%3E%2Esorting%5F2%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eeven%2Eselected%3E%2Esorting%5F2%7Bbackground%2Dcolor%3A%23adbbd6%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%2Eeven%2Eselected%3E%2Esorting%5F3%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Estripe%20tbody%20tr%2Eeven%2Eselected%3E%2Esorting%5F3%7Bbackground%2Dcolor%3A%23afbdd8%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%3Ahover%3E%2Esorting%5F1%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Ehover%20tbody%20tr%3Ahover%3E%2Esorting%5F1%7Bbackground%2Dcolor%3A%23eaeaea%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%3Ahover%3E%2Esorting%5F2%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Ehover%20tbody%20tr%3Ahover%3E%2Esorting%5F2%7Bbackground%2Dcolor%3A%23ebebeb%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%3Ahover%3E%2Esorting%5F3%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Ehover%20tbody%20tr%3Ahover%3E%2Esorting%5F3%7Bbackground%2Dcolor%3A%23eee%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%3Ahover%2Eselected%3E%2Esorting%5F1%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Ehover%20tbody%20tr%3Ahover%2Eselected%3E%2Esorting%5F1%7Bbackground%2Dcolor%3A%23a1aec7%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%3Ahover%2Eselected%3E%2Esorting%5F2%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Ehover%20tbody%20tr%3Ahover%2Eselected%3E%2Esorting%5F2%7Bbackground%2Dcolor%3A%23a2afc8%7Dtable%2EdataTable%2Edisplay%20tbody%20tr%3Ahover%2Eselected%3E%2Esorting%5F3%2Ctable%2EdataTable%2Eorder%2Dcolumn%2Ehover%20tbody%20tr%3Ahover%2Eselected%3E%2Esorting%5F3%7Bbackground%2Dcolor%3A%23a4b2cb%7Dtable%2EdataTable%2Eno%2Dfooter%7Bborder%2Dbottom%3A1px%20solid%20%23111%7Dtable%2EdataTable%2Enowrap%20th%2Ctable%2EdataTable%2Enowrap%20td%7Bwhite%2Dspace%3Anowrap%7Dtable%2EdataTable%2Ecompact%20thead%20th%2Ctable%2EdataTable%2Ecompact%20thead%20td%7Bpadding%3A4px%2017px%204px%204px%7Dtable%2EdataTable%2Ecompact%20tfoot%20th%2Ctable%2EdataTable%2Ecompact%20tfoot%20td%7Bpadding%3A4px%7Dtable%2EdataTable%2Ecompact%20tbody%20th%2Ctable%2EdataTable%2Ecompact%20tbody%20td%7Bpadding%3A4px%7Dtable%2EdataTable%20th%2Edt%2Dleft%2Ctable%2EdataTable%20td%2Edt%2Dleft%7Btext%2Dalign%3Aleft%7Dtable%2EdataTable%20th%2Edt%2Dcenter%2Ctable%2EdataTable%20td%2Edt%2Dcenter%2Ctable%2EdataTable%20td%2EdataTables%5Fempty%7Btext%2Dalign%3Acenter%7Dtable%2EdataTable%20th%2Edt%2Dright%2Ctable%2EdataTable%20td%2Edt%2Dright%7Btext%2Dalign%3Aright%7Dtable%2EdataTable%20th%2Edt%2Djustify%2Ctable%2EdataTable%20td%2Edt%2Djustify%7Btext%2Dalign%3Ajustify%7Dtable%2EdataTable%20th%2Edt%2Dnowrap%2Ctable%2EdataTable%20td%2Edt%2Dnowrap%7Bwhite%2Dspace%3Anowrap%7Dtable%2EdataTable%20thead%20th%2Edt%2Dhead%2Dleft%2Ctable%2EdataTable%20thead%20td%2Edt%2Dhead%2Dleft%2Ctable%2EdataTable%20tfoot%20th%2Edt%2Dhead%2Dleft%2Ctable%2EdataTable%20tfoot%20td%2Edt%2Dhead%2Dleft%7Btext%2Dalign%3Aleft%7Dtable%2EdataTable%20thead%20th%2Edt%2Dhead%2Dcenter%2Ctable%2EdataTable%20thead%20td%2Edt%2Dhead%2Dcenter%2Ctable%2EdataTable%20tfoot%20th%2Edt%2Dhead%2Dcenter%2Ctable%2EdataTable%20tfoot%20td%2Edt%2Dhead%2Dcenter%7Btext%2Dalign%3Acenter%7Dtable%2EdataTable%20thead%20th%2Edt%2Dhead%2Dright%2Ctable%2EdataTable%20thead%20td%2Edt%2Dhead%2Dright%2Ctable%2EdataTable%20tfoot%20th%2Edt%2Dhead%2Dright%2Ctable%2EdataTable%20tfoot%20td%2Edt%2Dhead%2Dright%7Btext%2Dalign%3Aright%7Dtable%2EdataTable%20thead%20th%2Edt%2Dhead%2Djustify%2Ctable%2EdataTable%20thead%20td%2Edt%2Dhead%2Djustify%2Ctable%2EdataTable%20tfoot%20th%2Edt%2Dhead%2Djustify%2Ctable%2EdataTable%20tfoot%20td%2Edt%2Dhead%2Djustify%7Btext%2Dalign%3Ajustify%7Dtable%2EdataTable%20thead%20th%2Edt%2Dhead%2Dnowrap%2Ctable%2EdataTable%20thead%20td%2Edt%2Dhead%2Dnowrap%2Ctable%2EdataTable%20tfoot%20th%2Edt%2Dhead%2Dnowrap%2Ctable%2EdataTable%20tfoot%20td%2Edt%2Dhead%2Dnowrap%7Bwhite%2Dspace%3Anowrap%7Dtable%2EdataTable%20tbody%20th%2Edt%2Dbody%2Dleft%2Ctable%2EdataTable%20tbody%20td%2Edt%2Dbody%2Dleft%7Btext%2Dalign%3Aleft%7Dtable%2EdataTable%20tbody%20th%2Edt%2Dbody%2Dcenter%2Ctable%2EdataTable%20tbody%20td%2Edt%2Dbody%2Dcenter%7Btext%2Dalign%3Acenter%7Dtable%2EdataTable%20tbody%20th%2Edt%2Dbody%2Dright%2Ctable%2EdataTable%20tbody%20td%2Edt%2Dbody%2Dright%7Btext%2Dalign%3Aright%7Dtable%2EdataTable%20tbody%20th%2Edt%2Dbody%2Djustify%2Ctable%2EdataTable%20tbody%20td%2Edt%2Dbody%2Djustify%7Btext%2Dalign%3Ajustify%7Dtable%2EdataTable%20tbody%20th%2Edt%2Dbody%2Dnowrap%2Ctable%2EdataTable%20tbody%20td%2Edt%2Dbody%2Dnowrap%7Bwhite%2Dspace%3Anowrap%7Dtable%2EdataTable%2Ctable%2EdataTable%20th%2Ctable%2EdataTable%20td%7B%2Dwebkit%2Dbox%2Dsizing%3Acontent%2Dbox%3B%2Dmoz%2Dbox%2Dsizing%3Acontent%2Dbox%3Bbox%2Dsizing%3Acontent%2Dbox%7D%2EdataTables%5Fwrapper%7Bposition%3Arelative%3Bclear%3Aboth%3B%2Azoom%3A1%3Bzoom%3A1%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Flength%7Bfloat%3Aleft%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Ffilter%7Bfloat%3Aright%3Btext%2Dalign%3Aright%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Ffilter%20input%7Bmargin%2Dleft%3A0%2E5em%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Finfo%7Bclear%3Aboth%3Bfloat%3Aleft%3Bpadding%2Dtop%3A0%2E755em%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%7Bfloat%3Aright%3Btext%2Dalign%3Aright%3Bpadding%2Dtop%3A0%2E25em%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Epaginate%5Fbutton%7Bbox%2Dsizing%3Aborder%2Dbox%3Bdisplay%3Ainline%2Dblock%3Bmin%2Dwidth%3A1%2E5em%3Bpadding%3A0%2E5em%201em%3Bmargin%2Dleft%3A2px%3Btext%2Dalign%3Acenter%3Btext%2Ddecoration%3Anone%20%21important%3Bcursor%3Apointer%3B%2Acursor%3Ahand%3Bcolor%3A%23333%20%21important%3Bborder%3A1px%20solid%20transparent%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Epaginate%5Fbutton%2Ecurrent%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Epaginate%5Fbutton%2Ecurrent%3Ahover%7Bcolor%3A%23333%20%21important%3Bborder%3A1px%20solid%20%23cacaca%3Bbackground%2Dcolor%3A%23fff%3Bbackground%3A%2Dwebkit%2Dgradient%28linear%2C%20left%20top%2C%20left%20bottom%2C%20color%2Dstop%280%25%2C%20%23fff%29%2C%20color%2Dstop%28100%25%2C%20%23dcdcdc%29%29%3Bbackground%3A%2Dwebkit%2Dlinear%2Dgradient%28top%2C%20%23fff%200%25%2C%20%23dcdcdc%20100%25%29%3Bbackground%3A%2Dmoz%2Dlinear%2Dgradient%28top%2C%20%23fff%200%25%2C%20%23dcdcdc%20100%25%29%3Bbackground%3A%2Dms%2Dlinear%2Dgradient%28top%2C%20%23fff%200%25%2C%20%23dcdcdc%20100%25%29%3Bbackground%3A%2Do%2Dlinear%2Dgradient%28top%2C%20%23fff%200%25%2C%20%23dcdcdc%20100%25%29%3Bbackground%3Alinear%2Dgradient%28to%20bottom%2C%20%23fff%200%25%2C%20%23dcdcdc%20100%25%29%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Epaginate%5Fbutton%2Edisabled%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Epaginate%5Fbutton%2Edisabled%3Ahover%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Epaginate%5Fbutton%2Edisabled%3Aactive%7Bcursor%3Adefault%3Bcolor%3A%23666%20%21important%3Bborder%3A1px%20solid%20transparent%3Bbackground%3Atransparent%3Bbox%2Dshadow%3Anone%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Epaginate%5Fbutton%3Ahover%7Bcolor%3Awhite%20%21important%3Bborder%3A1px%20solid%20%23111%3Bbackground%2Dcolor%3A%23585858%3Bbackground%3A%2Dwebkit%2Dgradient%28linear%2C%20left%20top%2C%20left%20bottom%2C%20color%2Dstop%280%25%2C%20%23585858%29%2C%20color%2Dstop%28100%25%2C%20%23111%29%29%3Bbackground%3A%2Dwebkit%2Dlinear%2Dgradient%28top%2C%20%23585858%200%25%2C%20%23111%20100%25%29%3Bbackground%3A%2Dmoz%2Dlinear%2Dgradient%28top%2C%20%23585858%200%25%2C%20%23111%20100%25%29%3Bbackground%3A%2Dms%2Dlinear%2Dgradient%28top%2C%20%23585858%200%25%2C%20%23111%20100%25%29%3Bbackground%3A%2Do%2Dlinear%2Dgradient%28top%2C%20%23585858%200%25%2C%20%23111%20100%25%29%3Bbackground%3Alinear%2Dgradient%28to%20bottom%2C%20%23585858%200%25%2C%20%23111%20100%25%29%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Epaginate%5Fbutton%3Aactive%7Boutline%3Anone%3Bbackground%2Dcolor%3A%232b2b2b%3Bbackground%3A%2Dwebkit%2Dgradient%28linear%2C%20left%20top%2C%20left%20bottom%2C%20color%2Dstop%280%25%2C%20%232b2b2b%29%2C%20color%2Dstop%28100%25%2C%20%230c0c0c%29%29%3Bbackground%3A%2Dwebkit%2Dlinear%2Dgradient%28top%2C%20%232b2b2b%200%25%2C%20%230c0c0c%20100%25%29%3Bbackground%3A%2Dmoz%2Dlinear%2Dgradient%28top%2C%20%232b2b2b%200%25%2C%20%230c0c0c%20100%25%29%3Bbackground%3A%2Dms%2Dlinear%2Dgradient%28top%2C%20%232b2b2b%200%25%2C%20%230c0c0c%20100%25%29%3Bbackground%3A%2Do%2Dlinear%2Dgradient%28top%2C%20%232b2b2b%200%25%2C%20%230c0c0c%20100%25%29%3Bbackground%3Alinear%2Dgradient%28to%20bottom%2C%20%232b2b2b%200%25%2C%20%230c0c0c%20100%25%29%3Bbox%2Dshadow%3Ainset%200%200%203px%20%23111%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%20%2Eellipsis%7Bpadding%3A0%201em%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fprocessing%7Bposition%3Aabsolute%3Btop%3A50%25%3Bleft%3A50%25%3Bwidth%3A100%25%3Bheight%3A40px%3Bmargin%2Dleft%3A%2D50%25%3Bmargin%2Dtop%3A%2D25px%3Bpadding%2Dtop%3A20px%3Btext%2Dalign%3Acenter%3Bfont%2Dsize%3A1%2E2em%3Bbackground%2Dcolor%3Awhite%3Bbackground%3A%2Dwebkit%2Dgradient%28linear%2C%20left%20top%2C%20right%20top%2C%20color%2Dstop%280%25%2C%20rgba%28255%2C255%2C255%2C0%29%29%2C%20color%2Dstop%2825%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%29%2C%20color%2Dstop%2875%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%29%2C%20color%2Dstop%28100%25%2C%20rgba%28255%2C255%2C255%2C0%29%29%29%3Bbackground%3A%2Dwebkit%2Dlinear%2Dgradient%28left%2C%20rgba%28255%2C255%2C255%2C0%29%200%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2025%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2075%25%2C%20rgba%28255%2C255%2C255%2C0%29%20100%25%29%3Bbackground%3A%2Dmoz%2Dlinear%2Dgradient%28left%2C%20rgba%28255%2C255%2C255%2C0%29%200%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2025%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2075%25%2C%20rgba%28255%2C255%2C255%2C0%29%20100%25%29%3Bbackground%3A%2Dms%2Dlinear%2Dgradient%28left%2C%20rgba%28255%2C255%2C255%2C0%29%200%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2025%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2075%25%2C%20rgba%28255%2C255%2C255%2C0%29%20100%25%29%3Bbackground%3A%2Do%2Dlinear%2Dgradient%28left%2C%20rgba%28255%2C255%2C255%2C0%29%200%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2025%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2075%25%2C%20rgba%28255%2C255%2C255%2C0%29%20100%25%29%3Bbackground%3Alinear%2Dgradient%28to%20right%2C%20rgba%28255%2C255%2C255%2C0%29%200%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2025%25%2C%20rgba%28255%2C255%2C255%2C0%2E9%29%2075%25%2C%20rgba%28255%2C255%2C255%2C0%29%20100%25%29%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Flength%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Ffilter%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Finfo%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Fprocessing%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%7Bcolor%3A%23333%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fscroll%7Bclear%3Aboth%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fscroll%20div%2EdataTables%5FscrollBody%7B%2Amargin%2Dtop%3A%2D1px%3B%2Dwebkit%2Doverflow%2Dscrolling%3Atouch%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fscroll%20div%2EdataTables%5FscrollBody%20th%3Ediv%2EdataTables%5Fsizing%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Fscroll%20div%2EdataTables%5FscrollBody%20td%3Ediv%2EdataTables%5Fsizing%7Bheight%3A0%3Boverflow%3Ahidden%3Bmargin%3A0%20%21important%3Bpadding%3A0%20%21important%7D%2EdataTables%5Fwrapper%2Eno%2Dfooter%20%2EdataTables%5FscrollBody%7Bborder%2Dbottom%3A1px%20solid%20%23111%7D%2EdataTables%5Fwrapper%2Eno%2Dfooter%20div%2EdataTables%5FscrollHead%20table%2C%2EdataTables%5Fwrapper%2Eno%2Dfooter%20div%2EdataTables%5FscrollBody%20table%7Bborder%2Dbottom%3Anone%7D%2EdataTables%5Fwrapper%3Aafter%7Bvisibility%3Ahidden%3Bdisplay%3Ablock%3Bcontent%3A%22%22%3Bclear%3Aboth%3Bheight%3A0%7D%40media%20screen%20and%20%28max%2Dwidth%3A%20767px%29%7B%2EdataTables%5Fwrapper%20%2EdataTables%5Finfo%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%7Bfloat%3Anone%3Btext%2Dalign%3Acenter%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Fpaginate%7Bmargin%2Dtop%3A0%2E5em%7D%7D%40media%20screen%20and%20%28max%2Dwidth%3A%20640px%29%7B%2EdataTables%5Fwrapper%20%2EdataTables%5Flength%2C%2EdataTables%5Fwrapper%20%2EdataTables%5Ffilter%7Bfloat%3Anone%3Btext%2Dalign%3Acenter%7D%2EdataTables%5Fwrapper%20%2EdataTables%5Ffilter%7Bmargin%2Dtop%3A0%2E5em%7D%7D%0A" rel="stylesheet" />
<script src="data:application/x-javascript;base64,LyohCiBEYXRhVGFibGVzIDEuMTAuMTEKIMKpMjAwOC0yMDE1IFNwcnlNZWRpYSBMdGQgLSBkYXRhdGFibGVzLm5ldC9saWNlbnNlCiovCihmdW5jdGlvbihoKXsiZnVuY3Rpb24iPT09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoWyJqcXVlcnkiXSxmdW5jdGlvbihEKXtyZXR1cm4gaChELHdpbmRvdyxkb2N1bWVudCl9KToib2JqZWN0Ij09PXR5cGVvZiBleHBvcnRzP21vZHVsZS5leHBvcnRzPWZ1bmN0aW9uKEQsSSl7RHx8KEQ9d2luZG93KTtJfHwoST0idW5kZWZpbmVkIiE9PXR5cGVvZiB3aW5kb3c/cmVxdWlyZSgianF1ZXJ5Iik6cmVxdWlyZSgianF1ZXJ5IikoRCkpO3JldHVybiBoKEksRCxELmRvY3VtZW50KX06aChqUXVlcnksd2luZG93LGRvY3VtZW50KX0pKGZ1bmN0aW9uKGgsRCxJLGspe2Z1bmN0aW9uIFkoYSl7dmFyIGIsYyxkPXt9O2guZWFjaChhLGZ1bmN0aW9uKGUpe2lmKChiPWUubWF0Y2goL14oW15BLVpdKz8pKFtBLVpdKS8pKSYmLTEhPT0iYSBhYSBhaSBhbyBhcyBiIGZuIGkgbSBvIHMgIi5pbmRleE9mKGJbMV0rIiAiKSljPWUucmVwbGFjZShiWzBdLGJbMl0udG9Mb3dlckNhc2UoKSksCmRbY109ZSwibyI9PT1iWzFdJiZZKGFbZV0pfSk7YS5faHVuZ2FyaWFuTWFwPWR9ZnVuY3Rpb24gSyhhLGIsYyl7YS5faHVuZ2FyaWFuTWFwfHxZKGEpO3ZhciBkO2guZWFjaChiLGZ1bmN0aW9uKGUpe2Q9YS5faHVuZ2FyaWFuTWFwW2VdO2lmKGQhPT1rJiYoY3x8YltkXT09PWspKSJvIj09PWQuY2hhckF0KDApPyhiW2RdfHwoYltkXT17fSksaC5leHRlbmQoITAsYltkXSxiW2VdKSxLKGFbZF0sYltkXSxjKSk6YltkXT1iW2VdfSl9ZnVuY3Rpb24gRmEoYSl7dmFyIGI9bS5kZWZhdWx0cy5vTGFuZ3VhZ2UsYz1hLnNaZXJvUmVjb3JkczshYS5zRW1wdHlUYWJsZSYmKGMmJiJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSI9PT1iLnNFbXB0eVRhYmxlKSYmRShhLGEsInNaZXJvUmVjb3JkcyIsInNFbXB0eVRhYmxlIik7IWEuc0xvYWRpbmdSZWNvcmRzJiYoYyYmIkxvYWRpbmcuLi4iPT09Yi5zTG9hZGluZ1JlY29yZHMpJiZFKGEsYSwic1plcm9SZWNvcmRzIiwic0xvYWRpbmdSZWNvcmRzIik7CmEuc0luZm9UaG91c2FuZHMmJihhLnNUaG91c2FuZHM9YS5zSW5mb1Rob3VzYW5kcyk7KGE9YS5zRGVjaW1hbCkmJmRiKGEpfWZ1bmN0aW9uIGViKGEpe0EoYSwib3JkZXJpbmciLCJiU29ydCIpO0EoYSwib3JkZXJNdWx0aSIsImJTb3J0TXVsdGkiKTtBKGEsIm9yZGVyQ2xhc3NlcyIsImJTb3J0Q2xhc3NlcyIpO0EoYSwib3JkZXJDZWxsc1RvcCIsImJTb3J0Q2VsbHNUb3AiKTtBKGEsIm9yZGVyIiwiYWFTb3J0aW5nIik7QShhLCJvcmRlckZpeGVkIiwiYWFTb3J0aW5nRml4ZWQiKTtBKGEsInBhZ2luZyIsImJQYWdpbmF0ZSIpO0EoYSwicGFnaW5nVHlwZSIsInNQYWdpbmF0aW9uVHlwZSIpO0EoYSwicGFnZUxlbmd0aCIsImlEaXNwbGF5TGVuZ3RoIik7QShhLCJzZWFyY2hpbmciLCJiRmlsdGVyIik7ImJvb2xlYW4iPT09dHlwZW9mIGEuc1Njcm9sbFgmJihhLnNTY3JvbGxYPWEuc1Njcm9sbFg/IjEwMCUiOiIiKTsiYm9vbGVhbiI9PT10eXBlb2YgYS5zY3JvbGxYJiYoYS5zY3JvbGxYPQphLnNjcm9sbFg/IjEwMCUiOiIiKTtpZihhPWEuYW9TZWFyY2hDb2xzKWZvcih2YXIgYj0wLGM9YS5sZW5ndGg7YjxjO2IrKylhW2JdJiZLKG0ubW9kZWxzLm9TZWFyY2gsYVtiXSl9ZnVuY3Rpb24gZmIoYSl7QShhLCJvcmRlcmFibGUiLCJiU29ydGFibGUiKTtBKGEsIm9yZGVyRGF0YSIsImFEYXRhU29ydCIpO0EoYSwib3JkZXJTZXF1ZW5jZSIsImFzU29ydGluZyIpO0EoYSwib3JkZXJEYXRhVHlwZSIsInNvcnREYXRhVHlwZSIpO3ZhciBiPWEuYURhdGFTb3J0O2ImJiFoLmlzQXJyYXkoYikmJihhLmFEYXRhU29ydD1bYl0pfWZ1bmN0aW9uIGdiKGEpe2lmKCFtLl9fYnJvd3Nlcil7dmFyIGI9e307bS5fX2Jyb3dzZXI9Yjt2YXIgYz1oKCI8ZGl2Lz4iKS5jc3Moe3Bvc2l0aW9uOiJmaXhlZCIsdG9wOjAsbGVmdDowLGhlaWdodDoxLHdpZHRoOjEsb3ZlcmZsb3c6ImhpZGRlbiJ9KS5hcHBlbmQoaCgiPGRpdi8+IikuY3NzKHtwb3NpdGlvbjoiYWJzb2x1dGUiLHRvcDoxLGxlZnQ6MSwKd2lkdGg6MTAwLG92ZXJmbG93OiJzY3JvbGwifSkuYXBwZW5kKGgoIjxkaXYvPiIpLmNzcyh7d2lkdGg6IjEwMCUiLGhlaWdodDoxMH0pKSkuYXBwZW5kVG8oImJvZHkiKSxkPWMuY2hpbGRyZW4oKSxlPWQuY2hpbGRyZW4oKTtiLmJhcldpZHRoPWRbMF0ub2Zmc2V0V2lkdGgtZFswXS5jbGllbnRXaWR0aDtiLmJTY3JvbGxPdmVyc2l6ZT0xMDA9PT1lWzBdLm9mZnNldFdpZHRoJiYxMDAhPT1kWzBdLmNsaWVudFdpZHRoO2IuYlNjcm9sbGJhckxlZnQ9MSE9PU1hdGgucm91bmQoZS5vZmZzZXQoKS5sZWZ0KTtiLmJCb3VuZGluZz1jWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoPyEwOiExO2MucmVtb3ZlKCl9aC5leHRlbmQoYS5vQnJvd3NlcixtLl9fYnJvd3Nlcik7YS5vU2Nyb2xsLmlCYXJXaWR0aD1tLl9fYnJvd3Nlci5iYXJXaWR0aH1mdW5jdGlvbiBoYihhLGIsYyxkLGUsZil7dmFyIGcsaj0hMTtjIT09ayYmKGc9YyxqPSEwKTtmb3IoO2QhPT1lOylhLmhhc093blByb3BlcnR5KGQpJiYKKGc9aj9iKGcsYVtkXSxkLGEpOmFbZF0saj0hMCxkKz1mKTtyZXR1cm4gZ31mdW5jdGlvbiBHYShhLGIpe3ZhciBjPW0uZGVmYXVsdHMuY29sdW1uLGQ9YS5hb0NvbHVtbnMubGVuZ3RoLGM9aC5leHRlbmQoe30sbS5tb2RlbHMub0NvbHVtbixjLHtuVGg6Yj9iOkkuY3JlYXRlRWxlbWVudCgidGgiKSxzVGl0bGU6Yy5zVGl0bGU/Yy5zVGl0bGU6Yj9iLmlubmVySFRNTDoiIixhRGF0YVNvcnQ6Yy5hRGF0YVNvcnQ/Yy5hRGF0YVNvcnQ6W2RdLG1EYXRhOmMubURhdGE/Yy5tRGF0YTpkLGlkeDpkfSk7YS5hb0NvbHVtbnMucHVzaChjKTtjPWEuYW9QcmVTZWFyY2hDb2xzO2NbZF09aC5leHRlbmQoe30sbS5tb2RlbHMub1NlYXJjaCxjW2RdKTtqYShhLGQsaChiKS5kYXRhKCkpfWZ1bmN0aW9uIGphKGEsYixjKXt2YXIgYj1hLmFvQ29sdW1uc1tiXSxkPWEub0NsYXNzZXMsZT1oKGIublRoKTtpZighYi5zV2lkdGhPcmlnKXtiLnNXaWR0aE9yaWc9ZS5hdHRyKCJ3aWR0aCIpfHxudWxsO3ZhciBmPQooZS5hdHRyKCJzdHlsZSIpfHwiIikubWF0Y2goL3dpZHRoOlxzKihcZCtbcHhlbSVdKykvKTtmJiYoYi5zV2lkdGhPcmlnPWZbMV0pfWMhPT1rJiZudWxsIT09YyYmKGZiKGMpLEsobS5kZWZhdWx0cy5jb2x1bW4sYyksYy5tRGF0YVByb3AhPT1rJiYhYy5tRGF0YSYmKGMubURhdGE9Yy5tRGF0YVByb3ApLGMuc1R5cGUmJihiLl9zTWFudWFsVHlwZT1jLnNUeXBlKSxjLmNsYXNzTmFtZSYmIWMuc0NsYXNzJiYoYy5zQ2xhc3M9Yy5jbGFzc05hbWUpLGguZXh0ZW5kKGIsYyksRShiLGMsInNXaWR0aCIsInNXaWR0aE9yaWciKSxjLmlEYXRhU29ydCE9PWsmJihiLmFEYXRhU29ydD1bYy5pRGF0YVNvcnRdKSxFKGIsYywiYURhdGFTb3J0IikpO3ZhciBnPWIubURhdGEsaj1RKGcpLGk9Yi5tUmVuZGVyP1EoYi5tUmVuZGVyKTpudWxsLGM9ZnVuY3Rpb24oYSl7cmV0dXJuInN0cmluZyI9PT10eXBlb2YgYSYmLTEhPT1hLmluZGV4T2YoIkAiKX07Yi5fYkF0dHJTcmM9aC5pc1BsYWluT2JqZWN0KGcpJiYKKGMoZy5zb3J0KXx8YyhnLnR5cGUpfHxjKGcuZmlsdGVyKSk7Yi5fc2V0dGVyPW51bGw7Yi5mbkdldERhdGE9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWooYSxiLGssYyk7cmV0dXJuIGkmJmI/aShkLGIsYSxjKTpkfTtiLmZuU2V0RGF0YT1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIFIoZykoYSxiLGMpfTsibnVtYmVyIiE9PXR5cGVvZiBnJiYoYS5fcm93UmVhZE9iamVjdD0hMCk7YS5vRmVhdHVyZXMuYlNvcnR8fChiLmJTb3J0YWJsZT0hMSxlLmFkZENsYXNzKGQuc1NvcnRhYmxlTm9uZSkpO2E9LTEhPT1oLmluQXJyYXkoImFzYyIsYi5hc1NvcnRpbmcpO2M9LTEhPT1oLmluQXJyYXkoImRlc2MiLGIuYXNTb3J0aW5nKTshYi5iU29ydGFibGV8fCFhJiYhYz8oYi5zU29ydGluZ0NsYXNzPWQuc1NvcnRhYmxlTm9uZSxiLnNTb3J0aW5nQ2xhc3NKVUk9IiIpOmEmJiFjPyhiLnNTb3J0aW5nQ2xhc3M9ZC5zU29ydGFibGVBc2MsYi5zU29ydGluZ0NsYXNzSlVJPWQuc1NvcnRKVUlBc2NBbGxvd2VkKToKIWEmJmM/KGIuc1NvcnRpbmdDbGFzcz1kLnNTb3J0YWJsZURlc2MsYi5zU29ydGluZ0NsYXNzSlVJPWQuc1NvcnRKVUlEZXNjQWxsb3dlZCk6KGIuc1NvcnRpbmdDbGFzcz1kLnNTb3J0YWJsZSxiLnNTb3J0aW5nQ2xhc3NKVUk9ZC5zU29ydEpVSSl9ZnVuY3Rpb24gVShhKXtpZighMSE9PWEub0ZlYXR1cmVzLmJBdXRvV2lkdGgpe3ZhciBiPWEuYW9Db2x1bW5zO0hhKGEpO2Zvcih2YXIgYz0wLGQ9Yi5sZW5ndGg7YzxkO2MrKyliW2NdLm5UaC5zdHlsZS53aWR0aD1iW2NdLnNXaWR0aH1iPWEub1Njcm9sbDsoIiIhPT1iLnNZfHwiIiE9PWIuc1gpJiZrYShhKTt1KGEsbnVsbCwiY29sdW1uLXNpemluZyIsW2FdKX1mdW5jdGlvbiBaKGEsYil7dmFyIGM9bGEoYSwiYlZpc2libGUiKTtyZXR1cm4ibnVtYmVyIj09PXR5cGVvZiBjW2JdP2NbYl06bnVsbH1mdW5jdGlvbiAkKGEsYil7dmFyIGM9bGEoYSwiYlZpc2libGUiKSxjPWguaW5BcnJheShiLGMpO3JldHVybi0xIT09Yz9jOm51bGx9CmZ1bmN0aW9uIGFhKGEpe3JldHVybiBoKEYoYS5hb0NvbHVtbnMsIm5UaCIpKS5maWx0ZXIoIjp2aXNpYmxlIikubGVuZ3RofWZ1bmN0aW9uIGxhKGEsYil7dmFyIGM9W107aC5tYXAoYS5hb0NvbHVtbnMsZnVuY3Rpb24oYSxlKXthW2JdJiZjLnB1c2goZSl9KTtyZXR1cm4gY31mdW5jdGlvbiBJYShhKXt2YXIgYj1hLmFvQ29sdW1ucyxjPWEuYW9EYXRhLGQ9bS5leHQudHlwZS5kZXRlY3QsZSxmLGcsaixpLGgsbCxxLHQ7ZT0wO2ZvcihmPWIubGVuZ3RoO2U8ZjtlKyspaWYobD1iW2VdLHQ9W10sIWwuc1R5cGUmJmwuX3NNYW51YWxUeXBlKWwuc1R5cGU9bC5fc01hbnVhbFR5cGU7ZWxzZSBpZighbC5zVHlwZSl7Zz0wO2ZvcihqPWQubGVuZ3RoO2c8ajtnKyspe2k9MDtmb3IoaD1jLmxlbmd0aDtpPGg7aSsrKXt0W2ldPT09ayYmKHRbaV09QihhLGksZSwidHlwZSIpKTtxPWRbZ10odFtpXSxhKTtpZighcSYmZyE9PWQubGVuZ3RoLTEpYnJlYWs7aWYoImh0bWwiPT09cSlicmVha31pZihxKXtsLnNUeXBlPQpxO2JyZWFrfX1sLnNUeXBlfHwobC5zVHlwZT0ic3RyaW5nIil9fWZ1bmN0aW9uIGliKGEsYixjLGQpe3ZhciBlLGYsZyxqLGksbixsPWEuYW9Db2x1bW5zO2lmKGIpZm9yKGU9Yi5sZW5ndGgtMTswPD1lO2UtLSl7bj1iW2VdO3ZhciBxPW4udGFyZ2V0cyE9PWs/bi50YXJnZXRzOm4uYVRhcmdldHM7aC5pc0FycmF5KHEpfHwocT1bcV0pO2Y9MDtmb3IoZz1xLmxlbmd0aDtmPGc7ZisrKWlmKCJudW1iZXIiPT09dHlwZW9mIHFbZl0mJjA8PXFbZl0pe2Zvcig7bC5sZW5ndGg8PXFbZl07KUdhKGEpO2QocVtmXSxuKX1lbHNlIGlmKCJudW1iZXIiPT09dHlwZW9mIHFbZl0mJjA+cVtmXSlkKGwubGVuZ3RoK3FbZl0sbik7ZWxzZSBpZigic3RyaW5nIj09PXR5cGVvZiBxW2ZdKXtqPTA7Zm9yKGk9bC5sZW5ndGg7ajxpO2orKykoIl9hbGwiPT1xW2ZdfHxoKGxbal0ublRoKS5oYXNDbGFzcyhxW2ZdKSkmJmQoaixuKX19aWYoYyl7ZT0wO2ZvcihhPWMubGVuZ3RoO2U8YTtlKyspZChlLGNbZV0pfX0KZnVuY3Rpb24gTihhLGIsYyxkKXt2YXIgZT1hLmFvRGF0YS5sZW5ndGgsZj1oLmV4dGVuZCghMCx7fSxtLm1vZGVscy5vUm93LHtzcmM6Yz8iZG9tIjoiZGF0YSIsaWR4OmV9KTtmLl9hRGF0YT1iO2EuYW9EYXRhLnB1c2goZik7Zm9yKHZhciBnPWEuYW9Db2x1bW5zLGo9MCxpPWcubGVuZ3RoO2o8aTtqKyspZ1tqXS5zVHlwZT1udWxsO2EuYWlEaXNwbGF5TWFzdGVyLnB1c2goZSk7Yj1hLnJvd0lkRm4oYik7YiE9PWsmJihhLmFJZHNbYl09Zik7KGN8fCFhLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIpJiZKYShhLGUsYyxkKTtyZXR1cm4gZX1mdW5jdGlvbiBtYShhLGIpe3ZhciBjO2IgaW5zdGFuY2VvZiBofHwoYj1oKGIpKTtyZXR1cm4gYi5tYXAoZnVuY3Rpb24oYixlKXtjPUthKGEsZSk7cmV0dXJuIE4oYSxjLmRhdGEsZSxjLmNlbGxzKX0pfWZ1bmN0aW9uIEIoYSxiLGMsZCl7dmFyIGU9YS5pRHJhdyxmPWEuYW9Db2x1bW5zW2NdLGc9YS5hb0RhdGFbYl0uX2FEYXRhLGo9Zi5zRGVmYXVsdENvbnRlbnQsCmk9Zi5mbkdldERhdGEoZyxkLHtzZXR0aW5nczphLHJvdzpiLGNvbDpjfSk7aWYoaT09PWspcmV0dXJuIGEuaURyYXdFcnJvciE9ZSYmbnVsbD09PWomJihMKGEsMCwiUmVxdWVzdGVkIHVua25vd24gcGFyYW1ldGVyICIrKCJmdW5jdGlvbiI9PXR5cGVvZiBmLm1EYXRhPyJ7ZnVuY3Rpb259IjoiJyIrZi5tRGF0YSsiJyIpKyIgZm9yIHJvdyAiK2IrIiwgY29sdW1uICIrYyw0KSxhLmlEcmF3RXJyb3I9ZSksajtpZigoaT09PWd8fG51bGw9PT1pKSYmbnVsbCE9PWomJmQhPT1rKWk9ajtlbHNlIGlmKCJmdW5jdGlvbiI9PT10eXBlb2YgaSlyZXR1cm4gaS5jYWxsKGcpO3JldHVybiBudWxsPT09aSYmImRpc3BsYXkiPT1kPyIiOml9ZnVuY3Rpb24gamIoYSxiLGMsZCl7YS5hb0NvbHVtbnNbY10uZm5TZXREYXRhKGEuYW9EYXRhW2JdLl9hRGF0YSxkLHtzZXR0aW5nczphLHJvdzpiLGNvbDpjfSl9ZnVuY3Rpb24gTGEoYSl7cmV0dXJuIGgubWFwKGEubWF0Y2goLyhcXC58W15cLl0pKy9nKXx8ClsiIl0sZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvXFwuL2csIi4iKX0pfWZ1bmN0aW9uIFEoYSl7aWYoaC5pc1BsYWluT2JqZWN0KGEpKXt2YXIgYj17fTtoLmVhY2goYSxmdW5jdGlvbihhLGMpe2MmJihiW2FdPVEoYykpfSk7cmV0dXJuIGZ1bmN0aW9uKGEsYyxmLGcpe3ZhciBqPWJbY118fGIuXztyZXR1cm4gaiE9PWs/aihhLGMsZixnKTphfX1pZihudWxsPT09YSlyZXR1cm4gZnVuY3Rpb24oYSl7cmV0dXJuIGF9O2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgYSlyZXR1cm4gZnVuY3Rpb24oYixjLGYsZyl7cmV0dXJuIGEoYixjLGYsZyl9O2lmKCJzdHJpbmciPT09dHlwZW9mIGEmJigtMSE9PWEuaW5kZXhPZigiLiIpfHwtMSE9PWEuaW5kZXhPZigiWyIpfHwtMSE9PWEuaW5kZXhPZigiKCIpKSl7dmFyIGM9ZnVuY3Rpb24oYSxiLGYpe3ZhciBnLGo7aWYoIiIhPT1mKXtqPUxhKGYpO2Zvcih2YXIgaT0wLG49ai5sZW5ndGg7aTxuO2krKyl7Zj1qW2ldLm1hdGNoKGJhKTtnPQpqW2ldLm1hdGNoKFYpO2lmKGYpe2pbaV09altpXS5yZXBsYWNlKGJhLCIiKTsiIiE9PWpbaV0mJihhPWFbaltpXV0pO2c9W107ai5zcGxpY2UoMCxpKzEpO2o9ai5qb2luKCIuIik7aWYoaC5pc0FycmF5KGEpKXtpPTA7Zm9yKG49YS5sZW5ndGg7aTxuO2krKylnLnB1c2goYyhhW2ldLGIsaikpfWE9ZlswXS5zdWJzdHJpbmcoMSxmWzBdLmxlbmd0aC0xKTthPSIiPT09YT9nOmcuam9pbihhKTticmVha31lbHNlIGlmKGcpe2pbaV09altpXS5yZXBsYWNlKFYsIiIpO2E9YVtqW2ldXSgpO2NvbnRpbnVlfWlmKG51bGw9PT1hfHxhW2pbaV1dPT09aylyZXR1cm4gazthPWFbaltpXV19fXJldHVybiBhfTtyZXR1cm4gZnVuY3Rpb24oYixlKXtyZXR1cm4gYyhiLGUsYSl9fXJldHVybiBmdW5jdGlvbihiKXtyZXR1cm4gYlthXX19ZnVuY3Rpb24gUihhKXtpZihoLmlzUGxhaW5PYmplY3QoYSkpcmV0dXJuIFIoYS5fKTtpZihudWxsPT09YSlyZXR1cm4gZnVuY3Rpb24oKXt9O2lmKCJmdW5jdGlvbiI9PT0KdHlwZW9mIGEpcmV0dXJuIGZ1bmN0aW9uKGIsZCxlKXthKGIsInNldCIsZCxlKX07aWYoInN0cmluZyI9PT10eXBlb2YgYSYmKC0xIT09YS5pbmRleE9mKCIuIil8fC0xIT09YS5pbmRleE9mKCJbIil8fC0xIT09YS5pbmRleE9mKCIoIikpKXt2YXIgYj1mdW5jdGlvbihhLGQsZSl7dmFyIGU9TGEoZSksZjtmPWVbZS5sZW5ndGgtMV07Zm9yKHZhciBnLGosaT0wLG49ZS5sZW5ndGgtMTtpPG47aSsrKXtnPWVbaV0ubWF0Y2goYmEpO2o9ZVtpXS5tYXRjaChWKTtpZihnKXtlW2ldPWVbaV0ucmVwbGFjZShiYSwiIik7YVtlW2ldXT1bXTtmPWUuc2xpY2UoKTtmLnNwbGljZSgwLGkrMSk7Zz1mLmpvaW4oIi4iKTtpZihoLmlzQXJyYXkoZCkpe2o9MDtmb3Iobj1kLmxlbmd0aDtqPG47aisrKWY9e30sYihmLGRbal0sZyksYVtlW2ldXS5wdXNoKGYpfWVsc2UgYVtlW2ldXT1kO3JldHVybn1qJiYoZVtpXT1lW2ldLnJlcGxhY2UoViwiIiksYT1hW2VbaV1dKGQpKTtpZihudWxsPT09YVtlW2ldXXx8CmFbZVtpXV09PT1rKWFbZVtpXV09e307YT1hW2VbaV1dfWlmKGYubWF0Y2goVikpYVtmLnJlcGxhY2UoViwiIildKGQpO2Vsc2UgYVtmLnJlcGxhY2UoYmEsIiIpXT1kfTtyZXR1cm4gZnVuY3Rpb24oYyxkKXtyZXR1cm4gYihjLGQsYSl9fXJldHVybiBmdW5jdGlvbihiLGQpe2JbYV09ZH19ZnVuY3Rpb24gTWEoYSl7cmV0dXJuIEYoYS5hb0RhdGEsIl9hRGF0YSIpfWZ1bmN0aW9uIG5hKGEpe2EuYW9EYXRhLmxlbmd0aD0wO2EuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aD0wO2EuYWlEaXNwbGF5Lmxlbmd0aD0wO2EuYUlkcz17fX1mdW5jdGlvbiBvYShhLGIsYyl7Zm9yKHZhciBkPS0xLGU9MCxmPWEubGVuZ3RoO2U8ZjtlKyspYVtlXT09Yj9kPWU6YVtlXT5iJiZhW2VdLS07IC0xIT1kJiZjPT09ayYmYS5zcGxpY2UoZCwxKX1mdW5jdGlvbiBjYShhLGIsYyxkKXt2YXIgZT1hLmFvRGF0YVtiXSxmLGc9ZnVuY3Rpb24oYyxkKXtmb3IoO2MuY2hpbGROb2Rlcy5sZW5ndGg7KWMucmVtb3ZlQ2hpbGQoYy5maXJzdENoaWxkKTsKYy5pbm5lckhUTUw9QihhLGIsZCwiZGlzcGxheSIpfTtpZigiZG9tIj09PWN8fCghY3x8ImF1dG8iPT09YykmJiJkb20iPT09ZS5zcmMpZS5fYURhdGE9S2EoYSxlLGQsZD09PWs/azplLl9hRGF0YSkuZGF0YTtlbHNle3ZhciBqPWUuYW5DZWxscztpZihqKWlmKGQhPT1rKWcoaltkXSxkKTtlbHNle2M9MDtmb3IoZj1qLmxlbmd0aDtjPGY7YysrKWcoaltjXSxjKX19ZS5fYVNvcnREYXRhPW51bGw7ZS5fYUZpbHRlckRhdGE9bnVsbDtnPWEuYW9Db2x1bW5zO2lmKGQhPT1rKWdbZF0uc1R5cGU9bnVsbDtlbHNle2M9MDtmb3IoZj1nLmxlbmd0aDtjPGY7YysrKWdbY10uc1R5cGU9bnVsbDtOYShhLGUpfX1mdW5jdGlvbiBLYShhLGIsYyxkKXt2YXIgZT1bXSxmPWIuZmlyc3RDaGlsZCxnLGosaT0wLG4sbD1hLmFvQ29sdW1ucyxxPWEuX3Jvd1JlYWRPYmplY3QsZD1kIT09az9kOnE/e306W10sdD1mdW5jdGlvbihhLGIpe2lmKCJzdHJpbmciPT09dHlwZW9mIGEpe3ZhciBjPWEuaW5kZXhPZigiQCIpOwotMSE9PWMmJihjPWEuc3Vic3RyaW5nKGMrMSksUihhKShkLGIuZ2V0QXR0cmlidXRlKGMpKSl9fSxTPWZ1bmN0aW9uKGEpe2lmKGM9PT1rfHxjPT09aSlqPWxbaV0sbj1oLnRyaW0oYS5pbm5lckhUTUwpLGomJmouX2JBdHRyU3JjPyhSKGoubURhdGEuXykoZCxuKSx0KGoubURhdGEuc29ydCxhKSx0KGoubURhdGEudHlwZSxhKSx0KGoubURhdGEuZmlsdGVyLGEpKTpxPyhqLl9zZXR0ZXJ8fChqLl9zZXR0ZXI9UihqLm1EYXRhKSksai5fc2V0dGVyKGQsbikpOmRbaV09bjtpKyt9O2lmKGYpZm9yKDtmOyl7Zz1mLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7aWYoIlREIj09Z3x8IlRIIj09ZylTKGYpLGUucHVzaChmKTtmPWYubmV4dFNpYmxpbmd9ZWxzZXtlPWIuYW5DZWxscztmPTA7Zm9yKGc9ZS5sZW5ndGg7ZjxnO2YrKylTKGVbZl0pfWlmKGI9Yi5maXJzdENoaWxkP2I6Yi5uVHIpKGI9Yi5nZXRBdHRyaWJ1dGUoImlkIikpJiZSKGEucm93SWQpKGQsYik7cmV0dXJue2RhdGE6ZCxjZWxsczplfX0KZnVuY3Rpb24gSmEoYSxiLGMsZCl7dmFyIGU9YS5hb0RhdGFbYl0sZj1lLl9hRGF0YSxnPVtdLGosaSxuLGwscTtpZihudWxsPT09ZS5uVHIpe2o9Y3x8SS5jcmVhdGVFbGVtZW50KCJ0ciIpO2UublRyPWo7ZS5hbkNlbGxzPWc7ai5fRFRfUm93SW5kZXg9YjtOYShhLGUpO2w9MDtmb3IocT1hLmFvQ29sdW1ucy5sZW5ndGg7bDxxO2wrKyl7bj1hLmFvQ29sdW1uc1tsXTtpPWM/ZFtsXTpJLmNyZWF0ZUVsZW1lbnQobi5zQ2VsbFR5cGUpO2kuX0RUX0NlbGxJbmRleD17cm93OmIsY29sdW1uOmx9O2cucHVzaChpKTtpZigoIWN8fG4ubVJlbmRlcnx8bi5tRGF0YSE9PWwpJiYoIWguaXNQbGFpbk9iamVjdChuLm1EYXRhKXx8bi5tRGF0YS5fIT09bCsiLmRpc3BsYXkiKSlpLmlubmVySFRNTD1CKGEsYixsLCJkaXNwbGF5Iik7bi5zQ2xhc3MmJihpLmNsYXNzTmFtZSs9IiAiK24uc0NsYXNzKTtuLmJWaXNpYmxlJiYhYz9qLmFwcGVuZENoaWxkKGkpOiFuLmJWaXNpYmxlJiZjJiZpLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaSk7Cm4uZm5DcmVhdGVkQ2VsbCYmbi5mbkNyZWF0ZWRDZWxsLmNhbGwoYS5vSW5zdGFuY2UsaSxCKGEsYixsKSxmLGIsbCl9dShhLCJhb1Jvd0NyZWF0ZWRDYWxsYmFjayIsbnVsbCxbaixmLGJdKX1lLm5Uci5zZXRBdHRyaWJ1dGUoInJvbGUiLCJyb3ciKX1mdW5jdGlvbiBOYShhLGIpe3ZhciBjPWIublRyLGQ9Yi5fYURhdGE7aWYoYyl7dmFyIGU9YS5yb3dJZEZuKGQpO2UmJihjLmlkPWUpO2QuRFRfUm93Q2xhc3MmJihlPWQuRFRfUm93Q2xhc3Muc3BsaXQoIiAiKSxiLl9fcm93Yz1iLl9fcm93Yz9wYShiLl9fcm93Yy5jb25jYXQoZSkpOmUsaChjKS5yZW1vdmVDbGFzcyhiLl9fcm93Yy5qb2luKCIgIikpLmFkZENsYXNzKGQuRFRfUm93Q2xhc3MpKTtkLkRUX1Jvd0F0dHImJmgoYykuYXR0cihkLkRUX1Jvd0F0dHIpO2QuRFRfUm93RGF0YSYmaChjKS5kYXRhKGQuRFRfUm93RGF0YSl9fWZ1bmN0aW9uIGtiKGEpe3ZhciBiLGMsZCxlLGYsZz1hLm5USGVhZCxqPWEublRGb290LGk9MD09PQpoKCJ0aCwgdGQiLGcpLmxlbmd0aCxuPWEub0NsYXNzZXMsbD1hLmFvQ29sdW1ucztpJiYoZT1oKCI8dHIvPiIpLmFwcGVuZFRvKGcpKTtiPTA7Zm9yKGM9bC5sZW5ndGg7YjxjO2IrKylmPWxbYl0sZD1oKGYublRoKS5hZGRDbGFzcyhmLnNDbGFzcyksaSYmZC5hcHBlbmRUbyhlKSxhLm9GZWF0dXJlcy5iU29ydCYmKGQuYWRkQ2xhc3MoZi5zU29ydGluZ0NsYXNzKSwhMSE9PWYuYlNvcnRhYmxlJiYoZC5hdHRyKCJ0YWJpbmRleCIsYS5pVGFiSW5kZXgpLmF0dHIoImFyaWEtY29udHJvbHMiLGEuc1RhYmxlSWQpLE9hKGEsZi5uVGgsYikpKSxmLnNUaXRsZSE9ZFswXS5pbm5lckhUTUwmJmQuaHRtbChmLnNUaXRsZSksUGEoYSwiaGVhZGVyIikoYSxkLGYsbik7aSYmZGEoYS5hb0hlYWRlcixnKTtoKGcpLmZpbmQoIj50ciIpLmF0dHIoInJvbGUiLCJyb3ciKTtoKGcpLmZpbmQoIj50cj50aCwgPnRyPnRkIikuYWRkQ2xhc3Mobi5zSGVhZGVyVEgpO2goaikuZmluZCgiPnRyPnRoLCA+dHI+dGQiKS5hZGRDbGFzcyhuLnNGb290ZXJUSCk7CmlmKG51bGwhPT1qKXthPWEuYW9Gb290ZXJbMF07Yj0wO2ZvcihjPWEubGVuZ3RoO2I8YztiKyspZj1sW2JdLGYublRmPWFbYl0uY2VsbCxmLnNDbGFzcyYmaChmLm5UZikuYWRkQ2xhc3MoZi5zQ2xhc3MpfX1mdW5jdGlvbiBlYShhLGIsYyl7dmFyIGQsZSxmLGc9W10saj1bXSxpPWEuYW9Db2x1bW5zLmxlbmd0aCxuO2lmKGIpe2M9PT1rJiYoYz0hMSk7ZD0wO2ZvcihlPWIubGVuZ3RoO2Q8ZTtkKyspe2dbZF09YltkXS5zbGljZSgpO2dbZF0ublRyPWJbZF0ublRyO2ZvcihmPWktMTswPD1mO2YtLSkhYS5hb0NvbHVtbnNbZl0uYlZpc2libGUmJiFjJiZnW2RdLnNwbGljZShmLDEpO2oucHVzaChbXSl9ZD0wO2ZvcihlPWcubGVuZ3RoO2Q8ZTtkKyspe2lmKGE9Z1tkXS5uVHIpZm9yKDtmPWEuZmlyc3RDaGlsZDspYS5yZW1vdmVDaGlsZChmKTtmPTA7Zm9yKGI9Z1tkXS5sZW5ndGg7ZjxiO2YrKylpZihuPWk9MSxqW2RdW2ZdPT09ayl7YS5hcHBlbmRDaGlsZChnW2RdW2ZdLmNlbGwpOwpmb3IoaltkXVtmXT0xO2dbZCtpXSE9PWsmJmdbZF1bZl0uY2VsbD09Z1tkK2ldW2ZdLmNlbGw7KWpbZCtpXVtmXT0xLGkrKztmb3IoO2dbZF1bZituXSE9PWsmJmdbZF1bZl0uY2VsbD09Z1tkXVtmK25dLmNlbGw7KXtmb3IoYz0wO2M8aTtjKyspaltkK2NdW2Yrbl09MTtuKyt9aChnW2RdW2ZdLmNlbGwpLmF0dHIoInJvd3NwYW4iLGkpLmF0dHIoImNvbHNwYW4iLG4pfX19fWZ1bmN0aW9uIE8oYSl7dmFyIGI9dShhLCJhb1ByZURyYXdDYWxsYmFjayIsInByZURyYXciLFthXSk7aWYoLTEhPT1oLmluQXJyYXkoITEsYikpQyhhLCExKTtlbHNle3ZhciBiPVtdLGM9MCxkPWEuYXNTdHJpcGVDbGFzc2VzLGU9ZC5sZW5ndGgsZj1hLm9MYW5ndWFnZSxnPWEuaUluaXREaXNwbGF5U3RhcnQsaj0ic3NwIj09eShhKSxpPWEuYWlEaXNwbGF5O2EuYkRyYXdpbmc9ITA7ZyE9PWsmJi0xIT09ZyYmKGEuX2lEaXNwbGF5U3RhcnQ9aj9nOmc+PWEuZm5SZWNvcmRzRGlzcGxheSgpPzA6ZyxhLmlJbml0RGlzcGxheVN0YXJ0PQotMSk7dmFyIGc9YS5faURpc3BsYXlTdGFydCxuPWEuZm5EaXNwbGF5RW5kKCk7aWYoYS5iRGVmZXJMb2FkaW5nKWEuYkRlZmVyTG9hZGluZz0hMSxhLmlEcmF3KyssQyhhLCExKTtlbHNlIGlmKGope2lmKCFhLmJEZXN0cm95aW5nJiYhbGIoYSkpcmV0dXJufWVsc2UgYS5pRHJhdysrO2lmKDAhPT1pLmxlbmd0aCl7Zj1qP2EuYW9EYXRhLmxlbmd0aDpuO2ZvcihqPWo/MDpnO2o8ZjtqKyspe3ZhciBsPWlbal0scT1hLmFvRGF0YVtsXTtudWxsPT09cS5uVHImJkphKGEsbCk7bD1xLm5UcjtpZigwIT09ZSl7dmFyIHQ9ZFtjJWVdO3EuX3NSb3dTdHJpcGUhPXQmJihoKGwpLnJlbW92ZUNsYXNzKHEuX3NSb3dTdHJpcGUpLmFkZENsYXNzKHQpLHEuX3NSb3dTdHJpcGU9dCl9dShhLCJhb1Jvd0NhbGxiYWNrIixudWxsLFtsLHEuX2FEYXRhLGMsal0pO2IucHVzaChsKTtjKyt9fWVsc2UgYz1mLnNaZXJvUmVjb3JkcywxPT1hLmlEcmF3JiYiYWpheCI9PXkoYSk/Yz1mLnNMb2FkaW5nUmVjb3JkczoKZi5zRW1wdHlUYWJsZSYmMD09PWEuZm5SZWNvcmRzVG90YWwoKSYmKGM9Zi5zRW1wdHlUYWJsZSksYlswXT1oKCI8dHIvPiIseyJjbGFzcyI6ZT9kWzBdOiIifSkuYXBwZW5kKGgoIjx0ZCAvPiIse3ZhbGlnbjoidG9wIixjb2xTcGFuOmFhKGEpLCJjbGFzcyI6YS5vQ2xhc3Nlcy5zUm93RW1wdHl9KS5odG1sKGMpKVswXTt1KGEsImFvSGVhZGVyQ2FsbGJhY2siLCJoZWFkZXIiLFtoKGEublRIZWFkKS5jaGlsZHJlbigidHIiKVswXSxNYShhKSxnLG4saV0pO3UoYSwiYW9Gb290ZXJDYWxsYmFjayIsImZvb3RlciIsW2goYS5uVEZvb3QpLmNoaWxkcmVuKCJ0ciIpWzBdLE1hKGEpLGcsbixpXSk7ZD1oKGEublRCb2R5KTtkLmNoaWxkcmVuKCkuZGV0YWNoKCk7ZC5hcHBlbmQoaChiKSk7dShhLCJhb0RyYXdDYWxsYmFjayIsImRyYXciLFthXSk7YS5iU29ydGVkPSExO2EuYkZpbHRlcmVkPSExO2EuYkRyYXdpbmc9ITF9fWZ1bmN0aW9uIFQoYSxiKXt2YXIgYz1hLm9GZWF0dXJlcyxkPWMuYkZpbHRlcjsKYy5iU29ydCYmbWIoYSk7ZD9mYShhLGEub1ByZXZpb3VzU2VhcmNoKTphLmFpRGlzcGxheT1hLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOyEwIT09YiYmKGEuX2lEaXNwbGF5U3RhcnQ9MCk7YS5fZHJhd0hvbGQ9YjtPKGEpO2EuX2RyYXdIb2xkPSExfWZ1bmN0aW9uIG5iKGEpe3ZhciBiPWEub0NsYXNzZXMsYz1oKGEublRhYmxlKSxjPWgoIjxkaXYvPiIpLmluc2VydEJlZm9yZShjKSxkPWEub0ZlYXR1cmVzLGU9aCgiPGRpdi8+Iix7aWQ6YS5zVGFibGVJZCsiX3dyYXBwZXIiLCJjbGFzcyI6Yi5zV3JhcHBlcisoYS5uVEZvb3Q/IiI6IiAiK2Iuc05vRm9vdGVyKX0pO2EubkhvbGRpbmc9Y1swXTthLm5UYWJsZVdyYXBwZXI9ZVswXTthLm5UYWJsZVJlaW5zZXJ0QmVmb3JlPWEublRhYmxlLm5leHRTaWJsaW5nO2Zvcih2YXIgZj1hLnNEb20uc3BsaXQoIiIpLGcsaixpLG4sbCxxLHQ9MDt0PGYubGVuZ3RoO3QrKyl7Zz1udWxsO2o9Zlt0XTtpZigiPCI9PWope2k9aCgiPGRpdi8+IilbMF07Cm49Zlt0KzFdO2lmKCInIj09bnx8JyInPT1uKXtsPSIiO2ZvcihxPTI7Zlt0K3FdIT1uOylsKz1mW3QrcV0scSsrOyJIIj09bD9sPWIuc0pVSUhlYWRlcjoiRiI9PWwmJihsPWIuc0pVSUZvb3Rlcik7LTEhPWwuaW5kZXhPZigiLiIpPyhuPWwuc3BsaXQoIi4iKSxpLmlkPW5bMF0uc3Vic3RyKDEsblswXS5sZW5ndGgtMSksaS5jbGFzc05hbWU9blsxXSk6IiMiPT1sLmNoYXJBdCgwKT9pLmlkPWwuc3Vic3RyKDEsbC5sZW5ndGgtMSk6aS5jbGFzc05hbWU9bDt0Kz1xfWUuYXBwZW5kKGkpO2U9aChpKX1lbHNlIGlmKCI+Ij09aillPWUucGFyZW50KCk7ZWxzZSBpZigibCI9PWomJmQuYlBhZ2luYXRlJiZkLmJMZW5ndGhDaGFuZ2UpZz1vYihhKTtlbHNlIGlmKCJmIj09aiYmZC5iRmlsdGVyKWc9cGIoYSk7ZWxzZSBpZigiciI9PWomJmQuYlByb2Nlc3NpbmcpZz1xYihhKTtlbHNlIGlmKCJ0Ij09ailnPXJiKGEpO2Vsc2UgaWYoImkiPT1qJiZkLmJJbmZvKWc9c2IoYSk7ZWxzZSBpZigicCI9PQpqJiZkLmJQYWdpbmF0ZSlnPXRiKGEpO2Vsc2UgaWYoMCE9PW0uZXh0LmZlYXR1cmUubGVuZ3RoKXtpPW0uZXh0LmZlYXR1cmU7cT0wO2ZvcihuPWkubGVuZ3RoO3E8bjtxKyspaWYoaj09aVtxXS5jRmVhdHVyZSl7Zz1pW3FdLmZuSW5pdChhKTticmVha319ZyYmKGk9YS5hYW5GZWF0dXJlcyxpW2pdfHwoaVtqXT1bXSksaVtqXS5wdXNoKGcpLGUuYXBwZW5kKGcpKX1jLnJlcGxhY2VXaXRoKGUpO2EubkhvbGRpbmc9bnVsbH1mdW5jdGlvbiBkYShhLGIpe3ZhciBjPWgoYikuY2hpbGRyZW4oInRyIiksZCxlLGYsZyxqLGksbixsLHEsdDthLnNwbGljZSgwLGEubGVuZ3RoKTtmPTA7Zm9yKGk9Yy5sZW5ndGg7ZjxpO2YrKylhLnB1c2goW10pO2Y9MDtmb3IoaT1jLmxlbmd0aDtmPGk7ZisrKXtkPWNbZl07Zm9yKGU9ZC5maXJzdENoaWxkO2U7KXtpZigiVEQiPT1lLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCl8fCJUSCI9PWUubm9kZU5hbWUudG9VcHBlckNhc2UoKSl7bD0xKmUuZ2V0QXR0cmlidXRlKCJjb2xzcGFuIik7CnE9MSplLmdldEF0dHJpYnV0ZSgicm93c3BhbiIpO2w9IWx8fDA9PT1sfHwxPT09bD8xOmw7cT0hcXx8MD09PXF8fDE9PT1xPzE6cTtnPTA7Zm9yKGo9YVtmXTtqW2ddOylnKys7bj1nO3Q9MT09PWw/ITA6ITE7Zm9yKGo9MDtqPGw7aisrKWZvcihnPTA7ZzxxO2crKylhW2YrZ11bbitqXT17Y2VsbDplLHVuaXF1ZTp0fSxhW2YrZ10ublRyPWR9ZT1lLm5leHRTaWJsaW5nfX19ZnVuY3Rpb24gcWEoYSxiLGMpe3ZhciBkPVtdO2N8fChjPWEuYW9IZWFkZXIsYiYmKGM9W10sZGEoYyxiKSkpO2Zvcih2YXIgYj0wLGU9Yy5sZW5ndGg7YjxlO2IrKylmb3IodmFyIGY9MCxnPWNbYl0ubGVuZ3RoO2Y8ZztmKyspaWYoY1tiXVtmXS51bmlxdWUmJighZFtmXXx8IWEuYlNvcnRDZWxsc1RvcCkpZFtmXT1jW2JdW2ZdLmNlbGw7cmV0dXJuIGR9ZnVuY3Rpb24gcmEoYSxiLGMpe3UoYSwiYW9TZXJ2ZXJQYXJhbXMiLCJzZXJ2ZXJQYXJhbXMiLFtiXSk7aWYoYiYmaC5pc0FycmF5KGIpKXt2YXIgZD17fSwKZT0vKC4qPylcW1xdJC87aC5lYWNoKGIsZnVuY3Rpb24oYSxiKXt2YXIgYz1iLm5hbWUubWF0Y2goZSk7Yz8oYz1jWzBdLGRbY118fChkW2NdPVtdKSxkW2NdLnB1c2goYi52YWx1ZSkpOmRbYi5uYW1lXT1iLnZhbHVlfSk7Yj1kfXZhciBmLGc9YS5hamF4LGo9YS5vSW5zdGFuY2UsaT1mdW5jdGlvbihiKXt1KGEsbnVsbCwieGhyIixbYSxiLGEuanFYSFJdKTtjKGIpfTtpZihoLmlzUGxhaW5PYmplY3QoZykmJmcuZGF0YSl7Zj1nLmRhdGE7dmFyIG49aC5pc0Z1bmN0aW9uKGYpP2YoYixhKTpmLGI9aC5pc0Z1bmN0aW9uKGYpJiZuP246aC5leHRlbmQoITAsYixuKTtkZWxldGUgZy5kYXRhfW49e2RhdGE6YixzdWNjZXNzOmZ1bmN0aW9uKGIpe3ZhciBjPWIuZXJyb3J8fGIuc0Vycm9yO2MmJkwoYSwwLGMpO2EuanNvbj1iO2koYil9LGRhdGFUeXBlOiJqc29uIixjYWNoZTohMSx0eXBlOmEuc1NlcnZlck1ldGhvZCxlcnJvcjpmdW5jdGlvbihiLGMpe3ZhciBkPXUoYSxudWxsLCJ4aHIiLApbYSxudWxsLGEuanFYSFJdKTstMT09PWguaW5BcnJheSghMCxkKSYmKCJwYXJzZXJlcnJvciI9PWM/TChhLDAsIkludmFsaWQgSlNPTiByZXNwb25zZSIsMSk6ND09PWIucmVhZHlTdGF0ZSYmTChhLDAsIkFqYXggZXJyb3IiLDcpKTtDKGEsITEpfX07YS5vQWpheERhdGE9Yjt1KGEsbnVsbCwicHJlWGhyIixbYSxiXSk7YS5mblNlcnZlckRhdGE/YS5mblNlcnZlckRhdGEuY2FsbChqLGEuc0FqYXhTb3VyY2UsaC5tYXAoYixmdW5jdGlvbihhLGIpe3JldHVybntuYW1lOmIsdmFsdWU6YX19KSxpLGEpOmEuc0FqYXhTb3VyY2V8fCJzdHJpbmciPT09dHlwZW9mIGc/YS5qcVhIUj1oLmFqYXgoaC5leHRlbmQobix7dXJsOmd8fGEuc0FqYXhTb3VyY2V9KSk6aC5pc0Z1bmN0aW9uKGcpP2EuanFYSFI9Zy5jYWxsKGosYixpLGEpOihhLmpxWEhSPWguYWpheChoLmV4dGVuZChuLGcpKSxnLmRhdGE9Zil9ZnVuY3Rpb24gbGIoYSl7cmV0dXJuIGEuYkFqYXhEYXRhR2V0PyhhLmlEcmF3KyssQyhhLAohMCkscmEoYSx1YihhKSxmdW5jdGlvbihiKXt2YihhLGIpfSksITEpOiEwfWZ1bmN0aW9uIHViKGEpe3ZhciBiPWEuYW9Db2x1bW5zLGM9Yi5sZW5ndGgsZD1hLm9GZWF0dXJlcyxlPWEub1ByZXZpb3VzU2VhcmNoLGY9YS5hb1ByZVNlYXJjaENvbHMsZyxqPVtdLGksbixsLHE9VyhhKTtnPWEuX2lEaXNwbGF5U3RhcnQ7aT0hMSE9PWQuYlBhZ2luYXRlP2EuX2lEaXNwbGF5TGVuZ3RoOi0xO3ZhciBrPWZ1bmN0aW9uKGEsYil7ai5wdXNoKHtuYW1lOmEsdmFsdWU6Yn0pfTtrKCJzRWNobyIsYS5pRHJhdyk7aygiaUNvbHVtbnMiLGMpO2soInNDb2x1bW5zIixGKGIsInNOYW1lIikuam9pbigiLCIpKTtrKCJpRGlzcGxheVN0YXJ0IixnKTtrKCJpRGlzcGxheUxlbmd0aCIsaSk7dmFyIFM9e2RyYXc6YS5pRHJhdyxjb2x1bW5zOltdLG9yZGVyOltdLHN0YXJ0OmcsbGVuZ3RoOmksc2VhcmNoOnt2YWx1ZTplLnNTZWFyY2gscmVnZXg6ZS5iUmVnZXh9fTtmb3IoZz0wO2c8YztnKyspbj1iW2ddLApsPWZbZ10saT0iZnVuY3Rpb24iPT10eXBlb2Ygbi5tRGF0YT8iZnVuY3Rpb24iOm4ubURhdGEsUy5jb2x1bW5zLnB1c2goe2RhdGE6aSxuYW1lOm4uc05hbWUsc2VhcmNoYWJsZTpuLmJTZWFyY2hhYmxlLG9yZGVyYWJsZTpuLmJTb3J0YWJsZSxzZWFyY2g6e3ZhbHVlOmwuc1NlYXJjaCxyZWdleDpsLmJSZWdleH19KSxrKCJtRGF0YVByb3BfIitnLGkpLGQuYkZpbHRlciYmKGsoInNTZWFyY2hfIitnLGwuc1NlYXJjaCksaygiYlJlZ2V4XyIrZyxsLmJSZWdleCksaygiYlNlYXJjaGFibGVfIitnLG4uYlNlYXJjaGFibGUpKSxkLmJTb3J0JiZrKCJiU29ydGFibGVfIitnLG4uYlNvcnRhYmxlKTtkLmJGaWx0ZXImJihrKCJzU2VhcmNoIixlLnNTZWFyY2gpLGsoImJSZWdleCIsZS5iUmVnZXgpKTtkLmJTb3J0JiYoaC5lYWNoKHEsZnVuY3Rpb24oYSxiKXtTLm9yZGVyLnB1c2goe2NvbHVtbjpiLmNvbCxkaXI6Yi5kaXJ9KTtrKCJpU29ydENvbF8iK2EsYi5jb2wpO2soInNTb3J0RGlyXyIrCmEsYi5kaXIpfSksaygiaVNvcnRpbmdDb2xzIixxLmxlbmd0aCkpO2I9bS5leHQubGVnYWN5LmFqYXg7cmV0dXJuIG51bGw9PT1iP2Euc0FqYXhTb3VyY2U/ajpTOmI/ajpTfWZ1bmN0aW9uIHZiKGEsYil7dmFyIGM9c2EoYSxiKSxkPWIuc0VjaG8hPT1rP2Iuc0VjaG86Yi5kcmF3LGU9Yi5pVG90YWxSZWNvcmRzIT09az9iLmlUb3RhbFJlY29yZHM6Yi5yZWNvcmRzVG90YWwsZj1iLmlUb3RhbERpc3BsYXlSZWNvcmRzIT09az9iLmlUb3RhbERpc3BsYXlSZWNvcmRzOmIucmVjb3Jkc0ZpbHRlcmVkO2lmKGQpe2lmKDEqZDxhLmlEcmF3KXJldHVybjthLmlEcmF3PTEqZH1uYShhKTthLl9pUmVjb3Jkc1RvdGFsPXBhcnNlSW50KGUsMTApO2EuX2lSZWNvcmRzRGlzcGxheT1wYXJzZUludChmLDEwKTtkPTA7Zm9yKGU9Yy5sZW5ndGg7ZDxlO2QrKylOKGEsY1tkXSk7YS5haURpc3BsYXk9YS5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTthLmJBamF4RGF0YUdldD0hMTtPKGEpO2EuX2JJbml0Q29tcGxldGV8fAp0YShhLGIpO2EuYkFqYXhEYXRhR2V0PSEwO0MoYSwhMSl9ZnVuY3Rpb24gc2EoYSxiKXt2YXIgYz1oLmlzUGxhaW5PYmplY3QoYS5hamF4KSYmYS5hamF4LmRhdGFTcmMhPT1rP2EuYWpheC5kYXRhU3JjOmEuc0FqYXhEYXRhUHJvcDtyZXR1cm4iZGF0YSI9PT1jP2IuYWFEYXRhfHxiW2NdOiIiIT09Yz9RKGMpKGIpOmJ9ZnVuY3Rpb24gcGIoYSl7dmFyIGI9YS5vQ2xhc3NlcyxjPWEuc1RhYmxlSWQsZD1hLm9MYW5ndWFnZSxlPWEub1ByZXZpb3VzU2VhcmNoLGY9YS5hYW5GZWF0dXJlcyxnPSc8aW5wdXQgdHlwZT0ic2VhcmNoIiBjbGFzcz0iJytiLnNGaWx0ZXJJbnB1dCsnIi8+JyxqPWQuc1NlYXJjaCxqPWoubWF0Y2goL19JTlBVVF8vKT9qLnJlcGxhY2UoIl9JTlBVVF8iLGcpOmorZyxiPWgoIjxkaXYvPiIse2lkOiFmLmY/YysiX2ZpbHRlciI6bnVsbCwiY2xhc3MiOmIuc0ZpbHRlcn0pLmFwcGVuZChoKCI8bGFiZWwvPiIpLmFwcGVuZChqKSksZj1mdW5jdGlvbigpe3ZhciBiPSF0aGlzLnZhbHVlPwoiIjp0aGlzLnZhbHVlO2IhPWUuc1NlYXJjaCYmKGZhKGEse3NTZWFyY2g6YixiUmVnZXg6ZS5iUmVnZXgsYlNtYXJ0OmUuYlNtYXJ0LGJDYXNlSW5zZW5zaXRpdmU6ZS5iQ2FzZUluc2Vuc2l0aXZlfSksYS5faURpc3BsYXlTdGFydD0wLE8oYSkpfSxnPW51bGwhPT1hLnNlYXJjaERlbGF5P2Euc2VhcmNoRGVsYXk6InNzcCI9PT15KGEpPzQwMDowLGk9aCgiaW5wdXQiLGIpLnZhbChlLnNTZWFyY2gpLmF0dHIoInBsYWNlaG9sZGVyIixkLnNTZWFyY2hQbGFjZWhvbGRlcikuYmluZCgia2V5dXAuRFQgc2VhcmNoLkRUIGlucHV0LkRUIHBhc3RlLkRUIGN1dC5EVCIsZz91YShmLGcpOmYpLmJpbmQoImtleXByZXNzLkRUIixmdW5jdGlvbihhKXtpZigxMz09YS5rZXlDb2RlKXJldHVybiExfSkuYXR0cigiYXJpYS1jb250cm9scyIsYyk7aChhLm5UYWJsZSkub24oInNlYXJjaC5kdC5EVCIsZnVuY3Rpb24oYixjKXtpZihhPT09Yyl0cnl7aVswXSE9PUkuYWN0aXZlRWxlbWVudCYmaS52YWwoZS5zU2VhcmNoKX1jYXRjaChkKXt9fSk7CnJldHVybiBiWzBdfWZ1bmN0aW9uIGZhKGEsYixjKXt2YXIgZD1hLm9QcmV2aW91c1NlYXJjaCxlPWEuYW9QcmVTZWFyY2hDb2xzLGY9ZnVuY3Rpb24oYSl7ZC5zU2VhcmNoPWEuc1NlYXJjaDtkLmJSZWdleD1hLmJSZWdleDtkLmJTbWFydD1hLmJTbWFydDtkLmJDYXNlSW5zZW5zaXRpdmU9YS5iQ2FzZUluc2Vuc2l0aXZlfTtJYShhKTtpZigic3NwIiE9eShhKSl7d2IoYSxiLnNTZWFyY2gsYyxiLmJFc2NhcGVSZWdleCE9PWs/IWIuYkVzY2FwZVJlZ2V4OmIuYlJlZ2V4LGIuYlNtYXJ0LGIuYkNhc2VJbnNlbnNpdGl2ZSk7ZihiKTtmb3IoYj0wO2I8ZS5sZW5ndGg7YisrKXhiKGEsZVtiXS5zU2VhcmNoLGIsZVtiXS5iRXNjYXBlUmVnZXghPT1rPyFlW2JdLmJFc2NhcGVSZWdleDplW2JdLmJSZWdleCxlW2JdLmJTbWFydCxlW2JdLmJDYXNlSW5zZW5zaXRpdmUpO3liKGEpfWVsc2UgZihiKTthLmJGaWx0ZXJlZD0hMDt1KGEsbnVsbCwic2VhcmNoIixbYV0pfWZ1bmN0aW9uIHliKGEpe2Zvcih2YXIgYj0KbS5leHQuc2VhcmNoLGM9YS5haURpc3BsYXksZCxlLGY9MCxnPWIubGVuZ3RoO2Y8ZztmKyspe2Zvcih2YXIgaj1bXSxpPTAsbj1jLmxlbmd0aDtpPG47aSsrKWU9Y1tpXSxkPWEuYW9EYXRhW2VdLGJbZl0oYSxkLl9hRmlsdGVyRGF0YSxlLGQuX2FEYXRhLGkpJiZqLnB1c2goZSk7Yy5sZW5ndGg9MDtoLm1lcmdlKGMsail9fWZ1bmN0aW9uIHhiKGEsYixjLGQsZSxmKXtpZigiIiE9PWIpZm9yKHZhciBnPWEuYWlEaXNwbGF5LGQ9UWEoYixkLGUsZiksZT1nLmxlbmd0aC0xOzA8PWU7ZS0tKWI9YS5hb0RhdGFbZ1tlXV0uX2FGaWx0ZXJEYXRhW2NdLGQudGVzdChiKXx8Zy5zcGxpY2UoZSwxKX1mdW5jdGlvbiB3YihhLGIsYyxkLGUsZil7dmFyIGQ9UWEoYixkLGUsZiksZT1hLm9QcmV2aW91c1NlYXJjaC5zU2VhcmNoLGY9YS5haURpc3BsYXlNYXN0ZXIsZzswIT09bS5leHQuc2VhcmNoLmxlbmd0aCYmKGM9ITApO2c9emIoYSk7aWYoMD49Yi5sZW5ndGgpYS5haURpc3BsYXk9Zi5zbGljZSgpOwplbHNle2lmKGd8fGN8fGUubGVuZ3RoPmIubGVuZ3RofHwwIT09Yi5pbmRleE9mKGUpfHxhLmJTb3J0ZWQpYS5haURpc3BsYXk9Zi5zbGljZSgpO2I9YS5haURpc3BsYXk7Zm9yKGM9Yi5sZW5ndGgtMTswPD1jO2MtLSlkLnRlc3QoYS5hb0RhdGFbYltjXV0uX3NGaWx0ZXJSb3cpfHxiLnNwbGljZShjLDEpfX1mdW5jdGlvbiBRYShhLGIsYyxkKXthPWI/YTp2YShhKTtjJiYoYT0iXig/PS4qPyIraC5tYXAoYS5tYXRjaCgvIlteIl0rInxbXiBdKy9nKXx8WyIiXSxmdW5jdGlvbihhKXtpZignIic9PT1hLmNoYXJBdCgwKSl2YXIgYj1hLm1hdGNoKC9eIiguKikiJC8pLGE9Yj9iWzFdOmE7cmV0dXJuIGEucmVwbGFjZSgnIicsIiIpfSkuam9pbigiKSg/PS4qPyIpKyIpLiokIik7cmV0dXJuIFJlZ0V4cChhLGQ/ImkiOiIiKX1mdW5jdGlvbiB2YShhKXtyZXR1cm4gYS5yZXBsYWNlKFpiLCJcXCQxIil9ZnVuY3Rpb24gemIoYSl7dmFyIGI9YS5hb0NvbHVtbnMsYyxkLGUsZixnLGosaSxoLGw9Cm0uZXh0LnR5cGUuc2VhcmNoO2M9ITE7ZD0wO2ZvcihmPWEuYW9EYXRhLmxlbmd0aDtkPGY7ZCsrKWlmKGg9YS5hb0RhdGFbZF0sIWguX2FGaWx0ZXJEYXRhKXtqPVtdO2U9MDtmb3IoZz1iLmxlbmd0aDtlPGc7ZSsrKWM9YltlXSxjLmJTZWFyY2hhYmxlPyhpPUIoYSxkLGUsImZpbHRlciIpLGxbYy5zVHlwZV0mJihpPWxbYy5zVHlwZV0oaSkpLG51bGw9PT1pJiYoaT0iIiksInN0cmluZyIhPT10eXBlb2YgaSYmaS50b1N0cmluZyYmKGk9aS50b1N0cmluZygpKSk6aT0iIixpLmluZGV4T2YmJi0xIT09aS5pbmRleE9mKCImIikmJih3YS5pbm5lckhUTUw9aSxpPSRiP3dhLnRleHRDb250ZW50OndhLmlubmVyVGV4dCksaS5yZXBsYWNlJiYoaT1pLnJlcGxhY2UoL1tcclxuXS9nLCIiKSksai5wdXNoKGkpO2guX2FGaWx0ZXJEYXRhPWo7aC5fc0ZpbHRlclJvdz1qLmpvaW4oIiAgIik7Yz0hMH1yZXR1cm4gY31mdW5jdGlvbiBBYihhKXtyZXR1cm57c2VhcmNoOmEuc1NlYXJjaCxzbWFydDphLmJTbWFydCwKcmVnZXg6YS5iUmVnZXgsY2FzZUluc2Vuc2l0aXZlOmEuYkNhc2VJbnNlbnNpdGl2ZX19ZnVuY3Rpb24gQmIoYSl7cmV0dXJue3NTZWFyY2g6YS5zZWFyY2gsYlNtYXJ0OmEuc21hcnQsYlJlZ2V4OmEucmVnZXgsYkNhc2VJbnNlbnNpdGl2ZTphLmNhc2VJbnNlbnNpdGl2ZX19ZnVuY3Rpb24gc2IoYSl7dmFyIGI9YS5zVGFibGVJZCxjPWEuYWFuRmVhdHVyZXMuaSxkPWgoIjxkaXYvPiIseyJjbGFzcyI6YS5vQ2xhc3Nlcy5zSW5mbyxpZDohYz9iKyJfaW5mbyI6bnVsbH0pO2N8fChhLmFvRHJhd0NhbGxiYWNrLnB1c2goe2ZuOkNiLHNOYW1lOiJpbmZvcm1hdGlvbiJ9KSxkLmF0dHIoInJvbGUiLCJzdGF0dXMiKS5hdHRyKCJhcmlhLWxpdmUiLCJwb2xpdGUiKSxoKGEublRhYmxlKS5hdHRyKCJhcmlhLWRlc2NyaWJlZGJ5IixiKyJfaW5mbyIpKTtyZXR1cm4gZFswXX1mdW5jdGlvbiBDYihhKXt2YXIgYj1hLmFhbkZlYXR1cmVzLmk7aWYoMCE9PWIubGVuZ3RoKXt2YXIgYz1hLm9MYW5ndWFnZSwKZD1hLl9pRGlzcGxheVN0YXJ0KzEsZT1hLmZuRGlzcGxheUVuZCgpLGY9YS5mblJlY29yZHNUb3RhbCgpLGc9YS5mblJlY29yZHNEaXNwbGF5KCksaj1nP2Muc0luZm86Yy5zSW5mb0VtcHR5O2chPT1mJiYoais9IiAiK2Muc0luZm9GaWx0ZXJlZCk7ais9Yy5zSW5mb1Bvc3RGaXg7aj1EYihhLGopO2M9Yy5mbkluZm9DYWxsYmFjaztudWxsIT09YyYmKGo9Yy5jYWxsKGEub0luc3RhbmNlLGEsZCxlLGYsZyxqKSk7aChiKS5odG1sKGopfX1mdW5jdGlvbiBEYihhLGIpe3ZhciBjPWEuZm5Gb3JtYXROdW1iZXIsZD1hLl9pRGlzcGxheVN0YXJ0KzEsZT1hLl9pRGlzcGxheUxlbmd0aCxmPWEuZm5SZWNvcmRzRGlzcGxheSgpLGc9LTE9PT1lO3JldHVybiBiLnJlcGxhY2UoL19TVEFSVF8vZyxjLmNhbGwoYSxkKSkucmVwbGFjZSgvX0VORF8vZyxjLmNhbGwoYSxhLmZuRGlzcGxheUVuZCgpKSkucmVwbGFjZSgvX01BWF8vZyxjLmNhbGwoYSxhLmZuUmVjb3Jkc1RvdGFsKCkpKS5yZXBsYWNlKC9fVE9UQUxfL2csCmMuY2FsbChhLGYpKS5yZXBsYWNlKC9fUEFHRV8vZyxjLmNhbGwoYSxnPzE6TWF0aC5jZWlsKGQvZSkpKS5yZXBsYWNlKC9fUEFHRVNfL2csYy5jYWxsKGEsZz8xOk1hdGguY2VpbChmL2UpKSl9ZnVuY3Rpb24gZ2EoYSl7dmFyIGIsYyxkPWEuaUluaXREaXNwbGF5U3RhcnQsZT1hLmFvQ29sdW1ucyxmO2M9YS5vRmVhdHVyZXM7dmFyIGc9YS5iRGVmZXJMb2FkaW5nO2lmKGEuYkluaXRpYWxpc2VkKXtuYihhKTtrYihhKTtlYShhLGEuYW9IZWFkZXIpO2VhKGEsYS5hb0Zvb3Rlcik7QyhhLCEwKTtjLmJBdXRvV2lkdGgmJkhhKGEpO2I9MDtmb3IoYz1lLmxlbmd0aDtiPGM7YisrKWY9ZVtiXSxmLnNXaWR0aCYmKGYublRoLnN0eWxlLndpZHRoPXgoZi5zV2lkdGgpKTt1KGEsbnVsbCwicHJlSW5pdCIsW2FdKTtUKGEpO2U9eShhKTtpZigic3NwIiE9ZXx8ZykiYWpheCI9PWU/cmEoYSxbXSxmdW5jdGlvbihjKXt2YXIgZj1zYShhLGMpO2ZvcihiPTA7YjxmLmxlbmd0aDtiKyspTihhLGZbYl0pOwphLmlJbml0RGlzcGxheVN0YXJ0PWQ7VChhKTtDKGEsITEpO3RhKGEsYyl9LGEpOihDKGEsITEpLHRhKGEpKX1lbHNlIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtnYShhKX0sMjAwKX1mdW5jdGlvbiB0YShhLGIpe2EuX2JJbml0Q29tcGxldGU9ITA7KGJ8fGEub0luaXQuYWFEYXRhKSYmVShhKTt1KGEsbnVsbCwicGx1Z2luLWluaXQiLFthLGJdKTt1KGEsImFvSW5pdENvbXBsZXRlIiwiaW5pdCIsW2EsYl0pfWZ1bmN0aW9uIFJhKGEsYil7dmFyIGM9cGFyc2VJbnQoYiwxMCk7YS5faURpc3BsYXlMZW5ndGg9YztTYShhKTt1KGEsbnVsbCwibGVuZ3RoIixbYSxjXSl9ZnVuY3Rpb24gb2IoYSl7Zm9yKHZhciBiPWEub0NsYXNzZXMsYz1hLnNUYWJsZUlkLGQ9YS5hTGVuZ3RoTWVudSxlPWguaXNBcnJheShkWzBdKSxmPWU/ZFswXTpkLGQ9ZT9kWzFdOmQsZT1oKCI8c2VsZWN0Lz4iLHtuYW1lOmMrIl9sZW5ndGgiLCJhcmlhLWNvbnRyb2xzIjpjLCJjbGFzcyI6Yi5zTGVuZ3RoU2VsZWN0fSksCmc9MCxqPWYubGVuZ3RoO2c8ajtnKyspZVswXVtnXT1uZXcgT3B0aW9uKGRbZ10sZltnXSk7dmFyIGk9aCgiPGRpdj48bGFiZWwvPjwvZGl2PiIpLmFkZENsYXNzKGIuc0xlbmd0aCk7YS5hYW5GZWF0dXJlcy5sfHwoaVswXS5pZD1jKyJfbGVuZ3RoIik7aS5jaGlsZHJlbigpLmFwcGVuZChhLm9MYW5ndWFnZS5zTGVuZ3RoTWVudS5yZXBsYWNlKCJfTUVOVV8iLGVbMF0ub3V0ZXJIVE1MKSk7aCgic2VsZWN0IixpKS52YWwoYS5faURpc3BsYXlMZW5ndGgpLmJpbmQoImNoYW5nZS5EVCIsZnVuY3Rpb24oKXtSYShhLGgodGhpcykudmFsKCkpO08oYSl9KTtoKGEublRhYmxlKS5iaW5kKCJsZW5ndGguZHQuRFQiLGZ1bmN0aW9uKGIsYyxkKXthPT09YyYmaCgic2VsZWN0IixpKS52YWwoZCl9KTtyZXR1cm4gaVswXX1mdW5jdGlvbiB0YihhKXt2YXIgYj1hLnNQYWdpbmF0aW9uVHlwZSxjPW0uZXh0LnBhZ2VyW2JdLGQ9ImZ1bmN0aW9uIj09PXR5cGVvZiBjLGU9ZnVuY3Rpb24oYSl7TyhhKX0sCmI9aCgiPGRpdi8+IikuYWRkQ2xhc3MoYS5vQ2xhc3Nlcy5zUGFnaW5nK2IpWzBdLGY9YS5hYW5GZWF0dXJlcztkfHxjLmZuSW5pdChhLGIsZSk7Zi5wfHwoYi5pZD1hLnNUYWJsZUlkKyJfcGFnaW5hdGUiLGEuYW9EcmF3Q2FsbGJhY2sucHVzaCh7Zm46ZnVuY3Rpb24oYSl7aWYoZCl7dmFyIGI9YS5faURpc3BsYXlTdGFydCxpPWEuX2lEaXNwbGF5TGVuZ3RoLGg9YS5mblJlY29yZHNEaXNwbGF5KCksbD0tMT09PWksYj1sPzA6TWF0aC5jZWlsKGIvaSksaT1sPzE6TWF0aC5jZWlsKGgvaSksaD1jKGIsaSksayxsPTA7Zm9yKGs9Zi5wLmxlbmd0aDtsPGs7bCsrKVBhKGEsInBhZ2VCdXR0b24iKShhLGYucFtsXSxsLGgsYixpKX1lbHNlIGMuZm5VcGRhdGUoYSxlKX0sc05hbWU6InBhZ2luYXRpb24ifSkpO3JldHVybiBifWZ1bmN0aW9uIFRhKGEsYixjKXt2YXIgZD1hLl9pRGlzcGxheVN0YXJ0LGU9YS5faURpc3BsYXlMZW5ndGgsZj1hLmZuUmVjb3Jkc0Rpc3BsYXkoKTswPT09Znx8LTE9PT0KZT9kPTA6Im51bWJlciI9PT10eXBlb2YgYj8oZD1iKmUsZD5mJiYoZD0wKSk6ImZpcnN0Ij09Yj9kPTA6InByZXZpb3VzIj09Yj8oZD0wPD1lP2QtZTowLDA+ZCYmKGQ9MCkpOiJuZXh0Ij09Yj9kK2U8ZiYmKGQrPWUpOiJsYXN0Ij09Yj9kPU1hdGguZmxvb3IoKGYtMSkvZSkqZTpMKGEsMCwiVW5rbm93biBwYWdpbmcgYWN0aW9uOiAiK2IsNSk7Yj1hLl9pRGlzcGxheVN0YXJ0IT09ZDthLl9pRGlzcGxheVN0YXJ0PWQ7YiYmKHUoYSxudWxsLCJwYWdlIixbYV0pLGMmJk8oYSkpO3JldHVybiBifWZ1bmN0aW9uIHFiKGEpe3JldHVybiBoKCI8ZGl2Lz4iLHtpZDohYS5hYW5GZWF0dXJlcy5yP2Euc1RhYmxlSWQrIl9wcm9jZXNzaW5nIjpudWxsLCJjbGFzcyI6YS5vQ2xhc3Nlcy5zUHJvY2Vzc2luZ30pLmh0bWwoYS5vTGFuZ3VhZ2Uuc1Byb2Nlc3NpbmcpLmluc2VydEJlZm9yZShhLm5UYWJsZSlbMF19ZnVuY3Rpb24gQyhhLGIpe2Eub0ZlYXR1cmVzLmJQcm9jZXNzaW5nJiZoKGEuYWFuRmVhdHVyZXMucikuY3NzKCJkaXNwbGF5IiwKYj8iYmxvY2siOiJub25lIik7dShhLG51bGwsInByb2Nlc3NpbmciLFthLGJdKX1mdW5jdGlvbiByYihhKXt2YXIgYj1oKGEublRhYmxlKTtiLmF0dHIoInJvbGUiLCJncmlkIik7dmFyIGM9YS5vU2Nyb2xsO2lmKCIiPT09Yy5zWCYmIiI9PT1jLnNZKXJldHVybiBhLm5UYWJsZTt2YXIgZD1jLnNYLGU9Yy5zWSxmPWEub0NsYXNzZXMsZz1iLmNoaWxkcmVuKCJjYXB0aW9uIiksaj1nLmxlbmd0aD9nWzBdLl9jYXB0aW9uU2lkZTpudWxsLGk9aChiWzBdLmNsb25lTm9kZSghMSkpLG49aChiWzBdLmNsb25lTm9kZSghMSkpLGw9Yi5jaGlsZHJlbigidGZvb3QiKTtsLmxlbmd0aHx8KGw9bnVsbCk7aT1oKCI8ZGl2Lz4iLHsiY2xhc3MiOmYuc1Njcm9sbFdyYXBwZXJ9KS5hcHBlbmQoaCgiPGRpdi8+Iix7ImNsYXNzIjpmLnNTY3JvbGxIZWFkfSkuY3NzKHtvdmVyZmxvdzoiaGlkZGVuIixwb3NpdGlvbjoicmVsYXRpdmUiLGJvcmRlcjowLHdpZHRoOmQ/IWQ/bnVsbDp4KGQpOiIxMDAlIn0pLmFwcGVuZChoKCI8ZGl2Lz4iLAp7ImNsYXNzIjpmLnNTY3JvbGxIZWFkSW5uZXJ9KS5jc3MoeyJib3gtc2l6aW5nIjoiY29udGVudC1ib3giLHdpZHRoOmMuc1hJbm5lcnx8IjEwMCUifSkuYXBwZW5kKGkucmVtb3ZlQXR0cigiaWQiKS5jc3MoIm1hcmdpbi1sZWZ0IiwwKS5hcHBlbmQoInRvcCI9PT1qP2c6bnVsbCkuYXBwZW5kKGIuY2hpbGRyZW4oInRoZWFkIikpKSkpLmFwcGVuZChoKCI8ZGl2Lz4iLHsiY2xhc3MiOmYuc1Njcm9sbEJvZHl9KS5jc3Moe3Bvc2l0aW9uOiJyZWxhdGl2ZSIsb3ZlcmZsb3c6ImF1dG8iLHdpZHRoOiFkP251bGw6eChkKX0pLmFwcGVuZChiKSk7bCYmaS5hcHBlbmQoaCgiPGRpdi8+Iix7ImNsYXNzIjpmLnNTY3JvbGxGb290fSkuY3NzKHtvdmVyZmxvdzoiaGlkZGVuIixib3JkZXI6MCx3aWR0aDpkPyFkP251bGw6eChkKToiMTAwJSJ9KS5hcHBlbmQoaCgiPGRpdi8+Iix7ImNsYXNzIjpmLnNTY3JvbGxGb290SW5uZXJ9KS5hcHBlbmQobi5yZW1vdmVBdHRyKCJpZCIpLmNzcygibWFyZ2luLWxlZnQiLAowKS5hcHBlbmQoImJvdHRvbSI9PT1qP2c6bnVsbCkuYXBwZW5kKGIuY2hpbGRyZW4oInRmb290IikpKSkpO3ZhciBiPWkuY2hpbGRyZW4oKSxrPWJbMF0sZj1iWzFdLHQ9bD9iWzJdOm51bGw7aWYoZCloKGYpLm9uKCJzY3JvbGwuRFQiLGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5zY3JvbGxMZWZ0O2suc2Nyb2xsTGVmdD1hO2wmJih0LnNjcm9sbExlZnQ9YSl9KTtoKGYpLmNzcyhlJiZjLmJDb2xsYXBzZT8ibWF4LWhlaWdodCI6ImhlaWdodCIsZSk7YS5uU2Nyb2xsSGVhZD1rO2EublNjcm9sbEJvZHk9ZjthLm5TY3JvbGxGb290PXQ7YS5hb0RyYXdDYWxsYmFjay5wdXNoKHtmbjprYSxzTmFtZToic2Nyb2xsaW5nIn0pO3JldHVybiBpWzBdfWZ1bmN0aW9uIGthKGEpe3ZhciBiPWEub1Njcm9sbCxjPWIuc1gsZD1iLnNYSW5uZXIsZT1iLnNZLGI9Yi5pQmFyV2lkdGgsZj1oKGEublNjcm9sbEhlYWQpLGc9ZlswXS5zdHlsZSxqPWYuY2hpbGRyZW4oImRpdiIpLGk9alswXS5zdHlsZSxuPWouY2hpbGRyZW4oInRhYmxlIiksCmo9YS5uU2Nyb2xsQm9keSxsPWgoaikscT1qLnN0eWxlLHQ9aChhLm5TY3JvbGxGb290KS5jaGlsZHJlbigiZGl2IiksbT10LmNoaWxkcmVuKCJ0YWJsZSIpLG89aChhLm5USGVhZCksRz1oKGEublRhYmxlKSxwPUdbMF0scj1wLnN0eWxlLHU9YS5uVEZvb3Q/aChhLm5URm9vdCk6bnVsbCxFYj1hLm9Ccm93c2VyLFVhPUViLmJTY3JvbGxPdmVyc2l6ZSxzPUYoYS5hb0NvbHVtbnMsIm5UaCIpLFAsdix3LHksej1bXSxBPVtdLEI9W10sQz1bXSxELEU9ZnVuY3Rpb24oYSl7YT1hLnN0eWxlO2EucGFkZGluZ1RvcD0iMCI7YS5wYWRkaW5nQm90dG9tPSIwIjthLmJvcmRlclRvcFdpZHRoPSIwIjthLmJvcmRlckJvdHRvbVdpZHRoPSIwIjthLmhlaWdodD0wfTt2PWouc2Nyb2xsSGVpZ2h0PmouY2xpZW50SGVpZ2h0O2lmKGEuc2Nyb2xsQmFyVmlzIT09diYmYS5zY3JvbGxCYXJWaXMhPT1rKWEuc2Nyb2xsQmFyVmlzPXYsVShhKTtlbHNle2Euc2Nyb2xsQmFyVmlzPXY7Ry5jaGlsZHJlbigidGhlYWQsIHRmb290IikucmVtb3ZlKCk7CnUmJih3PXUuY2xvbmUoKS5wcmVwZW5kVG8oRyksUD11LmZpbmQoInRyIiksdz13LmZpbmQoInRyIikpO3k9by5jbG9uZSgpLnByZXBlbmRUbyhHKTtvPW8uZmluZCgidHIiKTt2PXkuZmluZCgidHIiKTt5LmZpbmQoInRoLCB0ZCIpLnJlbW92ZUF0dHIoInRhYmluZGV4Iik7Y3x8KHEud2lkdGg9IjEwMCUiLGZbMF0uc3R5bGUud2lkdGg9IjEwMCUiKTtoLmVhY2gocWEoYSx5KSxmdW5jdGlvbihiLGMpe0Q9WihhLGIpO2Muc3R5bGUud2lkdGg9YS5hb0NvbHVtbnNbRF0uc1dpZHRofSk7dSYmSihmdW5jdGlvbihhKXthLnN0eWxlLndpZHRoPSIifSx3KTtmPUcub3V0ZXJXaWR0aCgpO2lmKCIiPT09Yyl7ci53aWR0aD0iMTAwJSI7aWYoVWEmJihHLmZpbmQoInRib2R5IikuaGVpZ2h0KCk+ai5vZmZzZXRIZWlnaHR8fCJzY3JvbGwiPT1sLmNzcygib3ZlcmZsb3cteSIpKSlyLndpZHRoPXgoRy5vdXRlcldpZHRoKCktYik7Zj1HLm91dGVyV2lkdGgoKX1lbHNlIiIhPT1kJiYoci53aWR0aD0KeChkKSxmPUcub3V0ZXJXaWR0aCgpKTtKKEUsdik7SihmdW5jdGlvbihhKXtCLnB1c2goYS5pbm5lckhUTUwpO3oucHVzaCh4KGgoYSkuY3NzKCJ3aWR0aCIpKSl9LHYpO0ooZnVuY3Rpb24oYSxiKXtpZihoLmluQXJyYXkoYSxzKSE9PS0xKWEuc3R5bGUud2lkdGg9eltiXX0sbyk7aCh2KS5oZWlnaHQoMCk7dSYmKEooRSx3KSxKKGZ1bmN0aW9uKGEpe0MucHVzaChhLmlubmVySFRNTCk7QS5wdXNoKHgoaChhKS5jc3MoIndpZHRoIikpKX0sdyksSihmdW5jdGlvbihhLGIpe2Euc3R5bGUud2lkdGg9QVtiXX0sUCksaCh3KS5oZWlnaHQoMCkpO0ooZnVuY3Rpb24oYSxiKXthLmlubmVySFRNTD0nPGRpdiBjbGFzcz0iZGF0YVRhYmxlc19zaXppbmciIHN0eWxlPSJoZWlnaHQ6MDtvdmVyZmxvdzpoaWRkZW47Ij4nK0JbYl0rIjwvZGl2PiI7YS5zdHlsZS53aWR0aD16W2JdfSx2KTt1JiZKKGZ1bmN0aW9uKGEsYil7YS5pbm5lckhUTUw9JzxkaXYgY2xhc3M9ImRhdGFUYWJsZXNfc2l6aW5nIiBzdHlsZT0iaGVpZ2h0OjA7b3ZlcmZsb3c6aGlkZGVuOyI+JysKQ1tiXSsiPC9kaXY+IjthLnN0eWxlLndpZHRoPUFbYl19LHcpO2lmKEcub3V0ZXJXaWR0aCgpPGYpe1A9ai5zY3JvbGxIZWlnaHQ+ai5vZmZzZXRIZWlnaHR8fCJzY3JvbGwiPT1sLmNzcygib3ZlcmZsb3cteSIpP2YrYjpmO2lmKFVhJiYoai5zY3JvbGxIZWlnaHQ+ai5vZmZzZXRIZWlnaHR8fCJzY3JvbGwiPT1sLmNzcygib3ZlcmZsb3cteSIpKSlyLndpZHRoPXgoUC1iKTsoIiI9PT1jfHwiIiE9PWQpJiZMKGEsMSwiUG9zc2libGUgY29sdW1uIG1pc2FsaWdubWVudCIsNil9ZWxzZSBQPSIxMDAlIjtxLndpZHRoPXgoUCk7Zy53aWR0aD14KFApO3UmJihhLm5TY3JvbGxGb290LnN0eWxlLndpZHRoPXgoUCkpOyFlJiZVYSYmKHEuaGVpZ2h0PXgocC5vZmZzZXRIZWlnaHQrYikpO2M9Ry5vdXRlcldpZHRoKCk7blswXS5zdHlsZS53aWR0aD14KGMpO2kud2lkdGg9eChjKTtkPUcuaGVpZ2h0KCk+ai5jbGllbnRIZWlnaHR8fCJzY3JvbGwiPT1sLmNzcygib3ZlcmZsb3cteSIpO2U9InBhZGRpbmciKwooRWIuYlNjcm9sbGJhckxlZnQ/IkxlZnQiOiJSaWdodCIpO2lbZV09ZD9iKyJweCI6IjBweCI7dSYmKG1bMF0uc3R5bGUud2lkdGg9eChjKSx0WzBdLnN0eWxlLndpZHRoPXgoYyksdFswXS5zdHlsZVtlXT1kP2IrInB4IjoiMHB4Iik7Ry5jaGlsZHJlbigiY29sZ3JvdXAiKS5pbnNlcnRCZWZvcmUoRy5jaGlsZHJlbigidGhlYWQiKSk7bC5zY3JvbGwoKTtpZigoYS5iU29ydGVkfHxhLmJGaWx0ZXJlZCkmJiFhLl9kcmF3SG9sZClqLnNjcm9sbFRvcD0wfX1mdW5jdGlvbiBKKGEsYixjKXtmb3IodmFyIGQ9MCxlPTAsZj1iLmxlbmd0aCxnLGo7ZTxmOyl7Zz1iW2VdLmZpcnN0Q2hpbGQ7Zm9yKGo9Yz9jW2VdLmZpcnN0Q2hpbGQ6bnVsbDtnOykxPT09Zy5ub2RlVHlwZSYmKGM/YShnLGosZCk6YShnLGQpLGQrKyksZz1nLm5leHRTaWJsaW5nLGo9Yz9qLm5leHRTaWJsaW5nOm51bGw7ZSsrfX1mdW5jdGlvbiBIYShhKXt2YXIgYj1hLm5UYWJsZSxjPWEuYW9Db2x1bW5zLGQ9YS5vU2Nyb2xsLAplPWQuc1ksZj1kLnNYLGc9ZC5zWElubmVyLGo9Yy5sZW5ndGgsaT1sYShhLCJiVmlzaWJsZSIpLG49aCgidGgiLGEublRIZWFkKSxsPWIuZ2V0QXR0cmlidXRlKCJ3aWR0aCIpLGs9Yi5wYXJlbnROb2RlLHQ9ITEsbSxvLHA9YS5vQnJvd3NlcixkPXAuYlNjcm9sbE92ZXJzaXplOyhtPWIuc3R5bGUud2lkdGgpJiYtMSE9PW0uaW5kZXhPZigiJSIpJiYobD1tKTtmb3IobT0wO208aS5sZW5ndGg7bSsrKW89Y1tpW21dXSxudWxsIT09by5zV2lkdGgmJihvLnNXaWR0aD1GYihvLnNXaWR0aE9yaWcsayksdD0hMCk7aWYoZHx8IXQmJiFmJiYhZSYmaj09YWEoYSkmJmo9PW4ubGVuZ3RoKWZvcihtPTA7bTxqO20rKylpPVooYSxtKSxudWxsIT09aSYmKGNbaV0uc1dpZHRoPXgobi5lcShtKS53aWR0aCgpKSk7ZWxzZXtqPWgoYikuY2xvbmUoKS5jc3MoInZpc2liaWxpdHkiLCJoaWRkZW4iKS5yZW1vdmVBdHRyKCJpZCIpO2ouZmluZCgidGJvZHkgdHIiKS5yZW1vdmUoKTt2YXIgcj1oKCI8dHIvPiIpLmFwcGVuZFRvKGouZmluZCgidGJvZHkiKSk7CmouZmluZCgidGhlYWQsIHRmb290IikucmVtb3ZlKCk7ai5hcHBlbmQoaChhLm5USGVhZCkuY2xvbmUoKSkuYXBwZW5kKGgoYS5uVEZvb3QpLmNsb25lKCkpO2ouZmluZCgidGZvb3QgdGgsIHRmb290IHRkIikuY3NzKCJ3aWR0aCIsIiIpO249cWEoYSxqLmZpbmQoInRoZWFkIilbMF0pO2ZvcihtPTA7bTxpLmxlbmd0aDttKyspbz1jW2lbbV1dLG5bbV0uc3R5bGUud2lkdGg9bnVsbCE9PW8uc1dpZHRoT3JpZyYmIiIhPT1vLnNXaWR0aE9yaWc/eChvLnNXaWR0aE9yaWcpOiIiLG8uc1dpZHRoT3JpZyYmZiYmaChuW21dKS5hcHBlbmQoaCgiPGRpdi8+IikuY3NzKHt3aWR0aDpvLnNXaWR0aE9yaWcsbWFyZ2luOjAscGFkZGluZzowLGJvcmRlcjowLGhlaWdodDoxfSkpO2lmKGEuYW9EYXRhLmxlbmd0aClmb3IobT0wO208aS5sZW5ndGg7bSsrKXQ9aVttXSxvPWNbdF0saChHYihhLHQpKS5jbG9uZSghMSkuYXBwZW5kKG8uc0NvbnRlbnRQYWRkaW5nKS5hcHBlbmRUbyhyKTtoKCJbbmFtZV0iLApqKS5yZW1vdmVBdHRyKCJuYW1lIik7bz1oKCI8ZGl2Lz4iKS5jc3MoZnx8ZT97cG9zaXRpb246ImFic29sdXRlIix0b3A6MCxsZWZ0OjAsaGVpZ2h0OjEscmlnaHQ6MCxvdmVyZmxvdzoiaGlkZGVuIn06e30pLmFwcGVuZChqKS5hcHBlbmRUbyhrKTtmJiZnP2oud2lkdGgoZyk6Zj8oai5jc3MoIndpZHRoIiwiYXV0byIpLGoucmVtb3ZlQXR0cigid2lkdGgiKSxqLndpZHRoKCk8ay5jbGllbnRXaWR0aCYmbCYmai53aWR0aChrLmNsaWVudFdpZHRoKSk6ZT9qLndpZHRoKGsuY2xpZW50V2lkdGgpOmwmJmoud2lkdGgobCk7Zm9yKG09ZT0wO208aS5sZW5ndGg7bSsrKWs9aChuW21dKSxnPWsub3V0ZXJXaWR0aCgpLWsud2lkdGgoKSxrPXAuYkJvdW5kaW5nP01hdGguY2VpbChuW21dLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKTprLm91dGVyV2lkdGgoKSxlKz1rLGNbaVttXV0uc1dpZHRoPXgoay1nKTtiLnN0eWxlLndpZHRoPXgoZSk7by5yZW1vdmUoKX1sJiYoYi5zdHlsZS53aWR0aD0KeChsKSk7aWYoKGx8fGYpJiYhYS5fcmVzekV2dCliPWZ1bmN0aW9uKCl7aChEKS5iaW5kKCJyZXNpemUuRFQtIithLnNJbnN0YW5jZSx1YShmdW5jdGlvbigpe1UoYSl9KSl9LGQ/c2V0VGltZW91dChiLDFFMyk6YigpLGEuX3Jlc3pFdnQ9ITB9ZnVuY3Rpb24gdWEoYSxiKXt2YXIgYz1iIT09az9iOjIwMCxkLGU7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGI9dGhpcyxnPStuZXcgRGF0ZSxqPWFyZ3VtZW50cztkJiZnPGQrYz8oY2xlYXJUaW1lb3V0KGUpLGU9c2V0VGltZW91dChmdW5jdGlvbigpe2Q9azthLmFwcGx5KGIsail9LGMpKTooZD1nLGEuYXBwbHkoYixqKSl9fWZ1bmN0aW9uIEZiKGEsYil7aWYoIWEpcmV0dXJuIDA7dmFyIGM9aCgiPGRpdi8+IikuY3NzKCJ3aWR0aCIseChhKSkuYXBwZW5kVG8oYnx8SS5ib2R5KSxkPWNbMF0ub2Zmc2V0V2lkdGg7Yy5yZW1vdmUoKTtyZXR1cm4gZH1mdW5jdGlvbiBHYihhLGIpe3ZhciBjPUhiKGEsYik7aWYoMD5jKXJldHVybiBudWxsO3ZhciBkPQphLmFvRGF0YVtjXTtyZXR1cm4hZC5uVHI/aCgiPHRkLz4iKS5odG1sKEIoYSxjLGIsImRpc3BsYXkiKSlbMF06ZC5hbkNlbGxzW2JdfWZ1bmN0aW9uIEhiKGEsYil7Zm9yKHZhciBjLGQ9LTEsZT0tMSxmPTAsZz1hLmFvRGF0YS5sZW5ndGg7ZjxnO2YrKyljPUIoYSxmLGIsImRpc3BsYXkiKSsiIixjPWMucmVwbGFjZShhYywiIiksYz1jLnJlcGxhY2UoLyZuYnNwOy9nLCIgIiksYy5sZW5ndGg+ZCYmKGQ9Yy5sZW5ndGgsZT1mKTtyZXR1cm4gZX1mdW5jdGlvbiB4KGEpe3JldHVybiBudWxsPT09YT8iMHB4IjoibnVtYmVyIj09dHlwZW9mIGE/MD5hPyIwcHgiOmErInB4IjphLm1hdGNoKC9cZCQvKT9hKyJweCI6YX1mdW5jdGlvbiBXKGEpe3ZhciBiLGMsZD1bXSxlPWEuYW9Db2x1bW5zLGYsZyxqLGk7Yj1hLmFhU29ydGluZ0ZpeGVkO2M9aC5pc1BsYWluT2JqZWN0KGIpO3ZhciBuPVtdO2Y9ZnVuY3Rpb24oYSl7YS5sZW5ndGgmJiFoLmlzQXJyYXkoYVswXSk/bi5wdXNoKGEpOmgubWVyZ2UobiwKYSl9O2guaXNBcnJheShiKSYmZihiKTtjJiZiLnByZSYmZihiLnByZSk7ZihhLmFhU29ydGluZyk7YyYmYi5wb3N0JiZmKGIucG9zdCk7Zm9yKGE9MDthPG4ubGVuZ3RoO2ErKyl7aT1uW2FdWzBdO2Y9ZVtpXS5hRGF0YVNvcnQ7Yj0wO2ZvcihjPWYubGVuZ3RoO2I8YztiKyspZz1mW2JdLGo9ZVtnXS5zVHlwZXx8InN0cmluZyIsblthXS5faWR4PT09ayYmKG5bYV0uX2lkeD1oLmluQXJyYXkoblthXVsxXSxlW2ddLmFzU29ydGluZykpLGQucHVzaCh7c3JjOmksY29sOmcsZGlyOm5bYV1bMV0saW5kZXg6blthXS5faWR4LHR5cGU6aixmb3JtYXR0ZXI6bS5leHQudHlwZS5vcmRlcltqKyItcHJlIl19KX1yZXR1cm4gZH1mdW5jdGlvbiBtYihhKXt2YXIgYixjLGQ9W10sZT1tLmV4dC50eXBlLm9yZGVyLGY9YS5hb0RhdGEsZz0wLGosaT1hLmFpRGlzcGxheU1hc3RlcixoO0lhKGEpO2g9VyhhKTtiPTA7Zm9yKGM9aC5sZW5ndGg7YjxjO2IrKylqPWhbYl0sai5mb3JtYXR0ZXImJmcrKyxJYihhLApqLmNvbCk7aWYoInNzcCIhPXkoYSkmJjAhPT1oLmxlbmd0aCl7Yj0wO2ZvcihjPWkubGVuZ3RoO2I8YztiKyspZFtpW2JdXT1iO2c9PT1oLmxlbmd0aD9pLnNvcnQoZnVuY3Rpb24oYSxiKXt2YXIgYyxlLGcsaixpPWgubGVuZ3RoLGs9ZlthXS5fYVNvcnREYXRhLG09ZltiXS5fYVNvcnREYXRhO2ZvcihnPTA7ZzxpO2crKylpZihqPWhbZ10sYz1rW2ouY29sXSxlPW1bai5jb2xdLGM9YzxlPy0xOmM+ZT8xOjAsMCE9PWMpcmV0dXJuImFzYyI9PT1qLmRpcj9jOi1jO2M9ZFthXTtlPWRbYl07cmV0dXJuIGM8ZT8tMTpjPmU/MTowfSk6aS5zb3J0KGZ1bmN0aW9uKGEsYil7dmFyIGMsZyxqLGksaz1oLmxlbmd0aCxtPWZbYV0uX2FTb3J0RGF0YSxwPWZbYl0uX2FTb3J0RGF0YTtmb3Ioaj0wO2o8aztqKyspaWYoaT1oW2pdLGM9bVtpLmNvbF0sZz1wW2kuY29sXSxpPWVbaS50eXBlKyItIitpLmRpcl18fGVbInN0cmluZy0iK2kuZGlyXSxjPWkoYyxnKSwwIT09YylyZXR1cm4gYztjPWRbYV07Cmc9ZFtiXTtyZXR1cm4gYzxnPy0xOmM+Zz8xOjB9KX1hLmJTb3J0ZWQ9ITB9ZnVuY3Rpb24gSmIoYSl7Zm9yKHZhciBiLGMsZD1hLmFvQ29sdW1ucyxlPVcoYSksYT1hLm9MYW5ndWFnZS5vQXJpYSxmPTAsZz1kLmxlbmd0aDtmPGc7ZisrKXtjPWRbZl07dmFyIGo9Yy5hc1NvcnRpbmc7Yj1jLnNUaXRsZS5yZXBsYWNlKC88Lio/Pi9nLCIiKTt2YXIgaT1jLm5UaDtpLnJlbW92ZUF0dHJpYnV0ZSgiYXJpYS1zb3J0Iik7Yy5iU29ydGFibGUmJigwPGUubGVuZ3RoJiZlWzBdLmNvbD09Zj8oaS5zZXRBdHRyaWJ1dGUoImFyaWEtc29ydCIsImFzYyI9PWVbMF0uZGlyPyJhc2NlbmRpbmciOiJkZXNjZW5kaW5nIiksYz1qW2VbMF0uaW5kZXgrMV18fGpbMF0pOmM9alswXSxiKz0iYXNjIj09PWM/YS5zU29ydEFzY2VuZGluZzphLnNTb3J0RGVzY2VuZGluZyk7aS5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLGIpfX1mdW5jdGlvbiBWYShhLGIsYyxkKXt2YXIgZT1hLmFhU29ydGluZyxmPWEuYW9Db2x1bW5zW2JdLmFzU29ydGluZywKZz1mdW5jdGlvbihhLGIpe3ZhciBjPWEuX2lkeDtjPT09ayYmKGM9aC5pbkFycmF5KGFbMV0sZikpO3JldHVybiBjKzE8Zi5sZW5ndGg/YysxOmI/bnVsbDowfTsibnVtYmVyIj09PXR5cGVvZiBlWzBdJiYoZT1hLmFhU29ydGluZz1bZV0pO2MmJmEub0ZlYXR1cmVzLmJTb3J0TXVsdGk/KGM9aC5pbkFycmF5KGIsRihlLCIwIikpLC0xIT09Yz8oYj1nKGVbY10sITApLG51bGw9PT1iJiYxPT09ZS5sZW5ndGgmJihiPTApLG51bGw9PT1iP2Uuc3BsaWNlKGMsMSk6KGVbY11bMV09ZltiXSxlW2NdLl9pZHg9YikpOihlLnB1c2goW2IsZlswXSwwXSksZVtlLmxlbmd0aC0xXS5faWR4PTApKTplLmxlbmd0aCYmZVswXVswXT09Yj8oYj1nKGVbMF0pLGUubGVuZ3RoPTEsZVswXVsxXT1mW2JdLGVbMF0uX2lkeD1iKTooZS5sZW5ndGg9MCxlLnB1c2goW2IsZlswXV0pLGVbMF0uX2lkeD0wKTtUKGEpOyJmdW5jdGlvbiI9PXR5cGVvZiBkJiZkKGEpfWZ1bmN0aW9uIE9hKGEsYixjLGQpe3ZhciBlPQphLmFvQ29sdW1uc1tjXTtXYShiLHt9LGZ1bmN0aW9uKGIpeyExIT09ZS5iU29ydGFibGUmJihhLm9GZWF0dXJlcy5iUHJvY2Vzc2luZz8oQyhhLCEwKSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7VmEoYSxjLGIuc2hpZnRLZXksZCk7InNzcCIhPT15KGEpJiZDKGEsITEpfSwwKSk6VmEoYSxjLGIuc2hpZnRLZXksZCkpfSl9ZnVuY3Rpb24geGEoYSl7dmFyIGI9YS5hTGFzdFNvcnQsYz1hLm9DbGFzc2VzLnNTb3J0Q29sdW1uLGQ9VyhhKSxlPWEub0ZlYXR1cmVzLGYsZztpZihlLmJTb3J0JiZlLmJTb3J0Q2xhc3Nlcyl7ZT0wO2ZvcihmPWIubGVuZ3RoO2U8ZjtlKyspZz1iW2VdLnNyYyxoKEYoYS5hb0RhdGEsImFuQ2VsbHMiLGcpKS5yZW1vdmVDbGFzcyhjKygyPmU/ZSsxOjMpKTtlPTA7Zm9yKGY9ZC5sZW5ndGg7ZTxmO2UrKylnPWRbZV0uc3JjLGgoRihhLmFvRGF0YSwiYW5DZWxscyIsZykpLmFkZENsYXNzKGMrKDI+ZT9lKzE6MykpfWEuYUxhc3RTb3J0PWR9ZnVuY3Rpb24gSWIoYSwKYil7dmFyIGM9YS5hb0NvbHVtbnNbYl0sZD1tLmV4dC5vcmRlcltjLnNTb3J0RGF0YVR5cGVdLGU7ZCYmKGU9ZC5jYWxsKGEub0luc3RhbmNlLGEsYiwkKGEsYikpKTtmb3IodmFyIGYsZz1tLmV4dC50eXBlLm9yZGVyW2Muc1R5cGUrIi1wcmUiXSxqPTAsaT1hLmFvRGF0YS5sZW5ndGg7ajxpO2orKylpZihjPWEuYW9EYXRhW2pdLGMuX2FTb3J0RGF0YXx8KGMuX2FTb3J0RGF0YT1bXSksIWMuX2FTb3J0RGF0YVtiXXx8ZClmPWQ/ZVtqXTpCKGEsaixiLCJzb3J0IiksYy5fYVNvcnREYXRhW2JdPWc/ZyhmKTpmfWZ1bmN0aW9uIHlhKGEpe2lmKGEub0ZlYXR1cmVzLmJTdGF0ZVNhdmUmJiFhLmJEZXN0cm95aW5nKXt2YXIgYj17dGltZTorbmV3IERhdGUsc3RhcnQ6YS5faURpc3BsYXlTdGFydCxsZW5ndGg6YS5faURpc3BsYXlMZW5ndGgsb3JkZXI6aC5leHRlbmQoITAsW10sYS5hYVNvcnRpbmcpLHNlYXJjaDpBYihhLm9QcmV2aW91c1NlYXJjaCksY29sdW1uczpoLm1hcChhLmFvQ29sdW1ucywKZnVuY3Rpb24oYixkKXtyZXR1cm57dmlzaWJsZTpiLmJWaXNpYmxlLHNlYXJjaDpBYihhLmFvUHJlU2VhcmNoQ29sc1tkXSl9fSl9O3UoYSwiYW9TdGF0ZVNhdmVQYXJhbXMiLCJzdGF0ZVNhdmVQYXJhbXMiLFthLGJdKTthLm9TYXZlZFN0YXRlPWI7YS5mblN0YXRlU2F2ZUNhbGxiYWNrLmNhbGwoYS5vSW5zdGFuY2UsYSxiKX19ZnVuY3Rpb24gS2IoYSl7dmFyIGIsYyxkPWEuYW9Db2x1bW5zO2lmKGEub0ZlYXR1cmVzLmJTdGF0ZVNhdmUpe3ZhciBlPWEuZm5TdGF0ZUxvYWRDYWxsYmFjay5jYWxsKGEub0luc3RhbmNlLGEpO2lmKGUmJmUudGltZSYmKGI9dShhLCJhb1N0YXRlTG9hZFBhcmFtcyIsInN0YXRlTG9hZFBhcmFtcyIsW2EsZV0pLC0xPT09aC5pbkFycmF5KCExLGIpJiYoYj1hLmlTdGF0ZUR1cmF0aW9uLCEoMDxiJiZlLnRpbWU8K25ldyBEYXRlLTFFMypiKSYmZC5sZW5ndGg9PT1lLmNvbHVtbnMubGVuZ3RoKSkpe2Eub0xvYWRlZFN0YXRlPWguZXh0ZW5kKCEwLHt9LGUpOwplLnN0YXJ0IT09ayYmKGEuX2lEaXNwbGF5U3RhcnQ9ZS5zdGFydCxhLmlJbml0RGlzcGxheVN0YXJ0PWUuc3RhcnQpO2UubGVuZ3RoIT09ayYmKGEuX2lEaXNwbGF5TGVuZ3RoPWUubGVuZ3RoKTtlLm9yZGVyIT09ayYmKGEuYWFTb3J0aW5nPVtdLGguZWFjaChlLm9yZGVyLGZ1bmN0aW9uKGIsYyl7YS5hYVNvcnRpbmcucHVzaChjWzBdPj1kLmxlbmd0aD9bMCxjWzFdXTpjKX0pKTtlLnNlYXJjaCE9PWsmJmguZXh0ZW5kKGEub1ByZXZpb3VzU2VhcmNoLEJiKGUuc2VhcmNoKSk7Yj0wO2ZvcihjPWUuY29sdW1ucy5sZW5ndGg7YjxjO2IrKyl7dmFyIGY9ZS5jb2x1bW5zW2JdO2YudmlzaWJsZSE9PWsmJihkW2JdLmJWaXNpYmxlPWYudmlzaWJsZSk7Zi5zZWFyY2ghPT1rJiZoLmV4dGVuZChhLmFvUHJlU2VhcmNoQ29sc1tiXSxCYihmLnNlYXJjaCkpfXUoYSwiYW9TdGF0ZUxvYWRlZCIsInN0YXRlTG9hZGVkIixbYSxlXSl9fX1mdW5jdGlvbiB6YShhKXt2YXIgYj1tLnNldHRpbmdzLGE9CmguaW5BcnJheShhLEYoYiwiblRhYmxlIikpO3JldHVybi0xIT09YT9iW2FdOm51bGx9ZnVuY3Rpb24gTChhLGIsYyxkKXtjPSJEYXRhVGFibGVzIHdhcm5pbmc6ICIrKGE/InRhYmxlIGlkPSIrYS5zVGFibGVJZCsiIC0gIjoiIikrYztkJiYoYys9Ii4gRm9yIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBlcnJvciwgcGxlYXNlIHNlZSBodHRwOi8vZGF0YXRhYmxlcy5uZXQvdG4vIitkKTtpZihiKUQuY29uc29sZSYmY29uc29sZS5sb2cmJmNvbnNvbGUubG9nKGMpO2Vsc2UgaWYoYj1tLmV4dCxiPWIuc0Vyck1vZGV8fGIuZXJyTW9kZSxhJiZ1KGEsbnVsbCwiZXJyb3IiLFthLGQsY10pLCJhbGVydCI9PWIpYWxlcnQoYyk7ZWxzZXtpZigidGhyb3ciPT1iKXRocm93IEVycm9yKGMpOyJmdW5jdGlvbiI9PXR5cGVvZiBiJiZiKGEsZCxjKX19ZnVuY3Rpb24gRShhLGIsYyxkKXtoLmlzQXJyYXkoYyk/aC5lYWNoKGMsZnVuY3Rpb24oYyxkKXtoLmlzQXJyYXkoZCk/RShhLGIsZFswXSwKZFsxXSk6RShhLGIsZCl9KTooZD09PWsmJihkPWMpLGJbY10hPT1rJiYoYVtkXT1iW2NdKSl9ZnVuY3Rpb24gTGIoYSxiLGMpe3ZhciBkLGU7Zm9yKGUgaW4gYiliLmhhc093blByb3BlcnR5KGUpJiYoZD1iW2VdLGguaXNQbGFpbk9iamVjdChkKT8oaC5pc1BsYWluT2JqZWN0KGFbZV0pfHwoYVtlXT17fSksaC5leHRlbmQoITAsYVtlXSxkKSk6YVtlXT1jJiYiZGF0YSIhPT1lJiYiYWFEYXRhIiE9PWUmJmguaXNBcnJheShkKT9kLnNsaWNlKCk6ZCk7cmV0dXJuIGF9ZnVuY3Rpb24gV2EoYSxiLGMpe2goYSkuYmluZCgiY2xpY2suRFQiLGIsZnVuY3Rpb24oYil7YS5ibHVyKCk7YyhiKX0pLmJpbmQoImtleXByZXNzLkRUIixiLGZ1bmN0aW9uKGEpezEzPT09YS53aGljaCYmKGEucHJldmVudERlZmF1bHQoKSxjKGEpKX0pLmJpbmQoInNlbGVjdHN0YXJ0LkRUIixmdW5jdGlvbigpe3JldHVybiExfSl9ZnVuY3Rpb24geihhLGIsYyxkKXtjJiZhW2JdLnB1c2goe2ZuOmMsc05hbWU6ZH0pfQpmdW5jdGlvbiB1KGEsYixjLGQpe3ZhciBlPVtdO2ImJihlPWgubWFwKGFbYl0uc2xpY2UoKS5yZXZlcnNlKCksZnVuY3Rpb24oYil7cmV0dXJuIGIuZm4uYXBwbHkoYS5vSW5zdGFuY2UsZCl9KSk7bnVsbCE9PWMmJihiPWguRXZlbnQoYysiLmR0IiksaChhLm5UYWJsZSkudHJpZ2dlcihiLGQpLGUucHVzaChiLnJlc3VsdCkpO3JldHVybiBlfWZ1bmN0aW9uIFNhKGEpe3ZhciBiPWEuX2lEaXNwbGF5U3RhcnQsYz1hLmZuRGlzcGxheUVuZCgpLGQ9YS5faURpc3BsYXlMZW5ndGg7Yj49YyYmKGI9Yy1kKTtiLT1iJWQ7aWYoLTE9PT1kfHwwPmIpYj0wO2EuX2lEaXNwbGF5U3RhcnQ9Yn1mdW5jdGlvbiBQYShhLGIpe3ZhciBjPWEucmVuZGVyZXIsZD1tLmV4dC5yZW5kZXJlcltiXTtyZXR1cm4gaC5pc1BsYWluT2JqZWN0KGMpJiZjW2JdP2RbY1tiXV18fGQuXzoic3RyaW5nIj09PXR5cGVvZiBjP2RbY118fGQuXzpkLl99ZnVuY3Rpb24geShhKXtyZXR1cm4gYS5vRmVhdHVyZXMuYlNlcnZlclNpZGU/CiJzc3AiOmEuYWpheHx8YS5zQWpheFNvdXJjZT8iYWpheCI6ImRvbSJ9ZnVuY3Rpb24gQWEoYSxiKXt2YXIgYz1bXSxjPU1iLm51bWJlcnNfbGVuZ3RoLGQ9TWF0aC5mbG9vcihjLzIpO2I8PWM/Yz1YKDAsYik6YTw9ZD8oYz1YKDAsYy0yKSxjLnB1c2goImVsbGlwc2lzIiksYy5wdXNoKGItMSkpOihhPj1iLTEtZD9jPVgoYi0oYy0yKSxiKTooYz1YKGEtZCsyLGErZC0xKSxjLnB1c2goImVsbGlwc2lzIiksYy5wdXNoKGItMSkpLGMuc3BsaWNlKDAsMCwiZWxsaXBzaXMiKSxjLnNwbGljZSgwLDAsMCkpO2MuRFRfZWw9InNwYW4iO3JldHVybiBjfWZ1bmN0aW9uIGRiKGEpe2guZWFjaCh7bnVtOmZ1bmN0aW9uKGIpe3JldHVybiBCYShiLGEpfSwibnVtLWZtdCI6ZnVuY3Rpb24oYil7cmV0dXJuIEJhKGIsYSxYYSl9LCJodG1sLW51bSI6ZnVuY3Rpb24oYil7cmV0dXJuIEJhKGIsYSxDYSl9LCJodG1sLW51bS1mbXQiOmZ1bmN0aW9uKGIpe3JldHVybiBCYShiLGEsQ2EsWGEpfX0sZnVuY3Rpb24oYiwKYyl7di50eXBlLm9yZGVyW2IrYSsiLXByZSJdPWM7Yi5tYXRjaCgvXmh0bWxcLS8pJiYodi50eXBlLnNlYXJjaFtiK2FdPXYudHlwZS5zZWFyY2guaHRtbCl9KX1mdW5jdGlvbiBOYihhKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYj1bemEodGhpc1ttLmV4dC5pQXBpSW5kZXhdKV0uY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykpO3JldHVybiBtLmV4dC5pbnRlcm5hbFthXS5hcHBseSh0aGlzLGIpfX12YXIgbSx2LHIscCxzLFlhPXt9LE9iPS9bXHJcbl0vZyxDYT0vPC4qPz4vZyxiYz0vXltcd1wrXC1dLyxjYz0vW1x3XCtcLV0kLyxaYj1SZWdFeHAoIihcXC98XFwufFxcKnxcXCt8XFw/fFxcfHxcXCh8XFwpfFxcW3xcXF18XFx7fFxcfXxcXFxcfFxcJHxcXF58XFwtKSIsImciKSxYYT0vWycsJMKj4oKswqUlXHUyMDA5XHUyMDJGXHUyMEJEXHUyMGE5XHUyMEJBcmZrXS9naSxNPWZ1bmN0aW9uKGEpe3JldHVybiFhfHwhMD09PWF8fCItIj09PWE/ITA6ITF9LApQYj1mdW5jdGlvbihhKXt2YXIgYj1wYXJzZUludChhLDEwKTtyZXR1cm4haXNOYU4oYikmJmlzRmluaXRlKGEpP2I6bnVsbH0sUWI9ZnVuY3Rpb24oYSxiKXtZYVtiXXx8KFlhW2JdPVJlZ0V4cCh2YShiKSwiZyIpKTtyZXR1cm4ic3RyaW5nIj09PXR5cGVvZiBhJiYiLiIhPT1iP2EucmVwbGFjZSgvXC4vZywiIikucmVwbGFjZShZYVtiXSwiLiIpOmF9LFphPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD0ic3RyaW5nIj09PXR5cGVvZiBhO2lmKE0oYSkpcmV0dXJuITA7YiYmZCYmKGE9UWIoYSxiKSk7YyYmZCYmKGE9YS5yZXBsYWNlKFhhLCIiKSk7cmV0dXJuIWlzTmFOKHBhcnNlRmxvYXQoYSkpJiZpc0Zpbml0ZShhKX0sUmI9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBNKGEpPyEwOiEoTShhKXx8InN0cmluZyI9PT10eXBlb2YgYSk/bnVsbDpaYShhLnJlcGxhY2UoQ2EsIiIpLGIsYyk/ITA6bnVsbH0sRj1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9W10sZT0wLGY9YS5sZW5ndGg7aWYoYyE9PWspZm9yKDtlPApmO2UrKylhW2VdJiZhW2VdW2JdJiZkLnB1c2goYVtlXVtiXVtjXSk7ZWxzZSBmb3IoO2U8ZjtlKyspYVtlXSYmZC5wdXNoKGFbZV1bYl0pO3JldHVybiBkfSxoYT1mdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1bXSxmPTAsZz1iLmxlbmd0aDtpZihkIT09aylmb3IoO2Y8ZztmKyspYVtiW2ZdXVtjXSYmZS5wdXNoKGFbYltmXV1bY11bZF0pO2Vsc2UgZm9yKDtmPGc7ZisrKWUucHVzaChhW2JbZl1dW2NdKTtyZXR1cm4gZX0sWD1mdW5jdGlvbihhLGIpe3ZhciBjPVtdLGQ7Yj09PWs/KGI9MCxkPWEpOihkPWIsYj1hKTtmb3IodmFyIGU9YjtlPGQ7ZSsrKWMucHVzaChlKTtyZXR1cm4gY30sU2I9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPVtdLGM9MCxkPWEubGVuZ3RoO2M8ZDtjKyspYVtjXSYmYi5wdXNoKGFbY10pO3JldHVybiBifSxwYT1mdW5jdGlvbihhKXt2YXIgYj1bXSxjLGQsZT1hLmxlbmd0aCxmLGc9MDtkPTA7YTpmb3IoO2Q8ZTtkKyspe2M9YVtkXTtmb3IoZj0wO2Y8ZztmKyspaWYoYltmXT09PQpjKWNvbnRpbnVlIGE7Yi5wdXNoKGMpO2crK31yZXR1cm4gYn0sQT1mdW5jdGlvbihhLGIsYyl7YVtiXSE9PWsmJihhW2NdPWFbYl0pfSxiYT0vXFsuKj9cXSQvLFY9L1woXCkkLyx3YT1oKCI8ZGl2PiIpWzBdLCRiPXdhLnRleHRDb250ZW50IT09ayxhYz0vPC4qPz4vZzttPWZ1bmN0aW9uKGEpe3RoaXMuJD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmFwaSghMCkuJChhLGIpfTt0aGlzLl89ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5hcGkoITApLnJvd3MoYSxiKS5kYXRhKCl9O3RoaXMuYXBpPWZ1bmN0aW9uKGEpe3JldHVybiBhP25ldyByKHphKHRoaXNbdi5pQXBpSW5kZXhdKSk6bmV3IHIodGhpcyl9O3RoaXMuZm5BZGREYXRhPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5hcGkoITApLGQ9aC5pc0FycmF5KGEpJiYoaC5pc0FycmF5KGFbMF0pfHxoLmlzUGxhaW5PYmplY3QoYVswXSkpP2Mucm93cy5hZGQoYSk6Yy5yb3cuYWRkKGEpOyhiPT09a3x8YikmJmMuZHJhdygpO3JldHVybiBkLmZsYXR0ZW4oKS50b0FycmF5KCl9Owp0aGlzLmZuQWRqdXN0Q29sdW1uU2l6aW5nPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYXBpKCEwKS5jb2x1bW5zLmFkanVzdCgpLGM9Yi5zZXR0aW5ncygpWzBdLGQ9Yy5vU2Nyb2xsO2E9PT1rfHxhP2IuZHJhdyghMSk6KCIiIT09ZC5zWHx8IiIhPT1kLnNZKSYma2EoYyl9O3RoaXMuZm5DbGVhclRhYmxlPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYXBpKCEwKS5jbGVhcigpOyhhPT09a3x8YSkmJmIuZHJhdygpfTt0aGlzLmZuQ2xvc2U9ZnVuY3Rpb24oYSl7dGhpcy5hcGkoITApLnJvdyhhKS5jaGlsZC5oaWRlKCl9O3RoaXMuZm5EZWxldGVSb3c9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMuYXBpKCEwKSxhPWQucm93cyhhKSxlPWEuc2V0dGluZ3MoKVswXSxoPWUuYW9EYXRhW2FbMF1bMF1dO2EucmVtb3ZlKCk7YiYmYi5jYWxsKHRoaXMsZSxoKTsoYz09PWt8fGMpJiZkLmRyYXcoKTtyZXR1cm4gaH07dGhpcy5mbkRlc3Ryb3k9ZnVuY3Rpb24oYSl7dGhpcy5hcGkoITApLmRlc3Ryb3koYSl9Owp0aGlzLmZuRHJhdz1mdW5jdGlvbihhKXt0aGlzLmFwaSghMCkuZHJhdyhhKX07dGhpcy5mbkZpbHRlcj1mdW5jdGlvbihhLGIsYyxkLGUsaCl7ZT10aGlzLmFwaSghMCk7bnVsbD09PWJ8fGI9PT1rP2Uuc2VhcmNoKGEsYyxkLGgpOmUuY29sdW1uKGIpLnNlYXJjaChhLGMsZCxoKTtlLmRyYXcoKX07dGhpcy5mbkdldERhdGE9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmFwaSghMCk7aWYoYSE9PWspe3ZhciBkPWEubm9kZU5hbWU/YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOiIiO3JldHVybiBiIT09a3x8InRkIj09ZHx8InRoIj09ZD9jLmNlbGwoYSxiKS5kYXRhKCk6Yy5yb3coYSkuZGF0YSgpfHxudWxsfXJldHVybiBjLmRhdGEoKS50b0FycmF5KCl9O3RoaXMuZm5HZXROb2Rlcz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmFwaSghMCk7cmV0dXJuIGEhPT1rP2Iucm93KGEpLm5vZGUoKTpiLnJvd3MoKS5ub2RlcygpLmZsYXR0ZW4oKS50b0FycmF5KCl9O3RoaXMuZm5HZXRQb3NpdGlvbj0KZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hcGkoITApLGM9YS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpO3JldHVybiJUUiI9PWM/Yi5yb3coYSkuaW5kZXgoKToiVEQiPT1jfHwiVEgiPT1jPyhhPWIuY2VsbChhKS5pbmRleCgpLFthLnJvdyxhLmNvbHVtblZpc2libGUsYS5jb2x1bW5dKTpudWxsfTt0aGlzLmZuSXNPcGVuPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmFwaSghMCkucm93KGEpLmNoaWxkLmlzU2hvd24oKX07dGhpcy5mbk9wZW49ZnVuY3Rpb24oYSxiLGMpe3JldHVybiB0aGlzLmFwaSghMCkucm93KGEpLmNoaWxkKGIsYykuc2hvdygpLmNoaWxkKClbMF19O3RoaXMuZm5QYWdlQ2hhbmdlPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5hcGkoITApLnBhZ2UoYSk7KGI9PT1rfHxiKSYmYy5kcmF3KCExKX07dGhpcy5mblNldENvbHVtblZpcz1mdW5jdGlvbihhLGIsYyl7YT10aGlzLmFwaSghMCkuY29sdW1uKGEpLnZpc2libGUoYik7KGM9PT1rfHxjKSYmYS5jb2x1bW5zLmFkanVzdCgpLmRyYXcoKX07CnRoaXMuZm5TZXR0aW5ncz1mdW5jdGlvbigpe3JldHVybiB6YSh0aGlzW3YuaUFwaUluZGV4XSl9O3RoaXMuZm5Tb3J0PWZ1bmN0aW9uKGEpe3RoaXMuYXBpKCEwKS5vcmRlcihhKS5kcmF3KCl9O3RoaXMuZm5Tb3J0TGlzdGVuZXI9ZnVuY3Rpb24oYSxiLGMpe3RoaXMuYXBpKCEwKS5vcmRlci5saXN0ZW5lcihhLGIsYyl9O3RoaXMuZm5VcGRhdGU9ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgaD10aGlzLmFwaSghMCk7Yz09PWt8fG51bGw9PT1jP2gucm93KGIpLmRhdGEoYSk6aC5jZWxsKGIsYykuZGF0YShhKTsoZT09PWt8fGUpJiZoLmNvbHVtbnMuYWRqdXN0KCk7KGQ9PT1rfHxkKSYmaC5kcmF3KCk7cmV0dXJuIDB9O3RoaXMuZm5WZXJzaW9uQ2hlY2s9di5mblZlcnNpb25DaGVjazt2YXIgYj10aGlzLGM9YT09PWssZD10aGlzLmxlbmd0aDtjJiYoYT17fSk7dGhpcy5vQXBpPXRoaXMuaW50ZXJuYWw9di5pbnRlcm5hbDtmb3IodmFyIGUgaW4gbS5leHQuaW50ZXJuYWwpZSYmKHRoaXNbZV09Ck5iKGUpKTt0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZT17fSxlPTE8ZD9MYihlLGEsITApOmEsZz0wLGosaT10aGlzLmdldEF0dHJpYnV0ZSgiaWQiKSxuPSExLGw9bS5kZWZhdWx0cyxxPWgodGhpcyk7aWYoInRhYmxlIiE9dGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKUwobnVsbCwwLCJOb24tdGFibGUgbm9kZSBpbml0aWFsaXNhdGlvbiAoIit0aGlzLm5vZGVOYW1lKyIpIiwyKTtlbHNle2ViKGwpO2ZiKGwuY29sdW1uKTtLKGwsbCwhMCk7SyhsLmNvbHVtbixsLmNvbHVtbiwhMCk7SyhsLGguZXh0ZW5kKGUscS5kYXRhKCkpKTt2YXIgdD1tLnNldHRpbmdzLGc9MDtmb3Ioaj10Lmxlbmd0aDtnPGo7ZysrKXt2YXIgcD10W2ddO2lmKHAublRhYmxlPT10aGlzfHxwLm5USGVhZC5wYXJlbnROb2RlPT10aGlzfHxwLm5URm9vdCYmcC5uVEZvb3QucGFyZW50Tm9kZT09dGhpcyl7Zz1lLmJSZXRyaWV2ZSE9PWs/ZS5iUmV0cmlldmU6bC5iUmV0cmlldmU7aWYoY3x8ZylyZXR1cm4gcC5vSW5zdGFuY2U7CmlmKGUuYkRlc3Ryb3khPT1rP2UuYkRlc3Ryb3k6bC5iRGVzdHJveSl7cC5vSW5zdGFuY2UuZm5EZXN0cm95KCk7YnJlYWt9ZWxzZXtMKHAsMCwiQ2Fubm90IHJlaW5pdGlhbGlzZSBEYXRhVGFibGUiLDMpO3JldHVybn19aWYocC5zVGFibGVJZD09dGhpcy5pZCl7dC5zcGxpY2UoZywxKTticmVha319aWYobnVsbD09PWl8fCIiPT09aSl0aGlzLmlkPWk9IkRhdGFUYWJsZXNfVGFibGVfIittLmV4dC5fdW5pcXVlKys7dmFyIG89aC5leHRlbmQoITAse30sbS5tb2RlbHMub1NldHRpbmdzLHtzRGVzdHJveVdpZHRoOnFbMF0uc3R5bGUud2lkdGgsc0luc3RhbmNlOmksc1RhYmxlSWQ6aX0pO28ublRhYmxlPXRoaXM7by5vQXBpPWIuaW50ZXJuYWw7by5vSW5pdD1lO3QucHVzaChvKTtvLm9JbnN0YW5jZT0xPT09Yi5sZW5ndGg/YjpxLmRhdGFUYWJsZSgpO2ViKGUpO2Uub0xhbmd1YWdlJiZGYShlLm9MYW5ndWFnZSk7ZS5hTGVuZ3RoTWVudSYmIWUuaURpc3BsYXlMZW5ndGgmJihlLmlEaXNwbGF5TGVuZ3RoPQpoLmlzQXJyYXkoZS5hTGVuZ3RoTWVudVswXSk/ZS5hTGVuZ3RoTWVudVswXVswXTplLmFMZW5ndGhNZW51WzBdKTtlPUxiKGguZXh0ZW5kKCEwLHt9LGwpLGUpO0Uoby5vRmVhdHVyZXMsZSwiYlBhZ2luYXRlIGJMZW5ndGhDaGFuZ2UgYkZpbHRlciBiU29ydCBiU29ydE11bHRpIGJJbmZvIGJQcm9jZXNzaW5nIGJBdXRvV2lkdGggYlNvcnRDbGFzc2VzIGJTZXJ2ZXJTaWRlIGJEZWZlclJlbmRlciIuc3BsaXQoIiAiKSk7RShvLGUsWyJhc1N0cmlwZUNsYXNzZXMiLCJhamF4IiwiZm5TZXJ2ZXJEYXRhIiwiZm5Gb3JtYXROdW1iZXIiLCJzU2VydmVyTWV0aG9kIiwiYWFTb3J0aW5nIiwiYWFTb3J0aW5nRml4ZWQiLCJhTGVuZ3RoTWVudSIsInNQYWdpbmF0aW9uVHlwZSIsInNBamF4U291cmNlIiwic0FqYXhEYXRhUHJvcCIsImlTdGF0ZUR1cmF0aW9uIiwic0RvbSIsImJTb3J0Q2VsbHNUb3AiLCJpVGFiSW5kZXgiLCJmblN0YXRlTG9hZENhbGxiYWNrIiwiZm5TdGF0ZVNhdmVDYWxsYmFjayIsCiJyZW5kZXJlciIsInNlYXJjaERlbGF5Iiwicm93SWQiLFsiaUNvb2tpZUR1cmF0aW9uIiwiaVN0YXRlRHVyYXRpb24iXSxbIm9TZWFyY2giLCJvUHJldmlvdXNTZWFyY2giXSxbImFvU2VhcmNoQ29scyIsImFvUHJlU2VhcmNoQ29scyJdLFsiaURpc3BsYXlMZW5ndGgiLCJfaURpc3BsYXlMZW5ndGgiXSxbImJKUXVlcnlVSSIsImJKVUkiXV0pO0Uoby5vU2Nyb2xsLGUsW1sic1Njcm9sbFgiLCJzWCJdLFsic1Njcm9sbFhJbm5lciIsInNYSW5uZXIiXSxbInNTY3JvbGxZIiwic1kiXSxbImJTY3JvbGxDb2xsYXBzZSIsImJDb2xsYXBzZSJdXSk7RShvLm9MYW5ndWFnZSxlLCJmbkluZm9DYWxsYmFjayIpO3oobywiYW9EcmF3Q2FsbGJhY2siLGUuZm5EcmF3Q2FsbGJhY2ssInVzZXIiKTt6KG8sImFvU2VydmVyUGFyYW1zIixlLmZuU2VydmVyUGFyYW1zLCJ1c2VyIik7eihvLCJhb1N0YXRlU2F2ZVBhcmFtcyIsZS5mblN0YXRlU2F2ZVBhcmFtcywidXNlciIpO3oobywiYW9TdGF0ZUxvYWRQYXJhbXMiLAplLmZuU3RhdGVMb2FkUGFyYW1zLCJ1c2VyIik7eihvLCJhb1N0YXRlTG9hZGVkIixlLmZuU3RhdGVMb2FkZWQsInVzZXIiKTt6KG8sImFvUm93Q2FsbGJhY2siLGUuZm5Sb3dDYWxsYmFjaywidXNlciIpO3oobywiYW9Sb3dDcmVhdGVkQ2FsbGJhY2siLGUuZm5DcmVhdGVkUm93LCJ1c2VyIik7eihvLCJhb0hlYWRlckNhbGxiYWNrIixlLmZuSGVhZGVyQ2FsbGJhY2ssInVzZXIiKTt6KG8sImFvRm9vdGVyQ2FsbGJhY2siLGUuZm5Gb290ZXJDYWxsYmFjaywidXNlciIpO3oobywiYW9Jbml0Q29tcGxldGUiLGUuZm5Jbml0Q29tcGxldGUsInVzZXIiKTt6KG8sImFvUHJlRHJhd0NhbGxiYWNrIixlLmZuUHJlRHJhd0NhbGxiYWNrLCJ1c2VyIik7by5yb3dJZEZuPVEoZS5yb3dJZCk7Z2Iobyk7aT1vLm9DbGFzc2VzO2UuYkpRdWVyeVVJPyhoLmV4dGVuZChpLG0uZXh0Lm9KVUlDbGFzc2VzLGUub0NsYXNzZXMpLGUuc0RvbT09PWwuc0RvbSYmImxmcnRpcCI9PT1sLnNEb20mJihvLnNEb209Cic8IkgibGZyPnQ8IkYiaXA+Jyksby5yZW5kZXJlcik/aC5pc1BsYWluT2JqZWN0KG8ucmVuZGVyZXIpJiYhby5yZW5kZXJlci5oZWFkZXImJihvLnJlbmRlcmVyLmhlYWRlcj0ianF1ZXJ5dWkiKTpvLnJlbmRlcmVyPSJqcXVlcnl1aSI6aC5leHRlbmQoaSxtLmV4dC5jbGFzc2VzLGUub0NsYXNzZXMpO3EuYWRkQ2xhc3MoaS5zVGFibGUpO28uaUluaXREaXNwbGF5U3RhcnQ9PT1rJiYoby5pSW5pdERpc3BsYXlTdGFydD1lLmlEaXNwbGF5U3RhcnQsby5faURpc3BsYXlTdGFydD1lLmlEaXNwbGF5U3RhcnQpO251bGwhPT1lLmlEZWZlckxvYWRpbmcmJihvLmJEZWZlckxvYWRpbmc9ITAsZz1oLmlzQXJyYXkoZS5pRGVmZXJMb2FkaW5nKSxvLl9pUmVjb3Jkc0Rpc3BsYXk9Zz9lLmlEZWZlckxvYWRpbmdbMF06ZS5pRGVmZXJMb2FkaW5nLG8uX2lSZWNvcmRzVG90YWw9Zz9lLmlEZWZlckxvYWRpbmdbMV06ZS5pRGVmZXJMb2FkaW5nKTt2YXIgcj1vLm9MYW5ndWFnZTtoLmV4dGVuZCghMCwKcixlLm9MYW5ndWFnZSk7IiIhPT1yLnNVcmwmJihoLmFqYXgoe2RhdGFUeXBlOiJqc29uIix1cmw6ci5zVXJsLHN1Y2Nlc3M6ZnVuY3Rpb24oYSl7RmEoYSk7SyhsLm9MYW5ndWFnZSxhKTtoLmV4dGVuZCh0cnVlLHIsYSk7Z2Eobyl9LGVycm9yOmZ1bmN0aW9uKCl7Z2Eobyl9fSksbj0hMCk7bnVsbD09PWUuYXNTdHJpcGVDbGFzc2VzJiYoby5hc1N0cmlwZUNsYXNzZXM9W2kuc1N0cmlwZU9kZCxpLnNTdHJpcGVFdmVuXSk7dmFyIGc9by5hc1N0cmlwZUNsYXNzZXMsdj1xLmNoaWxkcmVuKCJ0Ym9keSIpLmZpbmQoInRyIikuZXEoMCk7LTEhPT1oLmluQXJyYXkoITAsaC5tYXAoZyxmdW5jdGlvbihhKXtyZXR1cm4gdi5oYXNDbGFzcyhhKX0pKSYmKGgoInRib2R5IHRyIix0aGlzKS5yZW1vdmVDbGFzcyhnLmpvaW4oIiAiKSksby5hc0Rlc3Ryb3lTdHJpcGVzPWcuc2xpY2UoKSk7dD1bXTtnPXRoaXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRoZWFkIik7MCE9PWcubGVuZ3RoJiYoZGEoby5hb0hlYWRlciwKZ1swXSksdD1xYShvKSk7aWYobnVsbD09PWUuYW9Db2x1bW5zKXtwPVtdO2c9MDtmb3Ioaj10Lmxlbmd0aDtnPGo7ZysrKXAucHVzaChudWxsKX1lbHNlIHA9ZS5hb0NvbHVtbnM7Zz0wO2ZvcihqPXAubGVuZ3RoO2c8ajtnKyspR2Eobyx0P3RbZ106bnVsbCk7aWIobyxlLmFvQ29sdW1uRGVmcyxwLGZ1bmN0aW9uKGEsYil7amEobyxhLGIpfSk7aWYodi5sZW5ndGgpe3ZhciBzPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuZ2V0QXR0cmlidXRlKCJkYXRhLSIrYikhPT1udWxsP2I6bnVsbH07aCh2WzBdKS5jaGlsZHJlbigidGgsIHRkIikuZWFjaChmdW5jdGlvbihhLGIpe3ZhciBjPW8uYW9Db2x1bW5zW2FdO2lmKGMubURhdGE9PT1hKXt2YXIgZD1zKGIsInNvcnQiKXx8cyhiLCJvcmRlciIpLGU9cyhiLCJmaWx0ZXIiKXx8cyhiLCJzZWFyY2giKTtpZihkIT09bnVsbHx8ZSE9PW51bGwpe2MubURhdGE9e186YSsiLmRpc3BsYXkiLHNvcnQ6ZCE9PW51bGw/YSsiLkBkYXRhLSIrZDprLHR5cGU6ZCE9PQpudWxsP2ErIi5AZGF0YS0iK2Q6ayxmaWx0ZXI6ZSE9PW51bGw/YSsiLkBkYXRhLSIrZTprfTtqYShvLGEpfX19KX12YXIgdz1vLm9GZWF0dXJlcztlLmJTdGF0ZVNhdmUmJih3LmJTdGF0ZVNhdmU9ITAsS2IobyxlKSx6KG8sImFvRHJhd0NhbGxiYWNrIix5YSwic3RhdGVfc2F2ZSIpKTtpZihlLmFhU29ydGluZz09PWspe3Q9by5hYVNvcnRpbmc7Zz0wO2ZvcihqPXQubGVuZ3RoO2c8ajtnKyspdFtnXVsxXT1vLmFvQ29sdW1uc1tnXS5hc1NvcnRpbmdbMF19eGEobyk7dy5iU29ydCYmeihvLCJhb0RyYXdDYWxsYmFjayIsZnVuY3Rpb24oKXtpZihvLmJTb3J0ZWQpe3ZhciBhPVcobyksYj17fTtoLmVhY2goYSxmdW5jdGlvbihhLGMpe2JbYy5zcmNdPWMuZGlyfSk7dShvLG51bGwsIm9yZGVyIixbbyxhLGJdKTtKYihvKX19KTt6KG8sImFvRHJhd0NhbGxiYWNrIixmdW5jdGlvbigpeyhvLmJTb3J0ZWR8fHkobyk9PT0ic3NwInx8dy5iRGVmZXJSZW5kZXIpJiZ4YShvKX0sInNjIik7Zz0KcS5jaGlsZHJlbigiY2FwdGlvbiIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLl9jYXB0aW9uU2lkZT1xLmNzcygiY2FwdGlvbi1zaWRlIil9KTtqPXEuY2hpbGRyZW4oInRoZWFkIik7MD09PWoubGVuZ3RoJiYoaj1oKCI8dGhlYWQvPiIpLmFwcGVuZFRvKHRoaXMpKTtvLm5USGVhZD1qWzBdO2o9cS5jaGlsZHJlbigidGJvZHkiKTswPT09ai5sZW5ndGgmJihqPWgoIjx0Ym9keS8+IikuYXBwZW5kVG8odGhpcykpO28ublRCb2R5PWpbMF07aj1xLmNoaWxkcmVuKCJ0Zm9vdCIpO2lmKDA9PT1qLmxlbmd0aCYmMDxnLmxlbmd0aCYmKCIiIT09by5vU2Nyb2xsLnNYfHwiIiE9PW8ub1Njcm9sbC5zWSkpaj1oKCI8dGZvb3QvPiIpLmFwcGVuZFRvKHRoaXMpOzA9PT1qLmxlbmd0aHx8MD09PWouY2hpbGRyZW4oKS5sZW5ndGg/cS5hZGRDbGFzcyhpLnNOb0Zvb3Rlcik6MDxqLmxlbmd0aCYmKG8ublRGb290PWpbMF0sZGEoby5hb0Zvb3RlcixvLm5URm9vdCkpO2lmKGUuYWFEYXRhKWZvcihnPTA7ZzwKZS5hYURhdGEubGVuZ3RoO2crKylOKG8sZS5hYURhdGFbZ10pO2Vsc2Uoby5iRGVmZXJMb2FkaW5nfHwiZG9tIj09eShvKSkmJm1hKG8saChvLm5UQm9keSkuY2hpbGRyZW4oInRyIikpO28uYWlEaXNwbGF5PW8uYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7by5iSW5pdGlhbGlzZWQ9ITA7ITE9PT1uJiZnYShvKX19KTtiPW51bGw7cmV0dXJuIHRoaXN9O3ZhciBUYj1bXSx3PUFycmF5LnByb3RvdHlwZSxkYz1mdW5jdGlvbihhKXt2YXIgYixjLGQ9bS5zZXR0aW5ncyxlPWgubWFwKGQsZnVuY3Rpb24oYSl7cmV0dXJuIGEublRhYmxlfSk7aWYoYSl7aWYoYS5uVGFibGUmJmEub0FwaSlyZXR1cm5bYV07aWYoYS5ub2RlTmFtZSYmInRhYmxlIj09PWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSlyZXR1cm4gYj1oLmluQXJyYXkoYSxlKSwtMSE9PWI/W2RbYl1dOm51bGw7aWYoYSYmImZ1bmN0aW9uIj09PXR5cGVvZiBhLnNldHRpbmdzKXJldHVybiBhLnNldHRpbmdzKCkudG9BcnJheSgpOyJzdHJpbmciPT09CnR5cGVvZiBhP2M9aChhKTphIGluc3RhbmNlb2YgaCYmKGM9YSl9ZWxzZSByZXR1cm5bXTtpZihjKXJldHVybiBjLm1hcChmdW5jdGlvbigpe2I9aC5pbkFycmF5KHRoaXMsZSk7cmV0dXJuLTEhPT1iP2RbYl06bnVsbH0pLnRvQXJyYXkoKX07cj1mdW5jdGlvbihhLGIpe2lmKCEodGhpcyBpbnN0YW5jZW9mIHIpKXJldHVybiBuZXcgcihhLGIpO3ZhciBjPVtdLGQ9ZnVuY3Rpb24oYSl7KGE9ZGMoYSkpJiYoYz1jLmNvbmNhdChhKSl9O2lmKGguaXNBcnJheShhKSlmb3IodmFyIGU9MCxmPWEubGVuZ3RoO2U8ZjtlKyspZChhW2VdKTtlbHNlIGQoYSk7dGhpcy5jb250ZXh0PXBhKGMpO2ImJmgubWVyZ2UodGhpcyxiKTt0aGlzLnNlbGVjdG9yPXtyb3dzOm51bGwsY29sczpudWxsLG9wdHM6bnVsbH07ci5leHRlbmQodGhpcyx0aGlzLFRiKX07bS5BcGk9cjtoLmV4dGVuZChyLnByb3RvdHlwZSx7YW55OmZ1bmN0aW9uKCl7cmV0dXJuIDAhPT10aGlzLmNvdW50KCl9LGNvbmNhdDp3LmNvbmNhdCwKY29udGV4dDpbXSxjb3VudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZsYXR0ZW4oKS5sZW5ndGh9LGVhY2g6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPTAsYz10aGlzLmxlbmd0aDtiPGM7YisrKWEuY2FsbCh0aGlzLHRoaXNbYl0sYix0aGlzKTtyZXR1cm4gdGhpc30sZXE6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5jb250ZXh0O3JldHVybiBiLmxlbmd0aD5hP25ldyByKGJbYV0sdGhpc1thXSk6bnVsbH0sZmlsdGVyOmZ1bmN0aW9uKGEpe3ZhciBiPVtdO2lmKHcuZmlsdGVyKWI9dy5maWx0ZXIuY2FsbCh0aGlzLGEsdGhpcyk7ZWxzZSBmb3IodmFyIGM9MCxkPXRoaXMubGVuZ3RoO2M8ZDtjKyspYS5jYWxsKHRoaXMsdGhpc1tjXSxjLHRoaXMpJiZiLnB1c2godGhpc1tjXSk7cmV0dXJuIG5ldyByKHRoaXMuY29udGV4dCxiKX0sZmxhdHRlbjpmdW5jdGlvbigpe3ZhciBhPVtdO3JldHVybiBuZXcgcih0aGlzLmNvbnRleHQsYS5jb25jYXQuYXBwbHkoYSx0aGlzLnRvQXJyYXkoKSkpfSxqb2luOncuam9pbiwKaW5kZXhPZjp3LmluZGV4T2Z8fGZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPWJ8fDAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKWlmKHRoaXNbY109PT1hKXJldHVybiBjO3JldHVybi0xfSxpdGVyYXRvcjpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1bXSxmLGcsaCxpLG4sbD10aGlzLmNvbnRleHQsbSx0LHA9dGhpcy5zZWxlY3Rvcjsic3RyaW5nIj09PXR5cGVvZiBhJiYoZD1jLGM9YixiPWEsYT0hMSk7Zz0wO2ZvcihoPWwubGVuZ3RoO2c8aDtnKyspe3ZhciBvPW5ldyByKGxbZ10pO2lmKCJ0YWJsZSI9PT1iKWY9Yy5jYWxsKG8sbFtnXSxnKSxmIT09ayYmZS5wdXNoKGYpO2Vsc2UgaWYoImNvbHVtbnMiPT09Ynx8InJvd3MiPT09YilmPWMuY2FsbChvLGxbZ10sdGhpc1tnXSxnKSxmIT09ayYmZS5wdXNoKGYpO2Vsc2UgaWYoImNvbHVtbiI9PT1ifHwiY29sdW1uLXJvd3MiPT09Ynx8InJvdyI9PT1ifHwiY2VsbCI9PT1iKXt0PXRoaXNbZ107ImNvbHVtbi1yb3dzIj09PWImJihtPURhKGxbZ10sCnAub3B0cykpO2k9MDtmb3Iobj10Lmxlbmd0aDtpPG47aSsrKWY9dFtpXSxmPSJjZWxsIj09PWI/Yy5jYWxsKG8sbFtnXSxmLnJvdyxmLmNvbHVtbixnLGkpOmMuY2FsbChvLGxbZ10sZixnLGksbSksZiE9PWsmJmUucHVzaChmKX19cmV0dXJuIGUubGVuZ3RofHxkPyhhPW5ldyByKGwsYT9lLmNvbmNhdC5hcHBseShbXSxlKTplKSxiPWEuc2VsZWN0b3IsYi5yb3dzPXAucm93cyxiLmNvbHM9cC5jb2xzLGIub3B0cz1wLm9wdHMsYSk6dGhpc30sbGFzdEluZGV4T2Y6dy5sYXN0SW5kZXhPZnx8ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5pbmRleE9mLmFwcGx5KHRoaXMudG9BcnJheS5yZXZlcnNlKCksYXJndW1lbnRzKX0sbGVuZ3RoOjAsbWFwOmZ1bmN0aW9uKGEpe3ZhciBiPVtdO2lmKHcubWFwKWI9dy5tYXAuY2FsbCh0aGlzLGEsdGhpcyk7ZWxzZSBmb3IodmFyIGM9MCxkPXRoaXMubGVuZ3RoO2M8ZDtjKyspYi5wdXNoKGEuY2FsbCh0aGlzLHRoaXNbY10sYykpO3JldHVybiBuZXcgcih0aGlzLmNvbnRleHQsCmIpfSxwbHVjazpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oYil7cmV0dXJuIGJbYV19KX0scG9wOncucG9wLHB1c2g6dy5wdXNoLHJlZHVjZTp3LnJlZHVjZXx8ZnVuY3Rpb24oYSxiKXtyZXR1cm4gaGIodGhpcyxhLGIsMCx0aGlzLmxlbmd0aCwxKX0scmVkdWNlUmlnaHQ6dy5yZWR1Y2VSaWdodHx8ZnVuY3Rpb24oYSxiKXtyZXR1cm4gaGIodGhpcyxhLGIsdGhpcy5sZW5ndGgtMSwtMSwtMSl9LHJldmVyc2U6dy5yZXZlcnNlLHNlbGVjdG9yOm51bGwsc2hpZnQ6dy5zaGlmdCxzb3J0Oncuc29ydCxzcGxpY2U6dy5zcGxpY2UsdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiB3LnNsaWNlLmNhbGwodGhpcyl9LHRvJDpmdW5jdGlvbigpe3JldHVybiBoKHRoaXMpfSx0b0pRdWVyeTpmdW5jdGlvbigpe3JldHVybiBoKHRoaXMpfSx1bmlxdWU6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHIodGhpcy5jb250ZXh0LHBhKHRoaXMpKX0sdW5zaGlmdDp3LnVuc2hpZnR9KTtyLmV4dGVuZD0KZnVuY3Rpb24oYSxiLGMpe2lmKGMubGVuZ3RoJiZiJiYoYiBpbnN0YW5jZW9mIHJ8fGIuX19kdF93cmFwcGVyKSl7dmFyIGQsZSxmLGc9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmdW5jdGlvbigpe3ZhciBkPWIuYXBwbHkoYSxhcmd1bWVudHMpO3IuZXh0ZW5kKGQsZCxjLm1ldGhvZEV4dCk7cmV0dXJuIGR9fTtkPTA7Zm9yKGU9Yy5sZW5ndGg7ZDxlO2QrKylmPWNbZF0sYltmLm5hbWVdPSJmdW5jdGlvbiI9PT10eXBlb2YgZi52YWw/ZyhhLGYudmFsLGYpOmguaXNQbGFpbk9iamVjdChmLnZhbCk/e306Zi52YWwsYltmLm5hbWVdLl9fZHRfd3JhcHBlcj0hMCxyLmV4dGVuZChhLGJbZi5uYW1lXSxmLnByb3BFeHQpfX07ci5yZWdpc3Rlcj1wPWZ1bmN0aW9uKGEsYil7aWYoaC5pc0FycmF5KGEpKWZvcih2YXIgYz0wLGQ9YS5sZW5ndGg7YzxkO2MrKylyLnJlZ2lzdGVyKGFbY10sYik7ZWxzZSBmb3IodmFyIGU9YS5zcGxpdCgiLiIpLGY9VGIsZyxqLGM9MCxkPWUubGVuZ3RoO2M8ZDtjKyspe2c9CihqPS0xIT09ZVtjXS5pbmRleE9mKCIoKSIpKT9lW2NdLnJlcGxhY2UoIigpIiwiIik6ZVtjXTt2YXIgaTthOntpPTA7Zm9yKHZhciBuPWYubGVuZ3RoO2k8bjtpKyspaWYoZltpXS5uYW1lPT09Zyl7aT1mW2ldO2JyZWFrIGF9aT1udWxsfWl8fChpPXtuYW1lOmcsdmFsOnt9LG1ldGhvZEV4dDpbXSxwcm9wRXh0OltdfSxmLnB1c2goaSkpO2M9PT1kLTE/aS52YWw9YjpmPWo/aS5tZXRob2RFeHQ6aS5wcm9wRXh0fX07ci5yZWdpc3RlclBsdXJhbD1zPWZ1bmN0aW9uKGEsYixjKXtyLnJlZ2lzdGVyKGEsYyk7ci5yZWdpc3RlcihiLGZ1bmN0aW9uKCl7dmFyIGE9Yy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIGE9PT10aGlzP3RoaXM6YSBpbnN0YW5jZW9mIHI/YS5sZW5ndGg/aC5pc0FycmF5KGFbMF0pP25ldyByKGEuY29udGV4dCxhWzBdKTphWzBdOms6YX0pfTtwKCJ0YWJsZXMoKSIsZnVuY3Rpb24oYSl7dmFyIGI7aWYoYSl7Yj1yO3ZhciBjPXRoaXMuY29udGV4dDtpZigibnVtYmVyIj09PQp0eXBlb2YgYSlhPVtjW2FdXTtlbHNlIHZhciBkPWgubWFwKGMsZnVuY3Rpb24oYSl7cmV0dXJuIGEublRhYmxlfSksYT1oKGQpLmZpbHRlcihhKS5tYXAoZnVuY3Rpb24oKXt2YXIgYT1oLmluQXJyYXkodGhpcyxkKTtyZXR1cm4gY1thXX0pLnRvQXJyYXkoKTtiPW5ldyBiKGEpfWVsc2UgYj10aGlzO3JldHVybiBifSk7cCgidGFibGUoKSIsZnVuY3Rpb24oYSl7dmFyIGE9dGhpcy50YWJsZXMoYSksYj1hLmNvbnRleHQ7cmV0dXJuIGIubGVuZ3RoP25ldyByKGJbMF0pOmF9KTtzKCJ0YWJsZXMoKS5ub2RlcygpIiwidGFibGUoKS5ub2RlKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXtyZXR1cm4gYS5uVGFibGV9LDEpfSk7cygidGFibGVzKCkuYm9keSgpIiwidGFibGUoKS5ib2R5KCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXtyZXR1cm4gYS5uVEJvZHl9LDEpfSk7cygidGFibGVzKCkuaGVhZGVyKCkiLAoidGFibGUoKS5oZWFkZXIoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGEpe3JldHVybiBhLm5USGVhZH0sMSl9KTtzKCJ0YWJsZXMoKS5mb290ZXIoKSIsInRhYmxlKCkuZm9vdGVyKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXtyZXR1cm4gYS5uVEZvb3R9LDEpfSk7cygidGFibGVzKCkuY29udGFpbmVycygpIiwidGFibGUoKS5jb250YWluZXIoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGEpe3JldHVybiBhLm5UYWJsZVdyYXBwZXJ9LDEpfSk7cCgiZHJhdygpIixmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGIpeyJwYWdlIj09PWE/TyhiKTooInN0cmluZyI9PT10eXBlb2YgYSYmKGE9ImZ1bGwtaG9sZCI9PT1hPyExOiEwKSxUKGIsITE9PT1hKSl9KX0pO3AoInBhZ2UoKSIsZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT0Kaz90aGlzLnBhZ2UuaW5mbygpLnBhZ2U6dGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGIpe1RhKGIsYSl9KX0pO3AoInBhZ2UuaW5mbygpIixmdW5jdGlvbigpe2lmKDA9PT10aGlzLmNvbnRleHQubGVuZ3RoKXJldHVybiBrO3ZhciBhPXRoaXMuY29udGV4dFswXSxiPWEuX2lEaXNwbGF5U3RhcnQsYz1hLm9GZWF0dXJlcy5iUGFnaW5hdGU/YS5faURpc3BsYXlMZW5ndGg6LTEsZD1hLmZuUmVjb3Jkc0Rpc3BsYXkoKSxlPS0xPT09YztyZXR1cm57cGFnZTplPzA6TWF0aC5mbG9vcihiL2MpLHBhZ2VzOmU/MTpNYXRoLmNlaWwoZC9jKSxzdGFydDpiLGVuZDphLmZuRGlzcGxheUVuZCgpLGxlbmd0aDpjLHJlY29yZHNUb3RhbDphLmZuUmVjb3Jkc1RvdGFsKCkscmVjb3Jkc0Rpc3BsYXk6ZCxzZXJ2ZXJTaWRlOiJzc3AiPT09eShhKX19KTtwKCJwYWdlLmxlbigpIixmdW5jdGlvbihhKXtyZXR1cm4gYT09PWs/MCE9PXRoaXMuY29udGV4dC5sZW5ndGg/dGhpcy5jb250ZXh0WzBdLl9pRGlzcGxheUxlbmd0aDoKazp0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7UmEoYixhKX0pfSk7dmFyIFViPWZ1bmN0aW9uKGEsYixjKXtpZihjKXt2YXIgZD1uZXcgcihhKTtkLm9uZSgiZHJhdyIsZnVuY3Rpb24oKXtjKGQuYWpheC5qc29uKCkpfSl9aWYoInNzcCI9PXkoYSkpVChhLGIpO2Vsc2V7QyhhLCEwKTt2YXIgZT1hLmpxWEhSO2UmJjQhPT1lLnJlYWR5U3RhdGUmJmUuYWJvcnQoKTtyYShhLFtdLGZ1bmN0aW9uKGMpe25hKGEpO2Zvcih2YXIgYz1zYShhLGMpLGQ9MCxlPWMubGVuZ3RoO2Q8ZTtkKyspTihhLGNbZF0pO1QoYSxiKTtDKGEsITEpfSl9fTtwKCJhamF4Lmpzb24oKSIsZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNvbnRleHQ7aWYoMDxhLmxlbmd0aClyZXR1cm4gYVswXS5qc29ufSk7cCgiYWpheC5wYXJhbXMoKSIsZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNvbnRleHQ7aWYoMDxhLmxlbmd0aClyZXR1cm4gYVswXS5vQWpheERhdGF9KTtwKCJhamF4LnJlbG9hZCgpIixmdW5jdGlvbihhLApiKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGMpe1ViKGMsITE9PT1iLGEpfSl9KTtwKCJhamF4LnVybCgpIixmdW5jdGlvbihhKXt2YXIgYj10aGlzLmNvbnRleHQ7aWYoYT09PWspe2lmKDA9PT1iLmxlbmd0aClyZXR1cm4gaztiPWJbMF07cmV0dXJuIGIuYWpheD9oLmlzUGxhaW5PYmplY3QoYi5hamF4KT9iLmFqYXgudXJsOmIuYWpheDpiLnNBamF4U291cmNlfXJldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7aC5pc1BsYWluT2JqZWN0KGIuYWpheCk/Yi5hamF4LnVybD1hOmIuYWpheD1hfSl9KTtwKCJhamF4LnVybCgpLmxvYWQoKSIsZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGMpe1ViKGMsITE9PT1iLGEpfSl9KTt2YXIgJGE9ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZj1bXSxnLGosaSxuLGwsbTtpPXR5cGVvZiBiO2lmKCFifHwic3RyaW5nIj09PWl8fCJmdW5jdGlvbiI9PT0KaXx8Yi5sZW5ndGg9PT1rKWI9W2JdO2k9MDtmb3Iobj1iLmxlbmd0aDtpPG47aSsrKXtqPWJbaV0mJmJbaV0uc3BsaXQ/YltpXS5zcGxpdCgiLCIpOltiW2ldXTtsPTA7Zm9yKG09ai5sZW5ndGg7bDxtO2wrKykoZz1jKCJzdHJpbmciPT09dHlwZW9mIGpbbF0/aC50cmltKGpbbF0pOmpbbF0pKSYmZy5sZW5ndGgmJihmPWYuY29uY2F0KGcpKX1hPXYuc2VsZWN0b3JbYV07aWYoYS5sZW5ndGgpe2k9MDtmb3Iobj1hLmxlbmd0aDtpPG47aSsrKWY9YVtpXShkLGUsZil9cmV0dXJuIHBhKGYpfSxhYj1mdW5jdGlvbihhKXthfHwoYT17fSk7YS5maWx0ZXImJmEuc2VhcmNoPT09ayYmKGEuc2VhcmNoPWEuZmlsdGVyKTtyZXR1cm4gaC5leHRlbmQoe3NlYXJjaDoibm9uZSIsb3JkZXI6ImN1cnJlbnQiLHBhZ2U6ImFsbCJ9LGEpfSxiYj1mdW5jdGlvbihhKXtmb3IodmFyIGI9MCxjPWEubGVuZ3RoO2I8YztiKyspaWYoMDxhW2JdLmxlbmd0aClyZXR1cm4gYVswXT1hW2JdLGFbMF0ubGVuZ3RoPQoxLGEubGVuZ3RoPTEsYS5jb250ZXh0PVthLmNvbnRleHRbYl1dLGE7YS5sZW5ndGg9MDtyZXR1cm4gYX0sRGE9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZj1bXSxnPWEuYWlEaXNwbGF5O2M9YS5haURpc3BsYXlNYXN0ZXI7dmFyIGo9Yi5zZWFyY2g7ZD1iLm9yZGVyO2U9Yi5wYWdlO2lmKCJzc3AiPT15KGEpKXJldHVybiJyZW1vdmVkIj09PWo/W106WCgwLGMubGVuZ3RoKTtpZigiY3VycmVudCI9PWUpe2M9YS5faURpc3BsYXlTdGFydDtmb3IoZD1hLmZuRGlzcGxheUVuZCgpO2M8ZDtjKyspZi5wdXNoKGdbY10pfWVsc2UgaWYoImN1cnJlbnQiPT1kfHwiYXBwbGllZCI9PWQpZj0ibm9uZSI9PWo/Yy5zbGljZSgpOiJhcHBsaWVkIj09aj9nLnNsaWNlKCk6aC5tYXAoYyxmdW5jdGlvbihhKXtyZXR1cm4tMT09PWguaW5BcnJheShhLGcpP2E6bnVsbH0pO2Vsc2UgaWYoImluZGV4Ij09ZHx8Im9yaWdpbmFsIj09ZCl7Yz0wO2ZvcihkPWEuYW9EYXRhLmxlbmd0aDtjPGQ7YysrKSJub25lIj09Cmo/Zi5wdXNoKGMpOihlPWguaW5BcnJheShjLGcpLCgtMT09PWUmJiJyZW1vdmVkIj09anx8MDw9ZSYmImFwcGxpZWQiPT1qKSYmZi5wdXNoKGMpKX1yZXR1cm4gZn07cCgicm93cygpIixmdW5jdGlvbihhLGIpe2E9PT1rP2E9IiI6aC5pc1BsYWluT2JqZWN0KGEpJiYoYj1hLGE9IiIpO3ZhciBiPWFiKGIpLGM9dGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGMpe3ZhciBlPWI7cmV0dXJuICRhKCJyb3ciLGEsZnVuY3Rpb24oYSl7dmFyIGI9UGIoYSk7aWYoYiE9PW51bGwmJiFlKXJldHVybltiXTt2YXIgaj1EYShjLGUpO2lmKGIhPT1udWxsJiZoLmluQXJyYXkoYixqKSE9PS0xKXJldHVybltiXTtpZighYSlyZXR1cm4gajtpZih0eXBlb2YgYT09PSJmdW5jdGlvbiIpcmV0dXJuIGgubWFwKGosZnVuY3Rpb24oYil7dmFyIGU9Yy5hb0RhdGFbYl07cmV0dXJuIGEoYixlLl9hRGF0YSxlLm5Ucik/YjpudWxsfSk7Yj1TYihoYShjLmFvRGF0YSxqLCJuVHIiKSk7aWYoYS5ub2RlTmFtZSl7aWYoYS5fRFRfUm93SW5kZXghPT0KaylyZXR1cm5bYS5fRFRfUm93SW5kZXhdO2lmKGEuX0RUX0NlbGxJbmRleClyZXR1cm5bYS5fRFRfQ2VsbEluZGV4LnJvd107Yj1oKGEpLmNsb3Nlc3QoIipbZGF0YS1kdC1yb3ddIik7cmV0dXJuIGIubGVuZ3RoP1tiLmRhdGEoImR0LXJvdyIpXTpbXX1pZih0eXBlb2YgYT09PSJzdHJpbmciJiZhLmNoYXJBdCgwKT09PSIjIil7aj1jLmFJZHNbYS5yZXBsYWNlKC9eIy8sIiIpXTtpZihqIT09aylyZXR1cm5bai5pZHhdfXJldHVybiBoKGIpLmZpbHRlcihhKS5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fRFRfUm93SW5kZXh9KS50b0FycmF5KCl9LGMsZSl9LDEpO2Muc2VsZWN0b3Iucm93cz1hO2Muc2VsZWN0b3Iub3B0cz1iO3JldHVybiBjfSk7cCgicm93cygpLm5vZGVzKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInJvdyIsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5hb0RhdGFbYl0ublRyfHxrfSwxKX0pO3AoInJvd3MoKS5kYXRhKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoITAsCiJyb3dzIixmdW5jdGlvbihhLGIpe3JldHVybiBoYShhLmFvRGF0YSxiLCJfYURhdGEiKX0sMSl9KTtzKCJyb3dzKCkuY2FjaGUoKSIsInJvdygpLmNhY2hlKCkiLGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJyb3ciLGZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yi5hb0RhdGFbY107cmV0dXJuInNlYXJjaCI9PT1hP2QuX2FGaWx0ZXJEYXRhOmQuX2FTb3J0RGF0YX0sMSl9KTtzKCJyb3dzKCkuaW52YWxpZGF0ZSgpIiwicm93KCkuaW52YWxpZGF0ZSgpIixmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigicm93IixmdW5jdGlvbihiLGMpe2NhKGIsYyxhKX0pfSk7cygicm93cygpLmluZGV4ZXMoKSIsInJvdygpLmluZGV4KCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInJvdyIsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYn0sMSl9KTtzKCJyb3dzKCkuaWRzKCkiLCJyb3coKS5pZCgpIixmdW5jdGlvbihhKXtmb3IodmFyIGI9W10sYz10aGlzLmNvbnRleHQsCmQ9MCxlPWMubGVuZ3RoO2Q8ZTtkKyspZm9yKHZhciBmPTAsZz10aGlzW2RdLmxlbmd0aDtmPGc7ZisrKXt2YXIgaD1jW2RdLnJvd0lkRm4oY1tkXS5hb0RhdGFbdGhpc1tkXVtmXV0uX2FEYXRhKTtiLnB1c2goKCEwPT09YT8iIyI6IiIpK2gpfXJldHVybiBuZXcgcihjLGIpfSk7cygicm93cygpLnJlbW92ZSgpIiwicm93KCkucmVtb3ZlKCkiLGZ1bmN0aW9uKCl7dmFyIGE9dGhpczt0aGlzLml0ZXJhdG9yKCJyb3ciLGZ1bmN0aW9uKGIsYyxkKXt2YXIgZT1iLmFvRGF0YSxmPWVbY10sZyxoLGksbixsO2Uuc3BsaWNlKGMsMSk7Zz0wO2ZvcihoPWUubGVuZ3RoO2c8aDtnKyspaWYoaT1lW2ddLGw9aS5hbkNlbGxzLG51bGwhPT1pLm5UciYmKGkublRyLl9EVF9Sb3dJbmRleD1nKSxudWxsIT09bCl7aT0wO2ZvcihuPWwubGVuZ3RoO2k8bjtpKyspbFtpXS5fRFRfQ2VsbEluZGV4LnJvdz1nfW9hKGIuYWlEaXNwbGF5TWFzdGVyLGMpO29hKGIuYWlEaXNwbGF5LGMpO29hKGFbZF0sYywhMSk7ClNhKGIpO2M9Yi5yb3dJZEZuKGYuX2FEYXRhKTtjIT09ayYmZGVsZXRlIGIuYUlkc1tjXX0pO3RoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXtmb3IodmFyIGM9MCxkPWEuYW9EYXRhLmxlbmd0aDtjPGQ7YysrKWEuYW9EYXRhW2NdLmlkeD1jfSk7cmV0dXJuIHRoaXN9KTtwKCJyb3dzLmFkZCgpIixmdW5jdGlvbihhKXt2YXIgYj10aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7dmFyIGMsZixnLGg9W107Zj0wO2ZvcihnPWEubGVuZ3RoO2Y8ZztmKyspYz1hW2ZdLGMubm9kZU5hbWUmJiJUUiI9PT1jLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk/aC5wdXNoKG1hKGIsYylbMF0pOmgucHVzaChOKGIsYykpO3JldHVybiBofSwxKSxjPXRoaXMucm93cygtMSk7Yy5wb3AoKTtoLm1lcmdlKGMsYik7cmV0dXJuIGN9KTtwKCJyb3coKSIsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYmIodGhpcy5yb3dzKGEsYikpfSk7cCgicm93KCkuZGF0YSgpIixmdW5jdGlvbihhKXt2YXIgYj0KdGhpcy5jb250ZXh0O2lmKGE9PT1rKXJldHVybiBiLmxlbmd0aCYmdGhpcy5sZW5ndGg/YlswXS5hb0RhdGFbdGhpc1swXV0uX2FEYXRhOms7YlswXS5hb0RhdGFbdGhpc1swXV0uX2FEYXRhPWE7Y2EoYlswXSx0aGlzWzBdLCJkYXRhIik7cmV0dXJuIHRoaXN9KTtwKCJyb3coKS5ub2RlKCkiLGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jb250ZXh0O3JldHVybiBhLmxlbmd0aCYmdGhpcy5sZW5ndGg/YVswXS5hb0RhdGFbdGhpc1swXV0ublRyfHxudWxsOm51bGx9KTtwKCJyb3cuYWRkKCkiLGZ1bmN0aW9uKGEpe2EgaW5zdGFuY2VvZiBoJiZhLmxlbmd0aCYmKGE9YVswXSk7dmFyIGI9dGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGIpe3JldHVybiBhLm5vZGVOYW1lJiYiVFIiPT09YS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpP21hKGIsYSlbMF06TihiLGEpfSk7cmV0dXJuIHRoaXMucm93KGJbMF0pfSk7dmFyIGNiPWZ1bmN0aW9uKGEsYil7dmFyIGM9YS5jb250ZXh0O2lmKGMubGVuZ3RoJiYKKGM9Y1swXS5hb0RhdGFbYiE9PWs/YjphWzBdXSkmJmMuX2RldGFpbHMpYy5fZGV0YWlscy5yZW1vdmUoKSxjLl9kZXRhaWxzU2hvdz1rLGMuX2RldGFpbHM9a30sVmI9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmNvbnRleHQ7aWYoYy5sZW5ndGgmJmEubGVuZ3RoKXt2YXIgZD1jWzBdLmFvRGF0YVthWzBdXTtpZihkLl9kZXRhaWxzKXsoZC5fZGV0YWlsc1Nob3c9Yik/ZC5fZGV0YWlscy5pbnNlcnRBZnRlcihkLm5Ucik6ZC5fZGV0YWlscy5kZXRhY2goKTt2YXIgZT1jWzBdLGY9bmV3IHIoZSksZz1lLmFvRGF0YTtmLm9mZigiZHJhdy5kdC5EVF9kZXRhaWxzIGNvbHVtbi12aXNpYmlsaXR5LmR0LkRUX2RldGFpbHMgZGVzdHJveS5kdC5EVF9kZXRhaWxzIik7MDxGKGcsIl9kZXRhaWxzIikubGVuZ3RoJiYoZi5vbigiZHJhdy5kdC5EVF9kZXRhaWxzIixmdW5jdGlvbihhLGIpe2U9PT1iJiZmLnJvd3Moe3BhZ2U6ImN1cnJlbnQifSkuZXEoMCkuZWFjaChmdW5jdGlvbihhKXthPWdbYV07CmEuX2RldGFpbHNTaG93JiZhLl9kZXRhaWxzLmluc2VydEFmdGVyKGEublRyKX0pfSksZi5vbigiY29sdW1uLXZpc2liaWxpdHkuZHQuRFRfZGV0YWlscyIsZnVuY3Rpb24oYSxiKXtpZihlPT09Yilmb3IodmFyIGMsZD1hYShiKSxmPTAsaD1nLmxlbmd0aDtmPGg7ZisrKWM9Z1tmXSxjLl9kZXRhaWxzJiZjLl9kZXRhaWxzLmNoaWxkcmVuKCJ0ZFtjb2xzcGFuXSIpLmF0dHIoImNvbHNwYW4iLGQpfSksZi5vbigiZGVzdHJveS5kdC5EVF9kZXRhaWxzIixmdW5jdGlvbihhLGIpe2lmKGU9PT1iKWZvcih2YXIgYz0wLGQ9Zy5sZW5ndGg7YzxkO2MrKylnW2NdLl9kZXRhaWxzJiZjYihmLGMpfSkpfX19O3AoInJvdygpLmNoaWxkKCkiLGZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5jb250ZXh0O2lmKGE9PT1rKXJldHVybiBjLmxlbmd0aCYmdGhpcy5sZW5ndGg/Y1swXS5hb0RhdGFbdGhpc1swXV0uX2RldGFpbHM6aztpZighMD09PWEpdGhpcy5jaGlsZC5zaG93KCk7ZWxzZSBpZighMT09PQphKWNiKHRoaXMpO2Vsc2UgaWYoYy5sZW5ndGgmJnRoaXMubGVuZ3RoKXt2YXIgZD1jWzBdLGM9Y1swXS5hb0RhdGFbdGhpc1swXV0sZT1bXSxmPWZ1bmN0aW9uKGEsYil7aWYoaC5pc0FycmF5KGEpfHxhIGluc3RhbmNlb2YgaClmb3IodmFyIGM9MCxrPWEubGVuZ3RoO2M8aztjKyspZihhW2NdLGIpO2Vsc2UgYS5ub2RlTmFtZSYmInRyIj09PWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT9lLnB1c2goYSk6KGM9aCgiPHRyPjx0ZC8+PC90cj4iKS5hZGRDbGFzcyhiKSxoKCJ0ZCIsYykuYWRkQ2xhc3MoYikuaHRtbChhKVswXS5jb2xTcGFuPWFhKGQpLGUucHVzaChjWzBdKSl9O2YoYSxiKTtjLl9kZXRhaWxzJiZjLl9kZXRhaWxzLnJlbW92ZSgpO2MuX2RldGFpbHM9aChlKTtjLl9kZXRhaWxzU2hvdyYmYy5fZGV0YWlscy5pbnNlcnRBZnRlcihjLm5Ucil9cmV0dXJuIHRoaXN9KTtwKFsicm93KCkuY2hpbGQuc2hvdygpIiwicm93KCkuY2hpbGQoKS5zaG93KCkiXSxmdW5jdGlvbigpe1ZiKHRoaXMsCiEwKTtyZXR1cm4gdGhpc30pO3AoWyJyb3coKS5jaGlsZC5oaWRlKCkiLCJyb3coKS5jaGlsZCgpLmhpZGUoKSJdLGZ1bmN0aW9uKCl7VmIodGhpcywhMSk7cmV0dXJuIHRoaXN9KTtwKFsicm93KCkuY2hpbGQucmVtb3ZlKCkiLCJyb3coKS5jaGlsZCgpLnJlbW92ZSgpIl0sZnVuY3Rpb24oKXtjYih0aGlzKTtyZXR1cm4gdGhpc30pO3AoInJvdygpLmNoaWxkLmlzU2hvd24oKSIsZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNvbnRleHQ7cmV0dXJuIGEubGVuZ3RoJiZ0aGlzLmxlbmd0aD9hWzBdLmFvRGF0YVt0aGlzWzBdXS5fZGV0YWlsc1Nob3d8fCExOiExfSk7dmFyIGVjPS9eKC4rKToobmFtZXx2aXNJZHh8dmlzaWJsZSkkLyxXYj1mdW5jdGlvbihhLGIsYyxkLGUpe2Zvcih2YXIgYz1bXSxkPTAsZj1lLmxlbmd0aDtkPGY7ZCsrKWMucHVzaChCKGEsZVtkXSxiKSk7cmV0dXJuIGN9O3AoImNvbHVtbnMoKSIsZnVuY3Rpb24oYSxiKXthPT09az9hPSIiOmguaXNQbGFpbk9iamVjdChhKSYmCihiPWEsYT0iIik7dmFyIGI9YWIoYiksYz10aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYyl7dmFyIGU9YSxmPWIsZz1jLmFvQ29sdW1ucyxqPUYoZywic05hbWUiKSxpPUYoZywiblRoIik7cmV0dXJuICRhKCJjb2x1bW4iLGUsZnVuY3Rpb24oYSl7dmFyIGI9UGIoYSk7aWYoYT09PSIiKXJldHVybiBYKGcubGVuZ3RoKTtpZihiIT09bnVsbClyZXR1cm5bYj49MD9iOmcubGVuZ3RoK2JdO2lmKHR5cGVvZiBhPT09ImZ1bmN0aW9uIil7dmFyIGU9RGEoYyxmKTtyZXR1cm4gaC5tYXAoZyxmdW5jdGlvbihiLGYpe3JldHVybiBhKGYsV2IoYyxmLDAsMCxlKSxpW2ZdKT9mOm51bGx9KX12YXIgaz10eXBlb2YgYT09PSJzdHJpbmciP2EubWF0Y2goZWMpOiIiO2lmKGspc3dpdGNoKGtbMl0pe2Nhc2UgInZpc0lkeCI6Y2FzZSAidmlzaWJsZSI6Yj1wYXJzZUludChrWzFdLDEwKTtpZihiPDApe3ZhciBtPWgubWFwKGcsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5iVmlzaWJsZT9iOm51bGx9KTsKcmV0dXJuW21bbS5sZW5ndGgrYl1dfXJldHVybltaKGMsYildO2Nhc2UgIm5hbWUiOnJldHVybiBoLm1hcChqLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGE9PT1rWzFdP2I6bnVsbH0pO2RlZmF1bHQ6cmV0dXJuW119aWYoYS5ub2RlTmFtZSYmYS5fRFRfQ2VsbEluZGV4KXJldHVyblthLl9EVF9DZWxsSW5kZXguY29sdW1uXTtiPWgoaSkuZmlsdGVyKGEpLm1hcChmdW5jdGlvbigpe3JldHVybiBoLmluQXJyYXkodGhpcyxpKX0pLnRvQXJyYXkoKTtpZihiLmxlbmd0aHx8IWEubm9kZU5hbWUpcmV0dXJuIGI7Yj1oKGEpLmNsb3Nlc3QoIipbZGF0YS1kdC1jb2x1bW5dIik7cmV0dXJuIGIubGVuZ3RoP1tiLmRhdGEoImR0LWNvbHVtbiIpXTpbXX0sYyxmKX0sMSk7Yy5zZWxlY3Rvci5jb2xzPWE7Yy5zZWxlY3Rvci5vcHRzPWI7cmV0dXJuIGN9KTtzKCJjb2x1bW5zKCkuaGVhZGVyKCkiLCJjb2x1bW4oKS5oZWFkZXIoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uIiwKZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5hb0NvbHVtbnNbYl0ublRofSwxKX0pO3MoImNvbHVtbnMoKS5mb290ZXIoKSIsImNvbHVtbigpLmZvb3RlcigpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJjb2x1bW4iLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuYW9Db2x1bW5zW2JdLm5UZn0sMSl9KTtzKCJjb2x1bW5zKCkuZGF0YSgpIiwiY29sdW1uKCkuZGF0YSgpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJjb2x1bW4tcm93cyIsV2IsMSl9KTtzKCJjb2x1bW5zKCkuZGF0YVNyYygpIiwiY29sdW1uKCkuZGF0YVNyYygpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJjb2x1bW4iLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuYW9Db2x1bW5zW2JdLm1EYXRhfSwxKX0pO3MoImNvbHVtbnMoKS5jYWNoZSgpIiwiY29sdW1uKCkuY2FjaGUoKSIsZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoImNvbHVtbi1yb3dzIixmdW5jdGlvbihiLApjLGQsZSxmKXtyZXR1cm4gaGEoYi5hb0RhdGEsZiwic2VhcmNoIj09PWE/Il9hRmlsdGVyRGF0YSI6Il9hU29ydERhdGEiLGMpfSwxKX0pO3MoImNvbHVtbnMoKS5ub2RlcygpIiwiY29sdW1uKCkubm9kZXMoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uLXJvd3MiLGZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuIGhhKGEuYW9EYXRhLGUsImFuQ2VsbHMiLGIpfSwxKX0pO3MoImNvbHVtbnMoKS52aXNpYmxlKCkiLCJjb2x1bW4oKS52aXNpYmxlKCkiLGZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuaXRlcmF0b3IoImNvbHVtbiIsZnVuY3Rpb24oYyxkKXtpZihhPT09aylyZXR1cm4gYy5hb0NvbHVtbnNbZF0uYlZpc2libGU7dmFyIGU9Yy5hb0NvbHVtbnMsZj1lW2RdLGc9Yy5hb0RhdGEsaixpLG47aWYoYSE9PWsmJmYuYlZpc2libGUhPT1hKXtpZihhKXt2YXIgbD1oLmluQXJyYXkoITAsRihlLCJiVmlzaWJsZSIpLGQrMSk7aj0wO2ZvcihpPWcubGVuZ3RoO2o8Cmk7aisrKW49Z1tqXS5uVHIsZT1nW2pdLmFuQ2VsbHMsbiYmbi5pbnNlcnRCZWZvcmUoZVtkXSxlW2xdfHxudWxsKX1lbHNlIGgoRihjLmFvRGF0YSwiYW5DZWxscyIsZCkpLmRldGFjaCgpO2YuYlZpc2libGU9YTtlYShjLGMuYW9IZWFkZXIpO2VhKGMsYy5hb0Zvb3Rlcik7KGI9PT1rfHxiKSYmVShjKTt1KGMsbnVsbCwiY29sdW1uLXZpc2liaWxpdHkiLFtjLGQsYSxiXSk7eWEoYyl9fSl9KTtzKCJjb2x1bW5zKCkuaW5kZXhlcygpIiwiY29sdW1uKCkuaW5kZXgoKSIsZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoImNvbHVtbiIsZnVuY3Rpb24oYixjKXtyZXR1cm4idmlzaWJsZSI9PT1hPyQoYixjKTpjfSwxKX0pO3AoImNvbHVtbnMuYWRqdXN0KCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXtVKGEpfSwxKX0pO3AoImNvbHVtbi5pbmRleCgpIixmdW5jdGlvbihhLGIpe2lmKDAhPT10aGlzLmNvbnRleHQubGVuZ3RoKXt2YXIgYz0KdGhpcy5jb250ZXh0WzBdO2lmKCJmcm9tVmlzaWJsZSI9PT1hfHwidG9EYXRhIj09PWEpcmV0dXJuIFooYyxiKTtpZigiZnJvbURhdGEiPT09YXx8InRvVmlzaWJsZSI9PT1hKXJldHVybiAkKGMsYil9fSk7cCgiY29sdW1uKCkiLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGJiKHRoaXMuY29sdW1ucyhhLGIpKX0pO3AoImNlbGxzKCkiLGZ1bmN0aW9uKGEsYixjKXtoLmlzUGxhaW5PYmplY3QoYSkmJihhLnJvdz09PWs/KGM9YSxhPW51bGwpOihjPWIsYj1udWxsKSk7aC5pc1BsYWluT2JqZWN0KGIpJiYoYz1iLGI9bnVsbCk7aWYobnVsbD09PWJ8fGI9PT1rKXJldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7dmFyIGQ9YSxlPWFiKGMpLGY9Yi5hb0RhdGEsZz1EYShiLGUpLGo9U2IoaGEoZixnLCJhbkNlbGxzIikpLGk9aChbXS5jb25jYXQuYXBwbHkoW10saikpLGwsbj1iLmFvQ29sdW1ucy5sZW5ndGgsbSxwLHIsdSx2LHM7cmV0dXJuICRhKCJjZWxsIixkLGZ1bmN0aW9uKGEpe3ZhciBjPQp0eXBlb2YgYT09PSJmdW5jdGlvbiI7aWYoYT09PW51bGx8fGE9PT1rfHxjKXttPVtdO3A9MDtmb3Iocj1nLmxlbmd0aDtwPHI7cCsrKXtsPWdbcF07Zm9yKHU9MDt1PG47dSsrKXt2PXtyb3c6bCxjb2x1bW46dX07aWYoYyl7cz1mW2xdO2EodixCKGIsbCx1KSxzLmFuQ2VsbHM/cy5hbkNlbGxzW3VdOm51bGwpJiZtLnB1c2godil9ZWxzZSBtLnB1c2godil9fXJldHVybiBtfWlmKGguaXNQbGFpbk9iamVjdChhKSlyZXR1cm5bYV07Yz1pLmZpbHRlcihhKS5tYXAoZnVuY3Rpb24oYSxiKXtyZXR1cm57cm93OmIuX0RUX0NlbGxJbmRleC5yb3csY29sdW1uOmIuX0RUX0NlbGxJbmRleC5jb2x1bW59fSkudG9BcnJheSgpO2lmKGMubGVuZ3RofHwhYS5ub2RlTmFtZSlyZXR1cm4gYztzPWgoYSkuY2xvc2VzdCgiKltkYXRhLWR0LXJvd10iKTtyZXR1cm4gcy5sZW5ndGg/W3tyb3c6cy5kYXRhKCJkdC1yb3ciKSxjb2x1bW46cy5kYXRhKCJkdC1jb2x1bW4iKX1dOltdfSxiLGUpfSk7dmFyIGQ9CnRoaXMuY29sdW1ucyhiLGMpLGU9dGhpcy5yb3dzKGEsYyksZixnLGosaSxuLGw9dGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGEsYil7Zj1bXTtnPTA7Zm9yKGo9ZVtiXS5sZW5ndGg7ZzxqO2crKyl7aT0wO2ZvcihuPWRbYl0ubGVuZ3RoO2k8bjtpKyspZi5wdXNoKHtyb3c6ZVtiXVtnXSxjb2x1bW46ZFtiXVtpXX0pfXJldHVybiBmfSwxKTtoLmV4dGVuZChsLnNlbGVjdG9yLHtjb2xzOmIscm93czphLG9wdHM6Y30pO3JldHVybiBsfSk7cygiY2VsbHMoKS5ub2RlcygpIiwiY2VsbCgpLm5vZGUoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY2VsbCIsZnVuY3Rpb24oYSxiLGMpe3JldHVybihhPWEuYW9EYXRhW2JdKSYmYS5hbkNlbGxzP2EuYW5DZWxsc1tjXTprfSwxKX0pO3AoImNlbGxzKCkuZGF0YSgpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJjZWxsIixmdW5jdGlvbihhLGIsYyl7cmV0dXJuIEIoYSxiLGMpfSwxKX0pO3MoImNlbGxzKCkuY2FjaGUoKSIsCiJjZWxsKCkuY2FjaGUoKSIsZnVuY3Rpb24oYSl7YT0ic2VhcmNoIj09PWE/Il9hRmlsdGVyRGF0YSI6Il9hU29ydERhdGEiO3JldHVybiB0aGlzLml0ZXJhdG9yKCJjZWxsIixmdW5jdGlvbihiLGMsZCl7cmV0dXJuIGIuYW9EYXRhW2NdW2FdW2RdfSwxKX0pO3MoImNlbGxzKCkucmVuZGVyKCkiLCJjZWxsKCkucmVuZGVyKCkiLGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJjZWxsIixmdW5jdGlvbihiLGMsZCl7cmV0dXJuIEIoYixjLGQsYSl9LDEpfSk7cygiY2VsbHMoKS5pbmRleGVzKCkiLCJjZWxsKCkuaW5kZXgoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY2VsbCIsZnVuY3Rpb24oYSxiLGMpe3JldHVybntyb3c6Yixjb2x1bW46Yyxjb2x1bW5WaXNpYmxlOiQoYSxjKX19LDEpfSk7cygiY2VsbHMoKS5pbnZhbGlkYXRlKCkiLCJjZWxsKCkuaW52YWxpZGF0ZSgpIixmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY2VsbCIsZnVuY3Rpb24oYiwKYyxkKXtjYShiLGMsYSxkKX0pfSk7cCgiY2VsbCgpIixmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGJiKHRoaXMuY2VsbHMoYSxiLGMpKX0pO3AoImNlbGwoKS5kYXRhKCkiLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuY29udGV4dCxjPXRoaXNbMF07aWYoYT09PWspcmV0dXJuIGIubGVuZ3RoJiZjLmxlbmd0aD9CKGJbMF0sY1swXS5yb3csY1swXS5jb2x1bW4pOms7amIoYlswXSxjWzBdLnJvdyxjWzBdLmNvbHVtbixhKTtjYShiWzBdLGNbMF0ucm93LCJkYXRhIixjWzBdLmNvbHVtbik7cmV0dXJuIHRoaXN9KTtwKCJvcmRlcigpIixmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuY29udGV4dDtpZihhPT09aylyZXR1cm4gMCE9PWMubGVuZ3RoP2NbMF0uYWFTb3J0aW5nOms7Im51bWJlciI9PT10eXBlb2YgYT9hPVtbYSxiXV06aC5pc0FycmF5KGFbMF0pfHwoYT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGIpe2IuYWFTb3J0aW5nPQphLnNsaWNlKCl9KX0pO3AoIm9yZGVyLmxpc3RlbmVyKCkiLGZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGQpe09hKGQsYSxiLGMpfSl9KTtwKCJvcmRlci5maXhlZCgpIixmdW5jdGlvbihhKXtpZighYSl7dmFyIGI9dGhpcy5jb250ZXh0LGI9Yi5sZW5ndGg/YlswXS5hYVNvcnRpbmdGaXhlZDprO3JldHVybiBoLmlzQXJyYXkoYik/e3ByZTpifTpifXJldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7Yi5hYVNvcnRpbmdGaXhlZD1oLmV4dGVuZCghMCx7fSxhKX0pfSk7cChbImNvbHVtbnMoKS5vcmRlcigpIiwiY29sdW1uKCkub3JkZXIoKSJdLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihjLGQpe3ZhciBlPVtdO2guZWFjaChiW2RdLGZ1bmN0aW9uKGIsYyl7ZS5wdXNoKFtjLGFdKX0pO2MuYWFTb3J0aW5nPWV9KX0pO3AoInNlYXJjaCgpIixmdW5jdGlvbihhLApiLGMsZCl7dmFyIGU9dGhpcy5jb250ZXh0O3JldHVybiBhPT09az8wIT09ZS5sZW5ndGg/ZVswXS5vUHJldmlvdXNTZWFyY2guc1NlYXJjaDprOnRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihlKXtlLm9GZWF0dXJlcy5iRmlsdGVyJiZmYShlLGguZXh0ZW5kKHt9LGUub1ByZXZpb3VzU2VhcmNoLHtzU2VhcmNoOmErIiIsYlJlZ2V4Om51bGw9PT1iPyExOmIsYlNtYXJ0Om51bGw9PT1jPyEwOmMsYkNhc2VJbnNlbnNpdGl2ZTpudWxsPT09ZD8hMDpkfSksMSl9KX0pO3MoImNvbHVtbnMoKS5zZWFyY2goKSIsImNvbHVtbigpLnNlYXJjaCgpIixmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uIixmdW5jdGlvbihlLGYpe3ZhciBnPWUuYW9QcmVTZWFyY2hDb2xzO2lmKGE9PT1rKXJldHVybiBnW2ZdLnNTZWFyY2g7ZS5vRmVhdHVyZXMuYkZpbHRlciYmKGguZXh0ZW5kKGdbZl0se3NTZWFyY2g6YSsiIixiUmVnZXg6bnVsbD09PWI/ITE6YixiU21hcnQ6bnVsbD09PQpjPyEwOmMsYkNhc2VJbnNlbnNpdGl2ZTpudWxsPT09ZD8hMDpkfSksZmEoZSxlLm9QcmV2aW91c1NlYXJjaCwxKSl9KX0pO3AoInN0YXRlKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29udGV4dC5sZW5ndGg/dGhpcy5jb250ZXh0WzBdLm9TYXZlZFN0YXRlOm51bGx9KTtwKCJzdGF0ZS5jbGVhcigpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYSl7YS5mblN0YXRlU2F2ZUNhbGxiYWNrLmNhbGwoYS5vSW5zdGFuY2UsYSx7fSl9KX0pO3AoInN0YXRlLmxvYWRlZCgpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnRleHQubGVuZ3RoP3RoaXMuY29udGV4dFswXS5vTG9hZGVkU3RhdGU6bnVsbH0pO3AoInN0YXRlLnNhdmUoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGEpe3lhKGEpfSl9KTttLnZlcnNpb25DaGVjaz1tLmZuVmVyc2lvbkNoZWNrPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj0KbS52ZXJzaW9uLnNwbGl0KCIuIiksYT1hLnNwbGl0KCIuIiksYyxkLGU9MCxmPWEubGVuZ3RoO2U8ZjtlKyspaWYoYz1wYXJzZUludChiW2VdLDEwKXx8MCxkPXBhcnNlSW50KGFbZV0sMTApfHwwLGMhPT1kKXJldHVybiBjPmQ7cmV0dXJuITB9O20uaXNEYXRhVGFibGU9bS5mbklzRGF0YVRhYmxlPWZ1bmN0aW9uKGEpe3ZhciBiPWgoYSkuZ2V0KDApLGM9ITE7aC5lYWNoKG0uc2V0dGluZ3MsZnVuY3Rpb24oYSxlKXt2YXIgZj1lLm5TY3JvbGxIZWFkP2goInRhYmxlIixlLm5TY3JvbGxIZWFkKVswXTpudWxsLGc9ZS5uU2Nyb2xsRm9vdD9oKCJ0YWJsZSIsZS5uU2Nyb2xsRm9vdClbMF06bnVsbDtpZihlLm5UYWJsZT09PWJ8fGY9PT1ifHxnPT09YiljPSEwfSk7cmV0dXJuIGN9O20udGFibGVzPW0uZm5UYWJsZXM9ZnVuY3Rpb24oYSl7dmFyIGI9ITE7aC5pc1BsYWluT2JqZWN0KGEpJiYoYj1hLmFwaSxhPWEudmlzaWJsZSk7dmFyIGM9aC5tYXAobS5zZXR0aW5ncyxmdW5jdGlvbihiKXtpZighYXx8CmEmJmgoYi5uVGFibGUpLmlzKCI6dmlzaWJsZSIpKXJldHVybiBiLm5UYWJsZX0pO3JldHVybiBiP25ldyByKGMpOmN9O20udXRpbD17dGhyb3R0bGU6dWEsZXNjYXBlUmVnZXg6dmF9O20uY2FtZWxUb0h1bmdhcmlhbj1LO3AoIiQoKSIsZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLnJvd3MoYikubm9kZXMoKSxjPWgoYyk7cmV0dXJuIGgoW10uY29uY2F0KGMuZmlsdGVyKGEpLnRvQXJyYXkoKSxjLmZpbmQoYSkudG9BcnJheSgpKSl9KTtoLmVhY2goWyJvbiIsIm9uZSIsIm9mZiJdLGZ1bmN0aW9uKGEsYil7cChiKyIoKSIsZnVuY3Rpb24oKXt2YXIgYT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO2FbMF0ubWF0Y2goL1wuZHRcYi8pfHwoYVswXSs9Ii5kdCIpO3ZhciBkPWgodGhpcy50YWJsZXMoKS5ub2RlcygpKTtkW2JdLmFwcGx5KGQsYSk7cmV0dXJuIHRoaXN9KX0pO3AoImNsZWFyKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIiwKZnVuY3Rpb24oYSl7bmEoYSl9KX0pO3AoInNldHRpbmdzKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIG5ldyByKHRoaXMuY29udGV4dCx0aGlzLmNvbnRleHQpfSk7cCgiaW5pdCgpIixmdW5jdGlvbigpe3ZhciBhPXRoaXMuY29udGV4dDtyZXR1cm4gYS5sZW5ndGg/YVswXS5vSW5pdDpudWxsfSk7cCgiZGF0YSgpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYSl7cmV0dXJuIEYoYS5hb0RhdGEsIl9hRGF0YSIpfSkuZmxhdHRlbigpfSk7cCgiZGVzdHJveSgpIixmdW5jdGlvbihhKXthPWF8fCExO3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7dmFyIGM9Yi5uVGFibGVXcmFwcGVyLnBhcmVudE5vZGUsZD1iLm9DbGFzc2VzLGU9Yi5uVGFibGUsZj1iLm5UQm9keSxnPWIublRIZWFkLGo9Yi5uVEZvb3QsaT1oKGUpLGY9aChmKSxrPWgoYi5uVGFibGVXcmFwcGVyKSxsPWgubWFwKGIuYW9EYXRhLGZ1bmN0aW9uKGEpe3JldHVybiBhLm5Ucn0pLApwO2IuYkRlc3Ryb3lpbmc9ITA7dShiLCJhb0Rlc3Ryb3lDYWxsYmFjayIsImRlc3Ryb3kiLFtiXSk7YXx8KG5ldyByKGIpKS5jb2x1bW5zKCkudmlzaWJsZSghMCk7ay51bmJpbmQoIi5EVCIpLmZpbmQoIjpub3QodGJvZHkgKikiKS51bmJpbmQoIi5EVCIpO2goRCkudW5iaW5kKCIuRFQtIitiLnNJbnN0YW5jZSk7ZSE9Zy5wYXJlbnROb2RlJiYoaS5jaGlsZHJlbigidGhlYWQiKS5kZXRhY2goKSxpLmFwcGVuZChnKSk7aiYmZSE9ai5wYXJlbnROb2RlJiYoaS5jaGlsZHJlbigidGZvb3QiKS5kZXRhY2goKSxpLmFwcGVuZChqKSk7Yi5hYVNvcnRpbmc9W107Yi5hYVNvcnRpbmdGaXhlZD1bXTt4YShiKTtoKGwpLnJlbW92ZUNsYXNzKGIuYXNTdHJpcGVDbGFzc2VzLmpvaW4oIiAiKSk7aCgidGgsIHRkIixnKS5yZW1vdmVDbGFzcyhkLnNTb3J0YWJsZSsiICIrZC5zU29ydGFibGVBc2MrIiAiK2Quc1NvcnRhYmxlRGVzYysiICIrZC5zU29ydGFibGVOb25lKTtiLmJKVUkmJihoKCJ0aCBzcGFuLiIrCmQuc1NvcnRJY29uKyIsIHRkIHNwYW4uIitkLnNTb3J0SWNvbixnKS5kZXRhY2goKSxoKCJ0aCwgdGQiLGcpLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1oKCJkaXYuIitkLnNTb3J0SlVJV3JhcHBlcix0aGlzKTtoKHRoaXMpLmFwcGVuZChhLmNvbnRlbnRzKCkpO2EuZGV0YWNoKCl9KSk7Zi5jaGlsZHJlbigpLmRldGFjaCgpO2YuYXBwZW5kKGwpO2c9YT8icmVtb3ZlIjoiZGV0YWNoIjtpW2ddKCk7a1tnXSgpOyFhJiZjJiYoYy5pbnNlcnRCZWZvcmUoZSxiLm5UYWJsZVJlaW5zZXJ0QmVmb3JlKSxpLmNzcygid2lkdGgiLGIuc0Rlc3Ryb3lXaWR0aCkucmVtb3ZlQ2xhc3MoZC5zVGFibGUpLChwPWIuYXNEZXN0cm95U3RyaXBlcy5sZW5ndGgpJiZmLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbihhKXtoKHRoaXMpLmFkZENsYXNzKGIuYXNEZXN0cm95U3RyaXBlc1thJXBdKX0pKTtjPWguaW5BcnJheShiLG0uc2V0dGluZ3MpOy0xIT09YyYmbS5zZXR0aW5ncy5zcGxpY2UoYywxKX0pfSk7aC5lYWNoKFsiY29sdW1uIiwKInJvdyIsImNlbGwiXSxmdW5jdGlvbihhLGIpe3AoYisicygpLmV2ZXJ5KCkiLGZ1bmN0aW9uKGEpe3ZhciBkPXRoaXMuc2VsZWN0b3Iub3B0cyxlPXRoaXM7cmV0dXJuIHRoaXMuaXRlcmF0b3IoYixmdW5jdGlvbihmLGcsaCxpLG4pe2EuY2FsbChlW2JdKGcsImNlbGwiPT09Yj9oOmQsImNlbGwiPT09Yj9kOmspLGcsaCxpLG4pfSl9KX0pO3AoImkxOG4oKSIsZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMuY29udGV4dFswXSxhPVEoYSkoZC5vTGFuZ3VhZ2UpO2E9PT1rJiYoYT1iKTtjIT09ayYmaC5pc1BsYWluT2JqZWN0KGEpJiYoYT1hW2NdIT09az9hW2NdOmEuXyk7cmV0dXJuIGEucmVwbGFjZSgiJWQiLGMpfSk7bS52ZXJzaW9uPSIxLjEwLjExIjttLnNldHRpbmdzPVtdO20ubW9kZWxzPXt9O20ubW9kZWxzLm9TZWFyY2g9e2JDYXNlSW5zZW5zaXRpdmU6ITAsc1NlYXJjaDoiIixiUmVnZXg6ITEsYlNtYXJ0OiEwfTttLm1vZGVscy5vUm93PXtuVHI6bnVsbCxhbkNlbGxzOm51bGwsCl9hRGF0YTpbXSxfYVNvcnREYXRhOm51bGwsX2FGaWx0ZXJEYXRhOm51bGwsX3NGaWx0ZXJSb3c6bnVsbCxfc1Jvd1N0cmlwZToiIixzcmM6bnVsbCxpZHg6LTF9O20ubW9kZWxzLm9Db2x1bW49e2lkeDpudWxsLGFEYXRhU29ydDpudWxsLGFzU29ydGluZzpudWxsLGJTZWFyY2hhYmxlOm51bGwsYlNvcnRhYmxlOm51bGwsYlZpc2libGU6bnVsbCxfc01hbnVhbFR5cGU6bnVsbCxfYkF0dHJTcmM6ITEsZm5DcmVhdGVkQ2VsbDpudWxsLGZuR2V0RGF0YTpudWxsLGZuU2V0RGF0YTpudWxsLG1EYXRhOm51bGwsbVJlbmRlcjpudWxsLG5UaDpudWxsLG5UZjpudWxsLHNDbGFzczpudWxsLHNDb250ZW50UGFkZGluZzpudWxsLHNEZWZhdWx0Q29udGVudDpudWxsLHNOYW1lOm51bGwsc1NvcnREYXRhVHlwZToic3RkIixzU29ydGluZ0NsYXNzOm51bGwsc1NvcnRpbmdDbGFzc0pVSTpudWxsLHNUaXRsZTpudWxsLHNUeXBlOm51bGwsc1dpZHRoOm51bGwsc1dpZHRoT3JpZzpudWxsfTttLmRlZmF1bHRzPQp7YWFEYXRhOm51bGwsYWFTb3J0aW5nOltbMCwiYXNjIl1dLGFhU29ydGluZ0ZpeGVkOltdLGFqYXg6bnVsbCxhTGVuZ3RoTWVudTpbMTAsMjUsNTAsMTAwXSxhb0NvbHVtbnM6bnVsbCxhb0NvbHVtbkRlZnM6bnVsbCxhb1NlYXJjaENvbHM6W10sYXNTdHJpcGVDbGFzc2VzOm51bGwsYkF1dG9XaWR0aDohMCxiRGVmZXJSZW5kZXI6ITEsYkRlc3Ryb3k6ITEsYkZpbHRlcjohMCxiSW5mbzohMCxiSlF1ZXJ5VUk6ITEsYkxlbmd0aENoYW5nZTohMCxiUGFnaW5hdGU6ITAsYlByb2Nlc3Npbmc6ITEsYlJldHJpZXZlOiExLGJTY3JvbGxDb2xsYXBzZTohMSxiU2VydmVyU2lkZTohMSxiU29ydDohMCxiU29ydE11bHRpOiEwLGJTb3J0Q2VsbHNUb3A6ITEsYlNvcnRDbGFzc2VzOiEwLGJTdGF0ZVNhdmU6ITEsZm5DcmVhdGVkUm93Om51bGwsZm5EcmF3Q2FsbGJhY2s6bnVsbCxmbkZvb3RlckNhbGxiYWNrOm51bGwsZm5Gb3JtYXROdW1iZXI6ZnVuY3Rpb24oYSl7cmV0dXJuIGEudG9TdHJpbmcoKS5yZXBsYWNlKC9cQig/PShcZHszfSkrKD8hXGQpKS9nLAp0aGlzLm9MYW5ndWFnZS5zVGhvdXNhbmRzKX0sZm5IZWFkZXJDYWxsYmFjazpudWxsLGZuSW5mb0NhbGxiYWNrOm51bGwsZm5Jbml0Q29tcGxldGU6bnVsbCxmblByZURyYXdDYWxsYmFjazpudWxsLGZuUm93Q2FsbGJhY2s6bnVsbCxmblNlcnZlckRhdGE6bnVsbCxmblNlcnZlclBhcmFtczpudWxsLGZuU3RhdGVMb2FkQ2FsbGJhY2s6ZnVuY3Rpb24oYSl7dHJ5e3JldHVybiBKU09OLnBhcnNlKCgtMT09PWEuaVN0YXRlRHVyYXRpb24/c2Vzc2lvblN0b3JhZ2U6bG9jYWxTdG9yYWdlKS5nZXRJdGVtKCJEYXRhVGFibGVzXyIrYS5zSW5zdGFuY2UrIl8iK2xvY2F0aW9uLnBhdGhuYW1lKSl9Y2F0Y2goYil7fX0sZm5TdGF0ZUxvYWRQYXJhbXM6bnVsbCxmblN0YXRlTG9hZGVkOm51bGwsZm5TdGF0ZVNhdmVDYWxsYmFjazpmdW5jdGlvbihhLGIpe3RyeXsoLTE9PT1hLmlTdGF0ZUR1cmF0aW9uP3Nlc3Npb25TdG9yYWdlOmxvY2FsU3RvcmFnZSkuc2V0SXRlbSgiRGF0YVRhYmxlc18iK2Euc0luc3RhbmNlKwoiXyIrbG9jYXRpb24ucGF0aG5hbWUsSlNPTi5zdHJpbmdpZnkoYikpfWNhdGNoKGMpe319LGZuU3RhdGVTYXZlUGFyYW1zOm51bGwsaVN0YXRlRHVyYXRpb246NzIwMCxpRGVmZXJMb2FkaW5nOm51bGwsaURpc3BsYXlMZW5ndGg6MTAsaURpc3BsYXlTdGFydDowLGlUYWJJbmRleDowLG9DbGFzc2VzOnt9LG9MYW5ndWFnZTp7b0FyaWE6e3NTb3J0QXNjZW5kaW5nOiI6IGFjdGl2YXRlIHRvIHNvcnQgY29sdW1uIGFzY2VuZGluZyIsc1NvcnREZXNjZW5kaW5nOiI6IGFjdGl2YXRlIHRvIHNvcnQgY29sdW1uIGRlc2NlbmRpbmcifSxvUGFnaW5hdGU6e3NGaXJzdDoiRmlyc3QiLHNMYXN0OiJMYXN0IixzTmV4dDoiTmV4dCIsc1ByZXZpb3VzOiJQcmV2aW91cyJ9LHNFbXB0eVRhYmxlOiJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsc0luZm86IlNob3dpbmcgX1NUQVJUXyB0byBfRU5EXyBvZiBfVE9UQUxfIGVudHJpZXMiLHNJbmZvRW1wdHk6IlNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcyIsCnNJbmZvRmlsdGVyZWQ6IihmaWx0ZXJlZCBmcm9tIF9NQVhfIHRvdGFsIGVudHJpZXMpIixzSW5mb1Bvc3RGaXg6IiIsc0RlY2ltYWw6IiIsc1Rob3VzYW5kczoiLCIsc0xlbmd0aE1lbnU6IlNob3cgX01FTlVfIGVudHJpZXMiLHNMb2FkaW5nUmVjb3JkczoiTG9hZGluZy4uLiIsc1Byb2Nlc3Npbmc6IlByb2Nlc3NpbmcuLi4iLHNTZWFyY2g6IlNlYXJjaDoiLHNTZWFyY2hQbGFjZWhvbGRlcjoiIixzVXJsOiIiLHNaZXJvUmVjb3JkczoiTm8gbWF0Y2hpbmcgcmVjb3JkcyBmb3VuZCJ9LG9TZWFyY2g6aC5leHRlbmQoe30sbS5tb2RlbHMub1NlYXJjaCksc0FqYXhEYXRhUHJvcDoiZGF0YSIsc0FqYXhTb3VyY2U6bnVsbCxzRG9tOiJsZnJ0aXAiLHNlYXJjaERlbGF5Om51bGwsc1BhZ2luYXRpb25UeXBlOiJzaW1wbGVfbnVtYmVycyIsc1Njcm9sbFg6IiIsc1Njcm9sbFhJbm5lcjoiIixzU2Nyb2xsWToiIixzU2VydmVyTWV0aG9kOiJHRVQiLHJlbmRlcmVyOm51bGwscm93SWQ6IkRUX1Jvd0lkIn07ClkobS5kZWZhdWx0cyk7bS5kZWZhdWx0cy5jb2x1bW49e2FEYXRhU29ydDpudWxsLGlEYXRhU29ydDotMSxhc1NvcnRpbmc6WyJhc2MiLCJkZXNjIl0sYlNlYXJjaGFibGU6ITAsYlNvcnRhYmxlOiEwLGJWaXNpYmxlOiEwLGZuQ3JlYXRlZENlbGw6bnVsbCxtRGF0YTpudWxsLG1SZW5kZXI6bnVsbCxzQ2VsbFR5cGU6InRkIixzQ2xhc3M6IiIsc0NvbnRlbnRQYWRkaW5nOiIiLHNEZWZhdWx0Q29udGVudDpudWxsLHNOYW1lOiIiLHNTb3J0RGF0YVR5cGU6InN0ZCIsc1RpdGxlOm51bGwsc1R5cGU6bnVsbCxzV2lkdGg6bnVsbH07WShtLmRlZmF1bHRzLmNvbHVtbik7bS5tb2RlbHMub1NldHRpbmdzPXtvRmVhdHVyZXM6e2JBdXRvV2lkdGg6bnVsbCxiRGVmZXJSZW5kZXI6bnVsbCxiRmlsdGVyOm51bGwsYkluZm86bnVsbCxiTGVuZ3RoQ2hhbmdlOm51bGwsYlBhZ2luYXRlOm51bGwsYlByb2Nlc3Npbmc6bnVsbCxiU2VydmVyU2lkZTpudWxsLGJTb3J0Om51bGwsYlNvcnRNdWx0aTpudWxsLApiU29ydENsYXNzZXM6bnVsbCxiU3RhdGVTYXZlOm51bGx9LG9TY3JvbGw6e2JDb2xsYXBzZTpudWxsLGlCYXJXaWR0aDowLHNYOm51bGwsc1hJbm5lcjpudWxsLHNZOm51bGx9LG9MYW5ndWFnZTp7Zm5JbmZvQ2FsbGJhY2s6bnVsbH0sb0Jyb3dzZXI6e2JTY3JvbGxPdmVyc2l6ZTohMSxiU2Nyb2xsYmFyTGVmdDohMSxiQm91bmRpbmc6ITEsYmFyV2lkdGg6MH0sYWpheDpudWxsLGFhbkZlYXR1cmVzOltdLGFvRGF0YTpbXSxhaURpc3BsYXk6W10sYWlEaXNwbGF5TWFzdGVyOltdLGFJZHM6e30sYW9Db2x1bW5zOltdLGFvSGVhZGVyOltdLGFvRm9vdGVyOltdLG9QcmV2aW91c1NlYXJjaDp7fSxhb1ByZVNlYXJjaENvbHM6W10sYWFTb3J0aW5nOm51bGwsYWFTb3J0aW5nRml4ZWQ6W10sYXNTdHJpcGVDbGFzc2VzOm51bGwsYXNEZXN0cm95U3RyaXBlczpbXSxzRGVzdHJveVdpZHRoOjAsYW9Sb3dDYWxsYmFjazpbXSxhb0hlYWRlckNhbGxiYWNrOltdLGFvRm9vdGVyQ2FsbGJhY2s6W10sCmFvRHJhd0NhbGxiYWNrOltdLGFvUm93Q3JlYXRlZENhbGxiYWNrOltdLGFvUHJlRHJhd0NhbGxiYWNrOltdLGFvSW5pdENvbXBsZXRlOltdLGFvU3RhdGVTYXZlUGFyYW1zOltdLGFvU3RhdGVMb2FkUGFyYW1zOltdLGFvU3RhdGVMb2FkZWQ6W10sc1RhYmxlSWQ6IiIsblRhYmxlOm51bGwsblRIZWFkOm51bGwsblRGb290Om51bGwsblRCb2R5Om51bGwsblRhYmxlV3JhcHBlcjpudWxsLGJEZWZlckxvYWRpbmc6ITEsYkluaXRpYWxpc2VkOiExLGFvT3BlblJvd3M6W10sc0RvbTpudWxsLHNlYXJjaERlbGF5Om51bGwsc1BhZ2luYXRpb25UeXBlOiJ0d29fYnV0dG9uIixpU3RhdGVEdXJhdGlvbjowLGFvU3RhdGVTYXZlOltdLGFvU3RhdGVMb2FkOltdLG9TYXZlZFN0YXRlOm51bGwsb0xvYWRlZFN0YXRlOm51bGwsc0FqYXhTb3VyY2U6bnVsbCxzQWpheERhdGFQcm9wOm51bGwsYkFqYXhEYXRhR2V0OiEwLGpxWEhSOm51bGwsanNvbjprLG9BamF4RGF0YTprLGZuU2VydmVyRGF0YTpudWxsLAphb1NlcnZlclBhcmFtczpbXSxzU2VydmVyTWV0aG9kOm51bGwsZm5Gb3JtYXROdW1iZXI6bnVsbCxhTGVuZ3RoTWVudTpudWxsLGlEcmF3OjAsYkRyYXdpbmc6ITEsaURyYXdFcnJvcjotMSxfaURpc3BsYXlMZW5ndGg6MTAsX2lEaXNwbGF5U3RhcnQ6MCxfaVJlY29yZHNUb3RhbDowLF9pUmVjb3Jkc0Rpc3BsYXk6MCxiSlVJOm51bGwsb0NsYXNzZXM6e30sYkZpbHRlcmVkOiExLGJTb3J0ZWQ6ITEsYlNvcnRDZWxsc1RvcDpudWxsLG9Jbml0Om51bGwsYW9EZXN0cm95Q2FsbGJhY2s6W10sZm5SZWNvcmRzVG90YWw6ZnVuY3Rpb24oKXtyZXR1cm4ic3NwIj09eSh0aGlzKT8xKnRoaXMuX2lSZWNvcmRzVG90YWw6dGhpcy5haURpc3BsYXlNYXN0ZXIubGVuZ3RofSxmblJlY29yZHNEaXNwbGF5OmZ1bmN0aW9uKCl7cmV0dXJuInNzcCI9PXkodGhpcyk/MSp0aGlzLl9pUmVjb3Jkc0Rpc3BsYXk6dGhpcy5haURpc3BsYXkubGVuZ3RofSxmbkRpc3BsYXlFbmQ6ZnVuY3Rpb24oKXt2YXIgYT0KdGhpcy5faURpc3BsYXlMZW5ndGgsYj10aGlzLl9pRGlzcGxheVN0YXJ0LGM9YithLGQ9dGhpcy5haURpc3BsYXkubGVuZ3RoLGU9dGhpcy5vRmVhdHVyZXMsZj1lLmJQYWdpbmF0ZTtyZXR1cm4gZS5iU2VydmVyU2lkZT8hMT09PWZ8fC0xPT09YT9iK2Q6TWF0aC5taW4oYithLHRoaXMuX2lSZWNvcmRzRGlzcGxheSk6IWZ8fGM+ZHx8LTE9PT1hP2Q6Y30sb0luc3RhbmNlOm51bGwsc0luc3RhbmNlOm51bGwsaVRhYkluZGV4OjAsblNjcm9sbEhlYWQ6bnVsbCxuU2Nyb2xsRm9vdDpudWxsLGFMYXN0U29ydDpbXSxvUGx1Z2luczp7fSxyb3dJZEZuOm51bGwscm93SWQ6bnVsbH07bS5leHQ9dj17YnV0dG9uczp7fSxjbGFzc2VzOnt9LGJ1aWxkZXI6Ii1zb3VyY2UtIixlcnJNb2RlOiJhbGVydCIsZmVhdHVyZTpbXSxzZWFyY2g6W10sc2VsZWN0b3I6e2NlbGw6W10sY29sdW1uOltdLHJvdzpbXX0saW50ZXJuYWw6e30sbGVnYWN5OnthamF4Om51bGx9LHBhZ2VyOnt9LHJlbmRlcmVyOntwYWdlQnV0dG9uOnt9LApoZWFkZXI6e319LG9yZGVyOnt9LHR5cGU6e2RldGVjdDpbXSxzZWFyY2g6e30sb3JkZXI6e319LF91bmlxdWU6MCxmblZlcnNpb25DaGVjazptLmZuVmVyc2lvbkNoZWNrLGlBcGlJbmRleDowLG9KVUlDbGFzc2VzOnt9LHNWZXJzaW9uOm0udmVyc2lvbn07aC5leHRlbmQodix7YWZuRmlsdGVyaW5nOnYuc2VhcmNoLGFUeXBlczp2LnR5cGUuZGV0ZWN0LG9mblNlYXJjaDp2LnR5cGUuc2VhcmNoLG9Tb3J0OnYudHlwZS5vcmRlcixhZm5Tb3J0RGF0YTp2Lm9yZGVyLGFvRmVhdHVyZXM6di5mZWF0dXJlLG9BcGk6di5pbnRlcm5hbCxvU3RkQ2xhc3Nlczp2LmNsYXNzZXMsb1BhZ2luYXRpb246di5wYWdlcn0pO2guZXh0ZW5kKG0uZXh0LmNsYXNzZXMse3NUYWJsZToiZGF0YVRhYmxlIixzTm9Gb290ZXI6Im5vLWZvb3RlciIsc1BhZ2VCdXR0b246InBhZ2luYXRlX2J1dHRvbiIsc1BhZ2VCdXR0b25BY3RpdmU6ImN1cnJlbnQiLHNQYWdlQnV0dG9uRGlzYWJsZWQ6ImRpc2FibGVkIixzU3RyaXBlT2RkOiJvZGQiLApzU3RyaXBlRXZlbjoiZXZlbiIsc1Jvd0VtcHR5OiJkYXRhVGFibGVzX2VtcHR5IixzV3JhcHBlcjoiZGF0YVRhYmxlc193cmFwcGVyIixzRmlsdGVyOiJkYXRhVGFibGVzX2ZpbHRlciIsc0luZm86ImRhdGFUYWJsZXNfaW5mbyIsc1BhZ2luZzoiZGF0YVRhYmxlc19wYWdpbmF0ZSBwYWdpbmdfIixzTGVuZ3RoOiJkYXRhVGFibGVzX2xlbmd0aCIsc1Byb2Nlc3Npbmc6ImRhdGFUYWJsZXNfcHJvY2Vzc2luZyIsc1NvcnRBc2M6InNvcnRpbmdfYXNjIixzU29ydERlc2M6InNvcnRpbmdfZGVzYyIsc1NvcnRhYmxlOiJzb3J0aW5nIixzU29ydGFibGVBc2M6InNvcnRpbmdfYXNjX2Rpc2FibGVkIixzU29ydGFibGVEZXNjOiJzb3J0aW5nX2Rlc2NfZGlzYWJsZWQiLHNTb3J0YWJsZU5vbmU6InNvcnRpbmdfZGlzYWJsZWQiLHNTb3J0Q29sdW1uOiJzb3J0aW5nXyIsc0ZpbHRlcklucHV0OiIiLHNMZW5ndGhTZWxlY3Q6IiIsc1Njcm9sbFdyYXBwZXI6ImRhdGFUYWJsZXNfc2Nyb2xsIixzU2Nyb2xsSGVhZDoiZGF0YVRhYmxlc19zY3JvbGxIZWFkIiwKc1Njcm9sbEhlYWRJbm5lcjoiZGF0YVRhYmxlc19zY3JvbGxIZWFkSW5uZXIiLHNTY3JvbGxCb2R5OiJkYXRhVGFibGVzX3Njcm9sbEJvZHkiLHNTY3JvbGxGb290OiJkYXRhVGFibGVzX3Njcm9sbEZvb3QiLHNTY3JvbGxGb290SW5uZXI6ImRhdGFUYWJsZXNfc2Nyb2xsRm9vdElubmVyIixzSGVhZGVyVEg6IiIsc0Zvb3RlclRIOiIiLHNTb3J0SlVJQXNjOiIiLHNTb3J0SlVJRGVzYzoiIixzU29ydEpVSToiIixzU29ydEpVSUFzY0FsbG93ZWQ6IiIsc1NvcnRKVUlEZXNjQWxsb3dlZDoiIixzU29ydEpVSVdyYXBwZXI6IiIsc1NvcnRJY29uOiIiLHNKVUlIZWFkZXI6IiIsc0pVSUZvb3RlcjoiIn0pO3ZhciBFYT0iIixFYT0iIixIPUVhKyJ1aS1zdGF0ZS1kZWZhdWx0IixpYT1FYSsiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi0iLFhiPUVhKyJmZy10b29sYmFyIHVpLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1oZWxwZXItY2xlYXJmaXgiO2guZXh0ZW5kKG0uZXh0Lm9KVUlDbGFzc2VzLAptLmV4dC5jbGFzc2VzLHtzUGFnZUJ1dHRvbjoiZmctYnV0dG9uIHVpLWJ1dHRvbiAiK0gsc1BhZ2VCdXR0b25BY3RpdmU6InVpLXN0YXRlLWRpc2FibGVkIixzUGFnZUJ1dHRvbkRpc2FibGVkOiJ1aS1zdGF0ZS1kaXNhYmxlZCIsc1BhZ2luZzoiZGF0YVRhYmxlc19wYWdpbmF0ZSBmZy1idXR0b25zZXQgdWktYnV0dG9uc2V0IGZnLWJ1dHRvbnNldC1tdWx0aSB1aS1idXR0b25zZXQtbXVsdGkgcGFnaW5nXyIsc1NvcnRBc2M6SCsiIHNvcnRpbmdfYXNjIixzU29ydERlc2M6SCsiIHNvcnRpbmdfZGVzYyIsc1NvcnRhYmxlOkgrIiBzb3J0aW5nIixzU29ydGFibGVBc2M6SCsiIHNvcnRpbmdfYXNjX2Rpc2FibGVkIixzU29ydGFibGVEZXNjOkgrIiBzb3J0aW5nX2Rlc2NfZGlzYWJsZWQiLHNTb3J0YWJsZU5vbmU6SCsiIHNvcnRpbmdfZGlzYWJsZWQiLHNTb3J0SlVJQXNjOmlhKyJ0cmlhbmdsZS0xLW4iLHNTb3J0SlVJRGVzYzppYSsidHJpYW5nbGUtMS1zIixzU29ydEpVSTppYSsiY2FyYXQtMi1uLXMiLApzU29ydEpVSUFzY0FsbG93ZWQ6aWErImNhcmF0LTEtbiIsc1NvcnRKVUlEZXNjQWxsb3dlZDppYSsiY2FyYXQtMS1zIixzU29ydEpVSVdyYXBwZXI6IkRhdGFUYWJsZXNfc29ydF93cmFwcGVyIixzU29ydEljb246IkRhdGFUYWJsZXNfc29ydF9pY29uIixzU2Nyb2xsSGVhZDoiZGF0YVRhYmxlc19zY3JvbGxIZWFkICIrSCxzU2Nyb2xsRm9vdDoiZGF0YVRhYmxlc19zY3JvbGxGb290ICIrSCxzSGVhZGVyVEg6SCxzRm9vdGVyVEg6SCxzSlVJSGVhZGVyOlhiKyIgdWktY29ybmVyLXRsIHVpLWNvcm5lci10ciIsc0pVSUZvb3RlcjpYYisiIHVpLWNvcm5lci1ibCB1aS1jb3JuZXItYnIifSk7dmFyIE1iPW0uZXh0LnBhZ2VyO2guZXh0ZW5kKE1iLHtzaW1wbGU6ZnVuY3Rpb24oKXtyZXR1cm5bInByZXZpb3VzIiwibmV4dCJdfSxmdWxsOmZ1bmN0aW9uKCl7cmV0dXJuWyJmaXJzdCIsInByZXZpb3VzIiwibmV4dCIsImxhc3QiXX0sbnVtYmVyczpmdW5jdGlvbihhLGIpe3JldHVybltBYShhLApiKV19LHNpbXBsZV9udW1iZXJzOmZ1bmN0aW9uKGEsYil7cmV0dXJuWyJwcmV2aW91cyIsQWEoYSxiKSwibmV4dCJdfSxmdWxsX251bWJlcnM6ZnVuY3Rpb24oYSxiKXtyZXR1cm5bImZpcnN0IiwicHJldmlvdXMiLEFhKGEsYiksIm5leHQiLCJsYXN0Il19LF9udW1iZXJzOkFhLG51bWJlcnNfbGVuZ3RoOjd9KTtoLmV4dGVuZCghMCxtLmV4dC5yZW5kZXJlcix7cGFnZUJ1dHRvbjp7XzpmdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9YS5vQ2xhc3NlcyxqPWEub0xhbmd1YWdlLm9QYWdpbmF0ZSxpPWEub0xhbmd1YWdlLm9BcmlhLnBhZ2luYXRlfHx7fSxrLGwsbT0wLHA9ZnVuY3Rpb24oYixkKXt2YXIgbyxyLHUscyx2PWZ1bmN0aW9uKGIpe1RhKGEsYi5kYXRhLmFjdGlvbix0cnVlKX07bz0wO2ZvcihyPWQubGVuZ3RoO288cjtvKyspe3M9ZFtvXTtpZihoLmlzQXJyYXkocykpe3U9aCgiPCIrKHMuRFRfZWx8fCJkaXYiKSsiLz4iKS5hcHBlbmRUbyhiKTtwKHUscyl9ZWxzZXtrPW51bGw7Cmw9IiI7c3dpdGNoKHMpe2Nhc2UgImVsbGlwc2lzIjpiLmFwcGVuZCgnPHNwYW4gY2xhc3M9ImVsbGlwc2lzIj4mI3gyMDI2Ozwvc3Bhbj4nKTticmVhaztjYXNlICJmaXJzdCI6az1qLnNGaXJzdDtsPXMrKGU+MD8iIjoiICIrZy5zUGFnZUJ1dHRvbkRpc2FibGVkKTticmVhaztjYXNlICJwcmV2aW91cyI6az1qLnNQcmV2aW91cztsPXMrKGU+MD8iIjoiICIrZy5zUGFnZUJ1dHRvbkRpc2FibGVkKTticmVhaztjYXNlICJuZXh0IjprPWouc05leHQ7bD1zKyhlPGYtMT8iIjoiICIrZy5zUGFnZUJ1dHRvbkRpc2FibGVkKTticmVhaztjYXNlICJsYXN0IjprPWouc0xhc3Q7bD1zKyhlPGYtMT8iIjoiICIrZy5zUGFnZUJ1dHRvbkRpc2FibGVkKTticmVhaztkZWZhdWx0Oms9cysxO2w9ZT09PXM/Zy5zUGFnZUJ1dHRvbkFjdGl2ZToiIn1pZihrIT09bnVsbCl7dT1oKCI8YT4iLHsiY2xhc3MiOmcuc1BhZ2VCdXR0b24rIiAiK2wsImFyaWEtY29udHJvbHMiOmEuc1RhYmxlSWQsImFyaWEtbGFiZWwiOmlbc10sCiJkYXRhLWR0LWlkeCI6bSx0YWJpbmRleDphLmlUYWJJbmRleCxpZDpjPT09MCYmdHlwZW9mIHM9PT0ic3RyaW5nIj9hLnNUYWJsZUlkKyJfIitzOm51bGx9KS5odG1sKGspLmFwcGVuZFRvKGIpO1dhKHUse2FjdGlvbjpzfSx2KTttKyt9fX19LHI7dHJ5e3I9aChiKS5maW5kKEkuYWN0aXZlRWxlbWVudCkuZGF0YSgiZHQtaWR4Iil9Y2F0Y2gobyl7fXAoaChiKS5lbXB0eSgpLGQpO3ImJmgoYikuZmluZCgiW2RhdGEtZHQtaWR4PSIrcisiXSIpLmZvY3VzKCl9fX0pO2guZXh0ZW5kKG0uZXh0LnR5cGUuZGV0ZWN0LFtmdW5jdGlvbihhLGIpe3ZhciBjPWIub0xhbmd1YWdlLnNEZWNpbWFsO3JldHVybiBaYShhLGMpPyJudW0iK2M6bnVsbH0sZnVuY3Rpb24oYSl7aWYoYSYmIShhIGluc3RhbmNlb2YgRGF0ZSkmJighYmMudGVzdChhKXx8IWNjLnRlc3QoYSkpKXJldHVybiBudWxsO3ZhciBiPURhdGUucGFyc2UoYSk7cmV0dXJuIG51bGwhPT1iJiYhaXNOYU4oYil8fE0oYSk/ImRhdGUiOgpudWxsfSxmdW5jdGlvbihhLGIpe3ZhciBjPWIub0xhbmd1YWdlLnNEZWNpbWFsO3JldHVybiBaYShhLGMsITApPyJudW0tZm10IitjOm51bGx9LGZ1bmN0aW9uKGEsYil7dmFyIGM9Yi5vTGFuZ3VhZ2Uuc0RlY2ltYWw7cmV0dXJuIFJiKGEsYyk/Imh0bWwtbnVtIitjOm51bGx9LGZ1bmN0aW9uKGEsYil7dmFyIGM9Yi5vTGFuZ3VhZ2Uuc0RlY2ltYWw7cmV0dXJuIFJiKGEsYywhMCk/Imh0bWwtbnVtLWZtdCIrYzpudWxsfSxmdW5jdGlvbihhKXtyZXR1cm4gTShhKXx8InN0cmluZyI9PT10eXBlb2YgYSYmLTEhPT1hLmluZGV4T2YoIjwiKT8iaHRtbCI6bnVsbH1dKTtoLmV4dGVuZChtLmV4dC50eXBlLnNlYXJjaCx7aHRtbDpmdW5jdGlvbihhKXtyZXR1cm4gTShhKT9hOiJzdHJpbmciPT09dHlwZW9mIGE/YS5yZXBsYWNlKE9iLCIgIikucmVwbGFjZShDYSwiIik6IiJ9LHN0cmluZzpmdW5jdGlvbihhKXtyZXR1cm4gTShhKT9hOiJzdHJpbmciPT09dHlwZW9mIGE/YS5yZXBsYWNlKE9iLAoiICIpOmF9fSk7dmFyIEJhPWZ1bmN0aW9uKGEsYixjLGQpe2lmKDAhPT1hJiYoIWF8fCItIj09PWEpKXJldHVybi1JbmZpbml0eTtiJiYoYT1RYihhLGIpKTthLnJlcGxhY2UmJihjJiYoYT1hLnJlcGxhY2UoYywiIikpLGQmJihhPWEucmVwbGFjZShkLCIiKSkpO3JldHVybiAxKmF9O2guZXh0ZW5kKHYudHlwZS5vcmRlcix7ImRhdGUtcHJlIjpmdW5jdGlvbihhKXtyZXR1cm4gRGF0ZS5wYXJzZShhKXx8MH0sImh0bWwtcHJlIjpmdW5jdGlvbihhKXtyZXR1cm4gTShhKT8iIjphLnJlcGxhY2U/YS5yZXBsYWNlKC88Lio/Pi9nLCIiKS50b0xvd2VyQ2FzZSgpOmErIiJ9LCJzdHJpbmctcHJlIjpmdW5jdGlvbihhKXtyZXR1cm4gTShhKT8iIjoic3RyaW5nIj09PXR5cGVvZiBhP2EudG9Mb3dlckNhc2UoKTohYS50b1N0cmluZz8iIjphLnRvU3RyaW5nKCl9LCJzdHJpbmctYXNjIjpmdW5jdGlvbihhLGIpe3JldHVybiBhPGI/LTE6YT5iPzE6MH0sInN0cmluZy1kZXNjIjpmdW5jdGlvbihhLApiKXtyZXR1cm4gYTxiPzE6YT5iPy0xOjB9fSk7ZGIoIiIpO2guZXh0ZW5kKCEwLG0uZXh0LnJlbmRlcmVyLHtoZWFkZXI6e186ZnVuY3Rpb24oYSxiLGMsZCl7aChhLm5UYWJsZSkub24oIm9yZGVyLmR0LkRUIixmdW5jdGlvbihlLGYsZyxoKXtpZihhPT09Zil7ZT1jLmlkeDtiLnJlbW92ZUNsYXNzKGMuc1NvcnRpbmdDbGFzcysiICIrZC5zU29ydEFzYysiICIrZC5zU29ydERlc2MpLmFkZENsYXNzKGhbZV09PSJhc2MiP2Quc1NvcnRBc2M6aFtlXT09ImRlc2MiP2Quc1NvcnREZXNjOmMuc1NvcnRpbmdDbGFzcyl9fSl9LGpxdWVyeXVpOmZ1bmN0aW9uKGEsYixjLGQpe2goIjxkaXYvPiIpLmFkZENsYXNzKGQuc1NvcnRKVUlXcmFwcGVyKS5hcHBlbmQoYi5jb250ZW50cygpKS5hcHBlbmQoaCgiPHNwYW4vPiIpLmFkZENsYXNzKGQuc1NvcnRJY29uKyIgIitjLnNTb3J0aW5nQ2xhc3NKVUkpKS5hcHBlbmRUbyhiKTtoKGEublRhYmxlKS5vbigib3JkZXIuZHQuRFQiLGZ1bmN0aW9uKGUsCmYsZyxoKXtpZihhPT09Zil7ZT1jLmlkeDtiLnJlbW92ZUNsYXNzKGQuc1NvcnRBc2MrIiAiK2Quc1NvcnREZXNjKS5hZGRDbGFzcyhoW2VdPT0iYXNjIj9kLnNTb3J0QXNjOmhbZV09PSJkZXNjIj9kLnNTb3J0RGVzYzpjLnNTb3J0aW5nQ2xhc3MpO2IuZmluZCgic3Bhbi4iK2Quc1NvcnRJY29uKS5yZW1vdmVDbGFzcyhkLnNTb3J0SlVJQXNjKyIgIitkLnNTb3J0SlVJRGVzYysiICIrZC5zU29ydEpVSSsiICIrZC5zU29ydEpVSUFzY0FsbG93ZWQrIiAiK2Quc1NvcnRKVUlEZXNjQWxsb3dlZCkuYWRkQ2xhc3MoaFtlXT09ImFzYyI/ZC5zU29ydEpVSUFzYzpoW2VdPT0iZGVzYyI/ZC5zU29ydEpVSURlc2M6Yy5zU29ydGluZ0NsYXNzSlVJKX19KX19fSk7dmFyIFliPWZ1bmN0aW9uKGEpe3JldHVybiJzdHJpbmciPT09dHlwZW9mIGE/YS5yZXBsYWNlKC88L2csIiZsdDsiKS5yZXBsYWNlKC8+L2csIiZndDsiKS5yZXBsYWNlKC8iL2csIiZxdW90OyIpOmF9O20ucmVuZGVyPXtudW1iZXI6ZnVuY3Rpb24oYSwKYixjLGQsZSl7cmV0dXJue2Rpc3BsYXk6ZnVuY3Rpb24oZil7aWYoIm51bWJlciIhPT10eXBlb2YgZiYmInN0cmluZyIhPT10eXBlb2YgZilyZXR1cm4gZjt2YXIgZz0wPmY/Ii0iOiIiLGg9cGFyc2VGbG9hdChmKTtpZihpc05hTihoKSlyZXR1cm4gWWIoZik7Zj1NYXRoLmFicyhoKTtoPXBhcnNlSW50KGYsMTApO2Y9Yz9iKyhmLWgpLnRvRml4ZWQoYykuc3Vic3RyaW5nKDIpOiIiO3JldHVybiBnKyhkfHwiIikraC50b1N0cmluZygpLnJlcGxhY2UoL1xCKD89KFxkezN9KSsoPyFcZCkpL2csYSkrZisoZXx8IiIpfX19LHRleHQ6ZnVuY3Rpb24oKXtyZXR1cm57ZGlzcGxheTpZYn19fTtoLmV4dGVuZChtLmV4dC5pbnRlcm5hbCx7X2ZuRXh0ZXJuQXBpRnVuYzpOYixfZm5CdWlsZEFqYXg6cmEsX2ZuQWpheFVwZGF0ZTpsYixfZm5BamF4UGFyYW1ldGVyczp1YixfZm5BamF4VXBkYXRlRHJhdzp2YixfZm5BamF4RGF0YVNyYzpzYSxfZm5BZGRDb2x1bW46R2EsX2ZuQ29sdW1uT3B0aW9uczpqYSwKX2ZuQWRqdXN0Q29sdW1uU2l6aW5nOlUsX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXg6WixfZm5Db2x1bW5JbmRleFRvVmlzaWJsZTokLF9mblZpc2JsZUNvbHVtbnM6YWEsX2ZuR2V0Q29sdW1uczpsYSxfZm5Db2x1bW5UeXBlczpJYSxfZm5BcHBseUNvbHVtbkRlZnM6aWIsX2ZuSHVuZ2FyaWFuTWFwOlksX2ZuQ2FtZWxUb0h1bmdhcmlhbjpLLF9mbkxhbmd1YWdlQ29tcGF0OkZhLF9mbkJyb3dzZXJEZXRlY3Q6Z2IsX2ZuQWRkRGF0YTpOLF9mbkFkZFRyOm1hLF9mbk5vZGVUb0RhdGFJbmRleDpmdW5jdGlvbihhLGIpe3JldHVybiBiLl9EVF9Sb3dJbmRleCE9PWs/Yi5fRFRfUm93SW5kZXg6bnVsbH0sX2ZuTm9kZVRvQ29sdW1uSW5kZXg6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBoLmluQXJyYXkoYyxhLmFvRGF0YVtiXS5hbkNlbGxzKX0sX2ZuR2V0Q2VsbERhdGE6QixfZm5TZXRDZWxsRGF0YTpqYixfZm5TcGxpdE9iak5vdGF0aW9uOkxhLF9mbkdldE9iamVjdERhdGFGbjpRLF9mblNldE9iamVjdERhdGFGbjpSLApfZm5HZXREYXRhTWFzdGVyOk1hLF9mbkNsZWFyVGFibGU6bmEsX2ZuRGVsZXRlSW5kZXg6b2EsX2ZuSW52YWxpZGF0ZTpjYSxfZm5HZXRSb3dFbGVtZW50czpLYSxfZm5DcmVhdGVUcjpKYSxfZm5CdWlsZEhlYWQ6a2IsX2ZuRHJhd0hlYWQ6ZWEsX2ZuRHJhdzpPLF9mblJlRHJhdzpULF9mbkFkZE9wdGlvbnNIdG1sOm5iLF9mbkRldGVjdEhlYWRlcjpkYSxfZm5HZXRVbmlxdWVUaHM6cWEsX2ZuRmVhdHVyZUh0bWxGaWx0ZXI6cGIsX2ZuRmlsdGVyQ29tcGxldGU6ZmEsX2ZuRmlsdGVyQ3VzdG9tOnliLF9mbkZpbHRlckNvbHVtbjp4YixfZm5GaWx0ZXI6d2IsX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoOlFhLF9mbkVzY2FwZVJlZ2V4OnZhLF9mbkZpbHRlckRhdGE6emIsX2ZuRmVhdHVyZUh0bWxJbmZvOnNiLF9mblVwZGF0ZUluZm86Q2IsX2ZuSW5mb01hY3JvczpEYixfZm5Jbml0aWFsaXNlOmdhLF9mbkluaXRDb21wbGV0ZTp0YSxfZm5MZW5ndGhDaGFuZ2U6UmEsX2ZuRmVhdHVyZUh0bWxMZW5ndGg6b2IsCl9mbkZlYXR1cmVIdG1sUGFnaW5hdGU6dGIsX2ZuUGFnZUNoYW5nZTpUYSxfZm5GZWF0dXJlSHRtbFByb2Nlc3Npbmc6cWIsX2ZuUHJvY2Vzc2luZ0Rpc3BsYXk6QyxfZm5GZWF0dXJlSHRtbFRhYmxlOnJiLF9mblNjcm9sbERyYXc6a2EsX2ZuQXBwbHlUb0NoaWxkcmVuOkosX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzOkhhLF9mblRocm90dGxlOnVhLF9mbkNvbnZlcnRUb1dpZHRoOkZiLF9mbkdldFdpZGVzdE5vZGU6R2IsX2ZuR2V0TWF4TGVuU3RyaW5nOkhiLF9mblN0cmluZ1RvQ3NzOngsX2ZuU29ydEZsYXR0ZW46VyxfZm5Tb3J0Om1iLF9mblNvcnRBcmlhOkpiLF9mblNvcnRMaXN0ZW5lcjpWYSxfZm5Tb3J0QXR0YWNoTGlzdGVuZXI6T2EsX2ZuU29ydGluZ0NsYXNzZXM6eGEsX2ZuU29ydERhdGE6SWIsX2ZuU2F2ZVN0YXRlOnlhLF9mbkxvYWRTdGF0ZTpLYixfZm5TZXR0aW5nc0Zyb21Ob2RlOnphLF9mbkxvZzpMLF9mbk1hcDpFLF9mbkJpbmRBY3Rpb246V2EsX2ZuQ2FsbGJhY2tSZWc6eiwKX2ZuQ2FsbGJhY2tGaXJlOnUsX2ZuTGVuZ3RoT3ZlcmZsb3c6U2EsX2ZuUmVuZGVyZXI6UGEsX2ZuRGF0YVNvdXJjZTp5LF9mblJvd0F0dHJpYnV0ZXM6TmEsX2ZuQ2FsY3VsYXRlRW5kOmZ1bmN0aW9uKCl7fX0pO2guZm4uZGF0YVRhYmxlPW07bS4kPWg7aC5mbi5kYXRhVGFibGVTZXR0aW5ncz1tLnNldHRpbmdzO2guZm4uZGF0YVRhYmxlRXh0PW0uZXh0O2guZm4uRGF0YVRhYmxlPWZ1bmN0aW9uKGEpe3JldHVybiBoKHRoaXMpLmRhdGFUYWJsZShhKS5hcGkoKX07aC5lYWNoKG0sZnVuY3Rpb24oYSxiKXtoLmZuLkRhdGFUYWJsZVthXT1ifSk7cmV0dXJuIGguZm4uZGF0YVRhYmxlfSk7Cg=="></script>
<link href="data:text/css;charset=utf-8,%0A%2EtsPlot%2Einactive%20%7B%0Afill%3A%20%23E4E4E4%3B%0Astroke%3A%20%23B7B7B7%3B%0A%7D%0A%2ElegendTreeNode%2Einactive%20%7B%0Afill%3A%20%23FFFFFF%3B%0Astroke%3A%20%23D3D3D3%3B%0A%7D%0A%2ElegendTreeNode%2Egtype%5FphantomRoot%20%7B%0Apointer%2Devents%3A%20none%3B%0Afill%2Dopacity%3A%200%3B%0Astroke%2Dopacity%3A%200%3B%0A%7D%0A%2EgeneTableDIV%20%7B%0Aoverflow%3A%20scroll%3B%0A%7D%0Atd%2C%20tr%2C%20th%20%7B%0Afont%2Dfamily%3A%20Arial%3B%0A%7D%0A%2EdataTables%5Finfo%20%7B%0Afont%2Dfamily%3A%20Arial%3B%20color%3A%20%27%239E9A9A%27%3B%0A%7D%0Alabel%20%7B%0Afont%2Dfamily%3A%20Arial%3B%0A%7D%0A%2EmutationTableDIV%20%2EdataTable%20thead%20th%20%7B%0Afont%2Dweight%3A%20normal%3B%0A%7D%0Atable%20%7B%0Atable%2Dlayout%3A%20fixed%0A%7D%0Atd%20%7B%0Aword%2Dwrap%3A%20break%2Dword%0A%7D%0A%0A%2Esorting%20%7B%0Atext%2Dalign%3A%20left%0A%7D%0A%2Esorting%5Fasc%20%7B%0Atext%2Dalign%3A%20left%0A%7D%0A%2Esorting%5Fdesc%20%7B%0Atext%2Dalign%3A%20left%0A%7D%0A%2Esorting%5Fdisabled%20%7B%0Atext%2Dalign%3A%20left%0A%7D%0A%0A%0A%2Ed3%2Dtip%20%7B%0Aline%2Dheight%3A%201%3B%0Afont%2Dfamily%3A%20Arial%3B%0Apadding%3A%2012px%3B%0Abackground%3A%20%237C7C7C%3B%0Acolor%3A%20%23fff%3B%0Aborder%2Dradius%3A%202px%3B%0A%7D%0A%0A%2Ed3%2Dtip%3Aafter%20%7B%0Abox%2Dsizing%3A%20border%2Dbox%3B%0Adisplay%3A%20inline%3B%0Afont%2Dsize%3A%2010px%3B%0Awidth%3A%20100%25%3B%0Aline%2Dheight%3A%201%3B%0Acolor%3A%20%237C7C7C%3B%0Acontent%3A%20%22%5C25BC%22%3B%0Aposition%3A%20absolute%3B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%0A%2Ed3%2Dtip%2En%3Aafter%20%7B%0Amargin%3A%20%2D1px%200%200%200%3B%0Atop%3A%20100%25%3B%0Aleft%3A%200%3B%0A%7D" rel="stylesheet" />
<script src="data:application/x-javascript;base64,LyogZnVuY3Rpb24gdG8gcnVuIHRpbWVzY2FwZQoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIGZvciB0aGlzIHZpZXcKKiBAcGFyYW0ge051bWJlcn0gd2lkdGggLS0gd2lkdGggb2YgdGhlIHZpZXcKKiBAcGFyYW0ge051bWJlcn0gaGVpZ2h0IC0tIGhlaWdodCBvZiB0aGUgdmlldwoqIEBwYXJhbSB7T2JqZWN0fSB1c2VyQ29uZmlnIC0tIHVzZXIgY29uZmlndXJhdGlvbnMKKi8KZnVuY3Rpb24gX3J1bl90aW1lc2NhcGUodmlld19pZCwgd2lkdGgsIGhlaWdodCwgdXNlckNvbmZpZykgewoKCS8vIGRlZmF1bHRzCgl2YXIgZGVmYXVsdHMgPSB7CgkgICAgcGFkZGluZ0dlbmVyYWw6IDE1LAoJICAgIGxlZ2VuZFdpZHRoOiAxMTAsCgkgICAgdHJlZUhlaWdodDogMTAwLAoJICAgIHRyZWVXaWR0aDogMTAwLAoJICAgIG1heF9yOiA3LCAvLyBtYXhpbXVtIHJhZGl1cyBmb3IgbGVnZW5kIHRyZWUgbm9kZXMKCSAgICBtaW5fcjogMS41LCAvLyBtaW5pbXVtIHJhZGl1cyBmb3IgbGVnZW5kIHRyZWUgbm9kZXMKCSAgICB4QXhpc0hlaWdodDogMzAsCgkgICAgeUF4aXNXaWR0aDogMjAsCgkgICAgc21hbGxNYXJnaW46IDUsCgkgICAgdHJhbnNpdGlvblNwZWVkOiAyMDAsCgkgICAgaXNQb3BPdmVyVmlzaWJsZTogZmFsc2UsCgkgICAgYnV0dG9uOiBmYWxzZSwKCSAgICBncmlkc3RlckJhc2VEaW1lbnNpb246IDEyMCwKCSAgICBwYW5lbF93aWR0aDogMzAsCgkgICAgZm9udFNpemU6IDExLAoJICAgIGNpcmNsZVI6IDIwLAoJICAgIHRocmVzaG9sZDogMC4wMDUsIC8vIGNlbGx1bGFyIHByZXZhbGVuY2UgdGhyZXNob2xkIG9mIHZpc3VhbCBkZXRlY3Rpb24KCSAgICBsZWdlbmRHdHlwZUhlaWdodDogMTMsIC8vIGhlaWdodCBmb3IgZWFjaCBnZW5vdHlwZSBpbiB0aGUgbGVnZW5kCgkgICAgY2xvbmFsVHJhamVjdG9yeUxhYmVsSGVpZ2h0OiA0MiwKCSAgICBjdXJDbG9uZUlEczogW10sIC8vIGFycmF5IG9mIGNsb25lIGlkcyBjdXJyZW50bHkgaW4gdGhlIG11dGF0aW9uIHRhYmxlCgkgICAgbkNsaWNrZWROb2RlczogMCwgLy8gbnVtYmVyIG9mIGNsaWNrZWQgbm9kZXMKCSAgICBwaGFudG9tUm9vdDogInBoYW50b21Sb290IiwKCSAgICB0cmVlTGlua0NvbG91cjogIiNEM0QzRDMiLAoJICAgIHRvcEJhckhlaWdodDogMzAsIC8vIGhlaWdodCBvZiB0b3AgcGFuZWwKCSAgICB0b3BCYXJDb2xvdXI6ICIjRDlEOUQ5IiwKCSAgICB0b3BCYXJIaWdobGlnaHQ6ICIjQzZDNkM2IiwKCSAgICB2aWV3VGl0bGU6ICJUSU1FU0NBUEUiLAoJICAgIHRpdGxlRm9udFNpemU6IDE1Cgl9OwoKCXZpek9iai50cyA9IHt9OyAvLyB2aXpPYmogZm9yIHRpbWVzY2FwZQoJdmFyIGN1clZpek9iaiA9IHZpek9iai50czsKCWN1clZpek9iai52aWV3X2lkID0gdmlld19pZDsKCWN1clZpek9iai5kYXRhID0ge307CgljdXJWaXpPYmoudmlldyA9IHt9OwoKCS8vIHNldCBjb25maWd1cmF0aW9ucwoJY3VyVml6T2JqLmdlbmVyYWxDb25maWcgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMpOwoJdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnOwoKCS8vIGdldCBwYXJhbXMgZnJvbSBSCgljdXJWaXpPYmoudXNlckNvbmZpZyA9IHVzZXJDb25maWc7CgoJLy8gY29uZmlndXJhdGlvbiBiYXNlZCBvbiBhdmFpbGFibGUgZGF0YQoJZGltLmNhbnZhc1NWR1dpZHRoID0gd2lkdGg7CglkaW0uY2FudmFzU1ZHSGVpZ2h0ID0gaGVpZ2h0IC0gZGltLnRvcEJhckhlaWdodDsKCWRpbS50c1NWR0hlaWdodCA9ICghY3VyVml6T2JqLnVzZXJDb25maWcubXV0YXRpb25zX3Byb3ZpZGVkKSA/IAoJICAgICAgICAgICAgICAgICAgICBkaW0uY2FudmFzU1ZHSGVpZ2h0IC0gZGltLnhBeGlzSGVpZ2h0IC0gZGltLnNtYWxsTWFyZ2luIC0gZGltLnBhZGRpbmdHZW5lcmFsKjI6CgkgICAgICAgICAgICAgICAgICAgIDI1MDsKCWRpbS50c1NWR1dpZHRoID0gZGltLmNhbnZhc1NWR1dpZHRoIC0gZGltLmxlZ2VuZFdpZHRoIC0gZGltLnlBeGlzV2lkdGggLSBkaW0uc21hbGxNYXJnaW4gLSBkaW0ucGFkZGluZ0dlbmVyYWw7CglkaW0ueEF4aXNXaWR0aCA9IGRpbS50c1NWR1dpZHRoOwoJZGltLnlBeGlzSGVpZ2h0ID0gZGltLnRzU1ZHSGVpZ2h0OwoJZGltLm11dGF0aW9uVGFibGVIZWlnaHQgPSBkaW0uY2FudmFzU1ZHSGVpZ2h0IC0gZGltLnRzU1ZHSGVpZ2h0IC0gZGltLnNtYWxsTWFyZ2luIC0gMjUgLSBkaW0ueEF4aXNIZWlnaHQ7CglkaW0ubXV0YXRpb25UYWJsZVdpZHRoID0gZGltLnRzU1ZHV2lkdGg7CgoJLy8gYWRqdXN0IGNhbnZhcyBTVkcgaGVpZ2h0IGlmIG11dGF0aW9uIHRhYmxlIGlzIHByZXNlbnQKCWRpbS5jYW52YXNTVkdIZWlnaHQgLT0gKCFjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNfcHJvdmlkZWQpID8gCgkgICAgICAgICAgICAgICAgICAgICAgICAwIDogCgkgICAgICAgICAgICAgICAgICAgICAgICBkaW0ubXV0YXRpb25UYWJsZUhlaWdodDsKCgljb25zb2xlLmxvZygidGltZXNjYXBlIGN1clZpek9iaiIpOwoJY29uc29sZS5sb2coY3VyVml6T2JqKTsKCgkvLyBTRVQgVVAgUEFHRSBMQVlPVVQKCgl2YXIgdG9wQmFyRElWID0gZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLmFwcGVuZCgiZGl2IikKCSAgICAuYXR0cigiY2xhc3MiLCAidG9wQmFyRElWIikKCSAgICAuc3R5bGUoInBvc2l0aW9uIiwgInJlbGF0aXZlIikKCSAgICAuc3R5bGUoIndpZHRoIiwgd2lkdGggKyAicHgiKQoJICAgIC5zdHlsZSgiaGVpZ2h0IiwgZGltLnRvcEJhckhlaWdodCArICJweCIpCgkgICAgLnN0eWxlKCJmbG9hdCIsICJsZWZ0Iik7CgoJdmFyIGNhbnZhc0RJViA9IGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5hcHBlbmQoImRpdiIpCgkgICAgLnN0eWxlKCJoZWlnaHQiLCBkaW0uY2FudmFzU1ZHSGVpZ2h0ICsgInB4IikKCSAgICAuc3R5bGUoIndpZHRoIiwgd2lkdGggKyAicHgiKQoJICAgIC5hdHRyKCJjbGFzcyIsICJkaXYiKQoJICAgIC5hdHRyKCJpZCIsIHZpZXdfaWQpCgkgICAgLnN0eWxlKCJmbG9hdCIsICJsZWZ0Iik7CgoJY3VyVml6T2JqLnZpZXcubXV0YXRpb25UYWJsZURJViA9IGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKQoJICAgIC5hcHBlbmQoImRpdiIpCgkgICAgLmF0dHIoImNsYXNzIiwgIm11dGF0aW9uVGFibGVESVYiKQoJICAgIC5zdHlsZSgicG9zaXRpb24iLCAicmVsYXRpdmUiKQoJICAgIC5zdHlsZSgid2lkdGgiLCBkaW0ubXV0YXRpb25UYWJsZVdpZHRoICsgInB4IikKCSAgICAuc3R5bGUoImhlaWdodCIsIGRpbS5tdXRhdGlvblRhYmxlSGVpZ2h0ICsgInB4IikKCSAgICAuc3R5bGUoImxlZnQiLCAoZGltLnlBeGlzV2lkdGggKyBkaW0uc21hbGxNYXJnaW4pICsgInB4IikKCSAgICAuc3R5bGUoImZsb2F0IiwgImxlZnQiKTsKCgkvLyBjYW52YXMgZm9yIGltYWdlIHBuZyBvdXRwdXQKCXZhciBjYW52YXMgPSBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuYXBwZW5kKCJjYW52YXMiKQoJICAgIC5hdHRyKCJoZWlnaHQiLCBkaW0uY2FudmFzU1ZHSGVpZ2h0ICsgInB4IikKCSAgICAuYXR0cigid2lkdGgiLCB3aWR0aCArICJweCIpCgkgICAgLmF0dHIoInN0eWxlIiwgImRpc3BsYXk6bm9uZSIpOwoKCS8vIFBMT1QgVE9QIFBBTkVMCgoJLy8gc3ZnCgl2YXIgdG9wQmFyU1ZHID0gdG9wQmFyRElWLmFwcGVuZCgic3ZnOnN2ZyIpCgkgICAgLmF0dHIoImNsYXNzIiwgInRvcEJhcl8iICsgdmlld19pZCkKCSAgICAuYXR0cigieCIsIDApCgkgICAgLmF0dHIoInkiLCAwKQoJICAgIC5hdHRyKCJ3aWR0aCIsIHdpZHRoICsgInB4IikKCSAgICAuYXR0cigiaGVpZ2h0IiwgZGltLnRvcEJhckhlaWdodCArICJweCIpOwoKCS8vIGJhY2tncm91bmQgYmFyCgl0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKCSAgICAuYXR0cigieCIsMCkKCSAgICAuYXR0cigieSIsMCkKCSAgICAuYXR0cigid2lkdGgiLCB3aWR0aCArICJweCIpCgkgICAgLmF0dHIoImhlaWdodCIsIGRpbS50b3BCYXJIZWlnaHQpCgkgICAgLmF0dHIoInJ4IiwgMTApCgkgICAgLmF0dHIoInJ5IiwgMTApCgkgICAgLmF0dHIoImZpbGwiLCBkaW0udG9wQmFyQ29sb3VyKTsKCiAJLy8gdG9wIHBhbmVsIHRpdGxlCiAgICB0b3BCYXJTVkcuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAuYXR0cigieCIsIDEwKQogICAgICAgIC5hdHRyKCJ5IiwgZGltLnRvcEJhckhlaWdodC8yKQogICAgICAgIC5hdHRyKCJ0ZXh0LWFuY2hvciIsICJzdGFydCIpCiAgICAgICAgLmF0dHIoImR5IiwgIiswLjM1ZW0iKQogICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCiAgICAgICAgLmF0dHIoImZpbGwiLCAid2hpdGUiKQogICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKQogICAgICAgIC50ZXh0KGRpbS52aWV3VGl0bGUpOwoKCXZhciBkb3dubG9hZEJ1dHRvbldpZHRoID0gODA7IC8vIHdpZHRoIG9mIHRoZSB0b3AgcGFuZWwgZG93bmxvYWQgYnV0dG9uCgl2YXIgcmVzZXRCdXR0b25XaWR0aCA9IDQyOyAvLyB3aWR0aCBvZiB0aGUgdG9wIHBhbmVsIHJlc2V0IGJ1dHRvbgoKCXZhciByZXNldEJ1dHRvbl9iYXNlNjQgPSAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwiICsgIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NE5DandoTFMwZ1IyVnVaWEpoZEc5eU9pQkJaRzlpWlNCSmJHeDFjM1J5WVhSdmNpQXhOQzR3TGpBc0lGTldSeUJGZUhCdmNuUWdVR3gxWnkxSmJpQXVJRk5XUnlCV1pYSnphVzl1T2lBMkxqQXdJRUoxYVd4a0lEUXpNell6S1NBZ0xTMCtEUW84SVVSUFExUlpVRVVnYzNabklGQlZRa3hKUXlBaUxTOHZWek5ETHk5RVZFUWdVMVpISURFdU1TOHZSVTRpSUNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk5SGNtRndhR2xqY3k5VFZrY3ZNUzR4TDBSVVJDOXpkbWN4TVM1a2RHUWlQZzBLUEhOMlp5QjJaWEp6YVc5dVBTSXhMakVpSUdsa1BTSkRZWEJoWHpFaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJZ2VHMXNibk02ZUd4cGJtczlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5MekU1T1RrdmVHeHBibXNpSUhnOUlqQndlQ0lnZVQwaU1IQjRJZzBLQ1NCM2FXUjBhRDBpTlRFeWNIZ2lJR2hsYVdkb2REMGlOVEV5Y0hnaUlIWnBaWGRDYjNnOUlqQWdNQ0ExTVRJZ05URXlJaUJsYm1GaWJHVXRZbUZqYTJkeWIzVnVaRDBpYm1WM0lEQWdNQ0ExTVRJZ05URXlJaUI0Yld3NmMzQmhZMlU5SW5CeVpYTmxjblpsSWo0TkNqeG5QZzBLQ1R4d1lYUm9JR1pwYkd3OUlpTkdSa1pHUmtZaUlHUTlJazAwTXpJdU9UYzFMRGd3TGpBek5HTXRNamN1T1RrNExUSTNMamsyTXkwMk1DNDVNall0TkRjdU9EWXRPVFl1TURNM0xUVTVMamMyTkhZM05TNHhPRGtOQ2drSll6RTJMamt3TkN3NExqUXhOeXd6TWk0NU1qZ3NNVGt1TXpZNUxEUTJMams0TERNekxqUTFObU0zTUM0eE9EZ3NOekF1TWpJMExEY3dMakU0T0N3eE9EUXVNemszTERBc01qVTBMalU0TkdNdE56QXVNVGc1TERjd0xqQTROQzB4T0RRdU1qa3pMRGN3TGpBNE5DMHlOVFF1TlRnM0xEQU5DZ2tKWXkwM01DNHhNVGN0TnpBdU1qVTRMVGN3TGpFeE55MHhPRFF1TXpZeExEQXRNalUwTGpVNE5HTXdMakUzTnkwd0xqSXhNU3d3TGpjMExUQXVOVFl6TERBdU9UZzNMVEF1T0Rob01DNHdOMnczTkM0eU1UY3NPREV1TnpNeFRESXhOQzQxTERndU5VdzRMamt3TlN3ekxqTTFOZzBLQ1Fsc056SXVORFl4TERjMUxqVTRObU10TUM0eU5EY3NNQzQwTWpJdE1DNDJNelFzTUM0NE5EVXRNQzQ1TlRFc01TNHdPVEpqTFRrM0xqTXdOU3c1Tnk0eU55MDVOeTR6TURVc01qVTFMakEzT1N3d0xETTFNaTR6TkRrTkNna0pZemszTGpRME5pdzVOeTR6TnpVc01qVTFMakUxTERrM0xqTTNOU3d6TlRJdU5UWXNNRU0xTXpBdU1qQTVMRE16TlM0eE1UTXNOVE13TGpNeE5Dd3hOemN1TXpBMExEUXpNaTQ1TnpVc09EQXVNRE0wZWlJdlBnMEtQQzluUGcwS1BDOXpkbWMrRFFvPSIKCXZhciBkb3dubG9hZEJ1dHRvbl9iYXNlNjQgPSAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwiICsgIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NE5DandoTFMwZ1IyVnVaWEpoZEc5eU9pQkJaRzlpWlNCSmJHeDFjM1J5WVhSdmNpQXhOQzR3TGpBc0lGTldSeUJGZUhCdmNuUWdVR3gxWnkxSmJpQXVJRk5XUnlCV1pYSnphVzl1T2lBMkxqQXdJRUoxYVd4a0lEUXpNell6S1NBZ0xTMCtEUW84SVVSUFExUlpVRVVnYzNabklGQlZRa3hKUXlBaUxTOHZWek5ETHk5RVZFUWdVMVpISURFdU1TOHZSVTRpSUNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk5SGNtRndhR2xqY3k5VFZrY3ZNUzR4TDBSVVJDOXpkbWN4TVM1a2RHUWlQZzBLUEhOMlp5QjJaWEp6YVc5dVBTSXhMakVpSUdsa1BTSk1ZWGxsY2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lOQ2drZ2QybGtkR2c5SWpVeE1uQjRJaUJvWldsbmFIUTlJalV4TW5CNElpQjJhV1YzUW05NFBTSXdJREFnTlRFeUlEVXhNaUlnWlc1aFlteGxMV0poWTJ0bmNtOTFibVE5SW01bGR5QXdJREFnTlRFeUlEVXhNaUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0RRbzhjRzlzZVdkdmJpQm1hV3hzUFNJalJrWkdSa1pHSWlCd2IybHVkSE05SWpNMU5DNDFMRE16TXk0MUlETXpNeTQxTERNeE15NDFJREkzTVM0NE16VXNNelkxTGpVMk5DQXlOekV1T0RNMUxEY3VPVEUzSURJME1DNHhOalVzTnk0NU1UY2dNalF3TGpFMk5Td3pOalV1TlRZMElERTRNQzQxTERNeE5DNDFJQTBLQ1RFMU55NDFMRE16Tmk0MUlESTFOaXcwTWpZdU1UZzRJQ0l2UGcwS1BIQnZiSGxuYjI0Z1ptbHNiRDBpSTBaR1JrWkdSaUlnY0c5cGJuUnpQU0l5T0M0MUxEUTNNaTQwTVRJZ05EZzVMalVzTkRjeUxqUXhNaUEwT1RBdU5TdzFNRFF1TURneUlESTNMalVzTlRBMExqQTRNaUFpTHo0TkNqeHdiMng1WjI5dUlHWnBiR3c5SWlOR1JrWkdSa1lpSUhCdmFXNTBjejBpTWpZdU5UZ3NNelkyTGpReE1pQTJNeTQwTmpjc016WTJMalF4TWlBMk15NDFORGNzTlRBeUxqVWdNall1TlN3MU1ESXVOU0FpTHo0TkNqeHdiMng1WjI5dUlHWnBiR3c5SWlOR1JrWkdSa1lpSUhCdmFXNTBjejBpTkRVeUxqVXpNeXd6TmpVdU5ERXlJRFE0T1M0ME1Ua3NNelkxTGpReE1pQTBPRGt1TlN3MU1ERXVOU0EwTlRJdU5EVXpMRFV3TVM0MUlDSXZQZzBLUEM5emRtYytEUW89IgoJdmFyIHRpbWVzY2FwZUJ1dHRvbl9iYXNlNjQgPSAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwiICsgIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NE5DandoTFMwZ1IyVnVaWEpoZEc5eU9pQkJaRzlpWlNCSmJHeDFjM1J5WVhSdmNpQXhOQzR3TGpBc0lGTldSeUJGZUhCdmNuUWdVR3gxWnkxSmJpQXVJRk5XUnlCV1pYSnphVzl1T2lBMkxqQXdJRUoxYVd4a0lEUXpNell6S1NBZ0xTMCtEUW84SVVSUFExUlpVRVVnYzNabklGQlZRa3hKUXlBaUxTOHZWek5ETHk5RVZFUWdVMVpISURFdU1TOHZSVTRpSUNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk5SGNtRndhR2xqY3k5VFZrY3ZNUzR4TDBSVVJDOXpkbWN4TVM1a2RHUWlQZzBLUEhOMlp5QjJaWEp6YVc5dVBTSXhMakVpSUdsa1BTSk1ZWGxsY2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lOQ2drZ2QybGtkR2c5SWpnM01IQjRJaUJvWldsbmFIUTlJakk0TUhCNElpQjJhV1YzUW05NFBTSXdJREFnT0Rjd0lESTRNQ0lnWlc1aFlteGxMV0poWTJ0bmNtOTFibVE5SW01bGR5QXdJREFnT0Rjd0lESTRNQ0lnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0RRbzhaR1ZtY3lBZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpFNU9Ua3ZlR2gwYld3aVBnMEtDVHh6ZEhsc1pTQWdkSGx3WlQwaWRHVjRkQzlqYzNNaVBnMEtDUWs4SVZ0RFJFRlVRVnRkWFQ0TkNnazhMM04wZVd4bFBnMEtQQzlrWldaelBnMEtQR1JsWm5NZ0lIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hvZEcxc0lqNE5DZ2s4YzNSNWJHVWdJSFI1Y0dVOUluUmxlSFF2WTNOeklqNDhMM04wZVd4bFBnMEtQQzlrWldaelBnMEtQSEJoZEdnZ1ptbHNiRDBpSTBaR1JrWkdSaUlnYzNSeWIydGxQU0lqUmtaR1JrWkdJaUJrUFNKTk5qY3VOU3d4TXpVdU5EZzNZelExTERBc05EVXRNVEkwTGprNE55dzVNQzB4TWpRdU9UZzNiREFzTUdNNU1Dd3dMRGt3TERBc01UZ3dMREJzTUN3d1l6RTRNQ3d3TFRnMUxEQXNPVFVzTUd3d0xEQU5DZ2wyTWpRNUxqazNOV3d3TERCakxURTRNQ3d3TERBc01DMDVOU3d3YkRBc01HTXRPVEFzTUMwNU1Dd3dMVEU0TUN3d2JEQXNNRU14TVRJdU5Td3lOakF1TkRjMUxERXhNaTQxTERFek5TNDBPRGNzTmpjdU5Td3hNelV1TkRnM0lpOCtEUW84WnlCMGNtRnVjMlp2Y20wOUluUnlZVzV6YkdGMFpTZzNOakFzTUNraVBnMEtQQzluUGcwS1BHY2dkSEpoYm5ObWIzSnRQU0owY21GdWMyeGhkR1VvTnpZd0xESXdPQ2tpUGcwS1BDOW5QZzBLUEM5emRtYytEUW89IgoJdmFyIGNsb25hbFRyYWpCdXR0b25fYmFzZTY0ID0gImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsIiArICJQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpZFhSbUxUZ2lQejROQ2p3aExTMGdSMlZ1WlhKaGRHOXlPaUJCWkc5aVpTQkpiR3gxYzNSeVlYUnZjaUF4TkM0d0xqQXNJRk5XUnlCRmVIQnZjblFnVUd4MVp5MUpiaUF1SUZOV1J5QldaWEp6YVc5dU9pQTJMakF3SUVKMWFXeGtJRFF6TXpZektTQWdMUzArRFFvOElVUlBRMVJaVUVVZ2MzWm5JRkJWUWt4SlF5QWlMUzh2VnpOREx5OUVWRVFnVTFaSElERXVNUzh2UlU0aUlDSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OUhjbUZ3YUdsamN5OVRWa2N2TVM0eEwwUlVSQzl6ZG1jeE1TNWtkR1FpUGcwS1BITjJaeUIyWlhKemFXOXVQU0l4TGpFaUlHbGtQU0pNWVhsbGNsOHhJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGh0Ykc1ek9uaHNhVzVyUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hzYVc1cklpQjRQU0l3Y0hnaUlIazlJakJ3ZUNJTkNna2dkMmxrZEdnOUlqazNNSEI0SWlCb1pXbG5hSFE5SWpJNE1IQjRJaUIyYVdWM1FtOTRQU0l3SURBZ09UY3dJREk0TUNJZ1pXNWhZbXhsTFdKaFkydG5jbTkxYm1ROUltNWxkeUF3SURBZ09UY3dJREk0TUNJZ2VHMXNPbk53WVdObFBTSndjbVZ6WlhKMlpTSStEUW84WkdWbWN5QWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6RTVPVGt2ZUdoMGJXd2lQZzBLQ1R4emRIbHNaU0FnZEhsd1pUMGlkR1Y0ZEM5amMzTWlQZzBLQ1FrOElWdERSRUZVUVZ0ZFhUNE5DZ2s4TDNOMGVXeGxQZzBLUEM5a1pXWnpQZzBLUEdjZ2RISmhibk5tYjNKdFBTSjBjbUZ1YzJ4aGRHVW9NalVzTUNraVBnMEtDVHh3WVhSb0lHWnBiR3c5SWlOR1JrWkdSa1lpSUhOMGNtOXJaVDBpSTBaR1JrWkdSaUlnWkQwaVRTMHlNU3cxTUM0MU1qWmpOemd1TkRFM0xEQXNOemd1TkRFM0xEQXNNVFUyTGpnek15d3diREFzTUVNeU9USXVOalkzTERVd0xqVXlOaXd5T1RJdU5qWTNMREFzTkRRNUxqVXNNR3d3TERBTkNna0pkakV3TVM0d05UUnNNQ3d3WXkweE5UWXVPRE16TERBdE1UVTJMamd6TXkwMU1DNDFNamN0TXpFekxqWTJOeTAxTUM0MU1qZHNNQ3d3UXpVM0xqUXhOeXcxTUM0MU1qWXNOVGN1TkRFM0xEVXdMalV5TmkweU1TdzFNQzQxTWpZaUx6NE5DZ2s4Y0dGMGFDQm1hV3hzUFNJalJrWkdSa1pHSWlCemRISnZhMlU5SWlOR1JrWkdSa1lpSUdROUlrMHRNakVzTWpBMExqTTFNV00zT0M0ME1UY3NNQ3czT0M0ME1UY3ROek11TWpNNExERTFOaTQ0TXpNdE56TXVNak00YkRBc01BMEtDUWxqTVRVMkxqZ3pNeXd3TERFMU5pNDRNek1zTnpNdU1EQTRMRE14TXk0Mk5qY3NOek11TURBNGJEQXNNSFl3TGpRMU5Xd3dMREJqTFRFMU5pNDRNek1zTUMweE5UWXVPRE16TERjekxqQXhNaTB6TVRNdU5qWTNMRGN6TGpBeE1td3dMREFOQ2drSlF6VTNMalF4Tnl3eU56Y3VOVGc0TERVM0xqUXhOeXd5TURRdU16VXhMVEl4TERJd05DNHpOVEVpTHo0TkNqd3ZaejROQ2p4bklIUnlZVzV6Wm05eWJUMGlkSEpoYm5Oc1lYUmxLRGcyTUN3d0tTSStEUW84TDJjK0RRbzhaeUIwY21GdWMyWnZjbTA5SW5SeVlXNXpiR0YwWlNnNE5qQXNNakE0S1NJK0RRbzhMMmMrRFFvOEwzTjJaejROQ2c9PSIKCgl2YXIgcmVzZXRCdXR0b25JY29uV2lkdGggPSBkaW0udG9wQmFySGVpZ2h0IC0gMTA7IC8vIGljb24gc2l6ZSBmb3IgcmVzZXQgYnV0dG9uCgl2YXIgZG93bmxvYWRCdXR0b25JY29uV2lkdGggPSBkaW0udG9wQmFySGVpZ2h0IC0gMTA7IC8vIGljb24gc2l6ZSBmb3IgZG93bmxvYWQgYnV0dG9uCgl2YXIgdGltZXNjYXBlQnV0dG9uSWNvbldpZHRoID0gNTA7IC8vIGljb24gc2l6ZSBmb3IgdGltZXNjYXBlIGJ1dHRvbgoJdmFyIGNsb25hbFRyYWpCdXR0b25JY29uV2lkdGggPSA2MDsgLy8gaWNvbiBzaXplIGZvciB0aW1lc2NhcGUgYnV0dG9uCgoJLy8gU1ZHIGJ1dHRvbgoJdG9wQmFyU1ZHLmFwcGVuZCgicmVjdCIpCgkgICAgLmF0dHIoImNsYXNzIiwgInN2Z0J1dHRvbiIpCgkgICAgLmF0dHIoIngiLCB3aWR0aCAtIGRvd25sb2FkQnV0dG9uV2lkdGgpCgkgICAgLmF0dHIoInkiLCAwKQoJICAgIC5hdHRyKCJ3aWR0aCIsIGRvd25sb2FkQnV0dG9uV2lkdGgpCgkgICAgLmF0dHIoImhlaWdodCIsIGRpbS50b3BCYXJIZWlnaHQpCgkgICAgLmF0dHIoInJ4IiwgMTApCgkgICAgLmF0dHIoInJ5IiwgMTApCgkgICAgLmF0dHIoImZpbGwiLCBkaW0udG9wQmFyQ29sb3VyKQoJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckhpZ2hsaWdodCk7CgkgICAgfSkKCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckNvbG91cik7CgkgICAgfSkKCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIC8vIGRvd25sb2FkIHRoZSBzdmcKCSAgICAgICAgZG93bmxvYWRTVkcoInRpbWVzY2FwZV8iICsgdmlld19pZCk7CgkgICAgfSk7Cgl0b3BCYXJTVkcuYXBwZW5kKCJ0ZXh0IikKCSAgICAuYXR0cigiY2xhc3MiLCAic3ZnQnV0dG9uVGV4dCIpCgkgICAgLmF0dHIoIngiLCB3aWR0aCAtIDEwKQoJICAgIC5hdHRyKCJ5IiwgZGltLnRvcEJhckhlaWdodC8yKQoJICAgIC5hdHRyKCJ0ZXh0LWFuY2hvciIsICJlbmQiKQoJICAgIC5hdHRyKCJkeSIsICIrMC4zNWVtIikKCSAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAiQXJpYWwiKQoJICAgIC5hdHRyKCJmaWxsIiwgIndoaXRlIikKCSAgICAuYXR0cigicG9pbnRlci1ldmVudHMiLCJub25lIikKCSAgICAudGV4dCgiU1ZHIik7Cgl0b3BCYXJTVkcuYXBwZW5kKCJpbWFnZSIpCgkgICAgLmF0dHIoInhsaW5rOmhyZWYiLCBkb3dubG9hZEJ1dHRvbl9iYXNlNjQpCgkgICAgLmF0dHIoIngiLCB3aWR0aCAtIGRvd25sb2FkQnV0dG9uV2lkdGggKyAxMCkKCSAgICAuYXR0cigieSIsIDUpCgkgICAgLmF0dHIoIndpZHRoIiwgZG93bmxvYWRCdXR0b25JY29uV2lkdGgpCgkgICAgLmF0dHIoImhlaWdodCIsIGRvd25sb2FkQnV0dG9uSWNvbldpZHRoKQoJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5zdmdCdXR0b24iKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckhpZ2hsaWdodCk7CgkgICAgfSkKCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5zdmdCdXR0b24iKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckNvbG91cik7CgkgICAgfSkKCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIC8vIGRvd25sb2FkIHRoZSBzdmcKCSAgICAgICAgZG93bmxvYWRTVkcoInRpbWVzY2FwZV8iICsgdmlld19pZCk7CgkgICAgfSk7CgoJLy8gUE5HIGJ1dHRvbgoJdG9wQmFyU1ZHLmFwcGVuZCgicmVjdCIpCgkgICAgLmF0dHIoImNsYXNzIiwgInBuZ0J1dHRvbiIpCgkgICAgLmF0dHIoIngiLCB3aWR0aCAtIGRvd25sb2FkQnV0dG9uV2lkdGgqMikKCSAgICAuYXR0cigieSIsIDApCgkgICAgLmF0dHIoIndpZHRoIiwgZG93bmxvYWRCdXR0b25XaWR0aCkKCSAgICAuYXR0cigiaGVpZ2h0IiwgZGltLnRvcEJhckhlaWdodCkKCSAgICAuYXR0cigicngiLCAxMCkKCSAgICAuYXR0cigicnkiLCAxMCkKCSAgICAuYXR0cigiZmlsbCIsZGltLnRvcEJhckNvbG91cikKCSAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJIaWdobGlnaHQpOwoJICAgIH0pCgkgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpOwoJICAgIH0pCgkgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCl7CgkgICAgICAgIC8vIGRvd25sb2FkIHRoZSBwbmcKCSAgICAgICAgX2Rvd25sb2FkUE5HKCJ0aW1lc2NhcGVfIiArIHZpZXdfaWQsICJ0aW1lc2NhcGVfIiArIHZpZXdfaWQgKyAiLnBuZyIpOwoJICAgIH0pOwoJdG9wQmFyU1ZHLmFwcGVuZCgidGV4dCIpCgkgICAgLmF0dHIoImNsYXNzIiwgInBuZ0J1dHRvblRleHQiKQoJICAgIC5hdHRyKCJ4Iiwgd2lkdGggLSBkb3dubG9hZEJ1dHRvbldpZHRoIC0gMTApCgkgICAgLmF0dHIoInkiLCBkaW0udG9wQmFySGVpZ2h0LzIpCgkgICAgLmF0dHIoInRleHQtYW5jaG9yIiwgImVuZCIpCgkgICAgLmF0dHIoImR5IiwgIiswLjM1ZW0iKQoJICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCgkgICAgLmF0dHIoImZpbGwiLCAid2hpdGUiKQoJICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKQoJICAgIC50ZXh0KCJQTkciKTsKCXRvcEJhclNWRy5hcHBlbmQoImltYWdlIikKCSAgICAuYXR0cigieGxpbms6aHJlZiIsIGRvd25sb2FkQnV0dG9uX2Jhc2U2NCkKCSAgICAuYXR0cigieCIsIHdpZHRoIC0gMipkb3dubG9hZEJ1dHRvbldpZHRoICsgMTApCgkgICAgLmF0dHIoInkiLCA1KQoJICAgIC5hdHRyKCJ3aWR0aCIsIGRvd25sb2FkQnV0dG9uSWNvbldpZHRoKQoJICAgIC5hdHRyKCJoZWlnaHQiLCBkb3dubG9hZEJ1dHRvbkljb25XaWR0aCkKCSAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIucG5nQnV0dG9uIikuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJIaWdobGlnaHQpOwoJICAgIH0pCgkgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIucG5nQnV0dG9uIikuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpOwoJICAgIH0pCgkgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewoJICAgICAgICAvLyBkb3dubG9hZCB0aGUgcG5nCgkgICAgICAgIF9kb3dubG9hZFBORygidGltZXNjYXBlXyIgKyB2aWV3X2lkLCAidGltZXNjYXBlXyIgKyB2aWV3X2lkICsgIi5wbmciKTsKCSAgICB9KTsKCgkvLyBUaW1lU2NhcGUgYnV0dG9uCgl0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKCSAgICAuYXR0cigiY2xhc3MiLCAidHNCdXR0b24iKQoJICAgIC5hdHRyKCJ4Iiwgd2lkdGggLSBkb3dubG9hZEJ1dHRvbldpZHRoKjIgLSByZXNldEJ1dHRvbldpZHRoKQoJICAgIC5hdHRyKCJ5IiwgMCkKCSAgICAuYXR0cigid2lkdGgiLCByZXNldEJ1dHRvbldpZHRoKQoJICAgIC5hdHRyKCJoZWlnaHQiLCBkaW0udG9wQmFySGVpZ2h0KQoJICAgIC5hdHRyKCJyeCIsIDEwKQoJICAgIC5hdHRyKCJyeSIsIDEwKQoJICAgIC5hdHRyKCJmaWxsIixkaW0udG9wQmFyQ29sb3VyKQoJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckhpZ2hsaWdodCk7CgkgICAgfSkKCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckNvbG91cik7CgkgICAgfSkKCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKXsKCSAgICAgICAgLy8gY2hhbmdlIHZpZXcKCSAgICAgICAgX3N3ZWVwQ2xpY2soY3VyVml6T2JqKTsKCSAgICAgICAgCgkgICAgfSkKCSAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgLnRleHQoIlZpZXcgU3dpdGNoIik7Cgl0b3BCYXJTVkcuYXBwZW5kKCJpbWFnZSIpCgkgICAgLmF0dHIoImNsYXNzIiwgInRpbWVzY2FwZUljb24iKQoJICAgIC5hdHRyKCJ4bGluazpocmVmIiwgdGltZXNjYXBlQnV0dG9uX2Jhc2U2NCkKCSAgICAuYXR0cigieCIsIHdpZHRoIC0gMipkb3dubG9hZEJ1dHRvbldpZHRoIC0gcmVzZXRCdXR0b25XaWR0aCArIDUpCgkgICAgLmF0dHIoInkiLCAtMTApCgkgICAgLmF0dHIoIndpZHRoIiwgdGltZXNjYXBlQnV0dG9uSWNvbldpZHRoKQoJICAgIC5hdHRyKCJoZWlnaHQiLCB0aW1lc2NhcGVCdXR0b25JY29uV2lkdGgpCgkgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbigpIHsKCSAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRzQnV0dG9uIikuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJIaWdobGlnaHQpOwoJICAgIH0pCgkgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIudHNCdXR0b24iKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckNvbG91cik7CgkgICAgfSkKCSAgICAuYXR0cigib3BhY2l0eSIsIDApIC8vIHN0YXJ0IHdpdGggb3BhY2l0eSB6ZXJvCgkgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewoJICAgICAgICAvLyBjaGFuZ2UgdmlldwoJICAgICAgICBfc3dlZXBDbGljayhjdXJWaXpPYmopOwoKCSAgICAgICAgLy8gdHVybiBvZmYgb3BhY2l0eSAmIHBvaW50ZXIgZXZlbnRzCgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKQoJICAgICAgICAgICAgLmF0dHIoIm9wYWNpdHkiLCAwKQoJICAgICAgICAgICAgLmF0dHIoInBvaW50ZXItZXZlbnRzIiwgIm5vbmUiKTsKCgkgICAgICAgIC8vIHR1cm4gb24gY2xvbmFsIHRyYWplY3RvcnkgaWNvbiBvcGFjaXR5ICYgcG9pbnRlciBldmVudHMKCSAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLmNsb25hbFRyYWpJY29uIikKCSAgICAgICAgICAgIC5hdHRyKCJvcGFjaXR5IiwgMSkKCSAgICAgICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJhdXRvIik7CgkgICAgfSkKCSAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgLnRleHQoIlZpZXcgU3dpdGNoIik7Cgl0b3BCYXJTVkcuYXBwZW5kKCJpbWFnZSIpCgkgICAgLmF0dHIoImNsYXNzIiwgImNsb25hbFRyYWpJY29uIikKCSAgICAuYXR0cigieGxpbms6aHJlZiIsIGNsb25hbFRyYWpCdXR0b25fYmFzZTY0KQoJICAgIC5hdHRyKCJ4Iiwgd2lkdGggLSAyKmRvd25sb2FkQnV0dG9uV2lkdGggLSByZXNldEJ1dHRvbldpZHRoICsgNSkKCSAgICAuYXR0cigieSIsIC0xNSkKCSAgICAuYXR0cigid2lkdGgiLCBjbG9uYWxUcmFqQnV0dG9uSWNvbldpZHRoKQoJICAgIC5hdHRyKCJoZWlnaHQiLCBjbG9uYWxUcmFqQnV0dG9uSWNvbldpZHRoKQoJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi50c0J1dHRvbiIpLmF0dHIoImZpbGwiLCBkaW0udG9wQmFySGlnaGxpZ2h0KTsKCSAgICB9KQoJICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKCSAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRzQnV0dG9uIikuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpOwoJICAgIH0pCgkgICAgLmF0dHIoIm9wYWNpdHkiLCAxKSAvLyBzdGFydCB3aXRoIG9wYWNpdHkgMQoJICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbigpIHsKCSAgICAgICAgLy8gY2hhbmdlIHZpZXcKCSAgICAgICAgX3N3ZWVwQ2xpY2soY3VyVml6T2JqKTsKCgkgICAgICAgIC8vIHR1cm4gb2ZmIG9wYWNpdHkgJiBwb2ludGVyIGV2ZW50cwoJICAgICAgICBkMy5zZWxlY3QodGhpcykKCSAgICAgICAgICAgIC5hdHRyKCJvcGFjaXR5IiwgMCkKCSAgICAgICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJub25lIik7CgoJICAgICAgICAvLyB0dXJuIG9uIHRpbWVzY2FwZSBpY29uIG9wYWNpdHkgJiBwb2ludGVyIGV2ZW50cwoJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIudGltZXNjYXBlSWNvbiIpCgkgICAgICAgICAgICAuYXR0cigib3BhY2l0eSIsIDEpCgkgICAgICAgICAgICAuYXR0cigicG9pbnRlci1ldmVudHMiLCAiYXV0byIpOwoKCSAgICB9KQoJICAgIC5hcHBlbmQoInRpdGxlIikKICAgICAgICAudGV4dCgiVmlldyBTd2l0Y2giKTsKCgkvLyByZXNldCBidXR0b24gKG9ubHkgaWYgbXV0YXRpb25zIGFyZSBwcm92aWRlZCkKCWlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNfcHJvdmlkZWQpIHsKCQl0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKCQkgICAgLmF0dHIoImNsYXNzIiwgInJlc2V0QnV0dG9uIikKCQkgICAgLmF0dHIoIngiLCB3aWR0aCAtIDIqZG93bmxvYWRCdXR0b25XaWR0aCAtIDIqcmVzZXRCdXR0b25XaWR0aCkKCQkgICAgLmF0dHIoInkiLCAwKQoJCSAgICAuYXR0cigid2lkdGgiLCByZXNldEJ1dHRvbldpZHRoKQoJCSAgICAuYXR0cigiaGVpZ2h0IiwgZGltLnRvcEJhckhlaWdodCkKCQkgICAgLmF0dHIoInJ4IiwgMTApCgkJICAgIC5hdHRyKCJyeSIsIDEwKQoJCSAgICAuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpCgkJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkJICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJIaWdobGlnaHQpOwoJCSAgICB9KQoJCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkJICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpOwoJCSAgICB9KQoJCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CgkJICAgICAgICAvLyBiYWNrZ3JvdW5kIGNsaWNrCgkJICAgICAgICBfYmFja2dyb3VuZENsaWNrKGN1clZpek9iaik7CgkJICAgIH0pOwoJCXRvcEJhclNWRy5hcHBlbmQoImltYWdlIikKCQkgICAgLmF0dHIoInhsaW5rOmhyZWYiLCByZXNldEJ1dHRvbl9iYXNlNjQpCgkJICAgIC5hdHRyKCJ4Iiwgd2lkdGggLSAyKmRvd25sb2FkQnV0dG9uV2lkdGggLSAyKnJlc2V0QnV0dG9uV2lkdGggKyAocmVzZXRCdXR0b25XaWR0aCAtIHJlc2V0QnV0dG9uSWNvbldpZHRoKS8yKQoJCSAgICAuYXR0cigieSIsIDUpCgkJICAgIC5hdHRyKCJ3aWR0aCIsIHJlc2V0QnV0dG9uSWNvbldpZHRoKQoJCSAgICAuYXR0cigiaGVpZ2h0IiwgcmVzZXRCdXR0b25JY29uV2lkdGgpCgkJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIucmVzZXRCdXR0b24iKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckhpZ2hsaWdodCk7CgkJICAgIH0pCgkJICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKCQkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5yZXNldEJ1dHRvbiIpLmF0dHIoImZpbGwiLCBkaW0udG9wQmFyQ29sb3VyKTsKCQkgICAgfSkKCQkgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewoJCSAgICAgICAgLy8gYmFja2dyb3VuZCBjbGljawoJCSAgICAgICAgX2JhY2tncm91bmRDbGljayhjdXJWaXpPYmopOwoJCSAgICB9KTsKCX0KCgkvLyBPVEhFUiBTVkdTCgoJdmFyIGNhbnZhc1NWRyA9IGNhbnZhc0RJVgoJICAgIC5hcHBlbmQoInN2ZzpzdmciKSAgCgkgICAgLmF0dHIoImNsYXNzIiwgInRpbWVzY2FwZV8iICsgdmlld19pZCkgICAgIAoJICAgIC5hdHRyKCJ4IiwgMCkKCSAgICAuYXR0cigieSIsIDApIAoJICAgIC5hdHRyKCJ3aWR0aCIsIGRpbS5jYW52YXNTVkdXaWR0aCkgCgkgICAgLmF0dHIoImhlaWdodCIsIGRpbS5jYW52YXNTVkdIZWlnaHQpCgkgICAgLnN0eWxlKCJmbG9hdCIsICJsZWZ0Iik7CgoJdmFyIHRzU1ZHID0gY2FudmFzU1ZHCgkgICAgLmFwcGVuZCgiZyIpICAKCSAgICAuYXR0cigiY2xhc3MiLCAidHNTVkciKSAgICAgCgkgICAgLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoIiArIChkaW0ueUF4aXNXaWR0aCArIGRpbS5zbWFsbE1hcmdpbikgKyAiLCIgKyBkaW0ucGFkZGluZ0dlbmVyYWwgKyAiKSIpOwoKCXZhciB5QXhpc1NWRyA9IGNhbnZhc1NWRwoJICAgIC5hcHBlbmQoImciKSAKCSAgICAuYXR0cigiY2xhc3MiLCAieUF4aXNTVkciKSAgICAgIAoJICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIgKyAwICsgIiwiICsgZGltLnBhZGRpbmdHZW5lcmFsICsgIikiKTsKCgl2YXIgeEF4aXNTVkcgPSBjYW52YXNTVkcKCSAgICAuYXBwZW5kKCJnIikgCgkgICAgLmF0dHIoImNsYXNzIiwgInhBeGlzU1ZHIikgICAgICAKCSAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiICsgMCArICIsIiArIChkaW0udHNTVkdIZWlnaHQgKyBkaW0uc21hbGxNYXJnaW4gKyBkaW0ucGFkZGluZ0dlbmVyYWwpICsgIikiKTsKCgl2YXIgdHNMZWdlbmRTVkcgPSBjYW52YXNTVkcKCSAgICAuYXBwZW5kKCJnIikgCgkgICAgLmF0dHIoImNsYXNzIiwgInRzTGVnZW5kU1ZHIikKCSAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiICsgKGRpbS55QXhpc1dpZHRoICsgZGltLnNtYWxsTWFyZ2luICsgZGltLnRzU1ZHV2lkdGggKyBkaW0ucGFkZGluZ0dlbmVyYWwpICsgCgkgICAgICAgICIsIiArIGRpbS5wYWRkaW5nR2VuZXJhbCArICIpIik7CgoJdmFyIHRzVHJlZSA9IGNhbnZhc1NWRwoJICAgIC5hcHBlbmQoImciKSAKCSAgICAuYXR0cigiY2xhc3MiLCAidHNUcmVlU1ZHIikvLyBtb3ZlIHRoZSB0cmVlIFNWRyBpbiB0aGUgeC1kaXJlY3Rpb24gcGFzdCB0aW1lc2NhcGUKCSAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiICsgKGRpbS55QXhpc1dpZHRoICsgZGltLnNtYWxsTWFyZ2luICsgZGltLnRzU1ZHV2lkdGggKyBkaW0ucGFkZGluZ0dlbmVyYWwpICsgCgkgICAgICAgICIsIiArIGRpbS5wYWRkaW5nR2VuZXJhbCArICIpIik7CgoJY3VyVml6T2JqLnZpZXcuY2FudmFzU1ZHID0gY2FudmFzU1ZHOwoJY3VyVml6T2JqLnZpZXcueEF4aXNTVkcgPSB4QXhpc1NWRzsKCWN1clZpek9iai52aWV3LnlBeGlzU1ZHID0geUF4aXNTVkc7CgljdXJWaXpPYmoudmlldy50c1NWRyA9IHRzU1ZHOwoJY3VyVml6T2JqLnZpZXcudHNMZWdlbmRTVkcgPSB0c0xlZ2VuZFNWRzsKCWN1clZpek9iai52aWV3LnRzVHJlZSA9IHRzVHJlZTsKCgoJLy8gR0VUIENPTlRFTlQKCgkvLyBleHRyYWN0IGFsbCBpbmZvIGZyb20gdHJlZSBhYm91dCBub2RlcywgZWRnZXMsIGFuY2VzdG9ycywgZGVzY2VuZGFudHMKCV9nZXRUcmVlSW5mbyhjdXJWaXpPYmopOwoKCS8vIGdldCBtdXRhdGlvbiBkYXRhIGluIGJldHRlciBmb3JtYXQKCWlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNfcHJvdmlkZWQpIHsKCSAgICBfcmVmb3JtYXRNdXRhdGlvbnMoY3VyVml6T2JqKTsKCgkJLy8gZ2V0IGNvbHVtbiBuYW1lcyAoZGVwZW5kaW5nIG9uIHRoZSBhdmFpbGFibGUgZGF0YSwgd2hpY2ggY29sdW1ucyB3aWxsIGJlIHNob3duKQogICAgICAgIGRpbS5tdXRhdGlvbkNvbHVtbnMgPSBbIHsgImRhdGEiOiAiZW1wdHkiLCAidGl0bGUiOiAiQ2xvbmUiLCAiYlNvcnRhYmxlIjogZmFsc2UsICJkZWZhdWx0Q29udGVudCI6ICIiIH0gXTsKICAgICAgICB2YXIgY29sdW1uTmFtZXMgPSBbXTsKICAgICAgICBPYmplY3Qua2V5cyhjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNbMF0pLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgIHZhciB0aXRsZSA9IHRvVGl0bGVDYXNlKGtleS5yZXBsYWNlKC9fL2csICcgJykpLnJlcGxhY2UoLyBJZCQvZywgJyBJRCcpOyAvLyBjYXBpdGFsaXplIHRoZSB3aG9sZSB3b3JkICJJRCIKICAgICAgICAgICAgdmFyIG5ld0NvbHVtbiA9IHsgImRhdGEiOiBrZXksICJ0aXRsZSI6IHRpdGxlLCAiZGVmYXVsdENvbnRlbnQiOiAiIiB9OwogICAgICAgICAgICBpZiAoa2V5ID09ICJjbG9uZV9pZCIpIHsgLy8gbWFrZSBzdXJlIGNsb25lX2lkIGlzIGluc2VydGVkIG5leHQgdG8gImVtcHR5Iiwgd2hpY2ggd2lsbCBiZWNvbWUgdGhlIGNsb25lIHN2ZyBjaXJjbGUKICAgICAgICAgICAgCWRpbS5tdXRhdGlvbkNvbHVtbnMuc3BsaWNlKDEsIDAsIG5ld0NvbHVtbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIAlkaW0ubXV0YXRpb25Db2x1bW5zLnB1c2gobmV3Q29sdW1uKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoJfQoKCS8vIGdldCB0aW1lcG9pbnRzLCBwcmVwZW5kIGEgIlQwIiB0aW1lcG9pbnQgdG8gcmVwcmVzZW50IHRoZSB0aW1lcG9pbnQgYmVmb3JlIGFueSBkYXRhIG9yaWdpbmF0ZWQKCXZhciB0aW1lcG9pbnRzID0gXy51bmlxKF8ucGx1Y2soY3VyVml6T2JqLnVzZXJDb25maWcuY2xvbmFsX3ByZXYsICJ0aW1lcG9pbnQiKSk7Cgl0aW1lcG9pbnRzLnVuc2hpZnQoIlQwIik7CgljdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzID0gdGltZXBvaW50czsKCgkvLyBnZXQgY2VsbHVsYXIgcHJldmFsZW5jZSBpbmZvCglfZ2V0Q1BEYXRhKGN1clZpek9iaik7CgoJLy8gZ2V0IGVtZXJnZW5jZSB2YWx1ZXMgJiB0aW1lcG9pbnRzIGZvciBlYWNoIGdlbm90eXBlCgljdXJWaXpPYmouZGF0YS5lbWVyZ2VuY2VfdmFsdWVzID0gX2dldEVtZXJnZW5jZVZhbHVlcyhjdXJWaXpPYmopOwoJY3VyVml6T2JqLmRhdGEuZW1lcmdlbmNlX3RwcyA9IF9nZXRFbWVyZ2VuY2VUaW1lcG9pbnRzKGN1clZpek9iaik7CgoJLy8gY29udmVydCB0aW1lLWNlbnRyaWMgY2VsbHVsYXIgcHJldmFsZW5jZSBkYXRhIGludG8gZ2Vub3R5cGUtY2VudHJpYyBjZWxsdWxhciBwcmV2YWxlbmNlIGRhdGEKCV9nZXRHZW5vdHlwZUNQRGF0YShjdXJWaXpPYmopOwoKCS8vIGdldCB0aGUgbGF5b3V0IG9mIHRoZSB0cmFkaXRpb25hbCB0aW1lc2NhcGUKCV9nZXRMYXlvdXQoY3VyVml6T2JqKTsKCgkvLyBnZXQgcGF0aHMgZm9yIHBsb3R0aW5nCglfZ2V0UGF0aHMoY3VyVml6T2JqKTsKCgkvLyBnZXQgY2VsbHVsYXIgcHJldmFsZW5jZSBsYWJlbHMKCWN1clZpek9iai5kYXRhLnRzX3RyYWRfbGFiZWxzID0gX2dldFRyYWRpdGlvbmFsQ1BMYWJlbHMoY3VyVml6T2JqKTsKCWN1clZpek9iai5kYXRhLnRzX3NlcF9sYWJlbHMgPSBfZ2V0U2VwYXJhdGVDUExhYmVscyhjdXJWaXpPYmopOwoKCS8vIFNFVCBDT05URU5UCgoJLy8gdGlwcyAoZm9yIFZBRiBhbmQgbm9kZSBnZW5vdHlwZXMpCgljdXJWaXpPYmoudmFmVGlwcyA9IFtdOwoJdmFyIG5vZGVUaXAgPSBkMy50aXAoKQoJICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKQoJICAgIC5vZmZzZXQoWy0xMCwwXSkKCSAgICAuaHRtbChmdW5jdGlvbihkKSB7CgkgICAgICAgIHJldHVybiAiPHNwYW4+IiArIGQgKyAiPC9zcGFuPiI7CgkgICAgfSk7ICAKCWQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi50aW1lc2NhcGVfIiArIHZpZXdfaWQpLmNhbGwobm9kZVRpcCk7CgoJLy8gZ2V0IGNvbG91ciBzY2hlbWUKCV9nZXRQaHlsb0NvbG91cnMoY3VyVml6T2JqKTsKCXZhciBjb2xvdXJfYXNzaWdubWVudCA9IGN1clZpek9iai52aWV3LmNvbG91cl9hc3NpZ25tZW50LAoJICAgIGFscGhhX2NvbG91cl9hc3NpZ25tZW50ID0gY3VyVml6T2JqLnZpZXcuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQ7CgoJLy8gY29sb3VyIHBhdGhzCglfY29sb3VyUGF0aHMoY3VyVml6T2JqKTsKCgkvLyBwbG90IGxpZ2h0IGdyZXkgdGltZXNjYXBlIGJhY2tncm91bmQKCWN1clZpek9iai52aWV3LnRzU1ZHCgkgICAgLmFwcGVuZCgicmVjdCIpCgkgICAgLmF0dHIoIngiLCAwKQoJICAgIC5hdHRyKCJ5IiwgMCkKCSAgICAuYXR0cigiaGVpZ2h0IiwgZGltLnRzU1ZHSGVpZ2h0KQoJICAgIC5hdHRyKCJ3aWR0aCIsIGRpbS50c1NWR1dpZHRoKQoJICAgIC5hdHRyKCJmaWxsIiwgIiNGN0Y3RjciKTsKCgkvLyBwbG90IHRpbWVzY2FwZSBkYXRhCgljdXJWaXpPYmoudmlldy50c1NWRwoJCS5hcHBlbmQoImciKQoJCS5hdHRyKCJjbGFzcyIsICJ0c1Bsb3RHIHRyYWRpdGlvbmFsIikgLy8gc3RhcnQgd2l0aCB0cmFkaXRpb25hbCBwbG90CgkgICAgLnNlbGVjdEFsbCgnLnRzUGxvdCcpCgkgICAgLmRhdGEoY3VyVml6T2JqLmRhdGEuYmV6aWVyX3BhdGhzLCBmdW5jdGlvbihkKSB7CgkgICAgICAgIHJldHVybiBkLmd0eXBlOwoJICAgIH0pCgkgICAgLmVudGVyKCkuYXBwZW5kKCdwYXRoJykKCSAgICAuYXR0cignY2xhc3MnLCBmdW5jdGlvbihkKSB7IHJldHVybiAndHNQbG90IGd0eXBlXycgKyBkLmd0eXBlOyB9KSAKCSAgICAuYXR0cignZCcsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQucGF0aDsgfSkKCSAgICAuYXR0cignZmlsbCcsIGZ1bmN0aW9uKGQpIHsgCgkgICAgICAgIHJldHVybiBkLmZpbGw7CgkgICAgfSkgCgkgICAgLmF0dHIoJ3N0cm9rZScsIGZ1bmN0aW9uKGQpIHsgCgkgICAgICAgIHJldHVybiBkLnN0cm9rZTsKCSAgICB9KQoJICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oZCkgewoJICAgICAgICBpZiAoIWRpbS5zZWxlY3RPbiAmJiAhZGltLm11dFNlbGVjdE9uICYmIF9jaGVja0ZvckNlbGxTY2FwZVNlbGVjdGlvbnModmlld19pZCkpIHsKCSAgICAgICAgCV90c01vdXNlb3Zlckdlbm90eXBlKGQuZ3R5cGUsIGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgCV9zaG93TGFiZWxzKGQuZ3R5cGUsIGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgfQoJICAgIH0pCgkgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgIWRpbS5tdXRTZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgkgICAgICAgIAlfdHNNb3VzZW91dEdlbm90eXBlKGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgCV9oaWRlTGFiZWxzKGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgfQoJICAgIH0pOwoKCS8vIFBMT1QgUEVSVFVSQkFUSU9OUyBJTkZPCgoJLy8gcGxvdCBsYWJlbHMKCWN1clZpek9iai52aWV3LnhBeGlzU1ZHCgkgICAgLnNlbGVjdEFsbCgnLnBlcnRMYWJlbCcpCgkgICAgLmRhdGEoY3VyVml6T2JqLnVzZXJDb25maWcucGVydHVyYmF0aW9ucykKCSAgICAuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKQoJICAgIC5hdHRyKCdjbGFzcycsICdwZXJ0TGFiZWwnKQoJICAgIC5hdHRyKCd4JywgZnVuY3Rpb24oZCkgeyAKCSAgICAgICAgdmFyIHByZXZUUF9pZHggPSBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmluZGV4T2YoZC5wcmV2X3RwKTsKCSAgICAgICAgcmV0dXJuICgocHJldlRQX2lkeCArIDAuNSkgLyAoY3VyVml6T2JqLmRhdGEudGltZXBvaW50cy5sZW5ndGgtMSkpICogKGRpbS50c1NWR1dpZHRoKSArIAoJICAgICAgICAgICAgZGltLnNtYWxsTWFyZ2luICsgZGltLnlBeGlzV2lkdGg7IAoJICAgIH0pCgkgICAgLmF0dHIoJ3knLCAwKQoJICAgIC5hdHRyKCdkeScsICcuNzFlbScpCgkgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpCgkgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKCSAgICAuYXR0cignZm9udC1zaXplJywgJzExcHgnKQoJICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQucGVydF9uYW1lOyB9KQoJICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oZCkgewoJICAgICAgICBpZiAoIWRpbS5zZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgkgICAgICAgICAgICAvLyBwbG90IGd1aWRlCgkgICAgICAgICAgICBjdXJWaXpPYmoudmlldy50c1NWRwoJICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2xpbmUnKQoJICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKCkgeyByZXR1cm4gJ3BlcnRHdWlkZSBwZXJ0XycgKyBkLnBlcnRfbmFtZTsgfSkKCSAgICAgICAgICAgICAgICAuYXR0cigneDEnLCBmdW5jdGlvbigpIHsgCgkgICAgICAgICAgICAgICAgICAgIHZhciBwcmV2VFBfaWR4ID0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cy5pbmRleE9mKGQucHJldl90cCk7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHByZXZUUF9pZHggKyAwLjUpIC8gKGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMubGVuZ3RoLTEpKSAqIChkaW0udHNTVkdXaWR0aCk7IAoJICAgICAgICAgICAgICAgIH0pCgkgICAgICAgICAgICAgICAgLmF0dHIoJ3gyJywgZnVuY3Rpb24oKSB7IAoJICAgICAgICAgICAgICAgICAgICB2YXIgcHJldlRQX2lkeCA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMuaW5kZXhPZihkLnByZXZfdHApOwoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChwcmV2VFBfaWR4ICsgMC41KSAvIChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aC0xKSkgKiAoZGltLnRzU1ZHV2lkdGgpOyAKCSAgICAgICAgICAgICAgICB9KQoJICAgICAgICAgICAgICAgIC5hdHRyKCd5MScsIDApCgkgICAgICAgICAgICAgICAgLmF0dHIoJ3kyJywgZGltLnRzU1ZHSGVpZ2h0KQoJICAgICAgICAgICAgICAgIC5hdHRyKCdzdHJva2UnLCAnZ3JleScpCgkgICAgICAgICAgICAgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsICcxLjVweCcpCgkgICAgICAgICAgICAgICAgLnN0eWxlKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7CgkgICAgICAgIH0KCSAgICB9KQoJICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbihkKSB7CgkgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmIF9jaGVja0ZvckNlbGxTY2FwZVNlbGVjdGlvbnModmlld19pZCkpIHsKCSAgICAgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkKCSAgICAgICAgICAgICAgICAuc2VsZWN0QWxsKCIucGVydEd1aWRlLnBlcnRfIiArIGQucGVydF9uYW1lKS5yZW1vdmUoKTsKCSAgICAgICAgfQoJICAgIH0pOwoKCS8vIFBMT1QgVElNRVBPSU5UIEdVSURFUwoKCgkvLyBwbG90IHRpbWUgcG9pbnQgZ3VpZGVzCgljdXJWaXpPYmoudmlldy50c1NWRwoJCS5hcHBlbmQoJ2cnKQoJCS5hdHRyKCJjbGFzcyIsICJ0cEd1aWRlc0ciKQoJCS5zZWxlY3RBbGwoIi50cEd1aWRlIikKCQkuZGF0YShjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzKQoJCS5lbnRlcigpCgkgICAgLmFwcGVuZCgnbGluZScpCgkgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gJ3RwR3VpZGUgdHBfJyArIGQ7IH0pCgkgICAgLmF0dHIoJ3gxJywgZnVuY3Rpb24oZCxpKSB7IHJldHVybiAoaSAvIChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aCAtIDEpKSAqIGRpbS50c1NWR1dpZHRoOyB9KQoJICAgIC5hdHRyKCd4MicsIGZ1bmN0aW9uKGQsaSkgeyByZXR1cm4gKGkgLyAoY3VyVml6T2JqLmRhdGEudGltZXBvaW50cy5sZW5ndGggLSAxKSkgKiBkaW0udHNTVkdXaWR0aDsgfSkKCSAgICAuYXR0cigneTEnLCAwKQoJICAgIC5hdHRyKCd5MicsIGRpbS50c1NWR0hlaWdodCkKCSAgICAuYXR0cignc3Ryb2tlJywgJ3doaXRlJykKCSAgICAuYXR0cignc3Ryb2tlLW9wYWNpdHknLCAwLjQpCgkgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsICcxLjVweCcpCgkgICAgLnN0eWxlKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7CgoJLy8gUExPVCBBWEVTCgoJLy8gcGxvdCB4LWF4aXMgbGFiZWxzCgljdXJWaXpPYmoudmlldy54QXhpc1NWRwoJICAgIC5zZWxlY3RBbGwoJy54QXhpc0xhYmVscycpCgkgICAgLmRhdGEoY3VyVml6T2JqLmRhdGEudGltZXBvaW50cykKCSAgICAuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKQoJICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICd4QXhpc0xhYmVscyB0cF8nICsgZDsgfSkKCSAgICAuYXR0cigneCcsIGZ1bmN0aW9uKGQsIGkpIHsgCgkgICAgICAgIHJldHVybiAoaSAvIChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aC0xKSkgKiAoZGltLnRzU1ZHV2lkdGgpICsgZGltLnNtYWxsTWFyZ2luICsgZGltLnlBeGlzV2lkdGg7IAoJICAgIH0pCgkgICAgLmF0dHIoJ3knLCAwKQoJICAgIC5hdHRyKCdkeScsICcuNzFlbScpCgkgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpCgkgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKCSAgICAuYXR0cignZm9udC1zaXplJywgJzExcHgnKQoJICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgCgkgICAgICAgIC8vIGdldCBvcmlnaW5hbCBsYWJlbCAoc3BhY2VzIHdlcmUgcmVwbGFjZWQgd2l0aCB1bmRlcnNjb3JlcykKCSAgICAgICAgdmFyIHRwID0gKGQgPT0gIlQwIikgPyAiVDAiIDoKCSAgICAgICAgICAgIF8uZmluZFdoZXJlKGN1clZpek9iai51c2VyQ29uZmlnLnRpbWVwb2ludF9tYXAsIHsic3BhY2VfcmVwbGFjZWRfdGltZXBvaW50IjogZH0pLm9yaWdpbmFsX3RpbWVwb2ludDsKCSAgICAgICAgcmV0dXJuIHRwOwoJICAgIH0pCgkgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbihkLCBpKSB7CgkgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmIF9jaGVja0ZvckNlbGxTY2FwZVNlbGVjdGlvbnModmlld19pZCkpIHsKCSAgICAgICAgCS8vIGhpZ2hsaWdodCB0aW1lcG9pbnQgZ3VpZGUKCSAgICAgICAgCV9obFRwR3VpZGUodmlld19pZCwgZCk7CgoJICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IHRob3NlIG5vZGVzIHdpdGggdGhpcyB0aW1lcG9pbnQgaW4gc2luZ2xlIGNlbGwgdmlzCgkgICAgICAgICAgICBpZiAodHlwZW9mIF9tb3VzZW92ZXJUcCA9PSAnZnVuY3Rpb24nKSB7CgkgICAgICAgICAgICAJX21vdXNlb3ZlclRwKGQsIGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0pCgkgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgX2NoZWNrRm9yQ2VsbFNjYXBlU2VsZWN0aW9ucyh2aWV3X2lkKSkgewoJICAgICAgICAgICAgLy8gaGlkZSB0aW1lcG9pbnQgZ3VpZGUKCSAgICAgICAgCV9oaWRlVHBHdWlkZXModmlld19pZCk7CgoJICAgICAgICAgICAgLy8gcmVzZXQgc2luZ2xlIGNlbGwgdmlzCgkgICAgICAgICAgICBpZiAodHlwZW9mIF9tb3VzZW91dFRwID09ICdmdW5jdGlvbicpIHsKCSAgICAgICAgICAgIAlfbW91c2VvdXRUcChjdXJWaXpPYmoudmlld19pZCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9KQoJICAgIC5zdHlsZSgiY3Vyc29yIiwgImRlZmF1bHQiKTsKCgkvLyBwbG90IHktYXhpcyB0aXRsZQoJY3VyVml6T2JqLnZpZXcueUF4aXNTVkcKCSAgICAuYXBwZW5kKCd0ZXh0JykKCSAgICAuYXR0cignY2xhc3MnLCAnYXhpc1RpdGxlIHlBeGlzJykKCSAgICAuYXR0cigneCcsIDApCgkgICAgLmF0dHIoJ3knLCAwKQoJICAgIC5hdHRyKCdkeScsICcuMzVlbScpCgkgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpCgkgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKCSAgICAuYXR0cignZm9udC1zaXplJywgZGltLnRpdGxlRm9udFNpemUpCgkgICAgLmF0dHIoJ2ZvbnQtd2VpZ2h0JywgJ2JvbGQnKQoJICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAidHJhbnNsYXRlKCIgKyAoZGltLnlBeGlzV2lkdGgvMikgKyAiLCAiICsgKGRpbS50c1NWR0hlaWdodC8yKSArICIpIHJvdGF0ZSgtOTApIikKCSAgICAudGV4dChmdW5jdGlvbigpIHsgCgkgICAgICAgIHJldHVybiBjdXJWaXpPYmoudXNlckNvbmZpZy55YXhpc190aXRsZTsKCSAgICB9KTsKCgkvLyBwbG90IHgtYXhpcyB0aXRsZQoJY3VyVml6T2JqLnZpZXcueEF4aXNTVkcKCSAgICAuYXBwZW5kKCd0ZXh0JykKCSAgICAuYXR0cignY2xhc3MnLCAnYXhpc1RpdGxlIHhBeGlzJykKCSAgICAuYXR0cigneCcsIGRpbS55QXhpc1dpZHRoICsgZGltLnNtYWxsTWFyZ2luICsgZGltLnhBeGlzV2lkdGgvMikKCSAgICAuYXR0cigneScsIDI1KQoJICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKQoJICAgIC5hdHRyKCdmb250LWZhbWlseScsICdBcmlhbCcpCgkgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIGRpbS50aXRsZUZvbnRTaXplKQoJICAgIC5hdHRyKCdmb250LXdlaWdodCcsICdib2xkJykKCSAgICAudGV4dChmdW5jdGlvbigpIHsgCgkgICAgICAgIHJldHVybiBjdXJWaXpPYmoudXNlckNvbmZpZy54YXhpc190aXRsZTsKCSAgICB9KTsKCgoJLy8gUExPVCBUUkVFIEdMWVBICgoJLy8gcGxvdCB0cmVlIHRpdGxlCgl2YXIgdHJlZVRpdGxlID0gY3VyVml6T2JqLnVzZXJDb25maWcucGh5bG9nZW55X3RpdGxlLnNwbGl0KCIgIik7Cgl2YXIgdHJlZVRpdGxlU3BhY2luZyA9IDI7IC8vIHNwYWNpbmcgYmV0d2VlbiB0aXRsZSB3b3JkcyAKCXRyZWVUaXRsZS5mb3JFYWNoKGZ1bmN0aW9uKHdvcmQsIHdvcmRfaSkgewoJCWN1clZpek9iai52aWV3LnRzVHJlZQoJCSAgICAuYXBwZW5kKCd0ZXh0JykKCQkgICAgLmF0dHIoJ2NsYXNzJywgJ3RyZWVUaXRsZScpCgkJICAgIC5hdHRyKCd4JywgMCkKCQkgICAgLmF0dHIoJ3knLCB3b3JkX2kqKGRpbS50aXRsZUZvbnRTaXplICsgdHJlZVRpdGxlU3BhY2luZykpCgkJICAgIC5hdHRyKCdkeScsICcuNzFlbScpCgkJICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdsZWZ0JykKCQkgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKCQkgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIGRpbS50aXRsZUZvbnRTaXplKQoJCSAgICAuYXR0cignZm9udC13ZWlnaHQnLCAnYm9sZCcpCgkJICAgIC50ZXh0KHdvcmQpOyAJCQoJfSkKCgoJLy8gZDMgdHJlZSBsYXlvdXQKCXZhciB0cmVlUiA9IDQsCgkgICAgdHJlZVBhZGRpbmcgPSAxMCwKCSAgICB0cmVlVGl0bGVIZWlnaHQgPSB0cmVlVGl0bGUubGVuZ3RoICogKGRpbS50aXRsZUZvbnRTaXplICsgdHJlZVRpdGxlU3BhY2luZyksCgkgICAgdHJlZUxheW91dCA9IGQzLmxheW91dC50cmVlKCkgICAgICAgICAgIAoJICAgICAgICAuc2l6ZShbZGltLnRyZWVIZWlnaHQgLSB0cmVlUGFkZGluZywgZGltLnRyZWVXaWR0aCAtIHRyZWVQYWRkaW5nXSk7IAoKCS8vIGdldCBub2RlIHJhZGl1cyBmb3IgbGVnZW5kIHBoeWxvZ2VueSAoNyA9PSAjIHBpeGVscyBiZXR3ZWVuIG5vZGVzKQoJdmFyIHRyZWVfaGVpZ2h0ID0gY3VyVml6T2JqLmRhdGEudHJlZV9oZWlnaHQ7CglkaW0ubGVnZW5kTm9kZV9yID0gKCgoZGltLnRyZWVXaWR0aC10cmVlUGFkZGluZykgLSA3KnRyZWVfaGVpZ2h0KS90cmVlX2hlaWdodCkvMjsKCWRpbS5sZWdlbmROb2RlX3IgPSAoZGltLmxlZ2VuZE5vZGVfciA+IGRpbS5tYXhfcikgPyBkaW0ubWF4X3IgOiBkaW0ubGVnZW5kTm9kZV9yOwoJZGltLmxlZ2VuZE5vZGVfciA9IChkaW0ubGVnZW5kTm9kZV9yIDwgZGltLm1pbl9yKSA/IGRpbS5taW5fciA6IGRpbS5sZWdlbmROb2RlX3I7CgoJLy8gZ2V0IG5vZGVzIGFuZCBsaW5rcwoJdmFyIHJvb3QgPSAkLmV4dGVuZCh7fSwgY3VyVml6T2JqLmRhdGEudHJlZVN0cnVjdHVyZSksIC8vIGNvcHkgdHJlZSBpbnRvIG5ldyB2YXJpYWJsZQoJICAgIG5vZGVzID0gdHJlZUxheW91dC5ub2Rlcyhyb290KSwgCgkgICAgbGlua3MgPSB0cmVlTGF5b3V0LmxpbmtzKG5vZGVzKTsgICAKCgkvLyBzd2FwIHggYW5kIHkgZGlyZWN0aW9uCglub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKCSAgICBub2RlLnRtcCA9IG5vZGUueTsKCSAgICBub2RlLnkgPSBub2RlLnggKyAodHJlZVBhZGRpbmcvMikgKyB0cmVlVGl0bGVIZWlnaHQ7CgkgICAgbm9kZS54ID0gbm9kZS50bXAgKyAodHJlZVBhZGRpbmcvMik7CgkgICAgZGVsZXRlIG5vZGUudG1wOwoJfSk7CgoJLy8gY3JlYXRlIGxpbmtzCgljdXJWaXpPYmoubGlua19pZHMgPSBbXTsKCXZhciBsaW5rID0gY3VyVml6T2JqLnZpZXcudHNUcmVlLmFwcGVuZCgiZyIpCgkgICAgLmNsYXNzZWQoInRyZWVMaW5rcyIsIHRydWUpCgkgICAgLnNlbGVjdEFsbCgiLmxlZ2VuZFRyZWVMaW5rIikgICAgICAgICAgICAgICAgICAKCSAgICAuZGF0YShsaW5rcykgICAgICAgICAgICAgICAgICAgCgkgICAgLmVudGVyKCkuYXBwZW5kKCJwYXRoIikgICAgICAgICAgICAgICAgICAgCgkgICAgLmF0dHIoImNsYXNzIiwgZnVuY3Rpb24oZCkgeyAKCSAgICAgICAgZC5saW5rX2lkID0gInRyZWVMaW5rX3NvdXJjZV8iICsgZC5zb3VyY2UuaWQgKyAiX3RhcmdldF8iICsgZC50YXJnZXQuaWQ7CgkgICAgICAgIGN1clZpek9iai5saW5rX2lkcy5wdXNoKGQubGlua19pZCk7CgkgICAgICAgIHJldHVybiAibGVnZW5kVHJlZUxpbmsgIiArIGQubGlua19pZDsKCSAgICB9KQoJICAgIC5hdHRyKCdzdHJva2UnLCBkaW0udHJlZUxpbmtDb2xvdXIpCgkgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsICczcHgnKQoJICAgIC5hdHRyKCdmaWxsJywgJ25vbmUnKSAgICAgICAgICAgICAgICAKCSAgICAuYXR0cigiZCIsIF9lbGJvdykKCSAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgLy8gd2UncmUgbm90IHNlbGVjdGluZyBub2RlcyBvciBtdXRhdGlvbnMKCSAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgIWRpbS5tdXRTZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgoJICAgICAgICAgICAgLy8gaW5hY3RpdmF0ZSBhbGwgZ2Vub3R5cGVzIAoJICAgICAgICAgICAgX3RzSW5hY3RpdmF0ZUdlbm90eXBlcyhjdXJWaXpPYmoudmlld19pZCk7CgoJICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IGFsbCBlbGVtZW50cyBkb3duc3RyZWFtIG9mIGxpbmsKCSAgICAgICAgICAgIF9wcm9wYWdhdGVkRWZmZWN0cyhjdXJWaXpPYmosIGQubGlua19pZCwgY3VyVml6T2JqLmxpbmtfaWRzLCAiZG93bnN0cmVhbSIpOwoJICAgICAgICB9CgkgICAgfSkKCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIC8vIHdlJ3JlIG5vdCBzZWxlY3Rpbmcgbm9kZXMgb3IgbXV0YXRpb25zCgkgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmICFkaW0ubXV0U2VsZWN0T24gJiYgX2NoZWNrRm9yQ2VsbFNjYXBlU2VsZWN0aW9ucyh2aWV3X2lkKSkgewoJICAgICAgICAgICAgX3RzTW91c2VvdXRHZW5vdHlwZShjdXJWaXpPYmoudmlld19pZCk7CgkgICAgICAgIH0KCSAgICB9KTsgCgoJLy8gY3JlYXRlIG5vZGVzCgl2YXIgbm9kZSA9IGN1clZpek9iai52aWV3LnRzVHJlZS5zZWxlY3RBbGwoIi5sZWdlbmRUcmVlTm9kZSIpICAgICAgICAgICAgICAgICAgCgkgICAgLmRhdGEobm9kZXMpICAgICAgICAgICAgICAgICAgIAoJICAgIC5lbnRlcigpCgkgICAgLmFwcGVuZCgiY2lyY2xlIikgICAgIAoJICAgIC5hdHRyKCJjeCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueH0pCgkgICAgLmF0dHIoImN5IiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC55fSkgICAgICAgICAgICAgIAoJICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICJsZWdlbmRUcmVlTm9kZSBndHlwZV8iICsgZC5pZDsgfSkKCSAgICAuYXR0cigiZmlsbCIsIGZ1bmN0aW9uKGQpIHsKCSAgICAJZC5maWxsID0gKGQuaWQgPT0gZGltLnBoYW50b21Sb290KSA/ICJub25lIiA6IGFscGhhX2NvbG91cl9hc3NpZ25tZW50W2QuaWRdOwoJICAgICAgICByZXR1cm4gZC5maWxsOwoJICAgIH0pCgkgICAgLmF0dHIoJ3N0cm9rZScsIGZ1bmN0aW9uKGQpIHsKCSAgICAJZC5zdHJva2UgPSAoZC5pZCA9PSBkaW0ucGhhbnRvbVJvb3QpID8gIm5vbmUiIDogY29sb3VyX2Fzc2lnbm1lbnRbZC5pZF07CgkgICAgICAgIHJldHVybiBkLnN0cm9rZTsKCSAgICB9KQoJICAgIC5hdHRyKCJpZCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc2NfaWQ7IH0pCgkgICAgLmF0dHIoInIiLCBkaW0ubGVnZW5kTm9kZV9yICsgInB4IikKCSAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgLy8gc2hvdyBub2RlIGdlbm90eXBlIHRvb2x0aXAKCSAgICAgICAgdmFyIGNsb25lX25hbWUgPSAvLyBnZXQgb3JpZ2luYWwgc2FtcGxlIG5hbWUgKHNwYWNlcyBtYXkgaGF2ZSBiZWVuIHJlcGxhY2VkIHdpdGggdW5kZXJzY29yZXMpCgkgICAgICAgICAgICBfLmZpbmRXaGVyZShjdXJWaXpPYmoudXNlckNvbmZpZy5jbG9uZV9pZF9tYXAsIHsic3BhY2VfcmVwbGFjZWRfY2xvbmVfaWQiOiBkLmlkfSkub3JpZ2luYWxfY2xvbmVfaWQ7CgkgICAgICAgIG5vZGVUaXAuc2hvdygiQ2xvbmU6ICIgKyBjbG9uZV9uYW1lKTsKCgkgICAgICAgIC8vIGlmIHdlJ3JlIHNlbGVjdGluZyBub2RlcwoJICAgICAgICBpZiAoZGltLm5DbGlja2VkTm9kZXMgPiAwICYmIGQuaWQgIT0gZGltLnBoYW50b21Sb290KSB7CgkgICAgICAgICAgICAvLyBoaWdobGlnaHQgbm9kZSBpbiB0aGUgbGVnZW5kCgkgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykKCSAgICAgICAgICAgICAgICAuYXR0cignZmlsbCcsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGFscGhhX2NvbG91cl9hc3NpZ25tZW50W2QuaWRdOyB9KQoJICAgICAgICAgICAgICAgIC5hdHRyKCdzdHJva2UnLCBmdW5jdGlvbihkKSB7IHJldHVybiBjb2xvdXJfYXNzaWdubWVudFtkLmlkXTsgfSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gd2UncmUgbm90IHNlbGVjdGluZyBub2RlcyBvciBtdXRhdGlvbnMgLSBoaWdobGlnaHQgZ2Vub3R5cGUKCSAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgIWRpbS5tdXRTZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgkgICAgICAgICAgICBfdHNNb3VzZW92ZXJHZW5vdHlwZShkLmlkLCBjdXJWaXpPYmoudmlld19pZCk7CgkgICAgICAgICAgICBfc2hvd0xhYmVscyhkLmlkLCBjdXJWaXpPYmoudmlld19pZCk7CgkgICAgICAgIH0KCSAgICB9KQoJICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbihkKSB7CgkgICAgICAgIC8vIGhpZGUgbm9kZSBnZW5vdHlwZQoJICAgICAgICBub2RlVGlwLmhpZGUoKTsKCgkgICAgICAgIC8vIHdlJ3JlIG5vdCBzZWxlY3Rpbmcgbm9kZXMgb3IgbXV0YXRpb25zIC0gbW91c2VvdXQgYXMgbm9ybWFsCgkgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmICFkaW0ubXV0U2VsZWN0T24gJiYgX2NoZWNrRm9yQ2VsbFNjYXBlU2VsZWN0aW9ucyh2aWV3X2lkKSkgewoJICAgICAgICAJX3RzTW91c2VvdXRHZW5vdHlwZShjdXJWaXpPYmoudmlld19pZCk7CiAgIAkgCQkJX2hpZGVMYWJlbHMoY3VyVml6T2JqLnZpZXdfaWQpOwoJICAgICAgICB9CgkgICAgfSkKCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oZCkgewoJICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbXV0YXRpb25zIGFuZCB3ZSdyZSBub3Qgc2VsZWN0aW5nIGFueSBvZiB0aGVtCgkgICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNfcHJvdmlkZWQgJiYgIWRpbS5tdXRTZWxlY3RPbikgewoKCSAgICAgICAgICAgIGRpbS5zZWxlY3RPbiA9IHRydWU7CgkgICAgICAgICAgICBkaW0ubkNsaWNrZWROb2RlcysrOyAvLyBpbmNyZW1lbnQgdGhlIG51bWJlciBvZiBjbGlja2VkIG5vZGVzCgoJICAgICAgICAgICAgLy8gcmVzZXQgdmlldyAoZ2V0IHJpZCBvZiBhbnkgbGFiZWxzLCBldGMuKQoJICAgICAgICAgICAgX2hpZGVMYWJlbHMoY3VyVml6T2JqLnZpZXdfaWQpOwoKCSAgICAgICAgICAgIC8vIGdldCBkYXRhIGZvciB0aGlzIGNsb25lCgkgICAgICAgICAgICB2YXIgZmlsdGVyZWRfbXV0cyA9IAoJICAgICAgICAgICAgICAgIF8uZmlsdGVyKGN1clZpek9iai5kYXRhLm11dGF0aW9ucywgZnVuY3Rpb24obXV0KSB7IHJldHVybiBtdXQuY2xvbmVfaWQgPT0gZC5pZDsgfSk7CgoJICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBubyBkYXRhIGZvciB0aGlzIGNsb25lLCBhZGQgYSByb3cgb2YgIk5vbmUiCgkgICAgICAgICAgICBpZiAoZmlsdGVyZWRfbXV0cy5sZW5ndGggPT09IDApIHsgCgkgICAgICAgICAgICAgICAgZmlsdGVyZWRfbXV0cyA9IFt7fV07CgkgICAgICAgICAgICAgICAgZGltLm11dGF0aW9uQ29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbCkgewoJICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZF9tdXRzWzBdW2NvbC5kYXRhXSA9IChjb2wuZGF0YSA9PSAiZW1wdHkiKSA/ICIiIDogIk5vbmUiOwoJICAgICAgICAgICAgICAgIH0pCgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaWx0ZXJlZF9tdXRzWzBdLmNsb25lX2lkID0gZC5pZDsKCgkgICAgICAgICAgICAvLyBpZiBpdCdzIHRoZSBmaXJzdCBjbGlja2VkIG5vZGUKCSAgICAgICAgICAgIGlmIChkaW0ubkNsaWNrZWROb2RlcyA9PSAxKSB7CgkgICAgICAgICAgICAgICAgLy8gZGVsZXRlIGV4aXN0aW5nIGRhdGEgdGFibGUKCSAgICAgICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQgKyAiX211dGF0aW9uVGFibGUiICsgIl93cmFwcGVyIikucmVtb3ZlKCk7ICAgCgoJICAgICAgICAgICAgICAgIC8vIHBsb3QgZmlsdGVyZWQgZGF0YSB0YWJsZQoJICAgICAgICAgICAgICAgIF9tYWtlTXV0YXRpb25UYWJsZShjdXJWaXpPYmosIGN1clZpek9iai52aWV3Lm11dGF0aW9uVGFibGVESVYsIGZpbHRlcmVkX211dHMsCgkgICAgICAgICAgICAgICAgICAgIGRpbS5tdXRhdGlvblRhYmxlSGVpZ2h0KTsgCgoJICAgICAgICAgICAgICAgIC8vIGluYWN0aXZhdGUgYWxsIGdlbm90eXBlcwoJICAgICAgICAgICAgICAgIF90c0luYWN0aXZhdGVHZW5vdHlwZXMoY3VyVml6T2JqLnZpZXdfaWQpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gb3RoZXJ3aXNlCgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBhZGQgdG8gZXhpc3RpbmcgZGF0YSB0YWJsZQoJICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9ICQoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQgKyAiX211dGF0aW9uVGFibGUiKS5EYXRhVGFibGUoKTsKCSAgICAgICAgICAgICAgICB0YWJsZS5yb3dzLmFkZChmaWx0ZXJlZF9tdXRzKS5kcmF3KGZhbHNlKTsKCgkgICAgICAgICAgICAgICAgLy8gYWRkIHRoaXMgY2xvbmUgaWQgdG8gdGhlIGxpc3Qgb2YgY2xvbmUgaWRzIGluIHRoZSBtdXRhdGlvbiB0YWJsZQoJICAgICAgICAgICAgICAgIGRpbS5jdXJDbG9uZUlEcyA9IGRpbS5jdXJDbG9uZUlEcy5jb25jYXQoXy5wbHVjayhmaWx0ZXJlZF9tdXRzLCAiY2xvbmVfaWQiKSk7CgoJICAgICAgICAgICAgICAgIC8vIHBsb3QgY2xvbmUgc3ZnIGNpcmNsZXMgaW4gbXV0YXRpb24gdGFibGUKCSAgICAgICAgICAgICAgICBfYWRkQ2xvbmVTVkdzVG9UYWJsZShjdXJWaXpPYmosIGRpbS5jdXJDbG9uZUlEcyk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IHRoaXMgY2xvbmUKCSAgICAgICAgICAgIF90c0hpZ2hsaWdodEdlbm90eXBlKGQuaWQsIGN1clZpek9iai52aWV3X2lkKTsKCgkgICAgICAgICAgICBkMy5ldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCSAgICAgICAgfQoJICAgIH0pOwoKCS8vIENSRUFURSBDTE9OQUwgUFJFVkFMRU5DRSBMQUJFTFMKICAgIF9jcmVhdGVMYWJlbHMoY3VyVml6T2JqLCBjdXJWaXpPYmouZGF0YS50c190cmFkX2xhYmVscyk7CiAgICBfY3JlYXRlTGFiZWxzKGN1clZpek9iaiwgY3VyVml6T2JqLmRhdGEudHNfc2VwX2xhYmVscyk7CgoKCS8vIE1VVEFUSU9OIFRBQkxFCgoJLy8gaWYgbXV0YXRpb25zIGFyZSBzcGVjaWZpZWQgYnkgdGhlIHVzZXIKCWlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnMgIT0gIk5BIikgewoKCSAgICAvLyBtYWtlIHRoZSB0YWJsZQoJICAgIF9tYWtlTXV0YXRpb25UYWJsZShjdXJWaXpPYmosIGN1clZpek9iai52aWV3Lm11dGF0aW9uVGFibGVESVYsIGN1clZpek9iai5kYXRhLm11dGF0aW9ucywKCSAgICAgICAgZGltLm11dGF0aW9uVGFibGVIZWlnaHQpOwoJfQoKCS8vICoqKioqKioqIEhFTFBFUiBGVU5DVElPTlMgKioqKioqKiogLy8KCgkvLyBEMyBFRkZFQ1RTIEZVTkNUSU9OUwoKCS8qIGZ1bmN0aW9uIHRvIGNoZWNrIGZvciBzaW5nbGUgY2VsbCB2aWV3ZXIgc2VsZWN0aW9ucwoJKi8KCWZ1bmN0aW9uIF9jaGVja0ZvckNlbGxTY2FwZVNlbGVjdGlvbnModmlld19pZCkgewoJCXJldHVybiAodHlwZW9mIF9jaGVja0ZvclNlbGVjdGlvbnMgIT09ICJmdW5jdGlvbiIgfHwgLy8gaWYgbm8gY2VsbFNjYXBlLCByZXR1cm4gdHJ1ZQogICAgICAgIAkJKHR5cGVvZiBfY2hlY2tGb3JTZWxlY3Rpb25zID09PSAiZnVuY3Rpb24iICYmIF9jaGVja0ZvclNlbGVjdGlvbnMoY3VyVml6T2JqLnZpZXdfaWQpKSk7IC8vIGlmIGNlbGxTY2FwZSwgY2hlY2sgZm9yIGl0cyBzZWxlY3Rpb25zCgl9CgoJLyogZnVuY3Rpb24gZm9yIGdlbm90eXBlIG1vdXNlb3ZlcgoJKiBAcGFyYW0ge1N0cmluZ30gZ3R5cGUgLS0gZ2Vub3R5cGUgdG8gaGlnaGxpZ2h0CgkqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIG9mIGN1cnJlbnQgdmlldwoJKi8KCWZ1bmN0aW9uIF90c01vdXNlb3Zlckdlbm90eXBlKGd0eXBlLCB2aWV3X2lkKSB7CgoJICAgIF90c0luYWN0aXZhdGVHZW5vdHlwZXModmlld19pZCk7CgkgICAgX3RzSGlnaGxpZ2h0R2Vub3R5cGUoZ3R5cGUsIHZpZXdfaWQpOwoJfQoKCS8qIGZ1bmN0aW9uIGZvciBnZW5vdHlwZSBtb3VzZW92ZXIKCSogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CgkqLwoJZnVuY3Rpb24gX3RzTW91c2VvdXRHZW5vdHlwZSh2aWV3X2lkKSB7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHJlZS5ub2RlIikuY2xhc3NlZCgiaW5hY3RpdmUiLCBmYWxzZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUiKS5jbGFzc2VkKCJhY3RpdmUiLCBmYWxzZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZSIpLmNsYXNzZWQoImFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kR3JvdXBSZWN0IikuY2xhc3NlZCgiYWN0aXZlIiwgZmFsc2UpOwoJICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50c1Bsb3QiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kVHJlZU5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuaW5kaWMiKS5hdHRyKCJmaWxsLW9wYWNpdHkiLCAwKTsKCX0KCgkvKiBmdW5jdGlvbiB0byBoaWdobGlnaHQgYSBwYXJ0aWN1bGFyIGdlbm90eXBlCgkqIEBwYXJhbSB7U3RyaW5nfSBndHlwZSAtLSBnZW5vdHlwZSB0byBoaWdobGlnaHQKCSogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CgkqLwoJZnVuY3Rpb24gX3RzSGlnaGxpZ2h0R2Vub3R5cGUoZ3R5cGUsIHZpZXdfaWQpIHsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuaW5kaWMuZ3R5cGVfIiArIGd0eXBlKS5hdHRyKCJmaWxsLW9wYWNpdHkiLCAxKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubm9kZS5ndHlwZV8iICsgZ3R5cGUpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwoJICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGUuZ3R5cGVfIiArIGd0eXBlKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kR3JvdXBSZWN0Lmd0eXBlXyIgKyBndHlwZSkuY2xhc3NlZCgiYWN0aXZlIiwgdHJ1ZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRzUGxvdC5ndHlwZV8iICsgZ3R5cGUpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwoJICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRUcmVlTm9kZS5ndHlwZV8iICsgZ3R5cGUpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGluYWN0aXZhdGUgYWxsIGdlbm90eXBlcwoJKiBAcGFyYW0ge1N0cmluZ30gdmlld19pZCAtLSBpZCBvZiBjdXJyZW50IHZpZXcKCSovCglmdW5jdGlvbiBfdHNJbmFjdGl2YXRlR2Vub3R5cGVzKHZpZXdfaWQpIHsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubm9kZSIpLmNsYXNzZWQoImluYWN0aXZlIiwgdHJ1ZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZSIpLmNsYXNzZWQoImluYWN0aXZlIiwgdHJ1ZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZEdyb3VwUmVjdCIpLmNsYXNzZWQoImFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHNQbG90IikuY2xhc3NlZCgiaW5hY3RpdmUiLCB0cnVlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kVHJlZU5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIHRydWUpOwoJfQoKCgkvKiByZWN1cnNpdmUgZnVuY3Rpb24gdG8gcGVyZm9ybSBkb3duc3RyZWFtIG9yIHVwc3RyZWFtIGVmZmVjdHMgb24gbGVnZW5kIHRyZWUgbGluawoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqIC0tIHZpek9iaiBmb3IgdGhlIGN1cnJlbnQgdmlldwoJKiBAcGFyYW0ge1N0cmluZ30gbGlua19pZCAtLSBpZCBmb3IgdGhlIGxpbmsgdGhhdCdzIGN1cnJlbnRseSBoaWdobGlnaHRlZAoJKiBAcGFyYW0ge0FycmF5fSBsaW5rX2lkcyAtLSBpZHMgZm9yIGFsbCBsaW5rcyBpbiB0cmVlCgkqIEBwYXJhbSB7U3RyaW5nfSBzdHJlYW1fZGlyZWN0aW9uIC0tICJkb3duc3RyZWFtIiBvciAidXBzdHJlYW0iCgkqLwoJZnVuY3Rpb24gX3Byb3BhZ2F0ZWRFZmZlY3RzKGN1clZpek9iaiwgbGlua19pZCwgbGlua19pZHMsIHN0cmVhbV9kaXJlY3Rpb24pIHsKCSAgICB2YXIgdmlld19pZCA9IGN1clZpek9iai52aWV3X2lkLAoJICAgICAgICBkaW0gPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZywKCSAgICAgICAgY29sb3VyX2Fzc2lnbm1lbnQgPSBjdXJWaXpPYmoudmlldy5jb2xvdXJfYXNzaWdubWVudCwKCSAgICAgICAgYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQgPSBjdXJWaXpPYmoudmlldy5hbHBoYV9jb2xvdXJfYXNzaWdubWVudDsKCgkgICAgLy8gY2xlYXIgcHJvcGFnYXRpb24gaW5mbyBpbiB2aXpPYmoKCSAgICBjdXJWaXpPYmoudmlldy5wcm9wYWdhdGlvbiA9IHt9OwoKCSAgICAvLyBnZXQgcHJvcGFnYXRpb24gaW5mbwoJICAgIF9nZXRQcm9wYXRhZ2VkSXRlbXMoY3VyVml6T2JqLCBsaW5rX2lkLCBsaW5rX2lkcywgc3RyZWFtX2RpcmVjdGlvbik7CgoJICAgIC8vIGhpZ2hsaWdodCBsaW5rcyBpbiBsZWdlbmQKCSAgICBjdXJWaXpPYmoudmlldy5wcm9wYWdhdGlvbi5saW5rX2lkcy5mb3JFYWNoKGZ1bmN0aW9uKGN1cl9saW5rX2lkKSB7CgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkKCSAgICAgICAgICAgIC5zZWxlY3QoIi5sZWdlbmRUcmVlTGluay4iICsgY3VyX2xpbmtfaWQpCgkgICAgICAgICAgICAuYXR0cigic3Ryb2tlLW9wYWNpdHkiLCAxKTsKCSAgICB9KTsKCiAgICAJLy8gaGlnaGxpZ2h0IHRoZSBkb3duc3RyZWFtIGdlbm90eXBlcyBpbiB0aGUgc2luZ2xlIGNlbGwgdmlldwogICAgCWN1clZpek9iai52aWV3LnByb3BhZ2F0aW9uLm5vZGVfaWRzLmZvckVhY2goZnVuY3Rpb24obm9kZSkgewoJICAgIAlfdHNIaWdobGlnaHRHZW5vdHlwZShub2RlLCBjdXJWaXpPYmoudmlld19pZCk7CgkgICAgfSk7Cgl9OwoKCgkvKiBmdW5jdGlvbiB0byBnZXQgdGhlIGxpbmtzLCBub2Rlcywgc2FtcGxlcyBhbmQgc2FtcGxlIGxvY2F0aW9ucyBwYXJ0aWNpcGF0aW5nIGluIHRoZSBjdXJyZW50IHByb3BhZ2F0aW9uCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmogLS0gdml6T2JqIGZvciB0aGUgY3VycmVudCB2aWV3CgkqIEBwYXJhbSB7U3RyaW5nfSBsaW5rX2lkIC0tIGlkIGZvciB0aGUgbGluayB0aGF0J3MgY3VycmVudGx5IGhpZ2hsaWdodGVkCgkqIEBwYXJhbSB7QXJyYXl9IGxpbmtfaWRzIC0tIGlkcyBmb3IgYWxsIGxpbmtzIGluIHRyZWUKCSogQHBhcmFtIHtTdHJpbmd9IHN0cmVhbV9kaXJlY3Rpb24gLS0gImRvd25zdHJlYW0iIG9yICJ1cHN0cmVhbSIKCSovCglmdW5jdGlvbiBfZ2V0UHJvcGF0YWdlZEl0ZW1zKGN1clZpek9iaiwgbGlua19pZCwgbGlua19pZHMsIHN0cmVhbV9kaXJlY3Rpb24pIHsKCSAgICB2YXIgdmlld19pZCA9IGN1clZpek9iai52aWV3X2lkLAoJICAgICAgICBnZW5lcmFsVGFyZ2V0UlggPSBuZXcgUmVnRXhwKCJ0cmVlTGlua19zb3VyY2VfLitfdGFyZ2V0XyguKykiKSwgLy8gcmVnZXggdG8gZ2V0IHRhcmdldAoJICAgICAgICBnZW5lcmFsU291cmNlUlggPSBuZXcgUmVnRXhwKCJ0cmVlTGlua19zb3VyY2VfKC4rKV90YXJnZXRfLisiKTsgLy8gcmVnZXggdG8gZ2V0IHNvdXJjZQoKCSAgICAvLyBnZXQgdGFyZ2V0ICYgc291cmNlIGlkIG9mIHRoaXMgbGluawoJICAgIHZhciB0YXJnZXRfaWQgPSBnZW5lcmFsVGFyZ2V0UlguZXhlYyhsaW5rX2lkKVsxXTsKCSAgICB2YXIgc291cmNlX2lkID0gZ2VuZXJhbFNvdXJjZVJYLmV4ZWMobGlua19pZClbMV07CgoJICAgIC8vIGdldCB0aGUgdGFyZ2V0cyBvZiB0aGlzIHRhcmdldCwgb3Igc291cmNlcyBvZiBzb3VyY2UKCSAgICB2YXIgbmV4dE5vZGVSWCA9IChzdHJlYW1fZGlyZWN0aW9uID09ICJkb3duc3RyZWFtIikgPyAKCSAgICAgICAgbmV3IFJlZ0V4cCgidHJlZUxpbmtfc291cmNlXyIgKyB0YXJnZXRfaWQgKyAiX3RhcmdldF8oLispIikgOgoJICAgICAgICBuZXcgUmVnRXhwKCJ0cmVlTGlua19zb3VyY2VfKC4rKV90YXJnZXRfIiArIHNvdXJjZV9pZCk7CgkgICAgdmFyIHRhcmdldExpbmtzX29mX3RhcmdldE5vZGUgPSBbXTsKCSAgICBsaW5rX2lkcy5tYXAoZnVuY3Rpb24oaWQpIHsKCSAgICAgICAgaWYgKGlkLm1hdGNoKG5leHROb2RlUlgpKSB7CgkgICAgICAgICAgICB0YXJnZXRMaW5rc19vZl90YXJnZXROb2RlLnB1c2goaWQpOwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8vIGFkZCBpbmZvcm1hdGlvbiB0byBjdXJWaXpPYmoKCSAgICBjdXJWaXpPYmoudmlldy5wcm9wYWdhdGlvbiA9IGN1clZpek9iai52aWV3LnByb3BhZ2F0aW9uIHx8IHt9OwoJICAgIGN1clZpek9iai52aWV3LnByb3BhZ2F0aW9uLm5vZGVfaWRzID0gY3VyVml6T2JqLnZpZXcucHJvcGFnYXRpb24ubm9kZV9pZHMgfHwgW107CgkgICAgY3VyVml6T2JqLnZpZXcucHJvcGFnYXRpb24ubm9kZV9pZHMucHVzaCh0YXJnZXRfaWQpOwoJICAgIGN1clZpek9iai52aWV3LnByb3BhZ2F0aW9uLmxpbmtfaWRzID0gY3VyVml6T2JqLnZpZXcucHJvcGFnYXRpb24ubGlua19pZHMgfHwgW107CgkgICAgY3VyVml6T2JqLnZpZXcucHJvcGFnYXRpb24ubGlua19pZHMucHVzaChsaW5rX2lkKTsKCgkgICAgLy8gZm9yIGVhY2ggb2YgdGhlIHRhcmdldCdzIHRhcmdldHMsIGhpZ2hsaWdodCB0aGVpciBkb3duc3RyZWFtIGxpbmtzCgkgICAgdGFyZ2V0TGlua3Nfb2ZfdGFyZ2V0Tm9kZS5tYXAoZnVuY3Rpb24odGFyZ2V0X2xpbmtfaWQpIHsKCSAgICAgICAgX2dldFByb3BhdGFnZWRJdGVtcyhjdXJWaXpPYmosIHRhcmdldF9saW5rX2lkLCBsaW5rX2lkcywgc3RyZWFtX2RpcmVjdGlvbik7CgkgICAgfSk7Cgl9OwoKCglmdW5jdGlvbiBfc3dlZXBDbGljayhjdXJWaXpPYmopIHsKCSAgICB2YXIgZGltID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcsCgkgICAgICAgIGNvbG91cl9hc3NpZ25tZW50ID0gY3VyVml6T2JqLnZpZXcuY29sb3VyX2Fzc2lnbm1lbnQsCgkgICAgICAgIGFscGhhX2NvbG91cl9hc3NpZ25tZW50ID0gY3VyVml6T2JqLnZpZXcuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQsCgkgICAgICAgIHggPSBjdXJWaXpPYmoudXNlckNvbmZpZzsKCgkgICAgLy8gaGlkZSBhbnkgY2VsbHVsYXIgcHJldmFsZW5jZSBsYWJlbHMKCSAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLmxhYmVsLCAuc2VwTGFiZWwiKQoJICAgICAgICAuYXR0cignZmlsbC1vcGFjaXR5JywgMCk7CgkgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5sYWJlbENpcmMsIC5zZXBMYWJlbENpcmMiKQoJICAgICAgICAuYXR0cignZmlsbC1vcGFjaXR5JywgMCk7CgoJICAgIC8vIHRyYW5zaXRpb24gdG8gdHJhY2tzIHRpbWVzY2FwZSB2aWV3CgkgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0KCIudHNQbG90RyIpLmNsYXNzZWQoInRyYWRpdGlvbmFsIikpIHsKCSAgICAgICAgdmFyIHN3ZWVwcyA9IGN1clZpek9iai52aWV3LnRzU1ZHCgkgICAgICAgICAgICAuc2VsZWN0QWxsKCcudHNQbG90JykKCSAgICAgICAgICAgIC5kYXRhKGN1clZpek9iai5kYXRhLnRyYWNrc19iZXppZXJfcGF0aHMsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZC5ndHlwZTsKCSAgICAgICAgICAgIH0pCgoJICAgICAgICBzd2VlcHMKCSAgICAgICAgICAgIC50cmFuc2l0aW9uKCkKCSAgICAgICAgICAgIC5kdXJhdGlvbigxMDAwKQoJICAgICAgICAgICAgLmF0dHJUd2VlbigiZCIsIF9wYXRoVHdlZW4oY3VyVml6T2JqLCAibW92ZSIpKTsKCgkgICAgICAgIC8vIHJlbW92ZSBnZW5vdHlwZXMgdGhhdCBkbyBub3QgaGF2ZSBjZWxsdWxhciBwcmV2YWxlbmNlIHZhbHVlcwoJICAgICAgICBzd2VlcHMKCSAgICAgICAgICAgIC5leGl0KCkKCSAgICAgICAgICAgIC50cmFuc2l0aW9uKCkKCSAgICAgICAgICAgIC5kdXJhdGlvbigxMDAwKQoJICAgICAgICAgICAgLmF0dHJUd2VlbigiZCIsIF9wYXRoVHdlZW4oY3VyVml6T2JqLCAiZXhpdCIpKQoJICAgICAgICAgICAgLnJlbW92ZSgpOwoKCSAgICAgICAgLy8gc3dpdGNoIGNsYXNzIHRvICJ0cmFja3MiCgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0KCIudHNQbG90RyIpLmNsYXNzZWQoInRyYWRpdGlvbmFsIiwgZmFsc2UpLmNsYXNzZWQoInRyYWNrcyIsIHRydWUpOwoJICAgIH0KCSAgICAvLyB0cmFuc2l0aW9uIHRvIHRyYWRpdGlvbmFsIHRpbWVzY2FwZSB2aWV3CgkgICAgZWxzZSB7CgkgICAgICAgIHZhciBzd2VlcHMgPSBjdXJWaXpPYmoudmlldy50c1NWRwoJICAgICAgICAJLnNlbGVjdCgiLnRzUGxvdEciKQoJICAgICAgICAgICAgLnNlbGVjdEFsbCgnLnRzUGxvdCcpCgkgICAgICAgICAgICAuZGF0YShjdXJWaXpPYmouZGF0YS5iZXppZXJfcGF0aHMsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZC5ndHlwZTsKCSAgICAgICAgICAgIH0pOwoKCSAgICAgICAgc3dlZXBzCgkgICAgICAgICAgICAudHJhbnNpdGlvbigpCgkgICAgICAgICAgICAuZHVyYXRpb24oMTAwMCkKCSAgICAgICAgICAgIC5hdHRyVHdlZW4oImQiLCBfcGF0aFR3ZWVuKGN1clZpek9iaiwgIm1vdmUiKSk7CgoJICAgICAgICAvLyBhZGQgdGhvc2UgZ2Vub3R5cGVzIHRoYXQgZG8gbm90IGhhdmUgY2VsbHVsYXIgcHJldmFsZW5jZSB2YWx1ZXMsIGJ1dCBhcmUgaW4gdGhlIGhpZXJhcmNoeQoJICAgICAgICBzd2VlcHMKCSAgICAgICAgICAgIC5lbnRlcigpCgkgICAgICAgICAgICAuaW5zZXJ0KCdwYXRoJykKCSAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKGQpIHsgCgkgICAgICAgICAgICAJLy8gaWYgd2UncmUgc2VsZWN0aW5nIG5vZGVzLCBidXQgd2UgaGF2ZW4ndCBjbGlja2VkIHRoaXMgb25lIHlldAoJICAgICAgICAgICAgICAgIGlmICgoZGltLm5DbGlja2VkTm9kZXMgPiAwKSAmJiAoXy51bmlxKGRpbS5jdXJDbG9uZUlEcykuaW5kZXhPZihkLmlkKSA9PSAtMSkpIHsKCSAgICAgICAgICAgICAgICAJcmV0dXJuICd0c1Bsb3QgaW5hY3RpdmUgZ3R5cGVfJyArIGQuZ3R5cGU7IAoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIAlyZXR1cm4gJ3RzUGxvdCBndHlwZV8nICsgZC5ndHlwZTsgCgkgICAgICAgICAgICB9KQoJICAgICAgICAgICAgLmF0dHIoImQiLCBfY2VudHJlTGluZShjdXJWaXpPYmopKQoJICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmZpbGw7IH0pIAoJICAgICAgICAgICAgLmF0dHIoJ3N0cm9rZScsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc3Ryb2tlOyB9KQoJICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbihkKSB7CgkgICAgICAgICAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgIWRpbS5tdXRTZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgkgICAgICAgICAgICAgICAgCV90c01vdXNlb3Zlckdlbm90eXBlKGQuZ3R5cGUsIGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgICAgICAgICAJX3Nob3dMYWJlbHMoZC5ndHlwZSwgY3VyVml6T2JqLnZpZXdfaWQpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pCgkgICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24oZCkgewoJICAgICAgICAgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmICFkaW0ubXV0U2VsZWN0T24gJiYgX2NoZWNrRm9yQ2VsbFNjYXBlU2VsZWN0aW9ucyh2aWV3X2lkKSkgewoJICAgICAgICAgICAgICAgICAgICBfdHNNb3VzZW91dEdlbm90eXBlKGN1clZpek9iai52aWV3X2lkKTsKICAgCSAJCQkJCV9oaWRlTGFiZWxzKGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KQoJICAgICAgICAgICAgLnRyYW5zaXRpb24oKQoJICAgICAgICAgICAgLmR1cmF0aW9uKDEwMDApCgkgICAgICAgICAgICAuYXR0clR3ZWVuKCJkIiwgX3BhdGhUd2VlbihjdXJWaXpPYmosICJtb3ZlIikpOwoKCSAgICAgICAgLy8gc3dpdGNoIGNsYXNzIHRvICJ0cmFkaXRpb25hbCIKCSAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi50c1Bsb3RHIikuY2xhc3NlZCgidHJhY2tzIiwgZmFsc2UpLmNsYXNzZWQoInRyYWRpdGlvbmFsIiwgdHJ1ZSk7CgkgICAgfQoJfQoKCS8qIENyZWF0ZSBjbG9uYWwgcHJldmFsZW5jZSBsYWJlbHMgd2l0aCBmaWxsIG9wYWNpdHkgMAoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqIC0tIHZpek9iaiBmb3IgdGhlIGN1cnJlbnQgdmlldwoJKiBAcGFyYW0ge0FycmF5fSBsYWJlbF9kYXRhIC0tIGFycmF5IG9mIG9iamVjdHMgY29udGFpbmluZyBsYWJlbCBkYXRhLCBvbmUgbGFiZWwgcGVyIG9iamVjdAoJKi8KCWZ1bmN0aW9uIF9jcmVhdGVMYWJlbHMoY3VyVml6T2JqLCBsYWJlbF9kYXRhKSB7CgkgICAgdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnOwoKCSAgICAvLyBmb3IgZWFjaCBjZWxsdWxhciBwcmV2YWxlbmNlIGxhYmVsIGZvciB0aGlzIGdlbm90eXBlCiAgICAgICAgY3VyVml6T2JqLnZpZXcudHNTVkcKICAgICAgICAJLmFwcGVuZCgiZyIpCiAgICAgICAgCS5hdHRyKCJjbGFzcyIsICJsYWJlbENpcmNsZXNHIikKICAgICAgICAJLnNlbGVjdEFsbCgiY2lyY2xlIikKICAgICAgICAJLmRhdGEobGFiZWxfZGF0YSkKICAgICAgICAJLmVudGVyKCkKICAgICAgICAgICAgLmFwcGVuZCgnY2lyY2xlJykKICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgIGlmIChkLnR5cGUgPT0gInRyYWRpdGlvbmFsIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnbGFiZWxDaXJjIHRwXycgKyBkLnRwICsgJyBndHlwZV8nICsgZC5ndHlwZTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ3NlcExhYmVsQ2lyYyB0cF8nICsgZC50cCArICcgZ3R5cGVfJyArIGQuZ3R5cGU7IAogICAgICAgICAgICB9KSAKICAgICAgICAgICAgLmF0dHIoJ2N4JywgZnVuY3Rpb24oZCkgeyAKCiAgICAgICAgICAgICAgICAvLyBpbmRleCBvZiB0aGlzIHRpbWUgcG9pbnQgcmVsYXRpdmUgdG8gb3RoZXJzCiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmluZGV4T2YoZC50cCk7IAoKICAgICAgICAgICAgICAgIHZhciB4X3ZhbCA9IChpbmRleCAvIChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aC0xKSkgKiAoZGltLnRzU1ZHV2lkdGgpOwoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB0aW1lIHBvaW50IGlzIHRoZSBsYXN0CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2hpZnQgaXQgdG8gdGhlIGxlZnQKICAgICAgICAgICAgICAgICAgICB4X3ZhbCAtPSBkaW0uY2lyY2xlUjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4geF92YWw7IAogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXR0cignY3knLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICAgICAgdmFyIHk7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbGFiZWwsIHdoZW4gY2VudGVyZWQgdmVydGljYWxseS4uLgogICAgICAgICAgICAgICAgLy8gLi4uIGlzIGN1dCBvZmYgYXQgdGhlIHRvcCwgc2hpZnQgZG93bgogICAgICAgICAgICAgICAgaWYgKChkaW0udHNTVkdIZWlnaHQtKGQubWlkZGxlKmRpbS50c1NWR0hlaWdodCkpIDwgZGltLmNpcmNsZVIpIHsKICAgICAgICAgICAgICAgICAgICB5ID0gMSArIGRpbS5jaXJjbGVSOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC4uLiBpcyBjdXQgb2ZmIGF0IHRoZSBib3R0b20sIHNoaWZ0IHVwCiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZC5taWRkbGUqZGltLnRzU1ZHSGVpZ2h0KSA8IGRpbS5jaXJjbGVSKSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IGRpbS50c1NWR0hlaWdodCAtIDEgLSBkaW0uY2lyY2xlUjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyAuLi4gaXMgbm90IGN1dCBvZmYsIGNlbnRlciB2ZXJ0aWNhbGx5CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB5ID0gKDEgLSBkLm1pZGRsZSkqZGltLnRzU1ZHSGVpZ2h0OyAKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gZGltLnRzU1ZHSGVpZ2h0IC0geTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmF0dHIoJ3InLCBkaW0uY2lyY2xlUikKICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCAnd2hpdGUnKQogICAgICAgICAgICAuYXR0cigiZmlsbC1vcGFjaXR5IiwgMCkKICAgICAgICAgICAgLnN0eWxlKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7CgogICAgICAgIGN1clZpek9iai52aWV3LnRzU1ZHCiAgICAgICAgCS5hcHBlbmQoImciKQogICAgICAgIAkuYXR0cigiY2xhc3MiLCAibGFiZWxUZXh0RyIpCiAgICAgICAgCS5zZWxlY3RBbGwoInRleHQiKQogICAgICAgIAkuZGF0YShsYWJlbF9kYXRhKQogICAgICAgIAkuZW50ZXIoKQogICAgICAgICAgICAuYXBwZW5kKCd0ZXh0JykKICAgICAgICAgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKICAgICAgICAgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIGRpbS5mb250U2l6ZSkKICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgIGlmIChkLnR5cGUgPT0gInRyYWRpdGlvbmFsIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnbGFiZWwgdHBfJyArIGQudHAgKyAnIGd0eXBlXycgKyBkLmd0eXBlOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAnc2VwTGFiZWwgdHBfJyArIGQudHAgKyAnIGd0eXBlXycgKyBkLmd0eXBlOyAKICAgICAgICAgICAgfSkgCiAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgIHZhciBjcCA9IChNYXRoLnJvdW5kKGQuY3AgKiAxMDApIC8gMSk7CiAgICAgICAgICAgICAgICBpZiAoY3AgPT09IDApIHsKICAgICAgICAgICAgICAgIAlkLmxhYmVsX3RleHQgPSAiPCAwLjAxIjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiI7IC8vIHRleHQgcmVtb3ZlZCBmb3IgcHVycG9zZXMgb2Ygc3ZnIGRvd25sb2FkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjcF9mcmFjID0gKGNwLzEwMCkudG9GaXhlZCgyKTsKICAgICAgICAgICAgICAgIGQubGFiZWxfdGV4dCA9IGNwX2ZyYWMudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIHJldHVybiAiIjsgLy8gdGV4dCByZW1vdmVkIGZvciBwdXJwb3NlcyBvZiBzdmcgZG93bmxvYWQKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbihkKSB7IAoKICAgICAgICAgICAgICAgIC8vIGluZGV4IG9mIHRoaXMgdGltZSBwb2ludCByZWxhdGl2ZSB0byBvdGhlcnMKICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMuaW5kZXhPZihkLnRwKTsgCgogICAgICAgICAgICAgICAgdmFyIHhfdmFsID0gKGluZGV4IC8gKGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMubGVuZ3RoLTEpKSAqIChkaW0udHNTVkdXaWR0aCk7CgogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHRpbWUgcG9pbnQgaXMgdGhlIGxhc3QKICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PSBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBzaGlmdCBpdCB0byB0aGUgbGVmdAogICAgICAgICAgICAgICAgICAgIHhfdmFsIC09IGRpbS5jaXJjbGVSOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB4X3ZhbDsgCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZGltLnRzU1ZHSGVpZ2h0IC0gKDEgLSBkLm1pZGRsZSkqZGltLnRzU1ZHSGVpZ2h0OyB9KQogICAgICAgICAgICAuYXR0cignZHknLCBmdW5jdGlvbihkKSB7CgogICAgICAgICAgICAgICAgLy8gaWYgdGhlIGxhYmVsLCB3aGVuIGNlbnRlcmVkIHZlcnRpY2FsbHkuLi4KICAgICAgICAgICAgICAgIC8vIC4uLiBpcyBjdXQgb2ZmIGF0IHRoZSB0b3AsIHNoaWZ0IGRvd24KICAgICAgICAgICAgICAgIGlmICgoZGltLnRzU1ZHSGVpZ2h0LShkLm1pZGRsZSpkaW0udHNTVkdIZWlnaHQpKSA8IGRpbS5jaXJjbGVSKSB7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmF0dHIoJ3knLCBkaW0udHNTVkdIZWlnaHQgLSAxIC0gZGltLmNpcmNsZVIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC4uLiBpcyBjdXQgb2ZmIGF0IHRoZSBib3R0b20sIHNoaWZ0IHVwCiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZC5taWRkbGUqZGltLnRzU1ZHSGVpZ2h0KSA8IGRpbS5jaXJjbGVSKSB7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmF0dHIoJ3knLCAxICsgZGltLmNpcmNsZVIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC4uLiBpcyBub3QgY3V0IG9mZiwgY2VudGVyIHZlcnRpY2FsbHkKICAgICAgICAgICAgICAgIHJldHVybiAnLjM1ZW0nOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXR0cignZmlsbCcsICdibGFjaycpCiAgICAgICAgICAgIC5hdHRyKCJmaWxsLW9wYWNpdHkiLCAwKQogICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJykKICAgICAgICAgICAgLnN0eWxlKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7Cgl9CgoJLyogYmFja2dyb3VuZCBjbGljayBmdW5jdGlvbiAodHVybnMgb2ZmIHNlbGVjdGlvbnMsIHJlc2V0cyB2aWV3KQoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqIC0tIHZpek9iaiBmb3IgdGhlIGN1cnJlbnQgdmlldwoJKi8KCWZ1bmN0aW9uIF9iYWNrZ3JvdW5kQ2xpY2soY3VyVml6T2JqKSB7CgkgICAgdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnOwoKCSAgICAvLyBpZiB0aGVyZSB3YXMganVzdCBhIGxpbmsgc2VsZWN0aW9uLCByZWZyZXNoIHRoZSBtdXRhdGlvbnMgdGFibGUKCSAgICBpZiAoZGltLnNlbGVjdE9uKSB7CgkgICAgICAgIC8vIGRlbGV0ZSBleGlzdGluZyBkYXRhIHRhYmxlCgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCArICJfbXV0YXRpb25UYWJsZSIgKyAiX3dyYXBwZXIiKS5yZW1vdmUoKTsKCgkgICAgICAgIC8vIG1ha2UgbmV3IGZ1bGwgdGFibGUKCSAgICAgICAgX21ha2VNdXRhdGlvblRhYmxlKGN1clZpek9iaiwgY3VyVml6T2JqLnZpZXcubXV0YXRpb25UYWJsZURJViwgY3VyVml6T2JqLmRhdGEubXV0YXRpb25zLAoJICAgICAgICAgICAgZGltLm11dGF0aW9uVGFibGVIZWlnaHQpOwoJICAgIH0KCgkgICAgZGltLnNlbGVjdE9uID0gZmFsc2U7CgkgICAgZGltLm11dFNlbGVjdE9uID0gZmFsc2U7CgkgICAgZGltLm5DbGlja2VkTm9kZXMgPSAwOwoJICAgIGRpbS5jdXJDbG9uZUlEcyA9IFtdOwoKCSAgICAvLyBtYXJrIGFsbCBtdXRhdGlvbnMgYXMgdW5zZWxlY3RlZAoJICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCArICJfbXV0YXRpb25UYWJsZSIpLnNlbGVjdEFsbCgidHIiKS5jbGFzc2VkKCdzZWxlY3RlZCcsIGZhbHNlKTsKCgkgICAgLy8gdW5oaWdobGlnaHQgcGh5bG9nZW55IGxpbmtzIChoaWdobGlnaHRpbmcgb2NjdXJzIHdoZW4gbXV0YXRpb24gc2VsZWN0ZWQpCgkgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRUcmVlTGluayIpLmF0dHIoInN0cm9rZSIsIGRpbS50cmVlTGlua0NvbG91cik7CgoJICAgIC8vIGhpZGUgVkFGIHRvb2x0aXBzCgkgICAgY3VyVml6T2JqLnZhZlRpcHMuZm9yRWFjaChmdW5jdGlvbihjdXJUaXApIHsKCSAgICAgICAgY3VyVGlwLmhpZGUoKTsKCSAgICB9KQoKCSAgICBfdHNNb3VzZW91dEdlbm90eXBlKGN1clZpek9iai52aWV3X2lkKTsKICAgCSAJX2hpZGVMYWJlbHMoY3VyVml6T2JqLnZpZXdfaWQpOwoJfQoKCS8vIFRSRUUgRlVOQ1RJT05TCgoJLyogZXh0cmFjdCBhbGwgaW5mbyBmcm9tIHRyZWUgYWJvdXQgbm9kZXMsIGVkZ2VzLCBhbmNlc3RvcnMsIGRlc2NlbmRhbnRzCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmogCgkqLwoJZnVuY3Rpb24gX2dldFRyZWVJbmZvKGN1clZpek9iaikgewoJICAgIHZhciB1c2VyQ29uZmlnID0gY3VyVml6T2JqLnVzZXJDb25maWcsCgkgICAgICAgIGN1cl9lZGdlcyA9IHVzZXJDb25maWcuZ3R5cGVfdHJlZV9lZGdlcywKCSAgICAgICAgcGhhbnRvbVJvb3QgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5waGFudG9tUm9vdDsgLy8gcm9vdCBzbyB3ZSBoYXZlIGEgbGVhZC1pbiBsaW5rIHRvIHRoZSByZWFsIHJvb3QKCgkgICAgLy8gZ2V0IHRyZWUgbm9kZXMKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlTm9kZXMgPSBfLnVuaXEoXy5wbHVjayhjdXJfZWRnZXMsICJzb3VyY2UiKS5jb25jYXQoXy5wbHVjayhjdXJfZWRnZXMsICJ0YXJnZXQiKSkpOwoJICAgIGN1clZpek9iai5kYXRhLnRyZWVOb2Rlcy5wdXNoKHBoYW50b21Sb290KTsKCgkgICAgLy8gZ2V0IHRyZWUgZWRnZXMKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlRWRnZXMgPSBbXTsKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1cl9lZGdlcy5sZW5ndGg7IGkrKykgewoJICAgICAgICBjdXJWaXpPYmouZGF0YS50cmVlRWRnZXMucHVzaCh7CgkgICAgICAgICAgICAic291cmNlIjogY3VyX2VkZ2VzW2ldLnNvdXJjZSwKCSAgICAgICAgICAgICJ0YXJnZXQiOiBjdXJfZWRnZXNbaV0udGFyZ2V0CgkgICAgICAgIH0pCgkgICAgfQoKCSAgICAvLyBmaW5kIHRyZWUgcm9vdAoJICAgIHZhciBjdXJfc291cmNlID0gY3VyVml6T2JqLmRhdGEudHJlZUVkZ2VzWzBdLnNvdXJjZTsKCSAgICB2YXIgc291cmNlX2FzX3RhcmdldCA9IC8vIGVkZ2Ugd2hlcmUgdGhlIGN1cnJlbnQgc291cmNlIGlzIHRoZSB0YXJnZXQKCSAgICAgICAgXy5maW5kV2hlcmUoY3VyVml6T2JqLmRhdGEudHJlZUVkZ2VzLCB7InRhcmdldCI6IGN1cl9zb3VyY2V9KTsgCgkgICAgd2hpbGUgKHNvdXJjZV9hc190YXJnZXQpIHsgLy8gaXRlcmF0ZSBhcyBsb25nIGFzIHRoZXJlIGFyZSBlZGdlcyB3aXRoIHRoZSBjdXJyZW50IHNvdXJjZSBhcyB0aGUgdGFyZ2V0CgkgICAgICAgIGN1cl9zb3VyY2UgPSBzb3VyY2VfYXNfdGFyZ2V0LnNvdXJjZTsKCSAgICAgICAgc291cmNlX2FzX3RhcmdldCA9IF8uZmluZFdoZXJlKGN1clZpek9iai5kYXRhLnRyZWVFZGdlcywgeyJ0YXJnZXQiOiBjdXJfc291cmNlfSk7CgkgICAgfQoJICAgIHZhciByb290TmFtZSA9IGN1cl9zb3VyY2U7CgoJICAgIC8vIGFkZCB0aGUgcGhhbnRvbVJvb3QgdG8gdGhlIHRyZWUgZWRnZXMgYXJyYXkKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlRWRnZXMucHVzaCh7CgkgICAgICAgICJzb3VyY2UiOiBwaGFudG9tUm9vdCwKCSAgICAgICAgInRhcmdldCI6IHJvb3ROYW1lCgkgICAgfSkKCgkgICAgLy8gZ2V0IHRyZWUgc3RydWN0dXJlCgkgICAgdmFyIG5vZGVzQnlOYW1lID0gW107CgkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJWaXpPYmouZGF0YS50cmVlRWRnZXMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgdmFyIHBhcmVudCA9IF9maW5kTm9kZUJ5TmFtZShub2Rlc0J5TmFtZSwgY3VyVml6T2JqLmRhdGEudHJlZUVkZ2VzW2ldLnNvdXJjZSk7CgkgICAgICAgIHZhciBjaGlsZCA9IF9maW5kTm9kZUJ5TmFtZShub2Rlc0J5TmFtZSwgY3VyVml6T2JqLmRhdGEudHJlZUVkZ2VzW2ldLnRhcmdldCk7CgkgICAgICAgIHBhcmVudC5jaGlsZHJlbi5wdXNoKGNoaWxkKTsKCSAgICB9CgkgICAgdmFyIHJvb3RfdHJlZSA9IF9maW5kTm9kZUJ5TmFtZShub2Rlc0J5TmFtZSwgcGhhbnRvbVJvb3QpOyAKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlID0gcm9vdF90cmVlOyAKCgkgICAgLy8gZ2V0IGxpbmVhciBjaGFpbnMKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlQ2hhaW5Sb290cyA9IFtdOyAvLyBrZWVwIHRyYWNrIG9mIGxpbmVhciBjaGFpbiBzZWdtZW50IHJvb3RzCgkgICAgY3VyVml6T2JqLmRhdGEudHJlZUNoYWlucyA9IAoJICAgICAgICBfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyVml6T2JqLmRhdGEudHJlZVN0cnVjdHVyZSwge30sICIiKTsKCgkgICAgLy8gZ2V0IGRlc2NlbmRhbnRzIGZvciBlYWNoIG5vZGUKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnIgPSB7fTsKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlTm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBpZHgpIHsKCSAgICAgICAgdmFyIGN1clJvb3QgPSBfZmluZE5vZGVCeU5hbWUobm9kZXNCeU5hbWUsIG5vZGUpOwoJICAgICAgICB2YXIgY3VyRGVzY2VuZGFudHMgPSBfZ2V0RGVzY2VuZGFudElkcyhjdXJSb290LCBbXSk7CgkgICAgICAgIGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0Fycltub2RlXSA9IGN1ckRlc2NlbmRhbnRzOwoJICAgIH0pCgkgICAgY3VyVml6T2JqLmRhdGEuZGlyZWN0X2Rlc2NlbmRhbnRzID0gX2dldERpcmVjdERlc2NlbmRhbnRzKGN1clZpek9iai5kYXRhLnRyZWVTdHJ1Y3R1cmUsIHt9KTsKCgkgICAgLy8gZ2V0IGFuY2VzdG9ycyBmb3IgZWFjaCBub2RlCgkgICAgY3VyVml6T2JqLmRhdGEudHJlZUFuY2VzdG9yc0FyciA9IF9nZXRBbmNlc3RvcklkcyhjdXJWaXpPYmopOwoJICAgIGN1clZpek9iai5kYXRhLmRpcmVjdF9hbmNlc3RvcnMgPSBfZ2V0RGlyZWN0QW5jZXN0b3JzKGN1clZpek9iai5kYXRhLnRyZWVTdHJ1Y3R1cmUsIHt9KTsKCgkgICAgLy8gZ2V0IHNpYmxpbmdzIGZvciBlYWNoIG5vZGUKCSAgICBjdXJWaXpPYmouZGF0YS5zaWJsaW5ncyA9IF9nZXRTaWJsaW5ncyhjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlLCB7fSk7IAoKCSAgICAvLyBnZXQgdGhlIGhlaWdodCBvZiB0aGUgdHJlZQoJICAgIGN1clZpek9iai5kYXRhLnRyZWVfaGVpZ2h0ID0gMDsKCSAgICBPYmplY3Qua2V5cyhjdXJWaXpPYmouZGF0YS50cmVlQW5jZXN0b3JzQXJyKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewoJICAgICAgICB2YXIgYW5jZXN0b3JfYXJyID0gY3VyVml6T2JqLmRhdGEudHJlZUFuY2VzdG9yc0FycltrZXldOwoJICAgICAgICBpZiAoYW5jZXN0b3JfYXJyLmxlbmd0aCA+IGN1clZpek9iai5kYXRhLnRyZWVfaGVpZ2h0KSB7CgkgICAgICAgICAgICBjdXJWaXpPYmouZGF0YS50cmVlX2hlaWdodCA9IGFuY2VzdG9yX2Fyci5sZW5ndGg7CgkgICAgICAgIH0KCSAgICB9KQoJfQoKCS8qIGZ1bmN0aW9uIHRvIGZpbmQgYSBrZXkgYnkgaXRzIG5hbWUgLSBpZiB0aGUga2V5IGRvZXNuJ3QgZXhpc3QsIGl0IHdpbGwgYmUgY3JlYXRlZCBhbmQgYWRkZWQgdG8gdGhlIGxpc3Qgb2Ygbm9kZXMKCSogQHBhcmFtIHtBcnJheX0gbGlzdCAtIGxpc3Qgb2Ygbm9kZXMKCSogQHBhcmFtIHtTdHJpbmd9IG5hbWUgLSBuYW1lIG9mIGtleSB0byBmaW5kCgkqLwoJZnVuY3Rpb24gX2ZpbmROb2RlQnlOYW1lKGxpc3QsIG5hbWUpIHsKCSAgICB2YXIgZm91bmROb2RlID0gXy5maW5kV2hlcmUobGlzdCwge2lkOiBuYW1lfSksCgkgICAgICAgIGN1ck5vZGU7CgoJICAgIGlmICghZm91bmROb2RlKSB7CgkgICAgICAgIGN1ck5vZGUgPSB7J2lkJzogbmFtZSwgJ2NoaWxkcmVuJzogW119OwoJICAgICAgICBsaXN0LnB1c2goY3VyTm9kZSk7CgkgICAgICAgIHJldHVybiBjdXJOb2RlOwoJICAgIH0KCgkgICAgcmV0dXJuIGZvdW5kTm9kZTsKCX0KCgkvKiBmdW5jdGlvbiB0byBnZXQgZGVzY2VuZGFudHMgaWQncyBmb3IgdGhlIHNwZWNpZmllZCBrZXkKCSogQHBhcmFtIHtPYmplY3R9IHJvb3QgLSBrZXkgZm9yIHdoaWNoIHdlIHdhbnQgZGVzY2VuZGFudHMKCSogQHBhcmFtIHtBcnJheX0gZGVzY2VuZGFudHMgLSBpbml0aWFsbHkgZW1wdHkgYXJyYXkgZm9yIGRlc2NlbmRhbnRzIHRvIGJlIHBsYWNlZCBpbnRvCgkqLwoJZnVuY3Rpb24gX2dldERlc2NlbmRhbnRJZHMocm9vdCwgZGVzY2VuZGFudHMpIHsKCSAgICB2YXIgY2hpbGQ7CgoJICAgIGlmIChyb290LmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb290LmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICBjaGlsZCA9IHJvb3QuY2hpbGRyZW5baV07CgkgICAgICAgICAgICBkZXNjZW5kYW50cy5wdXNoKGNoaWxkLmlkKTsKCSAgICAgICAgICAgIF9nZXREZXNjZW5kYW50SWRzKGNoaWxkLCBkZXNjZW5kYW50cyk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgcmV0dXJuIGRlc2NlbmRhbnRzOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgYW5jZXN0b3IgaWRzIGZvciBhbGwgbm9kZXMKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9nZXRBbmNlc3RvcklkcyhjdXJWaXpPYmopIHsKCSAgICB2YXIgYW5jZXN0b3JzID0ge30sCgkgICAgICAgIGN1ckRlc2NlbmRhbnRzLAoJICAgICAgICBkZXNjZW5kYW50c19hcnIgPSBjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnIsCgkgICAgICAgIHRyZWVOb2RlcyA9IGN1clZpek9iai5kYXRhLnRyZWVOb2RlczsKCgkgICAgLy8gc2V0IHVwIGVhY2ggbm9kZSBhcyBvcmlnaW5hbGx5IGNvbnRhaW5pbmcgYW4gZW1wdHkgbGlzdCBvZiBhbmNlc3RvcnMKCSAgICB0cmVlTm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBpZHgpIHsKCSAgICAgICAgYW5jZXN0b3JzW25vZGVdID0gW107CgkgICAgfSkKCgkgICAgLy8gZ2V0IGFuY2VzdG9ycyBkYXRhIGZyb20gdGhlIGRlc2NlbmRhbnRzIGRhdGEKCSAgICB0cmVlTm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBpZHgpIHsKCSAgICAgICAgLy8gZm9yIGVhY2ggZGVzY2VuZGFudCBvZiB0aGlzIG5vZGUKCSAgICAgICAgY3VyRGVzY2VuZGFudHMgPSBkZXNjZW5kYW50c19hcnJbbm9kZV07CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VyRGVzY2VuZGFudHMubGVuZ3RoOyBpKyspIHsgCgkgICAgICAgICAgICAvLyBhZGQgdGhlIG5vZGUgdG8gZGVzY2VudGFudCdzIGFuY2VzdG9yIGxpc3QKCSAgICAgICAgICAgIGFuY2VzdG9yc1tjdXJEZXNjZW5kYW50c1tpXV0ucHVzaChub2RlKTsKCSAgICAgICAgfQoJICAgIH0pCgoJICAgIHJldHVybiBhbmNlc3RvcnM7Cgl9CgoJLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBESVJFQ1QgZGVzY2VuZGFudCBpZCBmb3IgYWxsIG5vZGVzCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJOb2RlIC0tIGN1cnJlbnQgbm9kZSBpbiB0aGUgdHJlZSAob3JpZ2luYWxseSB0aGUgcm9vdCkKCSogQHBhcmFtIHtPYmplY3R9IGRpcl9kZXNjZW5kYW50cyAtLSBvcmlnaW5hbGx5IGVtcHR5IGFycmF5IG9mIGRpcmVjdCBkZXNjZW5kYW50cyBmb3IgZWFjaCBub2RlCgkqLwoJZnVuY3Rpb24gX2dldERpcmVjdERlc2NlbmRhbnRzKGN1ck5vZGUsIGRpcl9kZXNjZW5kYW50cykgewoJICAgIGRpcl9kZXNjZW5kYW50c1tjdXJOb2RlLmlkXSA9IFtdOwoKCSAgICBpZiAoY3VyTm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VyTm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgZGlyX2Rlc2NlbmRhbnRzW2N1ck5vZGUuaWRdLnB1c2goY3VyTm9kZS5jaGlsZHJlbltpXS5pZCk7CgkgICAgICAgICAgICBfZ2V0RGlyZWN0RGVzY2VuZGFudHMoY3VyTm9kZS5jaGlsZHJlbltpXSwgZGlyX2Rlc2NlbmRhbnRzKQoJICAgICAgICB9CgkgICAgfQoKCSAgICByZXR1cm4gZGlyX2Rlc2NlbmRhbnRzOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgRElSRUNUIGFuY2VzdG9yIGlkIGZvciBhbGwgbm9kZXMKCSogQHBhcmFtIHtPYmplY3R9IGN1ck5vZGUgLS0gY3VycmVudCBub2RlIGluIHRoZSB0cmVlIChvcmlnaW5hbGx5IHRoZSByb290KQoJKiBAcGFyYW0ge09iamVjdH0gZGlyX2FuY2VzdG9ycyAtLSBvcmlnaW5hbGx5IGVtcHR5IGFycmF5IG9mIGRpcmVjdCBkZXNjZW5kYW50cyBmb3IgZWFjaCBub2RlCgkqLwoJZnVuY3Rpb24gX2dldERpcmVjdEFuY2VzdG9ycyhjdXJOb2RlLCBkaXJfYW5jZXN0b3JzKSB7CgoJICAgIGlmIChjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICBkaXJfYW5jZXN0b3JzW2N1ck5vZGUuY2hpbGRyZW5baV0uaWRdID0gY3VyTm9kZS5pZDsKCSAgICAgICAgICAgIF9nZXREaXJlY3RBbmNlc3RvcnMoY3VyTm9kZS5jaGlsZHJlbltpXSwgZGlyX2FuY2VzdG9ycykKCSAgICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIGRpcl9hbmNlc3RvcnM7Cgl9CgoJLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBzaWJsaW5nIElEJ3MgZm9yIGVhY2ggbm9kZQoJKiBAcGFyYW0ge09iamVjdH0gY3VyTm9kZSAtLSBjdXJyZW50IG5vZGUgaW4gdGhlIHRyZWUgKG9yaWdpbmFsbHkgdGhlIHJvb3QpCgkqIEBwYXJhbSB7T2JqZWN0fSBzaWJzIC0tIG9yaWdpbmFsbHkgZW1wdHkgYXJyYXkgb2Ygc2libGluZ3MgZm9yIGVhY2ggbm9kZQoJKi8KCWZ1bmN0aW9uIF9nZXRTaWJsaW5ncyhjdXJOb2RlLCBzaWJzKSB7CgkgICAgdmFyIGN1cl9zaWJzID0gW107CgoJICAgIC8vIGdldCBjdXJyZW50IHNpYmxpbmdzCgkgICAgaWYgKGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGN1cl9zaWJzLnB1c2goY3VyTm9kZS5jaGlsZHJlbltpXS5pZCk7CgkgICAgICAgICAgICBfZ2V0U2libGluZ3MoY3VyTm9kZS5jaGlsZHJlbltpXSwgc2licykKCSAgICAgICAgfQoJICAgIH0KCSAgICAKCSAgICAvLyBub3RlIHNpYmxpbmdzIGZvciBlYWNoIHNpYmxpbmcKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1cl9zaWJzLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY3VyX3NpYnMubGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgIGlmIChjdXJfc2lic1tqXSAhPSBjdXJfc2lic1tpXSkgewoJICAgICAgICAgICAgICAgIHNpYnNbY3VyX3NpYnNbaV1dID0gc2lic1tjdXJfc2lic1tpXV0gfHwgW107CgkgICAgICAgICAgICAgICAgc2lic1tjdXJfc2lic1tpXV0ucHVzaChjdXJfc2lic1tqXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiBzaWJzOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGZpbmQgdGhlIGFuY2VzdG9ycyBvZiB0aGUgc3BlY2lmaWVkIGdlbm90eXBlIHRoYXQgZW1lcmdlIGF0IGEgcGFydGljdWxhciB0aW1lIHBvaW50CgkqIEBwYXJhbSB7T2JqZWN0fSBsYXlvdXQgLS0gZm9yIGVhY2ggdGltZSBwb2ludCwgdGhlIGludGVydmFsIGJvdW5kYXJpZXMgZm9yIGVhY2ggZ2Vub3R5cGUgYXQgdGhhdCB0aW1lIHBvaW50CgkqIEBwYXJhbSB7T2JqZWN0fSB0cmVlQW5jZXN0b3JzQXJyIC0tIGZvciBlYWNoIGdlbm90eXBlIChwcm9wZXJ0aWVzKSwgYW4gYXJyYXkgb2YgdGhlaXIgYW5jZXN0b3JzICh2YWx1ZXMpCgkqIEBwYXJhbSB7U3RyaW5nfSBndHlwZSAtLSB0aGUgZ2Vub3R5cGUgb2YgaW50ZXJlc3QKCSogQHBhcmFtIHtTdHJpbmd9IHRwIC0tIHRoZSB0aW1lIHBvaW50IG9mIGludGVyZXN0CgkqLwoJZnVuY3Rpb24gX2ZpbmRFbWVyZ2VudEFuY2VzdG9ycyhsYXlvdXQsIHRyZWVBbmNlc3RvcnNBcnIsIGd0eXBlLCB0cCkgewoJICAgIHZhciBhbmNlc3RvcnMgPSBbXSwKCSAgICAgICAgcG90X2FuY2VzdG9yOyAvLyBwb3RlbnRpYWwgYW5jZXN0b3IKCgkgICAgLy8gZm9yIGVhY2ggYW5jZXN0cmFsIGdlbm90eXBlLCAKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyZWVBbmNlc3RvcnNBcnJbZ3R5cGVdLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgIHBvdF9hbmNlc3RvciA9IHRyZWVBbmNlc3RvcnNBcnJbZ3R5cGVdW2ldOwoKCSAgICAgICAgLy8gaWYgdGhpcyBhbmNlc3RvciBlbWVyZ2VkIGhlcmUgYXMgd2VsbCwgaW5jcmVhc2UgdGhlICMgYW5jZXN0b3JzIGZvciB0aGlzIGdlbm90eXBlCgkgICAgICAgIGlmIChsYXlvdXRbdHBdW3BvdF9hbmNlc3Rvcl0gJiYgbGF5b3V0W3RwXVtwb3RfYW5jZXN0b3JdLnN0YXRlID09ICJlbWVyZ2VzIikgewoJICAgICAgICAgICAgYW5jZXN0b3JzLnB1c2gocG90X2FuY2VzdG9yKTsKCSAgICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIGFuY2VzdG9yczsKCX0KCgkvKiBlbGJvdyBmdW5jdGlvbiB0byBkcmF3IHBoeWxvZ2VueSBsaW5rcyAKCSovCglmdW5jdGlvbiBfZWxib3coZCkgewoJICAgIHJldHVybiAiTSIgKyBkLnNvdXJjZS54ICsgIiwiICsgZC5zb3VyY2UueSArIAoJICAgIAkiSCIgKyAoZC5zb3VyY2UueCArIChkLnRhcmdldC54LWQuc291cmNlLngpLzIpICsgCgkgICAgCSJWIiArIGQudGFyZ2V0LnkgKyAiSCIgKyBkLnRhcmdldC54OwoJfQoKCS8qCgkqIGZ1bmN0aW9uIHRvLCB1c2luZyB0aGUgdHJlZSBoaWVyYXJjaHksIGdldCB0aGUgbGluZWFyIHNlZ21lbnRzJyBzdGFydGluZyBrZXkgYW5kIGxlbmd0aCAoaW5jbHVkaW5nIHN0YXJ0aW5nIGtleSkKCSogQHBhcmFtIHtPYmplY3R9IGN1ck5vZGUgLS0gY3VycmVudCBrZXkgaW4gdGhlIHRyZWUKCSogQHBhcmFtIHtPYmplY3R9IGNoYWlucyAtLSBvcmlnaW5hbGx5IGVtcHR5IG9iamVjdCBvZiB0aGUgc2VnbWVudHMgCgkqICAgICAgICAgICAgICAgICAgICAgICAgICAgKGtleSBpcyBzZWdtZW50IHN0YXJ0IGtleSwgdmFsdWUgaXMgYXJyYXkgb2YgZGVzY2VuZGFudHMgaW4gdGhpcyBjaGFpbikKCSogQHBhcmFtIHtPYmplY3R9IGJhc2UgLS0gdGhlIGJhc2Uga2V5IG9mIHRoaXMgY2hhaW4gKG9yaWdpbmFsbHkgIiIpCgkqLwoJZnVuY3Rpb24gX2dldExpbmVhclRyZWVTZWdtZW50cyhjdXJWaXpPYmosIGN1ck5vZGUsIGNoYWlucywgYmFzZSkgewoKCSAgICAvLyBpZiBpdCdzIGEgbmV3IGJhc2UsIGNyZWF0ZSB0aGUgYmFzZSwgd2l0aCBubyBkZXNjZW5kYW50cyBpbiBpdHMgYXJyYXkgeWV0CgkgICAgaWYgKGJhc2UgPT09ICIiKSB7CgkgICAgICAgIGJhc2UgPSBjdXJOb2RlLmlkOwoJICAgICAgICBjaGFpbnNbYmFzZV0gPSBbXTsKCSAgICAgICAgY3VyVml6T2JqLmRhdGEudHJlZUNoYWluUm9vdHMucHVzaChjdXJOb2RlLmlkKTsKCSAgICB9CgkgICAgLy8gaWYgaXQncyBhIGxpbmVhciBkZXNjZW5kYW50LCBhcHBlbmQgdGhlIGN1cnJlbnQga2V5IHRvIHRoZSBjaGFpbgoJICAgIGVsc2UgewoJICAgICAgICBjaGFpbnNbYmFzZV0ucHVzaChjdXJOb2RlLmlkKTsKCSAgICB9CgoJICAgIC8vIGlmIHRoZSBjdXJyZW50IGtleSBoYXMgMSBjaGlsZCB0byBzZWFyY2ggdGhyb3VnaAoJICAgIGlmIChjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aCA9PSAxKSB7IAoJICAgICAgICBfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyTm9kZS5jaGlsZHJlblswXSwgY2hhaW5zLCBiYXNlKTsKCSAgICB9CgoJICAgIC8vIG90aGVyd2lzZSBmb3IgZWFjaCBjaGlsZCwgY3JlYXRlIGEgYmxhbmsgYmFzZSAod2lsbCBiZWNvbWUgdGhhdCBjaGlsZCkKCSAgICBlbHNlIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICBfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyTm9kZS5jaGlsZHJlbltpXSwgY2hhaW5zLCAiIik7CgkgICAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiBjaGFpbnM7Cgl9CgoJLy8gQ0VMTFVMQVIgUFJFVkFMRU5DRSBGVU5DVElPTlMKCgkvKiBmdW5jdGlvbiB0byBnZXQgdGhlIGNlbGx1bGFyIHByZXZhbGVuY2UgZGF0YSBpbiBhIGJldHRlciBmb3JtYXQgCgkqIChwcm9wZXJ0aWVzIGF0IGxldmVsIDEgaXMgdGltZSwgYXQgbGV2ZWwgMiBpcyBndHlwZSkKCSovCglmdW5jdGlvbiBfZ2V0Q1BEYXRhKGN1clZpek9iaikgewoJICAgIHZhciB4ID0gY3VyVml6T2JqLnVzZXJDb25maWc7CgoJICAgIC8vIGZvciBlYWNoIHRpbWUgcG9pbnQsIGZvciBlYWNoIGdlbm90eXBlLCBnZXQgY2VsbHVsYXIgcHJldmFsZW5jZQoJICAgIHZhciBjcF9kYXRhX29yaWdpbmFsID0ge307CgkgICAgJC5lYWNoKHguY2xvbmFsX3ByZXYsIGZ1bmN0aW9uKGlkeCwgaGl0KSB7IC8vIGZvciBlYWNoIGhpdCAoZ2Vub3R5cGUvdGltZXBvaW50IGNvbWJpbmF0aW9uKQoJICAgICAgICBjcF9kYXRhX29yaWdpbmFsW2hpdC50aW1lcG9pbnRdID0gY3BfZGF0YV9vcmlnaW5hbFtoaXQudGltZXBvaW50XSB8fCB7fTsKCSAgICAgICAgLy8gb25seSBub3RlIGNlbGx1bGFyIHByZXZhbGVuY2VzIG5vdCBtYXJrZWQgYXMgemVybwoJICAgICAgICBpZiAocGFyc2VGbG9hdChoaXQuY2xvbmFsX3ByZXYpICE9PSAwKSB7CgkgICAgICAgICAgICBjcF9kYXRhX29yaWdpbmFsW2hpdC50aW1lcG9pbnRdW2hpdC5jbG9uZV9pZF0gPSBwYXJzZUZsb2F0KGhpdC5jbG9uYWxfcHJldik7IAoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8vIGNyZWF0ZSB0aW1lcG9pbnQgemVybyB3aXRoIDEwMCUgY2VsbHVsYXIgcHJldmFsZW5jZSBmb3IgdGhlIHJvb3Qgb2YgdGhlIHRyZWUKCSAgICBjcF9kYXRhX29yaWdpbmFsLlQwID0ge307CgkgICAgY3VyVml6T2JqLmRhdGEuY3BfZGF0YV9vcmlnaW5hbCA9IGNwX2RhdGFfb3JpZ2luYWw7CgoJICAgIC8vIGdldCBub3JtYWxpemVkIGNwIGRhdGEgKGluIGNhc2VzIHdoZXJlIGNwIGRvZXNuJ3QgYWRkIHRvIDEpCgkgICAgdmFyIGNwX2RhdGFfbm9ybSA9IHt9OwoJICAgIE9iamVjdC5rZXlzKGNwX2RhdGFfb3JpZ2luYWwpLmZvckVhY2goZnVuY3Rpb24odHBfa2V5KSB7CgkgICAgICAgIC8vIGdldCB0b3RhbCBjcCBmb3IgdGhpcyB0aW1lcG9pbnQKCSAgICAgICAgdmFyIHRwX3RvdGFsID0gMDsKCSAgICAgICAgT2JqZWN0LmtleXMoY3BfZGF0YV9vcmlnaW5hbFt0cF9rZXldKS5mb3JFYWNoKGZ1bmN0aW9uKGd0eXBlX2tleSkgewoJICAgICAgICAgICAgdHBfdG90YWwgKz0gY3BfZGF0YV9vcmlnaW5hbFt0cF9rZXldW2d0eXBlX2tleV07CgkgICAgICAgIH0pOwoKCSAgICAgICAgLy8gZ2V0IHByb3BvcnRpb25hdGUgY3AgZm9yIGVhY2ggZ2Vub3R5cGUKCSAgICAgICAgY3BfZGF0YV9ub3JtW3RwX2tleV0gPSB7fTsKCSAgICAgICAgT2JqZWN0LmtleXMoY3BfZGF0YV9vcmlnaW5hbFt0cF9rZXldKS5mb3JFYWNoKGZ1bmN0aW9uKGd0eXBlX2tleSkgewoJICAgICAgICAgICAgY3BfZGF0YV9ub3JtW3RwX2tleV1bZ3R5cGVfa2V5XSA9IGNwX2RhdGFfb3JpZ2luYWxbdHBfa2V5XVtndHlwZV9rZXldL3RwX3RvdGFsOwoJICAgICAgICB9KTsKCSAgICB9KQoKCSAgICBjdXJWaXpPYmouZGF0YS5jcF9kYXRhID0gY3BfZGF0YV9ub3JtOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgY2VsbHVsYXIgcHJldmFsZW5jZSB2YWx1ZSBmb3IgZWFjaCBnZW5vdHlwZSBhdCBpdHMgZW1lcmdlbmNlCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKCSovCglmdW5jdGlvbiBfZ2V0RW1lcmdlbmNlVmFsdWVzKGN1clZpek9iaikgewoJICAgIHZhciBjcF9kYXRhID0gY3VyVml6T2JqLmRhdGEuY3BfZGF0YSwKCSAgICAgICAgZW1lcmdlbmNlX3ZhbHVlcyA9IHt9LAoJICAgICAgICBndHlwZXM7CgoJICAgIC8vIGZvciBlYWNoIHRpbWUgcG9pbnQKCSAgICBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmZvckVhY2goZnVuY3Rpb24odHApIHsgCgoJICAgICAgICAvLyBnZXQgZ2Vub3R5cGVzCgkgICAgICAgIGd0eXBlcyA9IE9iamVjdC5rZXlzKGNwX2RhdGFbdHBdKTsgCgoJICAgICAgICAvLyBhZGQgZ2Vub3R5cGVzIGlmIG5vdCBwcmVzZW50IGFscmVhZHkKCSAgICAgICAgJC5lYWNoKGd0eXBlcywgZnVuY3Rpb24oaWR4LCBnKSB7CgkgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoZW1lcmdlbmNlX3ZhbHVlcykuaW5kZXhPZihnKSA9PSAtMSkgeyAKCSAgICAgICAgICAgICAgICBlbWVyZ2VuY2VfdmFsdWVzW2ddID0gY3BfZGF0YVt0cF1bZ107CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pCgkgICAgfSk7CgoJICAgIHJldHVybiBlbWVyZ2VuY2VfdmFsdWVzOwoJfTsKCgkvKiBmdW5jdGlvbiB0byBnZXQgdGhlIHRpbWVwb2ludCB0aGF0IGVhY2ggZ2Vub3R5cGUgZW1lcmdlcwoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldEVtZXJnZW5jZVRpbWVwb2ludHMoY3VyVml6T2JqKSB7CgkgICAgdmFyIGNwX2RhdGEgPSBjdXJWaXpPYmouZGF0YS5jcF9kYXRhLAoJICAgICAgICBlbWVyZ2VuY2VfdHBzID0ge30sCgkgICAgICAgIGd0eXBlczsKCgkgICAgLy8gZm9yIGVhY2ggdGltZSBwb2ludAoJICAgIGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMuZm9yRWFjaChmdW5jdGlvbih0cCkgeyAKCgkgICAgICAgIC8vIGdldCBnZW5vdHlwZXMKCSAgICAgICAgZ3R5cGVzID0gT2JqZWN0LmtleXMoY3BfZGF0YVt0cF0pOyAKCgkgICAgICAgIC8vIGFkZCBnZW5vdHlwZXMgaWYgbm90IHByZXNlbnQgYWxyZWFkeQoJICAgICAgICAkLmVhY2goZ3R5cGVzLCBmdW5jdGlvbihpZHgsIGcpIHsKCSAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhlbWVyZ2VuY2VfdHBzKS5pbmRleE9mKGcpID09IC0xKSB7IAoJICAgICAgICAgICAgICAgIGVtZXJnZW5jZV90cHNbZ10gPSB0cDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSkKCSAgICB9KTsKCgkgICAgcmV0dXJuIGVtZXJnZW5jZV90cHM7Cgl9OwoKCS8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgZ2Vub3R5cGUtY2VudHJpYyBjZWxsdWxhciBwcmV2YWxlbmNlIGRhdGEgZnJvbSB0aGUgdGltZS1jZW50cmljIGNlbGx1bGFyIHByZXZhbGVuY2UgZGF0YQoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldEdlbm90eXBlQ1BEYXRhKGN1clZpek9iaikgewoJICAgIHZhciBjcF9kYXRhID0gY3VyVml6T2JqLmRhdGEuY3BfZGF0YSwKCSAgICAgICAgZ2Vub3R5cGVfY3AgPSB7fTsKCgkgICAgT2JqZWN0LmtleXMoY3BfZGF0YSkuZm9yRWFjaChmdW5jdGlvbih0cCwgdHBfaWR4KSB7CgkgICAgICAgIE9iamVjdC5rZXlzKGNwX2RhdGFbdHBdKS5mb3JFYWNoKGZ1bmN0aW9uKGd0eXBlLCBndHlwZV9pZHgpIHsKCSAgICAgICAgICAgIGdlbm90eXBlX2NwW2d0eXBlXSA9IGdlbm90eXBlX2NwW2d0eXBlXSB8fCB7fTsKCSAgICAgICAgICAgIGdlbm90eXBlX2NwW2d0eXBlXVt0cF0gPSBjcF9kYXRhW3RwXVtndHlwZV07CgkgICAgICAgIH0pOwoJICAgIH0pOyAKCgkgICAgY3VyVml6T2JqLmRhdGEuZ2Vub3R5cGVfY3AgPSBnZW5vdHlwZV9jcDsKCX0KCgkvLyBMQVlPVVQgRlVOQ1RJT05TCgoJLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBsYXlvdXQgb2YgdGhlIHRpbWVzY2FwZSwgZGlmZmVyZW50IGRlcGVuZGluZyBvbiB3aGV0aGVyIHVzZXIgd2FudHMgY2VudHJlZCwKCSogc3RhY2tlZCBvciBzcGFjZWQgdmlldwoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldExheW91dChjdXJWaXpPYmopIHsKCSAgICB2YXIgZ3R5cGVQb3MgPSBjdXJWaXpPYmoudXNlckNvbmZpZy5nZW5vdHlwZV9wb3NpdGlvbjsKCgoJICAgIC8vIHRyYXZlcnNlIHRoZSB0cmVlIHRvIHNvcnQgdGhlIGdlbm90eXBlcyBpbnRvIGEgZmluYWwgdmVydGljYWwgc3RhY2tpbmcgb3JkZXIgKGluY29ycG9yYXRpbmcgaGllcmFyY2h5KQoJICAgIGN1clZpek9iai5kYXRhLmxheW91dE9yZGVyID0gX2dldExheW91dE9yZGVyKGN1clZpek9iai5nZW5lcmFsQ29uZmlnLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEudHJlZVN0cnVjdHVyZSwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmVtZXJnZW5jZV92YWx1ZXMsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmVtZXJnZW5jZV90cHMsIAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyVml6T2JqLnVzZXJDb25maWcuc29ydF9ndHlwZXMpOwoKCSAgICAvLyAtLS0tLS0+IENFTlRSRUQgCgkgICAgaWYgKGd0eXBlUG9zID09ICJjZW50cmUiKSB7CgoJICAgICAgICAvLyBnZXQgbGF5b3V0IG9mIGVhY2ggZ2Vub3R5cGUgYXQgZWFjaCB0aW1lcG9pbnQKCSAgICAgICAgY3VyVml6T2JqLmRhdGEubGF5b3V0ID0ge307CgkgICAgICAgICQuZWFjaChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLCBmdW5jdGlvbih0cF9pZHgsIHRwKSB7IAoJICAgICAgICAgICAgX2dldENlbnRyZWRMYXlvdXQoY3VyVml6T2JqLCBjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlLCB0cCwgY3VyVml6T2JqLmRhdGEubGF5b3V0LCAwKTsKCSAgICAgICAgfSkKCSAgICB9CgoJICAgIC8vIC0tLS0tLT4gU1RBQ0tFRCBhbmQgU1BBQ0VECgkgICAgZWxzZSB7CgoJICAgICAgICAvLyBnZXQgbGF5b3V0IG9mIGVhY2ggZ2Vub3R5cGUgYXQgZWFjaCB0aW1lcG9pbnQKCSAgICAgICAgaWYgKGd0eXBlUG9zID09ICJzdGFjayIpIHsKCSAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmxheW91dCA9IF9nZXRTdGFja2VkTGF5b3V0KGN1clZpek9iaik7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSBpZiAoZ3R5cGVQb3MgPT0gInNwYWNlIikgewoJICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEubGF5b3V0ID0gX2dldFNwYWNlZExheW91dChjdXJWaXpPYmopOyAKCSAgICAgICAgfQoJICAgIH0gICAKCgkgICAgLy8gU0hJRlQgRU1FUkdFTkNFIFgtQ09PUkRJTkFURVMKCgkgICAgLy8gaW4gdGhlIGxheW91dCwgc2hpZnQgeC12YWx1ZXMgaWYgPjEgZ2Vub3R5cGUgZW1lcmdlcyBhdCB0aGUgCgkgICAgLy8gc2FtZSB0aW1lIHBvaW50IGZyb20gdGhlIHNhbWUgY2xhZGUgaW4gdGhlIHRyZWUKCSAgICBfc2hpZnRFbWVyZ2VuY2UoY3VyVml6T2JqKQoJfQoKCS8qCgkqIGZ1bmN0aW9uIHRvLCB1c2luZyB0aGUgb3JkZXIgb2YgZ2Vub3R5cGUgZW1lcmdlbmNlICh2YWx1ZSAmIHRwKSBhbmQgdGhlIHRyZWUgaGllcmFyY2h5LCBnZXQgdGhlIHZlcnRpY2FsCgkqIHN0YWNraW5nIG9yZGVyIG9mIHRoZSBnZW5vdHlwZXMKCSogLS0gZW5zdXJlcyB0aGF0IHRoZSAqbGF0ZXIqIGNoaWxkcmVuIGVtZXJnZSwgdGhlICpjbG9zZXIqIHRoZXkgYXJlIHRvIHRoZSB0b3Agb2YgdGhlIHBhcmVudCBzd2VlcAoJKiBAcGFyYW0ge09iamVjdH0gZGltIC0tIGdlbmVyYWwgY29uZmlndXJhdGlvbnMgb2YgdGhlIHZpc3VhbGl6YXRpb24KCSogQHBhcmFtIHtPYmplY3R9IHRpbWVzY2FwZV9kYXRhIC0tIHRpbWVzY2FwZSBkYXRhCgkqIEBwYXJhbSB7QXJyYXl9IGVtZXJnZW5jZV92YWx1ZXMgLS0gdmFsdWVzIG9mIGdlbm90eXBlIGVtZXJnZW5jZQoJKiBAcGFyYW0ge0FycmF5fSBlbWVyZ2VuY2VfdHBzIC0tIHRpbWVwb2ludHMgb2YgZ2Vub3R5cGUgZW1lcmdlbmNlCgkqIEBwYXJhbSB7QXJyYXl9IHRpbWVwb2ludHMgLS0gdGltZXBvaW50cyBpbiBkYXRhc2V0CgkqIEBwYXJhbSB7QXJyYXl9IGxheW91dE9yZGVyIC0tIG9yaWdpbmFsbHkgZW1wdHkgYXJyYXkgb2YgdGhlIGZpbmFsIHZlcnRpY2FsIHN0YWNraW5nIG9yZGVyCgkqIEBwYXJhbSB7Qm9vbGVhbn0gc29ydF9ieV9lbWVyZyAtLSB3aGV0aGVyIG9yIG5vdCB0byB2ZXJ0aWNhbGx5IHNvcnQgY2hpbGRyZW4gYnkgZW1lcmdlbmNlIHZhbHVlcwoJKi8KCWZ1bmN0aW9uIF9nZXRMYXlvdXRPcmRlcihkaW0sIGN1ck5vZGUsIGVtZXJnZW5jZV92YWx1ZXMsIGVtZXJnZW5jZV90cHMsIHRpbWVwb2ludHMsIGxheW91dE9yZGVyLCBzb3J0X2J5X2VtZXJnKSB7CgkgICAgdmFyIGNoaWxkX2VtZXJnX3ZhbHMgPSBbXSwgLy8gZW1lcmdlbmNlIHZhbHVlcyBvZiBjaGlsZHJlbgoJICAgICAgICBzb3J0ZWRfY2hpbGRyZW4sIC8vIGNoaWxkcmVuIHNvcnRlZCBieSB0aGVpciBlbWVyZ2VuY2UgdmFsdWVzCgkgICAgICAgIGNoaWxkX29iajsgLy8gY3VycmVudCBjaGlsZCBub2RlCgoJICAgIC8vIGFkZCB0aGUgY3VycmVudCBrZXkgaWQgdG8gdGhlIGZpbmFsIHZlcnRpY2FsIHN0YWNraW5nIG9yZGVyCgkgICAgaWYgKGN1ck5vZGUuaWQgIT0gZGltLnBoYW50b21Sb290KSB7CgkgICAgICAgIGxheW91dE9yZGVyLnB1c2goY3VyTm9kZS5pZCk7CgkgICAgfQoKCSAgICAvLyBpZiB0aGUgY3VycmVudCBrZXkgaGFzIGNoaWxkcmVuIHRvIHNlYXJjaCB0aHJvdWdoCgkgICAgaWYgKGN1ck5vZGUuY2hpbGRyZW4gJiYgY3VyTm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CgoJICAgICAgICAvLyBnZXQgZW1lcmdlbmNlIHZhbHVlICYgdGltZXBvaW50IG9mIGNoaWxkcmVuCgkgICAgICAgIGZvciAoaT0wOyBpPGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBlbWVyZ192YWwgPSBlbWVyZ2VuY2VfdmFsdWVzW2N1ck5vZGUuY2hpbGRyZW5baV0uaWRdLAoJICAgICAgICAgICAgICAgIGVtZXJnZV90cCA9IHRpbWVwb2ludHMuaW5kZXhPZihlbWVyZ2VuY2VfdHBzW2N1ck5vZGUuY2hpbGRyZW5baV0uaWRdKTsKCgkgICAgICAgICAgICBjaGlsZF9lbWVyZ192YWxzLnB1c2goCgkgICAgICAgICAgICAgICAgewoJICAgICAgICAgICAgICAgICAgICAiaWQiOiBjdXJOb2RlLmNoaWxkcmVuW2ldLmlkLAoJICAgICAgICAgICAgICAgICAgICAiZW1lcmdfdmFsIjogZW1lcmdfdmFsLAoJICAgICAgICAgICAgICAgICAgICAidHAiOiB0aW1lcG9pbnRzLmxlbmd0aCAtIGVtZXJnZV90cCAKCSAgICAgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIC8vIHZlcnRpY2FsbHkgc29ydCBjaGlsZHJlbiBieSB0aGVpciBlbWVyZ2VuY2UgdmFsdWVzCgkgICAgICAgICAgICBpZiAoc29ydF9ieV9lbWVyZykgewoJICAgICAgICAgICAgICAgIHNvcnRlZF9jaGlsZHJlbiA9IF9zb3J0QnlLZXkoY2hpbGRfZW1lcmdfdmFscywgInRwIiwgImVtZXJnX3ZhbCIpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gZG8gbm90IHZlcnRpY2FsbHkgc29ydCBieSBlbWVyZ2VuY2UgdmFsdWVzCgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICBzb3J0ZWRfY2hpbGRyZW4gPSBfc29ydEJ5S2V5KGNoaWxkX2VtZXJnX3ZhbHMsICJ0cCIpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICAvLyBpbiB0aGUgKnJldmVyc2UqIG9yZGVyIG9mIGVtZXJnZW5jZSB2YWx1ZXMsIHNlYXJjaCBjaGlsZHJlbgoJICAgICAgICBzb3J0ZWRfY2hpbGRyZW4ubWFwKGZ1bmN0aW9uKGNoaWxkKSB7CgkgICAgICAgICAgICBjaGlsZF9vYmogPSBfLmZpbmRXaGVyZShjdXJOb2RlLmNoaWxkcmVuLCB7aWQ6IGNoaWxkLmlkfSk7CgkgICAgICAgICAgICBfZ2V0TGF5b3V0T3JkZXIoZGltLCBjaGlsZF9vYmosIGVtZXJnZW5jZV92YWx1ZXMsIGVtZXJnZW5jZV90cHMsIHRpbWVwb2ludHMsIGxheW91dE9yZGVyLCBzb3J0X2J5X2VtZXJnKTsKCSAgICAgICAgfSkKCSAgICB9CgoJICAgIHJldHVybiBsYXlvdXRPcmRlcjsKCX0KCgkvKgoJKiBmdW5jdGlvbiB0byBnZXQgdGhlIGxheW91dCBvZiB0aGUgdGltZXNjYXBlCgkqIC0tIGVuc3VyZXMgdGhhdCB0aGUgKmxhdGVyKiBjaGlsZHJlbiBlbWVyZ2UsIHRoZSAqY2xvc2VyKiB0aGV5IGFyZSB0byB0aGUgdG9wIG9mIHRoZSBwYXJlbnQgc3dlZXAKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKiBAcGFyYW0ge09iamVjdH0gY3VyTm9kZSAtLSBjdXJyZW50IGtleSBpbiB0aGUgdHJlZQoJKiBAcGFyYW0ge051bWJlcn0geUJvdHRvbSAtLSB3aGVyZSBpcyB0aGUgYm90dG9tIG9mIHRoaXMgZ2Vub3R5cGUsIGluIHRoZSB5LWRpbWVuc2lvbgoJKi8KCWZ1bmN0aW9uIF9nZXRDZW50cmVkTGF5b3V0KGN1clZpek9iaiwgY3VyTm9kZSwgdHAsIGxheW91dCwgeUJvdHRvbSkgewoJICAgIHZhciBndHlwZSA9IGN1ck5vZGUuaWQsCgkgICAgICAgIGNwX2RhdGEgPSBjdXJWaXpPYmouZGF0YS5jcF9kYXRhLAoJICAgICAgICB0aW1lcG9pbnRzID0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cywKCSAgICAgICAgbmV4dF90cCA9IHRpbWVwb2ludHNbdGltZXBvaW50cy5pbmRleE9mKHRwKSsxXSwKCSAgICAgICAgcHJldl90cCA9IHRpbWVwb2ludHNbdGltZXBvaW50cy5pbmRleE9mKHRwKS0xXSwKCSAgICAgICAgZ1R5cGVzX2N1clRQID0gT2JqZWN0LmtleXMoY3BfZGF0YVt0cF0pLCAvLyBnZW5vdHlwZXMgd2l0aCBjcCBkYXRhIGF0IHRoZSBDVVJSRU5UIHRpbWUgcG9pbnQKCSAgICAgICAgLy8gZ2Vub3R5cGVzIHdpdGggY3AgZGF0YSBhdCB0aGUgUFJFVklPVVMgdGltZSBwb2ludAoJICAgICAgICBnVHlwZXNfcHJldlRQID0gKGNwX2RhdGFbcHJldl90cF0pID8gT2JqZWN0LmtleXMoY3BfZGF0YVtwcmV2X3RwXSkgOiB1bmRlZmluZWQsIAoJICAgICAgICBjdXJEZXNjZW5kYW50cyA9IGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0FycltndHlwZV0sCgkgICAgICAgIGdUeXBlQW5kRGVzY2VuZGFudHMgPSAoJC5leHRlbmQoW10sIGN1ckRlc2NlbmRhbnRzKSksCgkgICAgICAgIG5DaGlsZHJlbiA9IGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoLAoJICAgICAgICBjaGlsZENQID0gMCwgLy8gY3VtdWxhdGl2ZSBhbW91bnQgb2YgY2VsbHVsYXIgcHJldmFsZW5jZSBpbiB0aGUgY2hpbGRyZW47CgkgICAgICAgIGNoaWxkWUJvdHRvbSwgLy8gYm90dG9tIHktdmFsdWUgZm9yIHRoZSBuZXh0IGNoaWxkCgkgICAgICAgIGxheW91dE9yZGVyID0gY3VyVml6T2JqLmRhdGEubGF5b3V0T3JkZXIsCgkgICAgICAgIHNvcnRlZF9jaGlsZHJlbiwgLy8gY2hpbGRyZW4gc29ydGVkIGJ5IHRoZSBsYXlvdXQgb3JkZXIKCSAgICAgICAgY3VyX2NwID0gY3BfZGF0YVt0cF1bZ3R5cGVdLAoJICAgICAgICBwcmV2X2NwID0gKGNwX2RhdGFbcHJldl90cF0pID8gY3BfZGF0YVtwcmV2X3RwXVtndHlwZV0gOiB1bmRlZmluZWQsIC8vIENQIGZvciB0aGlzIGdlbm90eXBlLCBwcmV2IHRwCgkgICAgICAgIHRocmVzaG9sZCA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLnRocmVzaG9sZCwgLy8gY2VsbHVsYXIgcHJldmFsZW5jZSB0aHJlc2hvbGQgZm9yIHZpc2liaWxpdHkgb2YgYSBnZW5vdHlwZQoJICAgICAgICAvLyB0aGUgd2lkdGggb2YgdGhpcyBnZW5vdHlwZSwgaW5jbHVkaW5nIGRlc2NlbmRhbnRzCgkgICAgICAgIHdpZHRoID0gX2NhbGN1bGF0ZVdpZHRoKGN1clZpek9iaiwgdHAsIGd0eXBlLCB0aHJlc2hvbGQpLndpZHRoLCAKCSAgICAgICAgZW1lcmdlZCwgLy8gd2hldGhlciBvciBub3QgdGhlIGdlbm90eXBlIGVtZXJnZWQgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgIGRpc2FwcGVhcnMgPSAocHJldl9jcCAmJiAhY3VyX2NwKTsgLy8gd2hldGhlciB0aGlzIGdlbm90eXBlIGRpc2FwcGVhcnMgYXQgdGhlIGN1cnJlbnQgdGltZSBwb2ludAoJICAgIAoJICAgIGdUeXBlQW5kRGVzY2VuZGFudHMucHVzaChndHlwZSk7CgkgICAgCgkgICAgZW1lcmdlZCA9IF9nZXRJbnRlcnNlY3Rpb24oZ1R5cGVBbmREZXNjZW5kYW50cywgZ1R5cGVzX2N1clRQKS5sZW5ndGggPiAwICYmIAoJICAgICAgICBnVHlwZXNfcHJldlRQICYmIAoJICAgICAgICBfZ2V0SW50ZXJzZWN0aW9uKGdUeXBlQW5kRGVzY2VuZGFudHMsIGdUeXBlc19wcmV2VFApLmxlbmd0aCA9PT0gMDsgCgoJICAgIC8vIGxheW91dCBmb3IgdGhpcyB0aW1lcG9pbnQKCSAgICBsYXlvdXRbdHBdID0gbGF5b3V0W3RwXSB8fCB7fTsKCgkgICAgLy8gaWYgdGhlIGdlbm90eXBlIG9yIGFueSBkZXNjZW5kYW50cyBleGlzdCBhdCB0aGlzIHRpbWVwb2ludCwgb3IgaWYgdGhlIGdlbm90eXBlIGRpc2FwcGVhcnMgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgaWYgKGN1cl9jcCB8fCAoX2dldEludGVyc2VjdGlvbihjdXJEZXNjZW5kYW50cywgZ1R5cGVzX2N1clRQKS5sZW5ndGggPiAwKSB8fCBkaXNhcHBlYXJzKSB7CgoJICAgICAgICAvLyBpZiB0aGlzIGdlbm90eXBlIGVtZXJnZWQgYXQgdGhlIHByZXZpb3VzIHRpbWUgcG9pbnQKCSAgICAgICAgaWYgKGVtZXJnZWQgJiYgZ3R5cGUgIT0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcucGhhbnRvbVJvb3QpIHsKCgkgICAgICAgICAgICBsYXlvdXRbcHJldl90cF1bZ3R5cGVdID0gewoJICAgICAgICAgICAgICAgICJ3aWR0aCI6IDAsCgkgICAgICAgICAgICAgICAgIm1pZGRsZSI6IHlCb3R0b20gKyAod2lkdGgvMiksCgkgICAgICAgICAgICAgICAgImJvdHRvbSI6IHlCb3R0b20gKyAod2lkdGgvMiksCgkgICAgICAgICAgICAgICAgInRvcCI6IHlCb3R0b20gKyAod2lkdGgvMiksCgkgICAgICAgICAgICAgICAgImNwIjogMCwKCSAgICAgICAgICAgICAgICAic3RhdGUiOiAiZW1lcmdlcyIKCSAgICAgICAgICAgIH07CgkgICAgICAgIH0KCgkgICAgICAgIC8vIHNldCB0aGlzIGdlbm90eXBlIGluIHRoZSBsYXlvdXQgCgkgICAgICAgIGxheW91dFt0cF1bZ3R5cGVdID0gewoJICAgICAgICAgICAgIndpZHRoIjogd2lkdGgsCgkgICAgICAgICAgICAibWlkZGxlIjogeUJvdHRvbSArICh3aWR0aC8yKSwKCSAgICAgICAgICAgICJib3R0b20iOiB5Qm90dG9tLAoJICAgICAgICAgICAgInRvcCI6IHlCb3R0b20gKyB3aWR0aCwKCSAgICAgICAgICAgICJjcCI6IGN1cl9jcCwKCSAgICAgICAgICAgICJzdGF0ZSI6ICJwcmVzZW50IiwKCSAgICAgICAgICAgICJwcmVzZW50Q2hpbGRyZW4iOiBfZ2V0SW50ZXJzZWN0aW9uKGN1clZpek9iai5kYXRhLmRpcmVjdF9kZXNjZW5kYW50c1tndHlwZV0sIGdUeXBlc19jdXJUUCkubGVuZ3RoCgkgICAgICAgIH0KCgkgICAgICAgIC8vIG1hcmsgZGlzYXBwZWFyYW5jZSBzdGF0ZQoJICAgICAgICBpZiAoZGlzYXBwZWFycykgewoJICAgICAgICAgICAgbGF5b3V0W3RwXVtndHlwZV0uc3RhdGUgPSAiZGlzYXBwZWFyc19zdHJldGNoZWQiOwoJICAgICAgICB9CgkgICAgfQoKCSAgICAvLyBpZiB0aGVyZSBhcmUgY2hpbGRyZW4KCSAgICBpZiAobkNoaWxkcmVuID4gMCkgewoKCSAgICAgICAgLy8gc29ydCB0aGUgY2hpbGRyZW4gYnkgdGhlIGxheW91dCBvcmRlcgoJICAgICAgICBzb3J0ZWRfY2hpbGRyZW4gPSAkLmV4dGVuZChbXSwgY3VyTm9kZS5jaGlsZHJlbik7CgkgICAgICAgIHNvcnRlZF9jaGlsZHJlbi5zb3J0KF9zb3J0QnlMYXlvdXRPcmRlcihsYXlvdXRPcmRlcikpOwoKCSAgICAgICAgLy8gZm9yIGVhY2ggY2hpbGQKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuQ2hpbGRyZW47IGkrKykgewoKCSAgICAgICAgICAgIC8vIGdldCB0aGUgeS1jb29yZGluYXRlIGZvciB0aGUgYm90dG9tIG9mIHRoZSBjaGlsZCdzIGludGVydmFsCgkgICAgICAgICAgICBjaGlsZFlCb3R0b20gPSAoY3VyX2NwKSA/IC8vIGlmIHRoZSBjaGlsZCdzIGRpcmVjdCBhbmNlc3RvciBoYXMgY2VsbHVsYXIgcHJldmFsZW5jZSBhdCB0aGlzIHRpbWUKCSAgICAgICAgICAgICAgICAoKChpKzEpLyhuQ2hpbGRyZW4rMSkpICogY3VyX2NwKSArIGNoaWxkQ1AgKyB5Qm90dG9tIDogCgkgICAgICAgICAgICAgICAgY2hpbGRDUCArIHlCb3R0b207CgoJICAgICAgICAgICAgLy8gZ2V0IHRoZSBjaGlsZCdzIGxheW91dAoJICAgICAgICAgICAgX2dldENlbnRyZWRMYXlvdXQoY3VyVml6T2JqLCBzb3J0ZWRfY2hpbGRyZW5baV0sIHRwLCBsYXlvdXQsIGNoaWxkWUJvdHRvbSk7CgoJICAgICAgICAgICAgLy8gaW5jcmVhc2UgdGhlIGNlbGx1bGFyIHByZXZhbGVuY2Ugb2YgdGhlIGN1cnJlbnQgZ2Vub3R5cGUncyBjaGlsZHJlbiAoK2Rlc2NlbmRhbnRzKSBhY2NvdW50ZWQgZm9yCgkgICAgICAgICAgICBjaGlsZENQICs9IF9jYWxjdWxhdGVXaWR0aChjdXJWaXpPYmosIHRwLCBzb3J0ZWRfY2hpbGRyZW5baV0uaWQsIHRocmVzaG9sZCkud2lkdGg7CgkgICAgICAgIH0KCSAgICB9Cgl9OwoKCS8qIGZ1bmN0aW9uIHRvIGdldCBjZWxsdWxhciBwcmV2YWxlbmNlcyBmb3IgZWFjaCBnZW5vdHlwZSBpbiBhIHN0YWNrLCBvbmUgc3RhY2sgZm9yIGVhY2ggdGltZSBwb2ludAoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldFN0YWNrZWRMYXlvdXQoY3VyVml6T2JqKSB7CgkgICAgdmFyIGxheW91dCA9IHt9LAoJICAgICAgICBjcF9kYXRhID0gY3VyVml6T2JqLmRhdGEuY3BfZGF0YSwKCSAgICAgICAgdGltZXBvaW50cyA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMsCgkgICAgICAgIGxheW91dE9yZGVyID0gY3VyVml6T2JqLmRhdGEubGF5b3V0T3JkZXIsCgkgICAgICAgIGN1ckRlc2NlbmRhbnRzLAoJICAgICAgICBnVHlwZUFuZERlc2NlbmRhbnRzLCAvLyBnZW5vdHlwZSBhbmQgZGVzY2VuZGFudHMKCSAgICAgICAgZ1R5cGVzX2N1clRQLCAvLyBnZW5vdHlwZXMgd2l0aCBjcCBkYXRhIGF0IHRoZSBDVVJSRU5UIHRpbWUgcG9pbnQKCSAgICAgICAgZWZmZWN0aXZlX2NwLCAvLyBlZmZlY3RpdmUgY3AgZm9yIHRoaXMgZ2Vub3R5cGUgYXQgdGhpcyB0aW1lcG9pbnQKCSAgICAgICAgd2lkdGgsIC8vIHdpZHRoIHRvIGFkZCBmb3IgdGhpcyBnZW5vdHlwZSBhdCB0aGlzIHRpbWVwb2ludCAoaW5jbHVkZXMgZGVzY2VuZGFudHMgd2lkdGhzKQoJICAgICAgICBtaWRwb2ludCwgLy8gbWlkcG9pbnQgZm9yIGVtZXJnZW5jZQoJICAgICAgICB0aHJlc2hvbGQgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy50aHJlc2hvbGQ7IC8vIGNlbGx1bGFyIHByZXZhbGVuY2UgdGhyZXNob2xkIGZvciB2aXNpYmlsaXR5IG9mIGEgZ2Vub3R5cGUKCgkgICAgLy8gZm9yIGVhY2ggdGltZXBvaW50IChpbiBvcmRlcikuLi4KCSAgICAkLmVhY2godGltZXBvaW50cywgZnVuY3Rpb24odHBfaWR4LCB0cCkgeyAKCgkgICAgICAgIC8vIHN0YWNrIGZvciB0aGlzIHRpbWUgcG9pbnQgKG1heSBhbHJlYWR5IGJlIGNyZWF0ZWQgaWYgZGlzYXBwZWFyYW5jZSBvY2N1cnMgYXQgdGhpcyB0aW1lIHBvaW50KQoJICAgICAgICBsYXlvdXRbdHBdID0gbGF5b3V0W3RwXSB8fCB7fTsgCgoJICAgICAgICB2YXIgY3AgPSBjcF9kYXRhW3RwXSwgLy8gY2VsbHVsYXIgcHJldmFsZW5jZSBkYXRhIGZvciB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgIHNIZWlnaHQgPSAwLCAvLyBjdXJyZW50IGhlaWdodCBvZiB0aGUgc3RhY2sKCSAgICAgICAgICAgIHByZXZfdHAgPSB0aW1lcG9pbnRzW3RwX2lkeC0xXSwKCSAgICAgICAgICAgIG5leHRfdHAgPSB0aW1lcG9pbnRzW3RwX2lkeCsxXTsKCgkgICAgICAgIC8vIC4uLiBmb3IgZWFjaCBnZW5vdHlwZSAuLi4KCSAgICAgICAgJC5lYWNoKGxheW91dE9yZGVyLCBmdW5jdGlvbihndHlwZV9pZHgsIGd0eXBlKSB7IAoJICAgICAgICAgICAgZ1R5cGVzX2N1clRQID0gT2JqZWN0LmtleXMoY3BfZGF0YVt0cF0pOyAKCSAgICAgICAgICAgIGdUeXBlc19wcmV2VFAgPSAoY3BfZGF0YVtwcmV2X3RwXSkgPyBPYmplY3Qua2V5cyhjcF9kYXRhW3ByZXZfdHBdKSA6IHVuZGVmaW5lZDsgCgkgICAgICAgICAgICBjdXJEZXNjZW5kYW50cyA9IGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0FycltndHlwZV07CgkgICAgICAgICAgICBnVHlwZUFuZERlc2NlbmRhbnRzID0gKCQuZXh0ZW5kKFtdLCBjdXJEZXNjZW5kYW50cykpOyAKCSAgICAgICAgICAgIGdUeXBlQW5kRGVzY2VuZGFudHMucHVzaChndHlwZSk7IAoJICAgICAgICAgICAgCgkgICAgICAgICAgICAvLyBjYWxjdWxhdGUgZWZmZWN0aXZlIGNlbGx1bGFyIHByZXZhbGVuY2UgCgkgICAgICAgICAgICAvLyAiZWZmZWN0aXZlIiBiZWNhdXNlOiAKCSAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgLSBpdCBpcyBpbmNyZWFzZWQgaWYgaXQncyBiZWxvdyB0aGUgdGhyZXNob2xkCgkgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgIC0gaXQgaXMgcmVkdWNlZCBpZiBzaWJsaW5ncyBhcmUgYmVsb3cgdGhyZXNob2xkIGFuZCB0aGVyZWZvcmUgaW5jcmVhc2VkCgkgICAgICAgICAgICBlZmZlY3RpdmVfY3AgPSBfY2FsY3VsYXRlV2lkdGgoY3VyVml6T2JqLCB0cCwgZ3R5cGUsIHRocmVzaG9sZCkuZWZmZWN0aXZlX2NwOwoJICAgICAgICAgICAgd2lkdGggPSBfY2FsY3VsYXRlV2lkdGgoY3VyVml6T2JqLCB0cCwgZ3R5cGUsIHRocmVzaG9sZCkud2lkdGg7CgoKCSAgICAgICAgICAgIC8vIERJU0FQUEVBUklORyBMSU5FQUdFCgkgICAgICAgICAgICAvLyBpZiB0aGlzIGdlbm90eXBlIGV4aXN0ZWQgYXQgdGhlIHByZXYgdGltZSBwb2ludCwgCgkgICAgICAgICAgICAvLyBidXQgbmVpdGhlciBpdCBub3IgaXRzIGRlc2NlbmRhbnRzIGFyZSBjdXJyZW50bHkgcHJlc2VudAoJICAgICAgICAgICAgaWYgKGNwX2RhdGFbcHJldl90cF0gJiYgY3BfZGF0YVtwcmV2X3RwXVtndHlwZV0gJiYgIWNwX2RhdGFbdHBdW2d0eXBlXSAmJiAKCSAgICAgICAgICAgICAgICBfZ2V0SW50ZXJzZWN0aW9uKGdUeXBlQW5kRGVzY2VuZGFudHMsIGdUeXBlc19jdXJUUCkubGVuZ3RoID09PSAwKSB7CgkgICAgICAgICAgICAgICAgX2NyZWF0ZVN0YWNrRWxlbWVudChjdXJWaXpPYmosIGxheW91dCwgdHAsIGd0eXBlLCBzSGVpZ2h0LCBzSGVpZ2h0LCBlZmZlY3RpdmVfY3AsICJkaXNhcHBlYXJzX3N0cmV0Y2hlZCIpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIE5PTi1ESVNBUFBFQVJJTkcgTElORUFHRQoJICAgICAgICAgICAgZWxzZSB7CgoJICAgICAgICAgICAgCS8vIGlmIHRoaXMgZ2Vub3R5cGUgaGFzIGFscmVhZHkgYmVlbiBSRVBMQUNFRCBieSBhbnkgZGVzY2VuZGFudCBhdCBhIFBSRVZJT1VTIHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICBpZiAoY3BfZGF0YVtwcmV2X3RwXSAmJiAhY3BfZGF0YVt0cF1bZ3R5cGVdICYmICFjcF9kYXRhW3ByZXZfdHBdW2d0eXBlXSAmJiAoX2dldEludGVyc2VjdGlvbihjdXJEZXNjZW5kYW50cywgZ1R5cGVzX2N1clRQKS5sZW5ndGggPiAwKSkgewoKCSAgICAgICAgICAgICAgICAgICAgX2NyZWF0ZVN0YWNrRWxlbWVudChjdXJWaXpPYmosIGxheW91dCwgdHAsIGd0eXBlLCBzSGVpZ2h0LCBzSGVpZ2h0ICsgd2lkdGgsIGVmZmVjdGl2ZV9jcCwgImFscmVhZHlfcmVwbGFjZWQiKTsKCSAgICAgICAgICAgICAgICAgICAgbWlkcG9pbnQgPSAobGF5b3V0W3RwXVtndHlwZV0uYm90dG9tICsgbGF5b3V0W3RwXVtndHlwZV0udG9wKS8yOwoKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgZ2Vub3R5cGUgaXMgUkVQTEFDRUQgYnkgYW55IGRlc2NlbmRhbnQgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoIWNwX2RhdGFbdHBdW2d0eXBlXSAmJiAoX2dldEludGVyc2VjdGlvbihjdXJEZXNjZW5kYW50cywgZ1R5cGVzX2N1clRQKS5sZW5ndGggPiAwKSkgewoKCSAgICAgICAgICAgICAgICAgICAgX2NyZWF0ZVN0YWNrRWxlbWVudChjdXJWaXpPYmosIGxheW91dCwgdHAsIGd0eXBlLCBzSGVpZ2h0LCBzSGVpZ2h0ICsgd2lkdGgsIGVmZmVjdGl2ZV9jcCwgInJlcGxhY2VkIik7CgkgICAgICAgICAgICAgICAgICAgIG1pZHBvaW50ID0gKGxheW91dFt0cF1bZ3R5cGVdLmJvdHRvbSArIGxheW91dFt0cF1bZ3R5cGVdLnRvcCkvMjsKCgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGdlbm90eXBlIG9yIGFueSBkZXNjZW5kYW50cyBFWElTVCBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICBlbHNlIGlmIChfZ2V0SW50ZXJzZWN0aW9uKGdUeXBlQW5kRGVzY2VuZGFudHMsIGdUeXBlc19jdXJUUCkubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbl9kZXNjX3ByZXNlbnQgPSBfZ2V0SW50ZXJzZWN0aW9uKGN1ckRlc2NlbmRhbnRzLCBnVHlwZXNfY3VyVFApLmxlbmd0aDsKCgkgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBpdCBhcyBwcmVzZW50CgkgICAgICAgICAgICAgICAgICAgIF9jcmVhdGVTdGFja0VsZW1lbnQoY3VyVml6T2JqLCBsYXlvdXQsIHRwLCBndHlwZSwgc0hlaWdodCwgc0hlaWdodCArIHdpZHRoLCBlZmZlY3RpdmVfY3AsICJwcmVzZW50Iik7CgkgICAgICAgICAgICAgICAgICAgIG1pZHBvaW50ID0gKGxheW91dFt0cF1bZ3R5cGVdLmJvdHRvbSArIGxheW91dFt0cF1bZ3R5cGVdLnRvcCkvMjsKCgkgICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBzdGFjayBoZWlnaHQKCSAgICAgICAgICAgICAgICAgICAgc0hlaWdodCArPSBlZmZlY3RpdmVfY3A7CgkgICAgICAgICAgICAgICAgfQoKCgkgICAgICAgICAgICAgICAgLy8gaWYgaXQgRU1FUkdFRCBhdCB0aGUgcHJldmlvdXMgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgIGlmIChjcF9kYXRhW3ByZXZfdHBdICYmCgkgICAgICAgICAgICAgICAgICAgIChfZ2V0SW50ZXJzZWN0aW9uKGdUeXBlQW5kRGVzY2VuZGFudHMsIGdUeXBlc19wcmV2VFApLmxlbmd0aCA9PT0gMCkgJiYKCSAgICAgICAgICAgICAgICAgICAgKGdUeXBlc19jdXJUUCAmJiBfZ2V0SW50ZXJzZWN0aW9uKGdUeXBlQW5kRGVzY2VuZGFudHMsIGdUeXBlc19jdXJUUCkubGVuZ3RoID4gMCkpIHsKCgkgICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBpdHMgZW1lcmdlbmNlIHktdmFsdWUKCSAgICAgICAgICAgICAgICAgICAgX2NyZWF0ZVN0YWNrRWxlbWVudChjdXJWaXpPYmosIGxheW91dCwgcHJldl90cCwgZ3R5cGUsIG1pZHBvaW50LCBtaWRwb2ludCwgZWZmZWN0aXZlX2NwLCAiZW1lcmdlcyIpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfSkKCSAgICB9KQoKCSAgICByZXR1cm4gbGF5b3V0OwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGdldCBjZWxsdWxhciBwcmV2YWxlbmNlcyBmb3IgZWFjaCBnZW5vdHlwZSBpbiBhICpzcGFjZWQqIHN0YWNrLCBvbmUgc3RhY2sgZm9yIGVhY2ggdGltZSBwb2ludAoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldFNwYWNlZExheW91dChjdXJWaXpPYmopIHsKCSAgICB2YXIgbGF5b3V0ID0ge30sCgkgICAgICAgIGNwX2RhdGEgPSBjdXJWaXpPYmouZGF0YS5jcF9kYXRhLAoJICAgICAgICB0aW1lcG9pbnRzID0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cywKCSAgICAgICAgbGF5b3V0T3JkZXIgPSBjdXJWaXpPYmouZGF0YS5sYXlvdXRPcmRlciwKCSAgICAgICAgY3VyRGVzY2VuZGFudHMsCgkgICAgICAgIGdUeXBlQW5kRGVzY2VuZGFudHMsIC8vIGdlbm90eXBlIGFuZCBkZXNjZW5kYW50cwoJICAgICAgICBjdXJBbmNlc3RvcnMsIC8vIGFsbCBhbmNlc3RvcnMgb2YgY3VycmVudCBnZW5vdHlwZQoJICAgICAgICBnVHlwZXNfY3VyVFAsIC8vIGdlbm90eXBlcyB3aXRoIGNwIGRhdGEgYXQgdGhlIENVUlJFTlQgdGltZSBwb2ludAoJICAgICAgICBnVHlwZXNfbmV4dFRQLCAvLyBnZW5vdHlwZXMgd2l0aCBjcCBkYXRhIGF0IHRoZSBORVhUIHRpbWUgcG9pbnQKCSAgICAgICAgd2lkdGgsIC8vIHRoZSBjcCBhcyB0aGUgd2lkdGggdG8gYWRkIGZvciB0aGlzIGdlbm90eXBlIGF0IHRoaXMgdGltZXBvaW50CgkgICAgICAgIG1pZHBvaW50LCAvLyBtaWRwb2ludCBmb3IgZW1lcmdlbmNlCgkgICAgICAgIGFuY2VzdG9yX21pZHBvaW50LCAvLyBhbmNlc3RvcidzIG1pZHBvaW50IGZvciBlbWVyZ2VuY2UKCSAgICAgICAgZGlyZWN0X2FuY2VzdG9ycyA9IGN1clZpek9iai5kYXRhLmRpcmVjdF9hbmNlc3RvcnMsIC8vIGRpcmVjdCBhbmNlc3RvciBmb3IgZWFjaCBnZW5vdHlwZQoJICAgICAgICBkaXJlY3RfZGVzY2VuZGFudHMgPSBjdXJWaXpPYmouZGF0YS5kaXJlY3RfZGVzY2VuZGFudHMsIC8vIGRpcmVjdCBkZXNjZW5kYW50IGZvciBlYWNoIGdlbm90eXBlCgkgICAgICAgIHNwYWNlID0gOC9jdXJWaXpPYmouZ2VuZXJhbENvbmZpZy50c1NWR0hlaWdodDsgLy8gc3BhY2UgYmV0d2VlbiBnZW5vdHlwZXMgKGluIHBpeGVscykgCgoJICAgIC8vIEdFVCBTVEFDS0VEIExBWU9VVAoKCSAgICBsYXlvdXQgPSBfZ2V0U3RhY2tlZExheW91dChjdXJWaXpPYmopOwoKCSAgICAvLyBTUEFDRSBUSEUgU1RBQ0tFRCBMQVlPVVQKCgkgICAgLy8gZm9yIGVhY2ggdGltZXBvaW50IChpbiBvcmRlcikuLi4KCSAgICAkLmVhY2godGltZXBvaW50cywgZnVuY3Rpb24odHBfaWR4LCB0cCkgeyAKCgkgICAgICAgIHZhciBzZWVuR1R5cGVzID0gW107CgkgICAgICAgIHByZXZfdHAgPSB0aW1lcG9pbnRzW3RwX2lkeC0xXTsKCgkgICAgICAgIC8vIC4uLiBmb3IgZWFjaCBnZW5vdHlwZSAuLi4KCSAgICAgICAgJC5lYWNoKGxheW91dE9yZGVyLCBmdW5jdGlvbihndHlwZV9pZHgsIGd0eXBlKSB7CgoJICAgICAgICAgICAgLy8gaWYgdGhlIGdlbm90eXBlIGhhc24ndCBhbHJlYWR5IGJlZW4gc3BhY2VkLCBhbmQgbm9yIGlzIGl0IHRoZSByb290CgkgICAgICAgICAgICBpZiAoc2VlbkdUeXBlcy5pbmRleE9mKGd0eXBlKSA9PSAtMSkgewoKCSAgICAgICAgICAgICAgICBnVHlwZXNfY3VyVFAgPSBPYmplY3Qua2V5cyhjcF9kYXRhW3RwXSk7CgkgICAgICAgICAgICAgICAgdmFyIGN1cl9hbmNlc3RvciA9IGRpcmVjdF9hbmNlc3RvcnNbZ3R5cGVdLAoJICAgICAgICAgICAgICAgICAgICBjdXJfYW5jZXN0b3JfY3AgPSBjcF9kYXRhW3RwXVtjdXJfYW5jZXN0b3JdIHx8IDAsCgkgICAgICAgICAgICAgICAgICAgIGN1cl9zaWJsaW5ncyA9IGRpcmVjdF9kZXNjZW5kYW50c1tjdXJfYW5jZXN0b3JdLAoJICAgICAgICAgICAgICAgICAgICBwcmVzZW50X3NpYmxpbmdzID0gX2dldEludGVyc2VjdGlvbihkaXJlY3RfZGVzY2VuZGFudHNbY3VyX2FuY2VzdG9yXSwgZ1R5cGVzX2N1clRQKSwKCSAgICAgICAgICAgICAgICAgICAgY3VyX3NwYWNlID0gKChwcmVzZW50X3NpYmxpbmdzLmxlbmd0aCsxKSAqIHNwYWNlIDwgY3VyX2FuY2VzdG9yX2NwKSA/IAoJICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2UgOiAKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cl9hbmNlc3Rvcl9jcC8ocHJlc2VudF9zaWJsaW5ncy5sZW5ndGgrMSk7CgoJICAgICAgICAgICAgICAgIC8vIHNvcnQgY2hpbGRyZW4gYnkgcmV2ZXJzZSBsYXlvdXQgb3JkZXIgKHRvcCB0byBib3R0b20gKGluIHRlcm1zIG9mIHktdmFsdWUpKQoJICAgICAgICAgICAgICAgIHZhciBzb3J0ZWRfcHJlc2VudF9zaWJzID0gcHJlc2VudF9zaWJsaW5ncy5zb3J0KF9zb3J0QnlMYXlvdXRPcmRlcihsYXlvdXRPcmRlcikpLnJldmVyc2UoKTsKCSAgICAgICAgICAgICAgICB2YXIgc29ydGVkX2N1cl9zaWJzID0gY3VyX3NpYmxpbmdzLnNvcnQoX3NvcnRCeUxheW91dE9yZGVyKGxheW91dE9yZGVyKSkucmV2ZXJzZSgpOwoKCSAgICAgICAgICAgICAgICBpZiAoc29ydGVkX3ByZXNlbnRfc2licy5sZW5ndGggPiAwKSB7CgoJICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIHN0YWNrIGhlaWdodCAoZnJvbSB0aGUgdG9wKQoJICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGFuIGFuY2VzdG9yIAoJICAgICAgICAgICAgICAgICAgICBpZiAobGF5b3V0W3RwXVtjdXJfYW5jZXN0b3JdKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzSGVpZ2h0ID0gKGxheW91dFt0cF1bY3VyX2FuY2VzdG9yXS50b3AgPT0gbGF5b3V0W3RwXVtjdXJfYW5jZXN0b3JdLmJvdHRvbSkgPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBhbmNlc3RvciBoYXMgYmVlbiByZXBsYWNlZCwgc2V0IHN0YWNrIHRvcCBhcyB0aGUgZmlyc3Qgc2libGluZydzIHRvcCB2YWx1ZQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bc29ydGVkX3NpYmxpbmdzWzBdXS50b3AgOiAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UsIHNldCB0aGUgdG9wIGFzIHRoZSBhbmNlc3RvcidzIHRvcCB2YWx1ZQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bY3VyX2FuY2VzdG9yXS50b3A7IAoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIG5vIGFuY2VzdG9yCgkgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgc0hlaWdodCA9IDE7CgkgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgIC8vIGZvciBlYWNoIHNpYmxpbmcKCSAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3J0ZWRfY3VyX3NpYnMubGVuZ3RoOyBpKyspIHsKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50IHNpYmxpbmcKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaWIgPSBzb3J0ZWRfY3VyX3NpYnNbaV07IAoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpZHRoIG9mIHNpYmxpbmcKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJfd2lkdGggPSAobGF5b3V0W3RwXVtzaWJdKSA/IAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBzaWJsaW5nIChvciBpdHMgZGVzY2VuZGFudHMpIGV4aXN0IGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bc2liXS50b3AgLSBsYXlvdXRbdHBdW3NpYl0uYm90dG9tIDoKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzaWJsaW5nIGRvZXNuJ3QgZXhpc3QgYXQgdGhpcyB0cCwgbm9yIGRvZXMgYW55IG9mIGl0cyBkZXNjZW5kYW50cwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIDA7IAoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHNpYmxpbmcgZXhpc3RzLCBhbHRlciBpdHMgbGF5b3V0IGF0IHRoaXMgdGltZXBvaW50CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGF5b3V0W3RwXVtzaWJdKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0W3RwXVtzaWJdLnRvcCA9IHNIZWlnaHQgLSBjdXJfc3BhY2U7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0W3RwXVtzaWJdLmJvdHRvbSA9IHNIZWlnaHQgLSBjdXJfd2lkdGggLSBjdXJfc3BhY2U7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBzaWJsaW5nIGVtZXJnZXMgYXQgdGhlIHByZXZpb3VzIHRpbWUgcG9pbnQsIHVwZGF0ZSBpdHMgZW1lcmdlbmNlIHktY29vcmRpbmF0ZQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNwX2RhdGFbcHJldl90cF0gJiYgbGF5b3V0W3ByZXZfdHBdW3NpYl0gJiYgbGF5b3V0W3ByZXZfdHBdW3NpYl0uc3RhdGUgPT0gImVtZXJnZXMiKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWlkcG9pbnQgPSAobGF5b3V0W3RwXVtzaWJdLnRvcCArIGxheW91dFt0cF1bc2liXS5ib3R0b20pLzI7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0W3ByZXZfdHBdW3NpYl0udG9wID0gbWlkcG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0W3ByZXZfdHBdW3NpYl0uYm90dG9tID0gbWlkcG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBjdXJyZW50IHNpYmxpbmcncyB3aWR0aCB0byB0aGUgc3RhY2sgaGVpZ2h0CgkgICAgICAgICAgICAgICAgICAgICAgICBzSGVpZ2h0IC09IChjdXJfd2lkdGggKyBjdXJfc3BhY2UpOwoJICAgICAgICAgICAgICAgICAgICAgICAgc2VlbkdUeXBlcy5wdXNoKHNpYik7CgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm90ZSB0aGUgYW1vdW50IG9mIHNwYWNlIHN1YnRyYWN0ZWQgZnJvbSBhbmNlc3RvcidzIGNlbGx1bGFyIHByZXZhbGVuY2UKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09IChzb3J0ZWRfcHJlc2VudF9zaWJzLmxlbmd0aC0xKSAmJiBsYXlvdXRbdHBdW2N1cl9hbmNlc3Rvcl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXRbdHBdW2N1cl9hbmNlc3Rvcl0uc3BhY2UgPSAoaSsxKSpjdXJfc3BhY2U7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pCgkgICAgfSkKCgkgICAgcmV0dXJuIGxheW91dDsKCX0KCgkvKiBmdW5jdGlvbiB0byBjcmVhdGUgYSBzdGFjayBlbGVtZW50IChhIGdlbm90eXBlIGludGVydmFsIGF0IGEgcGFydGljdWxhciB0aW1lIHBvaW50KQoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqIEBwYXJhbSB7T2JqZWN0fSBsYXlvdXQgLS0gbGF5b3V0IG9mIGVhY2ggZ2Vub3R5cGUgYXQgZWFjaCB0aW1lIHBvaW50CgkqIEBwYXJhbSB7U3RyaW5nfSB0cCAtLSB0aW1lIHBvaW50IG9mIGludGVyZXN0CgkqIEBwYXJhbSB7U3RyaW5nfSBndHlwZSAtLSBnZW5vdHlwZSBvZiBpbnRlcmVzdAoJKiBAcGFyYW0ge051bWJlcn0gYm90dG9tX3ZhbCAtLSB2YWx1ZSBmb3IgdGhlIGJvdHRvbSBvZiB0aGUgaW50ZXJ2YWwKCSogQHBhcmFtIHtOdW1iZXJ9IHRvcF92YWwgLS0gdmFsdWUgZm9yIHRoZSB0b3Agb2YgdGhlIGludGVydmFsCgkqIEBwYXJhbSB7TnVtYmVyfSBlZmZlY3RpdmVfY3AgLS0gdGhlIGNlbGx1bGFyIHByZXZhbGVuY2UgdmFsdWUgZm9yIHZpc3VhbCBwbG90dGluZyAKCSogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW5jcmVhc2VkIGlmIHNtYWxsLCBkZWNyZWFzZWQgaWYgb3RoZXJzIGFyZSBzbWFsbCkKCSogQHBhcmFtIHtTdHJpbmd9IHN0YXRlIC0tIHN0YXRlIG9mIHRoZSBnZW5vdHlwZSBhdCB0aGlzIHRpbWUgcG9pbnQgKGUuZy4gImVtZXJnZXMiLCAicHJlc2VudCIsICJkaXNhcHBlYXJzIikKCSovCglmdW5jdGlvbiBfY3JlYXRlU3RhY2tFbGVtZW50KGN1clZpek9iaiwgbGF5b3V0LCB0cCwgZ3R5cGUsIGJvdHRvbV92YWwsIHRvcF92YWwsIGVmZmVjdGl2ZV9jcCwgc3RhdGUpIHsKCSAgICAvLyBjcmVhdGUgdGhlIHRpbWUgcG9pbnQgaW4gdGhlIHN0YWNrIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeSBleGlzdAoJICAgIGxheW91dFt0cF0gPSBsYXlvdXRbdHBdIHx8IHt9OyAKCgkgICAgLy8gY3JlYXRlIHRoZSBnZW5vdHlwZSBpbiB0aGUgc3RhY2sKCSAgICBsYXlvdXRbdHBdW2d0eXBlXSA9IHsKCSAgICAgICAgImJvdHRvbSI6IGJvdHRvbV92YWwsCgkgICAgICAgICJ0b3AiOiB0b3BfdmFsLAoJICAgICAgICAic3RhdGUiOiBzdGF0ZSwKCSAgICAgICAgImNwIjogY3VyVml6T2JqLmRhdGEuY3BfZGF0YVt0cF1bZ3R5cGVdLAoJICAgICAgICAiZWZmZWN0aXZlX2NwIjogZWZmZWN0aXZlX2NwCgkgICAgfTsKCX0KCgkvKiBmdW5jdGlvbiB0byBjYWxjdWxhdGUgZWZmZWN0aXZlIGNlbGx1bGFyIHByZXZhbGVuY2UgYW5kIHdpZHRoIG9mIGVhY2ggZ2Vub3R5cGUgaW4gdGhlIHRpbWVzY2FwZQoJKgoJKiBub3RlOiAtIGVmZmVjdGl2ZSBjZWxsdWxhciBwcmV2YWxlbmNlIC0tIHdpbGwgY29ycmVzcG9uZCB0byB0aGUgaW50ZXJ2YWwgd2lkdGggaW4gdGhlIHN0YWNrZWQgbGF5b3V0CgkqICAgICAgIC0gImVmZmVjdGl2ZSIgYmVjYXVzZTogCgkqICAgICAgICAgICAgICAgICAgICAgICAgIC0gaXQgaXMgaW5jcmVhc2VkIGlmIGl0J3MgYmVsb3cgdGhlIHRocmVzaG9sZAoJKiAgICAgICAgICAgICAgICAgICAgICAgICAtIGl0IGlzIHJlZHVjZWQgaWYgc2libGluZ3MgYXJlIGJlbG93IHRocmVzaG9sZCBhbmQgdGhlcmVmb3JlIGluY3JlYXNlZAoJKiAgICAgICAtIHdpZHRoIC0tIHRoZSBlZmZlY3RpdmUgY2VsbHVsYXIgcHJldmFsZW5jZSBQTFVTIHRoZSBlZmZlY3RpdmUgY2VsbHVsYXIgcHJldmFsZW5jZSBmb3IgaXRzIGRlc2NlbmRhbnRzCgkqCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKCSogQHBhcmFtIHtTdHJpbmd9IHRwIC0tIHRpbWUgcG9pbnQgb2YgaW50ZXJlc3QKCSogQHBhcmFtIHtTdHJpbmd9IGd0eXBlIC0tIGdlbm90eXBlIG9mIGludGVyZXN0CgkqIEBwYXJhbSB7TnVtYmVyfSB0aHJlc2hvbGQgLS0gdGhyZXNob2xkIGNlbGx1bGFyIHByZXZhbGVuY2UgZm9yIHZpc3VhbCBkZXRlY3Rpb24KCSovCglmdW5jdGlvbiBfY2FsY3VsYXRlV2lkdGgoY3VyVml6T2JqLCB0cCwgZ3R5cGUsIHRocmVzaG9sZCkgewoJICAgIHZhciB3aWR0aCwgLy8gd2lkdGggb2YgdGhpcyBnZW5vdHlwZSAoaW5jbHVkaW5nIGFsbCBkZXNjZW5kYW50cykKCSAgICAgICAgZWZmZWN0aXZlX2NwLCAvLyBlZmZlY3RpdmUgY2VsbHVsYXIgcHJldmFsZW5jZSBmb3IgdGhpcyBnZW5vdHlwZQoJICAgICAgICBjcCA9IGN1clZpek9iai5kYXRhLmNwX2RhdGFbdHBdLCAvLyBjZWxsdWxhciBwcmV2YWxlbmNlIGZvciB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgZ1R5cGVzX2N1clRQID0gT2JqZWN0LmtleXMoY3ApLCAvLyBnZW5vdHlwZXMgZXhpc3RpbmcgYXQgdGhlIGN1cnJlbnQgdGltZSBwb2ludAoJICAgICAgICBjdXJfZGlyZWN0X2Rlc2NlbmRhbnRzID0gY3VyVml6T2JqLmRhdGEuZGlyZWN0X2Rlc2NlbmRhbnRzW2d0eXBlXSwgLy8gY3VycmVudCBkaXJlY3QgZGVzY2VuZGFudHMgb2YgZ2Vub3R5cGUKCSAgICAgICAgc3VtX2luY3JlbWVudCA9IDAsIC8vIHN1bSBvZiBpbmNyZW1lbnQgdG8gbG93IHByZXZhbGVuY2UgZ2Vub3R5cGVzIGZvciB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgbl9ndHlwZXNfaGlnaF9jcCA9IDA7IC8vIG51bWJlciBvZiBnZW5vdHlwZXMgYWJvdmUgdGhyZXNob2xkIGNwCgoJICAgIC8vIGZpbmQgb3V0IGhvdyBtYW55IGdlbm90eXBlcyBhcmUgYmVsb3cgdGhyZXNob2xkIGF0IHRoaXMgdGltZSBwb2ludAoJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ1R5cGVzX2N1clRQLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgIGlmIChjcFtnVHlwZXNfY3VyVFBbaV1dIDwgdGhyZXNob2xkKSB7CgkgICAgICAgICAgICBzdW1faW5jcmVtZW50ICs9ICh0aHJlc2hvbGQgLSBjcFtnVHlwZXNfY3VyVFBbaV1dKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIG5fZ3R5cGVzX2hpZ2hfY3ArKzsKCSAgICAgICAgfSAgICAgICAgICAgICAgICAKCSAgICB9CgoJICAgIC8vIC0tPiBHRU5PVFlQRSBET0VTTidUIEVYSVNUIGF0IHRoaXMgdGltZSBwb2ludAoJICAgIGlmICghY3BbZ3R5cGVdKSB7CgkgICAgICAgIC8vIGVmZmVjdGl2ZSBjZWxsdWxhciBwcmV2YWxlbmNlIGlzIDAKCSAgICAgICAgZWZmZWN0aXZlX2NwID0gMDsKCSAgICB9CgoKCSAgICAvLyAtLT4gTE9XIFBSRVZBTEVOQ0UgLS0gaWYgdGhpcyBnZW5vdHlwZSBleGlzdHMgYXQgbG93IHByZXZhbGVuY2UKCSAgICBlbHNlIGlmIChjcFtndHlwZV0gPCB0aHJlc2hvbGQpIHsKCSAgICAgICAgLy8gZWZmZWN0aXZlIGNlbGx1bGFyIHByZXZhbGVuY2UgaXMgdGhlIHRocmVzaG9sZCB2YWx1ZQoJICAgICAgICBlZmZlY3RpdmVfY3AgPSB0aHJlc2hvbGQ7CgkgICAgfQoKCSAgICAvLyAtLT4gTk9STUFMIFBSRVZBTEVOQ0UKCSAgICBlbHNlIHsKCSAgICAgICAgLy8gZm9yIGVhY2ggcHJlc2VudCBzaWJsaW5nIHdpdGggQ1AgYmVsb3cgdGhyZXNob2xkLCBzdWJ0cmFjdCB0aGUgc2libGluZydzIHdpZHRoIChpbmNsdWRpbmcgZGVzY2VuZGFudHMpIAoJICAgICAgICAvLyBmcm9tIHRoZSBjdXJyZW50IGdlbm90eXBlLCBiZWNhdXNlIHRoZSBzaWJsaW5nJ3Mgc3dlZXAgaW50ZXJ2YWwgd2lsbCBiZSBpbmNyZWFzZWQKCSAgICAgICAgZWZmZWN0aXZlX2NwID0gY3BbZ3R5cGVdOwoJICAgICAgICAvLyBzdWJ0cmFjdCB0aGUgdG90YWwgaW5jcmVtZW50IGZvciBsb3cgcHJldiBDUHMsIGRpdmlkZWQgYnkgdGhlIG51bWJlciBvZiBoaWdoIENQIGdlbm90eXBlcwoJICAgICAgICBlZmZlY3RpdmVfY3AgLT0gKHN1bV9pbmNyZW1lbnQpIC8gKG5fZ3R5cGVzX2hpZ2hfY3ApOyAKCSAgICB9CgkgICAgCgkgICAgLy8gZm9yIGVhY2ggZGlyZWN0IGRlc2NlbmRhbnQsIGFkZCBpdHMgY2VsbHVsYXIgcHJldmFsZW5jZSAKCSAgICB3aWR0aCA9IGVmZmVjdGl2ZV9jcDsKCSAgICAkLmVhY2goY3VyX2RpcmVjdF9kZXNjZW5kYW50cywgZnVuY3Rpb24oZGVzY19pZHgsIGRlc2MpIHsKCSAgICAgICAgd2lkdGggKz0gX2NhbGN1bGF0ZVdpZHRoKGN1clZpek9iaiwgdHAsIGRlc2MsIHRocmVzaG9sZCkud2lkdGg7CgkgICAgfSkKCSAgICByZXR1cm4geyJ3aWR0aCI6IHdpZHRoLCAiZWZmZWN0aXZlX2NwIjogZWZmZWN0aXZlX2NwfTsKCgl9CgoJLyogZnVuY3Rpb24gdG8gc29ydCBnZW5vdHlwZXMgYnkgbGF5b3V0IG9yZGVyIChib3R0b20gdG8gdG9wKQoJKiBAcGFyYW0ge0FycmF5fSBsYXlvdXRPcmRlciAtLSB2ZXJ0aWNhbCBvcmRlciBvZiBnZW5vdHlwZXMgZm9yIGxheW91dCBwdXJwb3NlcwoJKi8KCWZ1bmN0aW9uIF9zb3J0QnlMYXlvdXRPcmRlcihsYXlvdXRPcmRlcikgewoJICAgIHJldHVybiBmdW5jdGlvbiBfc29ydGluZ0Z1bmMoYSwgYikgewoJICAgICAgICB2YXIgc29ydGluZ0FyciA9IGxheW91dE9yZGVyOwoJICAgICAgICBpZiAodHlwZW9mIGEgPT09ICdvYmplY3QnKSB7CgkgICAgICAgICAgICBpZiAoc29ydGluZ0Fyci5pbmRleE9mKGEuaWQpID4gc29ydGluZ0Fyci5pbmRleE9mKGIuaWQpKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gLTE7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBpZiAoc29ydGluZ0Fyci5pbmRleE9mKGEpID4gc29ydGluZ0Fyci5pbmRleE9mKGIpKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gLTE7CgkgICAgICAgIH0KCSAgICB9Cgl9CgoKCS8qIGZ1bmN0aW9uIHRvIHNoaWZ0IHRoZSBlbWVyZ2VuY2UgaW4gdGhlIHgtZGlyZWN0aW9uIGlmIG11bHRpcGxlIGdlbm90eXBlcyBmcm9tIHRoZSBzYW1lIGxpbmVhZ2UgZW1lcmdlIAoJKiBhdCB0aGUgc2FtZSB0aW1lcG9pbnQKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9zaGlmdEVtZXJnZW5jZShjdXJWaXpPYmopIHsKCSAgICB2YXIgZGltID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcsCgkgICAgICAgIGxheW91dCA9IGN1clZpek9iai5kYXRhLmxheW91dCwKCSAgICAgICAgbGF5b3V0T3JkZXIgPSBjdXJWaXpPYmouZGF0YS5sYXlvdXRPcmRlciwKCSAgICAgICAgdGltZXBvaW50cyA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMsCgkgICAgICAgIHRyZWVBbmNlc3RvcnNBcnIgPSBjdXJWaXpPYmouZGF0YS50cmVlQW5jZXN0b3JzQXJyLAoJICAgICAgICB0cmVlRGVzY2VuZGFudHNBcnIgPSBjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnIsCgkgICAgICAgIG5QYXJ0aXRpb25zLAoJICAgICAgICBsYXlvdXRPcmRlcl9yZXYsCgkgICAgICAgIGFuY2VzdG9ycywKCSAgICAgICAgYW5jZXN0b3JzX29mX2FuY2VzdG9yLAoJICAgICAgICBjdXJOUGFydGl0aW9ucywKCSAgICAgICAgZ2Vub3R5cGVzX3hzaGlmdGVkOwoKCSAgICAkLmVhY2godGltZXBvaW50cywgZnVuY3Rpb24odHBfaWR4LCB0cCkgeyAKCgkgICAgICAgIC8vIC0tPiBnZXQgdGhlIG51bWJlciBvZiBwYXJ0aXRpb25zIGZvciB0aGlzIHRpbWUgcG9pbnQgPC0tIC8vCgoJICAgICAgICAvLyBmb3IgZWFjaCBnZW5vdHlwZSAoYmFja3dhcmRzIGluIHN0YWNraW5nIG9yZGVyIC0tIGRlc2NlbmRhbnQgYmVmb3JlIGFuY2VzdHJhbCkKCSAgICAgICAgblBhcnRpdGlvbnMgPSAtMTsKCSAgICAgICAgbGF5b3V0T3JkZXJfcmV2ID0gKCQuZXh0ZW5kKFtdLCBsYXlvdXRPcmRlcikpLnJldmVyc2UoKTsKCSAgICAgICAgJC5lYWNoKGxheW91dE9yZGVyX3JldiwgZnVuY3Rpb24oZ3R5cGVfaWR4LCBndHlwZSkgewoKCSAgICAgICAgICAgIC8vIGlmIHRoZSBnZW5vdHlwZSBpcyBlbWVyZ2luZyBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgIGlmIChsYXlvdXRbdHBdW2d0eXBlXSAmJiAobGF5b3V0W3RwXVtndHlwZV0uc3RhdGUgPT0gImVtZXJnZXMiKSkgewoJICAgICAgICAgICAgICAgIAoJICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgYW5jZXN0b3JzIHRoYXQgYWxzbyBlbWVyZ2UgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgYW5jZXN0b3JzID0gX2ZpbmRFbWVyZ2VudEFuY2VzdG9ycyhsYXlvdXQsIHRyZWVBbmNlc3RvcnNBcnIsIGd0eXBlLCB0cCk7CgkgICAgICAgICAgICAgICAgY3VyTlBhcnRpdGlvbnMgPSBhbmNlc3RvcnMubGVuZ3RoKzI7CgoJICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGxhcmdlc3QgbnVtYmVyIG9mIGFuY2VzdG9ycyBzbyBmYXIsIHVwZGF0ZSB0aGUgbnVtYmVyIG9mIHBhcnRpdGlvbnMKCSAgICAgICAgICAgICAgICBpZiAoY3VyTlBhcnRpdGlvbnMgPiBuUGFydGl0aW9ucykgewoJICAgICAgICAgICAgICAgICAgICBuUGFydGl0aW9ucyA9IGN1ck5QYXJ0aXRpb25zOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICB9CgoJICAgICAgICB9KQoKCSAgICAgICAgLy8gLS0+IHgtc2hpZnQgZ2Vub3R5cGVzIDwtLSAvLwoKCSAgICAgICAgLy8ga2VlcCB0cmFjayBvZiB3aGljaCBnZW5vdHlwZXMgaGF2ZSBiZWVuIHgtc2hpZnRlZAoJICAgICAgICBnZW5vdHlwZXNfeHNoaWZ0ZWQgPSBbXTsKCgkgICAgICAgIC8vIGZvciBlYWNoIGdlbm90eXBlIChiYWNrd2FyZHMgaW4gc3RhY2tpbmcgb3JkZXIgLS0gZGVzY2VuZGFudCBiZWZvcmUgYW5jZXN0cmFsKQoJICAgICAgICAkLmVhY2gobGF5b3V0T3JkZXJfcmV2LCBmdW5jdGlvbihndHlwZV9pZHgsIGd0eXBlKSB7CgoJICAgICAgICAgICAgLy8gc2V0IHRoZSBudW1iZXIgb2YgcGFydGl0aW9ucwoJICAgICAgICAgICAgaWYgKGxheW91dFt0cF1bZ3R5cGVdKSB7CgkgICAgICAgICAgICAgICAgbGF5b3V0W3RwXVtndHlwZV0ublBhcnRpdGlvbnMgPSBuUGFydGl0aW9uczsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIAoJICAgICAgICAgICAgLy8gaWYgdGhpcyBnZW5vdHlwZSBoYXMgbm90IGFscmVhZHkgYmVlbiB4LXNoaWZ0ZWQgYW5kIGlzIFJFUExBQ0VEIGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgaWYgKChnZW5vdHlwZXNfeHNoaWZ0ZWQuaW5kZXhPZihndHlwZSkgPT0gLTEpICYmIGxheW91dFt0cF1bZ3R5cGVdICYmIAoJICAgICAgICAgICAgICAgIChbInJlcGxhY2VkIiwgImRpc2FwcGVhcnNfc3RyZXRjaGVkIl0uaW5kZXhPZihsYXlvdXRbdHBdW2d0eXBlXS5zdGF0ZSkgIT0gLTEpKSB7CgkgICAgICAgICAgICAJbGF5b3V0W3RwXVtndHlwZV0ueFNoaWZ0ID0gLTAuNTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBpZiB0aGlzIGdlbm90eXBlIGhhcyBub3QgYWxyZWFkeSBiZWVuIHgtc2hpZnRlZCBhbmQgZW1lcmdlcyBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgIGlmICgoZ2Vub3R5cGVzX3hzaGlmdGVkLmluZGV4T2YoZ3R5cGUpID09IC0xKSAmJiBsYXlvdXRbdHBdW2d0eXBlXSAmJiAKCSAgICAgICAgICAgICAgICAobGF5b3V0W3RwXVtndHlwZV0uc3RhdGUgPT0gImVtZXJnZXMiKSkgewoKCSAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIGFuY2VzdG9ycyB0aGF0IGFsc28gZW1lcmdlIGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgIGFuY2VzdG9ycyA9IF9maW5kRW1lcmdlbnRBbmNlc3RvcnMobGF5b3V0LCB0cmVlQW5jZXN0b3JzQXJyLCBndHlwZSwgdHApOwoKCSAgICAgICAgICAgICAgICAvLyB4LXNoaWZ0IGFuZCB4LXBhcnRpdGlvbiBmb3IgdGhlIGN1cnJlbnQgZ2Vub3R5cGUgKGRlcGVuZHMgb24gaG93IG1hbnkgb2YgaXRzIGFuY2VzdG9ycyBlbWVyZ2UpCgkgICAgICAgICAgICAgICAgbGF5b3V0W3RwXVtndHlwZV0ueFNoaWZ0ID0gKGFuY2VzdG9ycy5sZW5ndGgrMSkgLyBuUGFydGl0aW9uczsKCSAgICAgICAgICAgICAgICAKCSAgICAgICAgICAgICAgICBnZW5vdHlwZXNfeHNoaWZ0ZWQucHVzaChndHlwZSk7CgoJICAgICAgICAgICAgICAgIC8vIGZvciBlYWNoIGFuY2VzdG9yIHRoYXQgYWxzbyBlbWVyZ2VkIGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYW5jZXN0b3JzLmxlbmd0aDsgaSsrKSB7CgoJICAgICAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBhbmNlc3RvcidzIGFuY2VzdG9ycyB0aGF0IGFsc28gZW1lcmdlIGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgICAgICBhbmNlc3RvcnNfb2ZfYW5jZXN0b3IgPSBfZmluZEVtZXJnZW50QW5jZXN0b3JzKGxheW91dCwgdHJlZUFuY2VzdG9yc0FyciwgYW5jZXN0b3JzW2ldLCB0cCk7CgkgICAgICAgICAgICAgICAgICAgIAoJICAgICAgICAgICAgICAgICAgICAvLyB4LXNoaWZ0IGFuZCB4LXBhcnRpdGlvbiBmb3IgdGhlIGN1cnJlbnQgYW5jZXN0b3IgKGRlcGVuZHMgb24gaG93IG1hbnkgb2YgaXRzIGFuY2VzdG9ycyBlbWVyZ2UpCgkgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bYW5jZXN0b3JzW2ldXS54U2hpZnQgPSAoYW5jZXN0b3JzX29mX2FuY2VzdG9yLmxlbmd0aCsxKSAvIG5QYXJ0aXRpb25zOwoKCSAgICAgICAgICAgICAgICAgICAgZ2Vub3R5cGVzX3hzaGlmdGVkLnB1c2goYW5jZXN0b3JzW2ldKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pCgkgICAgfSkKCX0KCgkvLyBMQUJFTFMgRlVOQ1RJT05TCgoJLyogZnVuY3Rpb24gdG8gZ2V0IGNlbGx1bGFyIHByZXZhbGVuY2UgbGFiZWxzIGZvciBlYWNoIGdlbm90eXBlIGF0IGVhY2ggdGltZSBwb2ludCwgZm9yIHRyYWRpdGlvbmFsIHRpbWVzY2FwZSB2aWV3CgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKCSovCglmdW5jdGlvbiBfZ2V0VHJhZGl0aW9uYWxDUExhYmVscyhjdXJWaXpPYmopIHsKCSAgICB2YXIgZGltID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcsCgkgICAgICAgIGxheW91dCA9IGN1clZpek9iai5kYXRhLmxheW91dCwKCSAgICAgICAgbGFiZWxzID0gW10sIC8vIGFycmF5IG9mIGxhYmVscwoJICAgICAgICBkYXRhLCAvLyBkYXRhIGZvciBhIGdlbm90eXBlIGF0IGEgdGltZSBwb2ludAoJICAgICAgICBsYWJlbCwgLy8gY3VycmVudCBsYWJlbCB0byBhZGQKCSAgICAgICAgY3VyRGVzY2VuZGFudHMsCgkgICAgICAgIGNwX2RhdGFfb3JpZ2luYWwgPSBjdXJWaXpPYmouZGF0YS5jcF9kYXRhX29yaWdpbmFsLAoJICAgICAgICBnVHlwZXNfY3VyVFA7IAoKCSAgICAvLyBmb3IgZWFjaCB0aW1lIHBvaW50CgkgICAgT2JqZWN0LmtleXMobGF5b3V0KS5mb3JFYWNoKGZ1bmN0aW9uKHRwLCB0cF9pZHgpIHsKCSAgICAgICAgaWYgKHRwICE9ICJUMCIpIHsKCgkgICAgICAgICAgICAvLyBmb3IgZWFjaCBnZW5vdHlwZQoJICAgICAgICAgICAgT2JqZWN0LmtleXMobGF5b3V0W3RwXSkuZm9yRWFjaChmdW5jdGlvbihndHlwZSwgZ3R5cGVfaWR4KSB7CgkgICAgICAgICAgICAgICAgY3VyRGVzY2VuZGFudHMgPSBjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnJbZ3R5cGVdOwoJICAgICAgICAgICAgICAgIGdUeXBlc19jdXJUUCA9IE9iamVjdC5rZXlzKGN1clZpek9iai5kYXRhLmNwX2RhdGFbdHBdKTsgCgoJICAgICAgICAgICAgICAgIC8vIGRhdGEgZm9yIHRoaXMgZ2Vub3R5cGUgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgZGF0YSA9IGxheW91dFt0cF1bZ3R5cGVdOwoKCSAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZ2Vub3R5cGUgZXhpc3RzIGF0IHRoaXMgdGltZSBwb2ludCAoaXNuJ3QgZW1lcmdpbmcgb3IgZGlzYXBwZWFyaW5nIC8gcmVwbGFjZWQpCgkgICAgICAgICAgICAgICAgaWYgKChkYXRhLnN0YXRlID09ICJwcmVzZW50IikpIHsKCgkgICAgICAgICAgICAgICAgICAgIHZhciBuRGVzYyA9IF9nZXRJbnRlcnNlY3Rpb24oY3VyRGVzY2VuZGFudHMsIGdUeXBlc19jdXJUUCkubGVuZ3RoOwoKCSAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGl0cyBpbmZvcm1hdGlvbiAKCSAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSB7fTsKCgkgICAgICAgICAgICAgICAgICAgIC8vIENFTlRSRUQgdmlldwoJICAgICAgICAgICAgICAgICAgICBpZiAoY3VyVml6T2JqLnVzZXJDb25maWcuZ2Vub3R5cGVfcG9zaXRpb24gPT0gImNlbnRyZSIpIHsgCgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC50cCA9IHRwOwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwuZ3R5cGUgPSBndHlwZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLmNwID0gY3BfZGF0YV9vcmlnaW5hbFt0cF1bZ3R5cGVdOwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwubWlkZGxlID0gZGF0YS50b3AgLSAoZGF0YS5jcC8oMiooZGF0YS5wcmVzZW50Q2hpbGRyZW4rMSkpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLnR5cGUgPSAidHJhZGl0aW9uYWwiOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIFNUQUNLRUQgdmlldwoJICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5nZW5vdHlwZV9wb3NpdGlvbiA9PSAic3RhY2siKSB7IAoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwudHAgPSB0cDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLmd0eXBlID0gZ3R5cGU7CgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5jcCA9IGNwX2RhdGFfb3JpZ2luYWxbdHBdW2d0eXBlXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLm1pZGRsZSA9ICgyKmRhdGEuYm90dG9tICsgZGF0YS5lZmZlY3RpdmVfY3ApLzI7IAoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwudHlwZSA9ICJ0cmFkaXRpb25hbCI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gU1BBQ0VEIHZpZXcKCSAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VyVml6T2JqLnVzZXJDb25maWcuZ2Vub3R5cGVfcG9zaXRpb24gPT0gInNwYWNlIikgeyAKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLnRwID0gdHA7CgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5ndHlwZSA9IGd0eXBlOwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwuY3AgPSBjcF9kYXRhX29yaWdpbmFsW3RwXVtndHlwZV07CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGdlbm90eXBlIHdhcyBzcGxpdCBmb3Igc3BhY2luZywgaG93IG11Y2ggQ1AgaGFzIGJlZW4gdGFrZW4gdXAgYnkgdGhlIHVwcGVyIHNwbGl0cwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwubWlkZGxlID0gKGRhdGEuc3BhY2UpID8gCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDIqZGF0YS5ib3R0b20gKyBkYXRhLmVmZmVjdGl2ZV9jcCAtIGRhdGEuc3BhY2UpLzIgOiAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAoMipkYXRhLmJvdHRvbSArIGRhdGEuZWZmZWN0aXZlX2NwKS8yOwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwudHlwZSA9ICJ0cmFkaXRpb25hbCI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgCgkgICAgICAgICAgICAgICAgICAgIGxhYmVscy5wdXNoKGxhYmVsKTsKCgkgICAgICAgICAgICAgICAgfSAgIAoJICAgICAgICAgICAgICAgIAoJICAgICAgICAgICAgfSkKCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICByZXR1cm4gbGFiZWxzOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGdldCBjZWxsdWxhciBwcmV2YWxlbmNlIGxhYmxlcyBmb3IgZWFjaCBnZW5vdHlwZSBhdCBlYWNoIHRpbWUgcG9pbnQsIGZvciB0cmFja3MgdGltZXNjYXBlIHZpZXcKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9nZXRTZXBhcmF0ZUNQTGFiZWxzKGN1clZpek9iaikgewoJICAgIHZhciB0cmFja3NfcGF0aHMgPSBjdXJWaXpPYmouZGF0YS50cmFja3NfcGF0aHMsCgkgICAgICAgIGNwX2RhdGFfb3JpZ2luYWwgPSBjdXJWaXpPYmouZGF0YS5jcF9kYXRhX29yaWdpbmFsLAoJICAgICAgICBsYWJlbHMgPSBbXSwKCSAgICAgICAgbGFiZWwsCgkgICAgICAgIGd0eXBlLAoJICAgICAgICBtaWRwb2ludCwKCSAgICAgICAgcGF0aCwKCSAgICAgICAgdHA7IC8vIHRpbWUgcG9pbnQKCgkgICAgLy8gZm9yIGVhY2ggZ2Vub3R5cGUKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyYWNrc19wYXRocy5sZW5ndGg7IGkrKykgewoJICAgICAgICBndHlwZSA9IHRyYWNrc19wYXRoc1tpXS5ndHlwZTsKCSAgICAgICAgbWlkcG9pbnQgPSB0cmFja3NfcGF0aHNbaV0ubWlkcG9pbnQ7CgkgICAgICAgIHBhdGggPSB0cmFja3NfcGF0aHNbaV0ucGF0aDsKCgkgICAgICAgIC8vIGZvciBlYWNoIHBvaW50IGluIHRoZSBwYXRoCgkgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGF0aC5sZW5ndGg7IGorKykgewoJICAgICAgICAgICAgdHAgPSBwYXRoW2pdLnRwOwoKCSAgICAgICAgICAgIGlmICh0cCAhPSAiVDAiKSB7CgoJICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBnZW5vdHlwZSBleGlzdHMgYXQgdGhpcyB0aW1lIHBvaW50IChpc24ndCBlbWVyZ2luZyBvciBkaXNhcHBlYXJpbmcgLyByZXBsYWNlZCkKCSAgICAgICAgICAgICAgICBpZiAoY3BfZGF0YV9vcmlnaW5hbFt0cF1bZ3R5cGVdKSB7CgkgICAgICAgICAgICAgICAgICAgIGxhYmVsID0ge307CgkgICAgICAgICAgICAgICAgICAgIGxhYmVsLnRwID0gdHA7CgkgICAgICAgICAgICAgICAgICAgIGxhYmVsLmNwID0gY3BfZGF0YV9vcmlnaW5hbFt0cF1bZ3R5cGVdOwoJICAgICAgICAgICAgICAgICAgICBsYWJlbC5taWRkbGUgPSBtaWRwb2ludDsKCSAgICAgICAgICAgICAgICAgICAgbGFiZWwuZ3R5cGUgPSBndHlwZTsKCSAgICAgICAgICAgICAgICAgICAgbGFiZWwudHlwZSA9ICJ0cmFja3MiOwoJICAgICAgICAgICAgICAgICAgICBsYWJlbHMucHVzaChsYWJlbCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfQoKCSAgICByZXR1cm4gbGFiZWxzOwoJfQoKCS8vIFBBVEggRlVOQ1RJT05TCgoJLyogZnVuY3Rpb24gdG8gZ2V0IHBhdGhzIHRvIHBsb3QuIAoJKiBGaXJzdCBnZXRzIHBhdGhzIChzY2FsZSAwIHRvIDEpIHdpdGggc3RyYWlnaHQgZWRnZXMuCgkqIFRoZW4gZ2V0cyBwYXRocyAoc2NhbGUgb2YgdGhlIHBsb3QgcGl4ZWwgY291bnQpIHdpdGggYmV6aWVyIGVkZ2VzCgkqLwoJZnVuY3Rpb24gX2dldFBhdGhzKGN1clZpek9iaikgewoJICAgIHZhciBkaW0gPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZzsKCgkgICAgLy8gR0VUIFBST1BPUlRJT05BVEUsIFNUUkFJR0hUIEVER0VEIFBBVEhTCgoJICAgIC8vIGNvbnZlcnQgbGF5b3V0IGF0IGVhY2ggdGltZSBwb2ludCBpbnRvIGEgbGlzdCBvZiBtb3ZlcyBmb3IgZWFjaCBnZW5vdHlwZSdzIGQzIHBhdGggb2JqZWN0CgkgICAgY3VyVml6T2JqLmRhdGEudHJhY2tzX3BhdGhzID0gX2dldFNlcGFyYXRlUGF0aHMoY3VyVml6T2JqKTsKCSAgICBjdXJWaXpPYmouZGF0YS50cmFkaXRpb25hbF9wYXRocyA9IF9nZXRUcmFkaXRpb25hbFBhdGhzKGN1clZpek9iaik7CgoJICAgIC8vIEdFVCBCRVpJRVIgUEFUSFMgUkVBRFkgRk9SIFBMT1RUSU5HCgoJICAgIC8vIGNvbnZlcnQgcHJvcG9ydGlvbmF0ZSBwYXRocyBpbnRvIHBhdGhzIHJlYWR5IGZvciBwbG90dGluZywgd2l0aCBiZXppZXIgY3VydmVzCgkgICAgY3VyVml6T2JqLmRhdGEuYmV6aWVyX3BhdGhzID0gX2dldEJlemllclBhdGhzKGN1clZpek9iai5kYXRhLnRyYWRpdGlvbmFsX3BhdGhzLCBkaW0udHNTVkdXaWR0aCwgZGltLnRzU1ZHSGVpZ2h0KTsKCSAgICBjdXJWaXpPYmouZGF0YS50cmFja3NfYmV6aWVyX3BhdGhzID0gX2dldEJlemllclBhdGhzKGN1clZpek9iai5kYXRhLnRyYWNrc19wYXRocywgZGltLnRzU1ZHV2lkdGgsIGRpbS50c1NWR0hlaWdodCk7CgoJfQoKCS8qIGZ1bmN0aW9uIHRvIGNvbG91ciBwYXRocwoJKi8KCWZ1bmN0aW9uIF9jb2xvdXJQYXRocyhjdXJWaXpPYmopIHsKCQl2YXIgcGhhbnRvbVJvb3QgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5waGFudG9tUm9vdCwKCQkJY29sb3VyX2Fzc2lnbm1lbnQgPSBjdXJWaXpPYmoudmlldy5jb2xvdXJfYXNzaWdubWVudCwKCQkJYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQgPSBjdXJWaXpPYmoudmlldy5hbHBoYV9jb2xvdXJfYXNzaWdubWVudDsKCgkJY3VyVml6T2JqLmRhdGEuYmV6aWVyX3BhdGhzLmZvckVhY2goZnVuY3Rpb24oY3VyX3BhdGgpIHsKCQkgICAgY3VyX3BhdGguZmlsbCA9IChjdXJfcGF0aC5ndHlwZSA9PSBwaGFudG9tUm9vdCkgPyAibm9uZSIgOiBhbHBoYV9jb2xvdXJfYXNzaWdubWVudFtjdXJfcGF0aC5ndHlwZV07CgkgICAgICAgIGN1cl9wYXRoLnN0cm9rZSA9IChjdXJfcGF0aC5ndHlwZSA9PSBwaGFudG9tUm9vdCkgPyAibm9uZSIgOiBjb2xvdXJfYXNzaWdubWVudFtjdXJfcGF0aC5ndHlwZV07CgkJfSkKCQljdXJWaXpPYmouZGF0YS50cmFja3NfYmV6aWVyX3BhdGhzLmZvckVhY2goZnVuY3Rpb24oY3VyX3BhdGgpIHsKCQkgICAgY3VyX3BhdGguZmlsbCA9IChjdXJfcGF0aC5ndHlwZSA9PSBwaGFudG9tUm9vdCkgPyAibm9uZSIgOiBhbHBoYV9jb2xvdXJfYXNzaWdubWVudFtjdXJfcGF0aC5ndHlwZV07CgkgICAgICAgIGN1cl9wYXRoLnN0cm9rZSA9IChjdXJfcGF0aC5ndHlwZSA9PSBwaGFudG9tUm9vdCkgPyAibm9uZSIgOiBjb2xvdXJfYXNzaWdubWVudFtjdXJfcGF0aC5ndHlwZV07CgkJfSkKCX0KCgkvKiBmdW5jdGlvbiB0byBjb252ZXJ0IGdlbm90eXBlIHN0YWNrcyBhdCBlYWNoIHRpbWUgcG9pbnQgaW50byBhIGxpc3Qgb2YgbW92ZXMgZm9yIGVhY2ggZ2Vub3R5cGUncyBkMyBwYXRoIG9iamVjdCAKCSogKHRyYWRpdGlvbmFsIHRpbWVzY2FwZSB2aWV3KQoJKiBOb3RlOiB0aGUgYXBwZWFyYW5jZSB0aW1lcG9pbnQgaXMgdGhlIHRpbWUgYXQgd2hpY2ggdGhlIGdlbm90eXBlIGFwcGVhcnMgaW4gdGhlIGRhdGFzZXQKCSogICAgICAgdGhlIGVtZXJnZW5jZSB0aW1lcG9pbnQgaXMgdGhlIHRpbWUgYXQgd2hpY2ggdGhlIGdlbm90eXBlIG11c3QgaGF2ZSBlbWVyZ2VkIChhcHBlYXJhbmNlIHRpbWVwb2ludCAtIDEpCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKCSovCglmdW5jdGlvbiBfZ2V0VHJhZGl0aW9uYWxQYXRocyhjdXJWaXpPYmopIHsKCSAgICB2YXIgZGltID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcsCgkgICAgICAgIGxheW91dCA9IGN1clZpek9iai5kYXRhLmxheW91dCwKCSAgICAgICAgdGltZXBvaW50cyA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMsCgkgICAgICAgIHRpbWVwb2ludHNfcmV2ID0gKCQuZXh0ZW5kKFtdLCB0aW1lcG9pbnRzKSkucmV2ZXJzZSgpLAoJICAgICAgICBtaWRfdHAgPSAoMS8oKHRpbWVwb2ludHMubGVuZ3RoLTEpKjIpKSwgLy8gaGFsZiBvZiB4LWRpc3RhbmNlIGJldHdlZW4gdGltZSBwb2ludHMKCSAgICAgICAgbGF5b3V0T3JkZXIgPSBjdXJWaXpPYmouZGF0YS5sYXlvdXRPcmRlciwKCSAgICAgICAgcGF0aHMgPSBbXSwKCSAgICAgICAgY3VyX3BhdGgsCgkgICAgICAgIGVtZXJnZXMsIC8vIHdoZXRoZXIgb3Igbm90IGEgZ2Vub3R5cGUgZW1lcmdlcyBhdCBhIHRpbWUgcG9pbnQKCSAgICAgICAgeFNoaWZ0X2luX2xheW91dCwgLy8gdGhlIGFtb3VudCBvZiBzaGlmdCBpbiB0aGUgeC1kaXJlY3Rpb24gZm9yIGEgZ2Vub3R5cGUgKHdoZW4gaXQncyBlbWVyZ2luZyksIAoJICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhcyBpcyBwcmVzZW50IGluIHRoZSBsYXlvdXQgZGF0YQoJICAgICAgICB4U2hpZnQsIC8vIHRoZSBhbW91bnQgb2Ygc2hpZnQgaW4gdGhlIHgtZGlyZWN0aW9uIGZvciBhIGdlbm90eXBlICh3aGVuIGl0J3MgZW1lcmdpbmcpLCAKCSAgICAgICAgICAgICAgICAvLyB0YWtpbmcgaW50byBhY2NvdW50IGV2ZW50cyB0aGF0IG9jY3VyCgkgICAgICAgIG5QYXJ0aXRpb25zLCAvLyBudW1iZXIgb2YgcGFydGl0aW9ucyBiZXR3ZWVuIHR3byB0aW1lIHBvaW50cyAKCSAgICAgICAgbmV4dF90cCwgCgkgICAgICAgIHhCb3R0b20sIC8vIHgtdmFsdWUgYXQgdGhlIGJvdHRvbSBvZiB0aGUgZ2Vub3R5cGUgc3dlZXAgYXQgYSB0aW1lIHBvaW50CgkgICAgICAgIHhUb3AsIC8vIHgtdmFsdWUgYXQgdGhlIHRvcCBvZiB0aGUgZ2Vub3R5cGUgc3dlZXAgYXQgYSB0aW1lIHBvaW50CgkgICAgICAgIHlfbWlkLCAvLyB5IHByb3BvcnRpb24gYXMgaGFsZndheSBiZXR3ZWVuIHRoaXMgYW5kIHRoZSBuZXh0IHRpbWUgcG9pbnQKCSAgICAgICAgYXBwZWFyX3hCb3R0b20sCgkgICAgICAgIGFwcGVhcl94VG9wLAoJICAgICAgICBldmVudF9vY2N1cnMsIC8vIHdoZXRoZXIgb3Igbm90IGFuIGV2ZW50IG9jY3VycyBhZnRlciBhIHRpbWUgcG9pbnQKCSAgICAgICAgZXZlbnRfaW5kZXgsIC8vIGluZGV4IG9mIHRoZSBjdXJyZW50IGV2ZW50IAoJICAgICAgICBwZXJ0dXJiYXRpb25zID0gY3VyVml6T2JqLnVzZXJDb25maWcucGVydHVyYmF0aW9ucywgLy8gdXNlciBzcGVjaWZpZWQgcGVydHVyYmF0aW9ucyBpbiB0aGUgdGltZS1zZXJpZXMgZGF0YQoJICAgICAgICBmcmFjOyAvLyBmcmFjdGlvbiBvZiB0b3RhbCB0dW1vdXIgY29udGVudCByZW1haW5pbmcgYXQgdGhlIHBlcnR1cmJhdGlvbiBldmVudDsKCgkgICAgJC5lYWNoKGxheW91dE9yZGVyLCBmdW5jdGlvbihndHlwZV9pZHgsIGd0eXBlKSB7CgkgICAgICAgIAoJICAgICAgICAvLyBwYXRoIGZvciB0aGUgY3VycmVudCBnZW5vdHlwZQoJICAgICAgICBjdXJfcGF0aCA9IHsiZ3R5cGUiOiBndHlwZSwgInBhdGgiOltdfTsKCSAgICAgICAgCgkgICAgICAgIC8vIGZvciBlYWNoIHRpbWUgcG9pbnQgKGluIHNlcXVlbmNlKS4uLgoJICAgICAgICAkLmVhY2godGltZXBvaW50cywgZnVuY3Rpb24oaWR4LCB0cCkgewoJICAgICAgICAgICAgCgkgICAgICAgICAgICAvLyB3aGV0aGVyIG9yIG5vdCBhbiBldmVudCBvY2N1cnMgYWZ0ZXIgdGhpcyB0aW1lcG9pbnQKCSAgICAgICAgICAgIGV2ZW50X29jY3VycyA9IChfZ2V0SW50ZXJzZWN0aW9uKF8ucGx1Y2socGVydHVyYmF0aW9ucywgInByZXZfdHAiKSwgdHApLmxlbmd0aCA+IDApOwoJICAgICAgICAgICAgZXZlbnRfaW5kZXggPSBfLnBsdWNrKHBlcnR1cmJhdGlvbnMsICJwcmV2X3RwIikuaW5kZXhPZih0cCk7CgoJICAgICAgICAgICAgLy8gaWYgdGhlIGdlbm90eXBlIGV4aXN0cyBvciBlbWVyZ2VzL2Rpc2FwcGVhcnMgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICBpZiAobGF5b3V0W3RwXVtndHlwZV0pIHsKCSAgICAgICAgICAgICAgICBlbWVyZ2VzID0gKGxheW91dFt0cF1bZ3R5cGVdLnN0YXRlID09ICJlbWVyZ2VzIik7CgkgICAgICAgICAgICAgICAgblBhcnRpdGlvbnMgPSAoZXZlbnRfb2NjdXJzKSA/CgkgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bZ3R5cGVdLm5QYXJ0aXRpb25zKjIgOgoJICAgICAgICAgICAgICAgICAgICBsYXlvdXRbdHBdW2d0eXBlXS5uUGFydGl0aW9uczsKCSAgICAgICAgICAgICAgICBuZXh0X3RwID0gdGltZXBvaW50c1tpZHgrMV07CgkgICAgICAgICAgICAgICAgeFNoaWZ0X2luX2xheW91dCA9IChsYXlvdXRbdHBdW2d0eXBlXS54U2hpZnQpID8gbGF5b3V0W3RwXVtndHlwZV0ueFNoaWZ0IDogMDsKCSAgICAgICAgICAgICAgICB4U2hpZnQgPSAKCSAgICAgICAgICAgICAgICAgICAgKGV2ZW50X29jY3VycykgPyAKCSAgICAgICAgICAgICAgICAgICAgMC41ICsgKHhTaGlmdF9pbl9sYXlvdXQvMikgOiAKCSAgICAgICAgICAgICAgICAgICAgeFNoaWZ0X2luX2xheW91dDsKCgkgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB4LWNvb3JkaW5hdGUgZm9yIHRoZSBib3R0b20gb2YgdGhpcyBnZW5vdHlwZSdzIGludGVydmFsIAoJICAgICAgICAgICAgICAgIHhCb3R0b20gPSAoZW1lcmdlcykgPyAKCSAgICAgICAgICAgICAgICAgICAgKGlkeCArIHhTaGlmdCkvKHRpbWVwb2ludHMubGVuZ3RoLTEpIDogCgkgICAgICAgICAgICAgICAgICAgIChpZHgpLyh0aW1lcG9pbnRzLmxlbmd0aC0xKTsKCgkgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGN1cnJlbnQgZ2Vub3R5cGUgaXMgLi4uCgkgICAgICAgICAgICAgICAgLy8gLi4uIEVNRVJHSU5HIGF0IHRoaXMgdGltZSBwb2ludC4uLiAKCSAgICAgICAgICAgICAgICBpZiAoZW1lcmdlcykgewoKCSAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGEgcGF0aCBwb2ludCBmb3IgdGhlIGJvdHRvbSBvZiB0aGUgZ2Vub3R5cGUncyBpbnRlcnZhbCBhdCB0aGUgY3VycmVudCB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgICAgIGN1cl9wYXRoLnBhdGgucHVzaCh7ICJ4IjogeEJvdHRvbSwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogbGF5b3V0W3RwXVtndHlwZV0uYm90dG9tLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHAiOiB0cCB9KTsKCgkgICAgICAgICAgICAgICAgICAgIC8vIC4uLiBhZGQgYSBwYXRoIHBvaW50IHRvIGV4cGFuZCB0aGUgc3dlZXAgc3VjaCB0aGF0IGl0cyBkZXNjZW5kYW50cyBjYW4gYmUgY29udGFpbmVkIHdpdGhpbiBpdAoJICAgICAgICAgICAgICAgICAgICBhcHBlYXJfeEJvdHRvbSA9IChpZHggKyB4U2hpZnQgKyAoMS9uUGFydGl0aW9ucykpLyh0aW1lcG9pbnRzLmxlbmd0aC0xKTsKCSAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiBhcHBlYXJfeEJvdHRvbSwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiBsYXlvdXRbbmV4dF90cF1bZ3R5cGVdLmJvdHRvbSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHAiOiB0cCB9KTsgLy8geS1jb29yZGluYXRlIGF0IG5leHQgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgIH0gICAKCgkgICAgICAgICAgICAgICAgLy8gLi4uIE5PVCBFTUVSR0lORyBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGEgcGF0aCBwb2ludCBmb3IgdGhlIGJvdHRvbSBvZiB0aGUgZ2Vub3R5cGUncyBpbnRlcnZhbCBhdCB0aGUgY3VycmVudCB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgICAgIGN1cl9wYXRoLnBhdGgucHVzaCh7ICJ4IjogeEJvdHRvbSwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogbGF5b3V0W3RwXVtndHlwZV0uYm90dG9tLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHAiOiB0cCB9KTsKCgkgICAgICAgICAgICAgICAgICAgIC8vIGlmIGV2ZW50IG9jY3VycyBhZnRlciB0aGlzIHRpbWVwb2ludAoJICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRfb2NjdXJzKSB7CgoJICAgICAgICAgICAgICAgICAgICAgICAgZnJhYyA9IHBlcnR1cmJhdGlvbnNbZXZlbnRfaW5kZXhdLmZyYWM7CgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHkgcHJvcG9ydGlvbiBhcyBoYWxmd2F5IGJldHdlZW4gdGhpcyBhbmQgdGhlIG5leHQgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgICAgICAgICAgeV9taWQgPSAobGF5b3V0W25leHRfdHBdW2d0eXBlXS5ib3R0b20gKyBsYXlvdXRbdHBdW2d0eXBlXS5ib3R0b20pLzI7CgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGEgcG9pbnQgaW4gdGhlIG1pZGRsZQoJICAgICAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiB4Qm90dG9tICsgbWlkX3RwLCAvLyBoYWxmd2F5IGJldHdlZW4gdGhpcyBhbmQgbmV4dCB0cAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiAoeV9taWQqZnJhYykgKyAoKDEtZnJhYykvMiksCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHAiOiAiZXZlbnQiIH0pOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgcGFydGl0aW9ucyBhZnRlciB0aGlzIHRpbWVwb2ludCwgYWRkIGEgcGF0aHBvaW50IGF0IHRoZSBmaXJzdCBwYXJ0aXRpb24KCSAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRfdHAgJiYgbGF5b3V0W25leHRfdHBdW2d0eXBlXSAmJiBsYXlvdXRbdHBdW2d0eXBlXS5uUGFydGl0aW9ucyA+IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXh0X3hCb3R0b20gPSAoaWR4ICsgeFNoaWZ0ICsgKDEvblBhcnRpdGlvbnMpKS8odGltZXBvaW50cy5sZW5ndGgtMSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBjdXJfcGF0aC5wYXRoLnB1c2goeyAieCI6IG5leHRfeEJvdHRvbSwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogbGF5b3V0W25leHRfdHBdW2d0eXBlXS5ib3R0b20sCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6IHRwIH0pOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSkKCgkgICAgICAgIC8vIGZvciBlYWNoIHRpbWUgcG9pbnQgKGluICpyZXZlcnNlKiBzZXF1ZW5jZSkuLi4KCSAgICAgICAgJC5lYWNoKHRpbWVwb2ludHNfcmV2LCBmdW5jdGlvbihpZHgsIHRwKSB7CgoJICAgICAgICAgICAgLy8gd2hldGhlciBvciBub3QgYW4gZXZlbnQgb2NjdXJzIGFmdGVyIHRoaXMgdGltZXBvaW50CgkgICAgICAgICAgICBldmVudF9vY2N1cnMgPSAoX2dldEludGVyc2VjdGlvbihfLnBsdWNrKHBlcnR1cmJhdGlvbnMsICJwcmV2X3RwIiksIHRwKS5sZW5ndGggPiAwKTsKCSAgICAgICAgICAgIGV2ZW50X2luZGV4ID0gXy5wbHVjayhwZXJ0dXJiYXRpb25zLCAicHJldl90cCIpLmluZGV4T2YodHApOwoKCSAgICAgICAgICAgIC8vIGlmIHRoZSBnZW5vdHlwZSBleGlzdHMgb3IgZW1lcmdlcy9kaXNhcHBlYXJzIGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgaWYgKGxheW91dFt0cF1bZ3R5cGVdKSB7CgkgICAgICAgICAgICAgICAgZW1lcmdlcyA9IChsYXlvdXRbdHBdW2d0eXBlXS5zdGF0ZSA9PSAiZW1lcmdlcyIpOwoJICAgICAgICAgICAgICAgIG5QYXJ0aXRpb25zID0gKGV2ZW50X29jY3VycykgPwoJICAgICAgICAgICAgICAgICAgICBsYXlvdXRbdHBdW2d0eXBlXS5uUGFydGl0aW9ucyoyIDoKCSAgICAgICAgICAgICAgICAgICAgbGF5b3V0W3RwXVtndHlwZV0ublBhcnRpdGlvbnM7CgkgICAgICAgICAgICAgICAgbmV4dF90cCA9IHRpbWVwb2ludHNfcmV2W2lkeC0xXTsKCSAgICAgICAgICAgICAgICB4U2hpZnRfaW5fbGF5b3V0ID0gKGxheW91dFt0cF1bZ3R5cGVdLnhTaGlmdCkgPyBsYXlvdXRbdHBdW2d0eXBlXS54U2hpZnQgOiAwOwoJICAgICAgICAgICAgICAgIHhTaGlmdCA9IAoJICAgICAgICAgICAgICAgICAgICAoZXZlbnRfb2NjdXJzKSA/IAoJICAgICAgICAgICAgICAgICAgICAwLjUgKyAoeFNoaWZ0X2luX2xheW91dC8yKSA6IAoJICAgICAgICAgICAgICAgICAgICB4U2hpZnRfaW5fbGF5b3V0OwoKCSAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHgtY29vcmRpbmF0ZSBmb3IgdGhlIHRvcCBvZiB0aGlzIGdlbm90eXBlJ3MgaW50ZXJ2YWwgCgkgICAgICAgICAgICAgICAgeFRvcCA9IChlbWVyZ2VzKSA/IAoJICAgICAgICAgICAgICAgICAgICAoKHRpbWVwb2ludHMubGVuZ3RoLTEpIC0gaWR4ICsgeFNoaWZ0KS8odGltZXBvaW50cy5sZW5ndGgtMSkgOiAKCSAgICAgICAgICAgICAgICAgICAgKCh0aW1lcG9pbnRzLmxlbmd0aC0xKSAtIGlkeCkvKHRpbWVwb2ludHMubGVuZ3RoLTEpOwoKCSAgICAgICAgICAgICAgICAvLyBpZiB0aGUgY3VycmVudCBnZW5vdHlwZSAuLi4KCSAgICAgICAgICAgICAgICAvLyAuLi4gRU1FUkdFUyBhdCB0aGUgY3VycmVudCB0aW1lIHBvaW50Li4uCgkgICAgICAgICAgICAgICAgaWYgKGVtZXJnZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGEgcGF0aCBwb2ludCB0byBicmluZyBmb3J3YXJkIHRoZSBzd2VlcCBzdWNoIHRoYXQgaXRzIGRlc2NlbmRhbnRzIGNhbiBiZSBjb250YWluZWQgdy9pbiBpdAoJICAgICAgICAgICAgICAgICAgICBhcHBlYXJfeFRvcCA9ICgodGltZXBvaW50cy5sZW5ndGgtMSkgLSBpZHggKyB4U2hpZnQgKyAoMS9uUGFydGl0aW9ucykpLyh0aW1lcG9pbnRzLmxlbmd0aC0xKTsKCSAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiBhcHBlYXJfeFRvcCwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiBsYXlvdXRbbmV4dF90cF1bZ3R5cGVdLnRvcCwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHAiOiB0cCB9KTsgLy8geS1jb29yZGluYXRlIGF0IG5leHQgdGltZSBwb2ludAoKCSAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGEgcGF0aCBwb2ludCBmb3IgdGhlIHRvcCBvZiB0aGUgZ2Vub3R5cGUncyBpbnRlcnZhbCBhdCB0aGUgY3VycmVudCB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgICAgIGN1cl9wYXRoLnBhdGgucHVzaCh7ICJ4IjogeFRvcCwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogbGF5b3V0W3RwXVtndHlwZV0udG9wLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHAiOiB0cCB9KTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIC8vIC4uLiBET0VTTidUIEVNRVJHRSBhdCB0aGUgY3VycmVudCB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgZWxzZSB7CgoKCSAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIHBhcnRpdGlvbnMgYWZ0ZXIgdGhpcyB0aW1lcG9pbnQsIGFkZCBhIHBhdGhwb2ludCBhdCB0aGUgZmlyc3QgcGFydGl0aW9uCgkgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0X3RwICYmIGxheW91dFtuZXh0X3RwXVtndHlwZV0gJiYgbGF5b3V0W3RwXVtndHlwZV0ublBhcnRpdGlvbnMgPiAxKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dF94VG9wID0gKCh0aW1lcG9pbnRzLmxlbmd0aC0xKSAtIGlkeCArIHhTaGlmdCArICgxL25QYXJ0aXRpb25zKSkvKHRpbWVwb2ludHMubGVuZ3RoLTEpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiBuZXh0X3hUb3AsIAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAieSI6IGxheW91dFtuZXh0X3RwXVtndHlwZV0udG9wLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHAiOiB0cCB9KTsKCSAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgLy8gaWYgZXZlbnQgb2NjdXJzIGFmdGVyIHRoaXMgdGltZXBvaW50CgkgICAgICAgICAgICAgICAgICAgIGlmIChldmVudF9vY2N1cnMpIHsKCgkgICAgICAgICAgICAgICAgICAgICAgICBmcmFjID0gcGVydHVyYmF0aW9uc1tldmVudF9pbmRleF0uZnJhYzsKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgeSBwcm9wb3J0aW9uIGFzIGhhbGZ3YXkgYmV0d2VlbiB0aGlzIGFuZCB0aGUgbmV4dCB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgICAgICAgICB5X21pZCA9IChsYXlvdXRbbmV4dF90cF1bZ3R5cGVdLnRvcCArIGxheW91dFt0cF1bZ3R5cGVdLnRvcCkvMjsKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBwb2ludCBpbiB0aGUgbWlkZGxlCgkgICAgICAgICAgICAgICAgICAgICAgICBjdXJfcGF0aC5wYXRoLnB1c2goeyAieCI6IHhUb3AgKyBtaWRfdHAsIC8vIGhhbGZ3YXkgYmV0d2VlbiB0aGlzIGFuZCBuZXh0IHRwCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAieSI6ICh5X21pZCpmcmFjKSArICgoMS1mcmFjKS8yKSwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHAiOiAiZXZlbnQiIH0pOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBwYXRoIHBvaW50IGZvciB0aGUgdG9wIG9mIHRoZSBnZW5vdHlwZSdzIGludGVydmFsIGF0IHRoZSBjdXJyZW50IHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiB4VG9wLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiBsYXlvdXRbdHBdW2d0eXBlXS50b3AsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6IHRwIH0pOwoJICAgICAgICAgICAgICAgIH0gICAKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSkKCSAgICAgICAgCgkgICAgICAgIC8vIGFkZCB0aGUgcGF0aCBmb3IgdGhpcyBnZW5vdHlwZSB0byB0aGUgbGlzdCBvZiBhbGwgcGF0aHMgdG8gcGxvdAoJICAgICAgICBwYXRocy5wdXNoKGN1cl9wYXRoKTsKCSAgICB9KQoKCSAgICByZXR1cm4gcGF0aHM7Cgl9CgoJLyogZnVuY3Rpb24gdG8gY29udmVydCBnZW5vdHlwZSBzdGFja3MgYXQgZWFjaCB0aW1lIHBvaW50IGludG8gYSBsaXN0IG9mIG1vdmVzIGZvciBlYWNoIGdlbm90eXBlJ3MgZDMgcGF0aCBvYmplY3QgCgkqICh0cmFja3MgdGltZXNjYXBlIHZpZXcpCgkqIE5vdGU6IHRoZSBhcHBlYXJhbmNlIHRpbWVwb2ludCBpcyB0aGUgdGltZSBhdCB3aGljaCB0aGUgZ2Vub3R5cGUgYXBwZWFycyBpbiB0aGUgZGF0YXNldAoJKiAgICAgICB0aGUgZW1lcmdlbmNlIHRpbWVwb2ludCBpcyB0aGUgdGltZSBhdCB3aGljaCB0aGUgZ2Vub3R5cGUgbXVzdCBoYXZlIGVtZXJnZWQgKGFwcGVhcmFuY2UgdGltZXBvaW50IC0gMSkKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9nZXRTZXBhcmF0ZVBhdGhzKGN1clZpek9iaikgewoJICAgIHZhciBkaW0gPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZywKCSAgICAgICAgdGltZXBvaW50cyA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMsCgkgICAgICAgIHRpbWVwb2ludHNfcmV2ID0gKCQuZXh0ZW5kKFtdLCB0aW1lcG9pbnRzKSkucmV2ZXJzZSgpLAoJICAgICAgICBsYXlvdXRPcmRlciA9IGN1clZpek9iai5kYXRhLmxheW91dE9yZGVyLAoJICAgICAgICBnZW5vdHlwZV9jcCA9IGN1clZpek9iai5kYXRhLmdlbm90eXBlX2NwLAoJICAgICAgICBsYXlvdXQgPSBjdXJWaXpPYmouZGF0YS5sYXlvdXQsCgkgICAgICAgIHBhZGRpbmcgPSAwLjAzLAoJICAgICAgICB0c19zZXBfbGFiZWxzID0gY3VyVml6T2JqLmRhdGEudHNfc2VwX2xhYmVscywKCSAgICAgICAgcGF0aHMgPSBbXSwKCSAgICAgICAgc0hlaWdodCA9IDAsCgkgICAgICAgIHNlZW5HVHlwZXMgPSBbXSwKCSAgICAgICAgbGFyZ2VzdF9jcHMgPSB7fSwKCSAgICAgICAgc2NhbGVkX21pZHBvaW50LAoJICAgICAgICBlbnRyeV9leGl0X29wdGlvbnMsCgkgICAgICAgIGVudHJ5X2V4aXQsCgkgICAgICAgIHhTaGlmdCwKCSAgICAgICAgeCwKCSAgICAgICAgeSwKCSAgICAgICAgY3VyX3BhdGgsCgkgICAgICAgIGZ1bGxfcGFkZGluZywKCSAgICAgICAgZGVub21pbmF0b3I7CgoJICAgIC8vIGZpbmQgdGhlIGRlbm9taW5hdG9yICh0b3RhbCBoZWlnaHQgb2YgdGhlIHZpZXcpLCBpbiB0ZXJtcyBvZiB0aGUgc3dlZXBzIChzdW0gb2YgbGFyZ2VzdCBjcCBmb3IgZWFjaCBnZW5vdHlwZSkKCSAgICBPYmplY3Qua2V5cyhnZW5vdHlwZV9jcCkuZm9yRWFjaChmdW5jdGlvbihndHlwZSwgZ3R5cGVfaWR4KSB7CgkgICAgICAgIHZhciBjcHMgPSBPYmplY3Qua2V5cyhnZW5vdHlwZV9jcFtndHlwZV0pLm1hcChmdW5jdGlvbiAoa2V5KSB7IHJldHVybiBnZW5vdHlwZV9jcFtndHlwZV1ba2V5XTsgfSk7CgkgICAgICAgIGxhcmdlc3RfY3BzW2d0eXBlXSA9IE1hdGgubWF4KC4uLmNwcyk7CgkgICAgfSkKCSAgICBkZW5vbWluYXRvciA9IE9iamVjdC5rZXlzKGxhcmdlc3RfY3BzKS5tYXAoZnVuY3Rpb24gKGtleSkgeyByZXR1cm4gbGFyZ2VzdF9jcHNba2V5XTsgfSkucmVkdWNlKGZ1bmN0aW9uKGEsIGIpIHsKCSAgICAgICAgcmV0dXJuIGEgKyBiOwoJICAgIH0pOyAKCSAgICBmdWxsX3BhZGRpbmcgPSBwYWRkaW5nICogKE9iamVjdC5rZXlzKGxhcmdlc3RfY3BzKS5sZW5ndGgrMSk7IC8vIHBhZGRpbmcgYmV0d2VlbiBlYWNoIGdlbm90eXBlICgrIGFib3ZlICYgYmVsb3cpCgkgICAgZGVub21pbmF0b3IgKz0gZnVsbF9wYWRkaW5nOwoKCSAgICAvLyBmb3IgZWFjaCBnZW5vdHlwZSwgZ2V0IGl0cyBwYXRoIHRocm91Z2ggdGhlIHRpbWUgcG9pbnRzCgkgICAgJC5lYWNoKGxheW91dE9yZGVyLCBmdW5jdGlvbihndHlwZV9pZHgsIGd0eXBlKSB7CgoJICAgICAgICBpZiAoT2JqZWN0LmtleXMobGFyZ2VzdF9jcHMpLmluZGV4T2YoZ3R5cGUpICE9IC0xKSB7CgoJICAgICAgICAgICAgLy8gc2NhbGVkIG1pZHBvaW50IGZvciB0aGlzIGdlbm90eXBlJ3MgdGltZXNjYXBlIGJhbmQKCSAgICAgICAgICAgIHNjYWxlZF9taWRwb2ludCA9IChsYXJnZXN0X2Nwc1tndHlwZV0gLyBkZW5vbWluYXRvcikvMiArIHNIZWlnaHQ7CgkgICAgICAgICAgICBzY2FsZWRfbWlkcG9pbnQgKz0gKChzZWVuR1R5cGVzLmxlbmd0aCkvKE9iamVjdC5rZXlzKGxhcmdlc3RfY3BzKS5sZW5ndGgrMSkpICogZnVsbF9wYWRkaW5nL2Rlbm9taW5hdG9yOwoKCSAgICAgICAgICAgIC8vIHBhdGggZm9yIHRoZSBjdXJyZW50IGdlbm90eXBlCgkgICAgICAgICAgICBjdXJfcGF0aCA9IHsiZ3R5cGUiOiBndHlwZSwgIm1pZHBvaW50Ijogc2NhbGVkX21pZHBvaW50LCAicGF0aCI6W119OwoJICAgICAgICAgICAgCgkgICAgICAgICAgICAvLyBCT1RUT00gQ09PUkRJTkFURSBmb3IgZWFjaCB0aW1lIHBvaW50IAoJICAgICAgICAgICAgJC5lYWNoKHRpbWVwb2ludHMsIGZ1bmN0aW9uKHRwX2lkeCwgdHApIHsKCgkgICAgICAgICAgICAgICAgLy8geFNoaWZ0IGluZm8KCSAgICAgICAgICAgICAgICBlbnRyeV9leGl0X29wdGlvbnMgPSBbImRpc2FwcGVhcnNfc3RyZXRjaGVkIiwgImVtZXJnZXMiLCAicmVwbGFjZWQiXTsKCSAgICAgICAgICAgICAgICBlbnRyeV9leGl0ID0gKGxheW91dFt0cF1bZ3R5cGVdKSA/IAoJICAgICAgICAgICAgICAgICAgICAoZW50cnlfZXhpdF9vcHRpb25zLmluZGV4T2YobGF5b3V0W3RwXVtndHlwZV0uc3RhdGUpICE9IC0xKSA6IAoJICAgICAgICAgICAgICAgICAgICBmYWxzZTsKCSAgICAgICAgICAgICAgICB4U2hpZnQgPSAobGF5b3V0W3RwXVtndHlwZV0gJiYgbGF5b3V0W3RwXVtndHlwZV0ueFNoaWZ0KSA/IGxheW91dFt0cF1bZ3R5cGVdLnhTaGlmdCA6IDA7CgoJICAgICAgICAgICAgICAgIGlmIChlbnRyeV9leGl0IHx8IGdlbm90eXBlX2NwW2d0eXBlXVt0cF0pIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRoaXMgZ2Vub3R5cGUgdG8gdGhlIHNlZW4gZ2Vub3R5cGVzCgkgICAgICAgICAgICAgICAgICAgIGlmIChzZWVuR1R5cGVzLmluZGV4T2YoZ3R5cGUpID09IC0xKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzZWVuR1R5cGVzLnB1c2goZ3R5cGUpOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAvLyBhZGQgdGhlIHBhdGggcG9pbnQKCSAgICAgICAgICAgICAgICAgICAgeCA9ICh0cF9pZHggKyB4U2hpZnQpLyh0aW1lcG9pbnRzLmxlbmd0aC0xKTsKCSAgICAgICAgICAgICAgICAgICAgeSA9IGdlbm90eXBlX2NwW2d0eXBlXVt0cF0gPyAKCSAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlZF9taWRwb2ludCAtIChnZW5vdHlwZV9jcFtndHlwZV1bdHBdIC8gZGVub21pbmF0b3IpLzIgOiAKCSAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlZF9taWRwb2ludDsKCSAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiB4LCAieSI6IHksICJ0cCI6IHRwLCAiY3AiOiBnZW5vdHlwZV9jcFtndHlwZV1bdHBdfSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgoJICAgICAgICAgICAgLy8gVE9QIENPT1JESU5BVEUgZm9yIGVhY2ggdGltZSBwb2ludCAoaW4gKnJldmVyc2UqIHNlcXVlbmNlKS4uLgoJICAgICAgICAgICAgJC5lYWNoKHRpbWVwb2ludHNfcmV2LCBmdW5jdGlvbih0cF9pZHgsIHRwKSB7CgoJICAgICAgICAgICAgICAgIC8vIHhTaGlmdCBpbmZvCgkgICAgICAgICAgICAgICAgZW50cnlfZXhpdF9vcHRpb25zID0gWyJkaXNhcHBlYXJzX3N0cmV0Y2hlZCIsICJlbWVyZ2VzIiwgInJlcGxhY2VkIl07CgkgICAgICAgICAgICAgICAgZW50cnlfZXhpdCA9IChsYXlvdXRbdHBdW2d0eXBlXSkgPyAKCSAgICAgICAgICAgICAgICAgICAgKGVudHJ5X2V4aXRfb3B0aW9ucy5pbmRleE9mKGxheW91dFt0cF1bZ3R5cGVdLnN0YXRlKSAhPSAtMSkgOiAKCSAgICAgICAgICAgICAgICAgICAgZmFsc2U7CgkgICAgICAgICAgICAgICAgeFNoaWZ0ID0gKGxheW91dFt0cF1bZ3R5cGVdICYmIGxheW91dFt0cF1bZ3R5cGVdLnhTaGlmdCkgPyBsYXlvdXRbdHBdW2d0eXBlXS54U2hpZnQgOiAwOwoKCSAgICAgICAgICAgICAgICAvLyBhZGQgdGhlIHBhdGggcG9pbnQKCSAgICAgICAgICAgICAgICBpZiAoZW50cnlfZXhpdCB8fCBnZW5vdHlwZV9jcFtndHlwZV1bdHBdKSB7CgkgICAgICAgICAgICAgICAgICAgIHggPSAoKHRpbWVwb2ludHMubGVuZ3RoLTEpIC0gdHBfaWR4ICsgeFNoaWZ0KS8odGltZXBvaW50cy5sZW5ndGgtMSk7CgkgICAgICAgICAgICAgICAgICAgIHkgPSBnZW5vdHlwZV9jcFtndHlwZV1bdHBdID8gCgkgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZWRfbWlkcG9pbnQgKyAoZ2Vub3R5cGVfY3BbZ3R5cGVdW3RwXSAvIGRlbm9taW5hdG9yKS8yIDogCgkgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZWRfbWlkcG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgIGN1cl9wYXRoLnBhdGgucHVzaCh7ICJ4IjogeCwgInkiOiB5LCAidHAiOiB0cCwgImNwIjogZ2Vub3R5cGVfY3BbZ3R5cGVdW3RwXX0pOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgCgkgICAgICAgICAgICAvLyBhZGQgdGhlIHBhdGggZm9yIHRoaXMgZ2Vub3R5cGUgdG8gdGhlIGxpc3Qgb2YgYWxsIHBhdGhzIHRvIHBsb3QKCSAgICAgICAgICAgIHBhdGhzLnB1c2goY3VyX3BhdGgpOwoKCSAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgc3RhY2sgaGVpZ2h0CgkgICAgICAgICAgICBzSGVpZ2h0ICs9IGxhcmdlc3RfY3BzW2d0eXBlXS9kZW5vbWluYXRvcjsKCSAgICAgICAgfQoJICAgIH0pCgoJICAgIHJldHVybiBwYXRoczsKCX0KCgoJLyogZnVuY3Rpb24gdG8gY2FsY3VsYXRlIGFuZCByZXR1cm4gYSBwYXRoIHJlcHJlc2VudGluZyBhIGhvcml6b250YWwgbGluZSB0aHJvdWdoIHRoZSBjZW50cmUgb2YgdGhlIHRpbWVzY2FwZSBzdmcgCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKCSovCglmdW5jdGlvbiBfY2VudHJlTGluZShjdXJWaXpPYmopIHsKCSAgICB2YXIgdHNTVkdXaWR0aCA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLnRzU1ZHV2lkdGgsIC8vIHRpbWVzY2FwZSBzdmcgd2lkdGgKCSAgICAgICAgdHNTVkdIZWlnaHQgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy50c1NWR0hlaWdodDsgLy8gdGltZXNjYXBlIHN2ZyBoZWlnaHQKCgkgICAgcmV0dXJuICJNIDAgIiArIHRzU1ZHSGVpZ2h0LzIgKyAiIEwgIiArIHRzU1ZHV2lkdGggKyAiICIgKyB0c1NWR0hlaWdodC8yICsgIiBMIDAgIiArIHRzU1ZHSGVpZ2h0LzI7Cgl9CgoJLyogdHdlZW4gZnVuY3Rpb24gdG8gdHJhbnNpdGlvbiB0byB0aGUgbmV4dCBwYXRoICgicGF0aCIgaW4gdGhlIGRhdGEpCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKCSogQHBhcmFtIHtTdHJpbmd9IHR5cGUgLSB0aGUgdHlwZSBvZiB0cmFuc2l0aW9uICgibW92ZSIgb3Igb3RoZXJ3aXNlIC0gaWYgb3RoZXJ3aXNlLCB3aWxsIG1vdmUgdG8gY2VudHJlIGxpbmUpCgkqIE5vdGU6IHNpdHVhdGlvbnMgb3RoZXIgdGhhbiAibW92ZSIgLSBjb3VsZCBiZSBhbiBleGl0IHNpdHVhdGlvbiwgd2hlcmUgdGhlIG5leHQgcGF0aCBpcyBibGFuawoJKi8KCWZ1bmN0aW9uIF9wYXRoVHdlZW4oY3VyVml6T2JqLCB0eXBlKSB7IAoJICAgIAoJICAgIHZhciBwcmVjaXNpb24gPSA0OwoKCSAgICByZXR1cm4gZnVuY3Rpb24oKSB7CgkgICAgICAgIHZhciBkZXN0X3BhdGgsCgkgICAgICAgICAgICBwYXRoMCwKCSAgICAgICAgICAgIHBhdGgxLAoJICAgICAgICAgICAgbjAsIAoJICAgICAgICAgICAgbjEsCgkgICAgICAgICAgICBkaXN0YW5jZXMsCgkgICAgICAgICAgICBwb2ludHMsCgkgICAgICAgICAgICBwMCwKCSAgICAgICAgICAgIHAxOwoKCSAgICAgICAgLy8gZm9yIGFuIGV4aXQgc2l0dWF0aW9uLCB0aGUgcGF0aCB0byBtb3ZlIHRvIGlzIGEgbGluZSBpbiB0aGUgY2VudHJlIG9mIHRoZSB0aW1lc2NhcGUgc3ZnCgkgICAgICAgIGRlc3RfcGF0aCA9ICh0eXBlID09ICJtb3ZlIikgPyB0aGlzLl9fZGF0YV9fLnBhdGggOiBfY2VudHJlTGluZShjdXJWaXpPYmopOyAKCSAgICAgICAgcGF0aDAgPSB0aGlzOwoJICAgICAgICBwYXRoMSA9IHBhdGgwLmNsb25lTm9kZSgpOwoJICAgICAgICBuMCA9IHBhdGgwLmdldFRvdGFsTGVuZ3RoKCk7CgkgICAgICAgIG4xID0gKHBhdGgxLnNldEF0dHJpYnV0ZSgiZCIsIGRlc3RfcGF0aCksIHBhdGgxKS5nZXRUb3RhbExlbmd0aCgpOwoKCSAgICAgICAgLy8gVW5pZm9ybSBzYW1wbGluZyBvZiBkaXN0YW5jZSBiYXNlZCBvbiBzcGVjaWZpZWQgcHJlY2lzaW9uLgoJICAgICAgICBkaXN0YW5jZXMgPSBbMF0sIGkgPSAwLCBkdCA9IHByZWNpc2lvbiAvIE1hdGgubWF4KG4wLCBuMSk7CgkgICAgICAgIHdoaWxlICgoaSArPSBkdCkgPCAxKSBkaXN0YW5jZXMucHVzaChpKTsKCSAgICAgICAgZGlzdGFuY2VzLnB1c2goMSk7CgkgICAgICAgIC8vIENvbXB1dGUgcG9pbnQtaW50ZXJwb2xhdG9ycyBhdCBlYWNoIGRpc3RhbmNlLgoJICAgICAgICBwb2ludHMgPSBkaXN0YW5jZXMubWFwKGZ1bmN0aW9uKHQpIHsKCSAgICAgICAgICAgIHAwID0gcGF0aDAuZ2V0UG9pbnRBdExlbmd0aCh0ICogbjApOwoJICAgICAgICAgICAgcDEgPSBwYXRoMS5nZXRQb2ludEF0TGVuZ3RoKHQgKiBuMSk7CgkgICAgICAgICAgICByZXR1cm4gZDMuaW50ZXJwb2xhdGUoW3AwLngsIHAwLnldLCBbcDEueCwgcDEueV0pOwoJICAgICAgICB9KTsKCSAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKCSAgICAgICAgICAgIHJldHVybiB0IDwgMSA/ICJNIiArIHBvaW50cy5tYXAoZnVuY3Rpb24ocCkgeyByZXR1cm4gcCh0KTsgfSkuam9pbigiTCIpIDogZGVzdF9wYXRoOwoJICAgICAgICB9OwoJICAgIH07Cgl9CgoJLyogZnVuY3Rpb24gdG8gY29udmVydCBzdHJhaWdodCBwYXRocyBmb3IgZWFjaCBnZW5vdHlwZSB0byBiZXppZXIgY3VydmUgcGF0aHMKCSogQHBhcmFtIHtPYmplY3R9IHBhdGhzIC0tIHN0cmFpZ2h0IHBhdGggZm9yIGVhY2ggZ2Vub3R5cGUKCSogQHBhcmFtIHtOdW1iZXJ9IHRzU1ZHV2lkdGggLS0gd2lkdGggb2YgdGhlIHRpbWVzY2FwZSBzdmcKCSogQHBhcmFtIHtOdW1iZXJ9IHRzU1ZHSGVpZ2h0IC0tIGhlaWdodCBvZiB0aGUgdGltZXNjYXBlIHN2ZwoJKi8KCWZ1bmN0aW9uIF9nZXRCZXppZXJQYXRocyhwYXRocywgdHNTVkdXaWR0aCwgdHNTVkdIZWlnaHQpIHsKCgkgICAgdmFyIGJlemllcl9wYXRocyA9IFtdLAoJICAgICAgICBwYXRoLAoJICAgICAgICBiZXppZXJfcGF0aCwKCSAgICAgICAgeHNvdXJjZSwKCSAgICAgICAgeHRhcmdldCwKCSAgICAgICAgeXNvdXJjZSwKCSAgICAgICAgeXRhcmdldCwKCSAgICAgICAgZGlhZ29uYWw7CgoJICAgIC8vIGZvciBlYWNoIGdlbm90eXBlJ3MgcGF0aAoJICAgICQuZWFjaChwYXRocywgZnVuY3Rpb24ocGF0aF9pZHgsIGN1cl9wYXRoKSB7IAoKCSAgICAgICAgcGF0aCA9IGN1cl9wYXRoLnBhdGg7CgkgICAgICAgIGJlemllcl9wYXRoID0gIiI7CgoJICAgICAgICAvLyBmb3IgZWFjaCBwb2ludCBpbiB0aGUgcGF0aCwgZ2V0IGl0cyBkaWFnb25hbCB0byB0aGUgbmV4dCBwb2ludAoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoLTE7IGkrKykgewoJICAgICAgICAgICAgeHNvdXJjZSA9IHBhdGhbaV0ueCAqIHRzU1ZHV2lkdGg7CgkgICAgICAgICAgICB4dGFyZ2V0ID0gcGF0aFtpKzFdLnggKiB0c1NWR1dpZHRoOwoJICAgICAgICAgICAgeXNvdXJjZSA9IHBhdGhbaV0ueSAqIHRzU1ZHSGVpZ2h0OwoJICAgICAgICAgICAgeXRhcmdldCA9IHBhdGhbaSsxXS55ICogdHNTVkdIZWlnaHQ7CgoJICAgICAgICAgICAgLy8gZGlhZ29uYWwgbGluZSBnZW5lcmF0b3IgZm9yIGJlemllciBjdXJ2ZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgICAgICAgIGRpYWdvbmFsID0gZDMuc3ZnLmRpYWdvbmFsKCkKCSAgICAgICAgICAgICAgICAuc291cmNlKGZ1bmN0aW9uKCkgeyByZXR1cm4geyJ5IjogeHNvdXJjZSwgIngiOiB5c291cmNlIH07IH0pCgkgICAgICAgICAgICAgICAgLnRhcmdldChmdW5jdGlvbigpIHsgcmV0dXJuIHsieSI6IHh0YXJnZXQsICJ4IjogeXRhcmdldH07fSkKCSAgICAgICAgICAgICAgICAucHJvamVjdGlvbihmdW5jdGlvbihkKSB7IHJldHVybiBbZC55LCBkLnhdIH0pOwoKCSAgICAgICAgICAgIC8vIGZvciB0aGlzIGdlbm90eXBlLCBhcHBlbmQgdGhlIGJlemllciBjdXJ2ZSBjb25uZWN0aW5nIHRoaXMgcG9pbnQgYW5kIHRoZSBuZXh0IAoJICAgICAgICAgICAgYmV6aWVyX3BhdGggPSAoaSA9PT0gMCkgPyBiZXppZXJfcGF0aCArIGRpYWdvbmFsKCkgOiBiZXppZXJfcGF0aCArICJMIiArIGRpYWdvbmFsKCkuc3Vic3RyaW5nKDEpOwoJICAgICAgICB9CgoJICAgICAgICBiZXppZXJfcGF0aHMucHVzaCh7Imd0eXBlIjogY3VyX3BhdGguZ3R5cGUsICJwYXRoIjogYmV6aWVyX3BhdGh9KTsKCSAgICB9KQoKCSAgICByZXR1cm4gYmV6aWVyX3BhdGhzOwoJfQoKCS8vIENPTE9VUiBGVU5DVElPTlMKCgkvKiBmdW5jdGlvbiB0byBjYWxjdWxhdGUgY29sb3VycyBiYXNlZCBvbiBwaHlsb2dlbnkgCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmogLS0gdml6T2JqIGZvciB0aGUgY3VycmVudCB2aWV3CgkqLwoJZnVuY3Rpb24gX2dldFBoeWxvQ29sb3VycyhjdXJWaXpPYmopIHsKCgkgICAgdmFyIGNvbG91cl9hc3NpZ25tZW50ID0ge30sIC8vIHN0YW5kYXJkIGNvbG91ciBhc3NpZ25tZW50CgkgICAgICAgIGFscGhhX2NvbG91cl9hc3NpZ25tZW50ID0ge30sIC8vIGFscGhhIGNvbG91ciBhc3NpZ25tZW50CgkgICAgICAgIGN1cl9jb2xvdXJzID0gY3VyVml6T2JqLnVzZXJDb25maWcuY2xvbmVfY29sczsKCgkgICAgLy8gY2xvbmUgY29sb3VycyBzcGVjaWZpZWQKCSAgICBpZiAoY3VyX2NvbG91cnMgIT0gIk5BIikgewoJICAgICAgICAvLyBnZXQgY29sb3VyIGFzc2lnbm1lbnQgLSB1c2Ugc3BlY2lmaWVkIGNvbG91cnMKCSAgICAgICAgLy8gaGFuZGxpbmcgZGlmZmVyZW50IGlucHV0cyAtLSBUT0RPIHNob3VsZCBwcm9iYWJseSBiZSBkb25lIGluIFIKCSAgICAgICAgY3VyX2NvbG91cnMuZm9yRWFjaChmdW5jdGlvbihjb2wsIGNvbF9pZHgpIHsKCSAgICAgICAgICAgIHZhciBjb2xfdmFsdWUgPSBjb2wuY29sb3VyOwoJICAgICAgICAgICAgaWYgKGNvbF92YWx1ZVswXSAhPSAiIyIpIHsgLy8gYXBwZW5kIGEgaGFzaHRhZyBpZiBuZWNlc3NhcnkKCSAgICAgICAgICAgICAgICBjb2xfdmFsdWUgPSAiIyIuY29uY2F0KGNvbF92YWx1ZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoY29sX3ZhbHVlLmxlbmd0aCA+IDcpIHsgLy8gcmVtb3ZlIGFueSBhbHBoYSB0aGF0IG1heSBiZSBwcmVzZW50IGluIHRoZSBoZXggdmFsdWUKCSAgICAgICAgICAgICAgICBjb2xfdmFsdWUgPSBjb2xfdmFsdWUuc3Vic3RyaW5nKDAsNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjb2xvdXJfYXNzaWdubWVudFtjb2wuY2xvbmVfaWRdID0gY29sX3ZhbHVlOwoJICAgICAgICB9KTsKCSAgICB9CgoJICAgIC8vIGNsb25lIGNvbG91cnMgbm90IHNwZWNpZmllZAoJICAgIGVsc2UgewoJICAgICAgICB2YXIgcyA9IDAuODgsIC8vIHNhdHVyYXRpb24KCSAgICAgICAgICAgIGwgPSAwLjc3OyAvLyBsaWdodG5lc3MKCgkgICAgICAgIC8vIG51bWJlciBvZiBub2RlcwoJICAgICAgICB2YXIgbl9ub2RlcyA9IGN1clZpek9iai5kYXRhLnRyZWVDaGFpblJvb3RzLmxlbmd0aDsKCgkgICAgICAgIC8vIGNvbG91ciBlYWNoIHRyZWUgY2hhaW4gcm9vdCBhIHNlcXVlbnRpYWwgY29sb3VyIGZyb20gdGhlIHNwZWN0cnVtCgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbl9ub2RlczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgY3VyX25vZGUgPSBjdXJWaXpPYmouZGF0YS50cmVlQ2hhaW5Sb290c1tpXTsKCSAgICAgICAgICAgIHZhciBoID0gKGkvbl9ub2RlcyArIDAuOTYpICUgMTsKCSAgICAgICAgICAgIHZhciByZ2IgPSBfaHNsVG9SZ2IoaCwgcywgbCk7IC8vIGhzbCB0byByZ2IKCSAgICAgICAgICAgIHZhciBjb2wgPSBfcmdiMmhleCgicmdiKCIgKyByZ2JbMF0gKyAiLCIgKyByZ2JbMV0gKyAiLCIgKyByZ2JbMl0gKyAiKSIpOyAvLyByZ2IgdG8gaGV4CgoJICAgICAgICAgICAgY29sb3VyX2Fzc2lnbm1lbnRbY3VyX25vZGVdID0gY29sOwoKCSAgICAgICAgICAgIC8vIGZvciBlYWNoIG9mIHRoZSBjaGFpbidzIGRlc2NlbmRhbnRzCgkgICAgICAgICAgICB2YXIgcHJldl9jb2xvdXIgPSBjb2w7CgkgICAgICAgICAgICBjdXJWaXpPYmouZGF0YS50cmVlQ2hhaW5zW2N1cl9ub2RlXS5mb3JFYWNoKGZ1bmN0aW9uKGRlc2MsIGRlc2NfaSkgewoJICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIG9uIHRoZSBwaGFudG9tIHJvb3QncyBicmFuY2ggYW5kIGl0J3MgdGhlIGZpcnN0IGRlc2NlbmRhbnQKCSAgICAgICAgICAgICAgICBpZiAoY3VyX25vZGUgPT0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcucGhhbnRvbVJvb3QgJiYgZGVzY19pID09PSAwKSB7CgoJICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3QgZGVjcmVhc2UgdGhlIGJyaWdodG5lc3MKCSAgICAgICAgICAgICAgICAgICAgY29sb3VyX2Fzc2lnbm1lbnRbZGVzY10gPSBwcmV2X2NvbG91cjsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gd2UncmUgbm90IG9uIHRoZSBwaGFudG9tIHJvb3QgYnJhbmNoJ3MgZmlyc3QgZGVzY2VuZGFudAoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAvLyBjb2xvdXIgdGhlIGRlc2NlbmRhbnQgYSBsaWdodGVyIHZlcnNpb24gb2YgdGhlIHByZXZpb3VzIGNvbG91ciBpbiB0aGUgY2hhaW4KCSAgICAgICAgICAgICAgICAgICAgY29sb3VyX2Fzc2lnbm1lbnRbZGVzY10gPSAKCSAgICAgICAgICAgICAgICAgICAgICAgIF9kZWNyZWFzZV9icmlnaHRuZXNzKHByZXZfY29sb3VyLCAyMCk7CgoJICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIHByZXZpb3VzIGNvbG91ciB0byB0aGUgbGlnaHRlbmVkIGNvbG91cgoJICAgICAgICAgICAgICAgICAgICBwcmV2X2NvbG91ciA9IGNvbG91cl9hc3NpZ25tZW50W2Rlc2NdOyAKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KQoJICAgICAgICB9CgkgICAgfQoJICAgIGN1clZpek9iai52aWV3LmNvbG91cl9hc3NpZ25tZW50ID0gY29sb3VyX2Fzc2lnbm1lbnQ7ICAKCgkgICAgLy8gZ2V0IHRoZSBhbHBoYSBjb2xvdXIgYXNzaWdubWVudAoJICAgIE9iamVjdC5rZXlzKGNvbG91cl9hc3NpZ25tZW50KS5mb3JFYWNoKGZ1bmN0aW9uKGtleSwga2V5X2lkeCkgewoJICAgICAgICBhbHBoYV9jb2xvdXJfYXNzaWdubWVudFtrZXldID0gCgkgICAgICAgICAgICBfaW5jcmVhc2VfYnJpZ2h0bmVzcyhjb2xvdXJfYXNzaWdubWVudFtrZXldLCBjdXJWaXpPYmoudXNlckNvbmZpZy5hbHBoYSk7CgkgICAgfSk7CgkgICAgY3VyVml6T2JqLnZpZXcuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQgPSBhbHBoYV9jb2xvdXJfYXNzaWdubWVudDsKCX0KCgkvLyBDaGVjayBjb2xvciBicmlnaHRuZXNzCgkvLyByZXR1cm5zIGJyaWdodG5lc3MgdmFsdWUgZnJvbSAwIHRvIDI1NQoJLy8gaHR0cDovL3d3dy53ZWJtYXN0ZXJ3b3JsZC5jb20vZm9ydW04OC85NzY5Lmh0bQoJZnVuY3Rpb24gX2dldF9icmlnaHRuZXNzKGhleENvZGUpIHsKCSAgICBpZiAoaGV4Q29kZSA9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKCSAgICB9CgoJICAgIC8vIHN0cmlwIG9mZiBhbnkgbGVhZGluZyAjCgkgICAgaGV4Q29kZSA9IGhleENvZGUucmVwbGFjZSgnIycsICcnKTsKCgkgICAgdmFyIGNfciA9IHBhcnNlSW50KGhleENvZGUuc3Vic3RyKDAsIDIpLDE2KTsKCSAgICB2YXIgY19nID0gcGFyc2VJbnQoaGV4Q29kZS5zdWJzdHIoMiwgMiksMTYpOwoJICAgIHZhciBjX2IgPSBwYXJzZUludChoZXhDb2RlLnN1YnN0cig0LCAyKSwxNik7CgoJICAgIHJldHVybiAoKGNfciAqIDI5OSkgKyAoY19nICogNTg3KSArIChjX2IgKiAxMTQpKSAvIDEwMDA7Cgl9CgoJLyoqCgkgKiBDb252ZXJ0cyBhbiBIU0wgY29sb3IgdmFsdWUgdG8gUkdCLiBDb252ZXJzaW9uIGZvcm11bGEKCSAqIGFkYXB0ZWQgZnJvbSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0hTTF9jb2xvcl9zcGFjZS4KCSAqIEFzc3VtZXMgaCwgcywgYW5kIGwgYXJlIGNvbnRhaW5lZCBpbiB0aGUgc2V0IFswLCAxXSBhbmQKCSAqIHJldHVybnMgciwgZywgYW5kIGIgaW4gdGhlIHNldCBbMCwgMjU1XS4KCSAqCgkgKiBAcGFyYW0gICBOdW1iZXIgIGggICAgICAgVGhlIGh1ZQoJICogQHBhcmFtICAgTnVtYmVyICBzICAgICAgIFRoZSBzYXR1cmF0aW9uCgkgKiBAcGFyYW0gICBOdW1iZXIgIGwgICAgICAgVGhlIGxpZ2h0bmVzcwoJICogQHJldHVybiAgQXJyYXkgICAgICAgICAgIFRoZSBSR0IgcmVwcmVzZW50YXRpb24KCSAqLwoJZnVuY3Rpb24gX2hzbFRvUmdiKGgsIHMsIGwpewoJICAgIHZhciByLCBnLCBiOwoKCSAgICBpZihzID09PSAwKXsKCSAgICAgICAgciA9IGcgPSBiID0gbDsgLy8gYWNocm9tYXRpYwoJICAgIH1lbHNlewoJICAgICAgICB2YXIgaHVlMnJnYiA9IGZ1bmN0aW9uIGh1ZTJyZ2IocCwgcSwgdCl7CgkgICAgICAgICAgICBpZih0IDwgMCkgdCArPSAxOwoJICAgICAgICAgICAgaWYodCA+IDEpIHQgLT0gMTsKCSAgICAgICAgICAgIGlmKHQgPCAxLzYpIHJldHVybiBwICsgKHEgLSBwKSAqIDYgKiB0OwoJICAgICAgICAgICAgaWYodCA8IDEvMikgcmV0dXJuIHE7CgkgICAgICAgICAgICBpZih0IDwgMi8zKSByZXR1cm4gcCArIChxIC0gcCkgKiAoMi8zIC0gdCkgKiA2OwoJICAgICAgICAgICAgcmV0dXJuIHA7CgkgICAgICAgIH0KCgkgICAgICAgIHZhciBxID0gbCA8IDAuNSA/IGwgKiAoMSArIHMpIDogbCArIHMgLSBsICogczsKCSAgICAgICAgdmFyIHAgPSAyICogbCAtIHE7CgkgICAgICAgIHIgPSBodWUycmdiKHAsIHEsIGggKyAxLzMpOwoJICAgICAgICBnID0gaHVlMnJnYihwLCBxLCBoKTsKCSAgICAgICAgYiA9IGh1ZTJyZ2IocCwgcSwgaCAtIDEvMyk7CgkgICAgfQoKCSAgICByZXR1cm4gW01hdGgucm91bmQociAqIDI1NSksIE1hdGgucm91bmQoZyAqIDI1NSksIE1hdGgucm91bmQoYiAqIDI1NSldOwoJfQoKCS8vIGNvbnZlcnQgUkdCIHRvIGhleAoJLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNzQwNzAwL2dldC1oZXgtdmFsdWUtcmF0aGVyLXRoYW4tcmdiLXZhbHVlLXVzaW5nLWpxdWVyeQoJZnVuY3Rpb24gX3JnYjJoZXgocmdiKSB7CgkgICAgIGlmICggIHJnYi5zZWFyY2goInJnYiIpID09IC0xICkgewoJICAgICAgICAgIHJldHVybiByZ2I7CgkgICAgIH0gZWxzZSB7CgkgICAgICAgICAgcmdiID0gcmdiLm1hdGNoKC9ecmdiYT9cKChcZCspLFxzKihcZCspLFxzKihcZCspKD86LFxzKihcZCspKT9cKSQvKTsKCSAgICAgICAgICBmdW5jdGlvbiBoZXgoeCkgewoJICAgICAgICAgICAgICAgcmV0dXJuICgiMCIgKyBwYXJzZUludCh4KS50b1N0cmluZygxNikpLnNsaWNlKC0yKTsKCSAgICAgICAgICB9CgkgICAgICAgICAgcmV0dXJuICIjIiArIGhleChyZ2JbMV0pICsgaGV4KHJnYlsyXSkgKyBoZXgocmdiWzNdKTsgCgkgICAgIH0KCX0KCgkvLyBmdW5jdGlvbiB0byBpbmNyZWFzZSBicmlnaHRuZXNzIG9mIGhleCBjb2xvdXIKCS8vIGZyb206IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNjQ0Mzk5MC9qYXZhc2NyaXB0LWNhbGN1bGF0ZS1icmlnaHRlci1jb2xvdXIKCWZ1bmN0aW9uIF9pbmNyZWFzZV9icmlnaHRuZXNzKGhleCwgcGVyY2VudCl7CgkgICAgLy8gc3RyaXAgdGhlIGxlYWRpbmcgIyBpZiBpdCdzIHRoZXJlCgkgICAgaGV4ID0gaGV4LnJlcGxhY2UoL15ccyojfFxzKiQvZywgJycpOwoKCSAgICAvLyBjb252ZXJ0IDMgY2hhciBjb2RlcyAtLT4gNiwgZS5nLiBgRTBGYCAtLT4gYEVFMDBGRmAKCSAgICBpZihoZXgubGVuZ3RoID09IDMpewoJICAgICAgICBoZXggPSBoZXgucmVwbGFjZSgvKC4pL2csICckMSQxJyk7CgkgICAgfQoKCSAgICB2YXIgciA9IHBhcnNlSW50KGhleC5zdWJzdHIoMCwgMiksIDE2KSwKCSAgICAgICAgZyA9IHBhcnNlSW50KGhleC5zdWJzdHIoMiwgMiksIDE2KSwKCSAgICAgICAgYiA9IHBhcnNlSW50KGhleC5zdWJzdHIoNCwgMiksIDE2KTsKCgkgICAgcmV0dXJuICcjJyArCgkgICAgICAgKCgwfCgxPDw4KSArIHIgKyAoMjU2IC0gcikgKiBwZXJjZW50IC8gMTAwKS50b1N0cmluZygxNikpLnN1YnN0cigxKSArCgkgICAgICAgKCgwfCgxPDw4KSArIGcgKyAoMjU2IC0gZykgKiBwZXJjZW50IC8gMTAwKS50b1N0cmluZygxNikpLnN1YnN0cigxKSArCgkgICAgICAgKCgwfCgxPDw4KSArIGIgKyAoMjU2IC0gYikgKiBwZXJjZW50IC8gMTAwKS50b1N0cmluZygxNikpLnN1YnN0cigxKTsKCX0KCgkvLyBmdW5jdGlvbiB0byBkZWNyZWFzZSBicmlnaHRuZXNzIG9mIGhleCBjb2xvdXIKCS8vIGZyb206IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTI2NjA5MTkvamF2YXNjcmlwdC1icmlnaHRuZXNzLWZ1bmN0aW9uLWRlY3JlYXNlCglmdW5jdGlvbiBfZGVjcmVhc2VfYnJpZ2h0bmVzcyhoZXgsIHBlcmNlbnQpewoJICAgIHZhciByID0gcGFyc2VJbnQoaGV4LnN1YnN0cigxLCAyKSwgMTYpLAoJICAgICAgICBnID0gcGFyc2VJbnQoaGV4LnN1YnN0cigzLCAyKSwgMTYpLAoJICAgICAgICBiID0gcGFyc2VJbnQoaGV4LnN1YnN0cig1LCAyKSwgMTYpOwoKCSAgIHJldHVybiAnIycgKwoJICAgICAgICgoMHwoMTw8OCkgKyByICogKDEwMCAtIHBlcmNlbnQpIC8gMTAwKS50b1N0cmluZygxNikpLnN1YnN0cigxKSArCgkgICAgICAgKCgwfCgxPDw4KSArIGcgKiAoMTAwIC0gcGVyY2VudCkgLyAxMDApLnRvU3RyaW5nKDE2KSkuc3Vic3RyKDEpICsKCSAgICAgICAoKDB8KDE8PDgpICsgYiAqICgxMDAgLSBwZXJjZW50KSAvIDEwMCkudG9TdHJpbmcoMTYpKS5zdWJzdHIoMSk7Cgl9CgoJLy8gTVVUQVRJT04gRlVOQ1RJT05TCgoJLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBtdXRhdGlvbnMgaW50byBhIGJldHRlciBmb3JtYXQKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iaiAtLSB2aXpPYmogZm9yIHRoZSBjdXJyZW50IHZpZXcKCSovCglmdW5jdGlvbiBfcmVmb3JtYXRNdXRhdGlvbnMoY3VyVml6T2JqKSB7CgkgICAgdmFyIG9yaWdpbmFsX211dHMgPSBjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnMsIC8vIG11dHMgZnJvbSB1c2VyIGRhdGEKCSAgICAgICAgbXV0c19hcnIgPSBbXTsKCgkgICAgLy8gY29udmVydCBvYmplY3QgaW50byBhcnJheQoJICAgIG9yaWdpbmFsX211dHMuZm9yRWFjaChmdW5jdGlvbihtdXQpIHsKCgkgICAgICAgIC8vIGxpbmsgaWQgd2hlcmUgbXV0YXRpb24gb2NjdXJyZWQKCSAgICAgICAgdmFyIGxpbmtfaWQgPSAidHJlZUxpbmtfc291cmNlXyIgKyBjdXJWaXpPYmouZGF0YS5kaXJlY3RfYW5jZXN0b3JzW211dC5jbG9uZV9pZF0gKyAiX3RhcmdldF8iICsgIG11dC5jbG9uZV9pZDsKCgkgICAgICAgIC8vIGFkZCB0aGlzIG11dGF0aW9uIHRvIHRoZSBhcnJheQoJICAgICAgICB2YXIgY3VyX211dCA9IHsKCSAgICAgICAgICAgICJlbXB0eSI6ICIiLCAvLyBhZGQgYW4gZW1wdHkgc3RyaW5nIGZvciBhbiBlbXB0eSBjb2x1bW4gKGNsb25lIGNvbHVtbikgdGhhdCB3aWxsIGNvbnRhaW4gYW4gU1ZHCgkgICAgICAgICAgICAibGlua19pZCI6IGxpbmtfaWQsCgkgICAgICAgIH0KICAgICAgICAgICAgT2JqZWN0LmtleXMobXV0KS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgY3VyX211dFtrZXldID0gbXV0W2tleV07CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIG11dHNfYXJyLnB1c2goY3VyX211dCk7CgkgICAgfSk7CgoJICAgIGN1clZpek9iai5kYXRhLm11dGF0aW9ucyA9IG11dHNfYXJyOwoJfQoKCS8vIEdFTkVSQUwgRlVOQ1RJT05TCgoJLyogZnVuY3Rpb24gdG8gY2FwaXRhbGl6ZSBlYWNoIHdvcmQgaW4gYSBzdHJpbmcKCSogRnJvbTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80ODc4NzU2L2phdmFzY3JpcHQtaG93LXRvLWNhcGl0YWxpemUtZmlyc3QtbGV0dGVyLW9mLWVhY2gtd29yZC1saWtlLWEtMi13b3JkLWNpdHkKCSovCglmdW5jdGlvbiB0b1RpdGxlQ2FzZShzdHIpCgl7CgkgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9cd1xTKi9nLCBmdW5jdGlvbih0eHQpe3JldHVybiB0eHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0eHQuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7fSk7Cgl9CgoJLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBpbnRlcnNlY3Rpb24gb2YgdHdvIGFycmF5cwoJKiBAcGFyYW0ge0FycmF5fSBhcnJheTEgLS0gZmlyc3QgYXJyYXkKCSogQHBhcmFtIHtBcnJheX0gYXJyYXkyIC0tIHNlY29uZCBhcnJheQoJKi8KCWZ1bmN0aW9uIF9nZXRJbnRlcnNlY3Rpb24oYXJyYXkxLCBhcnJheTIpIHsKCgkgICAgaWYgKGFycmF5MSA9PSB1bmRlZmluZWQgfHwgYXJyYXkyID09IHVuZGVmaW5lZCkgewoJICAgICAgICByZXR1cm4gW107CgkgICAgfQoKCSAgICByZXR1cm4gYXJyYXkxLmZpbHRlcihmdW5jdGlvbihuKSB7CgkgICAgICAgIHJldHVybiBhcnJheTIuaW5kZXhPZihuKSAhPSAtMQoJICAgIH0pOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIHNvcnQgYSAyRCBhcnJheSBieSB0aGUgc2Vjb25kIHZhbHVlIGluIGVhY2ggY29udGFpbmVkIGFycmF5LCAKCSogQHJldHVybnMgdGhlIHNvcnRlZCBmaXJzdCBlbGVtZW50cyBvZiBlYWNoIGNvbnRhaW5lZCBhcnJheSAKCSovCglmdW5jdGlvbiBfc29ydDJEQXJyQnlWYWx1ZShvYmopCgl7CgkgICAgdmFyIHgsCgkgICAgICAgIHk7CgoJICAgIC8vIHNvcnQgaXRlbXMgYnkgdmFsdWUKCSAgICBvYmouc29ydChmdW5jdGlvbihhLCBiKQoJICAgIHsKCSAgICAgICAgeD1hWzFdOwoJICAgICAgICB5PWJbMV07CgkgICAgICAgIHJldHVybiB4PHkgPyAtMSA6IHg+eSA/IDEgOiAwOwoJICAgIH0pOwoKCSAgICAvLyBnZXQgZmlyc3QgZWxlbWVudCBvZiBlYWNoIGNvbnRhaW5lZCBhcnJheQoJICAgIGZpcnN0X2VsZW1lbnRzID0gW107CgkgICAgZm9yKHZhciBpPTA7IGk8b2JqLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgIGZpcnN0X2VsZW1lbnRzLnB1c2gob2JqW2ldWzBdKTsKCSAgICB9CgoJICAgIHJldHVybiBmaXJzdF9lbGVtZW50czsgCgl9CgoJLyogZnVuY3Rpb24gdG8gZG93bmxvYWQgUE5HCgkqIEBwYXJhbSBjbGFzc05hbWUgLS0gbmFtZSBvZiB0aGUgY2xhc3Mgb2YgdGhlIHN2ZyB0byBkb3dubG9hZCAoZS5nLiAibXlTVkciKQoJKiBAcGFyYW0gZmlsZU91dHB1dE5hbWUgLS0gZmlsZW5hbWUgZm9yIG91dHB1dAoJKi8KCWZ1bmN0aW9uIF9kb3dubG9hZFBORyhjbGFzc05hbWUsIGZpbGVPdXRwdXROYW1lKSB7CgkgICAgLy8gZ2V0IGN1cnJlbnQgbWFyZ2luIG9mIHN2ZyBlbGVtZW50CgkgICAgdmFyIGN1cl9tYXJnaW4gPSBkMy5zZWxlY3QoIi4iICsgY2xhc3NOYW1lKS5zdHlsZSgibWFyZ2luIik7CgoJICAgIC8vIHRlbXBvcmFyaWx5IHJlbW92ZSB0aGUgbWFyZ2luIHNvIHRoZSB2aWV3IGlzbid0IGN1dCBvZmYKCSAgICBkMy5zZWxlY3QoIi4iICsgY2xhc3NOYW1lKQoJICAgICAgICAuc3R5bGUoIm1hcmdpbiIsICIwcHgiKTsKCgkgICAgdmFyIGh0bWwgPSBkMy5zZWxlY3QoIi4iICsgY2xhc3NOYW1lKQoJICAgICAgICAuYXR0cigidmVyc2lvbiIsIDEuMSkKCSAgICAgICAgLmF0dHIoInhtbG5zIiwgImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIikKCSAgICAgICAgLm5vZGUoKS5wYXJlbnROb2RlLmlubmVySFRNTDsKCgkgICAgdmFyIGltZ3NyYyA9ICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcrIGJ0b2EoaHRtbCk7CgoJICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJjYW52YXMiKSwKCSAgICAgICAgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwoKCSAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2U7CgkgICAgaW1hZ2Uuc3JjID0gaW1nc3JjOwoJICAgIGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewoJICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CgoJICAgICAgICB2YXIgY2FudmFzZGF0YSA9IGNhbnZhcy50b0RhdGFVUkwoImltYWdlL3BuZyIpOwoKCSAgICAgICAgdmFyIHBuZ2ltZyA9ICc8aW1nIHNyYz0iJytjYW52YXNkYXRhKyciPic7IAoKCSAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CgkgICAgICAgIGEuZG93bmxvYWQgPSBmaWxlT3V0cHV0TmFtZTsKCSAgICAgICAgYS5ocmVmID0gY2FudmFzZGF0YTsKCSAgICAgICAgYS5jbGljaygpOwoJICAgIH07CgoJICAgIC8vIHJlc2V0IHRoZSBtYXJnaW4gb2YgdGhlIHN2ZyBlbGVtZW50CgkgICAgZDMuc2VsZWN0KCIuIiArIGNsYXNzTmFtZSkKCSAgICAgICAgLnN0eWxlKCJtYXJnaW4iLCBjdXJfbWFyZ2luKTsKCX0KCgkvKiBmdW5jdGlvbiB0byBzb3J0IGFycmF5IG9mIG9iamVjdHMgYnkga2V5IAoJKiBtb2RpZmllZCBmcm9tOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzg4Mzc0NTQvc29ydC1hcnJheS1vZi1vYmplY3RzLWJ5LXNpbmdsZS1rZXktd2l0aC1kYXRlLXZhbHVlCgkqLwoJZnVuY3Rpb24gX3NvcnRCeUtleShhcnJheSwgZmlyc3RLZXksIHNlY29uZEtleSkgewoJICAgIHNlY29uZEtleSA9IHNlY29uZEtleSB8fCAiTkEiOwoJICAgIHJldHVybiBhcnJheS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKCSAgICAgICAgdmFyIHggPSBhW2ZpcnN0S2V5XTsgdmFyIHkgPSBiW2ZpcnN0S2V5XTsKCSAgICAgICAgdmFyIHJlcyA9ICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkgICAgICAgIGlmIChzZWNvbmRLZXkgPT0gIk5BIikgewoJICAgICAgICAgICAgcmV0dXJuIHJlczsgICAgICAgICAgICAKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIGlmICh0eXBlb2YoYVtzZWNvbmRLZXldID09ICJzdHJpbmciKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiAocmVzID09PSAwKSA/IChhW3NlY29uZEtleV0gPiBiW3NlY29uZEtleV0pIDogcmVzOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mKGFbc2Vjb25kS2V5XSA9PSAibnVtYmVyIikpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gKHJlcyA9PT0gMCkgPyAoYVtzZWNvbmRLZXldIC0gYltzZWNvbmRLZXldKSA6IHJlczsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgIHJldHVybiByZXM7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9KTsKCX0KCgkvLyBNVVRBVElPTiBUQUJMRSBGVU5DVElPTlMKCgkvKiBmdW5jdGlvbiB0byBtYWtlIG11dGF0aW9uIHRhYmxlCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmogLS0gdml6T2JqIGZvciB0aGUgY3VycmVudCB2aWV3CgkqIEBwYXJhbSB7T2JqZWN0fSBtdXRhdGlvblRhYmxlRElWIC0tIERJViBmb3IgbXV0YXRpb24gdGFibGUKCSogQHBhcmFtIHtBcnJheX0gZGF0YSAtLSBkYXRhIHRvIHBsb3Qgd2l0aGluIHRhYmxlCgkqIEBwYXJhbSB7TnVtYmVyfSB0YWJsZV9oZWlnaHQgLS0gaGVpZ2h0IG9mIHRoZSB0YWJsZSAoaW4gcHgpCgkqLwoJZnVuY3Rpb24gX21ha2VNdXRhdGlvblRhYmxlKGN1clZpek9iaiwgbXV0YXRpb25UYWJsZURJViwgZGF0YSwgdGFibGVfaGVpZ2h0KSB7CgkJdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLAoJCQl2aWV3X2lkID0gY3VyVml6T2JqLnZpZXdfaWQsCgkJCXRhYmxlOwoKCQkvLyBtYWtlIGRlZmVycmVkIG9iamVjdCBmb3IgbXV0YXRpb24gdGFibGUgc2V0dXAKCQljdXJWaXpPYmoubXV0VGFibGVEZWYgPSBuZXcgJC5EZWZlcnJlZCgpOwoKCSAgICAvLyBjcmVhdGUgdGFibGUgc2tlbGV0b24KCSAgCW11dGF0aW9uVGFibGVESVYuYXBwZW5kKCJ0YWJsZSIpCgkgIAkJLmF0dHIoImNsYXNzIiwgImRpc3BsYXkgY29tcGFjdCIpCgkgICAgCS5hdHRyKCJpZCIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gdmlld19pZCArICJfbXV0YXRpb25UYWJsZSI7IH0pOwoKCSAgICAvLyBjcmVhdGUgZGF0YSB0YWJsZQoJCSQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAgICB0YWJsZSA9ICQoIiMiICsgdmlld19pZCArICJfbXV0YXRpb25UYWJsZSIpLkRhdGFUYWJsZSh7CgkJICAgICAgCSJkYXRhIjogZGF0YSwKCQkgICAgICAJImNvbHVtbnMiOiBkaW0ubXV0YXRpb25Db2x1bW5zLAoJCQkgICAgInNjcm9sbFkiOiAgICAgICAgdGFibGVfaGVpZ2h0IC0gNTAsIC8vIC0gNTAgZm9yIHNlYXJjaCBiYXIsIGV0Yy4KCQkgICAgICAgICJzY3JvbGxDb2xsYXBzZSI6IHRydWUsCgkJICAgICAgICAicGFnaW5nIjogICAgICAgICBmYWxzZSwKCQkgICAgICAgICJpbmZvIjogCQkgIHRydWUsCgkJICAgICAgICAibGFuZ3VhZ2UiOiB7CgkJICAgICAgICAJImluZm8iOiAgICAgICAgICAgIlNob3dpbmcgX1RPVEFMXyBlbnRyaWVzIiwKCQkgICAgICAgIAkiaW5mb0VtcHR5IjogICAgICAiU2hvd2luZyAwIGVudHJpZXMiCgkJICAgICAgICB9LAoJICAgICAgIAkJImFhU29ydGluZyI6IFtdIC8vIGRpc2FibGUgaW5pdGlhbCBzb3J0CgkJICAgIH0pOwoKCQkgICAgY3VyVml6T2JqLm11dFRhYmxlRGVmLnJlc29sdmUoIkZpbmlzaGVkIGNyZWF0aW5nIHRhYmxlIHNldHVwLiIpOwoJCX0pOwkKCgoJCS8vIHdoZW4gbXV0YXRpb24gdGFibGUgaXMgc2V0IHVwCgkJY3VyVml6T2JqLm11dFRhYmxlRGVmLmRvbmUoZnVuY3Rpb24oKSB7CgoJCQkvLyBkMyBlZmZlY3RzCgkJCSQoIiMiICsgdmlld19pZCArICJfbXV0YXRpb25UYWJsZSIpCgkJICAgICAgICAub24oJ2NsaWNrJywgJ3RyJywgZnVuY3Rpb24gKCkgeyAKCQkgICAgICAgIAkKCQkgICAgICAgIAkvLyBoaWRlIFZBRiB0b29sdGlwcwoJCSAgICAgICAgCWN1clZpek9iai52YWZUaXBzLmZvckVhY2goZnVuY3Rpb24oY3VyVGlwKSB7CgkJICAgICAgICAJCWN1clRpcC5oaWRlKCk7CgkJICAgICAgICAJfSkKCgkJICAgICAgICAJLy8gaWYgbXV0YXRpb24gaXMgYWxyZWFkeSBzZWxlY3RlZCwgCgkJICAgICAgICAJaWYgKCQodGhpcykuaGFzQ2xhc3MoInNlbGVjdGVkIikpIHsKCQkgICAgICAgIAkJLy8gc3dpdGNoIG11dGF0aW9uIHNlbGVjdGlvbiB0byBmYWxzZQoJCSAgICAgICAgCQlkaW0ubXV0U2VsZWN0T24gPSBmYWxzZTsKCQkgICAgICAgIAl9CgkJICAgICAgICAJLy8gb3RoZXJ3aXNlLCAKCQkgICAgICAgIAllbHNlIHsKCQkgICAgICAgIAkJLy8gc3dpdGNoIG9uIG11dGF0aW9uIHNlbGVjdGlvbgoJCSAgICAgICAgCQlkaW0ubXV0U2VsZWN0T24gPSB0cnVlOwoJCSAgICAgICAgCX0KCgkJICAgICAgICAJLy8gTVVUQVRJT04gU0VMRUNURUQKCgkJICAgICAgICAJaWYgKGRpbS5tdXRTZWxlY3RPbikgewoKCQkJICAgICAgICAJLy8gZGF0YSBmb3IgdGhlIHJvdyBvbiBtb3VzZW92ZXIKCQkJICAgICAgICAJdmFyIGN1cl9kYXRhID0gdGFibGUucm93cyh0aGlzKS5kYXRhKClbMF07CgoJCSAgICAgICAgCQkvLyBpZiBhIGRpZmZlcmVudCByb3cgd2FzIHByZXZpb3VzbHkgc2VsZWN0ZWQKCQkgICAgICAgIAkJaWYgKGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIuc2VsZWN0ZWQiKVswXS5sZW5ndGggPT0gMSkgewoKCQkgICAgICAgIAkJCS8vIGRlc2VsZWN0IHRoYXQgcm93CgkJCSAgICAgICAgCQlkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLnNlbGVjdGVkIikuY2xhc3NlZCgic2VsZWN0ZWQiLCBmYWxzZSk7CgoJCQkgICAgICAgIAkJLy8gcmVtb3ZlIGFsbCBtdXRhdGlvbiBwcmV2YWxlbmNlcyBpbmZvcm1hdGlvbiBmcm9tIHZpZXcKICAgIAkJCQkJCWQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIubXV0YXRpb25QcmV2IikucmVtb3ZlKCk7CgogICAgCQkJCQkJLy8gdW5oaWdobGlnaHQgKHJlZCkgdGhlIHByZXZpb3VzIGxpbmsKICAgIAkJCQkJCWQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRUcmVlTGluayIpLmF0dHIoInN0cm9rZSIsIGRpbS50cmVlTGlua0NvbG91cik7CgkJCSAgICAgICAgCX0KCgkJICAgICAgICAJCS8vIGluYWN0aXZhdGUgZ2Vub3R5cGVzCgkgICAgICAgICAgICAgICAgICAgIF90c0luYWN0aXZhdGVHZW5vdHlwZXMoY3VyVml6T2JqLnZpZXdfaWQpOwoKICAgICAgICAgICAgICAgICAgICAJLy8gaGlnaGxpZ2h0IHRoaXMgbGluayAKCSAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpCgkgICAgICAgICAgICAgICAgICAgICAgICAuc2VsZWN0KCIubGVnZW5kVHJlZUxpbmsuIiArIGN1cl9kYXRhLmxpbmtfaWQpCgkgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigic3Ryb2tlIiwgInJlZCIpOwoKCSAgICAgICAgICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IGFsbCBlbGVtZW50cyBkb3duc3RyZWFtIG9mIGxpbmsgCgkgICAgICAgICAgICAgICAgICAgIF9wcm9wYWdhdGVkRWZmZWN0cyhjdXJWaXpPYmosIGN1cl9kYXRhLmxpbmtfaWQsIGN1clZpek9iai5saW5rX2lkcywgImRvd25zdHJlYW0iKTsKCgkJICAgICAgICAJCS8vIG1hcmsgYXMgc2VsZWN0ZWQKCSAgICAgICAgCQkJJCh0aGlzKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIG11dGF0aW9uIHByZXZhbGVuY2VzIGV4aXN0LCBzaG93IHRoZW0gZm9yIHRoaXMgbXV0YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLm11dGF0aW9uX3ByZXZhbGVuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBnZW5vbWljIGxvY2F0aW9uIG9mIG11dGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjdXJfZGF0YS5jaHJvbSArICI6IiArIGN1cl9kYXRhLmNvb3JkOyAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmV2YWxlbmNlcyBvZiB0aGlzIG11dGF0aW9uIGF0IGVhY2ggc2FtcGxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyX3ByZXZzID0gY3VyVml6T2JqLnVzZXJDb25maWcubXV0YXRpb25fcHJldmFsZW5jZXNbbG9jYXRpb25dOyAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aHJlc2hvbGQgZm9yIG11dGF0aW9uIHByZXZhbGVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aHJlc2hvbGQgPSAwLjAxOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZpbHRlciBtdXRhdGlvbnMgKGdldCByaWQgb2YgdGhvc2UgPCB0aHJlc2hvbGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyX3ByZXZzX2ZpbHRlcmVkID0gXy5maWx0ZXIoY3VyX3ByZXZzLCBmdW5jdGlvbihWQUYpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIFZBRi5WQUYgPj0gdGhyZXNob2xkOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKCQkgICAgICAgIAkJCS8vIGZvciBlYWNoIHByZXZhbGVuY2UKCQkgICAgICAgIAkJCWN1cl9wcmV2c19maWx0ZXJlZC5mb3JFYWNoKGZ1bmN0aW9uKHByZXYpIHsKCgkJCQkJCQkgICAgLy8gdG9vbHRpcCBmb3IgbXV0YXRpb24gVkFGcwoJCQkJCQkJICAgIHZhciBjdXJUaXAgPSBkMy50aXAoKQoJCQkJCQkJICAgICAgICAuYXR0cignY2xhc3MnLCAnZDMtdGlwJykKCQkJCQkJCSAgICAgICAgLm9mZnNldChbLTEwLDBdKQoJCQkJCQkJICAgICAgICAuaHRtbChmdW5jdGlvbihkKSB7CgkJCQkJCQkgICAgCQlyZXR1cm4gIjxzcGFuPlZBRjogIiArIGQgKyAiPC9zcGFuPiI7CgkJCQkJCQkgIAkJfSkJCgoJCQkJCQkJICAJLy8gYWRkIHRvIGxpc3Qgb2YgdGlwcwoJCQkJCQkJICAJY3VyVml6T2JqLnZhZlRpcHMucHVzaChjdXJUaXApOwoKCQkJCQkJCSAgCS8vIGludm9rZSB0aGUgdGlwIGluIHRoZSBjb250ZXh0IG9mIHRoaXMgdmlzdWFsaXphdGlvbgoJCQkJCQkJICAJZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRpbWVzY2FwZV8iICsgdmlld19pZCkuY2FsbChjdXJUaXApOwoKCQkJCQkJCSAgCS8vIHNob3cgdG9vbHRpcAoJCQkJCQkJICAJdmFyIHJvdW5kZWRfVkFGID0gKE1hdGgucm91bmQocHJldi5WQUYqMTAwKS8xMDApLnRvRml4ZWQoMik7CgkJCQkJCQkgIAljdXJUaXAuc2hvdyhyb3VuZGVkX1ZBRiwgCgkJCQkJCQkgIAkJZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnhBeGlzTGFiZWxzLnRwXyIgKyBwcmV2LnRpbWVwb2ludClbMF1bMF0pOwoJCSAgICAgICAgCQkJfSkKICAgICAgICAgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgCX0KCgkJICAgICAgICAJLy8gTVVUQVRJT04gREUtU0VMRUNURUQgKGNsaWNrIGFueXdoZXJlIGluIHRhYmxlKQoKCQkgICAgICAgIAllbHNlIHsKCQkgICAgICAgIAkJX2JhY2tncm91bmRDbGljayhjdXJWaXpPYmopOwoJCSAgICAgICAgCX0KCgkJICAgICAgICB9KTsKCgoJCQkvLyBhZGQgY2xvbmUgU1ZHcwoJCQlkaW0uY3VyQ2xvbmVJRHMgPSBfLnBsdWNrKGRhdGEsICJjbG9uZV9pZCIpOwoJCQlfYWRkQ2xvbmVTVkdzVG9UYWJsZShjdXJWaXpPYmosIGRpbS5jdXJDbG9uZUlEcyk7CgkgICAgfSkKCX0KCgkvKiBmdW5jdGlvbiB0byBhZGQgY2xvbmUgU1ZHcyB0byB0aGUgbXV0YXRpb24gdGFibGUKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iaiAtLSB2aXpPYmogZm9yIHRoZSBjdXJyZW50IHZpZXcKCSogQHBhcmFtIHtBcnJheX0gY2xvbmVfaWRzIC0tIGNsb25lIGlkcyB0byBwbG90IHdpdGhpbiB0YWJsZQoJKi8KCWZ1bmN0aW9uIF9hZGRDbG9uZVNWR3NUb1RhYmxlKGN1clZpek9iaiwgY2xvbmVfaWRzKSB7CgkJLy8gcmVtb3ZlIGFueSBwcmV2aW91cyBjbG9uZSBTVkdzCgkJZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5zdmdDbG9uZUNpcmNsZSIpLnJlbW92ZSgpOwoKCQkvLyBnZXQgY2xvbmUgY29sdW1uIG51bWJlcgoJCXZhciBtdXRfY29sdW1ucyA9IF8ucGx1Y2soY3VyVml6T2JqLmdlbmVyYWxDb25maWcubXV0YXRpb25Db2x1bW5zLCAiZGF0YSIpOwoJCXZhciBjbG9uZV9jb2x1bW5fbm8gPSBtdXRfY29sdW1ucy5pbmRleE9mKCJlbXB0eSIpICsgMTsKCgkJLy8gYWRkIGNsb25lIFNWR3MKCQl2YXIgcm93cyA9IGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCArICJfbXV0YXRpb25UYWJsZSIpLnNlbGVjdEFsbCgidHIiKTsKCQl2YXIgc3ZnQ29sdW1uID0gcm93cy5zZWxlY3RBbGwoInRkOm50aC1jaGlsZCgiICsgY2xvbmVfY29sdW1uX25vICsgIikiKQoJCQkuYXBwZW5kKCJkaXYiKQoJCQkuYXR0cigiaWQiLCAic3ZnQ2xvbmVDaXJjbGVESVYiKQoJCQkuc3R5bGUoImhlaWdodCIsIjEwMCUiKQoJICAgICAgICAuc3R5bGUoIndpZHRoIiwiMTAwJSIpOyAKCSAgICB2YXIgaW5kZXggPSAwOyAvLyBpbmRleCBvZiBjbG9uZSBpZCBpbiBjbG9uZV9pZHMgYXJyYXkKCSAgICB2YXIgc3ZnQ2lyY2xlID0gc3ZnQ29sdW1uCgkgICAgICAgIC5hcHBlbmQoInN2ZyIpCgkgICAgICAgIC5hdHRyKCJ3aWR0aCIsIDEwKQoJICAgICAgICAuYXR0cigiaGVpZ2h0IiwgMTApCgkgICAgICAgIC5hdHRyKCJjbGFzcyIsInN2Z0Nsb25lQ2lyY2xlIikKCSAgICAgICAgLmFwcGVuZCgiY2lyY2xlIikKCSAgICAgICAgLmF0dHIoImN4IiwgNSkKCSAgICAgICAgLmF0dHIoImN5IiwgNSkKCSAgICAgICAgLmF0dHIoInIiLCA0KQoJICAgICAgICAuYXR0cigiZmlsbCIsIGZ1bmN0aW9uKCkgewoJICAgICAgICAJcmV0dXJuIGN1clZpek9iai52aWV3LmFscGhhX2NvbG91cl9hc3NpZ25tZW50W2Nsb25lX2lkc1tpbmRleCsrXV07CgkgICAgICAgIH0pCgkgICAgICAgIC5hdHRyKCJzdHJva2UiLCBmdW5jdGlvbigpIHsKCSAgICAgICAgCS8vIGZpbGwgaGFwcGVucyBmaXJzdCBmb3IgYWxsIHJvd3MsIHNvIHdlIGhhdmUgdG8gcmVzZXQgdGhlIGluZGV4IHRvIHplcm8KCSAgICAgICAgCS8vIGJlZm9yZSBzZXR0aW5nIHRoZSBzdHJva2UgZm9yIGFsbCByb3dzCgkgICAgICAgIAlpZiAoaW5kZXggPT0gY2xvbmVfaWRzLmxlbmd0aCkgewoJICAgICAgICAJCWluZGV4ID0gMDsKCSAgICAgICAgCX0KCSAgICAgICAgCXJldHVybiBjdXJWaXpPYmoudmlldy5jb2xvdXJfYXNzaWdubWVudFtjbG9uZV9pZHNbaW5kZXgrK11dOwoJICAgICAgICB9KTsKCX0KCn0KCi8qIGZ1bmN0aW9uIHRvIHNob3cgbGFiZWxzIGZvciBhIHBhcnRpY3VsYXIgZ2Vub3R5cGUKKiBAcGFyYW0ge1N0cmluZ30gZ3R5cGUgLS0gdGhlIGN1cnJlbnQgZ2Vub3R5cGUgYmVpbmcgbW91c2VkIG92ZXIKKiBAcGFyYW0ge1N0cmluZ30gdmlld19pZCAtLSBpZCBmb3IgdGhlIGN1cnJlbnQgdmlldwoqLwpmdW5jdGlvbiBfc2hvd0xhYmVscyhndHlwZSwgdmlld19pZCkgewogICAgdmFyIGN1clZpZXcgPSBkMy5zZWxlY3QoIiMiICsgdmlld19pZCk7CgogICAgLy8gdHJhZGl0aW9uYWwgdmlldwogICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi50c1Bsb3RHIikuY2xhc3NlZCgidHJhZGl0aW9uYWwiKSkgeyAKICAgIAljdXJWaWV3LnNlbGVjdEFsbCgiLmxhYmVsLmd0eXBlXyIgKyBndHlwZSkuYXR0cigiZmlsbC1vcGFjaXR5IiwgMSkKICAgIAkJLnRleHQoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sYWJlbF90ZXh0OyB9KTsKICAgIAljdXJWaWV3LnNlbGVjdEFsbCgiLmxhYmVsQ2lyYy5ndHlwZV8iICsgZ3R5cGUpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDEpOwogICAgfQoKICAgIC8vIHRyYWNrcyB2aWV3CiAgICBlbHNlIHsgCiAgICAJY3VyVmlldy5zZWxlY3RBbGwoIi5zZXBMYWJlbC5ndHlwZV8iICsgZ3R5cGUpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDEpCiAgICAJCS50ZXh0KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubGFiZWxfdGV4dDsgfSk7CiAgICAJY3VyVmlldy5zZWxlY3RBbGwoIi5zZXBMYWJlbENpcmMuZ3R5cGVfIiArIGd0eXBlKS5hdHRyKCJmaWxsLW9wYWNpdHkiLCAxKTsKICAgIH0KfQoKLyogZnVuY3Rpb24gdG8gaGlkZSBsYWJlbHMgYW5kIGxhYmVsIGNpcmNsZXMKKiBAcGFyYW0ge1N0cmluZ30gdmlld19pZCAtLSBpZCBmb3IgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9oaWRlTGFiZWxzKHZpZXdfaWQpIHsKICAgIHZhciBjdXJWaWV3ID0gZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpOwoKICAgIC8vIHRyYWRpdGlvbmFsIHZpZXcKICAgIGlmIChkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIudHNQbG90RyIpLmNsYXNzZWQoInRyYWRpdGlvbmFsIikpIHsgCiAgICAJY3VyVmlldy5zZWxlY3RBbGwoIi5sYWJlbCIpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDApCiAgICAJCS50ZXh0KGZ1bmN0aW9uKCkgeyByZXR1cm4gIiI7IH0pOyAvLyB0ZXh0IHJlbW92ZWQgZm9yIHB1cnBvc2VzIG9mIHN2ZyBkb3dubG9hZCAob3RoZXJ3aXNlIHdpbGwgc2hvdyB1cCkKICAgIAljdXJWaWV3LnNlbGVjdEFsbCgiLmxhYmVsQ2lyYyIpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDApOwogICAgfQoKICAgIC8vIHRyYWNrcyB2aWV3CiAgICBlbHNlIHsgCiAgICAJY3VyVmlldy5zZWxlY3RBbGwoIi5zZXBMYWJlbCIpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDApCiAgICAJCS50ZXh0KGZ1bmN0aW9uKCkgeyByZXR1cm4gIiI7IH0pOyAvLyB0ZXh0IHJlbW92ZWQgZm9yIHB1cnBvc2VzIG9mIHN2ZyBkb3dubG9hZCAob3RoZXJ3aXNlIHdpbGwgc2hvdyB1cCkKICAgIAljdXJWaWV3LnNlbGVjdEFsbCgiLnNlcExhYmVsQ2lyYyIpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDApOwogICAgfQp9CgovKiBmdW5jdGlvbiB0byBoaWdobGlnaHQgdGltZXBvaW50IGd1aWRlCiovCmZ1bmN0aW9uIF9obFRwR3VpZGUodmlld19pZCwgdHApIHsKCS8vIHZpZXcgdGltZXBvaW50IGd1aWRlCglkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHBHdWlkZS50cF8iICsgdHApCgkJLmF0dHIoInN0cm9rZSIsICJibGFjayIpCgkJLmF0dHIoInN0cm9rZS1vcGFjaXR5IiwgMSk7Cn0KCi8qIGZ1bmN0aW9uIHRvIGhpZGUgdGltZXBvaW50IGd1aWRlcwoqLwpmdW5jdGlvbiBfaGlkZVRwR3VpZGVzKHZpZXdfaWQpIHsKCS8vIGhpZGUgdGltZXBvaW50IGd1aWRlcwoJZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRwR3VpZGUiKQoJCS5hdHRyKCJzdHJva2UiLCAid2hpdGUiKQoJCS5hdHRyKCJzdHJva2Utb3BhY2l0eSIsIDAuNCk7Cgp9Cg=="></script>
<script src="data:application/x-javascript;base64,Ly8gRG93bmxvYWRzIGFuIFNWRyBvbiB0aGUgd2VicGFnZSwgYWNjZXNzZWQgYnkgaXRzIGNsYXNzIG5hbWUKZnVuY3Rpb24gZG93bmxvYWRTVkcoc3ZnQ2xhc3NOYW1lKSB7CnZhciBkb2N0eXBlID0gJzw/eG1sIHZlcnNpb249IjEuMCIgc3RhbmRhbG9uZT0ibm8iPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPic7CgogIHdpbmRvdy5VUkwgPSAod2luZG93LlVSTCB8fCB3aW5kb3cud2Via2l0VVJMKTsKCiAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5OwoKICB2YXIgcHJlZml4ID0gewogICAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zLyIsCiAgICB4bGluazogImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLAogICAgc3ZnOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgfQoKICBpbml0aWFsaXplKCk7CgogIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICB2YXIgZG9jdW1lbnRzID0gW3dpbmRvdy5kb2N1bWVudF0sCiAgICAgICAgU1ZHU291cmNlcyA9IFtdOwogICAgICAgIGlmcmFtZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJpZnJhbWUiKSwKICAgICAgICBvYmplY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgib2JqZWN0Iik7CgogICAgW10uZm9yRWFjaC5jYWxsKGlmcmFtZXMsIGZ1bmN0aW9uKGVsKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGVsLmNvbnRlbnREb2N1bWVudCkgewogICAgICAgICAgZG9jdW1lbnRzLnB1c2goZWwuY29udGVudERvY3VtZW50KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2goZXJyKSB7CiAgICAgICAgY29uc29sZS5sb2coZXJyKQogICAgICB9CiAgICB9KTsKCiAgICBbXS5mb3JFYWNoLmNhbGwob2JqZWN0cywgZnVuY3Rpb24oZWwpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoZWwuY29udGVudERvY3VtZW50KSB7CiAgICAgICAgICBkb2N1bWVudHMucHVzaChlbC5jb250ZW50RG9jdW1lbnQpOwogICAgICAgIH0KICAgICAgfSBjYXRjaChlcnIpIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnIpCiAgICAgIH0KICAgIH0pOwoKICAgIGRvY3VtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGRvYykgewogICAgICB2YXIgc3R5bGVzID0gZ2V0U3R5bGVzKGRvYyk7CiAgICAgIHZhciBuZXdTb3VyY2VzID0gZ2V0U291cmNlcyhkb2MsIHN0eWxlcyk7CiAgICAgIC8vIGJlY2F1c2Ugb2YgcHJvdG90eXBlIG9uIE5ZVCBwYWdlcwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld1NvdXJjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBTVkdTb3VyY2VzLnB1c2gobmV3U291cmNlc1tpXSk7CiAgICAgIH07CiAgICB9KQogICAgaWYgKFNWR1NvdXJjZXMubGVuZ3RoID4gMSkgewogICAgICBjcmVhdGVQb3BvdmVyKFNWR1NvdXJjZXMpOwogICAgfSBlbHNlIGlmIChTVkdTb3VyY2VzLmxlbmd0aCA+IDApIHsKICAgICAgZG93bmxvYWQoU1ZHU291cmNlc1swXSk7CiAgICB9IGVsc2UgewogICAgICBhbGVydCgiVGhlIENyb3diYXIgY291bGRu4oCZdCBmaW5kIGFueSBTVkcgbm9kZXMuIik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVQb3BvdmVyKHNvdXJjZXMpIHsKICAgIGNsZWFudXAoKTsKCiAgICBzb3VyY2VzLmZvckVhY2goZnVuY3Rpb24oczEpIHsKICAgICAgc291cmNlcy5mb3JFYWNoKGZ1bmN0aW9uKHMyKSB7CiAgICAgICAgaWYgKHMxICE9PSBzMikgewogICAgICAgICAgaWYgKChNYXRoLmFicyhzMS50b3AgLSBzMi50b3ApIDwgMzgpICYmIChNYXRoLmFicyhzMS5sZWZ0IC0gczIubGVmdCkgPCAzOCkpIHsKICAgICAgICAgICAgczIudG9wICs9IDM4OwogICAgICAgICAgICBzMi5sZWZ0ICs9IDM4OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkKICAgIH0pOwoKICAgIHZhciBidXR0b25zQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBib2R5LmFwcGVuZENoaWxkKGJ1dHRvbnNDb250YWluZXIpOwoKICAgIGJ1dHRvbnNDb250YWluZXIuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJzdmctY3Jvd2JhciIpOwogICAgYnV0dG9uc0NvbnRhaW5lci5zdHlsZVsiei1pbmRleCJdID0gMWU3OwogICAgYnV0dG9uc0NvbnRhaW5lci5zdHlsZVsicG9zaXRpb24iXSA9ICJhYnNvbHV0ZSI7CiAgICBidXR0b25zQ29udGFpbmVyLnN0eWxlWyJ0b3AiXSA9IDA7CiAgICBidXR0b25zQ29udGFpbmVyLnN0eWxlWyJsZWZ0Il0gPSAwOwoKCgogICAgdmFyIGJhY2tncm91bmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGJvZHkuYXBwZW5kQ2hpbGQoYmFja2dyb3VuZCk7CgogICAgYmFja2dyb3VuZC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInN2Zy1jcm93YmFyIik7CiAgICBiYWNrZ3JvdW5kLnN0eWxlWyJiYWNrZ3JvdW5kIl0gPSAicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpIjsKICAgIGJhY2tncm91bmQuc3R5bGVbInBvc2l0aW9uIl0gPSAiZml4ZWQiOwogICAgYmFja2dyb3VuZC5zdHlsZVsibGVmdCJdID0gMDsKICAgIGJhY2tncm91bmQuc3R5bGVbInRvcCJdID0gMDsKICAgIGJhY2tncm91bmQuc3R5bGVbIndpZHRoIl0gPSAiMTAwJSI7CiAgICBiYWNrZ3JvdW5kLnN0eWxlWyJoZWlnaHQiXSA9ICIxMDAlIjsKCiAgICBzb3VyY2VzLmZvckVhY2goZnVuY3Rpb24oZCwgaSkgewogICAgICB2YXIgYnV0dG9uV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBidXR0b25zQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbldyYXBwZXIpOwogICAgICBidXR0b25XcmFwcGVyLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAic3ZnLWNyb3diYXIiKTsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsicG9zaXRpb24iXSA9ICJhYnNvbHV0ZSI7CiAgICAgIGJ1dHRvbldyYXBwZXIuc3R5bGVbInRvcCJdID0gKGQudG9wICsgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApICsgInB4IjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsibGVmdCJdID0gKGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCArIGQubGVmdCkgKyAicHgiOwogICAgICBidXR0b25XcmFwcGVyLnN0eWxlWyJwYWRkaW5nIl0gPSAiNHB4IjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsiYm9yZGVyLXJhZGl1cyJdID0gIjNweCI7CiAgICAgIGJ1dHRvbldyYXBwZXIuc3R5bGVbImNvbG9yIl0gPSAid2hpdGUiOwogICAgICBidXR0b25XcmFwcGVyLnN0eWxlWyJ0ZXh0LWFsaWduIl0gPSAiY2VudGVyIjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsiZm9udC1mYW1pbHkiXSA9ICInSGVsdmV0aWNhIE5ldWUnIjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsiYmFja2dyb3VuZCJdID0gInJnYmEoMCwgMCwgMCwgMC44KSI7CiAgICAgIGJ1dHRvbldyYXBwZXIuc3R5bGVbImJveC1zaGFkb3ciXSA9ICIwcHggNHB4IDE4cHggcmdiYSgwLCAwLCAwLCAwLjQpIjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsiY3Vyc29yIl0gPSAibW92ZSI7CiAgICAgIGJ1dHRvbldyYXBwZXIudGV4dENvbnRlbnQgPSAgIlNWRyAjIiArIGkgKyAiOiAiICsgKGQuaWQgPyAiIyIgKyBkLmlkIDogIiIpICsgKGQuY2xhc3MgPyAiLiIgKyBkLmNsYXNzIDogIiIpOwoKICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgICBidXR0b25XcmFwcGVyLmFwcGVuZENoaWxkKGJ1dHRvbik7CiAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImRhdGEtc291cmNlLWlkIiwgaSkKICAgICAgYnV0dG9uLnN0eWxlWyJ3aWR0aCJdID0gIjE1MHB4IjsKICAgICAgYnV0dG9uLnN0eWxlWyJmb250LXNpemUiXSA9ICIxMnB4IjsKICAgICAgYnV0dG9uLnN0eWxlWyJsaW5lLWhlaWdodCJdID0gIjEuNGVtIjsKICAgICAgYnV0dG9uLnN0eWxlWyJtYXJnaW4iXSA9ICI1cHggMCAwIDAiOwogICAgICBidXR0b24udGV4dENvbnRlbnQgPSAiRG93bmxvYWQiOwoKICAgICAgYnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbihlbCkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKGVsLCBkLCBpLCBzb3VyY2VzKQogICAgICAgIGRvd25sb2FkKGQpOwogICAgICB9OwoKICAgIH0pOwoKICB9CgogIGZ1bmN0aW9uIGNsZWFudXAoKSB7CiAgICB2YXIgY3Jvd2JhckVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnN2Zy1jcm93YmFyIik7CgogICAgW10uZm9yRWFjaC5jYWxsKGNyb3diYXJFbGVtZW50cywgZnVuY3Rpb24oZWwpIHsKICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7CiAgICB9KTsKICB9CgoKICBmdW5jdGlvbiBnZXRTb3VyY2VzKGRvYywgc3R5bGVzKSB7CiAgICB2YXIgc3ZnSW5mbyA9IFtdLAogICAgICAgIHN2ZyA9IGRvYy5xdWVyeVNlbGVjdG9yKCIuIiArIHN2Z0NsYXNzTmFtZSk7CgogICAgc3R5bGVzID0gKHN0eWxlcyA9PT0gdW5kZWZpbmVkKSA/ICIiIDogc3R5bGVzOwoKCiAgICBzdmcuc2V0QXR0cmlidXRlKCJ2ZXJzaW9uIiwgIjEuMSIpOwoKICAgIHZhciBkZWZzRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkZWZzIik7CiAgICBzdmcuaW5zZXJ0QmVmb3JlKGRlZnNFbCwgc3ZnLmZpcnN0Q2hpbGQpOyAvL1RPRE8gICAuaW5zZXJ0KCJkZWZzIiwgIjpmaXJzdC1jaGlsZCIpCiAgICAvLyBkZWZzRWwuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJzdmctY3Jvd2JhciIpOwoKICAgIHZhciBzdHlsZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKQogICAgZGVmc0VsLmFwcGVuZENoaWxkKHN0eWxlRWwpOwogICAgc3R5bGVFbC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dC9jc3MiKTsKCgogICAgLy8gcmVtb3ZpbmcgYXR0cmlidXRlcyBzbyB0aGV5IGFyZW4ndCBkb3VibGVkIHVwCiAgICBzdmcucmVtb3ZlQXR0cmlidXRlKCJ4bWxucyIpOwogICAgc3ZnLnJlbW92ZUF0dHJpYnV0ZSgieGxpbmsiKTsKCiAgICAvLyBUaGVzZSBhcmUgbmVlZGVkIGZvciB0aGUgc3ZnCiAgICBpZiAoIXN2Zy5oYXNBdHRyaWJ1dGVOUyhwcmVmaXgueG1sbnMsICJ4bWxucyIpKSB7CiAgICAgIHN2Zy5zZXRBdHRyaWJ1dGVOUyhwcmVmaXgueG1sbnMsICJ4bWxucyIsIHByZWZpeC5zdmcpOwogICAgfQoKICAgIGlmICghc3ZnLmhhc0F0dHJpYnV0ZU5TKHByZWZpeC54bWxucywgInhtbG5zOnhsaW5rIikpIHsKICAgICAgc3ZnLnNldEF0dHJpYnV0ZU5TKHByZWZpeC54bWxucywgInhtbG5zOnhsaW5rIiwgcHJlZml4LnhsaW5rKTsKICAgIH0KCiAgICB2YXIgc291cmNlID0gKG5ldyBYTUxTZXJpYWxpemVyKCkpLnNlcmlhbGl6ZVRvU3RyaW5nKHN2ZykucmVwbGFjZSgnPC9zdHlsZT4nLCAnPCFbQ0RBVEFbJyArIHN0eWxlcyArICddXT48L3N0eWxlPicpOwogICAgdmFyIHJlY3QgPSBzdmcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBzdmdJbmZvLnB1c2goewogICAgICB0b3A6IHJlY3QudG9wLAogICAgICBsZWZ0OiByZWN0LmxlZnQsCiAgICAgIHdpZHRoOiByZWN0LndpZHRoLAogICAgICBoZWlnaHQ6IHJlY3QuaGVpZ2h0LAogICAgICBjbGFzczogc3ZnLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSwKICAgICAgaWQ6IHN2Zy5nZXRBdHRyaWJ1dGUoImlkIiksCiAgICAgIGNoaWxkRWxlbWVudENvdW50OiBzdmcuY2hpbGRFbGVtZW50Q291bnQsCiAgICAgIHNvdXJjZTogW2RvY3R5cGUgKyBzb3VyY2VdCiAgICB9KTsKCiAgICByZXR1cm4gc3ZnSW5mbzsKICB9CgogIGZ1bmN0aW9uIGRvd25sb2FkKHNvdXJjZSkgewogICAgdmFyIGZpbGVuYW1lID0gInVudGl0bGVkIjsKCiAgICBpZiAoc291cmNlLmlkKSB7CiAgICAgIGZpbGVuYW1lID0gc291cmNlLmlkOwogICAgfSBlbHNlIGlmIChzb3VyY2UuY2xhc3MpIHsKICAgICAgZmlsZW5hbWUgPSBzb3VyY2UuY2xhc3M7CiAgICB9IGVsc2UgaWYgKHdpbmRvdy5kb2N1bWVudC50aXRsZSkgewogICAgICBmaWxlbmFtZSA9IHdpbmRvdy5kb2N1bWVudC50aXRsZS5yZXBsYWNlKC9bXmEtejAtOV0vZ2ksICctJykudG9Mb3dlckNhc2UoKTsKICAgIH0KCiAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2Ioc291cmNlLnNvdXJjZSwgeyAidHlwZSIgOiAidGV4dFwveG1sIiB9KSk7CgogICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICBib2R5LmFwcGVuZENoaWxkKGEpOwogICAgYS5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInN2Zy1jcm93YmFyIik7CiAgICBhLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCBmaWxlbmFtZSArICIuc3ZnIik7CiAgICBhLnNldEF0dHJpYnV0ZSgiaHJlZiIsIHVybCk7CiAgICBhLnN0eWxlWyJkaXNwbGF5Il0gPSAibm9uZSI7CiAgICBhLmNsaWNrKCk7CgogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKICAgIH0sIDEwKTsKICB9CgogIGZ1bmN0aW9uIGdldFN0eWxlcyhkb2MpIHsKICAgIHZhciBzdHlsZXMgPSAiIiwKICAgICAgICBzdHlsZVNoZWV0cyA9IGRvYy5zdHlsZVNoZWV0czsKCiAgICBpZiAoc3R5bGVTaGVldHMpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHlsZVNoZWV0cy5sZW5ndGg7IGkrKykgewogICAgICAgIHByb2Nlc3NTdHlsZVNoZWV0KHN0eWxlU2hlZXRzW2ldKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHByb2Nlc3NTdHlsZVNoZWV0KHNzKSB7CiAgICAgIGlmIChzcy5jc3NSdWxlcykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3MuY3NzUnVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBydWxlID0gc3MuY3NzUnVsZXNbaV07CiAgICAgICAgICBpZiAocnVsZS50eXBlID09PSAzKSB7CiAgICAgICAgICAgIC8vIEltcG9ydCBSdWxlCiAgICAgICAgICAgIHByb2Nlc3NTdHlsZVNoZWV0KHJ1bGUuc3R5bGVTaGVldCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBoYWNrIGZvciBpbGx1c3RyYXRvciBjcmFzaGluZyBvbiBkZXNjZW5kZW50IHNlbGVjdG9ycwogICAgICAgICAgICBpZiAocnVsZS5zZWxlY3RvclRleHQpIHsKICAgICAgICAgICAgICBpZiAocnVsZS5zZWxlY3RvclRleHQuaW5kZXhPZigiPiIpID09PSAtMSkgewogICAgICAgICAgICAgICAgc3R5bGVzICs9ICJcbiIgKyBydWxlLmNzc1RleHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3R5bGVzOwogIH0KfQ=="></script>
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKCiAgbmFtZTogJ3RpbWVzY2FwZScsCgogIHR5cGU6ICdvdXRwdXQnLAoKICBpbml0aWFsaXplOiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCkgewogICAgCgogICAgLy8gZ2xvYmFsIHZhcmlhYmxlIHZpek9iagogICAgdml6T2JqID0ge307CiAgICAKICAgIC8vIG5vdGUgY3VycmVudCB3aWR0aCAmIGhlaWdodCBpbiB2aXpPYmoKICAgIHZpek9iai5jdXJfaGVpZ2h0ID0gaGVpZ2h0OwogICAgdml6T2JqLmN1cl93aWR0aCA9IHdpZHRoOwoKICAgIHJldHVybiB7fQogICAgCiAgfSwKCiAgcmVuZGVyVmFsdWU6IGZ1bmN0aW9uKGVsLCB4LCBpbnN0YW5jZSkgewoKICAgIF9ydW5fdGltZXNjYXBlKGVsLmlkLCB2aXpPYmouY3VyX3dpZHRoLCB2aXpPYmouY3VyX2hlaWdodCwgeCwgdHJ1ZSk7CgogIH0sCgogIHJlc2l6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQsIGluc3RhbmNlKSB7CiAgICByZXR1cm4ge30KICAgIAogIH0KCn0pOwo="></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">TimeScape vignette</h1>



<p>TimeScape is a visualization tool for temporal clonal evolution.</p>
<div id="installation" class="section level1">
<h1>Installation</h1>
<p>To install TimeScape, type the following commands in R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># try http:// if https:// URLs are not supported</span>
<span class="kw">source</span>(<span class="st">&quot;https://bioconductor.org/biocLite.R&quot;</span>)
<span class="kw">biocLite</span>(<span class="st">&quot;timescape&quot;</span>)</code></pre></div>
</div>
<div id="examples" class="section level1">
<h1>Examples</h1>
<p>Run the examples by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">example</span>(<span class="st">&quot;timescape&quot;</span>)</code></pre></div>
<p>The following visualizations will appear in your browser (optimized for Chrome):</p>
<p>The first visualization is of the acute myeloid leukemia patient from Ding et al., 2012. The second visualization is of the metastatic ovarian cancer patient 7 from McPherson and Roth et al., 2016.</p>
<div id="htmlwidget-8c3c848d40ea9d12f361" style="width:900px;height:288px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-8c3c848d40ea9d12f361">{"x":{"clonal_prev":[{"timepoint":"Diagnosis","clone_id":"1","clonal_prev":0.1274},{"timepoint":"Diagnosis","clone_id":"2","clonal_prev":0.5312},{"timepoint":"Diagnosis","clone_id":"3","clonal_prev":0.2904},{"timepoint":"Diagnosis","clone_id":"4","clonal_prev":0.051},{"timepoint":"Relapse","clone_id":"5","clonal_prev":1}],"gtype_tree_edges":[{"source":"1","target":"2"},{"source":"1","target":"3"},{"source":"3","target":"4"},{"source":"4","target":"5"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":50,"genotype_position":"stack","perturbations":[{"pert_name":"Chemotherapy","prev_tp":"Diagnosis","frac":"0.1"}],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Diagnosis","space_replaced_timepoint":"Diagnosis"},{"original_timepoint":"Relapse","space_replaced_timepoint":"Relapse"}],"clone_id_map":[{"original_clone_id":"1","space_replaced_clone_id":"1"},{"original_clone_id":"3","space_replaced_clone_id":"3"},{"original_clone_id":"4","space_replaced_clone_id":"4"},{"original_clone_id":"2","space_replaced_clone_id":"2"},{"original_clone_id":"5","space_replaced_clone_id":"5"}]},"evals":[],"jsHooks":[]}</script>
<p><br> <br> <br> <br> <br></p>
<div id="htmlwidget-dd9acb2c00986e77eada" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-dd9acb2c00986e77eada">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":[{"clone_id":"A","colour":"d0ced0"},{"clone_id":"B","colour":"2CD0AB"},{"clone_id":"C","colour":"FFD94B"},{"clone_id":"D","colour":"FD8EE5"},{"clone_id":"E","colour":"F8766D"}],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":15,"genotype_position":"stack","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="required-parameters" class="section level1">
<h1>Required parameters</h1>
<p>The required parameters for TimeScape are as follows:</p>
<p><span class="math inline">\(clonal\_prev\)</span> is a data frame consisting of clonal prevalences for each clone at each time point. The columns in this data frame are:</p>
<ol style="list-style-type: decimal">
<li>character() <span class="math inline">\(timepoint\)</span> - time point</li>
<li>character() <span class="math inline">\(clone\_id\)</span> - clone id</li>
<li>numeric() <span class="math inline">\(clonal\_prev\)</span> - clonal prevalence.</li>
</ol>
<p><span class="math inline">\(tree\_edges\)</span> is a data frame describing the edges of a rooted clonal phylogeny. The columns in this data frame are:</p>
<ol style="list-style-type: decimal">
<li>character() <span class="math inline">\(source\)</span> - source node id</li>
<li>character() <span class="math inline">\(target\)</span> - target node id.</li>
</ol>
</div>
<div id="optional-parameters" class="section level1">
<h1>Optional parameters</h1>
<div id="mutations" class="section level2">
<h2>Mutations</h2>
<p><span class="math inline">\(mutations\)</span> is a data frame consisting of the mutations originating in each clone. The columns in this data frame are:</p>
<ol style="list-style-type: decimal">
<li>character() <span class="math inline">\(chrom\)</span> - chromosome number</li>
<li>numeric() <span class="math inline">\(coord\)</span> - coordinate of mutation on chromosome</li>
<li>character() <span class="math inline">\(clone\_id\)</span> - clone id</li>
<li>character() <span class="math inline">\(timepoint\)</span> - time point</li>
<li>numeric() <span class="math inline">\(VAF\)</span> - variant allele frequency of the mutation in the corresponding timepoint.</li>
</ol>
<p>If this parameter is provided, a mutation table will appear at the bottom of the view.</p>
</div>
<div id="clone-colours" class="section level2">
<h2>Clone colours</h2>
<p>Clone colours may be changed using the <span class="math inline">\(clone\_colours\)</span> parameter, for instance, compare the default colours :</p>
<div id="htmlwidget-4b6d749edaeb40fa05bf" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-4b6d749edaeb40fa05bf">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":15,"genotype_position":"stack","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script>
<p>with specified custom colours:</p>
<div id="htmlwidget-8db0623f5a9e209f879e" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-8db0623f5a9e209f879e">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":[{"clone_id":"A","colour":"#e41a1c"},{"clone_id":"B","colour":"#377eb8"},{"clone_id":"C","colour":"#4daf4a"},{"clone_id":"D","colour":"#984ea3"},{"clone_id":"E","colour":"#ff7f00"}],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":15,"genotype_position":"stack","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="alpha-value" class="section level2">
<h2>Alpha value</h2>
<p>The alpha value of each colour may be tweaked in the <span class="math inline">\(alpha\)</span> parameter (a numeric value between [0, 100]). Compare alpha of 10: <div id="htmlwidget-7a4e7b3f3ba29c0cc1e0" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-7a4e7b3f3ba29c0cc1e0">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":10,"genotype_position":"stack","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script></p>
<p>with the alpha value of 90: <div id="htmlwidget-da39b3eecd3f0f709cf6" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-da39b3eecd3f0f709cf6">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":90,"genotype_position":"stack","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script></p>
</div>
<div id="titles" class="section level2">
<h2>Titles</h2>
<p>The x-axis, y-axis and phylogeny titles may be changed using the <span class="math inline">\(xaxis\_title\)</span>, <span class="math inline">\(yaxis\_title\)</span> and <span class="math inline">\(phylogeny\_title\)</span> parameters, which take in a character string.</p>
<p>Here are some custom titles: <div id="htmlwidget-113571d8616e8877cccf" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-113571d8616e8877cccf">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"My X Axis","yaxis_title":"My Y Axis","phylogeny_title":"My Phylogeny","alpha":15,"genotype_position":"stack","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script></p>
</div>
<div id="genotype-position" class="section level2">
<h2>Genotype position</h2>
<p>The position of each genotype with respect to its ancestor can be altered. The stack layout is the default layout. It stacks genotypes one on top of another to clearly display genotype prevalences at each time point. The space layout uses the same stacking method while maintaining (where possible) a minimum amount of space between each genotype. The centre layout centers genotypes with respect to their ancestors. Here well see an example of each:</p>
<div id="stacked" class="section level3">
<h3>Stacked</h3>
<div id="htmlwidget-40d551726e07dd0229cb" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-40d551726e07dd0229cb">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":15,"genotype_position":"stack","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="spaced" class="section level3">
<h3>Spaced</h3>
<div id="htmlwidget-5c95a784f7f962ad56bc" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-5c95a784f7f962ad56bc">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":15,"genotype_position":"space","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="centered" class="section level3">
<h3>Centered</h3>
<div id="htmlwidget-e0357451ea411bd7ad73" style="width:900px;height:260px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-e0357451ea411bd7ad73">{"x":{"clonal_prev":[{"timepoint":"Intraperitoneal_diagnosis","clone_id":"A","clonal_prev":0.3732},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"B","clonal_prev":0.0072},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"C","clonal_prev":0.2571},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"D","clonal_prev":0.1107},{"timepoint":"Intraperitoneal_diagnosis","clone_id":"E","clonal_prev":0.2519},{"timepoint":"Brain_metastasis","clone_id":"A","clonal_prev":0.0066},{"timepoint":"Brain_metastasis","clone_id":"B","clonal_prev":0.9921},{"timepoint":"Brain_metastasis","clone_id":"C","clonal_prev":0.0006},{"timepoint":"Brain_metastasis","clone_id":"D","clonal_prev":0.0004},{"timepoint":"Brain_metastasis","clone_id":"E","clonal_prev":0.0003},{"timepoint":"Intraperitoneal_relapse","clone_id":"A","clonal_prev":0.0077},{"timepoint":"Intraperitoneal_relapse","clone_id":"B","clonal_prev":0.0013},{"timepoint":"Intraperitoneal_relapse","clone_id":"C","clonal_prev":0.1737},{"timepoint":"Intraperitoneal_relapse","clone_id":"D","clonal_prev":0.8162},{"timepoint":"Intraperitoneal_relapse","clone_id":"E","clonal_prev":0.0012}],"gtype_tree_edges":[{"source":"A","target":"B"},{"source":"A","target":"C"},{"source":"C","target":"D"},{"source":"C","target":"E"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":15,"genotype_position":"centre","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Intraperitoneal diagnosis","space_replaced_timepoint":"Intraperitoneal_diagnosis"},{"original_timepoint":"Brain metastasis","space_replaced_timepoint":"Brain_metastasis"},{"original_timepoint":"Intraperitoneal relapse","space_replaced_timepoint":"Intraperitoneal_relapse"}],"clone_id_map":[{"original_clone_id":"A","space_replaced_clone_id":"A"},{"original_clone_id":"C","space_replaced_clone_id":"C"},{"original_clone_id":"B","space_replaced_clone_id":"B"},{"original_clone_id":"D","space_replaced_clone_id":"D"},{"original_clone_id":"E","space_replaced_clone_id":"E"}]},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="perturbations" class="section level2">
<h2>Perturbations</h2>
<p>Perturbations may be added to the TimeScape using the <span class="math inline">\(perturbations\)</span> parameter, which is a data frame consisting of the following columns:</p>
<ol style="list-style-type: decimal">
<li>character() <span class="math inline">\(pert_name\)</span> - the perturbation name</li>
<li>character() <span class="math inline">\(prev_tp\)</span> - the time point (as labelled in clonal prevalence data) BEFORE perturbation</li>
<li>numeric() <span class="math inline">\(frac\)</span> - the fraction of total tumour content remaining at the time of perturbation, range [0, 1].</li>
</ol>
<div id="without-perturbation" class="section level3">
<h3>Without perturbation</h3>
<div id="htmlwidget-e056b9103e0a4704db0f" style="width:900px;height:288px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-e056b9103e0a4704db0f">{"x":{"clonal_prev":[{"timepoint":"Diagnosis","clone_id":"1","clonal_prev":0.1274},{"timepoint":"Diagnosis","clone_id":"2","clonal_prev":0.5312},{"timepoint":"Diagnosis","clone_id":"3","clonal_prev":0.2904},{"timepoint":"Diagnosis","clone_id":"4","clonal_prev":0.051},{"timepoint":"Relapse","clone_id":"5","clonal_prev":1}],"gtype_tree_edges":[{"source":"1","target":"2"},{"source":"1","target":"3"},{"source":"3","target":"4"},{"source":"4","target":"5"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":50,"genotype_position":"stack","perturbations":["NA"],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Diagnosis","space_replaced_timepoint":"Diagnosis"},{"original_timepoint":"Relapse","space_replaced_timepoint":"Relapse"}],"clone_id_map":[{"original_clone_id":"1","space_replaced_clone_id":"1"},{"original_clone_id":"3","space_replaced_clone_id":"3"},{"original_clone_id":"4","space_replaced_clone_id":"4"},{"original_clone_id":"2","space_replaced_clone_id":"2"},{"original_clone_id":"5","space_replaced_clone_id":"5"}]},"evals":[],"jsHooks":[]}</script>
</div>
<div id="with-perturbation-reduces-the-tumour-to-10-of-its-original-size" class="section level3">
<h3>With perturbation (reduces the tumour to 10% of its original size)</h3>
<div id="htmlwidget-c9a024eabd4ad9d60f14" style="width:900px;height:288px;" class="timescape html-widget"></div>
<script type="application/json" data-for="htmlwidget-c9a024eabd4ad9d60f14">{"x":{"clonal_prev":[{"timepoint":"Diagnosis","clone_id":"1","clonal_prev":0.1274},{"timepoint":"Diagnosis","clone_id":"2","clonal_prev":0.5312},{"timepoint":"Diagnosis","clone_id":"3","clonal_prev":0.2904},{"timepoint":"Diagnosis","clone_id":"4","clonal_prev":0.051},{"timepoint":"Relapse","clone_id":"5","clonal_prev":1}],"gtype_tree_edges":[{"source":"1","target":"2"},{"source":"1","target":"3"},{"source":"3","target":"4"},{"source":"4","target":"5"}],"clone_cols":["NA"],"mutations":["NA"],"mutation_prevalences":["NA"],"mutations_provided":false,"xaxis_title":"Time Point","yaxis_title":"Clonal Prevalence","phylogeny_title":"Clonal Phylogeny","alpha":50,"genotype_position":"stack","perturbations":[{"pert_name":"Chemotherapy","prev_tp":"Diagnosis","frac":"0.1"}],"sort_gtypes":false,"timepoint_map":[{"original_timepoint":"Diagnosis","space_replaced_timepoint":"Diagnosis"},{"original_timepoint":"Relapse","space_replaced_timepoint":"Relapse"}],"clone_id_map":[{"original_clone_id":"1","space_replaced_clone_id":"1"},{"original_clone_id":"3","space_replaced_clone_id":"3"},{"original_clone_id":"4","space_replaced_clone_id":"4"},{"original_clone_id":"2","space_replaced_clone_id":"2"},{"original_clone_id":"5","space_replaced_clone_id":"5"}]},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="obtaining-the-data" class="section level1">
<h1>Obtaining the data</h1>
<p>To transform mutational variant allele frequency information into clonal prevalences, first use PyClone (Roth et al., 2014) to obtain mutation clusters, then input these mutation clusters into CITUP (Malikic et al., 2016), which will provide a clonal phylogeny and the prevalences of each clone.</p>
</div>
<div id="interactivity" class="section level1">
<h1>Interactivity</h1>
<p>Interactive components:</p>
<ol style="list-style-type: decimal">
<li>Mouseover any clone to view its (i) clone ID and (ii) clonal prevalence at each time point.</li>
<li>Click the view switch button to switch from the traditional timescape view to the clonal trajectory view, where each clone changes prevalence on its own track.</li>
<li>Click the download buttons to download a PNG or SVG of the view.</li>
</ol>
</div>
<div id="documentation" class="section level1">
<h1>Documentation</h1>
<p>To view the documentation for TimeScape, type the following command in R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?timescape</code></pre></div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>TimeScape was developed at the Shah Lab for Computational Cancer Biology at the BC Cancer Research Centre.</p>
<p>References:</p>
<p>Ding, Li, et al. Clonal evolution in relapsed acute myeloid leukaemia revealed by whole-genome sequencing. Nature 481.7382 (2012): 506-510.</p>
<p>Malikic, Salem, et al. Clonality inference in multiple tumor samples using phylogeny. Bioinformatics 31.9 (2015): 1349-1356.</p>
<p>McPherson, Andrew, et al. Divergent modes of clonal spread and intraperitoneal mixing in high-grade serous ovarian cancer. Nature genetics (2016).</p>
<p>Roth, Andrew, et al. PyClone: statistical inference of clonal population structure in cancer. Nature methods 11.4 (2014): 396-398.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
